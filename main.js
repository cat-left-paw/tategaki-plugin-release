/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var jE=Object.create;var qo=Object.defineProperty;var YE=Object.getOwnPropertyDescriptor;var XE=Object.getOwnPropertyNames;var JE=Object.getPrototypeOf,ZE=Object.prototype.hasOwnProperty;var et=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),QE=(i,t)=>{for(var e in t)qo(i,e,{get:t[e],enumerable:!0})},Ah=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of XE(t))!ZE.call(i,r)&&r!==e&&qo(i,r,{get:()=>t[r],enumerable:!(n=YE(t,r))||n.enumerable});return i};var Go=(i,t,e)=>(e=i!=null?jE(JE(i)):{},Ah(t||!i||!i.__esModule?qo(e,"default",{value:i,enumerable:!0}):e,i)),ex=i=>Ah(qo({},"__esModule",{value:!0}),i);var jp=et((l2,Gp)=>{"use strict";function qx(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n])}return i}function lc(i,t){return Array(t+1).join(i)}function Gx(i){return i.replace(/^\n*/,"")}function jx(i){for(var t=i.length;t>0&&i[t-1]===`
`;)t--;return i.substring(0,t)}var Yx=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function cc(i){return uc(i,Yx)}var zp=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function Vp(i){return uc(i,zp)}function Xx(i){return Wp(i,zp)}var $p=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Jx(i){return uc(i,$p)}function Zx(i){return Wp(i,$p)}function uc(i,t){return t.indexOf(i.nodeName)>=0}function Wp(i,t){return i.getElementsByTagName&&t.some(function(e){return i.getElementsByTagName(e).length})}var lt={};lt.paragraph={filter:"p",replacement:function(i){return`

`+i+`

`}};lt.lineBreak={filter:"br",replacement:function(i,t,e){return e.br+`
`}};lt.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(i,t,e){var n=Number(t.nodeName.charAt(1));if(e.headingStyle==="setext"&&n<3){var r=lc(n===1?"=":"-",i.length);return`

`+i+`
`+r+`

`}else return`

`+lc("#",n)+" "+i+`

`}};lt.blockquote={filter:"blockquote",replacement:function(i){return i=i.replace(/^\n+|\n+$/g,""),i=i.replace(/^/gm,"> "),`

`+i+`

`}};lt.list={filter:["ul","ol"],replacement:function(i,t){var e=t.parentNode;return e.nodeName==="LI"&&e.lastElementChild===t?`
`+i:`

`+i+`

`}};lt.listItem={filter:"li",replacement:function(i,t,e){var n=e.bulletListMarker+"   ",r=t.parentNode;if(r.nodeName==="OL"){var o=r.getAttribute("start"),s=Array.prototype.indexOf.call(r.children,t);n=(o?Number(o)+s:s+1)+".  "}return i=i.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
`+" ".repeat(n.length)),n+i+(t.nextSibling&&!/\n$/.test(i)?`
`:"")}};lt.indentedCodeBlock={filter:function(i,t){return t.codeBlockStyle==="indented"&&i.nodeName==="PRE"&&i.firstChild&&i.firstChild.nodeName==="CODE"},replacement:function(i,t,e){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};lt.fencedCodeBlock={filter:function(i,t){return t.codeBlockStyle==="fenced"&&i.nodeName==="PRE"&&i.firstChild&&i.firstChild.nodeName==="CODE"},replacement:function(i,t,e){for(var n=t.firstChild.getAttribute("class")||"",r=(n.match(/language-(\S+)/)||[null,""])[1],o=t.firstChild.textContent,s=e.fence.charAt(0),a=3,l=new RegExp("^"+s+"{3,}","gm"),c;c=l.exec(o);)c[0].length>=a&&(a=c[0].length+1);var u=lc(s,a);return`

`+u+r+`
`+o.replace(/\n$/,"")+`
`+u+`

`}};lt.horizontalRule={filter:"hr",replacement:function(i,t,e){return`

`+e.hr+`

`}};lt.inlineLink={filter:function(i,t){return t.linkStyle==="inlined"&&i.nodeName==="A"&&i.getAttribute("href")},replacement:function(i,t){var e=t.getAttribute("href");e&&(e=e.replace(/([()])/g,"\\$1"));var n=as(t.getAttribute("title"));return n&&(n=' "'+n.replace(/"/g,'\\"')+'"'),"["+i+"]("+e+n+")"}};lt.referenceLink={filter:function(i,t){return t.linkStyle==="referenced"&&i.nodeName==="A"&&i.getAttribute("href")},replacement:function(i,t,e){var n=t.getAttribute("href"),r=as(t.getAttribute("title"));r&&(r=' "'+r+'"');var o,s;switch(e.linkReferenceStyle){case"collapsed":o="["+i+"][]",s="["+i+"]: "+n+r;break;case"shortcut":o="["+i+"]",s="["+i+"]: "+n+r;break;default:var a=this.references.length+1;o="["+i+"]["+a+"]",s="["+a+"]: "+n+r}return this.references.push(s),o},references:[],append:function(i){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};lt.emphasis={filter:["em","i"],replacement:function(i,t,e){return i.trim()?e.emDelimiter+i+e.emDelimiter:""}};lt.strong={filter:["strong","b"],replacement:function(i,t,e){return i.trim()?e.strongDelimiter+i+e.strongDelimiter:""}};lt.code={filter:function(i){var t=i.previousSibling||i.nextSibling,e=i.parentNode.nodeName==="PRE"&&!t;return i.nodeName==="CODE"&&!e},replacement:function(i){if(!i)return"";i=i.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(i)?" ":"",e="`",n=i.match(/`+/gm)||[];n.indexOf(e)!==-1;)e=e+"`";return e+t+i+t+e}};lt.image={filter:"img",replacement:function(i,t){var e=as(t.getAttribute("alt")),n=t.getAttribute("src")||"",r=as(t.getAttribute("title")),o=r?' "'+r+'"':"";return n?"!["+e+"]("+n+o+")":""}};function as(i){return i?i.replace(/(\n+\s*)+/g,`
`):""}function Up(i){this.options=i,this._keep=[],this._remove=[],this.blankRule={replacement:i.blankReplacement},this.keepReplacement=i.keepReplacement,this.defaultRule={replacement:i.defaultReplacement},this.array=[];for(var t in i.rules)this.array.push(i.rules[t])}Up.prototype={add:function(i,t){this.array.unshift(t)},keep:function(i){this._keep.unshift({filter:i,replacement:this.keepReplacement})},remove:function(i){this._remove.unshift({filter:i,replacement:function(){return""}})},forNode:function(i){if(i.isBlank)return this.blankRule;var t;return(t=oc(this.array,i,this.options))||(t=oc(this._keep,i,this.options))||(t=oc(this._remove,i,this.options))?t:this.defaultRule},forEach:function(i){for(var t=0;t<this.array.length;t++)i(this.array[t],t)}};function oc(i,t,e){for(var n=0;n<i.length;n++){var r=i[n];if(Qx(r,t,e))return r}}function Qx(i,t,e){var n=i.filter;if(typeof n=="string"){if(n===t.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof n=="function"){if(n.call(i,t,e))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function eS(i){var t=i.element,e=i.isBlock,n=i.isVoid,r=i.isPre||function(d){return d.nodeName==="PRE"};if(!(!t.firstChild||r(t))){for(var o=null,s=!1,a=null,l=Fp(a,t,r);l!==t;){if(l.nodeType===3||l.nodeType===4){var c=l.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!s&&c[0]===" "&&(c=c.substr(1)),!c){l=sc(l);continue}l.data=c,o=l}else if(l.nodeType===1)e(l)||l.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,s=!1):n(l)||r(l)?(o=null,s=!0):o&&(s=!1);else{l=sc(l);continue}var u=Fp(a,l,r);a=l,l=u}o&&(o.data=o.data.replace(/ $/,""),o.data||sc(o))}}function sc(i){var t=i.nextSibling||i.parentNode;return i.parentNode.removeChild(i),t}function Fp(i,t,e){return i&&i.parentNode===t||e(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var dc=typeof window!="undefined"?window:{};function tS(){var i=dc.DOMParser,t=!1;try{new i().parseFromString("","text/html")&&(t=!0)}catch(e){}return t}function nS(){var i=function(){};return iS()?i.prototype.parseFromString=function(t){var e=new window.ActiveXObject("htmlfile");return e.designMode="on",e.open(),e.write(t),e.close(),e}:i.prototype.parseFromString=function(t){var e=document.implementation.createHTMLDocument("");return e.open(),e.write(t),e.close(),e},i}function iS(){var i=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){dc.ActiveXObject&&(i=!0)}return i}var rS=tS()?dc.DOMParser:nS();function oS(i,t){var e;if(typeof i=="string"){var n=sS().parseFromString('<x-turndown id="turndown-root">'+i+"</x-turndown>","text/html");e=n.getElementById("turndown-root")}else e=i.cloneNode(!0);return eS({element:e,isBlock:cc,isVoid:Vp,isPre:t.preformattedCode?aS:null}),e}var ac;function sS(){return ac=ac||new rS,ac}function aS(i){return i.nodeName==="PRE"||i.nodeName==="CODE"}function lS(i,t){return i.isBlock=cc(i),i.isCode=i.nodeName==="CODE"||i.parentNode.isCode,i.isBlank=cS(i),i.flankingWhitespace=uS(i,t),i}function cS(i){return!Vp(i)&&!Jx(i)&&/^\s*$/i.test(i.textContent)&&!Xx(i)&&!Zx(i)}function uS(i,t){if(i.isBlock||t.preformattedCode&&i.isCode)return{leading:"",trailing:""};var e=dS(i.textContent);return e.leadingAscii&&Hp("left",i,t)&&(e.leading=e.leadingNonAscii),e.trailingAscii&&Hp("right",i,t)&&(e.trailing=e.trailingNonAscii),{leading:e.leading,trailing:e.trailing}}function dS(i){var t=i.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function Hp(i,t,e){var n,r,o;return i==="left"?(n=t.previousSibling,r=/ $/):(n=t.nextSibling,r=/^ /),n&&(n.nodeType===3?o=r.test(n.nodeValue):e.preformattedCode&&n.nodeName==="CODE"?o=!1:n.nodeType===1&&!cc(n)&&(o=r.test(n.textContent))),o}var hS=Array.prototype.reduce,pS=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function ls(i){if(!(this instanceof ls))return new ls(i);var t={rules:lt,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,n){return n.isBlock?`

`:""},keepReplacement:function(e,n){return n.isBlock?`

`+n.outerHTML+`

`:n.outerHTML},defaultReplacement:function(e,n){return n.isBlock?`

`+e+`

`:e}};this.options=qx({},t,i),this.rules=new Up(this.options)}ls.prototype={turndown:function(i){if(!gS(i))throw new TypeError(i+" is not a string, or an element/document/fragment node.");if(i==="")return"";var t=Kp.call(this,new oS(i,this.options));return fS.call(this,t)},use:function(i){if(Array.isArray(i))for(var t=0;t<i.length;t++)this.use(i[t]);else if(typeof i=="function")i(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(i,t){return this.rules.add(i,t),this},keep:function(i){return this.rules.keep(i),this},remove:function(i){return this.rules.remove(i),this},escape:function(i){return pS.reduce(function(t,e){return t.replace(e[0],e[1])},i)}};function Kp(i){var t=this;return hS.call(i.childNodes,function(e,n){n=new lS(n,t.options);var r="";return n.nodeType===3?r=n.isCode?n.nodeValue:t.escape(n.nodeValue):n.nodeType===1&&(r=mS.call(t,n)),qp(e,r)},"")}function fS(i){var t=this;return this.rules.forEach(function(e){typeof e.append=="function"&&(i=qp(i,e.append(t.options)))}),i.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function mS(i){var t=this.rules.forNode(i),e=Kp.call(this,i),n=i.flankingWhitespace;return(n.leading||n.trailing)&&(e=e.trim()),n.leading+t.replacement(e,i,this.options)+n.trailing}function qp(i,t){var e=jx(i),n=Gx(t),r=Math.max(i.length-e.length,t.length-n.length),o=`

`.substring(0,r);return e+o+n}function gS(i){return i!=null&&(typeof i=="string"||i.nodeType&&(i.nodeType===1||i.nodeType===9||i.nodeType===11))}Gp.exports=ls});var q0=et((DF,K0)=>{function P0(i){return i instanceof Map?i.clear=i.delete=i.set=function(){throw new Error("map is read-only")}:i instanceof Set&&(i.add=i.clear=i.delete=function(){throw new Error("set is read-only")}),Object.freeze(i),Object.getOwnPropertyNames(i).forEach(t=>{let e=i[t],n=typeof e;(n==="object"||n==="function")&&!Object.isFrozen(e)&&P0(e)}),i}var Ra=class{constructor(t){t.data===void 0&&(t.data={}),this.data=t.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function _0(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function ni(i,...t){let e=Object.create(null);for(let n in i)e[n]=i[n];return t.forEach(function(n){for(let r in n)e[r]=n[r]}),e}var _T="</span>",C0=i=>!!i.scope,OT=(i,{prefix:t})=>{if(i.startsWith("language:"))return i.replace("language:","language-");if(i.includes(".")){let e=i.split(".");return[`${t}${e.shift()}`,...e.map((n,r)=>`${n}${"_".repeat(r+1)}`)].join(" ")}return`${t}${i}`},wd=class{constructor(t,e){this.buffer="",this.classPrefix=e.classPrefix,t.walk(this)}addText(t){this.buffer+=_0(t)}openNode(t){if(!C0(t))return;let e=OT(t.scope,{prefix:this.classPrefix});this.span(e)}closeNode(t){C0(t)&&(this.buffer+=_T)}value(){return this.buffer}span(t){this.buffer+=`<span class="${t}">`}},L0=(i={})=>{let t={children:[]};return Object.assign(t,i),t},So=class{constructor(){this.rootNode=L0(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(t){this.top.children.push(t)}openNode(t){let e=L0({scope:t});this.add(e),this.stack.push(e)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(t){return this.constructor._walk(t,this.rootNode)}static _walk(t,e){return typeof e=="string"?t.addText(e):e.children&&(t.openNode(e),e.children.forEach(n=>this._walk(t,n)),t.closeNode(e)),t}static _collapse(t){typeof t!="string"&&t.children&&(t.children.every(e=>typeof e=="string")?t.children=[t.children.join("")]:t.children.forEach(e=>{So._collapse(e)}))}},Md=class extends So{constructor(t){super(),this.options=t}addText(t){t!==""&&this.add(t)}startScope(t){this.openNode(t)}endScope(){this.closeNode()}__addSublanguage(t,e){let n=t.root;e&&(n.scope=`language:${e}`),this.add(n)}toHTML(){return new wd(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function ko(i){return i?typeof i=="string"?i:i.source:null}function O0(i){return _i("(?=",i,")")}function DT(i){return _i("(?:",i,")*")}function BT(i){return _i("(?:",i,")?")}function _i(...i){return i.map(e=>ko(e)).join("")}function FT(i){let t=i[i.length-1];return typeof t=="object"&&t.constructor===Object?(i.splice(i.length-1,1),t):{}}function Cd(...i){return"("+(FT(i).capture?"":"?:")+i.map(n=>ko(n)).join("|")+")"}function D0(i){return new RegExp(i.toString()+"|").exec("").length-1}function HT(i,t){let e=i&&i.exec(t);return e&&e.index===0}var zT=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Ld(i,{joinWith:t}){let e=0;return i.map(n=>{e+=1;let r=e,o=ko(n),s="";for(;o.length>0;){let a=zT.exec(o);if(!a){s+=o;break}s+=o.substring(0,a.index),o=o.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?s+="\\"+String(Number(a[1])+r):(s+=a[0],a[0]==="("&&e++)}return s}).map(n=>`(${n})`).join(t)}var VT=/\b\B/,B0="[a-zA-Z]\\w*",Rd="[a-zA-Z_]\\w*",F0="\\b\\d+(\\.\\d+)?",H0="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",z0="\\b(0b[01]+)",$T="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",WT=(i={})=>{let t=/^#![ ]*\//;return i.binary&&(i.begin=_i(t,/.*\b/,i.binary,/\b.*/)),ni({scope:"meta",begin:t,end:/$/,relevance:0,"on:begin":(e,n)=>{e.index!==0&&n.ignoreMatch()}},i)},wo={begin:"\\\\[\\s\\S]",relevance:0},UT={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[wo]},KT={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[wo]},qT={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},Ia=function(i,t,e={}){let n=ni({scope:"comment",begin:i,end:t,contains:[]},e);n.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});let r=Cd("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return n.contains.push({begin:_i(/[ ]+/,"(",r,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),n},GT=Ia("//","$"),jT=Ia("/\\*","\\*/"),YT=Ia("#","$"),XT={scope:"number",begin:F0,relevance:0},JT={scope:"number",begin:H0,relevance:0},ZT={scope:"number",begin:z0,relevance:0},QT={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[wo,{begin:/\[/,end:/\]/,relevance:0,contains:[wo]}]},eC={scope:"title",begin:B0,relevance:0},tC={scope:"title",begin:Rd,relevance:0},nC={begin:"\\.\\s*"+Rd,relevance:0},iC=function(i){return Object.assign(i,{"on:begin":(t,e)=>{e.data._beginMatch=t[1]},"on:end":(t,e)=>{e.data._beginMatch!==t[1]&&e.ignoreMatch()}})},La=Object.freeze({__proto__:null,APOS_STRING_MODE:UT,BACKSLASH_ESCAPE:wo,BINARY_NUMBER_MODE:ZT,BINARY_NUMBER_RE:z0,COMMENT:Ia,C_BLOCK_COMMENT_MODE:jT,C_LINE_COMMENT_MODE:GT,C_NUMBER_MODE:JT,C_NUMBER_RE:H0,END_SAME_AS_BEGIN:iC,HASH_COMMENT_MODE:YT,IDENT_RE:B0,MATCH_NOTHING_RE:VT,METHOD_GUARD:nC,NUMBER_MODE:XT,NUMBER_RE:F0,PHRASAL_WORDS_MODE:qT,QUOTE_STRING_MODE:KT,REGEXP_MODE:QT,RE_STARTERS_RE:$T,SHEBANG:WT,TITLE_MODE:eC,UNDERSCORE_IDENT_RE:Rd,UNDERSCORE_TITLE_MODE:tC});function rC(i,t){i.input[i.index-1]==="."&&t.ignoreMatch()}function oC(i,t){i.className!==void 0&&(i.scope=i.className,delete i.className)}function sC(i,t){t&&i.beginKeywords&&(i.begin="\\b("+i.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",i.__beforeBegin=rC,i.keywords=i.keywords||i.beginKeywords,delete i.beginKeywords,i.relevance===void 0&&(i.relevance=0))}function aC(i,t){Array.isArray(i.illegal)&&(i.illegal=Cd(...i.illegal))}function lC(i,t){if(i.match){if(i.begin||i.end)throw new Error("begin & end are not supported with match");i.begin=i.match,delete i.match}}function cC(i,t){i.relevance===void 0&&(i.relevance=1)}var uC=(i,t)=>{if(!i.beforeMatch)return;if(i.starts)throw new Error("beforeMatch cannot be used with starts");let e=Object.assign({},i);Object.keys(i).forEach(n=>{delete i[n]}),i.keywords=e.keywords,i.begin=_i(e.beforeMatch,O0(e.begin)),i.starts={relevance:0,contains:[Object.assign(e,{endsParent:!0})]},i.relevance=0,delete e.beforeMatch},dC=["of","and","for","in","not","or","if","then","parent","list","value"],hC="keyword";function V0(i,t,e=hC){let n=Object.create(null);return typeof i=="string"?r(e,i.split(" ")):Array.isArray(i)?r(e,i):Object.keys(i).forEach(function(o){Object.assign(n,V0(i[o],t,o))}),n;function r(o,s){t&&(s=s.map(a=>a.toLowerCase())),s.forEach(function(a){let l=a.split("|");n[l[0]]=[o,pC(l[0],l[1])]})}}function pC(i,t){return t?Number(t):fC(i)?0:1}function fC(i){return dC.includes(i.toLowerCase())}var R0={},Pi=i=>{console.error(i)},A0=(i,...t)=>{console.log(`WARN: ${i}`,...t)},vr=(i,t)=>{R0[`${i}/${t}`]||(console.log(`Deprecated as of ${i}. ${t}`),R0[`${i}/${t}`]=!0)},Aa=new Error;function $0(i,t,{key:e}){let n=0,r=i[e],o={},s={};for(let a=1;a<=t.length;a++)s[a+n]=r[a],o[a+n]=!0,n+=D0(t[a-1]);i[e]=s,i[e]._emit=o,i[e]._multi=!0}function mC(i){if(Array.isArray(i.begin)){if(i.skip||i.excludeBegin||i.returnBegin)throw Pi("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Aa;if(typeof i.beginScope!="object"||i.beginScope===null)throw Pi("beginScope must be object"),Aa;$0(i,i.begin,{key:"beginScope"}),i.begin=Ld(i.begin,{joinWith:""})}}function gC(i){if(Array.isArray(i.end)){if(i.skip||i.excludeEnd||i.returnEnd)throw Pi("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Aa;if(typeof i.endScope!="object"||i.endScope===null)throw Pi("endScope must be object"),Aa;$0(i,i.end,{key:"endScope"}),i.end=Ld(i.end,{joinWith:""})}}function bC(i){i.scope&&typeof i.scope=="object"&&i.scope!==null&&(i.beginScope=i.scope,delete i.scope)}function yC(i){bC(i),typeof i.beginScope=="string"&&(i.beginScope={_wrap:i.beginScope}),typeof i.endScope=="string"&&(i.endScope={_wrap:i.endScope}),mC(i),gC(i)}function vC(i){function t(s,a){return new RegExp(ko(s),"m"+(i.case_insensitive?"i":"")+(i.unicodeRegex?"u":"")+(a?"g":""))}class e{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=D0(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);let a=this.regexes.map(l=>l[1]);this.matcherRe=t(Ld(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;let l=this.matcherRe.exec(a);if(!l)return null;let c=l.findIndex((d,h)=>h>0&&d!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class n{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];let l=new e;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){let l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){let u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function r(s){let a=new n;return s.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),s.terminatorEnd&&a.addRule(s.terminatorEnd,{type:"end"}),s.illegal&&a.addRule(s.illegal,{type:"illegal"}),a}function o(s,a){let l=s;if(s.isCompiled)return l;[oC,lC,yC,uC].forEach(u=>u(s,a)),i.compilerExtensions.forEach(u=>u(s,a)),s.__beforeBegin=null,[sC,aC,cC].forEach(u=>u(s,a)),s.isCompiled=!0;let c=null;return typeof s.keywords=="object"&&s.keywords.$pattern&&(s.keywords=Object.assign({},s.keywords),c=s.keywords.$pattern,delete s.keywords.$pattern),c=c||/\w+/,s.keywords&&(s.keywords=V0(s.keywords,i.case_insensitive)),l.keywordPatternRe=t(c,!0),a&&(s.begin||(s.begin=/\B|\b/),l.beginRe=t(l.begin),!s.end&&!s.endsWithParent&&(s.end=/\B|\b/),s.end&&(l.endRe=t(l.end)),l.terminatorEnd=ko(l.end)||"",s.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(s.end?"|":"")+a.terminatorEnd)),s.illegal&&(l.illegalRe=t(s.illegal)),s.contains||(s.contains=[]),s.contains=[].concat(...s.contains.map(function(u){return EC(u==="self"?s:u)})),s.contains.forEach(function(u){o(u,l)}),s.starts&&o(s.starts,a),l.matcher=r(l),l}if(i.compilerExtensions||(i.compilerExtensions=[]),i.contains&&i.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return i.classNameAliases=ni(i.classNameAliases||{}),o(i)}function W0(i){return i?i.endsWithParent||W0(i.starts):!1}function EC(i){return i.variants&&!i.cachedVariants&&(i.cachedVariants=i.variants.map(function(t){return ni(i,{variants:null},t)})),i.cachedVariants?i.cachedVariants:W0(i)?ni(i,{starts:i.starts?ni(i.starts):null}):Object.isFrozen(i)?ni(i):i}var xC="11.11.1",Td=class extends Error{constructor(t,e){super(t),this.name="HTMLInjectionError",this.html=e}},kd=_0,I0=ni,N0=Symbol("nomatch"),SC=7,U0=function(i){let t=Object.create(null),e=Object.create(null),n=[],r=!0,o="Could not find the language '{}', did you forget to load/include a language module?",s={disableAutodetect:!0,name:"Plain text",contains:[]},a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:Md};function l(R){return a.noHighlightRe.test(R)}function c(R){let A=R.className+" ";A+=R.parentNode?R.parentNode.className:"";let C=a.languageDetectRe.exec(A);if(C){let O=k(C[1]);return O||(A0(o.replace("{}",C[1])),A0("Falling back to no-highlight mode for this block.",R)),O?C[1]:"no-highlight"}return A.split(/\s+/).find(O=>l(O)||k(O))}function u(R,A,C){let O="",H="";typeof A=="object"?(O=R,C=A.ignoreIllegals,H=A.language):(vr("10.7.0","highlight(lang, code, ...args) has been deprecated."),vr("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),H=R,O=A),C===void 0&&(C=!0);let K={code:O,language:H};N("before:highlight",K);let W=K.result?K.result:d(K.language,K.code,C);return W.code=K.code,N("after:highlight",W),W}function d(R,A,C,O){let H=Object.create(null);function K(U,B){return U.keywords[B]}function W(){if(!ne.keywords){Ie.addText(oe);return}let U=0;ne.keywordPatternRe.lastIndex=0;let B=ne.keywordPatternRe.exec(oe),T="";for(;B;){T+=oe.substring(U,B.index);let F=Ue.case_insensitive?B[0].toLowerCase():B[0],V=K(ne,F);if(V){let[j,he]=V;if(Ie.addText(T),T="",H[F]=(H[F]||0)+1,H[F]<=SC&&(ye+=he),j.startsWith("_"))T+=B[0];else{let xe=Ue.classNameAliases[j]||j;Q(B[0],xe)}}else T+=B[0];U=ne.keywordPatternRe.lastIndex,B=ne.keywordPatternRe.exec(oe)}T+=oe.substring(U),Ie.addText(T)}function te(){if(oe==="")return;let U=null;if(typeof ne.subLanguage=="string"){if(!t[ne.subLanguage]){Ie.addText(oe);return}U=d(ne.subLanguage,oe,!0,ie[ne.subLanguage]),ie[ne.subLanguage]=U._top}else U=f(oe,ne.subLanguage.length?ne.subLanguage:null);ne.relevance>0&&(ye+=U.relevance),Ie.__addSublanguage(U._emitter,U.language)}function J(){ne.subLanguage!=null?te():W(),oe=""}function Q(U,B){U!==""&&(Ie.startScope(B),Ie.addText(U),Ie.endScope())}function Ae(U,B){let T=1,F=B.length-1;for(;T<=F;){if(!U._emit[T]){T++;continue}let V=Ue.classNameAliases[U[T]]||U[T],j=B[T];V?Q(j,V):(oe=j,W(),oe=""),T++}}function $e(U,B){return U.scope&&typeof U.scope=="string"&&Ie.openNode(Ue.classNameAliases[U.scope]||U.scope),U.beginScope&&(U.beginScope._wrap?(Q(oe,Ue.classNameAliases[U.beginScope._wrap]||U.beginScope._wrap),oe=""):U.beginScope._multi&&(Ae(U.beginScope,B),oe="")),ne=Object.create(U,{parent:{value:ne}}),ne}function ke(U,B,T){let F=HT(U.endRe,T);if(F){if(U["on:end"]){let V=new Ra(U);U["on:end"](B,V),V.isMatchIgnored&&(F=!1)}if(F){for(;U.endsParent&&U.parent;)U=U.parent;return U}}if(U.endsWithParent)return ke(U.parent,B,T)}function ce(U){return ne.matcher.regexIndex===0?(oe+=U[0],1):(Lt=!0,0)}function We(U){let B=U[0],T=U.rule,F=new Ra(T),V=[T.__beforeBegin,T["on:begin"]];for(let j of V)if(j&&(j(U,F),F.isMatchIgnored))return ce(B);return T.skip?oe+=B:(T.excludeBegin&&(oe+=B),J(),!T.returnBegin&&!T.excludeBegin&&(oe=B)),$e(T,U),T.returnBegin?0:B.length}function dt(U){let B=U[0],T=A.substring(U.index),F=ke(ne,U,T);if(!F)return N0;let V=ne;ne.endScope&&ne.endScope._wrap?(J(),Q(B,ne.endScope._wrap)):ne.endScope&&ne.endScope._multi?(J(),Ae(ne.endScope,U)):V.skip?oe+=B:(V.returnEnd||V.excludeEnd||(oe+=B),J(),V.excludeEnd&&(oe=B));do ne.scope&&Ie.closeNode(),!ne.skip&&!ne.subLanguage&&(ye+=ne.relevance),ne=ne.parent;while(ne!==F.parent);return F.starts&&$e(F.starts,U),V.returnEnd?0:B.length}function Ct(){let U=[];for(let B=ne;B!==Ue;B=B.parent)B.scope&&U.unshift(B.scope);U.forEach(B=>Ie.openNode(B))}let vt={};function ht(U,B){let T=B&&B[0];if(oe+=U,T==null)return J(),0;if(vt.type==="begin"&&B.type==="end"&&vt.index===B.index&&T===""){if(oe+=A.slice(B.index,B.index+1),!r){let F=new Error(`0 width match regex (${R})`);throw F.languageName=R,F.badRule=vt.rule,F}return 1}if(vt=B,B.type==="begin")return We(B);if(B.type==="illegal"&&!C){let F=new Error('Illegal lexeme "'+T+'" for mode "'+(ne.scope||"<unnamed>")+'"');throw F.mode=ne,F}else if(B.type==="end"){let F=dt(B);if(F!==N0)return F}if(B.type==="illegal"&&T==="")return oe+=`
`,1;if(pt>1e5&&pt>B.index*3)throw new Error("potential infinite loop, way more iterations than matches");return oe+=T,T.length}let Ue=k(R);if(!Ue)throw Pi(o.replace("{}",R)),new Error('Unknown language: "'+R+'"');let Ze=vC(Ue),en="",ne=O||Ze,ie={},Ie=new a.__emitter(a);Ct();let oe="",ye=0,Qe=0,pt=0,Lt=!1;try{if(Ue.__emitTokens)Ue.__emitTokens(A,Ie);else{for(ne.matcher.considerAll();;){pt++,Lt?Lt=!1:ne.matcher.considerAll(),ne.matcher.lastIndex=Qe;let U=ne.matcher.exec(A);if(!U)break;let B=A.substring(Qe,U.index),T=ht(B,U);Qe=U.index+T}ht(A.substring(Qe))}return Ie.finalize(),en=Ie.toHTML(),{language:R,value:en,relevance:ye,illegal:!1,_emitter:Ie,_top:ne}}catch(U){if(U.message&&U.message.includes("Illegal"))return{language:R,value:kd(A),illegal:!0,relevance:0,_illegalBy:{message:U.message,index:Qe,context:A.slice(Qe-100,Qe+100),mode:U.mode,resultSoFar:en},_emitter:Ie};if(r)return{language:R,value:kd(A),illegal:!1,relevance:0,errorRaised:U,_emitter:Ie,_top:ne};throw U}}function h(R){let A={value:kd(R),illegal:!1,relevance:0,_top:s,_emitter:new a.__emitter(a)};return A._emitter.addText(R),A}function f(R,A){A=A||a.languages||Object.keys(t);let C=h(R),O=A.filter(k).filter(L).map(J=>d(J,R,!1));O.unshift(C);let H=O.sort((J,Q)=>{if(J.relevance!==Q.relevance)return Q.relevance-J.relevance;if(J.language&&Q.language){if(k(J.language).supersetOf===Q.language)return 1;if(k(Q.language).supersetOf===J.language)return-1}return 0}),[K,W]=H,te=K;return te.secondBest=W,te}function p(R,A,C){let O=A&&e[A]||C;R.classList.add("hljs"),R.classList.add(`language-${O}`)}function m(R){let A=null,C=c(R);if(l(C))return;if(N("before:highlightElement",{el:R,language:C}),R.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",R);return}if(R.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(R)),a.throwUnescapedHTML))throw new Td("One of your code blocks includes unescaped HTML.",R.innerHTML);A=R;let O=A.textContent,H=C?u(O,{language:C,ignoreIllegals:!0}):f(O);R.innerHTML=H.value,R.dataset.highlighted="yes",p(R,C,H.language),R.result={language:H.language,re:H.relevance,relevance:H.relevance},H.secondBest&&(R.secondBest={language:H.secondBest.language,relevance:H.secondBest.relevance}),N("after:highlightElement",{el:R,result:H,text:O})}function g(R){a=I0(a,R)}let b=()=>{E(),vr("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function v(){E(),vr("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let y=!1;function E(){function R(){E()}if(document.readyState==="loading"){y||window.addEventListener("DOMContentLoaded",R,!1),y=!0;return}document.querySelectorAll(a.cssSelector).forEach(m)}function x(R,A){let C=null;try{C=A(i)}catch(O){if(Pi("Language definition for '{}' could not be registered.".replace("{}",R)),r)Pi(O);else throw O;C=s}C.name||(C.name=R),t[R]=C,C.rawDefinition=A.bind(null,i),C.aliases&&M(C.aliases,{languageName:R})}function S(R){delete t[R];for(let A of Object.keys(e))e[A]===R&&delete e[A]}function w(){return Object.keys(t)}function k(R){return R=(R||"").toLowerCase(),t[R]||t[e[R]]}function M(R,{languageName:A}){typeof R=="string"&&(R=[R]),R.forEach(C=>{e[C.toLowerCase()]=A})}function L(R){let A=k(R);return A&&!A.disableAutodetect}function _(R){R["before:highlightBlock"]&&!R["before:highlightElement"]&&(R["before:highlightElement"]=A=>{R["before:highlightBlock"](Object.assign({block:A.el},A))}),R["after:highlightBlock"]&&!R["after:highlightElement"]&&(R["after:highlightElement"]=A=>{R["after:highlightBlock"](Object.assign({block:A.el},A))})}function P(R){_(R),n.push(R)}function I(R){let A=n.indexOf(R);A!==-1&&n.splice(A,1)}function N(R,A){let C=R;n.forEach(function(O){O[C]&&O[C](A)})}function D(R){return vr("10.7.0","highlightBlock will be removed entirely in v12.0"),vr("10.7.0","Please use highlightElement now."),m(R)}Object.assign(i,{highlight:u,highlightAuto:f,highlightAll:E,highlightElement:m,highlightBlock:D,configure:g,initHighlighting:b,initHighlightingOnLoad:v,registerLanguage:x,unregisterLanguage:S,listLanguages:w,getLanguage:k,registerAliases:M,autoDetection:L,inherit:I0,addPlugin:P,removePlugin:I}),i.debugMode=function(){r=!1},i.safeMode=function(){r=!0},i.versionString=xC,i.regex={concat:_i,lookahead:O0,either:Cd,optional:BT,anyNumberOfTimes:DT};for(let R in La)typeof La[R]=="object"&&P0(La[R]);return Object.assign(i,La),i},Er=U0({});Er.newInstance=()=>U0({});K0.exports=Er;Er.HighlightJS=Er;Er.default=Er});var ky=et((C3,Sy)=>{function uy(i){return i instanceof Map?i.clear=i.delete=i.set=function(){throw new Error("map is read-only")}:i instanceof Set&&(i.add=i.clear=i.delete=function(){throw new Error("set is read-only")}),Object.freeze(i),Object.getOwnPropertyNames(i).forEach(t=>{let e=i[t],n=typeof e;(n==="object"||n==="function")&&!Object.isFrozen(e)&&uy(e)}),i}var za=class{constructor(t){t.data===void 0&&(t.data={}),this.data=t.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function dy(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function ii(i,...t){let e=Object.create(null);for(let n in i)e[n]=i[n];return t.forEach(function(n){for(let r in n)e[r]=n[r]}),e}var rL="</span>",ry=i=>!!i.scope,oL=(i,{prefix:t})=>{if(i.startsWith("language:"))return i.replace("language:","language-");if(i.includes(".")){let e=i.split(".");return[`${t}${e.shift()}`,...e.map((n,r)=>`${n}${"_".repeat(r+1)}`)].join(" ")}return`${t}${i}`},Od=class{constructor(t,e){this.buffer="",this.classPrefix=e.classPrefix,t.walk(this)}addText(t){this.buffer+=dy(t)}openNode(t){if(!ry(t))return;let e=oL(t.scope,{prefix:this.classPrefix});this.span(e)}closeNode(t){ry(t)&&(this.buffer+=rL)}value(){return this.buffer}span(t){this.buffer+=`<span class="${t}">`}},oy=(i={})=>{let t={children:[]};return Object.assign(t,i),t},Mo=class{constructor(){this.rootNode=oy(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(t){this.top.children.push(t)}openNode(t){let e=oy({scope:t});this.add(e),this.stack.push(e)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(t){return this.constructor._walk(t,this.rootNode)}static _walk(t,e){return typeof e=="string"?t.addText(e):e.children&&(t.openNode(e),e.children.forEach(n=>this._walk(t,n)),t.closeNode(e)),t}static _collapse(t){typeof t!="string"&&t.children&&(t.children.every(e=>typeof e=="string")?t.children=[t.children.join("")]:t.children.forEach(e=>{Mo._collapse(e)}))}},Dd=class extends Mo{constructor(t){super(),this.options=t}addText(t){t!==""&&this.add(t)}startScope(t){this.openNode(t)}endScope(){this.closeNode()}__addSublanguage(t,e){let n=t.root;e&&(n.scope=`language:${e}`),this.add(n)}toHTML(){return new Od(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function To(i){return i?typeof i=="string"?i:i.source:null}function hy(i){return Di("(?=",i,")")}function sL(i){return Di("(?:",i,")*")}function aL(i){return Di("(?:",i,")?")}function Di(...i){return i.map(e=>To(e)).join("")}function lL(i){let t=i[i.length-1];return typeof t=="object"&&t.constructor===Object?(i.splice(i.length-1,1),t):{}}function Fd(...i){return"("+(lL(i).capture?"":"?:")+i.map(n=>To(n)).join("|")+")"}function py(i){return new RegExp(i.toString()+"|").exec("").length-1}function cL(i,t){let e=i&&i.exec(t);return e&&e.index===0}var uL=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Hd(i,{joinWith:t}){let e=0;return i.map(n=>{e+=1;let r=e,o=To(n),s="";for(;o.length>0;){let a=uL.exec(o);if(!a){s+=o;break}s+=o.substring(0,a.index),o=o.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?s+="\\"+String(Number(a[1])+r):(s+=a[0],a[0]==="("&&e++)}return s}).map(n=>`(${n})`).join(t)}var dL=/\b\B/,fy="[a-zA-Z]\\w*",zd="[a-zA-Z_]\\w*",my="\\b\\d+(\\.\\d+)?",gy="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",by="\\b(0b[01]+)",hL="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",pL=(i={})=>{let t=/^#![ ]*\//;return i.binary&&(i.begin=Di(t,/.*\b/,i.binary,/\b.*/)),ii({scope:"meta",begin:t,end:/$/,relevance:0,"on:begin":(e,n)=>{e.index!==0&&n.ignoreMatch()}},i)},Co={begin:"\\\\[\\s\\S]",relevance:0},fL={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Co]},mL={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Co]},gL={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},$a=function(i,t,e={}){let n=ii({scope:"comment",begin:i,end:t,contains:[]},e);n.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});let r=Fd("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return n.contains.push({begin:Di(/[ ]+/,"(",r,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),n},bL=$a("//","$"),yL=$a("/\\*","\\*/"),vL=$a("#","$"),EL={scope:"number",begin:my,relevance:0},xL={scope:"number",begin:gy,relevance:0},SL={scope:"number",begin:by,relevance:0},kL={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[Co,{begin:/\[/,end:/\]/,relevance:0,contains:[Co]}]}]},wL={scope:"title",begin:fy,relevance:0},ML={scope:"title",begin:zd,relevance:0},TL={begin:"\\.\\s*"+zd,relevance:0},CL=function(i){return Object.assign(i,{"on:begin":(t,e)=>{e.data._beginMatch=t[1]},"on:end":(t,e)=>{e.data._beginMatch!==t[1]&&e.ignoreMatch()}})},Ha=Object.freeze({__proto__:null,MATCH_NOTHING_RE:dL,IDENT_RE:fy,UNDERSCORE_IDENT_RE:zd,NUMBER_RE:my,C_NUMBER_RE:gy,BINARY_NUMBER_RE:by,RE_STARTERS_RE:hL,SHEBANG:pL,BACKSLASH_ESCAPE:Co,APOS_STRING_MODE:fL,QUOTE_STRING_MODE:mL,PHRASAL_WORDS_MODE:gL,COMMENT:$a,C_LINE_COMMENT_MODE:bL,C_BLOCK_COMMENT_MODE:yL,HASH_COMMENT_MODE:vL,NUMBER_MODE:EL,C_NUMBER_MODE:xL,BINARY_NUMBER_MODE:SL,REGEXP_MODE:kL,TITLE_MODE:wL,UNDERSCORE_TITLE_MODE:ML,METHOD_GUARD:TL,END_SAME_AS_BEGIN:CL});function LL(i,t){i.input[i.index-1]==="."&&t.ignoreMatch()}function RL(i,t){i.className!==void 0&&(i.scope=i.className,delete i.className)}function AL(i,t){t&&i.beginKeywords&&(i.begin="\\b("+i.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",i.__beforeBegin=LL,i.keywords=i.keywords||i.beginKeywords,delete i.beginKeywords,i.relevance===void 0&&(i.relevance=0))}function IL(i,t){Array.isArray(i.illegal)&&(i.illegal=Fd(...i.illegal))}function NL(i,t){if(i.match){if(i.begin||i.end)throw new Error("begin & end are not supported with match");i.begin=i.match,delete i.match}}function PL(i,t){i.relevance===void 0&&(i.relevance=1)}var _L=(i,t)=>{if(!i.beforeMatch)return;if(i.starts)throw new Error("beforeMatch cannot be used with starts");let e=Object.assign({},i);Object.keys(i).forEach(n=>{delete i[n]}),i.keywords=e.keywords,i.begin=Di(e.beforeMatch,hy(e.begin)),i.starts={relevance:0,contains:[Object.assign(e,{endsParent:!0})]},i.relevance=0,delete e.beforeMatch},OL=["of","and","for","in","not","or","if","then","parent","list","value"],DL="keyword";function yy(i,t,e=DL){let n=Object.create(null);return typeof i=="string"?r(e,i.split(" ")):Array.isArray(i)?r(e,i):Object.keys(i).forEach(function(o){Object.assign(n,yy(i[o],t,o))}),n;function r(o,s){t&&(s=s.map(a=>a.toLowerCase())),s.forEach(function(a){let l=a.split("|");n[l[0]]=[o,BL(l[0],l[1])]})}}function BL(i,t){return t?Number(t):FL(i)?0:1}function FL(i){return OL.includes(i.toLowerCase())}var sy={},Oi=i=>{console.error(i)},ay=(i,...t)=>{console.log(`WARN: ${i}`,...t)},kr=(i,t)=>{sy[`${i}/${t}`]||(console.log(`Deprecated as of ${i}. ${t}`),sy[`${i}/${t}`]=!0)},Va=new Error;function vy(i,t,{key:e}){let n=0,r=i[e],o={},s={};for(let a=1;a<=t.length;a++)s[a+n]=r[a],o[a+n]=!0,n+=py(t[a-1]);i[e]=s,i[e]._emit=o,i[e]._multi=!0}function HL(i){if(Array.isArray(i.begin)){if(i.skip||i.excludeBegin||i.returnBegin)throw Oi("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Va;if(typeof i.beginScope!="object"||i.beginScope===null)throw Oi("beginScope must be object"),Va;vy(i,i.begin,{key:"beginScope"}),i.begin=Hd(i.begin,{joinWith:""})}}function zL(i){if(Array.isArray(i.end)){if(i.skip||i.excludeEnd||i.returnEnd)throw Oi("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Va;if(typeof i.endScope!="object"||i.endScope===null)throw Oi("endScope must be object"),Va;vy(i,i.end,{key:"endScope"}),i.end=Hd(i.end,{joinWith:""})}}function VL(i){i.scope&&typeof i.scope=="object"&&i.scope!==null&&(i.beginScope=i.scope,delete i.scope)}function $L(i){VL(i),typeof i.beginScope=="string"&&(i.beginScope={_wrap:i.beginScope}),typeof i.endScope=="string"&&(i.endScope={_wrap:i.endScope}),HL(i),zL(i)}function WL(i){function t(s,a){return new RegExp(To(s),"m"+(i.case_insensitive?"i":"")+(i.unicodeRegex?"u":"")+(a?"g":""))}class e{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=py(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);let a=this.regexes.map(l=>l[1]);this.matcherRe=t(Hd(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;let l=this.matcherRe.exec(a);if(!l)return null;let c=l.findIndex((d,h)=>h>0&&d!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class n{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];let l=new e;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){let l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){let u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function r(s){let a=new n;return s.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),s.terminatorEnd&&a.addRule(s.terminatorEnd,{type:"end"}),s.illegal&&a.addRule(s.illegal,{type:"illegal"}),a}function o(s,a){let l=s;if(s.isCompiled)return l;[RL,NL,$L,_L].forEach(u=>u(s,a)),i.compilerExtensions.forEach(u=>u(s,a)),s.__beforeBegin=null,[AL,IL,PL].forEach(u=>u(s,a)),s.isCompiled=!0;let c=null;return typeof s.keywords=="object"&&s.keywords.$pattern&&(s.keywords=Object.assign({},s.keywords),c=s.keywords.$pattern,delete s.keywords.$pattern),c=c||/\w+/,s.keywords&&(s.keywords=yy(s.keywords,i.case_insensitive)),l.keywordPatternRe=t(c,!0),a&&(s.begin||(s.begin=/\B|\b/),l.beginRe=t(l.begin),!s.end&&!s.endsWithParent&&(s.end=/\B|\b/),s.end&&(l.endRe=t(l.end)),l.terminatorEnd=To(l.end)||"",s.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(s.end?"|":"")+a.terminatorEnd)),s.illegal&&(l.illegalRe=t(s.illegal)),s.contains||(s.contains=[]),s.contains=[].concat(...s.contains.map(function(u){return UL(u==="self"?s:u)})),s.contains.forEach(function(u){o(u,l)}),s.starts&&o(s.starts,a),l.matcher=r(l),l}if(i.compilerExtensions||(i.compilerExtensions=[]),i.contains&&i.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return i.classNameAliases=ii(i.classNameAliases||{}),o(i)}function Ey(i){return i?i.endsWithParent||Ey(i.starts):!1}function UL(i){return i.variants&&!i.cachedVariants&&(i.cachedVariants=i.variants.map(function(t){return ii(i,{variants:null},t)})),i.cachedVariants?i.cachedVariants:Ey(i)?ii(i,{starts:i.starts?ii(i.starts):null}):Object.isFrozen(i)?ii(i):i}var KL="11.8.0",Bd=class extends Error{constructor(t,e){super(t),this.name="HTMLInjectionError",this.html=e}},_d=dy,ly=ii,cy=Symbol("nomatch"),qL=7,xy=function(i){let t=Object.create(null),e=Object.create(null),n=[],r=!0,o="Could not find the language '{}', did you forget to load/include a language module?",s={disableAutodetect:!0,name:"Plain text",contains:[]},a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:Dd};function l(A){return a.noHighlightRe.test(A)}function c(A){let C=A.className+" ";C+=A.parentNode?A.parentNode.className:"";let O=a.languageDetectRe.exec(C);if(O){let H=M(O[1]);return H||(ay(o.replace("{}",O[1])),ay("Falling back to no-highlight mode for this block.",A)),H?O[1]:"no-highlight"}return C.split(/\s+/).find(H=>l(H)||M(H))}function u(A,C,O){let H="",K="";typeof C=="object"?(H=A,O=C.ignoreIllegals,K=C.language):(kr("10.7.0","highlight(lang, code, ...args) has been deprecated."),kr("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),K=A,H=C),O===void 0&&(O=!0);let W={code:H,language:K};D("before:highlight",W);let te=W.result?W.result:d(W.language,W.code,O);return te.code=W.code,D("after:highlight",te),te}function d(A,C,O,H){let K=Object.create(null);function W(B,T){return B.keywords[T]}function te(){if(!ie.keywords){oe.addText(ye);return}let B=0;ie.keywordPatternRe.lastIndex=0;let T=ie.keywordPatternRe.exec(ye),F="";for(;T;){F+=ye.substring(B,T.index);let V=Ze.case_insensitive?T[0].toLowerCase():T[0],j=W(ie,V);if(j){let[he,xe]=j;if(oe.addText(F),F="",K[V]=(K[V]||0)+1,K[V]<=qL&&(Qe+=xe),he.startsWith("_"))F+=T[0];else{let Ce=Ze.classNameAliases[he]||he;Ae(T[0],Ce)}}else F+=T[0];B=ie.keywordPatternRe.lastIndex,T=ie.keywordPatternRe.exec(ye)}F+=ye.substring(B),oe.addText(F)}function J(){if(ye==="")return;let B=null;if(typeof ie.subLanguage=="string"){if(!t[ie.subLanguage]){oe.addText(ye);return}B=d(ie.subLanguage,ye,!0,Ie[ie.subLanguage]),Ie[ie.subLanguage]=B._top}else B=f(ye,ie.subLanguage.length?ie.subLanguage:null);ie.relevance>0&&(Qe+=B.relevance),oe.__addSublanguage(B._emitter,B.language)}function Q(){ie.subLanguage!=null?J():te(),ye=""}function Ae(B,T){B!==""&&(oe.startScope(T),oe.addText(B),oe.endScope())}function $e(B,T){let F=1,V=T.length-1;for(;F<=V;){if(!B._emit[F]){F++;continue}let j=Ze.classNameAliases[B[F]]||B[F],he=T[F];j?Ae(he,j):(ye=he,te(),ye=""),F++}}function ke(B,T){return B.scope&&typeof B.scope=="string"&&oe.openNode(Ze.classNameAliases[B.scope]||B.scope),B.beginScope&&(B.beginScope._wrap?(Ae(ye,Ze.classNameAliases[B.beginScope._wrap]||B.beginScope._wrap),ye=""):B.beginScope._multi&&($e(B.beginScope,T),ye="")),ie=Object.create(B,{parent:{value:ie}}),ie}function ce(B,T,F){let V=cL(B.endRe,F);if(V){if(B["on:end"]){let j=new za(B);B["on:end"](T,j),j.isMatchIgnored&&(V=!1)}if(V){for(;B.endsParent&&B.parent;)B=B.parent;return B}}if(B.endsWithParent)return ce(B.parent,T,F)}function We(B){return ie.matcher.regexIndex===0?(ye+=B[0],1):(U=!0,0)}function dt(B){let T=B[0],F=B.rule,V=new za(F),j=[F.__beforeBegin,F["on:begin"]];for(let he of j)if(he&&(he(B,V),V.isMatchIgnored))return We(T);return F.skip?ye+=T:(F.excludeBegin&&(ye+=T),Q(),!F.returnBegin&&!F.excludeBegin&&(ye=T)),ke(F,B),F.returnBegin?0:T.length}function Ct(B){let T=B[0],F=C.substring(B.index),V=ce(ie,B,F);if(!V)return cy;let j=ie;ie.endScope&&ie.endScope._wrap?(Q(),Ae(T,ie.endScope._wrap)):ie.endScope&&ie.endScope._multi?(Q(),$e(ie.endScope,B)):j.skip?ye+=T:(j.returnEnd||j.excludeEnd||(ye+=T),Q(),j.excludeEnd&&(ye=T));do ie.scope&&oe.closeNode(),!ie.skip&&!ie.subLanguage&&(Qe+=ie.relevance),ie=ie.parent;while(ie!==V.parent);return V.starts&&ke(V.starts,B),j.returnEnd?0:T.length}function vt(){let B=[];for(let T=ie;T!==Ze;T=T.parent)T.scope&&B.unshift(T.scope);B.forEach(T=>oe.openNode(T))}let ht={};function Ue(B,T){let F=T&&T[0];if(ye+=B,F==null)return Q(),0;if(ht.type==="begin"&&T.type==="end"&&ht.index===T.index&&F===""){if(ye+=C.slice(T.index,T.index+1),!r){let V=new Error(`0 width match regex (${A})`);throw V.languageName=A,V.badRule=ht.rule,V}return 1}if(ht=T,T.type==="begin")return dt(T);if(T.type==="illegal"&&!O){let V=new Error('Illegal lexeme "'+F+'" for mode "'+(ie.scope||"<unnamed>")+'"');throw V.mode=ie,V}else if(T.type==="end"){let V=Ct(T);if(V!==cy)return V}if(T.type==="illegal"&&F==="")return 1;if(Lt>1e5&&Lt>T.index*3)throw new Error("potential infinite loop, way more iterations than matches");return ye+=F,F.length}let Ze=M(A);if(!Ze)throw Oi(o.replace("{}",A)),new Error('Unknown language: "'+A+'"');let en=WL(Ze),ne="",ie=H||en,Ie={},oe=new a.__emitter(a);vt();let ye="",Qe=0,pt=0,Lt=0,U=!1;try{if(Ze.__emitTokens)Ze.__emitTokens(C,oe);else{for(ie.matcher.considerAll();;){Lt++,U?U=!1:ie.matcher.considerAll(),ie.matcher.lastIndex=pt;let B=ie.matcher.exec(C);if(!B)break;let T=C.substring(pt,B.index),F=Ue(T,B);pt=B.index+F}Ue(C.substring(pt))}return oe.finalize(),ne=oe.toHTML(),{language:A,value:ne,relevance:Qe,illegal:!1,_emitter:oe,_top:ie}}catch(B){if(B.message&&B.message.includes("Illegal"))return{language:A,value:_d(C),illegal:!0,relevance:0,_illegalBy:{message:B.message,index:pt,context:C.slice(pt-100,pt+100),mode:B.mode,resultSoFar:ne},_emitter:oe};if(r)return{language:A,value:_d(C),illegal:!1,relevance:0,errorRaised:B,_emitter:oe,_top:ie};throw B}}function h(A){let C={value:_d(A),illegal:!1,relevance:0,_top:s,_emitter:new a.__emitter(a)};return C._emitter.addText(A),C}function f(A,C){C=C||a.languages||Object.keys(t);let O=h(A),H=C.filter(M).filter(_).map(Q=>d(Q,A,!1));H.unshift(O);let K=H.sort((Q,Ae)=>{if(Q.relevance!==Ae.relevance)return Ae.relevance-Q.relevance;if(Q.language&&Ae.language){if(M(Q.language).supersetOf===Ae.language)return 1;if(M(Ae.language).supersetOf===Q.language)return-1}return 0}),[W,te]=K,J=W;return J.secondBest=te,J}function p(A,C,O){let H=C&&e[C]||O;A.classList.add("hljs"),A.classList.add(`language-${H}`)}function m(A){let C=null,O=c(A);if(l(O))return;if(D("before:highlightElement",{el:A,language:O}),A.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(A)),a.throwUnescapedHTML))throw new Bd("One of your code blocks includes unescaped HTML.",A.innerHTML);C=A;let H=C.textContent,K=O?u(H,{language:O,ignoreIllegals:!0}):f(H);A.innerHTML=K.value,p(A,O,K.language),A.result={language:K.language,re:K.relevance,relevance:K.relevance},K.secondBest&&(A.secondBest={language:K.secondBest.language,relevance:K.secondBest.relevance}),D("after:highlightElement",{el:A,result:K,text:H})}function g(A){a=ly(a,A)}let b=()=>{E(),kr("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function v(){E(),kr("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let y=!1;function E(){if(document.readyState==="loading"){y=!0;return}document.querySelectorAll(a.cssSelector).forEach(m)}function x(){y&&E()}typeof window!="undefined"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",x,!1);function S(A,C){let O=null;try{O=C(i)}catch(H){if(Oi("Language definition for '{}' could not be registered.".replace("{}",A)),r)Oi(H);else throw H;O=s}O.name||(O.name=A),t[A]=O,O.rawDefinition=C.bind(null,i),O.aliases&&L(O.aliases,{languageName:A})}function w(A){delete t[A];for(let C of Object.keys(e))e[C]===A&&delete e[C]}function k(){return Object.keys(t)}function M(A){return A=(A||"").toLowerCase(),t[A]||t[e[A]]}function L(A,{languageName:C}){typeof A=="string"&&(A=[A]),A.forEach(O=>{e[O.toLowerCase()]=C})}function _(A){let C=M(A);return C&&!C.disableAutodetect}function P(A){A["before:highlightBlock"]&&!A["before:highlightElement"]&&(A["before:highlightElement"]=C=>{A["before:highlightBlock"](Object.assign({block:C.el},C))}),A["after:highlightBlock"]&&!A["after:highlightElement"]&&(A["after:highlightElement"]=C=>{A["after:highlightBlock"](Object.assign({block:C.el},C))})}function I(A){P(A),n.push(A)}function N(A){let C=n.indexOf(A);C!==-1&&n.splice(C,1)}function D(A,C){let O=A;n.forEach(function(H){H[O]&&H[O](C)})}function R(A){return kr("10.7.0","highlightBlock will be removed entirely in v12.0"),kr("10.7.0","Please use highlightElement now."),m(A)}Object.assign(i,{highlight:u,highlightAuto:f,highlightAll:E,highlightElement:m,highlightBlock:R,configure:g,initHighlighting:b,initHighlightingOnLoad:v,registerLanguage:S,unregisterLanguage:w,listLanguages:k,getLanguage:M,registerAliases:L,autoDetection:_,inherit:ly,addPlugin:I,removePlugin:N}),i.debugMode=function(){r=!1},i.safeMode=function(){r=!0},i.versionString=KL,i.regex={concat:Di,lookahead:hy,either:Fd,optional:aL,anyNumberOfTimes:sL};for(let A in Ha)typeof Ha[A]=="object"&&uy(Ha[A]);return Object.assign(i,Ha),i},wr=xy({});wr.newInstance=()=>xy({});Sy.exports=wr;wr.HighlightJS=wr;wr.default=wr});var My=et((R3,Vd)=>{(function(){var i;typeof Vd!="undefined"?i=Vd.exports=n:i=function(){return this||(0,eval)("this")}(),i.format=n,i.vsprintf=e,typeof console!="undefined"&&typeof console.log=="function"&&(i.printf=t);function t(){console.log(n.apply(null,arguments))}function e(r,o){return n.apply(null,[r].concat(o))}function n(r){for(var o=1,s=[].slice.call(arguments),a=0,l=r.length,c="",u,d=!1,h,f,p=!1,m,g=function(){return s[o++]},b=function(){for(var v="";/\d/.test(r[a]);)v+=r[a++],u=r[a];return v.length>0?parseInt(v):null};a<l;++a)if(u=r[a],d)switch(d=!1,u=="."?(p=!1,u=r[++a]):u=="0"&&r[a+1]=="."?(p=!0,a+=2,u=r[a]):p=!0,m=b(),u){case"b":c+=parseInt(g(),10).toString(2);break;case"c":h=g(),typeof h=="string"||h instanceof String?c+=h:c+=String.fromCharCode(parseInt(h,10));break;case"d":c+=parseInt(g(),10);break;case"f":f=String(parseFloat(g()).toFixed(m||6)),c+=p?f:f.replace(/^0/,"");break;case"j":c+=JSON.stringify(g());break;case"o":c+="0"+parseInt(g(),10).toString(8);break;case"s":c+=g();break;case"x":c+="0x"+parseInt(g(),10).toString(16);break;case"X":c+="0x"+parseInt(g(),10).toString(16).toUpperCase();break;default:c+=u;break}else u==="%"?d=!0:c+=u;return c}})()});var Jy=et(Io=>{"use strict";var Uy={};function aR(i){let t=Uy[i];if(t)return t;t=Uy[i]=[];for(let e=0;e<128;e++){let n=String.fromCharCode(e);t.push(n)}for(let e=0;e<i.length;e++){let n=i.charCodeAt(e);t[n]="%"+("0"+n.toString(16).toUpperCase()).slice(-2)}return t}function ja(i,t){typeof t!="string"&&(t=ja.defaultChars);let e=aR(t);return i.replace(/(%[a-f0-9]{2})+/gi,function(n){let r="";for(let o=0,s=n.length;o<s;o+=3){let a=parseInt(n.slice(o+1,o+3),16);if(a<128){r+=e[a];continue}if((a&224)===192&&o+3<s){let l=parseInt(n.slice(o+4,o+6),16);if((l&192)===128){let c=a<<6&1984|l&63;c<128?r+="\uFFFD\uFFFD":r+=String.fromCharCode(c),o+=3;continue}}if((a&240)===224&&o+6<s){let l=parseInt(n.slice(o+4,o+6),16),c=parseInt(n.slice(o+7,o+9),16);if((l&192)===128&&(c&192)===128){let u=a<<12&61440|l<<6&4032|c&63;u<2048||u>=55296&&u<=57343?r+="\uFFFD\uFFFD\uFFFD":r+=String.fromCharCode(u),o+=6;continue}}if((a&248)===240&&o+9<s){let l=parseInt(n.slice(o+4,o+6),16),c=parseInt(n.slice(o+7,o+9),16),u=parseInt(n.slice(o+10,o+12),16);if((l&192)===128&&(c&192)===128&&(u&192)===128){let d=a<<18&1835008|l<<12&258048|c<<6&4032|u&63;d<65536||d>1114111?r+="\uFFFD\uFFFD\uFFFD\uFFFD":(d-=65536,r+=String.fromCharCode(55296+(d>>10),56320+(d&1023))),o+=9;continue}}r+="\uFFFD"}return r})}ja.defaultChars=";/?:@&=+$,#";ja.componentChars="";var Ky={};function lR(i){let t=Ky[i];if(t)return t;t=Ky[i]=[];for(let e=0;e<128;e++){let n=String.fromCharCode(e);/^[0-9a-z]$/i.test(n)?t.push(n):t.push("%"+("0"+e.toString(16).toUpperCase()).slice(-2))}for(let e=0;e<i.length;e++)t[i.charCodeAt(e)]=i[e];return t}function Ya(i,t,e){typeof t!="string"&&(e=t,t=Ya.defaultChars),typeof e=="undefined"&&(e=!0);let n=lR(t),r="";for(let o=0,s=i.length;o<s;o++){let a=i.charCodeAt(o);if(e&&a===37&&o+2<s&&/^[0-9a-f]{2}$/i.test(i.slice(o+1,o+3))){r+=i.slice(o,o+3),o+=2;continue}if(a<128){r+=n[a];continue}if(a>=55296&&a<=57343){if(a>=55296&&a<=56319&&o+1<s){let l=i.charCodeAt(o+1);if(l>=56320&&l<=57343){r+=encodeURIComponent(i[o]+i[o+1]),o++;continue}}r+="%EF%BF%BD";continue}r+=encodeURIComponent(i[o])}return r}Ya.defaultChars=";/?:@&=+$,-_.!~*'()#";Ya.componentChars="-_.!~*'()";function cR(i){let t="";return t+=i.protocol||"",t+=i.slashes?"//":"",t+=i.auth?i.auth+"@":"",i.hostname&&i.hostname.indexOf(":")!==-1?t+="["+i.hostname+"]":t+=i.hostname||"",t+=i.port?":"+i.port:"",t+=i.pathname||"",t+=i.search||"",t+=i.hash||"",t}function Ga(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}var uR=/^([a-z0-9.+-]+:)/i,dR=/:[0-9]*$/,hR=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,pR=["<",">",'"',"`"," ","\r",`
`,"	"],fR=["{","}","|","\\","^","`"].concat(pR),mR=["'"].concat(fR),qy=["%","/","?",";","#"].concat(mR),Gy=["/","?","#"],gR=255,jy=/^[+a-z0-9A-Z_-]{0,63}$/,bR=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Yy={javascript:!0,"javascript:":!0},Xy={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function yR(i,t){if(i&&i instanceof Ga)return i;let e=new Ga;return e.parse(i,t),e}Ga.prototype.parse=function(i,t){let e,n,r,o=i;if(o=o.trim(),!t&&i.split("#").length===1){let c=hR.exec(o);if(c)return this.pathname=c[1],c[2]&&(this.search=c[2]),this}let s=uR.exec(o);if(s&&(s=s[0],e=s.toLowerCase(),this.protocol=s,o=o.substr(s.length)),(t||s||o.match(/^\/\/[^@\/]+@[^@\/]+/))&&(r=o.substr(0,2)==="//",r&&!(s&&Yy[s])&&(o=o.substr(2),this.slashes=!0)),!Yy[s]&&(r||s&&!Xy[s])){let c=-1;for(let p=0;p<Gy.length;p++)n=o.indexOf(Gy[p]),n!==-1&&(c===-1||n<c)&&(c=n);let u,d;c===-1?d=o.lastIndexOf("@"):d=o.lastIndexOf("@",c),d!==-1&&(u=o.slice(0,d),o=o.slice(d+1),this.auth=u),c=-1;for(let p=0;p<qy.length;p++)n=o.indexOf(qy[p]),n!==-1&&(c===-1||n<c)&&(c=n);c===-1&&(c=o.length),o[c-1]===":"&&c--;let h=o.slice(0,c);o=o.slice(c),this.parseHost(h),this.hostname=this.hostname||"";let f=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!f){let p=this.hostname.split(/\./);for(let m=0,g=p.length;m<g;m++){let b=p[m];if(b&&!b.match(jy)){let v="";for(let y=0,E=b.length;y<E;y++)b.charCodeAt(y)>127?v+="x":v+=b[y];if(!v.match(jy)){let y=p.slice(0,m),E=p.slice(m+1),x=b.match(bR);x&&(y.push(x[1]),E.unshift(x[2])),E.length&&(o=E.join(".")+o),this.hostname=y.join(".");break}}}}this.hostname.length>gR&&(this.hostname=""),f&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}let a=o.indexOf("#");a!==-1&&(this.hash=o.substr(a),o=o.slice(0,a));let l=o.indexOf("?");return l!==-1&&(this.search=o.substr(l),o=o.slice(0,l)),o&&(this.pathname=o),Xy[e]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Ga.prototype.parseHost=function(i){let t=dR.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};Io.decode=ja;Io.encode=Ya;Io.format=cR;Io.parse=yR});var Kd=et(Fi=>{"use strict";var vR=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,ER=/[\0-\x1F\x7F-\x9F]/,xR=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,SR=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,kR=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,wR=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;Fi.Any=vR;Fi.Cc=ER;Fi.Cf=xR;Fi.P=SR;Fi.S=kR;Fi.Z=wR});var Zy=et(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.default=new Uint16Array('\u1D41<\xD5\u0131\u028A\u049D\u057B\u05D0\u0675\u06DE\u07A2\u07D6\u080F\u0A4A\u0A91\u0DA1\u0E6D\u0F09\u0F26\u10CA\u1228\u12E1\u1415\u149D\u14C3\u14DF\u1525\0\0\0\0\0\0\u156B\u16CD\u198D\u1C12\u1DDD\u1F7E\u2060\u21B0\u228D\u23C0\u23FB\u2442\u2824\u2912\u2D08\u2E48\u2FCE\u3016\u32BA\u3639\u37AC\u38FE\u3A28\u3A71\u3AE0\u3B2E\u0800EMabcfglmnoprstu\\bfms\x7F\x84\x8B\x90\x95\x98\xA6\xB3\xB9\xC8\xCFlig\u803B\xC6\u40C6P\u803B&\u4026cute\u803B\xC1\u40C1reve;\u4102\u0100iyx}rc\u803B\xC2\u40C2;\u4410r;\uC000\u{1D504}rave\u803B\xC0\u40C0pha;\u4391acr;\u4100d;\u6A53\u0100gp\x9D\xA1on;\u4104f;\uC000\u{1D538}plyFunction;\u6061ing\u803B\xC5\u40C5\u0100cs\xBE\xC3r;\uC000\u{1D49C}ign;\u6254ilde\u803B\xC3\u40C3ml\u803B\xC4\u40C4\u0400aceforsu\xE5\xFB\xFE\u0117\u011C\u0122\u0127\u012A\u0100cr\xEA\xF2kslash;\u6216\u0176\xF6\xF8;\u6AE7ed;\u6306y;\u4411\u0180crt\u0105\u010B\u0114ause;\u6235noullis;\u612Ca;\u4392r;\uC000\u{1D505}pf;\uC000\u{1D539}eve;\u42D8c\xF2\u0113mpeq;\u624E\u0700HOacdefhilorsu\u014D\u0151\u0156\u0180\u019E\u01A2\u01B5\u01B7\u01BA\u01DC\u0215\u0273\u0278\u027Ecy;\u4427PY\u803B\xA9\u40A9\u0180cpy\u015D\u0162\u017Aute;\u4106\u0100;i\u0167\u0168\u62D2talDifferentialD;\u6145leys;\u612D\u0200aeio\u0189\u018E\u0194\u0198ron;\u410Cdil\u803B\xC7\u40C7rc;\u4108nint;\u6230ot;\u410A\u0100dn\u01A7\u01ADilla;\u40B8terDot;\u40B7\xF2\u017Fi;\u43A7rcle\u0200DMPT\u01C7\u01CB\u01D1\u01D6ot;\u6299inus;\u6296lus;\u6295imes;\u6297o\u0100cs\u01E2\u01F8kwiseContourIntegral;\u6232eCurly\u0100DQ\u0203\u020FoubleQuote;\u601Duote;\u6019\u0200lnpu\u021E\u0228\u0247\u0255on\u0100;e\u0225\u0226\u6237;\u6A74\u0180git\u022F\u0236\u023Aruent;\u6261nt;\u622FourIntegral;\u622E\u0100fr\u024C\u024E;\u6102oduct;\u6210nterClockwiseContourIntegral;\u6233oss;\u6A2Fcr;\uC000\u{1D49E}p\u0100;C\u0284\u0285\u62D3ap;\u624D\u0580DJSZacefios\u02A0\u02AC\u02B0\u02B4\u02B8\u02CB\u02D7\u02E1\u02E6\u0333\u048D\u0100;o\u0179\u02A5trahd;\u6911cy;\u4402cy;\u4405cy;\u440F\u0180grs\u02BF\u02C4\u02C7ger;\u6021r;\u61A1hv;\u6AE4\u0100ay\u02D0\u02D5ron;\u410E;\u4414l\u0100;t\u02DD\u02DE\u6207a;\u4394r;\uC000\u{1D507}\u0100af\u02EB\u0327\u0100cm\u02F0\u0322ritical\u0200ADGT\u0300\u0306\u0316\u031Ccute;\u40B4o\u0174\u030B\u030D;\u42D9bleAcute;\u42DDrave;\u4060ilde;\u42DCond;\u62C4ferentialD;\u6146\u0470\u033D\0\0\0\u0342\u0354\0\u0405f;\uC000\u{1D53B}\u0180;DE\u0348\u0349\u034D\u40A8ot;\u60DCqual;\u6250ble\u0300CDLRUV\u0363\u0372\u0382\u03CF\u03E2\u03F8ontourIntegra\xEC\u0239o\u0274\u0379\0\0\u037B\xBB\u0349nArrow;\u61D3\u0100eo\u0387\u03A4ft\u0180ART\u0390\u0396\u03A1rrow;\u61D0ightArrow;\u61D4e\xE5\u02CAng\u0100LR\u03AB\u03C4eft\u0100AR\u03B3\u03B9rrow;\u67F8ightArrow;\u67FAightArrow;\u67F9ight\u0100AT\u03D8\u03DErrow;\u61D2ee;\u62A8p\u0241\u03E9\0\0\u03EFrrow;\u61D1ownArrow;\u61D5erticalBar;\u6225n\u0300ABLRTa\u0412\u042A\u0430\u045E\u047F\u037Crrow\u0180;BU\u041D\u041E\u0422\u6193ar;\u6913pArrow;\u61F5reve;\u4311eft\u02D2\u043A\0\u0446\0\u0450ightVector;\u6950eeVector;\u695Eector\u0100;B\u0459\u045A\u61BDar;\u6956ight\u01D4\u0467\0\u0471eeVector;\u695Fector\u0100;B\u047A\u047B\u61C1ar;\u6957ee\u0100;A\u0486\u0487\u62A4rrow;\u61A7\u0100ct\u0492\u0497r;\uC000\u{1D49F}rok;\u4110\u0800NTacdfglmopqstux\u04BD\u04C0\u04C4\u04CB\u04DE\u04E2\u04E7\u04EE\u04F5\u0521\u052F\u0536\u0552\u055D\u0560\u0565G;\u414AH\u803B\xD0\u40D0cute\u803B\xC9\u40C9\u0180aiy\u04D2\u04D7\u04DCron;\u411Arc\u803B\xCA\u40CA;\u442Dot;\u4116r;\uC000\u{1D508}rave\u803B\xC8\u40C8ement;\u6208\u0100ap\u04FA\u04FEcr;\u4112ty\u0253\u0506\0\0\u0512mallSquare;\u65FBerySmallSquare;\u65AB\u0100gp\u0526\u052Aon;\u4118f;\uC000\u{1D53C}silon;\u4395u\u0100ai\u053C\u0549l\u0100;T\u0542\u0543\u6A75ilde;\u6242librium;\u61CC\u0100ci\u0557\u055Ar;\u6130m;\u6A73a;\u4397ml\u803B\xCB\u40CB\u0100ip\u056A\u056Fsts;\u6203onentialE;\u6147\u0280cfios\u0585\u0588\u058D\u05B2\u05CCy;\u4424r;\uC000\u{1D509}lled\u0253\u0597\0\0\u05A3mallSquare;\u65FCerySmallSquare;\u65AA\u0370\u05BA\0\u05BF\0\0\u05C4f;\uC000\u{1D53D}All;\u6200riertrf;\u6131c\xF2\u05CB\u0600JTabcdfgorst\u05E8\u05EC\u05EF\u05FA\u0600\u0612\u0616\u061B\u061D\u0623\u066C\u0672cy;\u4403\u803B>\u403Emma\u0100;d\u05F7\u05F8\u4393;\u43DCreve;\u411E\u0180eiy\u0607\u060C\u0610dil;\u4122rc;\u411C;\u4413ot;\u4120r;\uC000\u{1D50A};\u62D9pf;\uC000\u{1D53E}eater\u0300EFGLST\u0635\u0644\u064E\u0656\u065B\u0666qual\u0100;L\u063E\u063F\u6265ess;\u62DBullEqual;\u6267reater;\u6AA2ess;\u6277lantEqual;\u6A7Eilde;\u6273cr;\uC000\u{1D4A2};\u626B\u0400Aacfiosu\u0685\u068B\u0696\u069B\u069E\u06AA\u06BE\u06CARDcy;\u442A\u0100ct\u0690\u0694ek;\u42C7;\u405Eirc;\u4124r;\u610ClbertSpace;\u610B\u01F0\u06AF\0\u06B2f;\u610DizontalLine;\u6500\u0100ct\u06C3\u06C5\xF2\u06A9rok;\u4126mp\u0144\u06D0\u06D8ownHum\xF0\u012Fqual;\u624F\u0700EJOacdfgmnostu\u06FA\u06FE\u0703\u0707\u070E\u071A\u071E\u0721\u0728\u0744\u0778\u078B\u078F\u0795cy;\u4415lig;\u4132cy;\u4401cute\u803B\xCD\u40CD\u0100iy\u0713\u0718rc\u803B\xCE\u40CE;\u4418ot;\u4130r;\u6111rave\u803B\xCC\u40CC\u0180;ap\u0720\u072F\u073F\u0100cg\u0734\u0737r;\u412AinaryI;\u6148lie\xF3\u03DD\u01F4\u0749\0\u0762\u0100;e\u074D\u074E\u622C\u0100gr\u0753\u0758ral;\u622Bsection;\u62C2isible\u0100CT\u076C\u0772omma;\u6063imes;\u6062\u0180gpt\u077F\u0783\u0788on;\u412Ef;\uC000\u{1D540}a;\u4399cr;\u6110ilde;\u4128\u01EB\u079A\0\u079Ecy;\u4406l\u803B\xCF\u40CF\u0280cfosu\u07AC\u07B7\u07BC\u07C2\u07D0\u0100iy\u07B1\u07B5rc;\u4134;\u4419r;\uC000\u{1D50D}pf;\uC000\u{1D541}\u01E3\u07C7\0\u07CCr;\uC000\u{1D4A5}rcy;\u4408kcy;\u4404\u0380HJacfos\u07E4\u07E8\u07EC\u07F1\u07FD\u0802\u0808cy;\u4425cy;\u440Cppa;\u439A\u0100ey\u07F6\u07FBdil;\u4136;\u441Ar;\uC000\u{1D50E}pf;\uC000\u{1D542}cr;\uC000\u{1D4A6}\u0580JTaceflmost\u0825\u0829\u082C\u0850\u0863\u09B3\u09B8\u09C7\u09CD\u0A37\u0A47cy;\u4409\u803B<\u403C\u0280cmnpr\u0837\u083C\u0841\u0844\u084Dute;\u4139bda;\u439Bg;\u67EAlacetrf;\u6112r;\u619E\u0180aey\u0857\u085C\u0861ron;\u413Ddil;\u413B;\u441B\u0100fs\u0868\u0970t\u0500ACDFRTUVar\u087E\u08A9\u08B1\u08E0\u08E6\u08FC\u092F\u095B\u0390\u096A\u0100nr\u0883\u088FgleBracket;\u67E8row\u0180;BR\u0899\u089A\u089E\u6190ar;\u61E4ightArrow;\u61C6eiling;\u6308o\u01F5\u08B7\0\u08C3bleBracket;\u67E6n\u01D4\u08C8\0\u08D2eeVector;\u6961ector\u0100;B\u08DB\u08DC\u61C3ar;\u6959loor;\u630Aight\u0100AV\u08EF\u08F5rrow;\u6194ector;\u694E\u0100er\u0901\u0917e\u0180;AV\u0909\u090A\u0910\u62A3rrow;\u61A4ector;\u695Aiangle\u0180;BE\u0924\u0925\u0929\u62B2ar;\u69CFqual;\u62B4p\u0180DTV\u0937\u0942\u094CownVector;\u6951eeVector;\u6960ector\u0100;B\u0956\u0957\u61BFar;\u6958ector\u0100;B\u0965\u0966\u61BCar;\u6952ight\xE1\u039Cs\u0300EFGLST\u097E\u098B\u0995\u099D\u09A2\u09ADqualGreater;\u62DAullEqual;\u6266reater;\u6276ess;\u6AA1lantEqual;\u6A7Dilde;\u6272r;\uC000\u{1D50F}\u0100;e\u09BD\u09BE\u62D8ftarrow;\u61DAidot;\u413F\u0180npw\u09D4\u0A16\u0A1Bg\u0200LRlr\u09DE\u09F7\u0A02\u0A10eft\u0100AR\u09E6\u09ECrrow;\u67F5ightArrow;\u67F7ightArrow;\u67F6eft\u0100ar\u03B3\u0A0Aight\xE1\u03BFight\xE1\u03CAf;\uC000\u{1D543}er\u0100LR\u0A22\u0A2CeftArrow;\u6199ightArrow;\u6198\u0180cht\u0A3E\u0A40\u0A42\xF2\u084C;\u61B0rok;\u4141;\u626A\u0400acefiosu\u0A5A\u0A5D\u0A60\u0A77\u0A7C\u0A85\u0A8B\u0A8Ep;\u6905y;\u441C\u0100dl\u0A65\u0A6FiumSpace;\u605Flintrf;\u6133r;\uC000\u{1D510}nusPlus;\u6213pf;\uC000\u{1D544}c\xF2\u0A76;\u439C\u0480Jacefostu\u0AA3\u0AA7\u0AAD\u0AC0\u0B14\u0B19\u0D91\u0D97\u0D9Ecy;\u440Acute;\u4143\u0180aey\u0AB4\u0AB9\u0ABEron;\u4147dil;\u4145;\u441D\u0180gsw\u0AC7\u0AF0\u0B0Eative\u0180MTV\u0AD3\u0ADF\u0AE8ediumSpace;\u600Bhi\u0100cn\u0AE6\u0AD8\xEB\u0AD9eryThi\xEE\u0AD9ted\u0100GL\u0AF8\u0B06reaterGreate\xF2\u0673essLes\xF3\u0A48Line;\u400Ar;\uC000\u{1D511}\u0200Bnpt\u0B22\u0B28\u0B37\u0B3Areak;\u6060BreakingSpace;\u40A0f;\u6115\u0680;CDEGHLNPRSTV\u0B55\u0B56\u0B6A\u0B7C\u0BA1\u0BEB\u0C04\u0C5E\u0C84\u0CA6\u0CD8\u0D61\u0D85\u6AEC\u0100ou\u0B5B\u0B64ngruent;\u6262pCap;\u626DoubleVerticalBar;\u6226\u0180lqx\u0B83\u0B8A\u0B9Bement;\u6209ual\u0100;T\u0B92\u0B93\u6260ilde;\uC000\u2242\u0338ists;\u6204reater\u0380;EFGLST\u0BB6\u0BB7\u0BBD\u0BC9\u0BD3\u0BD8\u0BE5\u626Fqual;\u6271ullEqual;\uC000\u2267\u0338reater;\uC000\u226B\u0338ess;\u6279lantEqual;\uC000\u2A7E\u0338ilde;\u6275ump\u0144\u0BF2\u0BFDownHump;\uC000\u224E\u0338qual;\uC000\u224F\u0338e\u0100fs\u0C0A\u0C27tTriangle\u0180;BE\u0C1A\u0C1B\u0C21\u62EAar;\uC000\u29CF\u0338qual;\u62ECs\u0300;EGLST\u0C35\u0C36\u0C3C\u0C44\u0C4B\u0C58\u626Equal;\u6270reater;\u6278ess;\uC000\u226A\u0338lantEqual;\uC000\u2A7D\u0338ilde;\u6274ested\u0100GL\u0C68\u0C79reaterGreater;\uC000\u2AA2\u0338essLess;\uC000\u2AA1\u0338recedes\u0180;ES\u0C92\u0C93\u0C9B\u6280qual;\uC000\u2AAF\u0338lantEqual;\u62E0\u0100ei\u0CAB\u0CB9verseElement;\u620CghtTriangle\u0180;BE\u0CCB\u0CCC\u0CD2\u62EBar;\uC000\u29D0\u0338qual;\u62ED\u0100qu\u0CDD\u0D0CuareSu\u0100bp\u0CE8\u0CF9set\u0100;E\u0CF0\u0CF3\uC000\u228F\u0338qual;\u62E2erset\u0100;E\u0D03\u0D06\uC000\u2290\u0338qual;\u62E3\u0180bcp\u0D13\u0D24\u0D4Eset\u0100;E\u0D1B\u0D1E\uC000\u2282\u20D2qual;\u6288ceeds\u0200;EST\u0D32\u0D33\u0D3B\u0D46\u6281qual;\uC000\u2AB0\u0338lantEqual;\u62E1ilde;\uC000\u227F\u0338erset\u0100;E\u0D58\u0D5B\uC000\u2283\u20D2qual;\u6289ilde\u0200;EFT\u0D6E\u0D6F\u0D75\u0D7F\u6241qual;\u6244ullEqual;\u6247ilde;\u6249erticalBar;\u6224cr;\uC000\u{1D4A9}ilde\u803B\xD1\u40D1;\u439D\u0700Eacdfgmoprstuv\u0DBD\u0DC2\u0DC9\u0DD5\u0DDB\u0DE0\u0DE7\u0DFC\u0E02\u0E20\u0E22\u0E32\u0E3F\u0E44lig;\u4152cute\u803B\xD3\u40D3\u0100iy\u0DCE\u0DD3rc\u803B\xD4\u40D4;\u441Eblac;\u4150r;\uC000\u{1D512}rave\u803B\xD2\u40D2\u0180aei\u0DEE\u0DF2\u0DF6cr;\u414Cga;\u43A9cron;\u439Fpf;\uC000\u{1D546}enCurly\u0100DQ\u0E0E\u0E1AoubleQuote;\u601Cuote;\u6018;\u6A54\u0100cl\u0E27\u0E2Cr;\uC000\u{1D4AA}ash\u803B\xD8\u40D8i\u016C\u0E37\u0E3Cde\u803B\xD5\u40D5es;\u6A37ml\u803B\xD6\u40D6er\u0100BP\u0E4B\u0E60\u0100ar\u0E50\u0E53r;\u603Eac\u0100ek\u0E5A\u0E5C;\u63DEet;\u63B4arenthesis;\u63DC\u0480acfhilors\u0E7F\u0E87\u0E8A\u0E8F\u0E92\u0E94\u0E9D\u0EB0\u0EFCrtialD;\u6202y;\u441Fr;\uC000\u{1D513}i;\u43A6;\u43A0usMinus;\u40B1\u0100ip\u0EA2\u0EADncareplan\xE5\u069Df;\u6119\u0200;eio\u0EB9\u0EBA\u0EE0\u0EE4\u6ABBcedes\u0200;EST\u0EC8\u0EC9\u0ECF\u0EDA\u627Aqual;\u6AAFlantEqual;\u627Cilde;\u627Eme;\u6033\u0100dp\u0EE9\u0EEEuct;\u620Fortion\u0100;a\u0225\u0EF9l;\u621D\u0100ci\u0F01\u0F06r;\uC000\u{1D4AB};\u43A8\u0200Ufos\u0F11\u0F16\u0F1B\u0F1FOT\u803B"\u4022r;\uC000\u{1D514}pf;\u611Acr;\uC000\u{1D4AC}\u0600BEacefhiorsu\u0F3E\u0F43\u0F47\u0F60\u0F73\u0FA7\u0FAA\u0FAD\u1096\u10A9\u10B4\u10BEarr;\u6910G\u803B\xAE\u40AE\u0180cnr\u0F4E\u0F53\u0F56ute;\u4154g;\u67EBr\u0100;t\u0F5C\u0F5D\u61A0l;\u6916\u0180aey\u0F67\u0F6C\u0F71ron;\u4158dil;\u4156;\u4420\u0100;v\u0F78\u0F79\u611Cerse\u0100EU\u0F82\u0F99\u0100lq\u0F87\u0F8Eement;\u620Builibrium;\u61CBpEquilibrium;\u696Fr\xBB\u0F79o;\u43A1ght\u0400ACDFTUVa\u0FC1\u0FEB\u0FF3\u1022\u1028\u105B\u1087\u03D8\u0100nr\u0FC6\u0FD2gleBracket;\u67E9row\u0180;BL\u0FDC\u0FDD\u0FE1\u6192ar;\u61E5eftArrow;\u61C4eiling;\u6309o\u01F5\u0FF9\0\u1005bleBracket;\u67E7n\u01D4\u100A\0\u1014eeVector;\u695Dector\u0100;B\u101D\u101E\u61C2ar;\u6955loor;\u630B\u0100er\u102D\u1043e\u0180;AV\u1035\u1036\u103C\u62A2rrow;\u61A6ector;\u695Biangle\u0180;BE\u1050\u1051\u1055\u62B3ar;\u69D0qual;\u62B5p\u0180DTV\u1063\u106E\u1078ownVector;\u694FeeVector;\u695Cector\u0100;B\u1082\u1083\u61BEar;\u6954ector\u0100;B\u1091\u1092\u61C0ar;\u6953\u0100pu\u109B\u109Ef;\u611DndImplies;\u6970ightarrow;\u61DB\u0100ch\u10B9\u10BCr;\u611B;\u61B1leDelayed;\u69F4\u0680HOacfhimoqstu\u10E4\u10F1\u10F7\u10FD\u1119\u111E\u1151\u1156\u1161\u1167\u11B5\u11BB\u11BF\u0100Cc\u10E9\u10EEHcy;\u4429y;\u4428FTcy;\u442Ccute;\u415A\u0280;aeiy\u1108\u1109\u110E\u1113\u1117\u6ABCron;\u4160dil;\u415Erc;\u415C;\u4421r;\uC000\u{1D516}ort\u0200DLRU\u112A\u1134\u113E\u1149ownArrow\xBB\u041EeftArrow\xBB\u089AightArrow\xBB\u0FDDpArrow;\u6191gma;\u43A3allCircle;\u6218pf;\uC000\u{1D54A}\u0272\u116D\0\0\u1170t;\u621Aare\u0200;ISU\u117B\u117C\u1189\u11AF\u65A1ntersection;\u6293u\u0100bp\u118F\u119Eset\u0100;E\u1197\u1198\u628Fqual;\u6291erset\u0100;E\u11A8\u11A9\u6290qual;\u6292nion;\u6294cr;\uC000\u{1D4AE}ar;\u62C6\u0200bcmp\u11C8\u11DB\u1209\u120B\u0100;s\u11CD\u11CE\u62D0et\u0100;E\u11CD\u11D5qual;\u6286\u0100ch\u11E0\u1205eeds\u0200;EST\u11ED\u11EE\u11F4\u11FF\u627Bqual;\u6AB0lantEqual;\u627Dilde;\u627FTh\xE1\u0F8C;\u6211\u0180;es\u1212\u1213\u1223\u62D1rset\u0100;E\u121C\u121D\u6283qual;\u6287et\xBB\u1213\u0580HRSacfhiors\u123E\u1244\u1249\u1255\u125E\u1271\u1276\u129F\u12C2\u12C8\u12D1ORN\u803B\xDE\u40DEADE;\u6122\u0100Hc\u124E\u1252cy;\u440By;\u4426\u0100bu\u125A\u125C;\u4009;\u43A4\u0180aey\u1265\u126A\u126Fron;\u4164dil;\u4162;\u4422r;\uC000\u{1D517}\u0100ei\u127B\u1289\u01F2\u1280\0\u1287efore;\u6234a;\u4398\u0100cn\u128E\u1298kSpace;\uC000\u205F\u200ASpace;\u6009lde\u0200;EFT\u12AB\u12AC\u12B2\u12BC\u623Cqual;\u6243ullEqual;\u6245ilde;\u6248pf;\uC000\u{1D54B}ipleDot;\u60DB\u0100ct\u12D6\u12DBr;\uC000\u{1D4AF}rok;\u4166\u0AE1\u12F7\u130E\u131A\u1326\0\u132C\u1331\0\0\0\0\0\u1338\u133D\u1377\u1385\0\u13FF\u1404\u140A\u1410\u0100cr\u12FB\u1301ute\u803B\xDA\u40DAr\u0100;o\u1307\u1308\u619Fcir;\u6949r\u01E3\u1313\0\u1316y;\u440Eve;\u416C\u0100iy\u131E\u1323rc\u803B\xDB\u40DB;\u4423blac;\u4170r;\uC000\u{1D518}rave\u803B\xD9\u40D9acr;\u416A\u0100di\u1341\u1369er\u0100BP\u1348\u135D\u0100ar\u134D\u1350r;\u405Fac\u0100ek\u1357\u1359;\u63DFet;\u63B5arenthesis;\u63DDon\u0100;P\u1370\u1371\u62C3lus;\u628E\u0100gp\u137B\u137Fon;\u4172f;\uC000\u{1D54C}\u0400ADETadps\u1395\u13AE\u13B8\u13C4\u03E8\u13D2\u13D7\u13F3rrow\u0180;BD\u1150\u13A0\u13A4ar;\u6912ownArrow;\u61C5ownArrow;\u6195quilibrium;\u696Eee\u0100;A\u13CB\u13CC\u62A5rrow;\u61A5own\xE1\u03F3er\u0100LR\u13DE\u13E8eftArrow;\u6196ightArrow;\u6197i\u0100;l\u13F9\u13FA\u43D2on;\u43A5ing;\u416Ecr;\uC000\u{1D4B0}ilde;\u4168ml\u803B\xDC\u40DC\u0480Dbcdefosv\u1427\u142C\u1430\u1433\u143E\u1485\u148A\u1490\u1496ash;\u62ABar;\u6AEBy;\u4412ash\u0100;l\u143B\u143C\u62A9;\u6AE6\u0100er\u1443\u1445;\u62C1\u0180bty\u144C\u1450\u147Aar;\u6016\u0100;i\u144F\u1455cal\u0200BLST\u1461\u1465\u146A\u1474ar;\u6223ine;\u407Ceparator;\u6758ilde;\u6240ThinSpace;\u600Ar;\uC000\u{1D519}pf;\uC000\u{1D54D}cr;\uC000\u{1D4B1}dash;\u62AA\u0280cefos\u14A7\u14AC\u14B1\u14B6\u14BCirc;\u4174dge;\u62C0r;\uC000\u{1D51A}pf;\uC000\u{1D54E}cr;\uC000\u{1D4B2}\u0200fios\u14CB\u14D0\u14D2\u14D8r;\uC000\u{1D51B};\u439Epf;\uC000\u{1D54F}cr;\uC000\u{1D4B3}\u0480AIUacfosu\u14F1\u14F5\u14F9\u14FD\u1504\u150F\u1514\u151A\u1520cy;\u442Fcy;\u4407cy;\u442Ecute\u803B\xDD\u40DD\u0100iy\u1509\u150Drc;\u4176;\u442Br;\uC000\u{1D51C}pf;\uC000\u{1D550}cr;\uC000\u{1D4B4}ml;\u4178\u0400Hacdefos\u1535\u1539\u153F\u154B\u154F\u155D\u1560\u1564cy;\u4416cute;\u4179\u0100ay\u1544\u1549ron;\u417D;\u4417ot;\u417B\u01F2\u1554\0\u155BoWidt\xE8\u0AD9a;\u4396r;\u6128pf;\u6124cr;\uC000\u{1D4B5}\u0BE1\u1583\u158A\u1590\0\u15B0\u15B6\u15BF\0\0\0\0\u15C6\u15DB\u15EB\u165F\u166D\0\u1695\u169B\u16B2\u16B9\0\u16BEcute\u803B\xE1\u40E1reve;\u4103\u0300;Ediuy\u159C\u159D\u15A1\u15A3\u15A8\u15AD\u623E;\uC000\u223E\u0333;\u623Frc\u803B\xE2\u40E2te\u80BB\xB4\u0306;\u4430lig\u803B\xE6\u40E6\u0100;r\xB2\u15BA;\uC000\u{1D51E}rave\u803B\xE0\u40E0\u0100ep\u15CA\u15D6\u0100fp\u15CF\u15D4sym;\u6135\xE8\u15D3ha;\u43B1\u0100ap\u15DFc\u0100cl\u15E4\u15E7r;\u4101g;\u6A3F\u0264\u15F0\0\0\u160A\u0280;adsv\u15FA\u15FB\u15FF\u1601\u1607\u6227nd;\u6A55;\u6A5Clope;\u6A58;\u6A5A\u0380;elmrsz\u1618\u1619\u161B\u161E\u163F\u164F\u1659\u6220;\u69A4e\xBB\u1619sd\u0100;a\u1625\u1626\u6221\u0461\u1630\u1632\u1634\u1636\u1638\u163A\u163C\u163E;\u69A8;\u69A9;\u69AA;\u69AB;\u69AC;\u69AD;\u69AE;\u69AFt\u0100;v\u1645\u1646\u621Fb\u0100;d\u164C\u164D\u62BE;\u699D\u0100pt\u1654\u1657h;\u6222\xBB\xB9arr;\u637C\u0100gp\u1663\u1667on;\u4105f;\uC000\u{1D552}\u0380;Eaeiop\u12C1\u167B\u167D\u1682\u1684\u1687\u168A;\u6A70cir;\u6A6F;\u624Ad;\u624Bs;\u4027rox\u0100;e\u12C1\u1692\xF1\u1683ing\u803B\xE5\u40E5\u0180cty\u16A1\u16A6\u16A8r;\uC000\u{1D4B6};\u402Amp\u0100;e\u12C1\u16AF\xF1\u0288ilde\u803B\xE3\u40E3ml\u803B\xE4\u40E4\u0100ci\u16C2\u16C8onin\xF4\u0272nt;\u6A11\u0800Nabcdefiklnoprsu\u16ED\u16F1\u1730\u173C\u1743\u1748\u1778\u177D\u17E0\u17E6\u1839\u1850\u170D\u193D\u1948\u1970ot;\u6AED\u0100cr\u16F6\u171Ek\u0200ceps\u1700\u1705\u170D\u1713ong;\u624Cpsilon;\u43F6rime;\u6035im\u0100;e\u171A\u171B\u623Dq;\u62CD\u0176\u1722\u1726ee;\u62BDed\u0100;g\u172C\u172D\u6305e\xBB\u172Drk\u0100;t\u135C\u1737brk;\u63B6\u0100oy\u1701\u1741;\u4431quo;\u601E\u0280cmprt\u1753\u175B\u1761\u1764\u1768aus\u0100;e\u010A\u0109ptyv;\u69B0s\xE9\u170Cno\xF5\u0113\u0180ahw\u176F\u1771\u1773;\u43B2;\u6136een;\u626Cr;\uC000\u{1D51F}g\u0380costuvw\u178D\u179D\u17B3\u17C1\u17D5\u17DB\u17DE\u0180aiu\u1794\u1796\u179A\xF0\u0760rc;\u65EFp\xBB\u1371\u0180dpt\u17A4\u17A8\u17ADot;\u6A00lus;\u6A01imes;\u6A02\u0271\u17B9\0\0\u17BEcup;\u6A06ar;\u6605riangle\u0100du\u17CD\u17D2own;\u65BDp;\u65B3plus;\u6A04e\xE5\u1444\xE5\u14ADarow;\u690D\u0180ako\u17ED\u1826\u1835\u0100cn\u17F2\u1823k\u0180lst\u17FA\u05AB\u1802ozenge;\u69EBriangle\u0200;dlr\u1812\u1813\u1818\u181D\u65B4own;\u65BEeft;\u65C2ight;\u65B8k;\u6423\u01B1\u182B\0\u1833\u01B2\u182F\0\u1831;\u6592;\u65914;\u6593ck;\u6588\u0100eo\u183E\u184D\u0100;q\u1843\u1846\uC000=\u20E5uiv;\uC000\u2261\u20E5t;\u6310\u0200ptwx\u1859\u185E\u1867\u186Cf;\uC000\u{1D553}\u0100;t\u13CB\u1863om\xBB\u13CCtie;\u62C8\u0600DHUVbdhmptuv\u1885\u1896\u18AA\u18BB\u18D7\u18DB\u18EC\u18FF\u1905\u190A\u1910\u1921\u0200LRlr\u188E\u1890\u1892\u1894;\u6557;\u6554;\u6556;\u6553\u0280;DUdu\u18A1\u18A2\u18A4\u18A6\u18A8\u6550;\u6566;\u6569;\u6564;\u6567\u0200LRlr\u18B3\u18B5\u18B7\u18B9;\u655D;\u655A;\u655C;\u6559\u0380;HLRhlr\u18CA\u18CB\u18CD\u18CF\u18D1\u18D3\u18D5\u6551;\u656C;\u6563;\u6560;\u656B;\u6562;\u655Fox;\u69C9\u0200LRlr\u18E4\u18E6\u18E8\u18EA;\u6555;\u6552;\u6510;\u650C\u0280;DUdu\u06BD\u18F7\u18F9\u18FB\u18FD;\u6565;\u6568;\u652C;\u6534inus;\u629Flus;\u629Eimes;\u62A0\u0200LRlr\u1919\u191B\u191D\u191F;\u655B;\u6558;\u6518;\u6514\u0380;HLRhlr\u1930\u1931\u1933\u1935\u1937\u1939\u193B\u6502;\u656A;\u6561;\u655E;\u653C;\u6524;\u651C\u0100ev\u0123\u1942bar\u803B\xA6\u40A6\u0200ceio\u1951\u1956\u195A\u1960r;\uC000\u{1D4B7}mi;\u604Fm\u0100;e\u171A\u171Cl\u0180;bh\u1968\u1969\u196B\u405C;\u69C5sub;\u67C8\u016C\u1974\u197El\u0100;e\u1979\u197A\u6022t\xBB\u197Ap\u0180;Ee\u012F\u1985\u1987;\u6AAE\u0100;q\u06DC\u06DB\u0CE1\u19A7\0\u19E8\u1A11\u1A15\u1A32\0\u1A37\u1A50\0\0\u1AB4\0\0\u1AC1\0\0\u1B21\u1B2E\u1B4D\u1B52\0\u1BFD\0\u1C0C\u0180cpr\u19AD\u19B2\u19DDute;\u4107\u0300;abcds\u19BF\u19C0\u19C4\u19CA\u19D5\u19D9\u6229nd;\u6A44rcup;\u6A49\u0100au\u19CF\u19D2p;\u6A4Bp;\u6A47ot;\u6A40;\uC000\u2229\uFE00\u0100eo\u19E2\u19E5t;\u6041\xEE\u0693\u0200aeiu\u19F0\u19FB\u1A01\u1A05\u01F0\u19F5\0\u19F8s;\u6A4Don;\u410Ddil\u803B\xE7\u40E7rc;\u4109ps\u0100;s\u1A0C\u1A0D\u6A4Cm;\u6A50ot;\u410B\u0180dmn\u1A1B\u1A20\u1A26il\u80BB\xB8\u01ADptyv;\u69B2t\u8100\xA2;e\u1A2D\u1A2E\u40A2r\xE4\u01B2r;\uC000\u{1D520}\u0180cei\u1A3D\u1A40\u1A4Dy;\u4447ck\u0100;m\u1A47\u1A48\u6713ark\xBB\u1A48;\u43C7r\u0380;Ecefms\u1A5F\u1A60\u1A62\u1A6B\u1AA4\u1AAA\u1AAE\u65CB;\u69C3\u0180;el\u1A69\u1A6A\u1A6D\u42C6q;\u6257e\u0261\u1A74\0\0\u1A88rrow\u0100lr\u1A7C\u1A81eft;\u61BAight;\u61BB\u0280RSacd\u1A92\u1A94\u1A96\u1A9A\u1A9F\xBB\u0F47;\u64C8st;\u629Birc;\u629Aash;\u629Dnint;\u6A10id;\u6AEFcir;\u69C2ubs\u0100;u\u1ABB\u1ABC\u6663it\xBB\u1ABC\u02EC\u1AC7\u1AD4\u1AFA\0\u1B0Aon\u0100;e\u1ACD\u1ACE\u403A\u0100;q\xC7\xC6\u026D\u1AD9\0\0\u1AE2a\u0100;t\u1ADE\u1ADF\u402C;\u4040\u0180;fl\u1AE8\u1AE9\u1AEB\u6201\xEE\u1160e\u0100mx\u1AF1\u1AF6ent\xBB\u1AE9e\xF3\u024D\u01E7\u1AFE\0\u1B07\u0100;d\u12BB\u1B02ot;\u6A6Dn\xF4\u0246\u0180fry\u1B10\u1B14\u1B17;\uC000\u{1D554}o\xE4\u0254\u8100\xA9;s\u0155\u1B1Dr;\u6117\u0100ao\u1B25\u1B29rr;\u61B5ss;\u6717\u0100cu\u1B32\u1B37r;\uC000\u{1D4B8}\u0100bp\u1B3C\u1B44\u0100;e\u1B41\u1B42\u6ACF;\u6AD1\u0100;e\u1B49\u1B4A\u6AD0;\u6AD2dot;\u62EF\u0380delprvw\u1B60\u1B6C\u1B77\u1B82\u1BAC\u1BD4\u1BF9arr\u0100lr\u1B68\u1B6A;\u6938;\u6935\u0270\u1B72\0\0\u1B75r;\u62DEc;\u62DFarr\u0100;p\u1B7F\u1B80\u61B6;\u693D\u0300;bcdos\u1B8F\u1B90\u1B96\u1BA1\u1BA5\u1BA8\u622Arcap;\u6A48\u0100au\u1B9B\u1B9Ep;\u6A46p;\u6A4Aot;\u628Dr;\u6A45;\uC000\u222A\uFE00\u0200alrv\u1BB5\u1BBF\u1BDE\u1BE3rr\u0100;m\u1BBC\u1BBD\u61B7;\u693Cy\u0180evw\u1BC7\u1BD4\u1BD8q\u0270\u1BCE\0\0\u1BD2re\xE3\u1B73u\xE3\u1B75ee;\u62CEedge;\u62CFen\u803B\xA4\u40A4earrow\u0100lr\u1BEE\u1BF3eft\xBB\u1B80ight\xBB\u1BBDe\xE4\u1BDD\u0100ci\u1C01\u1C07onin\xF4\u01F7nt;\u6231lcty;\u632D\u0980AHabcdefhijlorstuwz\u1C38\u1C3B\u1C3F\u1C5D\u1C69\u1C75\u1C8A\u1C9E\u1CAC\u1CB7\u1CFB\u1CFF\u1D0D\u1D7B\u1D91\u1DAB\u1DBB\u1DC6\u1DCDr\xF2\u0381ar;\u6965\u0200glrs\u1C48\u1C4D\u1C52\u1C54ger;\u6020eth;\u6138\xF2\u1133h\u0100;v\u1C5A\u1C5B\u6010\xBB\u090A\u016B\u1C61\u1C67arow;\u690Fa\xE3\u0315\u0100ay\u1C6E\u1C73ron;\u410F;\u4434\u0180;ao\u0332\u1C7C\u1C84\u0100gr\u02BF\u1C81r;\u61CAtseq;\u6A77\u0180glm\u1C91\u1C94\u1C98\u803B\xB0\u40B0ta;\u43B4ptyv;\u69B1\u0100ir\u1CA3\u1CA8sht;\u697F;\uC000\u{1D521}ar\u0100lr\u1CB3\u1CB5\xBB\u08DC\xBB\u101E\u0280aegsv\u1CC2\u0378\u1CD6\u1CDC\u1CE0m\u0180;os\u0326\u1CCA\u1CD4nd\u0100;s\u0326\u1CD1uit;\u6666amma;\u43DDin;\u62F2\u0180;io\u1CE7\u1CE8\u1CF8\u40F7de\u8100\xF7;o\u1CE7\u1CF0ntimes;\u62C7n\xF8\u1CF7cy;\u4452c\u026F\u1D06\0\0\u1D0Arn;\u631Eop;\u630D\u0280lptuw\u1D18\u1D1D\u1D22\u1D49\u1D55lar;\u4024f;\uC000\u{1D555}\u0280;emps\u030B\u1D2D\u1D37\u1D3D\u1D42q\u0100;d\u0352\u1D33ot;\u6251inus;\u6238lus;\u6214quare;\u62A1blebarwedg\xE5\xFAn\u0180adh\u112E\u1D5D\u1D67ownarrow\xF3\u1C83arpoon\u0100lr\u1D72\u1D76ef\xF4\u1CB4igh\xF4\u1CB6\u0162\u1D7F\u1D85karo\xF7\u0F42\u026F\u1D8A\0\0\u1D8Ern;\u631Fop;\u630C\u0180cot\u1D98\u1DA3\u1DA6\u0100ry\u1D9D\u1DA1;\uC000\u{1D4B9};\u4455l;\u69F6rok;\u4111\u0100dr\u1DB0\u1DB4ot;\u62F1i\u0100;f\u1DBA\u1816\u65BF\u0100ah\u1DC0\u1DC3r\xF2\u0429a\xF2\u0FA6angle;\u69A6\u0100ci\u1DD2\u1DD5y;\u445Fgrarr;\u67FF\u0900Dacdefglmnopqrstux\u1E01\u1E09\u1E19\u1E38\u0578\u1E3C\u1E49\u1E61\u1E7E\u1EA5\u1EAF\u1EBD\u1EE1\u1F2A\u1F37\u1F44\u1F4E\u1F5A\u0100Do\u1E06\u1D34o\xF4\u1C89\u0100cs\u1E0E\u1E14ute\u803B\xE9\u40E9ter;\u6A6E\u0200aioy\u1E22\u1E27\u1E31\u1E36ron;\u411Br\u0100;c\u1E2D\u1E2E\u6256\u803B\xEA\u40EAlon;\u6255;\u444Dot;\u4117\u0100Dr\u1E41\u1E45ot;\u6252;\uC000\u{1D522}\u0180;rs\u1E50\u1E51\u1E57\u6A9Aave\u803B\xE8\u40E8\u0100;d\u1E5C\u1E5D\u6A96ot;\u6A98\u0200;ils\u1E6A\u1E6B\u1E72\u1E74\u6A99nters;\u63E7;\u6113\u0100;d\u1E79\u1E7A\u6A95ot;\u6A97\u0180aps\u1E85\u1E89\u1E97cr;\u4113ty\u0180;sv\u1E92\u1E93\u1E95\u6205et\xBB\u1E93p\u01001;\u1E9D\u1EA4\u0133\u1EA1\u1EA3;\u6004;\u6005\u6003\u0100gs\u1EAA\u1EAC;\u414Bp;\u6002\u0100gp\u1EB4\u1EB8on;\u4119f;\uC000\u{1D556}\u0180als\u1EC4\u1ECE\u1ED2r\u0100;s\u1ECA\u1ECB\u62D5l;\u69E3us;\u6A71i\u0180;lv\u1EDA\u1EDB\u1EDF\u43B5on\xBB\u1EDB;\u43F5\u0200csuv\u1EEA\u1EF3\u1F0B\u1F23\u0100io\u1EEF\u1E31rc\xBB\u1E2E\u0269\u1EF9\0\0\u1EFB\xED\u0548ant\u0100gl\u1F02\u1F06tr\xBB\u1E5Dess\xBB\u1E7A\u0180aei\u1F12\u1F16\u1F1Als;\u403Dst;\u625Fv\u0100;D\u0235\u1F20D;\u6A78parsl;\u69E5\u0100Da\u1F2F\u1F33ot;\u6253rr;\u6971\u0180cdi\u1F3E\u1F41\u1EF8r;\u612Fo\xF4\u0352\u0100ah\u1F49\u1F4B;\u43B7\u803B\xF0\u40F0\u0100mr\u1F53\u1F57l\u803B\xEB\u40EBo;\u60AC\u0180cip\u1F61\u1F64\u1F67l;\u4021s\xF4\u056E\u0100eo\u1F6C\u1F74ctatio\xEE\u0559nential\xE5\u0579\u09E1\u1F92\0\u1F9E\0\u1FA1\u1FA7\0\0\u1FC6\u1FCC\0\u1FD3\0\u1FE6\u1FEA\u2000\0\u2008\u205Allingdotse\xF1\u1E44y;\u4444male;\u6640\u0180ilr\u1FAD\u1FB3\u1FC1lig;\u8000\uFB03\u0269\u1FB9\0\0\u1FBDg;\u8000\uFB00ig;\u8000\uFB04;\uC000\u{1D523}lig;\u8000\uFB01lig;\uC000fj\u0180alt\u1FD9\u1FDC\u1FE1t;\u666Dig;\u8000\uFB02ns;\u65B1of;\u4192\u01F0\u1FEE\0\u1FF3f;\uC000\u{1D557}\u0100ak\u05BF\u1FF7\u0100;v\u1FFC\u1FFD\u62D4;\u6AD9artint;\u6A0D\u0100ao\u200C\u2055\u0100cs\u2011\u2052\u03B1\u201A\u2030\u2038\u2045\u2048\0\u2050\u03B2\u2022\u2025\u2027\u202A\u202C\0\u202E\u803B\xBD\u40BD;\u6153\u803B\xBC\u40BC;\u6155;\u6159;\u615B\u01B3\u2034\0\u2036;\u6154;\u6156\u02B4\u203E\u2041\0\0\u2043\u803B\xBE\u40BE;\u6157;\u615C5;\u6158\u01B6\u204C\0\u204E;\u615A;\u615D8;\u615El;\u6044wn;\u6322cr;\uC000\u{1D4BB}\u0880Eabcdefgijlnorstv\u2082\u2089\u209F\u20A5\u20B0\u20B4\u20F0\u20F5\u20FA\u20FF\u2103\u2112\u2138\u0317\u213E\u2152\u219E\u0100;l\u064D\u2087;\u6A8C\u0180cmp\u2090\u2095\u209Dute;\u41F5ma\u0100;d\u209C\u1CDA\u43B3;\u6A86reve;\u411F\u0100iy\u20AA\u20AErc;\u411D;\u4433ot;\u4121\u0200;lqs\u063E\u0642\u20BD\u20C9\u0180;qs\u063E\u064C\u20C4lan\xF4\u0665\u0200;cdl\u0665\u20D2\u20D5\u20E5c;\u6AA9ot\u0100;o\u20DC\u20DD\u6A80\u0100;l\u20E2\u20E3\u6A82;\u6A84\u0100;e\u20EA\u20ED\uC000\u22DB\uFE00s;\u6A94r;\uC000\u{1D524}\u0100;g\u0673\u061Bmel;\u6137cy;\u4453\u0200;Eaj\u065A\u210C\u210E\u2110;\u6A92;\u6AA5;\u6AA4\u0200Eaes\u211B\u211D\u2129\u2134;\u6269p\u0100;p\u2123\u2124\u6A8Arox\xBB\u2124\u0100;q\u212E\u212F\u6A88\u0100;q\u212E\u211Bim;\u62E7pf;\uC000\u{1D558}\u0100ci\u2143\u2146r;\u610Am\u0180;el\u066B\u214E\u2150;\u6A8E;\u6A90\u8300>;cdlqr\u05EE\u2160\u216A\u216E\u2173\u2179\u0100ci\u2165\u2167;\u6AA7r;\u6A7Aot;\u62D7Par;\u6995uest;\u6A7C\u0280adels\u2184\u216A\u2190\u0656\u219B\u01F0\u2189\0\u218Epro\xF8\u209Er;\u6978q\u0100lq\u063F\u2196les\xF3\u2088i\xED\u066B\u0100en\u21A3\u21ADrtneqq;\uC000\u2269\uFE00\xC5\u21AA\u0500Aabcefkosy\u21C4\u21C7\u21F1\u21F5\u21FA\u2218\u221D\u222F\u2268\u227Dr\xF2\u03A0\u0200ilmr\u21D0\u21D4\u21D7\u21DBrs\xF0\u1484f\xBB\u2024il\xF4\u06A9\u0100dr\u21E0\u21E4cy;\u444A\u0180;cw\u08F4\u21EB\u21EFir;\u6948;\u61ADar;\u610Firc;\u4125\u0180alr\u2201\u220E\u2213rts\u0100;u\u2209\u220A\u6665it\xBB\u220Alip;\u6026con;\u62B9r;\uC000\u{1D525}s\u0100ew\u2223\u2229arow;\u6925arow;\u6926\u0280amopr\u223A\u223E\u2243\u225E\u2263rr;\u61FFtht;\u623Bk\u0100lr\u2249\u2253eftarrow;\u61A9ightarrow;\u61AAf;\uC000\u{1D559}bar;\u6015\u0180clt\u226F\u2274\u2278r;\uC000\u{1D4BD}as\xE8\u21F4rok;\u4127\u0100bp\u2282\u2287ull;\u6043hen\xBB\u1C5B\u0AE1\u22A3\0\u22AA\0\u22B8\u22C5\u22CE\0\u22D5\u22F3\0\0\u22F8\u2322\u2367\u2362\u237F\0\u2386\u23AA\u23B4cute\u803B\xED\u40ED\u0180;iy\u0771\u22B0\u22B5rc\u803B\xEE\u40EE;\u4438\u0100cx\u22BC\u22BFy;\u4435cl\u803B\xA1\u40A1\u0100fr\u039F\u22C9;\uC000\u{1D526}rave\u803B\xEC\u40EC\u0200;ino\u073E\u22DD\u22E9\u22EE\u0100in\u22E2\u22E6nt;\u6A0Ct;\u622Dfin;\u69DCta;\u6129lig;\u4133\u0180aop\u22FE\u231A\u231D\u0180cgt\u2305\u2308\u2317r;\u412B\u0180elp\u071F\u230F\u2313in\xE5\u078Ear\xF4\u0720h;\u4131f;\u62B7ed;\u41B5\u0280;cfot\u04F4\u232C\u2331\u233D\u2341are;\u6105in\u0100;t\u2338\u2339\u621Eie;\u69DDdo\xF4\u2319\u0280;celp\u0757\u234C\u2350\u235B\u2361al;\u62BA\u0100gr\u2355\u2359er\xF3\u1563\xE3\u234Darhk;\u6A17rod;\u6A3C\u0200cgpt\u236F\u2372\u2376\u237By;\u4451on;\u412Ff;\uC000\u{1D55A}a;\u43B9uest\u803B\xBF\u40BF\u0100ci\u238A\u238Fr;\uC000\u{1D4BE}n\u0280;Edsv\u04F4\u239B\u239D\u23A1\u04F3;\u62F9ot;\u62F5\u0100;v\u23A6\u23A7\u62F4;\u62F3\u0100;i\u0777\u23AElde;\u4129\u01EB\u23B8\0\u23BCcy;\u4456l\u803B\xEF\u40EF\u0300cfmosu\u23CC\u23D7\u23DC\u23E1\u23E7\u23F5\u0100iy\u23D1\u23D5rc;\u4135;\u4439r;\uC000\u{1D527}ath;\u4237pf;\uC000\u{1D55B}\u01E3\u23EC\0\u23F1r;\uC000\u{1D4BF}rcy;\u4458kcy;\u4454\u0400acfghjos\u240B\u2416\u2422\u2427\u242D\u2431\u2435\u243Bppa\u0100;v\u2413\u2414\u43BA;\u43F0\u0100ey\u241B\u2420dil;\u4137;\u443Ar;\uC000\u{1D528}reen;\u4138cy;\u4445cy;\u445Cpf;\uC000\u{1D55C}cr;\uC000\u{1D4C0}\u0B80ABEHabcdefghjlmnoprstuv\u2470\u2481\u2486\u248D\u2491\u250E\u253D\u255A\u2580\u264E\u265E\u2665\u2679\u267D\u269A\u26B2\u26D8\u275D\u2768\u278B\u27C0\u2801\u2812\u0180art\u2477\u247A\u247Cr\xF2\u09C6\xF2\u0395ail;\u691Barr;\u690E\u0100;g\u0994\u248B;\u6A8Bar;\u6962\u0963\u24A5\0\u24AA\0\u24B1\0\0\0\0\0\u24B5\u24BA\0\u24C6\u24C8\u24CD\0\u24F9ute;\u413Amptyv;\u69B4ra\xEE\u084Cbda;\u43BBg\u0180;dl\u088E\u24C1\u24C3;\u6991\xE5\u088E;\u6A85uo\u803B\xAB\u40ABr\u0400;bfhlpst\u0899\u24DE\u24E6\u24E9\u24EB\u24EE\u24F1\u24F5\u0100;f\u089D\u24E3s;\u691Fs;\u691D\xEB\u2252p;\u61ABl;\u6939im;\u6973l;\u61A2\u0180;ae\u24FF\u2500\u2504\u6AABil;\u6919\u0100;s\u2509\u250A\u6AAD;\uC000\u2AAD\uFE00\u0180abr\u2515\u2519\u251Drr;\u690Crk;\u6772\u0100ak\u2522\u252Cc\u0100ek\u2528\u252A;\u407B;\u405B\u0100es\u2531\u2533;\u698Bl\u0100du\u2539\u253B;\u698F;\u698D\u0200aeuy\u2546\u254B\u2556\u2558ron;\u413E\u0100di\u2550\u2554il;\u413C\xEC\u08B0\xE2\u2529;\u443B\u0200cqrs\u2563\u2566\u256D\u257Da;\u6936uo\u0100;r\u0E19\u1746\u0100du\u2572\u2577har;\u6967shar;\u694Bh;\u61B2\u0280;fgqs\u258B\u258C\u0989\u25F3\u25FF\u6264t\u0280ahlrt\u2598\u25A4\u25B7\u25C2\u25E8rrow\u0100;t\u0899\u25A1a\xE9\u24F6arpoon\u0100du\u25AF\u25B4own\xBB\u045Ap\xBB\u0966eftarrows;\u61C7ight\u0180ahs\u25CD\u25D6\u25DErrow\u0100;s\u08F4\u08A7arpoon\xF3\u0F98quigarro\xF7\u21F0hreetimes;\u62CB\u0180;qs\u258B\u0993\u25FAlan\xF4\u09AC\u0280;cdgs\u09AC\u260A\u260D\u261D\u2628c;\u6AA8ot\u0100;o\u2614\u2615\u6A7F\u0100;r\u261A\u261B\u6A81;\u6A83\u0100;e\u2622\u2625\uC000\u22DA\uFE00s;\u6A93\u0280adegs\u2633\u2639\u263D\u2649\u264Bppro\xF8\u24C6ot;\u62D6q\u0100gq\u2643\u2645\xF4\u0989gt\xF2\u248C\xF4\u099Bi\xED\u09B2\u0180ilr\u2655\u08E1\u265Asht;\u697C;\uC000\u{1D529}\u0100;E\u099C\u2663;\u6A91\u0161\u2669\u2676r\u0100du\u25B2\u266E\u0100;l\u0965\u2673;\u696Alk;\u6584cy;\u4459\u0280;acht\u0A48\u2688\u268B\u2691\u2696r\xF2\u25C1orne\xF2\u1D08ard;\u696Bri;\u65FA\u0100io\u269F\u26A4dot;\u4140ust\u0100;a\u26AC\u26AD\u63B0che\xBB\u26AD\u0200Eaes\u26BB\u26BD\u26C9\u26D4;\u6268p\u0100;p\u26C3\u26C4\u6A89rox\xBB\u26C4\u0100;q\u26CE\u26CF\u6A87\u0100;q\u26CE\u26BBim;\u62E6\u0400abnoptwz\u26E9\u26F4\u26F7\u271A\u272F\u2741\u2747\u2750\u0100nr\u26EE\u26F1g;\u67ECr;\u61FDr\xEB\u08C1g\u0180lmr\u26FF\u270D\u2714eft\u0100ar\u09E6\u2707ight\xE1\u09F2apsto;\u67FCight\xE1\u09FDparrow\u0100lr\u2725\u2729ef\xF4\u24EDight;\u61AC\u0180afl\u2736\u2739\u273Dr;\u6985;\uC000\u{1D55D}us;\u6A2Dimes;\u6A34\u0161\u274B\u274Fst;\u6217\xE1\u134E\u0180;ef\u2757\u2758\u1800\u65CAnge\xBB\u2758ar\u0100;l\u2764\u2765\u4028t;\u6993\u0280achmt\u2773\u2776\u277C\u2785\u2787r\xF2\u08A8orne\xF2\u1D8Car\u0100;d\u0F98\u2783;\u696D;\u600Eri;\u62BF\u0300achiqt\u2798\u279D\u0A40\u27A2\u27AE\u27BBquo;\u6039r;\uC000\u{1D4C1}m\u0180;eg\u09B2\u27AA\u27AC;\u6A8D;\u6A8F\u0100bu\u252A\u27B3o\u0100;r\u0E1F\u27B9;\u601Arok;\u4142\u8400<;cdhilqr\u082B\u27D2\u2639\u27DC\u27E0\u27E5\u27EA\u27F0\u0100ci\u27D7\u27D9;\u6AA6r;\u6A79re\xE5\u25F2mes;\u62C9arr;\u6976uest;\u6A7B\u0100Pi\u27F5\u27F9ar;\u6996\u0180;ef\u2800\u092D\u181B\u65C3r\u0100du\u2807\u280Dshar;\u694Ahar;\u6966\u0100en\u2817\u2821rtneqq;\uC000\u2268\uFE00\xC5\u281E\u0700Dacdefhilnopsu\u2840\u2845\u2882\u288E\u2893\u28A0\u28A5\u28A8\u28DA\u28E2\u28E4\u0A83\u28F3\u2902Dot;\u623A\u0200clpr\u284E\u2852\u2863\u287Dr\u803B\xAF\u40AF\u0100et\u2857\u2859;\u6642\u0100;e\u285E\u285F\u6720se\xBB\u285F\u0100;s\u103B\u2868to\u0200;dlu\u103B\u2873\u2877\u287Bow\xEE\u048Cef\xF4\u090F\xF0\u13D1ker;\u65AE\u0100oy\u2887\u288Cmma;\u6A29;\u443Cash;\u6014asuredangle\xBB\u1626r;\uC000\u{1D52A}o;\u6127\u0180cdn\u28AF\u28B4\u28C9ro\u803B\xB5\u40B5\u0200;acd\u1464\u28BD\u28C0\u28C4s\xF4\u16A7ir;\u6AF0ot\u80BB\xB7\u01B5us\u0180;bd\u28D2\u1903\u28D3\u6212\u0100;u\u1D3C\u28D8;\u6A2A\u0163\u28DE\u28E1p;\u6ADB\xF2\u2212\xF0\u0A81\u0100dp\u28E9\u28EEels;\u62A7f;\uC000\u{1D55E}\u0100ct\u28F8\u28FDr;\uC000\u{1D4C2}pos\xBB\u159D\u0180;lm\u2909\u290A\u290D\u43BCtimap;\u62B8\u0C00GLRVabcdefghijlmoprstuvw\u2942\u2953\u297E\u2989\u2998\u29DA\u29E9\u2A15\u2A1A\u2A58\u2A5D\u2A83\u2A95\u2AA4\u2AA8\u2B04\u2B07\u2B44\u2B7F\u2BAE\u2C34\u2C67\u2C7C\u2CE9\u0100gt\u2947\u294B;\uC000\u22D9\u0338\u0100;v\u2950\u0BCF\uC000\u226B\u20D2\u0180elt\u295A\u2972\u2976ft\u0100ar\u2961\u2967rrow;\u61CDightarrow;\u61CE;\uC000\u22D8\u0338\u0100;v\u297B\u0C47\uC000\u226A\u20D2ightarrow;\u61CF\u0100Dd\u298E\u2993ash;\u62AFash;\u62AE\u0280bcnpt\u29A3\u29A7\u29AC\u29B1\u29CCla\xBB\u02DEute;\u4144g;\uC000\u2220\u20D2\u0280;Eiop\u0D84\u29BC\u29C0\u29C5\u29C8;\uC000\u2A70\u0338d;\uC000\u224B\u0338s;\u4149ro\xF8\u0D84ur\u0100;a\u29D3\u29D4\u666El\u0100;s\u29D3\u0B38\u01F3\u29DF\0\u29E3p\u80BB\xA0\u0B37mp\u0100;e\u0BF9\u0C00\u0280aeouy\u29F4\u29FE\u2A03\u2A10\u2A13\u01F0\u29F9\0\u29FB;\u6A43on;\u4148dil;\u4146ng\u0100;d\u0D7E\u2A0Aot;\uC000\u2A6D\u0338p;\u6A42;\u443Dash;\u6013\u0380;Aadqsx\u0B92\u2A29\u2A2D\u2A3B\u2A41\u2A45\u2A50rr;\u61D7r\u0100hr\u2A33\u2A36k;\u6924\u0100;o\u13F2\u13F0ot;\uC000\u2250\u0338ui\xF6\u0B63\u0100ei\u2A4A\u2A4Ear;\u6928\xED\u0B98ist\u0100;s\u0BA0\u0B9Fr;\uC000\u{1D52B}\u0200Eest\u0BC5\u2A66\u2A79\u2A7C\u0180;qs\u0BBC\u2A6D\u0BE1\u0180;qs\u0BBC\u0BC5\u2A74lan\xF4\u0BE2i\xED\u0BEA\u0100;r\u0BB6\u2A81\xBB\u0BB7\u0180Aap\u2A8A\u2A8D\u2A91r\xF2\u2971rr;\u61AEar;\u6AF2\u0180;sv\u0F8D\u2A9C\u0F8C\u0100;d\u2AA1\u2AA2\u62FC;\u62FAcy;\u445A\u0380AEadest\u2AB7\u2ABA\u2ABE\u2AC2\u2AC5\u2AF6\u2AF9r\xF2\u2966;\uC000\u2266\u0338rr;\u619Ar;\u6025\u0200;fqs\u0C3B\u2ACE\u2AE3\u2AEFt\u0100ar\u2AD4\u2AD9rro\xF7\u2AC1ightarro\xF7\u2A90\u0180;qs\u0C3B\u2ABA\u2AEAlan\xF4\u0C55\u0100;s\u0C55\u2AF4\xBB\u0C36i\xED\u0C5D\u0100;r\u0C35\u2AFEi\u0100;e\u0C1A\u0C25i\xE4\u0D90\u0100pt\u2B0C\u2B11f;\uC000\u{1D55F}\u8180\xAC;in\u2B19\u2B1A\u2B36\u40ACn\u0200;Edv\u0B89\u2B24\u2B28\u2B2E;\uC000\u22F9\u0338ot;\uC000\u22F5\u0338\u01E1\u0B89\u2B33\u2B35;\u62F7;\u62F6i\u0100;v\u0CB8\u2B3C\u01E1\u0CB8\u2B41\u2B43;\u62FE;\u62FD\u0180aor\u2B4B\u2B63\u2B69r\u0200;ast\u0B7B\u2B55\u2B5A\u2B5Flle\xEC\u0B7Bl;\uC000\u2AFD\u20E5;\uC000\u2202\u0338lint;\u6A14\u0180;ce\u0C92\u2B70\u2B73u\xE5\u0CA5\u0100;c\u0C98\u2B78\u0100;e\u0C92\u2B7D\xF1\u0C98\u0200Aait\u2B88\u2B8B\u2B9D\u2BA7r\xF2\u2988rr\u0180;cw\u2B94\u2B95\u2B99\u619B;\uC000\u2933\u0338;\uC000\u219D\u0338ghtarrow\xBB\u2B95ri\u0100;e\u0CCB\u0CD6\u0380chimpqu\u2BBD\u2BCD\u2BD9\u2B04\u0B78\u2BE4\u2BEF\u0200;cer\u0D32\u2BC6\u0D37\u2BC9u\xE5\u0D45;\uC000\u{1D4C3}ort\u026D\u2B05\0\0\u2BD6ar\xE1\u2B56m\u0100;e\u0D6E\u2BDF\u0100;q\u0D74\u0D73su\u0100bp\u2BEB\u2BED\xE5\u0CF8\xE5\u0D0B\u0180bcp\u2BF6\u2C11\u2C19\u0200;Ees\u2BFF\u2C00\u0D22\u2C04\u6284;\uC000\u2AC5\u0338et\u0100;e\u0D1B\u2C0Bq\u0100;q\u0D23\u2C00c\u0100;e\u0D32\u2C17\xF1\u0D38\u0200;Ees\u2C22\u2C23\u0D5F\u2C27\u6285;\uC000\u2AC6\u0338et\u0100;e\u0D58\u2C2Eq\u0100;q\u0D60\u2C23\u0200gilr\u2C3D\u2C3F\u2C45\u2C47\xEC\u0BD7lde\u803B\xF1\u40F1\xE7\u0C43iangle\u0100lr\u2C52\u2C5Ceft\u0100;e\u0C1A\u2C5A\xF1\u0C26ight\u0100;e\u0CCB\u2C65\xF1\u0CD7\u0100;m\u2C6C\u2C6D\u43BD\u0180;es\u2C74\u2C75\u2C79\u4023ro;\u6116p;\u6007\u0480DHadgilrs\u2C8F\u2C94\u2C99\u2C9E\u2CA3\u2CB0\u2CB6\u2CD3\u2CE3ash;\u62ADarr;\u6904p;\uC000\u224D\u20D2ash;\u62AC\u0100et\u2CA8\u2CAC;\uC000\u2265\u20D2;\uC000>\u20D2nfin;\u69DE\u0180Aet\u2CBD\u2CC1\u2CC5rr;\u6902;\uC000\u2264\u20D2\u0100;r\u2CCA\u2CCD\uC000<\u20D2ie;\uC000\u22B4\u20D2\u0100At\u2CD8\u2CDCrr;\u6903rie;\uC000\u22B5\u20D2im;\uC000\u223C\u20D2\u0180Aan\u2CF0\u2CF4\u2D02rr;\u61D6r\u0100hr\u2CFA\u2CFDk;\u6923\u0100;o\u13E7\u13E5ear;\u6927\u1253\u1A95\0\0\0\0\0\0\0\0\0\0\0\0\0\u2D2D\0\u2D38\u2D48\u2D60\u2D65\u2D72\u2D84\u1B07\0\0\u2D8D\u2DAB\0\u2DC8\u2DCE\0\u2DDC\u2E19\u2E2B\u2E3E\u2E43\u0100cs\u2D31\u1A97ute\u803B\xF3\u40F3\u0100iy\u2D3C\u2D45r\u0100;c\u1A9E\u2D42\u803B\xF4\u40F4;\u443E\u0280abios\u1AA0\u2D52\u2D57\u01C8\u2D5Alac;\u4151v;\u6A38old;\u69BClig;\u4153\u0100cr\u2D69\u2D6Dir;\u69BF;\uC000\u{1D52C}\u036F\u2D79\0\0\u2D7C\0\u2D82n;\u42DBave\u803B\xF2\u40F2;\u69C1\u0100bm\u2D88\u0DF4ar;\u69B5\u0200acit\u2D95\u2D98\u2DA5\u2DA8r\xF2\u1A80\u0100ir\u2D9D\u2DA0r;\u69BEoss;\u69BBn\xE5\u0E52;\u69C0\u0180aei\u2DB1\u2DB5\u2DB9cr;\u414Dga;\u43C9\u0180cdn\u2DC0\u2DC5\u01CDron;\u43BF;\u69B6pf;\uC000\u{1D560}\u0180ael\u2DD4\u2DD7\u01D2r;\u69B7rp;\u69B9\u0380;adiosv\u2DEA\u2DEB\u2DEE\u2E08\u2E0D\u2E10\u2E16\u6228r\xF2\u1A86\u0200;efm\u2DF7\u2DF8\u2E02\u2E05\u6A5Dr\u0100;o\u2DFE\u2DFF\u6134f\xBB\u2DFF\u803B\xAA\u40AA\u803B\xBA\u40BAgof;\u62B6r;\u6A56lope;\u6A57;\u6A5B\u0180clo\u2E1F\u2E21\u2E27\xF2\u2E01ash\u803B\xF8\u40F8l;\u6298i\u016C\u2E2F\u2E34de\u803B\xF5\u40F5es\u0100;a\u01DB\u2E3As;\u6A36ml\u803B\xF6\u40F6bar;\u633D\u0AE1\u2E5E\0\u2E7D\0\u2E80\u2E9D\0\u2EA2\u2EB9\0\0\u2ECB\u0E9C\0\u2F13\0\0\u2F2B\u2FBC\0\u2FC8r\u0200;ast\u0403\u2E67\u2E72\u0E85\u8100\xB6;l\u2E6D\u2E6E\u40B6le\xEC\u0403\u0269\u2E78\0\0\u2E7Bm;\u6AF3;\u6AFDy;\u443Fr\u0280cimpt\u2E8B\u2E8F\u2E93\u1865\u2E97nt;\u4025od;\u402Eil;\u6030enk;\u6031r;\uC000\u{1D52D}\u0180imo\u2EA8\u2EB0\u2EB4\u0100;v\u2EAD\u2EAE\u43C6;\u43D5ma\xF4\u0A76ne;\u660E\u0180;tv\u2EBF\u2EC0\u2EC8\u43C0chfork\xBB\u1FFD;\u43D6\u0100au\u2ECF\u2EDFn\u0100ck\u2ED5\u2EDDk\u0100;h\u21F4\u2EDB;\u610E\xF6\u21F4s\u0480;abcdemst\u2EF3\u2EF4\u1908\u2EF9\u2EFD\u2F04\u2F06\u2F0A\u2F0E\u402Bcir;\u6A23ir;\u6A22\u0100ou\u1D40\u2F02;\u6A25;\u6A72n\u80BB\xB1\u0E9Dim;\u6A26wo;\u6A27\u0180ipu\u2F19\u2F20\u2F25ntint;\u6A15f;\uC000\u{1D561}nd\u803B\xA3\u40A3\u0500;Eaceinosu\u0EC8\u2F3F\u2F41\u2F44\u2F47\u2F81\u2F89\u2F92\u2F7E\u2FB6;\u6AB3p;\u6AB7u\xE5\u0ED9\u0100;c\u0ECE\u2F4C\u0300;acens\u0EC8\u2F59\u2F5F\u2F66\u2F68\u2F7Eppro\xF8\u2F43urlye\xF1\u0ED9\xF1\u0ECE\u0180aes\u2F6F\u2F76\u2F7Approx;\u6AB9qq;\u6AB5im;\u62E8i\xED\u0EDFme\u0100;s\u2F88\u0EAE\u6032\u0180Eas\u2F78\u2F90\u2F7A\xF0\u2F75\u0180dfp\u0EEC\u2F99\u2FAF\u0180als\u2FA0\u2FA5\u2FAAlar;\u632Eine;\u6312urf;\u6313\u0100;t\u0EFB\u2FB4\xEF\u0EFBrel;\u62B0\u0100ci\u2FC0\u2FC5r;\uC000\u{1D4C5};\u43C8ncsp;\u6008\u0300fiopsu\u2FDA\u22E2\u2FDF\u2FE5\u2FEB\u2FF1r;\uC000\u{1D52E}pf;\uC000\u{1D562}rime;\u6057cr;\uC000\u{1D4C6}\u0180aeo\u2FF8\u3009\u3013t\u0100ei\u2FFE\u3005rnion\xF3\u06B0nt;\u6A16st\u0100;e\u3010\u3011\u403F\xF1\u1F19\xF4\u0F14\u0A80ABHabcdefhilmnoprstux\u3040\u3051\u3055\u3059\u30E0\u310E\u312B\u3147\u3162\u3172\u318E\u3206\u3215\u3224\u3229\u3258\u326E\u3272\u3290\u32B0\u32B7\u0180art\u3047\u304A\u304Cr\xF2\u10B3\xF2\u03DDail;\u691Car\xF2\u1C65ar;\u6964\u0380cdenqrt\u3068\u3075\u3078\u307F\u308F\u3094\u30CC\u0100eu\u306D\u3071;\uC000\u223D\u0331te;\u4155i\xE3\u116Emptyv;\u69B3g\u0200;del\u0FD1\u3089\u308B\u308D;\u6992;\u69A5\xE5\u0FD1uo\u803B\xBB\u40BBr\u0580;abcfhlpstw\u0FDC\u30AC\u30AF\u30B7\u30B9\u30BC\u30BE\u30C0\u30C3\u30C7\u30CAp;\u6975\u0100;f\u0FE0\u30B4s;\u6920;\u6933s;\u691E\xEB\u225D\xF0\u272El;\u6945im;\u6974l;\u61A3;\u619D\u0100ai\u30D1\u30D5il;\u691Ao\u0100;n\u30DB\u30DC\u6236al\xF3\u0F1E\u0180abr\u30E7\u30EA\u30EEr\xF2\u17E5rk;\u6773\u0100ak\u30F3\u30FDc\u0100ek\u30F9\u30FB;\u407D;\u405D\u0100es\u3102\u3104;\u698Cl\u0100du\u310A\u310C;\u698E;\u6990\u0200aeuy\u3117\u311C\u3127\u3129ron;\u4159\u0100di\u3121\u3125il;\u4157\xEC\u0FF2\xE2\u30FA;\u4440\u0200clqs\u3134\u3137\u313D\u3144a;\u6937dhar;\u6969uo\u0100;r\u020E\u020Dh;\u61B3\u0180acg\u314E\u315F\u0F44l\u0200;ips\u0F78\u3158\u315B\u109Cn\xE5\u10BBar\xF4\u0FA9t;\u65AD\u0180ilr\u3169\u1023\u316Esht;\u697D;\uC000\u{1D52F}\u0100ao\u3177\u3186r\u0100du\u317D\u317F\xBB\u047B\u0100;l\u1091\u3184;\u696C\u0100;v\u318B\u318C\u43C1;\u43F1\u0180gns\u3195\u31F9\u31FCht\u0300ahlrst\u31A4\u31B0\u31C2\u31D8\u31E4\u31EErrow\u0100;t\u0FDC\u31ADa\xE9\u30C8arpoon\u0100du\u31BB\u31BFow\xEE\u317Ep\xBB\u1092eft\u0100ah\u31CA\u31D0rrow\xF3\u0FEAarpoon\xF3\u0551ightarrows;\u61C9quigarro\xF7\u30CBhreetimes;\u62CCg;\u42DAingdotse\xF1\u1F32\u0180ahm\u320D\u3210\u3213r\xF2\u0FEAa\xF2\u0551;\u600Foust\u0100;a\u321E\u321F\u63B1che\xBB\u321Fmid;\u6AEE\u0200abpt\u3232\u323D\u3240\u3252\u0100nr\u3237\u323Ag;\u67EDr;\u61FEr\xEB\u1003\u0180afl\u3247\u324A\u324Er;\u6986;\uC000\u{1D563}us;\u6A2Eimes;\u6A35\u0100ap\u325D\u3267r\u0100;g\u3263\u3264\u4029t;\u6994olint;\u6A12ar\xF2\u31E3\u0200achq\u327B\u3280\u10BC\u3285quo;\u603Ar;\uC000\u{1D4C7}\u0100bu\u30FB\u328Ao\u0100;r\u0214\u0213\u0180hir\u3297\u329B\u32A0re\xE5\u31F8mes;\u62CAi\u0200;efl\u32AA\u1059\u1821\u32AB\u65B9tri;\u69CEluhar;\u6968;\u611E\u0D61\u32D5\u32DB\u32DF\u332C\u3338\u3371\0\u337A\u33A4\0\0\u33EC\u33F0\0\u3428\u3448\u345A\u34AD\u34B1\u34CA\u34F1\0\u3616\0\0\u3633cute;\u415Bqu\xEF\u27BA\u0500;Eaceinpsy\u11ED\u32F3\u32F5\u32FF\u3302\u330B\u330F\u331F\u3326\u3329;\u6AB4\u01F0\u32FA\0\u32FC;\u6AB8on;\u4161u\xE5\u11FE\u0100;d\u11F3\u3307il;\u415Frc;\u415D\u0180Eas\u3316\u3318\u331B;\u6AB6p;\u6ABAim;\u62E9olint;\u6A13i\xED\u1204;\u4441ot\u0180;be\u3334\u1D47\u3335\u62C5;\u6A66\u0380Aacmstx\u3346\u334A\u3357\u335B\u335E\u3363\u336Drr;\u61D8r\u0100hr\u3350\u3352\xEB\u2228\u0100;o\u0A36\u0A34t\u803B\xA7\u40A7i;\u403Bwar;\u6929m\u0100in\u3369\xF0nu\xF3\xF1t;\u6736r\u0100;o\u3376\u2055\uC000\u{1D530}\u0200acoy\u3382\u3386\u3391\u33A0rp;\u666F\u0100hy\u338B\u338Fcy;\u4449;\u4448rt\u026D\u3399\0\0\u339Ci\xE4\u1464ara\xEC\u2E6F\u803B\xAD\u40AD\u0100gm\u33A8\u33B4ma\u0180;fv\u33B1\u33B2\u33B2\u43C3;\u43C2\u0400;deglnpr\u12AB\u33C5\u33C9\u33CE\u33D6\u33DE\u33E1\u33E6ot;\u6A6A\u0100;q\u12B1\u12B0\u0100;E\u33D3\u33D4\u6A9E;\u6AA0\u0100;E\u33DB\u33DC\u6A9D;\u6A9Fe;\u6246lus;\u6A24arr;\u6972ar\xF2\u113D\u0200aeit\u33F8\u3408\u340F\u3417\u0100ls\u33FD\u3404lsetm\xE9\u336Ahp;\u6A33parsl;\u69E4\u0100dl\u1463\u3414e;\u6323\u0100;e\u341C\u341D\u6AAA\u0100;s\u3422\u3423\u6AAC;\uC000\u2AAC\uFE00\u0180flp\u342E\u3433\u3442tcy;\u444C\u0100;b\u3438\u3439\u402F\u0100;a\u343E\u343F\u69C4r;\u633Ff;\uC000\u{1D564}a\u0100dr\u344D\u0402es\u0100;u\u3454\u3455\u6660it\xBB\u3455\u0180csu\u3460\u3479\u349F\u0100au\u3465\u346Fp\u0100;s\u1188\u346B;\uC000\u2293\uFE00p\u0100;s\u11B4\u3475;\uC000\u2294\uFE00u\u0100bp\u347F\u348F\u0180;es\u1197\u119C\u3486et\u0100;e\u1197\u348D\xF1\u119D\u0180;es\u11A8\u11AD\u3496et\u0100;e\u11A8\u349D\xF1\u11AE\u0180;af\u117B\u34A6\u05B0r\u0165\u34AB\u05B1\xBB\u117Car\xF2\u1148\u0200cemt\u34B9\u34BE\u34C2\u34C5r;\uC000\u{1D4C8}tm\xEE\xF1i\xEC\u3415ar\xE6\u11BE\u0100ar\u34CE\u34D5r\u0100;f\u34D4\u17BF\u6606\u0100an\u34DA\u34EDight\u0100ep\u34E3\u34EApsilo\xEE\u1EE0h\xE9\u2EAFs\xBB\u2852\u0280bcmnp\u34FB\u355E\u1209\u358B\u358E\u0480;Edemnprs\u350E\u350F\u3511\u3515\u351E\u3523\u352C\u3531\u3536\u6282;\u6AC5ot;\u6ABD\u0100;d\u11DA\u351Aot;\u6AC3ult;\u6AC1\u0100Ee\u3528\u352A;\u6ACB;\u628Alus;\u6ABFarr;\u6979\u0180eiu\u353D\u3552\u3555t\u0180;en\u350E\u3545\u354Bq\u0100;q\u11DA\u350Feq\u0100;q\u352B\u3528m;\u6AC7\u0100bp\u355A\u355C;\u6AD5;\u6AD3c\u0300;acens\u11ED\u356C\u3572\u3579\u357B\u3326ppro\xF8\u32FAurlye\xF1\u11FE\xF1\u11F3\u0180aes\u3582\u3588\u331Bppro\xF8\u331Aq\xF1\u3317g;\u666A\u0680123;Edehlmnps\u35A9\u35AC\u35AF\u121C\u35B2\u35B4\u35C0\u35C9\u35D5\u35DA\u35DF\u35E8\u35ED\u803B\xB9\u40B9\u803B\xB2\u40B2\u803B\xB3\u40B3;\u6AC6\u0100os\u35B9\u35BCt;\u6ABEub;\u6AD8\u0100;d\u1222\u35C5ot;\u6AC4s\u0100ou\u35CF\u35D2l;\u67C9b;\u6AD7arr;\u697Bult;\u6AC2\u0100Ee\u35E4\u35E6;\u6ACC;\u628Blus;\u6AC0\u0180eiu\u35F4\u3609\u360Ct\u0180;en\u121C\u35FC\u3602q\u0100;q\u1222\u35B2eq\u0100;q\u35E7\u35E4m;\u6AC8\u0100bp\u3611\u3613;\u6AD4;\u6AD6\u0180Aan\u361C\u3620\u362Drr;\u61D9r\u0100hr\u3626\u3628\xEB\u222E\u0100;o\u0A2B\u0A29war;\u692Alig\u803B\xDF\u40DF\u0BE1\u3651\u365D\u3660\u12CE\u3673\u3679\0\u367E\u36C2\0\0\0\0\0\u36DB\u3703\0\u3709\u376C\0\0\0\u3787\u0272\u3656\0\0\u365Bget;\u6316;\u43C4r\xEB\u0E5F\u0180aey\u3666\u366B\u3670ron;\u4165dil;\u4163;\u4442lrec;\u6315r;\uC000\u{1D531}\u0200eiko\u3686\u369D\u36B5\u36BC\u01F2\u368B\0\u3691e\u01004f\u1284\u1281a\u0180;sv\u3698\u3699\u369B\u43B8ym;\u43D1\u0100cn\u36A2\u36B2k\u0100as\u36A8\u36AEppro\xF8\u12C1im\xBB\u12ACs\xF0\u129E\u0100as\u36BA\u36AE\xF0\u12C1rn\u803B\xFE\u40FE\u01EC\u031F\u36C6\u22E7es\u8180\xD7;bd\u36CF\u36D0\u36D8\u40D7\u0100;a\u190F\u36D5r;\u6A31;\u6A30\u0180eps\u36E1\u36E3\u3700\xE1\u2A4D\u0200;bcf\u0486\u36EC\u36F0\u36F4ot;\u6336ir;\u6AF1\u0100;o\u36F9\u36FC\uC000\u{1D565}rk;\u6ADA\xE1\u3362rime;\u6034\u0180aip\u370F\u3712\u3764d\xE5\u1248\u0380adempst\u3721\u374D\u3740\u3751\u3757\u375C\u375Fngle\u0280;dlqr\u3730\u3731\u3736\u3740\u3742\u65B5own\xBB\u1DBBeft\u0100;e\u2800\u373E\xF1\u092E;\u625Cight\u0100;e\u32AA\u374B\xF1\u105Aot;\u65ECinus;\u6A3Alus;\u6A39b;\u69CDime;\u6A3Bezium;\u63E2\u0180cht\u3772\u377D\u3781\u0100ry\u3777\u377B;\uC000\u{1D4C9};\u4446cy;\u445Brok;\u4167\u0100io\u378B\u378Ex\xF4\u1777head\u0100lr\u3797\u37A0eftarro\xF7\u084Fightarrow\xBB\u0F5D\u0900AHabcdfghlmoprstuw\u37D0\u37D3\u37D7\u37E4\u37F0\u37FC\u380E\u381C\u3823\u3834\u3851\u385D\u386B\u38A9\u38CC\u38D2\u38EA\u38F6r\xF2\u03EDar;\u6963\u0100cr\u37DC\u37E2ute\u803B\xFA\u40FA\xF2\u1150r\u01E3\u37EA\0\u37EDy;\u445Eve;\u416D\u0100iy\u37F5\u37FArc\u803B\xFB\u40FB;\u4443\u0180abh\u3803\u3806\u380Br\xF2\u13ADlac;\u4171a\xF2\u13C3\u0100ir\u3813\u3818sht;\u697E;\uC000\u{1D532}rave\u803B\xF9\u40F9\u0161\u3827\u3831r\u0100lr\u382C\u382E\xBB\u0957\xBB\u1083lk;\u6580\u0100ct\u3839\u384D\u026F\u383F\0\0\u384Arn\u0100;e\u3845\u3846\u631Cr\xBB\u3846op;\u630Fri;\u65F8\u0100al\u3856\u385Acr;\u416B\u80BB\xA8\u0349\u0100gp\u3862\u3866on;\u4173f;\uC000\u{1D566}\u0300adhlsu\u114B\u3878\u387D\u1372\u3891\u38A0own\xE1\u13B3arpoon\u0100lr\u3888\u388Cef\xF4\u382Digh\xF4\u382Fi\u0180;hl\u3899\u389A\u389C\u43C5\xBB\u13FAon\xBB\u389Aparrows;\u61C8\u0180cit\u38B0\u38C4\u38C8\u026F\u38B6\0\0\u38C1rn\u0100;e\u38BC\u38BD\u631Dr\xBB\u38BDop;\u630Eng;\u416Fri;\u65F9cr;\uC000\u{1D4CA}\u0180dir\u38D9\u38DD\u38E2ot;\u62F0lde;\u4169i\u0100;f\u3730\u38E8\xBB\u1813\u0100am\u38EF\u38F2r\xF2\u38A8l\u803B\xFC\u40FCangle;\u69A7\u0780ABDacdeflnoprsz\u391C\u391F\u3929\u392D\u39B5\u39B8\u39BD\u39DF\u39E4\u39E8\u39F3\u39F9\u39FD\u3A01\u3A20r\xF2\u03F7ar\u0100;v\u3926\u3927\u6AE8;\u6AE9as\xE8\u03E1\u0100nr\u3932\u3937grt;\u699C\u0380eknprst\u34E3\u3946\u394B\u3952\u395D\u3964\u3996app\xE1\u2415othin\xE7\u1E96\u0180hir\u34EB\u2EC8\u3959op\xF4\u2FB5\u0100;h\u13B7\u3962\xEF\u318D\u0100iu\u3969\u396Dgm\xE1\u33B3\u0100bp\u3972\u3984setneq\u0100;q\u397D\u3980\uC000\u228A\uFE00;\uC000\u2ACB\uFE00setneq\u0100;q\u398F\u3992\uC000\u228B\uFE00;\uC000\u2ACC\uFE00\u0100hr\u399B\u399Fet\xE1\u369Ciangle\u0100lr\u39AA\u39AFeft\xBB\u0925ight\xBB\u1051y;\u4432ash\xBB\u1036\u0180elr\u39C4\u39D2\u39D7\u0180;be\u2DEA\u39CB\u39CFar;\u62BBq;\u625Alip;\u62EE\u0100bt\u39DC\u1468a\xF2\u1469r;\uC000\u{1D533}tr\xE9\u39AEsu\u0100bp\u39EF\u39F1\xBB\u0D1C\xBB\u0D59pf;\uC000\u{1D567}ro\xF0\u0EFBtr\xE9\u39B4\u0100cu\u3A06\u3A0Br;\uC000\u{1D4CB}\u0100bp\u3A10\u3A18n\u0100Ee\u3980\u3A16\xBB\u397En\u0100Ee\u3992\u3A1E\xBB\u3990igzag;\u699A\u0380cefoprs\u3A36\u3A3B\u3A56\u3A5B\u3A54\u3A61\u3A6Airc;\u4175\u0100di\u3A40\u3A51\u0100bg\u3A45\u3A49ar;\u6A5Fe\u0100;q\u15FA\u3A4F;\u6259erp;\u6118r;\uC000\u{1D534}pf;\uC000\u{1D568}\u0100;e\u1479\u3A66at\xE8\u1479cr;\uC000\u{1D4CC}\u0AE3\u178E\u3A87\0\u3A8B\0\u3A90\u3A9B\0\0\u3A9D\u3AA8\u3AAB\u3AAF\0\0\u3AC3\u3ACE\0\u3AD8\u17DC\u17DFtr\xE9\u17D1r;\uC000\u{1D535}\u0100Aa\u3A94\u3A97r\xF2\u03C3r\xF2\u09F6;\u43BE\u0100Aa\u3AA1\u3AA4r\xF2\u03B8r\xF2\u09EBa\xF0\u2713is;\u62FB\u0180dpt\u17A4\u3AB5\u3ABE\u0100fl\u3ABA\u17A9;\uC000\u{1D569}im\xE5\u17B2\u0100Aa\u3AC7\u3ACAr\xF2\u03CEr\xF2\u0A01\u0100cq\u3AD2\u17B8r;\uC000\u{1D4CD}\u0100pt\u17D6\u3ADCr\xE9\u17D4\u0400acefiosu\u3AF0\u3AFD\u3B08\u3B0C\u3B11\u3B15\u3B1B\u3B21c\u0100uy\u3AF6\u3AFBte\u803B\xFD\u40FD;\u444F\u0100iy\u3B02\u3B06rc;\u4177;\u444Bn\u803B\xA5\u40A5r;\uC000\u{1D536}cy;\u4457pf;\uC000\u{1D56A}cr;\uC000\u{1D4CE}\u0100cm\u3B26\u3B29y;\u444El\u803B\xFF\u40FF\u0500acdefhiosw\u3B42\u3B48\u3B54\u3B58\u3B64\u3B69\u3B6D\u3B74\u3B7A\u3B80cute;\u417A\u0100ay\u3B4D\u3B52ron;\u417E;\u4437ot;\u417C\u0100et\u3B5D\u3B61tr\xE6\u155Fa;\u43B6r;\uC000\u{1D537}cy;\u4436grarr;\u61DDpf;\uC000\u{1D56B}cr;\uC000\u{1D4CF}\u0100jn\u3B85\u3B87;\u600Dj;\u600C'.split("").map(function(i){return i.charCodeAt(0)}))});var Qy=et(Gd=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});Gd.default=new Uint16Array("\u0200aglq	\x1B\u026D\0\0p;\u4026os;\u4027t;\u403Et;\u403Cuot;\u4022".split("").map(function(i){return i.charCodeAt(0)}))});var Yd=et(oi=>{"use strict";var jd;Object.defineProperty(oi,"__esModule",{value:!0});oi.replaceCodePoint=oi.fromCodePoint=void 0;var MR=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);oi.fromCodePoint=(jd=String.fromCodePoint)!==null&&jd!==void 0?jd:function(i){var t="";return i>65535&&(i-=65536,t+=String.fromCharCode(i>>>10&1023|55296),i=56320|i&1023),t+=String.fromCharCode(i),t};function ev(i){var t;return i>=55296&&i<=57343||i>1114111?65533:(t=MR.get(i))!==null&&t!==void 0?t:i}oi.replaceCodePoint=ev;function TR(i){return(0,oi.fromCodePoint)(ev(i))}oi.default=TR});var Qd=et(ge=>{"use strict";var CR=ge&&ge.__createBinding||(Object.create?function(i,t,e,n){n===void 0&&(n=e);var r=Object.getOwnPropertyDescriptor(t,e);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(i,n,r)}:function(i,t,e,n){n===void 0&&(n=e),i[n]=t[e]}),LR=ge&&ge.__setModuleDefault||(Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t}),RR=ge&&ge.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var e in i)e!=="default"&&Object.prototype.hasOwnProperty.call(i,e)&&CR(t,i,e);return LR(t,i),t},tv=ge&&ge.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ge,"__esModule",{value:!0});ge.decodeXML=ge.decodeHTMLStrict=ge.decodeHTMLAttribute=ge.decodeHTML=ge.determineBranch=ge.EntityDecoder=ge.DecodingMode=ge.BinTrieFlags=ge.fromCodePoint=ge.replaceCodePoint=ge.decodeCodePoint=ge.xmlDecodeTree=ge.htmlDecodeTree=void 0;var nv=tv(Zy());ge.htmlDecodeTree=nv.default;var iv=tv(Qy());ge.xmlDecodeTree=iv.default;var Jd=RR(Yd());ge.decodeCodePoint=Jd.default;var rv=Yd();Object.defineProperty(ge,"replaceCodePoint",{enumerable:!0,get:function(){return rv.replaceCodePoint}});Object.defineProperty(ge,"fromCodePoint",{enumerable:!0,get:function(){return rv.fromCodePoint}});var Je;(function(i){i[i.NUM=35]="NUM",i[i.SEMI=59]="SEMI",i[i.EQUALS=61]="EQUALS",i[i.ZERO=48]="ZERO",i[i.NINE=57]="NINE",i[i.LOWER_A=97]="LOWER_A",i[i.LOWER_F=102]="LOWER_F",i[i.LOWER_X=120]="LOWER_X",i[i.LOWER_Z=122]="LOWER_Z",i[i.UPPER_A=65]="UPPER_A",i[i.UPPER_F=70]="UPPER_F",i[i.UPPER_Z=90]="UPPER_Z"})(Je||(Je={}));var AR=32,Hi;(function(i){i[i.VALUE_LENGTH=49152]="VALUE_LENGTH",i[i.BRANCH_LENGTH=16256]="BRANCH_LENGTH",i[i.JUMP_TABLE=127]="JUMP_TABLE"})(Hi=ge.BinTrieFlags||(ge.BinTrieFlags={}));function Xd(i){return i>=Je.ZERO&&i<=Je.NINE}function IR(i){return i>=Je.UPPER_A&&i<=Je.UPPER_F||i>=Je.LOWER_A&&i<=Je.LOWER_F}function NR(i){return i>=Je.UPPER_A&&i<=Je.UPPER_Z||i>=Je.LOWER_A&&i<=Je.LOWER_Z||Xd(i)}function PR(i){return i===Je.EQUALS||NR(i)}var Xe;(function(i){i[i.EntityStart=0]="EntityStart",i[i.NumericStart=1]="NumericStart",i[i.NumericDecimal=2]="NumericDecimal",i[i.NumericHex=3]="NumericHex",i[i.NamedEntity=4]="NamedEntity"})(Xe||(Xe={}));var gn;(function(i){i[i.Legacy=0]="Legacy",i[i.Strict=1]="Strict",i[i.Attribute=2]="Attribute"})(gn=ge.DecodingMode||(ge.DecodingMode={}));var ov=function(){function i(t,e,n){this.decodeTree=t,this.emitCodePoint=e,this.errors=n,this.state=Xe.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=gn.Strict}return i.prototype.startEntity=function(t){this.decodeMode=t,this.state=Xe.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},i.prototype.write=function(t,e){switch(this.state){case Xe.EntityStart:return t.charCodeAt(e)===Je.NUM?(this.state=Xe.NumericStart,this.consumed+=1,this.stateNumericStart(t,e+1)):(this.state=Xe.NamedEntity,this.stateNamedEntity(t,e));case Xe.NumericStart:return this.stateNumericStart(t,e);case Xe.NumericDecimal:return this.stateNumericDecimal(t,e);case Xe.NumericHex:return this.stateNumericHex(t,e);case Xe.NamedEntity:return this.stateNamedEntity(t,e)}},i.prototype.stateNumericStart=function(t,e){return e>=t.length?-1:(t.charCodeAt(e)|AR)===Je.LOWER_X?(this.state=Xe.NumericHex,this.consumed+=1,this.stateNumericHex(t,e+1)):(this.state=Xe.NumericDecimal,this.stateNumericDecimal(t,e))},i.prototype.addToNumericResult=function(t,e,n,r){if(e!==n){var o=n-e;this.result=this.result*Math.pow(r,o)+parseInt(t.substr(e,o),r),this.consumed+=o}},i.prototype.stateNumericHex=function(t,e){for(var n=e;e<t.length;){var r=t.charCodeAt(e);if(Xd(r)||IR(r))e+=1;else return this.addToNumericResult(t,n,e,16),this.emitNumericEntity(r,3)}return this.addToNumericResult(t,n,e,16),-1},i.prototype.stateNumericDecimal=function(t,e){for(var n=e;e<t.length;){var r=t.charCodeAt(e);if(Xd(r))e+=1;else return this.addToNumericResult(t,n,e,10),this.emitNumericEntity(r,2)}return this.addToNumericResult(t,n,e,10),-1},i.prototype.emitNumericEntity=function(t,e){var n;if(this.consumed<=e)return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===Je.SEMI)this.consumed+=1;else if(this.decodeMode===gn.Strict)return 0;return this.emitCodePoint((0,Jd.replaceCodePoint)(this.result),this.consumed),this.errors&&(t!==Je.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},i.prototype.stateNamedEntity=function(t,e){for(var n=this.decodeTree,r=n[this.treeIndex],o=(r&Hi.VALUE_LENGTH)>>14;e<t.length;e++,this.excess++){var s=t.charCodeAt(e);if(this.treeIndex=av(n,r,this.treeIndex+Math.max(1,o),s),this.treeIndex<0)return this.result===0||this.decodeMode===gn.Attribute&&(o===0||PR(s))?0:this.emitNotTerminatedNamedEntity();if(r=n[this.treeIndex],o=(r&Hi.VALUE_LENGTH)>>14,o!==0){if(s===Je.SEMI)return this.emitNamedEntityData(this.treeIndex,o,this.consumed+this.excess);this.decodeMode!==gn.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},i.prototype.emitNotTerminatedNamedEntity=function(){var t,e=this,n=e.result,r=e.decodeTree,o=(r[n]&Hi.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,o,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed},i.prototype.emitNamedEntityData=function(t,e,n){var r=this.decodeTree;return this.emitCodePoint(e===1?r[t]&~Hi.VALUE_LENGTH:r[t+1],n),e===3&&this.emitCodePoint(r[t+2],n),n},i.prototype.end=function(){var t;switch(this.state){case Xe.NamedEntity:return this.result!==0&&(this.decodeMode!==gn.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Xe.NumericDecimal:return this.emitNumericEntity(0,2);case Xe.NumericHex:return this.emitNumericEntity(0,3);case Xe.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Xe.EntityStart:return 0}},i}();ge.EntityDecoder=ov;function sv(i){var t="",e=new ov(i,function(n){return t+=(0,Jd.fromCodePoint)(n)});return function(r,o){for(var s=0,a=0;(a=r.indexOf("&",a))>=0;){t+=r.slice(s,a),e.startEntity(o);var l=e.write(r,a+1);if(l<0){s=a+e.end();break}s=a+l,a=l===0?s+1:s}var c=t+r.slice(s);return t="",c}}function av(i,t,e,n){var r=(t&Hi.BRANCH_LENGTH)>>7,o=t&Hi.JUMP_TABLE;if(r===0)return o!==0&&n===o?e:-1;if(o){var s=n-o;return s<0||s>=r?-1:i[e+s]-1}for(var a=e,l=a+r-1;a<=l;){var c=a+l>>>1,u=i[c];if(u<n)a=c+1;else if(u>n)l=c-1;else return i[c+r]}return-1}ge.determineBranch=av;var Zd=sv(nv.default),_R=sv(iv.default);function OR(i,t){return t===void 0&&(t=gn.Legacy),Zd(i,t)}ge.decodeHTML=OR;function DR(i){return Zd(i,gn.Attribute)}ge.decodeHTMLAttribute=DR;function BR(i){return Zd(i,gn.Strict)}ge.decodeHTMLStrict=BR;function FR(i){return _R(i,gn.Strict)}ge.decodeXML=FR});var lv=et(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0});function Xa(i){for(var t=1;t<i.length;t++)i[t][0]+=i[t-1][0]+1;return i}eh.default=new Map(Xa([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(Xa([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(Xa([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(Xa([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]))});var Ja=et(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.escapeText=je.escapeAttribute=je.escapeUTF8=je.escape=je.encodeXML=je.getCodePoint=je.xmlReplacer=void 0;je.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var cv=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);je.getCodePoint=String.prototype.codePointAt!=null?function(i,t){return i.codePointAt(t)}:function(i,t){return(i.charCodeAt(t)&64512)===55296?(i.charCodeAt(t)-55296)*1024+i.charCodeAt(t+1)-56320+65536:i.charCodeAt(t)};function uv(i){for(var t="",e=0,n;(n=je.xmlReplacer.exec(i))!==null;){var r=n.index,o=i.charCodeAt(r),s=cv.get(o);s!==void 0?(t+=i.substring(e,r)+s,e=r+1):(t+="".concat(i.substring(e,r),"&#x").concat((0,je.getCodePoint)(i,r).toString(16),";"),e=je.xmlReplacer.lastIndex+=Number((o&64512)===55296))}return t+i.substr(e)}je.encodeXML=uv;je.escape=uv;function th(i,t){return function(n){for(var r,o=0,s="";r=i.exec(n);)o!==r.index&&(s+=n.substring(o,r.index)),s+=t.get(r[0].charCodeAt(0)),o=r.index+1;return s+n.substring(o)}}je.escapeUTF8=th(/[&<>'"]/g,cv);je.escapeAttribute=th(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]]));je.escapeText=th(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))});var nh=et(si=>{"use strict";var HR=si&&si.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(si,"__esModule",{value:!0});si.encodeNonAsciiHTML=si.encodeHTML=void 0;var zR=HR(lv()),dv=Ja(),VR=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function $R(i){return hv(VR,i)}si.encodeHTML=$R;function WR(i){return hv(dv.xmlReplacer,i)}si.encodeNonAsciiHTML=WR;function hv(i,t){for(var e="",n=0,r;(r=i.exec(t))!==null;){var o=r.index;e+=t.substring(n,o);var s=t.charCodeAt(o),a=zR.default.get(s);if(typeof a=="object"){if(o+1<t.length){var l=t.charCodeAt(o+1),c=typeof a.n=="number"?a.n===l?a.o:void 0:a.n.get(l);if(c!==void 0){e+=c,n=i.lastIndex+=1;continue}}a=a.v}if(a!==void 0)e+=a,n=o+1;else{var u=(0,dv.getCodePoint)(t,o);e+="&#x".concat(u.toString(16),";"),n=i.lastIndex+=Number(u!==s)}}return e+t.substr(n)}});var mv=et(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.decodeXMLStrict=ee.decodeHTML5Strict=ee.decodeHTML4Strict=ee.decodeHTML5=ee.decodeHTML4=ee.decodeHTMLAttribute=ee.decodeHTMLStrict=ee.decodeHTML=ee.decodeXML=ee.DecodingMode=ee.EntityDecoder=ee.encodeHTML5=ee.encodeHTML4=ee.encodeNonAsciiHTML=ee.encodeHTML=ee.escapeText=ee.escapeAttribute=ee.escapeUTF8=ee.escape=ee.encodeXML=ee.encode=ee.decodeStrict=ee.decode=ee.EncodingMode=ee.EntityLevel=void 0;var ih=Qd(),pv=nh(),Za=Ja(),Mr;(function(i){i[i.XML=0]="XML",i[i.HTML=1]="HTML"})(Mr=ee.EntityLevel||(ee.EntityLevel={}));var No;(function(i){i[i.UTF8=0]="UTF8",i[i.ASCII=1]="ASCII",i[i.Extensive=2]="Extensive",i[i.Attribute=3]="Attribute",i[i.Text=4]="Text"})(No=ee.EncodingMode||(ee.EncodingMode={}));function fv(i,t){t===void 0&&(t=Mr.XML);var e=typeof t=="number"?t:t.level;if(e===Mr.HTML){var n=typeof t=="object"?t.mode:void 0;return(0,ih.decodeHTML)(i,n)}return(0,ih.decodeXML)(i)}ee.decode=fv;function UR(i,t){var e;t===void 0&&(t=Mr.XML);var n=typeof t=="number"?{level:t}:t;return(e=n.mode)!==null&&e!==void 0||(n.mode=ih.DecodingMode.Strict),fv(i,n)}ee.decodeStrict=UR;function KR(i,t){t===void 0&&(t=Mr.XML);var e=typeof t=="number"?{level:t}:t;return e.mode===No.UTF8?(0,Za.escapeUTF8)(i):e.mode===No.Attribute?(0,Za.escapeAttribute)(i):e.mode===No.Text?(0,Za.escapeText)(i):e.level===Mr.HTML?e.mode===No.ASCII?(0,pv.encodeNonAsciiHTML)(i):(0,pv.encodeHTML)(i):(0,Za.encodeXML)(i)}ee.encode=KR;var Po=Ja();Object.defineProperty(ee,"encodeXML",{enumerable:!0,get:function(){return Po.encodeXML}});Object.defineProperty(ee,"escape",{enumerable:!0,get:function(){return Po.escape}});Object.defineProperty(ee,"escapeUTF8",{enumerable:!0,get:function(){return Po.escapeUTF8}});Object.defineProperty(ee,"escapeAttribute",{enumerable:!0,get:function(){return Po.escapeAttribute}});Object.defineProperty(ee,"escapeText",{enumerable:!0,get:function(){return Po.escapeText}});var Qa=nh();Object.defineProperty(ee,"encodeHTML",{enumerable:!0,get:function(){return Qa.encodeHTML}});Object.defineProperty(ee,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Qa.encodeNonAsciiHTML}});Object.defineProperty(ee,"encodeHTML4",{enumerable:!0,get:function(){return Qa.encodeHTML}});Object.defineProperty(ee,"encodeHTML5",{enumerable:!0,get:function(){return Qa.encodeHTML}});var Jt=Qd();Object.defineProperty(ee,"EntityDecoder",{enumerable:!0,get:function(){return Jt.EntityDecoder}});Object.defineProperty(ee,"DecodingMode",{enumerable:!0,get:function(){return Jt.DecodingMode}});Object.defineProperty(ee,"decodeXML",{enumerable:!0,get:function(){return Jt.decodeXML}});Object.defineProperty(ee,"decodeHTML",{enumerable:!0,get:function(){return Jt.decodeHTML}});Object.defineProperty(ee,"decodeHTMLStrict",{enumerable:!0,get:function(){return Jt.decodeHTMLStrict}});Object.defineProperty(ee,"decodeHTMLAttribute",{enumerable:!0,get:function(){return Jt.decodeHTMLAttribute}});Object.defineProperty(ee,"decodeHTML4",{enumerable:!0,get:function(){return Jt.decodeHTML}});Object.defineProperty(ee,"decodeHTML5",{enumerable:!0,get:function(){return Jt.decodeHTML}});Object.defineProperty(ee,"decodeHTML4Strict",{enumerable:!0,get:function(){return Jt.decodeHTMLStrict}});Object.defineProperty(ee,"decodeHTML5Strict",{enumerable:!0,get:function(){return Jt.decodeHTMLStrict}});Object.defineProperty(ee,"decodeXMLStrict",{enumerable:!0,get:function(){return Jt.decodeXML}})});var Ev=et((g4,vv)=>{"use strict";var el=Kd();function qR(i){let t={};i=i||{},t.src_Any=el.Any.source,t.src_Cc=el.Cc.source,t.src_Z=el.Z.source,t.src_P=el.P.source,t.src_ZPCc=[t.src_Z,t.src_P,t.src_Cc].join("|"),t.src_ZCc=[t.src_Z,t.src_Cc].join("|");let e="[><\uFF5C]";return t.src_pseudo_letter="(?:(?!"+e+"|"+t.src_ZPCc+")"+t.src_Any+")",t.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",t.src_auth="(?:(?:(?!"+t.src_ZCc+"|[@/\\[\\]()]).)+@)?",t.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",t.src_host_terminator="(?=$|"+e+"|"+t.src_ZPCc+")(?!"+(i["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+t.src_ZPCc+"))",t.src_path="(?:[/?#](?:(?!"+t.src_ZCc+"|"+e+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+t.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+t.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+t.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+t.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+t.src_ZCc+"|[']).)+\\'|\\'(?="+t.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+t.src_ZCc+"|[.]|$)|"+(i["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+t.src_ZCc+"|$)|;(?!"+t.src_ZCc+"|$)|\\!+(?!"+t.src_ZCc+"|[!]|$)|\\?(?!"+t.src_ZCc+"|[?]|$))+|\\/)?",t.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',t.src_xn="xn--[a-z0-9\\-]{1,59}",t.src_domain_root="(?:"+t.src_xn+"|"+t.src_pseudo_letter+"{1,63})",t.src_domain="(?:"+t.src_xn+"|(?:"+t.src_pseudo_letter+")|(?:"+t.src_pseudo_letter+"(?:-|"+t.src_pseudo_letter+"){0,61}"+t.src_pseudo_letter+"))",t.src_host="(?:(?:(?:(?:"+t.src_domain+")\\.)*"+t.src_domain+"))",t.tpl_host_fuzzy="(?:"+t.src_ip4+"|(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%)))",t.tpl_host_no_ip_fuzzy="(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))",t.src_host_strict=t.src_host+t.src_host_terminator,t.tpl_host_fuzzy_strict=t.tpl_host_fuzzy+t.src_host_terminator,t.src_host_port_strict=t.src_host+t.src_port+t.src_host_terminator,t.tpl_host_port_fuzzy_strict=t.tpl_host_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_port_no_ip_fuzzy_strict=t.tpl_host_no_ip_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+t.src_ZPCc+"|>|$))",t.tpl_email_fuzzy="(^|"+e+'|"|\\(|'+t.src_ZCc+")("+t.src_email_name+"@"+t.tpl_host_fuzzy_strict+")",t.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+t.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+t.tpl_host_port_fuzzy_strict+t.src_path+")",t.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+t.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+t.tpl_host_port_no_ip_fuzzy_strict+t.src_path+")",t}function rh(i){return Array.prototype.slice.call(arguments,1).forEach(function(e){e&&Object.keys(e).forEach(function(n){i[n]=e[n]})}),i}function nl(i){return Object.prototype.toString.call(i)}function GR(i){return nl(i)==="[object String]"}function jR(i){return nl(i)==="[object Object]"}function YR(i){return nl(i)==="[object RegExp]"}function gv(i){return nl(i)==="[object Function]"}function XR(i){return i.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var yv={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function JR(i){return Object.keys(i||{}).reduce(function(t,e){return t||yv.hasOwnProperty(e)},!1)}var ZR={"http:":{validate:function(i,t,e){let n=i.slice(t);return e.re.http||(e.re.http=new RegExp("^\\/\\/"+e.re.src_auth+e.re.src_host_port_strict+e.re.src_path,"i")),e.re.http.test(n)?n.match(e.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(i,t,e){let n=i.slice(t);return e.re.no_http||(e.re.no_http=new RegExp("^"+e.re.src_auth+"(?:localhost|(?:(?:"+e.re.src_domain+")\\.)+"+e.re.src_domain_root+")"+e.re.src_port+e.re.src_host_terminator+e.re.src_path,"i")),e.re.no_http.test(n)?t>=3&&i[t-3]===":"||t>=3&&i[t-3]==="/"?0:n.match(e.re.no_http)[0].length:0}},"mailto:":{validate:function(i,t,e){let n=i.slice(t);return e.re.mailto||(e.re.mailto=new RegExp("^"+e.re.src_email_name+"@"+e.re.src_host_strict,"i")),e.re.mailto.test(n)?n.match(e.re.mailto)[0].length:0}}},QR="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",eA="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|\u0440\u0444".split("|");function tA(i){i.__index__=-1,i.__text_cache__=""}function nA(i){return function(t,e){let n=t.slice(e);return i.test(n)?n.match(i)[0].length:0}}function bv(){return function(i,t){t.normalize(i)}}function tl(i){let t=i.re=qR(i.__opts__),e=i.__tlds__.slice();i.onCompile(),i.__tlds_replaced__||e.push(QR),e.push(t.src_xn),t.src_tlds=e.join("|");function n(a){return a.replace("%TLDS%",t.src_tlds)}t.email_fuzzy=RegExp(n(t.tpl_email_fuzzy),"i"),t.link_fuzzy=RegExp(n(t.tpl_link_fuzzy),"i"),t.link_no_ip_fuzzy=RegExp(n(t.tpl_link_no_ip_fuzzy),"i"),t.host_fuzzy_test=RegExp(n(t.tpl_host_fuzzy_test),"i");let r=[];i.__compiled__={};function o(a,l){throw new Error('(LinkifyIt) Invalid schema "'+a+'": '+l)}Object.keys(i.__schemas__).forEach(function(a){let l=i.__schemas__[a];if(l===null)return;let c={validate:null,link:null};if(i.__compiled__[a]=c,jR(l)){YR(l.validate)?c.validate=nA(l.validate):gv(l.validate)?c.validate=l.validate:o(a,l),gv(l.normalize)?c.normalize=l.normalize:l.normalize?o(a,l):c.normalize=bv();return}if(GR(l)){r.push(a);return}o(a,l)}),r.forEach(function(a){i.__compiled__[i.__schemas__[a]]&&(i.__compiled__[a].validate=i.__compiled__[i.__schemas__[a]].validate,i.__compiled__[a].normalize=i.__compiled__[i.__schemas__[a]].normalize)}),i.__compiled__[""]={validate:null,normalize:bv()};let s=Object.keys(i.__compiled__).filter(function(a){return a.length>0&&i.__compiled__[a]}).map(XR).join("|");i.re.schema_test=RegExp("(^|(?!_)(?:[><\uFF5C]|"+t.src_ZPCc+"))("+s+")","i"),i.re.schema_search=RegExp("(^|(?!_)(?:[><\uFF5C]|"+t.src_ZPCc+"))("+s+")","ig"),i.re.schema_at_start=RegExp("^"+i.re.schema_search.source,"i"),i.re.pretest=RegExp("("+i.re.schema_test.source+")|("+i.re.host_fuzzy_test.source+")|@","i"),tA(i)}function iA(i,t){let e=i.__index__,n=i.__last_index__,r=i.__text_cache__.slice(e,n);this.schema=i.__schema__.toLowerCase(),this.index=e+t,this.lastIndex=n+t,this.raw=r,this.text=r,this.url=r}function oh(i,t){let e=new iA(i,t);return i.__compiled__[e.schema].normalize(e,i),e}function Nt(i,t){if(!(this instanceof Nt))return new Nt(i,t);t||JR(i)&&(t=i,i={}),this.__opts__=rh({},yv,t),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=rh({},ZR,i),this.__compiled__={},this.__tlds__=eA,this.__tlds_replaced__=!1,this.re={},tl(this)}Nt.prototype.add=function(t,e){return this.__schemas__[t]=e,tl(this),this};Nt.prototype.set=function(t){return this.__opts__=rh(this.__opts__,t),this};Nt.prototype.test=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return!1;let e,n,r,o,s,a,l,c,u;if(this.re.schema_test.test(t)){for(l=this.re.schema_search,l.lastIndex=0;(e=l.exec(t))!==null;)if(o=this.testSchemaAt(t,e[2],l.lastIndex),o){this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+o;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(c=t.search(this.re.host_fuzzy_test),c>=0&&(this.__index__<0||c<this.__index__)&&(n=t.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(s=n.index+n[1].length,(this.__index__<0||s<this.__index__)&&(this.__schema__="",this.__index__=s,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(u=t.indexOf("@"),u>=0&&(r=t.match(this.re.email_fuzzy))!==null&&(s=r.index+r[1].length,a=r.index+r[0].length,(this.__index__<0||s<this.__index__||s===this.__index__&&a>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=s,this.__last_index__=a))),this.__index__>=0};Nt.prototype.pretest=function(t){return this.re.pretest.test(t)};Nt.prototype.testSchemaAt=function(t,e,n){return this.__compiled__[e.toLowerCase()]?this.__compiled__[e.toLowerCase()].validate(t,n,this):0};Nt.prototype.match=function(t){let e=[],n=0;this.__index__>=0&&this.__text_cache__===t&&(e.push(oh(this,n)),n=this.__last_index__);let r=n?t.slice(n):t;for(;this.test(r);)e.push(oh(this,n)),r=r.slice(this.__last_index__),n+=this.__last_index__;return e.length?e:null};Nt.prototype.matchAtStart=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return null;let e=this.re.schema_at_start.exec(t);if(!e)return null;let n=this.testSchemaAt(t,e[2],e[0].length);return n?(this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+n,oh(this,0)):null};Nt.prototype.tlds=function(t,e){return t=Array.isArray(t)?t:[t],e?(this.__tlds__=this.__tlds__.concat(t).sort().filter(function(n,r,o){return n!==o[r-1]}).reverse(),tl(this),this):(this.__tlds__=t.slice(),this.__tlds_replaced__=!0,tl(this),this)};Nt.prototype.normalize=function(t){t.schema||(t.url="http://"+t.url),t.schema==="mailto:"&&!/^mailto:/i.test(t.url)&&(t.url="mailto:"+t.url)};Nt.prototype.onCompile=function(){};vv.exports=Nt});var Rv=et((b4,Lv)=>{"use strict";var Sv="-",rA=/^xn--/,oA=/[^\0-\x7F]/,sA=/[\x2E\u3002\uFF0E\uFF61]/g,aA={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},sh=36-1,bn=Math.floor,ah=String.fromCharCode;function ai(i){throw new RangeError(aA[i])}function lA(i,t){let e=[],n=i.length;for(;n--;)e[n]=t(i[n]);return e}function kv(i,t){let e=i.split("@"),n="";e.length>1&&(n=e[0]+"@",i=e[1]),i=i.replace(sA,".");let r=i.split("."),o=lA(r,t).join(".");return n+o}function wv(i){let t=[],e=0,n=i.length;for(;e<n;){let r=i.charCodeAt(e++);if(r>=55296&&r<=56319&&e<n){let o=i.charCodeAt(e++);(o&64512)==56320?t.push(((r&1023)<<10)+(o&1023)+65536):(t.push(r),e--)}else t.push(r)}return t}var cA=i=>String.fromCodePoint(...i),uA=function(i){return i>=48&&i<58?26+(i-48):i>=65&&i<91?i-65:i>=97&&i<123?i-97:36},xv=function(i,t){return i+22+75*(i<26)-((t!=0)<<5)},Mv=function(i,t,e){let n=0;for(i=e?bn(i/700):i>>1,i+=bn(i/t);i>sh*26>>1;n+=36)i=bn(i/sh);return bn(n+(sh+1)*i/(i+38))},Tv=function(i){let t=[],e=i.length,n=0,r=128,o=72,s=i.lastIndexOf(Sv);s<0&&(s=0);for(let a=0;a<s;++a)i.charCodeAt(a)>=128&&ai("not-basic"),t.push(i.charCodeAt(a));for(let a=s>0?s+1:0;a<e;){let l=n;for(let u=1,d=36;;d+=36){a>=e&&ai("invalid-input");let h=uA(i.charCodeAt(a++));h>=36&&ai("invalid-input"),h>bn((2147483647-n)/u)&&ai("overflow"),n+=h*u;let f=d<=o?1:d>=o+26?26:d-o;if(h<f)break;let p=36-f;u>bn(2147483647/p)&&ai("overflow"),u*=p}let c=t.length+1;o=Mv(n-l,c,l==0),bn(n/c)>2147483647-r&&ai("overflow"),r+=bn(n/c),n%=c,t.splice(n++,0,r)}return String.fromCodePoint(...t)},Cv=function(i){let t=[];i=wv(i);let e=i.length,n=128,r=0,o=72;for(let l of i)l<128&&t.push(ah(l));let s=t.length,a=s;for(s&&t.push(Sv);a<e;){let l=2147483647;for(let u of i)u>=n&&u<l&&(l=u);let c=a+1;l-n>bn((2147483647-r)/c)&&ai("overflow"),r+=(l-n)*c,n=l;for(let u of i)if(u<n&&++r>2147483647&&ai("overflow"),u===n){let d=r;for(let h=36;;h+=36){let f=h<=o?1:h>=o+26?26:h-o;if(d<f)break;let p=d-f,m=36-f;t.push(ah(xv(f+p%m,0))),d=bn(p/m)}t.push(ah(xv(d,0))),o=Mv(r,c,a===s),r=0,++a}++r,++n}return t.join("")},dA=function(i){return kv(i,function(t){return rA.test(t)?Tv(t.slice(4).toLowerCase()):t})},hA=function(i){return kv(i,function(t){return oA.test(t)?"xn--"+Cv(t):t})},pA={version:"2.3.1",ucs2:{decode:wv,encode:cA},decode:Tv,encode:Cv,toASCII:hA,toUnicode:dA};Lv.exports=pA});var Jv=et((y4,Xv)=>{"use strict";var fA=Jy(),mA=Kd(),Fv=mv(),gA=Ev(),Hv=Rv();function zv(i){var t=Object.create(null);return i&&Object.keys(i).forEach(function(e){if(e!=="default"){var n=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,n.get?n:{enumerable:!0,get:function(){return i[e]}})}}),t.default=i,Object.freeze(t)}var li=zv(fA),hh=zv(mA);function bA(i){return Object.prototype.toString.call(i)}function ph(i){return bA(i)==="[object String]"}var yA=Object.prototype.hasOwnProperty;function vA(i,t){return yA.call(i,t)}function sl(i){return Array.prototype.slice.call(arguments,1).forEach(function(e){if(e){if(typeof e!="object")throw new TypeError(e+"must be object");Object.keys(e).forEach(function(n){i[n]=e[n]})}}),i}function Vv(i,t,e){return[].concat(i.slice(0,t),e,i.slice(t+1))}function fh(i){return!(i>=55296&&i<=57343||i>=64976&&i<=65007||(i&65535)===65535||(i&65535)===65534||i>=0&&i<=8||i===11||i>=14&&i<=31||i>=127&&i<=159||i>1114111)}function ol(i){if(i>65535){i-=65536;let t=55296+(i>>10),e=56320+(i&1023);return String.fromCharCode(t,e)}return String.fromCharCode(i)}var $v=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,EA=/&([a-z#][a-z0-9]{1,31});/gi,xA=new RegExp($v.source+"|"+EA.source,"gi"),SA=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function kA(i,t){if(t.charCodeAt(0)===35&&SA.test(t)){let n=t[1].toLowerCase()==="x"?parseInt(t.slice(2),16):parseInt(t.slice(1),10);return fh(n)?ol(n):i}let e=Fv.decodeHTML(i);return e!==i?e:i}function wA(i){return i.indexOf("\\")<0?i:i.replace($v,"$1")}function Cr(i){return i.indexOf("\\")<0&&i.indexOf("&")<0?i:i.replace(xA,function(t,e,n){return e||kA(t,n)})}var MA=/[&<>"]/,TA=/[&<>"]/g,CA={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function LA(i){return CA[i]}function ci(i){return MA.test(i)?i.replace(TA,LA):i}var RA=/[.?*+^$[\]\\(){}|-]/g;function AA(i){return i.replace(RA,"\\$&")}function Re(i){switch(i){case 9:case 32:return!0}return!1}function _o(i){if(i>=8192&&i<=8202)return!0;switch(i){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function Oo(i){return hh.P.test(i)||hh.S.test(i)}function Do(i){switch(i){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function al(i){return i=i.trim().replace(/\s+/g," "),"\u1E9E".toLowerCase()==="\u1E7E"&&(i=i.replace(//g,"\xDF")),i.toLowerCase().toUpperCase()}var IA={mdurl:li,ucmicro:hh},NA=Object.freeze({__proto__:null,arrayReplaceAt:Vv,assign:sl,escapeHtml:ci,escapeRE:AA,fromCodePoint:ol,has:vA,isMdAsciiPunct:Do,isPunctChar:Oo,isSpace:Re,isString:ph,isValidEntityCode:fh,isWhiteSpace:_o,lib:IA,normalizeReference:al,unescapeAll:Cr,unescapeMd:wA});function PA(i,t,e){let n,r,o,s,a=i.posMax,l=i.pos;for(i.pos=t+1,n=1;i.pos<a;){if(o=i.src.charCodeAt(i.pos),o===93&&(n--,n===0)){r=!0;break}if(s=i.pos,i.md.inline.skipToken(i),o===91){if(s===i.pos-1)n++;else if(e)return i.pos=l,-1}}let c=-1;return r&&(c=i.pos),i.pos=l,c}function _A(i,t,e){let n,r=t,o={ok:!1,pos:0,str:""};if(i.charCodeAt(r)===60){for(r++;r<e;){if(n=i.charCodeAt(r),n===10||n===60)return o;if(n===62)return o.pos=r+1,o.str=Cr(i.slice(t+1,r)),o.ok=!0,o;if(n===92&&r+1<e){r+=2;continue}r++}return o}let s=0;for(;r<e&&(n=i.charCodeAt(r),!(n===32||n<32||n===127));){if(n===92&&r+1<e){if(i.charCodeAt(r+1)===32)break;r+=2;continue}if(n===40&&(s++,s>32))return o;if(n===41){if(s===0)break;s--}r++}return t===r||s!==0||(o.str=Cr(i.slice(t,r)),o.pos=r,o.ok=!0),o}function OA(i,t,e,n){let r,o=t,s={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(n)s.str=n.str,s.marker=n.marker;else{if(o>=e)return s;let a=i.charCodeAt(o);if(a!==34&&a!==39&&a!==40)return s;t++,o++,a===40&&(a=41),s.marker=a}for(;o<e;){if(r=i.charCodeAt(o),r===s.marker)return s.pos=o+1,s.str+=Cr(i.slice(t,o)),s.ok=!0,s;if(r===40&&s.marker===41)return s;r===92&&o+1<e&&o++,o++}return s.can_continue=!0,s.str+=Cr(i.slice(t,o)),s}var DA=Object.freeze({__proto__:null,parseLinkDestination:_A,parseLinkLabel:PA,parseLinkTitle:OA}),yn={};yn.code_inline=function(i,t,e,n,r){let o=i[t];return"<code"+r.renderAttrs(o)+">"+ci(o.content)+"</code>"};yn.code_block=function(i,t,e,n,r){let o=i[t];return"<pre"+r.renderAttrs(o)+"><code>"+ci(i[t].content)+`</code></pre>
`};yn.fence=function(i,t,e,n,r){let o=i[t],s=o.info?Cr(o.info).trim():"",a="",l="";if(s){let u=s.split(/(\s+)/g);a=u[0],l=u.slice(2).join("")}let c;if(e.highlight?c=e.highlight(o.content,a,l)||ci(o.content):c=ci(o.content),c.indexOf("<pre")===0)return c+`
`;if(s){let u=o.attrIndex("class"),d=o.attrs?o.attrs.slice():[];u<0?d.push(["class",e.langPrefix+a]):(d[u]=d[u].slice(),d[u][1]+=" "+e.langPrefix+a);let h={attrs:d};return`<pre><code${r.renderAttrs(h)}>${c}</code></pre>
`}return`<pre><code${r.renderAttrs(o)}>${c}</code></pre>
`};yn.image=function(i,t,e,n,r){let o=i[t];return o.attrs[o.attrIndex("alt")][1]=r.renderInlineAsText(o.children,e,n),r.renderToken(i,t,e)};yn.hardbreak=function(i,t,e){return e.xhtmlOut?`<br />
`:`<br>
`};yn.softbreak=function(i,t,e){return e.breaks?e.xhtmlOut?`<br />
`:`<br>
`:`
`};yn.text=function(i,t){return ci(i[t].content)};yn.html_block=function(i,t){return i[t].content};yn.html_inline=function(i,t){return i[t].content};function Lr(){this.rules=sl({},yn)}Lr.prototype.renderAttrs=function(t){let e,n,r;if(!t.attrs)return"";for(r="",e=0,n=t.attrs.length;e<n;e++)r+=" "+ci(t.attrs[e][0])+'="'+ci(t.attrs[e][1])+'"';return r};Lr.prototype.renderToken=function(t,e,n){let r=t[e],o="";if(r.hidden)return"";r.block&&r.nesting!==-1&&e&&t[e-1].hidden&&(o+=`
`),o+=(r.nesting===-1?"</":"<")+r.tag,o+=this.renderAttrs(r),r.nesting===0&&n.xhtmlOut&&(o+=" /");let s=!1;if(r.block&&(s=!0,r.nesting===1&&e+1<t.length)){let a=t[e+1];(a.type==="inline"||a.hidden||a.nesting===-1&&a.tag===r.tag)&&(s=!1)}return o+=s?`>
`:">",o};Lr.prototype.renderInline=function(i,t,e){let n="",r=this.rules;for(let o=0,s=i.length;o<s;o++){let a=i[o].type;typeof r[a]!="undefined"?n+=r[a](i,o,t,e,this):n+=this.renderToken(i,o,t)}return n};Lr.prototype.renderInlineAsText=function(i,t,e){let n="";for(let r=0,o=i.length;r<o;r++)switch(i[r].type){case"text":n+=i[r].content;break;case"image":n+=this.renderInlineAsText(i[r].children,t,e);break;case"html_inline":case"html_block":n+=i[r].content;break;case"softbreak":case"hardbreak":n+=`
`;break}return n};Lr.prototype.render=function(i,t,e){let n="",r=this.rules;for(let o=0,s=i.length;o<s;o++){let a=i[o].type;a==="inline"?n+=this.renderInline(i[o].children,t,e):typeof r[a]!="undefined"?n+=r[a](i,o,t,e,this):n+=this.renderToken(i,o,t,e)}return n};function Mt(){this.__rules__=[],this.__cache__=null}Mt.prototype.__find__=function(i){for(let t=0;t<this.__rules__.length;t++)if(this.__rules__[t].name===i)return t;return-1};Mt.prototype.__compile__=function(){let i=this,t=[""];i.__rules__.forEach(function(e){e.enabled&&e.alt.forEach(function(n){t.indexOf(n)<0&&t.push(n)})}),i.__cache__={},t.forEach(function(e){i.__cache__[e]=[],i.__rules__.forEach(function(n){n.enabled&&(e&&n.alt.indexOf(e)<0||i.__cache__[e].push(n.fn))})})};Mt.prototype.at=function(i,t,e){let n=this.__find__(i),r=e||{};if(n===-1)throw new Error("Parser rule not found: "+i);this.__rules__[n].fn=t,this.__rules__[n].alt=r.alt||[],this.__cache__=null};Mt.prototype.before=function(i,t,e,n){let r=this.__find__(i),o=n||{};if(r===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(r,0,{name:t,enabled:!0,fn:e,alt:o.alt||[]}),this.__cache__=null};Mt.prototype.after=function(i,t,e,n){let r=this.__find__(i),o=n||{};if(r===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(r+1,0,{name:t,enabled:!0,fn:e,alt:o.alt||[]}),this.__cache__=null};Mt.prototype.push=function(i,t,e){let n=e||{};this.__rules__.push({name:i,enabled:!0,fn:t,alt:n.alt||[]}),this.__cache__=null};Mt.prototype.enable=function(i,t){Array.isArray(i)||(i=[i]);let e=[];return i.forEach(function(n){let r=this.__find__(n);if(r<0){if(t)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[r].enabled=!0,e.push(n)},this),this.__cache__=null,e};Mt.prototype.enableOnly=function(i,t){Array.isArray(i)||(i=[i]),this.__rules__.forEach(function(e){e.enabled=!1}),this.enable(i,t)};Mt.prototype.disable=function(i,t){Array.isArray(i)||(i=[i]);let e=[];return i.forEach(function(n){let r=this.__find__(n);if(r<0){if(t)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[r].enabled=!1,e.push(n)},this),this.__cache__=null,e};Mt.prototype.getRules=function(i){return this.__cache__===null&&this.__compile__(),this.__cache__[i]||[]};function Zt(i,t,e){this.type=i,this.tag=t,this.attrs=null,this.map=null,this.nesting=e,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Zt.prototype.attrIndex=function(t){if(!this.attrs)return-1;let e=this.attrs;for(let n=0,r=e.length;n<r;n++)if(e[n][0]===t)return n;return-1};Zt.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]};Zt.prototype.attrSet=function(t,e){let n=this.attrIndex(t),r=[t,e];n<0?this.attrPush(r):this.attrs[n]=r};Zt.prototype.attrGet=function(t){let e=this.attrIndex(t),n=null;return e>=0&&(n=this.attrs[e][1]),n};Zt.prototype.attrJoin=function(t,e){let n=this.attrIndex(t);n<0?this.attrPush([t,e]):this.attrs[n][1]=this.attrs[n][1]+" "+e};function Wv(i,t,e){this.src=i,this.env=e,this.tokens=[],this.inlineMode=!1,this.md=t}Wv.prototype.Token=Zt;var BA=/\r\n?|\n/g,FA=/\0/g;function HA(i){let t;t=i.src.replace(BA,`
`),t=t.replace(FA,"\uFFFD"),i.src=t}function zA(i){let t;i.inlineMode?(t=new i.Token("inline","",0),t.content=i.src,t.map=[0,1],t.children=[],i.tokens.push(t)):i.md.block.parse(i.src,i.md,i.env,i.tokens)}function VA(i){let t=i.tokens;for(let e=0,n=t.length;e<n;e++){let r=t[e];r.type==="inline"&&i.md.inline.parse(r.content,i.md,i.env,r.children)}}function $A(i){return/^<a[>\s]/i.test(i)}function WA(i){return/^<\/a\s*>/i.test(i)}function UA(i){let t=i.tokens;if(i.md.options.linkify)for(let e=0,n=t.length;e<n;e++){if(t[e].type!=="inline"||!i.md.linkify.pretest(t[e].content))continue;let r=t[e].children,o=0;for(let s=r.length-1;s>=0;s--){let a=r[s];if(a.type==="link_close"){for(s--;r[s].level!==a.level&&r[s].type!=="link_open";)s--;continue}if(a.type==="html_inline"&&($A(a.content)&&o>0&&o--,WA(a.content)&&o++),!(o>0)&&a.type==="text"&&i.md.linkify.test(a.content)){let l=a.content,c=i.md.linkify.match(l),u=[],d=a.level,h=0;c.length>0&&c[0].index===0&&s>0&&r[s-1].type==="text_special"&&(c=c.slice(1));for(let f=0;f<c.length;f++){let p=c[f].url,m=i.md.normalizeLink(p);if(!i.md.validateLink(m))continue;let g=c[f].text;c[f].schema?c[f].schema==="mailto:"&&!/^mailto:/i.test(g)?g=i.md.normalizeLinkText("mailto:"+g).replace(/^mailto:/,""):g=i.md.normalizeLinkText(g):g=i.md.normalizeLinkText("http://"+g).replace(/^http:\/\//,"");let b=c[f].index;if(b>h){let x=new i.Token("text","",0);x.content=l.slice(h,b),x.level=d,u.push(x)}let v=new i.Token("link_open","a",1);v.attrs=[["href",m]],v.level=d++,v.markup="linkify",v.info="auto",u.push(v);let y=new i.Token("text","",0);y.content=g,y.level=d,u.push(y);let E=new i.Token("link_close","a",-1);E.level=--d,E.markup="linkify",E.info="auto",u.push(E),h=c[f].lastIndex}if(h<l.length){let f=new i.Token("text","",0);f.content=l.slice(h),f.level=d,u.push(f)}t[e].children=r=Vv(r,s,u)}}}}var Uv=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,KA=/\((c|tm|r)\)/i,qA=/\((c|tm|r)\)/ig,GA={c:"\xA9",r:"\xAE",tm:"\u2122"};function jA(i,t){return GA[t.toLowerCase()]}function YA(i){let t=0;for(let e=i.length-1;e>=0;e--){let n=i[e];n.type==="text"&&!t&&(n.content=n.content.replace(qA,jA)),n.type==="link_open"&&n.info==="auto"&&t--,n.type==="link_close"&&n.info==="auto"&&t++}}function XA(i){let t=0;for(let e=i.length-1;e>=0;e--){let n=i[e];n.type==="text"&&!t&&Uv.test(n.content)&&(n.content=n.content.replace(/\+-/g,"\xB1").replace(/\.{2,}/g,"\u2026").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1\u2014").replace(/(^|\s)--(?=\s|$)/mg,"$1\u2013").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1\u2013")),n.type==="link_open"&&n.info==="auto"&&t--,n.type==="link_close"&&n.info==="auto"&&t++}}function JA(i){let t;if(i.md.options.typographer)for(t=i.tokens.length-1;t>=0;t--)i.tokens[t].type==="inline"&&(KA.test(i.tokens[t].content)&&YA(i.tokens[t].children),Uv.test(i.tokens[t].content)&&XA(i.tokens[t].children))}var ZA=/['"]/,Av=/['"]/g,Iv="\u2019";function il(i,t,e){return i.slice(0,t)+e+i.slice(t+1)}function QA(i,t){let e,n=[];for(let r=0;r<i.length;r++){let o=i[r],s=i[r].level;for(e=n.length-1;e>=0&&!(n[e].level<=s);e--);if(n.length=e+1,o.type!=="text")continue;let a=o.content,l=0,c=a.length;e:for(;l<c;){Av.lastIndex=l;let u=Av.exec(a);if(!u)break;let d=!0,h=!0;l=u.index+1;let f=u[0]==="'",p=32;if(u.index-1>=0)p=a.charCodeAt(u.index-1);else for(e=r-1;e>=0&&!(i[e].type==="softbreak"||i[e].type==="hardbreak");e--)if(i[e].content){p=i[e].content.charCodeAt(i[e].content.length-1);break}let m=32;if(l<c)m=a.charCodeAt(l);else for(e=r+1;e<i.length&&!(i[e].type==="softbreak"||i[e].type==="hardbreak");e++)if(i[e].content){m=i[e].content.charCodeAt(0);break}let g=Do(p)||Oo(String.fromCharCode(p)),b=Do(m)||Oo(String.fromCharCode(m)),v=_o(p),y=_o(m);if(y?d=!1:b&&(v||g||(d=!1)),v?h=!1:g&&(y||b||(h=!1)),m===34&&u[0]==='"'&&p>=48&&p<=57&&(h=d=!1),d&&h&&(d=g,h=b),!d&&!h){f&&(o.content=il(o.content,u.index,Iv));continue}if(h)for(e=n.length-1;e>=0;e--){let E=n[e];if(n[e].level<s)break;if(E.single===f&&n[e].level===s){E=n[e];let x,S;f?(x=t.md.options.quotes[2],S=t.md.options.quotes[3]):(x=t.md.options.quotes[0],S=t.md.options.quotes[1]),o.content=il(o.content,u.index,S),i[E.token].content=il(i[E.token].content,E.pos,x),l+=S.length-1,E.token===r&&(l+=x.length-1),a=o.content,c=a.length,n.length=e;continue e}}d?n.push({token:r,pos:u.index,single:f,level:s}):h&&f&&(o.content=il(o.content,u.index,Iv))}}}function eI(i){if(i.md.options.typographer)for(let t=i.tokens.length-1;t>=0;t--)i.tokens[t].type!=="inline"||!ZA.test(i.tokens[t].content)||QA(i.tokens[t].children,i)}function tI(i){let t,e,n=i.tokens,r=n.length;for(let o=0;o<r;o++){if(n[o].type!=="inline")continue;let s=n[o].children,a=s.length;for(t=0;t<a;t++)s[t].type==="text_special"&&(s[t].type="text");for(t=e=0;t<a;t++)s[t].type==="text"&&t+1<a&&s[t+1].type==="text"?s[t+1].content=s[t].content+s[t+1].content:(t!==e&&(s[e]=s[t]),e++);t!==e&&(s.length=e)}}var lh=[["normalize",HA],["block",zA],["inline",VA],["linkify",UA],["replacements",JA],["smartquotes",eI],["text_join",tI]];function mh(){this.ruler=new Mt;for(let i=0;i<lh.length;i++)this.ruler.push(lh[i][0],lh[i][1])}mh.prototype.process=function(i){let t=this.ruler.getRules("");for(let e=0,n=t.length;e<n;e++)t[e](i)};mh.prototype.State=Wv;function vn(i,t,e,n){this.src=i,this.md=t,this.env=e,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;let r=this.src;for(let o=0,s=0,a=0,l=0,c=r.length,u=!1;s<c;s++){let d=r.charCodeAt(s);if(!u)if(Re(d)){a++,d===9?l+=4-l%4:l++;continue}else u=!0;(d===10||s===c-1)&&(d!==10&&s++,this.bMarks.push(o),this.eMarks.push(s),this.tShift.push(a),this.sCount.push(l),this.bsCount.push(0),u=!1,a=0,l=0,o=s+1)}this.bMarks.push(r.length),this.eMarks.push(r.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}vn.prototype.push=function(i,t,e){let n=new Zt(i,t,e);return n.block=!0,e<0&&this.level--,n.level=this.level,e>0&&this.level++,this.tokens.push(n),n};vn.prototype.isEmpty=function(t){return this.bMarks[t]+this.tShift[t]>=this.eMarks[t]};vn.prototype.skipEmptyLines=function(t){for(let e=this.lineMax;t<e&&!(this.bMarks[t]+this.tShift[t]<this.eMarks[t]);t++);return t};vn.prototype.skipSpaces=function(t){for(let e=this.src.length;t<e;t++){let n=this.src.charCodeAt(t);if(!Re(n))break}return t};vn.prototype.skipSpacesBack=function(t,e){if(t<=e)return t;for(;t>e;)if(!Re(this.src.charCodeAt(--t)))return t+1;return t};vn.prototype.skipChars=function(t,e){for(let n=this.src.length;t<n&&this.src.charCodeAt(t)===e;t++);return t};vn.prototype.skipCharsBack=function(t,e,n){if(t<=n)return t;for(;t>n;)if(e!==this.src.charCodeAt(--t))return t+1;return t};vn.prototype.getLines=function(t,e,n,r){if(t>=e)return"";let o=new Array(e-t);for(let s=0,a=t;a<e;a++,s++){let l=0,c=this.bMarks[a],u=c,d;for(a+1<e||r?d=this.eMarks[a]+1:d=this.eMarks[a];u<d&&l<n;){let h=this.src.charCodeAt(u);if(Re(h))h===9?l+=4-(l+this.bsCount[a])%4:l++;else if(u-c<this.tShift[a])l++;else break;u++}l>n?o[s]=new Array(l-n+1).join(" ")+this.src.slice(u,d):o[s]=this.src.slice(u,d)}return o.join("")};vn.prototype.Token=Zt;var nI=65536;function ch(i,t){let e=i.bMarks[t]+i.tShift[t],n=i.eMarks[t];return i.src.slice(e,n)}function Nv(i){let t=[],e=i.length,n=0,r=i.charCodeAt(n),o=!1,s=0,a="";for(;n<e;)r===124&&(o?(a+=i.substring(s,n-1),s=n):(t.push(a+i.substring(s,n)),a="",s=n+1)),o=r===92,n++,r=i.charCodeAt(n);return t.push(a+i.substring(s)),t}function iI(i,t,e,n){if(t+2>e)return!1;let r=t+1;if(i.sCount[r]<i.blkIndent||i.sCount[r]-i.blkIndent>=4)return!1;let o=i.bMarks[r]+i.tShift[r];if(o>=i.eMarks[r])return!1;let s=i.src.charCodeAt(o++);if(s!==124&&s!==45&&s!==58||o>=i.eMarks[r])return!1;let a=i.src.charCodeAt(o++);if(a!==124&&a!==45&&a!==58&&!Re(a)||s===45&&Re(a))return!1;for(;o<i.eMarks[r];){let E=i.src.charCodeAt(o);if(E!==124&&E!==45&&E!==58&&!Re(E))return!1;o++}let l=ch(i,t+1),c=l.split("|"),u=[];for(let E=0;E<c.length;E++){let x=c[E].trim();if(!x){if(E===0||E===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(x))return!1;x.charCodeAt(x.length-1)===58?u.push(x.charCodeAt(0)===58?"center":"right"):x.charCodeAt(0)===58?u.push("left"):u.push("")}if(l=ch(i,t).trim(),l.indexOf("|")===-1||i.sCount[t]-i.blkIndent>=4)return!1;c=Nv(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop();let d=c.length;if(d===0||d!==u.length)return!1;if(n)return!0;let h=i.parentType;i.parentType="table";let f=i.md.block.ruler.getRules("blockquote"),p=i.push("table_open","table",1),m=[t,0];p.map=m;let g=i.push("thead_open","thead",1);g.map=[t,t+1];let b=i.push("tr_open","tr",1);b.map=[t,t+1];for(let E=0;E<c.length;E++){let x=i.push("th_open","th",1);u[E]&&(x.attrs=[["style","text-align:"+u[E]]]);let S=i.push("inline","",0);S.content=c[E].trim(),S.children=[],i.push("th_close","th",-1)}i.push("tr_close","tr",-1),i.push("thead_close","thead",-1);let v,y=0;for(r=t+2;r<e&&!(i.sCount[r]<i.blkIndent);r++){let E=!1;for(let S=0,w=f.length;S<w;S++)if(f[S](i,r,e,!0)){E=!0;break}if(E||(l=ch(i,r).trim(),!l)||i.sCount[r]-i.blkIndent>=4||(c=Nv(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop(),y+=d-c.length,y>nI))break;if(r===t+2){let S=i.push("tbody_open","tbody",1);S.map=v=[t+2,0]}let x=i.push("tr_open","tr",1);x.map=[r,r+1];for(let S=0;S<d;S++){let w=i.push("td_open","td",1);u[S]&&(w.attrs=[["style","text-align:"+u[S]]]);let k=i.push("inline","",0);k.content=c[S]?c[S].trim():"",k.children=[],i.push("td_close","td",-1)}i.push("tr_close","tr",-1)}return v&&(i.push("tbody_close","tbody",-1),v[1]=r),i.push("table_close","table",-1),m[1]=r,i.parentType=h,i.line=r,!0}function rI(i,t,e){if(i.sCount[t]-i.blkIndent<4)return!1;let n=t+1,r=n;for(;n<e;){if(i.isEmpty(n)){n++;continue}if(i.sCount[n]-i.blkIndent>=4){n++,r=n;continue}break}i.line=r;let o=i.push("code_block","code",0);return o.content=i.getLines(t,r,4+i.blkIndent,!1)+`
`,o.map=[t,i.line],!0}function oI(i,t,e,n){let r=i.bMarks[t]+i.tShift[t],o=i.eMarks[t];if(i.sCount[t]-i.blkIndent>=4||r+3>o)return!1;let s=i.src.charCodeAt(r);if(s!==126&&s!==96)return!1;let a=r;r=i.skipChars(r,s);let l=r-a;if(l<3)return!1;let c=i.src.slice(a,r),u=i.src.slice(r,o);if(s===96&&u.indexOf(String.fromCharCode(s))>=0)return!1;if(n)return!0;let d=t,h=!1;for(;d++,!(d>=e||(r=a=i.bMarks[d]+i.tShift[d],o=i.eMarks[d],r<o&&i.sCount[d]<i.blkIndent));)if(i.src.charCodeAt(r)===s&&!(i.sCount[d]-i.blkIndent>=4)&&(r=i.skipChars(r,s),!(r-a<l)&&(r=i.skipSpaces(r),!(r<o)))){h=!0;break}l=i.sCount[t],i.line=d+(h?1:0);let f=i.push("fence","code",0);return f.info=u,f.content=i.getLines(t+1,d,l,!0),f.markup=c,f.map=[t,i.line],!0}function sI(i,t,e,n){let r=i.bMarks[t]+i.tShift[t],o=i.eMarks[t],s=i.lineMax;if(i.sCount[t]-i.blkIndent>=4||i.src.charCodeAt(r)!==62)return!1;if(n)return!0;let a=[],l=[],c=[],u=[],d=i.md.block.ruler.getRules("blockquote"),h=i.parentType;i.parentType="blockquote";let f=!1,p;for(p=t;p<e;p++){let y=i.sCount[p]<i.blkIndent;if(r=i.bMarks[p]+i.tShift[p],o=i.eMarks[p],r>=o)break;if(i.src.charCodeAt(r++)===62&&!y){let x=i.sCount[p]+1,S,w;i.src.charCodeAt(r)===32?(r++,x++,w=!1,S=!0):i.src.charCodeAt(r)===9?(S=!0,(i.bsCount[p]+x)%4===3?(r++,x++,w=!1):w=!0):S=!1;let k=x;for(a.push(i.bMarks[p]),i.bMarks[p]=r;r<o;){let M=i.src.charCodeAt(r);if(Re(M))M===9?k+=4-(k+i.bsCount[p]+(w?1:0))%4:k++;else break;r++}f=r>=o,l.push(i.bsCount[p]),i.bsCount[p]=i.sCount[p]+1+(S?1:0),c.push(i.sCount[p]),i.sCount[p]=k-x,u.push(i.tShift[p]),i.tShift[p]=r-i.bMarks[p];continue}if(f)break;let E=!1;for(let x=0,S=d.length;x<S;x++)if(d[x](i,p,e,!0)){E=!0;break}if(E){i.lineMax=p,i.blkIndent!==0&&(a.push(i.bMarks[p]),l.push(i.bsCount[p]),u.push(i.tShift[p]),c.push(i.sCount[p]),i.sCount[p]-=i.blkIndent);break}a.push(i.bMarks[p]),l.push(i.bsCount[p]),u.push(i.tShift[p]),c.push(i.sCount[p]),i.sCount[p]=-1}let m=i.blkIndent;i.blkIndent=0;let g=i.push("blockquote_open","blockquote",1);g.markup=">";let b=[t,0];g.map=b,i.md.block.tokenize(i,t,p);let v=i.push("blockquote_close","blockquote",-1);v.markup=">",i.lineMax=s,i.parentType=h,b[1]=i.line;for(let y=0;y<u.length;y++)i.bMarks[y+t]=a[y],i.tShift[y+t]=u[y],i.sCount[y+t]=c[y],i.bsCount[y+t]=l[y];return i.blkIndent=m,!0}function aI(i,t,e,n){let r=i.eMarks[t];if(i.sCount[t]-i.blkIndent>=4)return!1;let o=i.bMarks[t]+i.tShift[t],s=i.src.charCodeAt(o++);if(s!==42&&s!==45&&s!==95)return!1;let a=1;for(;o<r;){let c=i.src.charCodeAt(o++);if(c!==s&&!Re(c))return!1;c===s&&a++}if(a<3)return!1;if(n)return!0;i.line=t+1;let l=i.push("hr","hr",0);return l.map=[t,i.line],l.markup=Array(a+1).join(String.fromCharCode(s)),!0}function Pv(i,t){let e=i.eMarks[t],n=i.bMarks[t]+i.tShift[t],r=i.src.charCodeAt(n++);if(r!==42&&r!==45&&r!==43)return-1;if(n<e){let o=i.src.charCodeAt(n);if(!Re(o))return-1}return n}function _v(i,t){let e=i.bMarks[t]+i.tShift[t],n=i.eMarks[t],r=e;if(r+1>=n)return-1;let o=i.src.charCodeAt(r++);if(o<48||o>57)return-1;for(;;){if(r>=n)return-1;if(o=i.src.charCodeAt(r++),o>=48&&o<=57){if(r-e>=10)return-1;continue}if(o===41||o===46)break;return-1}return r<n&&(o=i.src.charCodeAt(r),!Re(o))?-1:r}function lI(i,t){let e=i.level+2;for(let n=t+2,r=i.tokens.length-2;n<r;n++)i.tokens[n].level===e&&i.tokens[n].type==="paragraph_open"&&(i.tokens[n+2].hidden=!0,i.tokens[n].hidden=!0,n+=2)}function cI(i,t,e,n){let r,o,s,a,l=t,c=!0;if(i.sCount[l]-i.blkIndent>=4||i.listIndent>=0&&i.sCount[l]-i.listIndent>=4&&i.sCount[l]<i.blkIndent)return!1;let u=!1;n&&i.parentType==="paragraph"&&i.sCount[l]>=i.blkIndent&&(u=!0);let d,h,f;if((f=_v(i,l))>=0){if(d=!0,s=i.bMarks[l]+i.tShift[l],h=Number(i.src.slice(s,f-1)),u&&h!==1)return!1}else if((f=Pv(i,l))>=0)d=!1;else return!1;if(u&&i.skipSpaces(f)>=i.eMarks[l])return!1;if(n)return!0;let p=i.src.charCodeAt(f-1),m=i.tokens.length;d?(a=i.push("ordered_list_open","ol",1),h!==1&&(a.attrs=[["start",h]])):a=i.push("bullet_list_open","ul",1);let g=[l,0];a.map=g,a.markup=String.fromCharCode(p);let b=!1,v=i.md.block.ruler.getRules("list"),y=i.parentType;for(i.parentType="list";l<e;){o=f,r=i.eMarks[l];let E=i.sCount[l]+f-(i.bMarks[l]+i.tShift[l]),x=E;for(;o<r;){let D=i.src.charCodeAt(o);if(D===9)x+=4-(x+i.bsCount[l])%4;else if(D===32)x++;else break;o++}let S=o,w;S>=r?w=1:w=x-E,w>4&&(w=1);let k=E+w;a=i.push("list_item_open","li",1),a.markup=String.fromCharCode(p);let M=[l,0];a.map=M,d&&(a.info=i.src.slice(s,f-1));let L=i.tight,_=i.tShift[l],P=i.sCount[l],I=i.listIndent;if(i.listIndent=i.blkIndent,i.blkIndent=k,i.tight=!0,i.tShift[l]=S-i.bMarks[l],i.sCount[l]=x,S>=r&&i.isEmpty(l+1)?i.line=Math.min(i.line+2,e):i.md.block.tokenize(i,l,e,!0),(!i.tight||b)&&(c=!1),b=i.line-l>1&&i.isEmpty(i.line-1),i.blkIndent=i.listIndent,i.listIndent=I,i.tShift[l]=_,i.sCount[l]=P,i.tight=L,a=i.push("list_item_close","li",-1),a.markup=String.fromCharCode(p),l=i.line,M[1]=l,l>=e||i.sCount[l]<i.blkIndent||i.sCount[l]-i.blkIndent>=4)break;let N=!1;for(let D=0,R=v.length;D<R;D++)if(v[D](i,l,e,!0)){N=!0;break}if(N)break;if(d){if(f=_v(i,l),f<0)break;s=i.bMarks[l]+i.tShift[l]}else if(f=Pv(i,l),f<0)break;if(p!==i.src.charCodeAt(f-1))break}return d?a=i.push("ordered_list_close","ol",-1):a=i.push("bullet_list_close","ul",-1),a.markup=String.fromCharCode(p),g[1]=l,i.line=l,i.parentType=y,c&&lI(i,m),!0}function uI(i,t,e,n){let r=i.bMarks[t]+i.tShift[t],o=i.eMarks[t],s=t+1;if(i.sCount[t]-i.blkIndent>=4||i.src.charCodeAt(r)!==91)return!1;function a(v){let y=i.lineMax;if(v>=y||i.isEmpty(v))return null;let E=!1;if(i.sCount[v]-i.blkIndent>3&&(E=!0),i.sCount[v]<0&&(E=!0),!E){let w=i.md.block.ruler.getRules("reference"),k=i.parentType;i.parentType="reference";let M=!1;for(let L=0,_=w.length;L<_;L++)if(w[L](i,v,y,!0)){M=!0;break}if(i.parentType=k,M)return null}let x=i.bMarks[v]+i.tShift[v],S=i.eMarks[v];return i.src.slice(x,S+1)}let l=i.src.slice(r,o+1);o=l.length;let c=-1;for(r=1;r<o;r++){let v=l.charCodeAt(r);if(v===91)return!1;if(v===93){c=r;break}else if(v===10){let y=a(s);y!==null&&(l+=y,o=l.length,s++)}else if(v===92&&(r++,r<o&&l.charCodeAt(r)===10)){let y=a(s);y!==null&&(l+=y,o=l.length,s++)}}if(c<0||l.charCodeAt(c+1)!==58)return!1;for(r=c+2;r<o;r++){let v=l.charCodeAt(r);if(v===10){let y=a(s);y!==null&&(l+=y,o=l.length,s++)}else if(!Re(v))break}let u=i.md.helpers.parseLinkDestination(l,r,o);if(!u.ok)return!1;let d=i.md.normalizeLink(u.str);if(!i.md.validateLink(d))return!1;r=u.pos;let h=r,f=s,p=r;for(;r<o;r++){let v=l.charCodeAt(r);if(v===10){let y=a(s);y!==null&&(l+=y,o=l.length,s++)}else if(!Re(v))break}let m=i.md.helpers.parseLinkTitle(l,r,o);for(;m.can_continue;){let v=a(s);if(v===null)break;l+=v,r=o,o=l.length,s++,m=i.md.helpers.parseLinkTitle(l,r,o,m)}let g;for(r<o&&p!==r&&m.ok?(g=m.str,r=m.pos):(g="",r=h,s=f);r<o;){let v=l.charCodeAt(r);if(!Re(v))break;r++}if(r<o&&l.charCodeAt(r)!==10&&g)for(g="",r=h,s=f;r<o;){let v=l.charCodeAt(r);if(!Re(v))break;r++}if(r<o&&l.charCodeAt(r)!==10)return!1;let b=al(l.slice(1,c));return b?(n||(typeof i.env.references=="undefined"&&(i.env.references={}),typeof i.env.references[b]=="undefined"&&(i.env.references[b]={title:g,href:d}),i.line=s),!0):!1}var dI=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],hI="[a-zA-Z_:][a-zA-Z0-9:._-]*",pI="[^\"'=<>`\\x00-\\x20]+",fI="'[^']*'",mI='"[^"]*"',gI="(?:"+pI+"|"+fI+"|"+mI+")",bI="(?:\\s+"+hI+"(?:\\s*=\\s*"+gI+")?)",Kv="<[A-Za-z][A-Za-z0-9\\-]*"+bI+"*\\s*\\/?>",qv="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",yI="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",vI="<[?][\\s\\S]*?[?]>",EI="<![A-Za-z][^>]*>",xI="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",SI=new RegExp("^(?:"+Kv+"|"+qv+"|"+yI+"|"+vI+"|"+EI+"|"+xI+")"),kI=new RegExp("^(?:"+Kv+"|"+qv+")"),Tr=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+dI.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(kI.source+"\\s*$"),/^$/,!1]];function wI(i,t,e,n){let r=i.bMarks[t]+i.tShift[t],o=i.eMarks[t];if(i.sCount[t]-i.blkIndent>=4||!i.md.options.html||i.src.charCodeAt(r)!==60)return!1;let s=i.src.slice(r,o),a=0;for(;a<Tr.length&&!Tr[a][0].test(s);a++);if(a===Tr.length)return!1;if(n)return Tr[a][2];let l=t+1;if(!Tr[a][1].test(s)){for(;l<e&&!(i.sCount[l]<i.blkIndent);l++)if(r=i.bMarks[l]+i.tShift[l],o=i.eMarks[l],s=i.src.slice(r,o),Tr[a][1].test(s)){s.length!==0&&l++;break}}i.line=l;let c=i.push("html_block","",0);return c.map=[t,l],c.content=i.getLines(t,l,i.blkIndent,!0),!0}function MI(i,t,e,n){let r=i.bMarks[t]+i.tShift[t],o=i.eMarks[t];if(i.sCount[t]-i.blkIndent>=4)return!1;let s=i.src.charCodeAt(r);if(s!==35||r>=o)return!1;let a=1;for(s=i.src.charCodeAt(++r);s===35&&r<o&&a<=6;)a++,s=i.src.charCodeAt(++r);if(a>6||r<o&&!Re(s))return!1;if(n)return!0;o=i.skipSpacesBack(o,r);let l=i.skipCharsBack(o,35,r);l>r&&Re(i.src.charCodeAt(l-1))&&(o=l),i.line=t+1;let c=i.push("heading_open","h"+String(a),1);c.markup="########".slice(0,a),c.map=[t,i.line];let u=i.push("inline","",0);u.content=i.src.slice(r,o).trim(),u.map=[t,i.line],u.children=[];let d=i.push("heading_close","h"+String(a),-1);return d.markup="########".slice(0,a),!0}function TI(i,t,e){let n=i.md.block.ruler.getRules("paragraph");if(i.sCount[t]-i.blkIndent>=4)return!1;let r=i.parentType;i.parentType="paragraph";let o=0,s,a=t+1;for(;a<e&&!i.isEmpty(a);a++){if(i.sCount[a]-i.blkIndent>3)continue;if(i.sCount[a]>=i.blkIndent){let f=i.bMarks[a]+i.tShift[a],p=i.eMarks[a];if(f<p&&(s=i.src.charCodeAt(f),(s===45||s===61)&&(f=i.skipChars(f,s),f=i.skipSpaces(f),f>=p))){o=s===61?1:2;break}}if(i.sCount[a]<0)continue;let h=!1;for(let f=0,p=n.length;f<p;f++)if(n[f](i,a,e,!0)){h=!0;break}if(h)break}if(!o)return!1;let l=i.getLines(t,a,i.blkIndent,!1).trim();i.line=a+1;let c=i.push("heading_open","h"+String(o),1);c.markup=String.fromCharCode(s),c.map=[t,i.line];let u=i.push("inline","",0);u.content=l,u.map=[t,i.line-1],u.children=[];let d=i.push("heading_close","h"+String(o),-1);return d.markup=String.fromCharCode(s),i.parentType=r,!0}function CI(i,t,e){let n=i.md.block.ruler.getRules("paragraph"),r=i.parentType,o=t+1;for(i.parentType="paragraph";o<e&&!i.isEmpty(o);o++){if(i.sCount[o]-i.blkIndent>3||i.sCount[o]<0)continue;let c=!1;for(let u=0,d=n.length;u<d;u++)if(n[u](i,o,e,!0)){c=!0;break}if(c)break}let s=i.getLines(t,o,i.blkIndent,!1).trim();i.line=o;let a=i.push("paragraph_open","p",1);a.map=[t,i.line];let l=i.push("inline","",0);return l.content=s,l.map=[t,i.line],l.children=[],i.push("paragraph_close","p",-1),i.parentType=r,!0}var rl=[["table",iI,["paragraph","reference"]],["code",rI],["fence",oI,["paragraph","reference","blockquote","list"]],["blockquote",sI,["paragraph","reference","blockquote","list"]],["hr",aI,["paragraph","reference","blockquote","list"]],["list",cI,["paragraph","reference","blockquote"]],["reference",uI],["html_block",wI,["paragraph","reference","blockquote"]],["heading",MI,["paragraph","reference","blockquote"]],["lheading",TI],["paragraph",CI]];function ll(){this.ruler=new Mt;for(let i=0;i<rl.length;i++)this.ruler.push(rl[i][0],rl[i][1],{alt:(rl[i][2]||[]).slice()})}ll.prototype.tokenize=function(i,t,e){let n=this.ruler.getRules(""),r=n.length,o=i.md.options.maxNesting,s=t,a=!1;for(;s<e&&(i.line=s=i.skipEmptyLines(s),!(s>=e||i.sCount[s]<i.blkIndent));){if(i.level>=o){i.line=e;break}let l=i.line,c=!1;for(let u=0;u<r;u++)if(c=n[u](i,s,e,!1),c){if(l>=i.line)throw new Error("block rule didn't increment state.line");break}if(!c)throw new Error("none of the block rules matched");i.tight=!a,i.isEmpty(i.line-1)&&(a=!0),s=i.line,s<e&&i.isEmpty(s)&&(a=!0,s++,i.line=s)}};ll.prototype.parse=function(i,t,e,n){if(!i)return;let r=new this.State(i,t,e,n);this.tokenize(r,r.line,r.lineMax)};ll.prototype.State=vn;function Bo(i,t,e,n){this.src=i,this.env=e,this.md=t,this.tokens=n,this.tokens_meta=Array(n.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}Bo.prototype.pushPending=function(){let i=new Zt("text","",0);return i.content=this.pending,i.level=this.pendingLevel,this.tokens.push(i),this.pending="",i};Bo.prototype.push=function(i,t,e){this.pending&&this.pushPending();let n=new Zt(i,t,e),r=null;return e<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),n.level=this.level,e>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],r={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(n),this.tokens_meta.push(r),n};Bo.prototype.scanDelims=function(i,t){let e=this.posMax,n=this.src.charCodeAt(i),r=i>0?this.src.charCodeAt(i-1):32,o=i;for(;o<e&&this.src.charCodeAt(o)===n;)o++;let s=o-i,a=o<e?this.src.charCodeAt(o):32,l=Do(r)||Oo(String.fromCharCode(r)),c=Do(a)||Oo(String.fromCharCode(a)),u=_o(r),d=_o(a),h=!d&&(!c||u||l),f=!u&&(!l||d||c);return{can_open:h&&(t||!f||l),can_close:f&&(t||!h||c),length:s}};Bo.prototype.Token=Zt;function LI(i){switch(i){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function RI(i,t){let e=i.pos;for(;e<i.posMax&&!LI(i.src.charCodeAt(e));)e++;return e===i.pos?!1:(t||(i.pending+=i.src.slice(i.pos,e)),i.pos=e,!0)}var AI=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function II(i,t){if(!i.md.options.linkify||i.linkLevel>0)return!1;let e=i.pos,n=i.posMax;if(e+3>n||i.src.charCodeAt(e)!==58||i.src.charCodeAt(e+1)!==47||i.src.charCodeAt(e+2)!==47)return!1;let r=i.pending.match(AI);if(!r)return!1;let o=r[1],s=i.md.linkify.matchAtStart(i.src.slice(e-o.length));if(!s)return!1;let a=s.url;if(a.length<=o.length)return!1;a=a.replace(/\*+$/,"");let l=i.md.normalizeLink(a);if(!i.md.validateLink(l))return!1;if(!t){i.pending=i.pending.slice(0,-o.length);let c=i.push("link_open","a",1);c.attrs=[["href",l]],c.markup="linkify",c.info="auto";let u=i.push("text","",0);u.content=i.md.normalizeLinkText(a);let d=i.push("link_close","a",-1);d.markup="linkify",d.info="auto"}return i.pos+=a.length-o.length,!0}function NI(i,t){let e=i.pos;if(i.src.charCodeAt(e)!==10)return!1;let n=i.pending.length-1,r=i.posMax;if(!t)if(n>=0&&i.pending.charCodeAt(n)===32)if(n>=1&&i.pending.charCodeAt(n-1)===32){let o=n-1;for(;o>=1&&i.pending.charCodeAt(o-1)===32;)o--;i.pending=i.pending.slice(0,o),i.push("hardbreak","br",0)}else i.pending=i.pending.slice(0,-1),i.push("softbreak","br",0);else i.push("softbreak","br",0);for(e++;e<r&&Re(i.src.charCodeAt(e));)e++;return i.pos=e,!0}var gh=[];for(let i=0;i<256;i++)gh.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(i){gh[i.charCodeAt(0)]=1});function PI(i,t){let e=i.pos,n=i.posMax;if(i.src.charCodeAt(e)!==92||(e++,e>=n))return!1;let r=i.src.charCodeAt(e);if(r===10){for(t||i.push("hardbreak","br",0),e++;e<n&&(r=i.src.charCodeAt(e),!!Re(r));)e++;return i.pos=e,!0}let o=i.src[e];if(r>=55296&&r<=56319&&e+1<n){let a=i.src.charCodeAt(e+1);a>=56320&&a<=57343&&(o+=i.src[e+1],e++)}let s="\\"+o;if(!t){let a=i.push("text_special","",0);r<256&&gh[r]!==0?a.content=o:a.content=s,a.markup=s,a.info="escape"}return i.pos=e+1,!0}function _I(i,t){let e=i.pos;if(i.src.charCodeAt(e)!==96)return!1;let r=e;e++;let o=i.posMax;for(;e<o&&i.src.charCodeAt(e)===96;)e++;let s=i.src.slice(r,e),a=s.length;if(i.backticksScanned&&(i.backticks[a]||0)<=r)return t||(i.pending+=s),i.pos+=a,!0;let l=e,c;for(;(c=i.src.indexOf("`",l))!==-1;){for(l=c+1;l<o&&i.src.charCodeAt(l)===96;)l++;let u=l-c;if(u===a){if(!t){let d=i.push("code_inline","code",0);d.markup=s,d.content=i.src.slice(e,c).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return i.pos=l,!0}i.backticks[u]=c}return i.backticksScanned=!0,t||(i.pending+=s),i.pos+=a,!0}function OI(i,t){let e=i.pos,n=i.src.charCodeAt(e);if(t||n!==126)return!1;let r=i.scanDelims(i.pos,!0),o=r.length,s=String.fromCharCode(n);if(o<2)return!1;let a;o%2&&(a=i.push("text","",0),a.content=s,o--);for(let l=0;l<o;l+=2)a=i.push("text","",0),a.content=s+s,i.delimiters.push({marker:n,length:0,token:i.tokens.length-1,end:-1,open:r.can_open,close:r.can_close});return i.pos+=r.length,!0}function Ov(i,t){let e,n=[],r=t.length;for(let o=0;o<r;o++){let s=t[o];if(s.marker!==126||s.end===-1)continue;let a=t[s.end];e=i.tokens[s.token],e.type="s_open",e.tag="s",e.nesting=1,e.markup="~~",e.content="",e=i.tokens[a.token],e.type="s_close",e.tag="s",e.nesting=-1,e.markup="~~",e.content="",i.tokens[a.token-1].type==="text"&&i.tokens[a.token-1].content==="~"&&n.push(a.token-1)}for(;n.length;){let o=n.pop(),s=o+1;for(;s<i.tokens.length&&i.tokens[s].type==="s_close";)s++;s--,o!==s&&(e=i.tokens[s],i.tokens[s]=i.tokens[o],i.tokens[o]=e)}}function DI(i){let t=i.tokens_meta,e=i.tokens_meta.length;Ov(i,i.delimiters);for(let n=0;n<e;n++)t[n]&&t[n].delimiters&&Ov(i,t[n].delimiters)}var Gv={tokenize:OI,postProcess:DI};function BI(i,t){let e=i.pos,n=i.src.charCodeAt(e);if(t||n!==95&&n!==42)return!1;let r=i.scanDelims(i.pos,n===42);for(let o=0;o<r.length;o++){let s=i.push("text","",0);s.content=String.fromCharCode(n),i.delimiters.push({marker:n,length:r.length,token:i.tokens.length-1,end:-1,open:r.can_open,close:r.can_close})}return i.pos+=r.length,!0}function Dv(i,t){let e=t.length;for(let n=e-1;n>=0;n--){let r=t[n];if(r.marker!==95&&r.marker!==42||r.end===-1)continue;let o=t[r.end],s=n>0&&t[n-1].end===r.end+1&&t[n-1].marker===r.marker&&t[n-1].token===r.token-1&&t[r.end+1].token===o.token+1,a=String.fromCharCode(r.marker),l=i.tokens[r.token];l.type=s?"strong_open":"em_open",l.tag=s?"strong":"em",l.nesting=1,l.markup=s?a+a:a,l.content="";let c=i.tokens[o.token];c.type=s?"strong_close":"em_close",c.tag=s?"strong":"em",c.nesting=-1,c.markup=s?a+a:a,c.content="",s&&(i.tokens[t[n-1].token].content="",i.tokens[t[r.end+1].token].content="",n--)}}function FI(i){let t=i.tokens_meta,e=i.tokens_meta.length;Dv(i,i.delimiters);for(let n=0;n<e;n++)t[n]&&t[n].delimiters&&Dv(i,t[n].delimiters)}var jv={tokenize:BI,postProcess:FI};function HI(i,t){let e,n,r,o,s="",a="",l=i.pos,c=!0;if(i.src.charCodeAt(i.pos)!==91)return!1;let u=i.pos,d=i.posMax,h=i.pos+1,f=i.md.helpers.parseLinkLabel(i,i.pos,!0);if(f<0)return!1;let p=f+1;if(p<d&&i.src.charCodeAt(p)===40){for(c=!1,p++;p<d&&(e=i.src.charCodeAt(p),!(!Re(e)&&e!==10));p++);if(p>=d)return!1;if(l=p,r=i.md.helpers.parseLinkDestination(i.src,p,i.posMax),r.ok){for(s=i.md.normalizeLink(r.str),i.md.validateLink(s)?p=r.pos:s="",l=p;p<d&&(e=i.src.charCodeAt(p),!(!Re(e)&&e!==10));p++);if(r=i.md.helpers.parseLinkTitle(i.src,p,i.posMax),p<d&&l!==p&&r.ok)for(a=r.str,p=r.pos;p<d&&(e=i.src.charCodeAt(p),!(!Re(e)&&e!==10));p++);}(p>=d||i.src.charCodeAt(p)!==41)&&(c=!0),p++}if(c){if(typeof i.env.references=="undefined")return!1;if(p<d&&i.src.charCodeAt(p)===91?(l=p+1,p=i.md.helpers.parseLinkLabel(i,p),p>=0?n=i.src.slice(l,p++):p=f+1):p=f+1,n||(n=i.src.slice(h,f)),o=i.env.references[al(n)],!o)return i.pos=u,!1;s=o.href,a=o.title}if(!t){i.pos=h,i.posMax=f;let m=i.push("link_open","a",1),g=[["href",s]];m.attrs=g,a&&g.push(["title",a]),i.linkLevel++,i.md.inline.tokenize(i),i.linkLevel--,i.push("link_close","a",-1)}return i.pos=p,i.posMax=d,!0}function zI(i,t){let e,n,r,o,s,a,l,c,u="",d=i.pos,h=i.posMax;if(i.src.charCodeAt(i.pos)!==33||i.src.charCodeAt(i.pos+1)!==91)return!1;let f=i.pos+2,p=i.md.helpers.parseLinkLabel(i,i.pos+1,!1);if(p<0)return!1;if(o=p+1,o<h&&i.src.charCodeAt(o)===40){for(o++;o<h&&(e=i.src.charCodeAt(o),!(!Re(e)&&e!==10));o++);if(o>=h)return!1;for(c=o,a=i.md.helpers.parseLinkDestination(i.src,o,i.posMax),a.ok&&(u=i.md.normalizeLink(a.str),i.md.validateLink(u)?o=a.pos:u=""),c=o;o<h&&(e=i.src.charCodeAt(o),!(!Re(e)&&e!==10));o++);if(a=i.md.helpers.parseLinkTitle(i.src,o,i.posMax),o<h&&c!==o&&a.ok)for(l=a.str,o=a.pos;o<h&&(e=i.src.charCodeAt(o),!(!Re(e)&&e!==10));o++);else l="";if(o>=h||i.src.charCodeAt(o)!==41)return i.pos=d,!1;o++}else{if(typeof i.env.references=="undefined")return!1;if(o<h&&i.src.charCodeAt(o)===91?(c=o+1,o=i.md.helpers.parseLinkLabel(i,o),o>=0?r=i.src.slice(c,o++):o=p+1):o=p+1,r||(r=i.src.slice(f,p)),s=i.env.references[al(r)],!s)return i.pos=d,!1;u=s.href,l=s.title}if(!t){n=i.src.slice(f,p);let m=[];i.md.inline.parse(n,i.md,i.env,m);let g=i.push("image","img",0),b=[["src",u],["alt",""]];g.attrs=b,g.children=m,g.content=n,l&&b.push(["title",l])}return i.pos=o,i.posMax=h,!0}var VI=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,$I=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function WI(i,t){let e=i.pos;if(i.src.charCodeAt(e)!==60)return!1;let n=i.pos,r=i.posMax;for(;;){if(++e>=r)return!1;let s=i.src.charCodeAt(e);if(s===60)return!1;if(s===62)break}let o=i.src.slice(n+1,e);if($I.test(o)){let s=i.md.normalizeLink(o);if(!i.md.validateLink(s))return!1;if(!t){let a=i.push("link_open","a",1);a.attrs=[["href",s]],a.markup="autolink",a.info="auto";let l=i.push("text","",0);l.content=i.md.normalizeLinkText(o);let c=i.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return i.pos+=o.length+2,!0}if(VI.test(o)){let s=i.md.normalizeLink("mailto:"+o);if(!i.md.validateLink(s))return!1;if(!t){let a=i.push("link_open","a",1);a.attrs=[["href",s]],a.markup="autolink",a.info="auto";let l=i.push("text","",0);l.content=i.md.normalizeLinkText(o);let c=i.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return i.pos+=o.length+2,!0}return!1}function UI(i){return/^<a[>\s]/i.test(i)}function KI(i){return/^<\/a\s*>/i.test(i)}function qI(i){let t=i|32;return t>=97&&t<=122}function GI(i,t){if(!i.md.options.html)return!1;let e=i.posMax,n=i.pos;if(i.src.charCodeAt(n)!==60||n+2>=e)return!1;let r=i.src.charCodeAt(n+1);if(r!==33&&r!==63&&r!==47&&!qI(r))return!1;let o=i.src.slice(n).match(SI);if(!o)return!1;if(!t){let s=i.push("html_inline","",0);s.content=o[0],UI(s.content)&&i.linkLevel++,KI(s.content)&&i.linkLevel--}return i.pos+=o[0].length,!0}var jI=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,YI=/^&([a-z][a-z0-9]{1,31});/i;function XI(i,t){let e=i.pos,n=i.posMax;if(i.src.charCodeAt(e)!==38||e+1>=n)return!1;if(i.src.charCodeAt(e+1)===35){let o=i.src.slice(e).match(jI);if(o){if(!t){let s=o[1][0].toLowerCase()==="x"?parseInt(o[1].slice(1),16):parseInt(o[1],10),a=i.push("text_special","",0);a.content=fh(s)?ol(s):ol(65533),a.markup=o[0],a.info="entity"}return i.pos+=o[0].length,!0}}else{let o=i.src.slice(e).match(YI);if(o){let s=Fv.decodeHTML(o[0]);if(s!==o[0]){if(!t){let a=i.push("text_special","",0);a.content=s,a.markup=o[0],a.info="entity"}return i.pos+=o[0].length,!0}}}return!1}function Bv(i){let t={},e=i.length;if(!e)return;let n=0,r=-2,o=[];for(let s=0;s<e;s++){let a=i[s];if(o.push(0),(i[n].marker!==a.marker||r!==a.token-1)&&(n=s),r=a.token,a.length=a.length||0,!a.close)continue;t.hasOwnProperty(a.marker)||(t[a.marker]=[-1,-1,-1,-1,-1,-1]);let l=t[a.marker][(a.open?3:0)+a.length%3],c=n-o[n]-1,u=c;for(;c>l;c-=o[c]+1){let d=i[c];if(d.marker===a.marker&&d.open&&d.end<0){let h=!1;if((d.close||a.open)&&(d.length+a.length)%3===0&&(d.length%3!==0||a.length%3!==0)&&(h=!0),!h){let f=c>0&&!i[c-1].open?o[c-1]+1:0;o[s]=s-c+f,o[c]=f,a.open=!1,d.end=s,d.close=!1,u=-1,r=-2;break}}}u!==-1&&(t[a.marker][(a.open?3:0)+(a.length||0)%3]=u)}}function JI(i){let t=i.tokens_meta,e=i.tokens_meta.length;Bv(i.delimiters);for(let n=0;n<e;n++)t[n]&&t[n].delimiters&&Bv(t[n].delimiters)}function ZI(i){let t,e,n=0,r=i.tokens,o=i.tokens.length;for(t=e=0;t<o;t++)r[t].nesting<0&&n--,r[t].level=n,r[t].nesting>0&&n++,r[t].type==="text"&&t+1<o&&r[t+1].type==="text"?r[t+1].content=r[t].content+r[t+1].content:(t!==e&&(r[e]=r[t]),e++);t!==e&&(r.length=e)}var uh=[["text",RI],["linkify",II],["newline",NI],["escape",PI],["backticks",_I],["strikethrough",Gv.tokenize],["emphasis",jv.tokenize],["link",HI],["image",zI],["autolink",WI],["html_inline",GI],["entity",XI]],dh=[["balance_pairs",JI],["strikethrough",Gv.postProcess],["emphasis",jv.postProcess],["fragments_join",ZI]];function Fo(){this.ruler=new Mt;for(let i=0;i<uh.length;i++)this.ruler.push(uh[i][0],uh[i][1]);this.ruler2=new Mt;for(let i=0;i<dh.length;i++)this.ruler2.push(dh[i][0],dh[i][1])}Fo.prototype.skipToken=function(i){let t=i.pos,e=this.ruler.getRules(""),n=e.length,r=i.md.options.maxNesting,o=i.cache;if(typeof o[t]!="undefined"){i.pos=o[t];return}let s=!1;if(i.level<r){for(let a=0;a<n;a++)if(i.level++,s=e[a](i,!0),i.level--,s){if(t>=i.pos)throw new Error("inline rule didn't increment state.pos");break}}else i.pos=i.posMax;s||i.pos++,o[t]=i.pos};Fo.prototype.tokenize=function(i){let t=this.ruler.getRules(""),e=t.length,n=i.posMax,r=i.md.options.maxNesting;for(;i.pos<n;){let o=i.pos,s=!1;if(i.level<r){for(let a=0;a<e;a++)if(s=t[a](i,!1),s){if(o>=i.pos)throw new Error("inline rule didn't increment state.pos");break}}if(s){if(i.pos>=n)break;continue}i.pending+=i.src[i.pos++]}i.pending&&i.pushPending()};Fo.prototype.parse=function(i,t,e,n){let r=new this.State(i,t,e,n);this.tokenize(r);let o=this.ruler2.getRules(""),s=o.length;for(let a=0;a<s;a++)o[a](r)};Fo.prototype.State=Bo;var QI={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},eN={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},tN={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},nN={default:QI,zero:eN,commonmark:tN},iN=/^(vbscript|javascript|file|data):/,rN=/^data:image\/(gif|png|jpeg|webp);/;function oN(i){let t=i.trim().toLowerCase();return iN.test(t)?rN.test(t):!0}var Yv=["http:","https:","mailto:"];function sN(i){let t=li.parse(i,!0);if(t.hostname&&(!t.protocol||Yv.indexOf(t.protocol)>=0))try{t.hostname=Hv.toASCII(t.hostname)}catch(e){}return li.encode(li.format(t))}function aN(i){let t=li.parse(i,!0);if(t.hostname&&(!t.protocol||Yv.indexOf(t.protocol)>=0))try{t.hostname=Hv.toUnicode(t.hostname)}catch(e){}return li.decode(li.format(t),li.decode.defaultChars+"%")}function Kt(i,t){if(!(this instanceof Kt))return new Kt(i,t);t||ph(i)||(t=i||{},i="default"),this.inline=new Fo,this.block=new ll,this.core=new mh,this.renderer=new Lr,this.linkify=new gA,this.validateLink=oN,this.normalizeLink=sN,this.normalizeLinkText=aN,this.utils=NA,this.helpers=sl({},DA),this.options={},this.configure(i),t&&this.set(t)}Kt.prototype.set=function(i){return sl(this.options,i),this};Kt.prototype.configure=function(i){let t=this;if(ph(i)){let e=i;if(i=nN[e],!i)throw new Error('Wrong `markdown-it` preset "'+e+'", check name')}if(!i)throw new Error("Wrong `markdown-it` preset, can't be empty");return i.options&&t.set(i.options),i.components&&Object.keys(i.components).forEach(function(e){i.components[e].rules&&t[e].ruler.enableOnly(i.components[e].rules),i.components[e].rules2&&t[e].ruler2.enableOnly(i.components[e].rules2)}),this};Kt.prototype.enable=function(i,t){let e=[];Array.isArray(i)||(i=[i]),["core","block","inline"].forEach(function(r){e=e.concat(this[r].ruler.enable(i,!0))},this),e=e.concat(this.inline.ruler2.enable(i,!0));let n=i.filter(function(r){return e.indexOf(r)<0});if(n.length&&!t)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+n);return this};Kt.prototype.disable=function(i,t){let e=[];Array.isArray(i)||(i=[i]),["core","block","inline"].forEach(function(r){e=e.concat(this[r].ruler.disable(i,!0))},this),e=e.concat(this.inline.ruler2.disable(i,!0));let n=i.filter(function(r){return e.indexOf(r)<0});if(n.length&&!t)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+n);return this};Kt.prototype.use=function(i){let t=[this].concat(Array.prototype.slice.call(arguments,1));return i.apply(i,t),this};Kt.prototype.parse=function(i,t){if(typeof i!="string")throw new Error("Input data should be a String");let e=new this.core.State(i,this,t);return this.core.process(e),e.tokens};Kt.prototype.render=function(i,t){return t=t||{},this.renderer.render(this.parse(i,t),this.options,t)};Kt.prototype.parseInline=function(i,t){let e=new this.core.State(i,this,t);return e.inlineMode=!0,this.core.process(e),e.tokens};Kt.prototype.renderInline=function(i,t){return t=t||{},this.renderer.render(this.parseInline(i,t),this.options,t)};Xv.exports=Kt});var zN={};QE(zN,{default:()=>HN});module.exports=ex(zN);var Qt=require("obsidian"),qE=Go(require("path"));var Yo=["default","ashberry-light","ashberry-dark","dusty-navy","dark","paper-like"],ae={settingsVersion:3,defaultMode:"tiptap",showModeDialog:!0,lastViewMode:"edit",lastViewOpenPlacement:"right",enableLegacyTiptap:!0,common:{writingMode:"vertical-rl",fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:18,lineHeight:1.8,letterSpacing:0,pageScale:1,textColor:"#2e2e2e",backgroundColor:"#ffffff",pageBackgroundColor:"#f5f5f5",accentColor:"#1e90ff",lineEndProcessing:"allow-end",rubySize:.5,headingSpacing:2,rubyVerticalGap:0,rubyHorizontalGap:0,headingFontFamily:"",headingTextColor:"",debugLogging:!1},preview:{syncCursor:!0,updateInterval:300,showCaret:!0,pageModeEnabled:!1,outlineOpen:!1,hideFrontmatter:!0,showFrontmatterTitle:!0,showFrontmatterSubtitle:!0,showFrontmatterOriginalTitle:!0,showFrontmatterAuthor:!0,showFrontmatterCoAuthors:!0,showFrontmatterTranslator:!0,showFrontmatterCoTranslators:!0,followActiveFile:!1,headerContent:"none",headerAlign:"center",footerContent:"pageNumber",footerAlign:"center",pageNumberFormat:"currentTotal",pageTransitionEffect:"fade",bookPaddingTop:44,bookPaddingBottom:32},wysiwyg:{autoSave:!0,syncMode:"auto",syncCursor:!0,enableRuby:!0,enableTcy:!0,enableAssistantInput:!1,enableSyncBackup:!0,plainTextView:!1,appCloseAction:"save",imeOffsetHorizontalEm:.1,imeOffsetVerticalEm:.5,caretColorMode:"accent",caretCustomColor:"#1e90ff",caretWidthPx:3,ceUseNativeCaret:!0,useNativeSelection:!1,sotPaddingTop:32,sotPaddingBottom:16},themes:[{id:"default",name:"\u30C7\u30D5\u30A9\u30EB\u30C8",description:"\u6A19\u6E96\u7684\u306A\u7E26\u66F8\u304D\u30C6\u30FC\u30DE",mode:"custom",settings:{fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:18,lineHeight:1.8,headingFontFamily:"",colors:{text:"#2e2e2e",background:"#ffffff",pageBackground:"#f5f5f5",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1,headingSpacing:2}}},{id:"ashberry-light",name:"\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\uFF08\u30E9\u30A4\u30C8\uFF09",description:"\u6DE1\u3044\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\u8ABF\u306E\u660E\u308B\u3044\u30C6\u30FC\u30DE\uFF08\u4E38\u30B4\u30B7\u30C3\u30AF\uFF09",mode:"custom",settings:{fontFamily:"\u7B51\u7D2BA\u4E38\u30B4\u30B7\u30C3\u30AF, Hiragino Maru Gothic ProN, Hiragino Sans, Noto Sans JP, Yu Gothic, Meiryo, sans-serif",fontSize:20,lineHeight:1.9,letterSpacing:.06,rubySize:.5,headingFontFamily:"",colors:{text:"#3f3d43",background:"#f0eaed",pageBackground:"#dfd4da",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},{id:"ashberry-dark",name:"\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\uFF08\u30C0\u30FC\u30AF\uFF09",description:"\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\u8ABF\u306E\u843D\u3061\u7740\u3044\u305F\u30C0\u30FC\u30AF\u30C6\u30FC\u30DE\uFF08\u4E38\u30B4\u30B7\u30C3\u30AF\uFF09",mode:"custom",settings:{fontFamily:"\u7B51\u7D2BA\u4E38\u30B4\u30B7\u30C3\u30AF, Hiragino Maru Gothic ProN, Hiragino Sans, Noto Sans JP, Yu Gothic, Meiryo, sans-serif",fontSize:20,lineHeight:1.9,letterSpacing:.06,rubySize:.5,headingFontFamily:"",colors:{text:"#f0eaed",background:"#956a7f",pageBackground:"#b495a4",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},{id:"dusty-navy",name:"\u30C0\u30B9\u30C6\u30A3\u30CD\u30A4\u30D3\u30FC",description:"\u304F\u3059\u3093\u3060\u30C0\u30FC\u30AF\u30D6\u30EB\u30FC\u306E\u843D\u3061\u7740\u3044\u305F\u30C6\u30FC\u30DE\uFF08\u660E\u671D\uFF09",mode:"custom",settings:{fontFamily:'"Yu Mincho", "Hiragino Mincho ProN", "Noto Serif JP", "Noto Serif CJK JP", "Source Han Serif", Georgia, "Times New Roman", serif',fontSize:20,lineHeight:1.9,letterSpacing:.06,rubySize:.5,headingFontFamily:"",colors:{text:"#d5d9e1",background:"#30354a",pageBackground:"#3b415a",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},{id:"dark",name:"\u30C0\u30FC\u30AF",description:"\u30C0\u30FC\u30AF\u30E2\u30FC\u30C9\u7E26\u66F8\u304D\u30C6\u30FC\u30DE",mode:"custom",settings:{fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:18,lineHeight:1.8,headingFontFamily:"",colors:{text:"#e0e0e0",background:"#1a1a1a",pageBackground:"#0f0f0f",accent:"#4a9eff",headingText:""},spacing:{paragraphSpacing:1,headingSpacing:2}}},{id:"paper-like",name:"\u7D19\u98A8",description:"\u7D19\u306E\u3088\u3046\u306A\u6E29\u304B\u307F\u306E\u3042\u308B\u30C6\u30FC\u30DE",mode:"custom",settings:{fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:17,lineHeight:1.9,headingFontFamily:"",colors:{text:"#3a3330",background:"#f9f7f3",pageBackground:"#e8e4df",accent:"#b8860b",headingText:""},spacing:{paragraphSpacing:1.3,headingSpacing:2.2}}}],activeTheme:"obsidian-base",customFonts:[],temporaryOverrides:{},controlPanel:{enabled:!0,position:"top",autoHide:!1}};function Hh(i){var e,n,r,o,s,a,l,c,u;let t={...ae};if(i&&typeof i=="object"){let h=(typeof i.settingsVersion=="number"?i.settingsVersion:0)<3;if(t.defaultMode="tiptap",(i.lastViewMode==="edit"||i.lastViewMode==="preview"||i.lastViewMode==="compat")&&(t.lastViewMode=i.lastViewMode),typeof i.enableLegacyTiptap=="boolean"&&(t.enableLegacyTiptap=i.enableLegacyTiptap),(i.lastViewOpenPlacement==="right"||i.lastViewOpenPlacement==="tab"||i.lastViewOpenPlacement==="window")&&(t.lastViewOpenPlacement=i.lastViewOpenPlacement),typeof i.showModeDialog=="boolean"&&!h&&(t.showModeDialog=i.showModeDialog),t.settingsVersion=3,i.common&&typeof i.common=="object"){let m={...t.common,...i.common};m.rubySize=Fl((e=i.common.rubySize)!=null?e:m.rubySize),m.rubyVerticalGap=$i((n=i.common.rubyVerticalGap)!=null?n:m.rubyVerticalGap,ae.common.rubyVerticalGap),m.rubyHorizontalGap=$i((r=i.common.rubyHorizontalGap)!=null?r:m.rubyHorizontalGap,ae.common.rubyHorizontalGap),typeof m.debugLogging!="boolean"&&(m.debugLogging=ae.common.debugLogging),t.common=m}else t.common={...t.common,rubySize:Fl(t.common.rubySize),rubyVerticalGap:$i(t.common.rubyVerticalGap,ae.common.rubyVerticalGap),rubyHorizontalGap:$i(t.common.rubyHorizontalGap,ae.common.rubyHorizontalGap)};i.preview&&typeof i.preview=="object"&&(t.preview={...t.preview,...i.preview});let f=Number(t.preview.bookPaddingTop);t.preview.bookPaddingTop=Number.isFinite(f)?Math.max(0,Math.min(200,f)):(o=ae.preview.bookPaddingTop)!=null?o:44;let p=Number(t.preview.bookPaddingBottom);if(t.preview.bookPaddingBottom=Number.isFinite(p)?Math.max(0,Math.min(200,p)):(s=ae.preview.bookPaddingBottom)!=null?s:32,i.wysiwyg&&typeof i.wysiwyg=="object"){t.wysiwyg={...t.wysiwyg,...i.wysiwyg},typeof t.wysiwyg.enableSyncBackup!="boolean"&&(t.wysiwyg.enableSyncBackup=ae.wysiwyg.enableSyncBackup),typeof t.wysiwyg.plainTextView!="boolean"&&(t.wysiwyg.plainTextView=ae.wysiwyg.plainTextView);let m=t.wysiwyg.appCloseAction;m!=="save"&&m!=="discard"&&(t.wysiwyg.appCloseAction=ae.wysiwyg.appCloseAction),t.wysiwyg.imeOffsetHorizontalEm=jo(t.wysiwyg.imeOffsetHorizontalEm,(a=ae.wysiwyg.imeOffsetHorizontalEm)!=null?a:.1),t.wysiwyg.imeOffsetVerticalEm=jo(t.wysiwyg.imeOffsetVerticalEm,(l=ae.wysiwyg.imeOffsetVerticalEm)!=null?l:.5);let g=t.wysiwyg.caretColorMode;g!=="text"&&g!=="accent"&&g!=="custom"&&(t.wysiwyg.caretColorMode=ae.wysiwyg.caretColorMode);let b=Number(t.wysiwyg.caretWidthPx);Number.isFinite(b)?t.wysiwyg.caretWidthPx=Math.max(Bh,Math.min(Fh,b)):t.wysiwyg.caretWidthPx=ae.wysiwyg.caretWidthPx,typeof t.wysiwyg.caretCustomColor!="string"&&(t.wysiwyg.caretCustomColor=ae.wysiwyg.caretCustomColor),typeof t.wysiwyg.ceUseNativeCaret!="boolean"&&(t.wysiwyg.ceUseNativeCaret=ae.wysiwyg.ceUseNativeCaret),typeof t.wysiwyg.useNativeSelection!="boolean"&&(t.wysiwyg.useNativeSelection=ae.wysiwyg.useNativeSelection);let v=Number(t.wysiwyg.sotPaddingTop);t.wysiwyg.sotPaddingTop=Number.isFinite(v)?Math.max(0,Math.min(200,v)):ae.wysiwyg.sotPaddingTop;let y=Number(t.wysiwyg.sotPaddingBottom);t.wysiwyg.sotPaddingBottom=Number.isFinite(y)?Math.max(0,Math.min(200,y)):ae.wysiwyg.sotPaddingBottom}if(!i.wysiwyg){t.wysiwyg.imeOffsetHorizontalEm=jo(t.wysiwyg.imeOffsetHorizontalEm,(c=ae.wysiwyg.imeOffsetHorizontalEm)!=null?c:.1),t.wysiwyg.imeOffsetVerticalEm=jo(t.wysiwyg.imeOffsetVerticalEm,(u=ae.wysiwyg.imeOffsetVerticalEm)!=null?u:.5);let m=Number(t.wysiwyg.caretWidthPx);t.wysiwyg.caretWidthPx=Number.isFinite(m)?Math.max(Bh,Math.min(Fh,m)):ae.wysiwyg.caretWidthPx}if(i.controlPanel&&typeof i.controlPanel=="object"&&(t.controlPanel={...t.controlPanel,...i.controlPanel}),Array.isArray(i.themes)){let m=new Map;for(let g of t.themes)m.set(g.id,g);for(let g of i.themes)g&&typeof g.id=="string"&&(g.mode||(g.mode="custom"),m.set(g.id,g));t.themes=Array.from(m.values())}if(typeof i.activeTheme=="string"&&(t.activeTheme=i.activeTheme),Array.isArray(i.customFonts)){let g=i.customFonts.filter(y=>typeof y=="string").map(y=>y.trim()).filter(y=>y.length>0),b=[...ae.customFonts,...g],v=new Set;t.customFonts=b.filter(y=>{let E=y.toLowerCase();return v.has(E)?!1:(v.add(E),!0)})}else t.customFonts=[...ae.customFonts];i.temporaryOverrides&&typeof i.temporaryOverrides=="object"?t.temporaryOverrides={...i.temporaryOverrides}:t.temporaryOverrides={}}return t.common.rubySize=Fl(t.common.rubySize),t.common.rubyVerticalGap=$i(t.common.rubyVerticalGap,ae.common.rubyVerticalGap),t.common.rubyHorizontalGap=$i(t.common.rubyHorizontalGap,ae.common.rubyHorizontalGap),t.customFonts=Array.isArray(t.customFonts)?[...t.customFonts]:[...ae.customFonts],t}var Ih=.2,Nh=1,Ph=-5,_h=5,Oh=-1,Dh=1,Bh=1,Fh=8;function Fl(i){let t=Number(i);return Number.isFinite(t)?t<Ih?Ih:t>Nh?Nh:t:ae.common.rubySize}function $i(i,t){let e=Number(i);return Number.isFinite(e)?e<Ph?Ph:e>_h?_h:e:t}function jo(i,t){let e=Number(i);return Number.isFinite(e)?e<Oh?Oh:e>Dh?Dh:e:t}var Ne=require("obsidian");function tx(i){return/^(0|[1-9]\d*)$/.test(i)?Number(i):i}function zh(i){var d,h,f,p;let t=String(i!=null?i:"").trim();if(!t)return null;let e=t.startsWith("v")?t.slice(1):t,n=(d=e.split("+")[0])!=null?d:e,[r,o]=n.split("-",2);if(!r)return null;let s=r.split(".").map(m=>m.trim());if(s.length<1||s.length>3)return null;let a=Number((h=s[0])!=null?h:"NaN"),l=Number((f=s[1])!=null?f:"0"),c=Number((p=s[2])!=null?p:"0");if(![a,l,c].every(m=>Number.isInteger(m)&&m>=0))return null;let u=o?o.split(".").map(m=>m.trim()).filter(m=>m.length>0).map(tx):[];return{major:a,minor:l,patch:c,preRelease:u}}function Vh(i,t){let e=zh(i),n=zh(t);if(!e||!n)return null;if(e.major!==n.major)return e.major>n.major?1:-1;if(e.minor!==n.minor)return e.minor>n.minor?1:-1;if(e.patch!==n.patch)return e.patch>n.patch?1:-1;let r=e.preRelease,o=n.preRelease,s=r.length>0,a=o.length>0;if(s!==a)return s?-1:1;if(!s&&!a)return 0;let l=Math.max(r.length,o.length);for(let c=0;c<l;c++){let u=r[c],d=o[c];if(u===void 0)return-1;if(d===void 0)return 1;if(u===d)continue;let h=typeof u=="number",f=typeof d=="number";if(h&&f)return u>d?1:-1;if(h!==f)return h?-1:1;let p=String(u),m=String(d);return p>m?1:-1}return 0}var nx="https://raw.githubusercontent.com/cat-left-paw/tategaki-plugin-release/main/latest.json",$h="https://github.com/cat-left-paw/tategaki-plugin-release/releases",Wh="https://www.buymeacoffee.com/hidarite",Xo=class extends Ne.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){var r;let{containerEl:e}=this;e.empty(),e.createEl("h1",{text:"Tategaki Plugin\u8A2D\u5B9A"}),this.addTiptapSettings(this.plugin.settings);let n=(r=this.plugin.settings.enableLegacyTiptap)!=null?r:!0;this.addUpdateAndSupportSection(n),this.addThemeSettings(this.plugin.settings),this.addDonationSection()}bindDeferredSlider(e,n,r){var m;let o=n,s=n,a=null,l=!1,c=1e-4,u=(m=r.debounce)!=null?m:200,d=()=>{a!==null&&(window.clearTimeout(a),a=null)},h=async()=>{if(l||(d(),Math.abs(o-s)<c))return;l=!0;let g=o;try{await r.onCommit(g),s=g}finally{l=!1}},f=()=>{if(d(),u<=0){h();return}a=window.setTimeout(()=>{h()},u)};e.onChange(g=>{let b=r.transform?r.transform(g):g;Math.abs(b-o)<c||(o=b,f())});let p=()=>{h()};e.sliderEl.addEventListener("change",p),e.sliderEl.addEventListener("blur",p),e.sliderEl.addEventListener("pointerup",p)}addTiptapSettings(e){var o;let{containerEl:n}=this,r=(o=e.enableLegacyTiptap)!=null?o:!0;new Ne.Setting(n).setName("\u4E92\u63DB\u30E2\u30FC\u30C9\uFF08TipTap\u30D9\u30FC\u30B9\u306E\u30A8\u30C7\u30A3\u30BF\uFF09").setDesc("TipTap\u30D9\u30FC\u30B9\u306E\u4E92\u63DB\u30D3\u30E5\u30FC\u3068\u540C\u671F\u6A5F\u80FD\u3092\u6709\u52B9\u5316\u3057\u307E\u3059\u3002\u30AA\u30D5\u306B\u3059\u308B\u3068\u4E92\u63DB\u7528\u306E\u540C\u671F/\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u8A2D\u5B9A\u3092\u975E\u8868\u793A\u306B\u3057\u307E\u3059").addToggle(s=>{s.setValue(r).onChange(async a=>{await this.plugin.updateSettings({enableLegacyTiptap:a}),this.display()})}),new Ne.Setting(n).setName("\u30D3\u30E5\u30FC\u8D77\u52D5\u6642\u306B\u30E2\u30FC\u30C9\u9078\u629E\u3092\u8868\u793A").setDesc("\u7E26\u66F8\u304D\u30D3\u30E5\u30FC\u3092\u958B\u304F\u3068\u304D\u306B\u3001\u57F7\u7B46\u30E2\u30FC\u30C9/\u53C2\u7167\u30E2\u30FC\u30C9\u3092\u9078\u629E\u3059\u308B\u30C0\u30A4\u30A2\u30ED\u30B0\u3092\u8868\u793A\u3057\u307E\u3059").addToggle(s=>{s.setValue(!!e.showModeDialog).onChange(async a=>{await this.plugin.updateSettings({showModeDialog:a})})}),r&&(n.createEl("h3",{text:"\u540C\u671F\u3068\u66F4\u65B0(\u4E92\u63DB\u30E2\u30FC\u30C9\u5C02\u7528)"}),new Ne.Setting(n).setName("\u5916\u90E8\u540C\u671F\u306E\u66F4\u65B0\u9593\u9694(ms)").setDesc("\u30AB\u30FC\u30BD\u30EB\u540C\u671F\u3084\u8FFD\u5F93\u6642\u306E\u30DD\u30FC\u30EA\u30F3\u30B0\u9593\u9694\u3067\u3059\u30020=\u30EA\u30A2\u30EB\u30BF\u30A4\u30E0\uFF08\u9AD8\u8CA0\u8377\u306E\u53EF\u80FD\u6027\uFF09\u3002\u5024\u3092\u5927\u304D\u304F\u3059\u308B\u307B\u3069\u8CA0\u8377\u306F\u8EFD\u304F\u306A\u308A\u307E\u3059").addSlider(s=>{s.setLimits(0,1e3,50).setDynamicTooltip().setValue(e.preview.updateInterval),this.bindDeferredSlider(s,e.preview.updateInterval,{debounce:200,onCommit:async a=>{a!==this.plugin.settings.preview.updateInterval&&await this.plugin.updateSettings({preview:{...this.plugin.settings.preview,updateInterval:a}})}})}),new Ne.Setting(n).setName("\u540C\u671F\u30E2\u30FC\u30C9").setDesc("\u81EA\u52D5: \u7DE8\u96C6\u6642\u306B\u81EA\u52D5\u4FDD\u5B58\u3001\u624B\u52D5: \u624B\u52D5\u3067\u540C\u671F\u30DC\u30BF\u30F3\u3092\u62BC\u3059\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\uFF08Tategaki\u30A8\u30C7\u30A3\u30BF\uFF09").addDropdown(s=>{s.addOption("auto","\u81EA\u52D5\u540C\u671F").addOption("manual","\u624B\u52D5\u540C\u671F").setValue(e.wysiwyg.syncMode).onChange(async a=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,syncMode:a}})})}),new Ne.Setting(n).setName("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210").setDesc("\u4E92\u63DB\u30E2\u30FC\u30C9\u306E\u540C\u671F\u6642\u306B\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002OFF\u306B\u3059\u308B\u3068\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u4F5C\u6210\u3055\u308C\u307E\u305B\u3093\uFF08\u4E8B\u6545\u6642\u306FObsidian\u306E\u300COpen version history\u300D\u3092\u5229\u7528\u3057\u3066\u304F\u3060\u3055\u3044\uFF09\u3002").addToggle(s=>{s.setValue(!!this.plugin.settings.wysiwyg.enableSyncBackup).onChange(async a=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableSyncBackup:a}})})}),new Ne.Setting(n).setName("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u304F").setDesc("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u4FDD\u5B58\u5148\uFF08.obsidian/tategaki-sync-backups\uFF09\u3092\u958B\u304D\u307E\u3059\u3002").addButton(s=>{s.setButtonText("\u958B\u304F").onClick(async()=>{await this.plugin.openSyncBackupFolder()})}),new Ne.Setting(n).setName("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5").setDesc("\u540C\u671F\u306E\u5B89\u5168\u7B56\u3068\u3057\u3066\u4F5C\u6210\u3055\u308C\u305F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3059\uFF08\u5FA9\u5143\u3067\u304D\u306A\u304F\u306A\u308B\u306E\u3067\u6CE8\u610F\uFF09").addButton(s=>{s.setButtonText("\u79FB\u52D5").setWarning().onClick(async()=>{await this.plugin.moveSyncBackupsToTrash()})}),new Ne.Setting(n).setName("\u30A2\u30D7\u30EA\u7D42\u4E86\u6642\u306E\u672A\u4FDD\u5B58\u5909\u66F4").setDesc("\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308B\u5834\u5408\u306B\u3001\u7D42\u4E86\u6642\u306B\u4FDD\u5B58\u3059\u308B\u304B\u7834\u68C4\u3059\u308B\u304B\u3092\u9078\u3073\u307E\u3059").addDropdown(s=>{var a;s.addOption("save","\u4FDD\u5B58\u3057\u3066\u7D42\u4E86").addOption("discard","\u7834\u68C4\u3057\u3066\u7D42\u4E86").setValue((a=e.wysiwyg.appCloseAction)!=null?a:"save").onChange(async l=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,appCloseAction:l}})})}),new Ne.Setting(n).setName("\u30AB\u30FC\u30BD\u30EB\u540C\u671F").setDesc("Obsidian\u6A19\u6E96\u30A8\u30C7\u30A3\u30BF\u3067\u30A2\u30AF\u30C6\u30A3\u30D6\u306A\u30AB\u30FC\u30BD\u30EB\u4F4D\u7F6E\u3092Tategaki\u30A8\u30C7\u30A3\u30BF\u306B\u3082\u53CD\u6620\u3057\u307E\u3059").addToggle(s=>{s.setValue(!!e.wysiwyg.syncCursor).onChange(async a=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,syncCursor:a}})})}))}addUpdateAndSupportSection(e){let{containerEl:n}=this;n.createEl("h2",{text:"\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8"}),new Ne.Setting(n).setName("\u624B\u52D5\u3067\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8\u3092\u78BA\u8A8D").setDesc("\u30DC\u30BF\u30F3\u3092\u62BC\u3057\u305F\u3068\u304D\u3060\u3051\u901A\u4FE1\u3057\u3066\u3001\u516C\u958BURL\u4E0A\u306E\u6700\u65B0\u7248\u60C5\u5831\u3092\u78BA\u8A8D\u3057\u307E\u3059").addButton(s=>{s.setButtonText("\u66F4\u65B0\u306E\u78BA\u8A8D").onClick(async()=>{var l,c,u;let a=this.plugin.manifest.version;try{let h=(l=(await(0,Ne.requestUrl)({url:nx})).json)!=null?l:{},f=String((c=h.version)!=null?c:"").trim(),p=String((u=h.url)!=null?u:"").trim();if(!f){new Ne.Notice("\u66F4\u65B0\u60C5\u5831\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\uFF08latest.json\u306E\u5F62\u5F0F\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\uFF09\u3002",3e3);return}if(f===a){new Ne.Notice(`Tategaki\u30A8\u30C7\u30A3\u30BF\u306F\u6700\u65B0\u3067\u3059\uFF08\u73FE\u5728: ${a}\uFF09\u3002`,2500);return}let m=Vh(f,a);if(m===null){let b=p?`\u66F4\u65B0\u60C5\u5831\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\uFF08\u516C\u958B: ${f} / \u73FE\u5728: ${a}\uFF09\u3002\u30D0\u30FC\u30B8\u30E7\u30F3\u6BD4\u8F03\u304C\u3067\u304D\u306A\u3044\u305F\u3081\u3001Releases \u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044: ${p}`:`\u66F4\u65B0\u60C5\u5831\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\uFF08\u516C\u958B: ${f} / \u73FE\u5728: ${a}\uFF09\u3002\u30D0\u30FC\u30B8\u30E7\u30F3\u6BD4\u8F03\u304C\u3067\u304D\u306A\u3044\u305F\u3081\u3001Releases \u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002`;new Ne.Notice(b,6e3);return}if(m<0){new Ne.Notice(`\u73FE\u5728\u306E\u307B\u3046\u304C\u65B0\u3057\u3044\u30D0\u30FC\u30B8\u30E7\u30F3\u3067\u3059\uFF08\u73FE\u5728: ${a} / \u516C\u958B: ${f}\uFF09\u3002`,4e3);return}let g=p?`\u65B0\u3057\u3044\u30D0\u30FC\u30B8\u30E7\u30F3 ${f} \u304C\u5229\u7528\u53EF\u80FD\u3067\u3059\uFF08\u73FE\u5728: ${a}\uFF09\u3002\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9: ${p}`:`\u65B0\u3057\u3044\u30D0\u30FC\u30B8\u30E7\u30F3 ${f} \u304C\u5229\u7528\u53EF\u80FD\u3067\u3059\uFF08\u73FE\u5728: ${a}\uFF09\u3002`;new Ne.Notice(g,5e3)}catch(d){console.error("Update check failed",d),new Ne.Notice("\u66F4\u65B0\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u901A\u4FE1\u72B6\u6CC1\u3068\u66F4\u65B0URL\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",3500)}})}).controlEl.createEl("a",{text:"\u30EA\u30EA\u30FC\u30B9\u30DA\u30FC\u30B8",attr:{href:$h,target:"_blank",rel:"noopener noreferrer",style:"margin-left: 8px; font-size: 12px;"}}).addEventListener("click",s=>{s.preventDefault(),window.open($h,"_blank","noopener,noreferrer")})}addDonationSection(){let{containerEl:e}=this;e.createEl("h2",{text:"\u30B5\u30DD\u30FC\u30C8"});let r=new Ne.Setting(e).setName("\u30B5\u30DD\u30FC\u30C8\uFF08\u5BC4\u4ED8\uFF09").setDesc("\u3053\u306E\u30D7\u30E9\u30B0\u30A4\u30F3\u3092\u6C17\u306B\u5165\u3063\u3066\u3044\u305F\u3060\u3051\u305F\u3089\u30B5\u30DD\u30FC\u30C8\u3092\u3057\u3066\u3044\u305F\u3060\u304F\u3068\u5E78\u3044\u3067\u3059\uFF08\u4EFB\u610F\uFF09").controlEl.createEl("a",{attr:{href:Wh,target:"_blank",rel:"noopener noreferrer","aria-label":"Buy Me a Coffee",style:"display: inline-flex;"}});r.createEl("img",{attr:{src:"https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png",alt:"Buy Me A Coffee",style:"height: 60px !important;width: 217px !important;"}}),r.addEventListener("click",o=>{o.preventDefault();try{window.open(Wh,"_blank","noopener,noreferrer")}catch(s){console.error("Failed to open donation link",s),new Ne.Notice("\u30EA\u30F3\u30AF\u3092\u958B\u3051\u307E\u305B\u3093\u3067\u3057\u305F\u3002",2500)}})}addThemeSettings(e){let{containerEl:n}=this;n.createEl("h2",{text:"\u30C6\u30FC\u30DE\u7BA1\u7406"});let r=e.activeTheme==="obsidian-base"?null:e.themes.find(c=>c.id===e.activeTheme),o=e.activeTheme==="obsidian-base"?"Obsidian \u30D9\u30FC\u30B9\u30C6\u30FC\u30DE":r?r.name:"\u672A\u77E5\u306E\u30C6\u30FC\u30DE";n.createEl("p",{text:`\u73FE\u5728\u306E\u30C6\u30FC\u30DE: ${o}`,cls:"setting-item-description"});let s=n.createDiv("theme-list-container");s.style.cssText=`
			border: 1px solid var(--background-modifier-border);
			border-radius: 6px;
			padding: 16px;
			margin: 16px 0;
			background: var(--background-secondary);
		`;let a=s.createEl("h3",{text:"\u4FDD\u5B58\u3055\u308C\u3066\u3044\u308B\u30C6\u30FC\u30DE"});a.style.cssText="margin: 0 0 12px 0;",(()=>{let c=s.querySelector(".theme-items");c&&c.remove();let u=s.createDiv("theme-items");u.style.cssText=`
				max-height: min(360px, 50vh);
				overflow-y: auto;
				padding-right: 6px;
			`,[{id:"obsidian-base",name:"Obsidian \u30D9\u30FC\u30B9\u30C6\u30FC\u30DE",description:"Obsidian\u3067\u9069\u7528\u3055\u308C\u3066\u3044\u308B\u30C6\u30FC\u30DE\u3092\u30D9\u30FC\u30B9\u3068\u3057\u305F\u30C6\u30FC\u30DE\u3067\u3059",mode:"obsidian-base",settings:{fontFamily:"",fontSize:16,lineHeight:1.5,headingFontFamily:"",colors:{text:"",background:"",pageBackground:"",accent:"",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},...e.themes].forEach((f,p)=>{var x;let m=u.createDiv("theme-item");m.style.cssText=`
					display: flex;
					align-items: center;
					justify-content: space-between;
					padding: 12px;
					margin: 8px 0;
					border: 1px solid var(--background-modifier-border);
					border-radius: 4px;
					background: var(--background-primary);
				`,f.id===e.activeTheme&&(m.style.borderColor="var(--interactive-accent)",m.style.backgroundColor="var(--background-secondary-alt)");let g=m.createDiv("theme-info");g.style.cssText="flex: 1;";let b=g.createEl("div",{text:f.name});b.style.cssText="font-weight: 500; margin-bottom: 4px;";let v=g.createEl("div",{text:f.description});if(v.style.cssText="font-size: 12px; color: var(--text-muted);",f.id!=="obsidian-base"){let S=g.createEl("div");S.style.cssText="font-size: 11px; color: var(--text-muted); margin-top: 4px;";let w=f.settings.headingFontFamily?f.settings.headingFontFamily.split(",")[0].trim():"\u672C\u6587\u3068\u540C\u3058",k=(x=f.settings.colors)!=null&&x.headingText?f.settings.colors.headingText:"\u672C\u6587\u3068\u540C\u3058";S.innerHTML=`
						<div>${f.settings.fontFamily} | ${f.settings.fontSize}px | \u884C\u9593${f.settings.lineHeight}</div>
						<div style="margin-top: 2px;">\u898B\u51FA\u3057: ${w} | ${k}</div>
					`}let y=m.createDiv("theme-buttons");if(y.style.cssText=`
					display: flex;
					gap: 8px;
					align-items: center;
				`,f.id!==e.activeTheme){let S=y.createEl("button",{text:"\u9069\u7528"});S.style.cssText="padding: 4px 8px; font-size: 11px;",S.addEventListener("click",async()=>{await this.plugin.loadTheme(f.id),this.display()})}else{let S=y.createEl("span",{text:"\u4F7F\u7528\u4E2D"});S.style.cssText="font-size: 11px; color: var(--interactive-accent); font-weight: 500;"}if(!(f.id==="obsidian-base"||Yo.includes(f.id))){let S=y.createEl("button",{text:"\u524A\u9664"});S.style.cssText="padding: 4px 8px; font-size: 11px; color: var(--text-error);",S.addEventListener("click",async()=>{confirm(`\u30C6\u30FC\u30DE\u300C${f.name}\u300D\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F\u3053\u306E\u64CD\u4F5C\u306F\u5143\u306B\u623B\u305B\u307E\u305B\u3093\u3002`)&&(await this.plugin.deleteTheme(f.id),this.display())})}})})(),new Ne.Setting(n).setName("\u30C6\u30FC\u30DE\u306E\u4F7F\u7528\u65B9\u6CD5").setDesc("\u8A2D\u5B9A\u30D1\u30CD\u30EB\u3067\u898B\u305F\u76EE\u3092\u8ABF\u6574\u3057\u305F\u5F8C\u3001\u300C\u73FE\u5728\u306E\u8A2D\u5B9A\u3092\u30C6\u30FC\u30DE\u3068\u3057\u3066\u4FDD\u5B58\u300D\u30DC\u30BF\u30F3\u304B\u3089\u65B0\u3057\u3044\u30C6\u30FC\u30DE\u3068\u3057\u3066\u4FDD\u5B58\u3067\u304D\u307E\u3059\u3002\u4FDD\u5B58\u3055\u308C\u305F\u30C6\u30FC\u30DE\u306F\u3053\u3053\u3067\u7BA1\u7406\u3067\u304D\u307E\u3059\u3002")}};var Dl=require("obsidian");var de=require("obsidian");function at(i){this.content=i}at.prototype={constructor:at,find:function(i){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===i)return t;return-1},get:function(i){var t=this.find(i);return t==-1?void 0:this.content[t+1]},update:function(i,t,e){var n=e&&e!=i?this.remove(e):this,r=n.find(i),o=n.content.slice();return r==-1?o.push(e||i,t):(o[r+1]=t,e&&(o[r]=e)),new at(o)},remove:function(i){var t=this.find(i);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new at(e)},addToStart:function(i,t){return new at([i,t].concat(this.remove(i).content))},addToEnd:function(i,t){var e=this.remove(i).content.slice();return e.push(i,t),new at(e)},addBefore:function(i,t,e){var n=this.remove(t),r=n.content.slice(),o=n.find(i);return r.splice(o==-1?r.length:o,0,t,e),new at(r)},forEach:function(i){for(var t=0;t<this.content.length;t+=2)i(this.content[t],this.content[t+1])},prepend:function(i){return i=at.from(i),i.size?new at(i.content.concat(this.subtract(i).content)):this},append:function(i){return i=at.from(i),i.size?new at(this.subtract(i).content.concat(i.content)):this},subtract:function(i){var t=this;i=at.from(i);for(var e=0;e<i.content.length;e+=2)t=t.remove(i.content[e]);return t},toObject:function(){var i={};return this.forEach(function(t,e){i[t]=e}),i},get size(){return this.content.length>>1}};at.from=function(i){if(i instanceof at)return i;var t=[];if(i)for(var e in i)t.push(e,i[e]);return new at(t)};var Hl=at;function Qh(i,t,e){for(let n=0;;n++){if(n==i.childCount||n==t.childCount)return i.childCount==t.childCount?null:e;let r=i.child(n),o=t.child(n);if(r==o){e+=r.nodeSize;continue}if(!r.sameMarkup(o))return e;if(r.isText&&r.text!=o.text){for(let s=0;r.text[s]==o.text[s];s++)e++;return e}if(r.content.size||o.content.size){let s=Qh(r.content,o.content,e+1);if(s!=null)return s}e+=r.nodeSize}}function ep(i,t,e,n){for(let r=i.childCount,o=t.childCount;;){if(r==0||o==0)return r==o?null:{a:e,b:n};let s=i.child(--r),a=t.child(--o),l=s.nodeSize;if(s==a){e-=l,n-=l;continue}if(!s.sameMarkup(a))return{a:e,b:n};if(s.isText&&s.text!=a.text){let c=0,u=Math.min(s.text.length,a.text.length);for(;c<u&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,e--,n--;return{a:e,b:n}}if(s.content.size||a.content.size){let c=ep(s.content,a.content,e-1,n-1);if(c)return c}e-=l,n-=l}}var z=class{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,r=0,o){for(let s=0,a=0;a<e;s++){let l=this.content[s],c=a+l.nodeSize;if(c>t&&n(l,r+a,o||null,s)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,t-u),Math.min(l.content.size,e-u),n,r+u)}a=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let o="",s=!0;return this.nodesBetween(t,e,(a,l)=>{let c=a.isText?a.text.slice(Math.max(t,l)-l,e-l):a.isLeaf?r?typeof r=="function"?r(a):r:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(s?s=!1:o+=n),o+=c},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new z(r,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],r=0;if(e>t)for(let o=0,s=0;s<e;o++){let a=this.content[o],l=s+a.nodeSize;l>t&&((s<t||l>e)&&(a.isText?a=a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a=a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),n.push(a),r+=a.nodeSize),s=l}return new z(n,r)}cutByIndex(t,e){return t==e?z.empty:t==0&&e==this.content.length?this:new z(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new z(r,o)}addToStart(t){return new z([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new z(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return Qh(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return ep(this,t,e,n)}findIndex(t){if(t==0)return Jo(0,t);if(t==this.size)return Jo(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,n=0;;e++){let r=this.child(e),o=n+r.nodeSize;if(o>=t)return o==t?Jo(e+1,o):Jo(e,n);n=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return z.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return z.empty;let e,n=0;for(let r=0;r<t.length;r++){let o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new z(e||t,n)}static from(t){if(!t)return z.empty;if(t instanceof z)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new z([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};z.empty=new z([],0);var zl={index:0,offset:0};function Jo(i,t){return zl.index=i,zl.offset=t,zl}function Qo(i,t){if(i===t)return!0;if(!(i&&typeof i=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(i);if(Array.isArray(t)!=e)return!1;if(e){if(i.length!=t.length)return!1;for(let n=0;n<i.length;n++)if(!Qo(i[n],t[n]))return!1}else{for(let n in i)if(!(n in t)||!Qo(i[n],t[n]))return!1;for(let n in t)if(!(n in i))return!1}return!0}var ve=class{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&Qo(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);let r=n.create(e.attrs);return n.checkAttrs(r.attrs),r}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return ve.none;if(t instanceof ve)return[t];let e=t.slice();return e.sort((n,r)=>n.type.rank-r.type.rank),e}};ve.none=[];var fi=class extends Error{},q=class{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=np(this.content,t+this.openStart,e);return n&&new q(n,this.openStart,this.openEnd)}removeBetween(t,e){return new q(tp(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return q.empty;let n=e.openStart||0,r=e.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new q(z.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(let o=t.lastChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.lastChild)r++;return new q(t,n,r)}};q.empty=new q(z.empty,0,0);function tp(i,t,e){let{index:n,offset:r}=i.findIndex(t),o=i.maybeChild(n),{index:s,offset:a}=i.findIndex(e);if(r==t||o.isText){if(a!=e&&!i.child(s).isText)throw new RangeError("Removing non-flat range");return i.cut(0,t).append(i.cut(e))}if(n!=s)throw new RangeError("Removing non-flat range");return i.replaceChild(n,o.copy(tp(o.content,t-r-1,e-r-1)))}function np(i,t,e,n){let{index:r,offset:o}=i.findIndex(t),s=i.maybeChild(r);if(o==t||s.isText)return n&&!n.canReplace(r,r,e)?null:i.cut(0,t).append(e).append(i.cut(t));let a=np(s.content,t-o-1,e,s);return a&&i.replaceChild(r,s.copy(a))}function ix(i,t,e){if(e.openStart>i.depth)throw new fi("Inserted content deeper than insertion position");if(i.depth-e.openStart!=t.depth-e.openEnd)throw new fi("Inconsistent open depths");return ip(i,t,e,0)}function ip(i,t,e,n){let r=i.index(n),o=i.node(n);if(r==t.index(n)&&n<i.depth-e.openStart){let s=ip(i,t,e,n+1);return o.copy(o.content.replaceChild(r,s))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&i.depth==n&&t.depth==n){let s=i.parent,a=s.content;return pi(s,a.cut(0,i.parentOffset).append(e.content).append(a.cut(t.parentOffset)))}else{let{start:s,end:a}=rx(e,i);return pi(o,op(i,s,a,t,n))}else return pi(o,es(i,t,n))}function rp(i,t){if(!t.type.compatibleContent(i.type))throw new fi("Cannot join "+t.type.name+" onto "+i.type.name)}function $l(i,t,e){let n=i.node(e);return rp(n,t.node(e)),n}function hi(i,t){let e=t.length-1;e>=0&&i.isText&&i.sameMarkup(t[e])?t[e]=i.withText(t[e].text+i.text):t.push(i)}function zr(i,t,e,n){let r=(t||i).node(e),o=0,s=t?t.index(e):r.childCount;i&&(o=i.index(e),i.depth>e?o++:i.textOffset&&(hi(i.nodeAfter,n),o++));for(let a=o;a<s;a++)hi(r.child(a),n);t&&t.depth==e&&t.textOffset&&hi(t.nodeBefore,n)}function pi(i,t){return i.type.checkContent(t),i.copy(t)}function op(i,t,e,n,r){let o=i.depth>r&&$l(i,t,r+1),s=n.depth>r&&$l(e,n,r+1),a=[];return zr(null,i,r,a),o&&s&&t.index(r)==e.index(r)?(rp(o,s),hi(pi(o,op(i,t,e,n,r+1)),a)):(o&&hi(pi(o,es(i,t,r+1)),a),zr(t,e,r,a),s&&hi(pi(s,es(e,n,r+1)),a)),zr(n,null,r,a),new z(a)}function es(i,t,e){let n=[];if(zr(null,i,e,n),i.depth>e){let r=$l(i,t,e+1);hi(pi(r,es(i,t,e+1)),n)}return zr(t,null,e,n),new z(n)}function rx(i,t){let e=t.depth-i.openStart,r=t.node(e).copy(i.content);for(let o=e-1;o>=0;o--)r=t.node(o).copy(z.from(r));return{start:r.resolveNoCache(i.openStart+e),end:r.resolveNoCache(r.content.size-i.openEnd-e)}}var mi=class{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[e*3],r=e==0?0:this.path[e*3-1]+1;for(let o=0;o<t;o++)r+=n.child(o).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return ve.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){let a=n;n=r,r=a}let o=n.marks;for(var s=0;s<o.length;s++)o[s].type.spec.inclusive===!1&&(!r||!o[s].isInSet(r.marks))&&(o=o[s--].removeFromSet(o));return o}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,r=t.parent.maybeChild(t.index());for(var o=0;o<n.length;o++)n[o].type.spec.inclusive===!1&&(!r||!n[o].isInSet(r.marks))&&(n=n[o--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new gi(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],r=0,o=e;for(let s=t;;){let{index:a,offset:l}=s.content.findIndex(o),c=o-l;if(n.push(s,a,r+l),!c||(s=s.child(a),s.isText))break;o=c-1,r+=l+1}return new mi(e,n,o)}static resolveCached(t,e){let n=Uh.get(t);if(n)for(let o=0;o<n.elts.length;o++){let s=n.elts[o];if(s.pos==e)return s}else Uh.set(t,n=new Wl);let r=n.elts[n.i]=mi.resolve(t,e);return n.i=(n.i+1)%ox,r}},Wl=class{constructor(){this.elts=[],this.i=0}},ox=12,Uh=new WeakMap,gi=class{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},sx=Object.create(null),tt=class{constructor(t,e,n,r=ve.none){this.type=t,this.attrs=e,this.marks=r,this.content=n||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,r=0){this.content.nodesBetween(t,e,n,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&Qo(this.attrs,e||t.defaultAttrs||sx)&&ve.sameSet(this.marks,n||ve.none)}copy(t=null){return t==this.content?this:new tt(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new tt(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return q.empty;let r=this.resolve(t),o=this.resolve(e),s=n?0:r.sharedDepth(e),a=r.start(s),c=r.node(s).content.cut(r.pos-a,o.pos-a);return new q(c,r.depth-s,o.depth-s)}replace(t,e,n){return ix(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let r=this.content.child(e-1);return{node:r,index:e-1,offset:n-r.nodeSize}}resolve(t){return mi.resolveCached(this,t)}resolveNoCache(t){return mi.resolve(this,t)}rangeHasMark(t,e,n){let r=!1;return e>t&&this.nodesBetween(t,e,o=>(n.isInSet(o.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),sp(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=z.empty,r=0,o=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,r,o),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(let l=r;l<o;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;let o=this.contentMatchAt(t).matchType(n),s=o&&o.matchFragment(this.content,e);return s?s.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=ve.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!ve.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let r=z.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,r,n);return o.type.checkAttrs(o.attrs),o}};tt.prototype.text=void 0;var Ui=class extends tt{constructor(t,e,n,r){if(super(t,e,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):sp(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new Ui(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new Ui(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}};function sp(i,t){for(let e=i.length-1;e>=0;e--)t=i[e].type.name+"("+t+")";return t}var Sn=class{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new Ul(t,e);if(n.next==null)return Sn.empty;let r=ap(n);n.next&&n.err("Unexpected trailing text");let o=px(hx(r));return fx(o,n),o}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let r=this;for(let o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let r=[this];function o(s,a){let l=s.matchFragment(t,n);if(l&&(!e||l.validEnd))return z.from(a.map(c=>c.createAndFill()));for(let c=0;c<s.next.length;c++){let{type:u,next:d}=s.next[c];if(!(u.isText||u.hasRequiredAttrs())&&r.indexOf(d)==-1){r.push(d);let h=o(d,a.concat(u));if(h)return h}}return null}return o(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),o=r.match;if(o.matchType(t)){let s=[];for(let a=r;a.type;a=a.via)s.push(a.type);return s.reverse()}for(let s=0;s<o.next.length;s++){let{type:a,next:l}=o.next[s];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in e)&&(!r.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:r}),e[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let r=0;r<n.next.length;r++)t.indexOf(n.next[r].next)==-1&&e(n.next[r].next)}return e(this),t.map((n,r)=>{let o=r+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)o+=(s?", ":"")+n.next[s].type.name+"->"+t.indexOf(n.next[s].next);return o}).join(`
`)}};Sn.empty=new Sn(!0);var Ul=class{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}};function ap(i){let t=[];do t.push(ax(i));while(i.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function ax(i){let t=[];do t.push(lx(i));while(i.next&&i.next!=")"&&i.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function lx(i){let t=dx(i);for(;;)if(i.eat("+"))t={type:"plus",expr:t};else if(i.eat("*"))t={type:"star",expr:t};else if(i.eat("?"))t={type:"opt",expr:t};else if(i.eat("{"))t=cx(i,t);else break;return t}function Kh(i){/\D/.test(i.next)&&i.err("Expected number, got '"+i.next+"'");let t=Number(i.next);return i.pos++,t}function cx(i,t){let e=Kh(i),n=e;return i.eat(",")&&(i.next!="}"?n=Kh(i):n=-1),i.eat("}")||i.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function ux(i,t){let e=i.nodeTypes,n=e[t];if(n)return[n];let r=[];for(let o in e){let s=e[o];s.isInGroup(t)&&r.push(s)}return r.length==0&&i.err("No node type or group '"+t+"' found"),r}function dx(i){if(i.eat("(")){let t=ap(i);return i.eat(")")||i.err("Missing closing paren"),t}else if(/\W/.test(i.next))i.err("Unexpected token '"+i.next+"'");else{let t=ux(i,i.next).map(e=>(i.inline==null?i.inline=e.isInline:i.inline!=e.isInline&&i.err("Mixing inline and block content"),{type:"name",value:e}));return i.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function hx(i){let t=[[]];return r(o(i,0),e()),t;function e(){return t.push([])-1}function n(s,a,l){let c={term:l,to:a};return t[s].push(c),c}function r(s,a){s.forEach(l=>l.to=a)}function o(s,a){if(s.type=="choice")return s.exprs.reduce((l,c)=>l.concat(o(c,a)),[]);if(s.type=="seq")for(let l=0;;l++){let c=o(s.exprs[l],a);if(l==s.exprs.length-1)return c;r(c,a=e())}else if(s.type=="star"){let l=e();return n(a,l),r(o(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=e();return r(o(s.expr,a),l),r(o(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(a)].concat(o(s.expr,a));if(s.type=="range"){let l=a;for(let c=0;c<s.min;c++){let u=e();r(o(s.expr,l),u),l=u}if(s.max==-1)r(o(s.expr,l),l);else for(let c=s.min;c<s.max;c++){let u=e();n(l,u),r(o(s.expr,l),u),l=u}return[n(l)]}else{if(s.type=="name")return[n(a,void 0,s.value)];throw new Error("Unknown expr type")}}}}function lp(i,t){return t-i}function qh(i,t){let e=[];return n(t),e.sort(lp);function n(r){let o=i[r];if(o.length==1&&!o[0].term)return n(o[0].to);e.push(r);for(let s=0;s<o.length;s++){let{term:a,to:l}=o[s];!a&&e.indexOf(l)==-1&&n(l)}}}function px(i){let t=Object.create(null);return e(qh(i,0));function e(n){let r=[];n.forEach(s=>{i[s].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<r.length;u++)r[u][0]==a&&(c=r[u][1]);qh(i,l).forEach(u=>{c||r.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let o=t[n.join(",")]=new Sn(n.indexOf(i.length-1)>-1);for(let s=0;s<r.length;s++){let a=r[s][1].sort(lp);o.next.push({type:r[s][0],next:t[a.join(",")]||e(a)})}return o}}function fx(i,t){for(let e=0,n=[i];e<n.length;e++){let r=n[e],o=!r.validEnd,s=[];for(let a=0;a<r.next.length;a++){let{type:l,next:c}=r.next[a];s.push(l.name),o&&!(l.isText||l.hasRequiredAttrs())&&(o=!1),n.indexOf(c)==-1&&n.push(c)}o&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function cp(i){let t=Object.create(null);for(let e in i){let n=i[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function up(i,t){let e=Object.create(null);for(let n in i){let r=t&&t[n];if(r===void 0){let o=i[n];if(o.hasDefault)r=o.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=r}return e}function dp(i,t,e,n){for(let r in t)if(!(r in i))throw new RangeError(`Unsupported attribute ${r} for ${e} of type ${r}`);for(let r in i){let o=i[r];o.validate&&o.validate(t[r])}}function hp(i,t){let e=Object.create(null);if(t)for(let n in t)e[n]=new Kl(i,n,t[n]);return e}var Ki=class{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=hp(t,n.attrs),this.defaultAttrs=cp(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Sn.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:up(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new tt(this,this.computeAttrs(t),z.from(e),ve.setFrom(n))}createChecked(t=null,e,n){return e=z.from(e),this.checkContent(e),new tt(this,this.computeAttrs(t),e,ve.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),e=z.from(e),e.size){let s=this.contentMatch.fillBefore(e);if(!s)return null;e=s.append(e)}let r=this.contentMatch.matchFragment(e),o=r&&r.fillBefore(z.empty,!0);return o?new tt(this,t,e.append(o),ve.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){dp(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:ve.none:t}static compile(t,e){let n=Object.create(null);t.forEach((o,s)=>n[o]=new Ki(o,e,s));let r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function mx(i,t,e){let n=e.split("|");return r=>{let o=r===null?"null":typeof r;if(n.indexOf(o)<0)throw new RangeError(`Expected value of type ${n} for attribute ${t} on type ${i}, got ${o}`)}}var Kl=class{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?mx(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}},bi=class{constructor(t,e,n,r){this.name=t,this.rank=e,this.schema=n,this.spec=r,this.attrs=hp(t,r.attrs),this.excluded=null;let o=cp(this.attrs);this.instance=o?new ve(this,o):null}create(t=null){return!t&&this.instance?this.instance:new ve(this,up(this.attrs,t))}static compile(t,e){let n=Object.create(null),r=0;return t.forEach((o,s)=>n[o]=new bi(o,r++,e,s)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){dp(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}},qi=class{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let r in t)e[r]=t[r];e.nodes=Hl.from(t.nodes),e.marks=Hl.from(t.marks||{}),this.nodes=Ki.compile(this.spec.nodes,this),this.marks=bi.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let o=this.nodes[r],s=o.spec.content||"",a=o.spec.marks;if(o.contentMatch=n[s]||(n[s]=Sn.parse(s,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=a=="_"?null:a?Gh(this,a.split(" ")):a==""||!o.inlineContent?[]:null}for(let r in this.marks){let o=this.marks[r],s=o.spec.excludes;o.excluded=s==null?[o]:s==""?[]:Gh(this,s.split(" "))}this.nodeFromJSON=r=>tt.fromJSON(this,r),this.markFromJSON=r=>ve.fromJSON(this,r),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,r){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof Ki){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,n,r)}text(t,e){let n=this.nodes.text;return new Ui(n,n.defaultAttrs,t,ve.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}};function Gh(i,t){let e=[];for(let n=0;n<t.length;n++){let r=t[n],o=i.marks[r],s=o;if(o)e.push(o);else for(let a in i.marks){let l=i.marks[a];(r=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(r)>-1)&&e.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return e}function gx(i){return i.tag!=null}function bx(i){return i.style!=null}var nt=class{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let n=this.matchedStyles=[];e.forEach(r=>{if(gx(r))this.tags.push(r);else if(bx(r)){let o=/[^=]*/.exec(r.style)[0];n.indexOf(o)<0&&n.push(o),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let o=t.nodes[r.node];return o.contentMatch.matchType(o)})}parse(t,e={}){let n=new ts(this,e,!1);return n.addAll(t,ve.none,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new ts(this,e,!0);return n.addAll(t,ve.none,e.from,e.to),q.maxOpen(n.finish())}matchTag(t,e,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let o=this.tags[r];if(Ex(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){let s=o.getAttrs(t);if(s===!1)continue;o.attrs=s||void 0}return o}}}matchStyle(t,e,n,r){for(let o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){let s=this.styles[o],a=s.style;if(!(a.indexOf(t)!=0||s.context&&!n.matchesContext(s.context)||a.length>t.length&&(a.charCodeAt(t.length)!=61||a.slice(t.length+1)!=e))){if(s.getAttrs){let l=s.getAttrs(e);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(t){let e=[];function n(r){let o=r.priority==null?50:r.priority,s=0;for(;s<e.length;s++){let a=e[s];if((a.priority==null?50:a.priority)<o)break}e.splice(s,0,r)}for(let r in t.marks){let o=t.marks[r].spec.parseDOM;o&&o.forEach(s=>{n(s=Yh(s)),s.mark||s.ignore||s.clearMark||(s.mark=r)})}for(let r in t.nodes){let o=t.nodes[r].spec.parseDOM;o&&o.forEach(s=>{n(s=Yh(s)),s.node||s.ignore||s.mark||(s.node=r)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new nt(t,nt.schemaRules(t)))}},pp={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},yx={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},fp={ol:!0,ul:!0},$r=1,ql=2,Vr=4;function jh(i,t,e){return t!=null?(t?$r:0)|(t==="full"?ql:0):i&&i.whitespace=="pre"?$r|ql:e&~Vr}var Wi=class{constructor(t,e,n,r,o,s){this.type=t,this.attrs=e,this.marks=n,this.solid=r,this.options=s,this.content=[],this.activeMarks=ve.none,this.match=o||(s&Vr?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(z.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let n=this.type.contentMatch,r;return(r=n.findWrapping(t.type))?(this.match=n,r):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&$r)){let n=this.content[this.content.length-1],r;if(n&&n.isText&&(r=/[ \t\r\n\u000c]+$/.exec(n.text))){let o=n;n.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-r[0].length))}}let e=z.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!pp.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}},ts=class{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=e.topNode,o,s=jh(null,e.preserveWhitespace,0)|(n?Vr:0);r?o=new Wi(r.type,r.attrs,ve.none,!0,e.topMatch||r.type.contentMatch,s):n?o=new Wi(null,null,ve.none,!0,null,s):o=new Wi(t.schema.topNodeType,null,ve.none,!0,null,s),this.nodes=[o],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let n=t.nodeValue,r=this.top,o=r.options&ql?"full":this.localPreserveWS||(r.options&$r)>0;if(o==="full"||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(o)o!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let s=r.content[r.content.length-1],a=t.previousSibling;(!s||a&&a.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),e,!/\S/.test(n)),this.findInText(t)}else this.findInside(t)}addElement(t,e,n){let r=this.localPreserveWS,o=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let s=t.nodeName.toLowerCase(),a;fp.hasOwnProperty(s)&&this.parser.normalizeLists&&vx(t);let l=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(a=this.parser.matchTag(t,this,n));e:if(l?l.ignore:yx.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(t=l.skip);let c,u=this.needsBlock;if(pp.hasOwnProperty(s))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),c=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break e}let d=l&&l.skip?e:this.readStyles(t,e);d&&this.addAll(t,d),c&&this.sync(o),this.needsBlock=u}else{let c=this.readStyles(t,e);c&&this.addElementByRule(t,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=r}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let n=t.style;if(n&&n.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let o=this.parser.matchedStyles[r],s=n.getPropertyValue(o);if(s)for(let a=void 0;;){let l=this.parser.matchStyle(o,s,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?e=e.filter(c=>!l.clearMark(c)):e=e.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return e}addElementByRule(t,e,n,r){let o,s;if(e.node)if(s=this.parser.schema.nodes[e.node],s.isLeaf)this.insertNode(s.create(e.attrs),n,t.nodeName=="BR")||this.leafFallback(t,n);else{let l=this.enter(s,e.attrs||null,n,e.preserveWhitespace);l&&(o=!0,n=l)}else{let l=this.parser.schema.marks[e.mark];n=n.concat(l.create(e.attrs))}let a=this.top;if(s&&s.isLeaf)this.findInside(t);else if(r)this.addElement(t,n,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=t;typeof e.contentElement=="string"?l=t.querySelector(e.contentElement):typeof e.contentElement=="function"?l=e.contentElement(t):e.contentElement&&(l=e.contentElement),this.findAround(t,l,!0),this.addAll(l,n),this.findAround(t,l,!1)}o&&this.sync(a)&&this.open--}addAll(t,e,n,r){let o=n||0;for(let s=n?t.childNodes[n]:t.firstChild,a=r==null?null:t.childNodes[r];s!=a;s=s.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(s,e);this.findAtPoint(t,o)}findPlace(t,e,n){let r,o;for(let s=this.open,a=0;s>=0;s--){let l=this.nodes[s],c=l.findWrapping(t);if(c&&(!r||r.length>c.length+a)&&(r=c,o=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!r)return null;this.sync(o);for(let s=0;s<r.length;s++)e=this.enterInner(r[s],null,e,!1);return e}insertNode(t,e,n){if(t.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(e=this.enterInner(o,null,e))}let r=this.findPlace(t,e,n);if(r){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(t.type));let s=ve.none;for(let a of r.concat(t.marks))(o.type?o.type.allowsMarkType(a.type):Xh(a.type,t.type))&&(s=a.addToSet(s));return o.content.push(t.mark(s)),!0}return!1}enter(t,e,n,r){let o=this.findPlace(t.create(e),n,!1);return o&&(o=this.enterInner(t,e,n,!0,r)),o}enterInner(t,e,n,r=!1,o){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(t);let a=jh(t,o,s.options);s.options&Vr&&s.content.length==0&&(a|=Vr);let l=ve.none;return n=n.filter(c=>(s.type?s.type.allowsMarkType(c.type):Xh(c.type,t))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Wi(t,e,l,r,null,a)),this.open++,n}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=$r)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)&&e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),o=-(n?n.depth+1:0)+(r?0:1),s=(a,l)=>{for(;a>=0;a--){let c=e[a];if(c==""){if(a==e.length-1||a==0)continue;for(;l>=o;l--)if(s(a-1,l))return!0;return!1}else{let u=l>0||l==0&&r?this.nodes[l].type:n&&l>=o?n.node(l-o).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let n=this.parser.schema.nodes[e];if(n.isTextblock&&n.defaultAttrs)return n}}};function vx(i){for(let t=i.firstChild,e=null;t;t=t.nextSibling){let n=t.nodeType==1?t.nodeName.toLowerCase():null;n&&fp.hasOwnProperty(n)&&e?(e.appendChild(t),t=e):n=="li"?e=t:n&&(e=null)}}function Ex(i,t){return(i.matches||i.msMatchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector).call(i,t)}function Yh(i){let t={};for(let e in i)t[e]=i[e];return t}function Xh(i,t){let e=t.schema.nodes;for(let n in e){let r=e[n];if(!r.allowsMarkType(i))continue;let o=[],s=a=>{o.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==t||o.indexOf(u)<0&&s(u))return!0}};if(s(r.contentMatch))return!0}}var Rt=class{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=Vl(e).createDocumentFragment());let r=n,o=[];return t.forEach(s=>{if(o.length||s.marks.length){let a=0,l=0;for(;a<o.length&&l<s.marks.length;){let c=s.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(o[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<o.length;)r=o.pop()[1];for(;l<s.marks.length;){let c=s.marks[l++],u=this.serializeMark(c,s.isInline,e);u&&(o.push([c,r]),r.appendChild(u.dom),r=u.contentDOM||u.dom)}}r.appendChild(this.serializeNodeInner(s,e))}),n}serializeNodeInner(t,e){let{dom:n,contentDOM:r}=Zo(Vl(e),this.nodes[t.type.name](t),null,t.attrs);if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n}serializeMark(t,e,n={}){let r=this.marks[t.type.name];return r&&Zo(Vl(n),r(t,e),null,t.attrs)}static renderSpec(t,e,n=null,r){return Zo(t,e,n,r)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new Rt(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=Jh(t.nodes);return e.text||(e.text=n=>n.text),e}static marksFromSchema(t){return Jh(t.marks)}};function Jh(i){let t={};for(let e in i){let n=i[e].spec.toDOM;n&&(t[e]=n)}return t}function Vl(i){return i.document||window.document}var Zh=new WeakMap;function xx(i){let t=Zh.get(i);return t===void 0&&Zh.set(i,t=Sx(i)),t}function Sx(i){let t=null;function e(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")t||(t=[]),t.push(n);else for(let r=0;r<n.length;r++)e(n[r]);else for(let r in n)e(n[r])}return e(i),t}function Zo(i,t,e,n){if(typeof t=="string")return{dom:i.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let r=t[0],o;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(o=xx(n))&&o.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=r.indexOf(" ");s>0&&(e=r.slice(0,s),r=r.slice(s+1));let a,l=e?i.createElementNS(e,r):i.createElement(r),c=t[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<t.length;d++){let h=t[d];if(h===0){if(d<t.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:p}=Zo(i,h,e,n);if(l.appendChild(f),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}var bp=65535,yp=Math.pow(2,16);function kx(i,t){return i+t*yp}function mp(i){return i&bp}function wx(i){return(i-(i&bp))/yp}var vp=1,Ep=2,ns=4,xp=8,Kr=class{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(this.delInfo&xp)>0}get deletedBefore(){return(this.delInfo&(vp|ns))>0}get deletedAfter(){return(this.delInfo&(Ep|ns))>0}get deletedAcross(){return(this.delInfo&ns)>0}},ft=class{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&ft.empty)return ft.empty}recover(t){let e=0,n=mp(t);if(!this.inverted)for(let r=0;r<n;r++)e+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+e+wx(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,o=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>t)break;let c=this.ranges[a+o],u=this.ranges[a+s],d=l+c;if(t<=d){let h=c?t==l?-1:t==d?1:e:e,f=l+r+(h<0?0:u);if(n)return f;let p=t==(e<0?l:d)?null:kx(a/3,t-l),m=t==l?Ep:t==d?vp:ns;return(e<0?t!=l:t!=d)&&(m|=xp),new Kr(f,m,p)}r+=u-c}return n?t+r:new Kr(t+r,0,null)}touches(t,e){let n=0,r=mp(e),o=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>t)break;let c=this.ranges[a+o],u=l+c;if(t<=u&&a==r*3)return!0;n+=this.ranges[a+s]-c}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,o=0;r<this.ranges.length;r+=3){let s=this.ranges[r],a=s-(this.inverted?o:0),l=s+(this.inverted?0:o),c=this.ranges[r+e],u=this.ranges[r+n];t(a,a+c,l,l+u),o+=u-c}}invert(){return new ft(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?ft.empty:new ft(t<0?[0,-t,0]:[0,0,t])}};ft.empty=new ft([]);var Kn=class{constructor(t,e,n=0,r=t?t.length:0){this.mirror=e,this.from=n,this.to=r,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new Kn(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,n=this._maps.length;e<t._maps.length;e++){let r=t.getMirror(e);this.appendMap(t._maps[e],r!=null&&r<e?n+r:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this._maps.length+t._maps.length;e>=0;e--){let r=t.getMirror(e);this.appendMap(t._maps[e].invert(),r!=null&&r>e?n-r-1:void 0)}}invert(){let t=new Kn;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this._maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let r=0;for(let o=this.from;o<this.to;o++){let s=this._maps[o],a=s.mapResult(t,e);if(a.recover!=null){let l=this.getMirror(o);if(l!=null&&l>o&&l<this.to){o=l,t=this._maps[l].recover(a.recover);continue}}r|=a.delInfo,t=a.pos}return n?t:new Kr(t,r,null)}},Gl=Object.create(null),Ye=class{getMap(){return ft.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Gl[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in Gl)throw new RangeError("Duplicate use of step JSON ID "+t);return Gl[t]=e,e.prototype.jsonID=t,e}},Be=class{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new Be(t,null)}static fail(t){return new Be(null,t)}static fromReplace(t,e,n,r){try{return Be.ok(t.replace(e,n,r))}catch(o){if(o instanceof fi)return Be.fail(o.message);throw o}}};function Zl(i,t,e){let n=[];for(let r=0;r<i.childCount;r++){let o=i.child(r);o.content.size&&(o=o.copy(Zl(o.content,t,o))),o.isInline&&(o=t(o,e,r)),n.push(o)}return z.fromArray(n)}var nn=class extends Ye{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),o=new q(Zl(e.content,(s,a)=>!s.isAtom||!a.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),r),e.openStart,e.openEnd);return Be.fromReplace(t,this.from,this.to,o)}invert(){return new Et(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new nn(e.pos,n.pos,this.mark)}merge(t){return t instanceof nn&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new nn(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new nn(e.from,e.to,t.markFromJSON(e.mark))}};Ye.jsonID("addMark",nn);var Et=class extends Ye{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new q(Zl(e.content,r=>r.mark(this.mark.removeFromSet(r.marks)),t),e.openStart,e.openEnd);return Be.fromReplace(t,this.from,this.to,n)}invert(){return new nn(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Et(e.pos,n.pos,this.mark)}merge(t){return t instanceof Et&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Et(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Et(e.from,e.to,t.markFromJSON(e.mark))}};Ye.jsonID("removeMark",Et);var rn=class extends Ye{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Be.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return Be.fromReplace(t,this.pos,this.pos+1,new q(z.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let n=this.mark.addToSet(e.marks);if(n.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(n))return new rn(this.pos,e.marks[r]);return new rn(this.pos,this.mark)}}return new kn(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new rn(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new rn(e.pos,t.markFromJSON(e.mark))}};Ye.jsonID("addNodeMark",rn);var kn=class extends Ye{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Be.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return Be.fromReplace(t,this.pos,this.pos+1,new q(z.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new rn(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new kn(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new kn(e.pos,t.markFromJSON(e.mark))}};Ye.jsonID("removeNodeMark",kn);var De=class extends Ye{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&Xl(t,this.from,this.to)?Be.fail("Structure replace would overwrite content"):Be.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new ft([this.from,this.to-this.from,this.slice.size])}invert(t){return new De(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new De(e.pos,Math.max(e.pos,n.pos),this.slice,this.structure)}merge(t){if(!(t instanceof De)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?q.empty:new q(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new De(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?q.empty:new q(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new De(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new De(e.from,e.to,q.fromJSON(t,e.slice),!!e.structure)}};Ye.jsonID("replace",De);var _e=class extends Ye{constructor(t,e,n,r,o,s,a=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=o,this.insert=s,this.structure=a}apply(t){if(this.structure&&(Xl(t,this.from,this.gapFrom)||Xl(t,this.gapTo,this.to)))return Be.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Be.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?Be.fromReplace(t,this.from,this.to,n):Be.fail("Content does not fit in gap")}getMap(){return new ft([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new _e(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),o=this.to==this.gapTo?n.pos:t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||o>n.pos?null:new _e(e.pos,n.pos,r,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new _e(e.from,e.to,e.gapFrom,e.gapTo,q.fromJSON(t,e.slice),e.insert,!!e.structure)}};Ye.jsonID("replaceAround",_e);function Xl(i,t,e){let n=i.resolve(t),r=e-t,o=n.depth;for(;r>0&&o>0&&n.indexAfter(o)==n.node(o).childCount;)o--,r--;if(r>0){let s=n.node(o).maybeChild(n.indexAfter(o));for(;r>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,r--}}return!1}function Mx(i,t,e,n){let r=[],o=[],s,a;i.doc.nodesBetween(t,e,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,t),f=Math.min(c+l.nodeSize,e),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(s&&s.to==h&&s.mark.eq(d[m])?s.to=f:r.push(s=new Et(h,f,d[m])));a&&a.to==h?a.to=f:o.push(a=new nn(h,f,n))}}),r.forEach(l=>i.step(l)),o.forEach(l=>i.step(l))}function Tx(i,t,e,n){let r=[],o=0;i.doc.nodesBetween(t,e,(s,a)=>{if(!s.isInline)return;o++;let l=null;if(n instanceof bi){let c=s.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let c=Math.min(a+s.nodeSize,e);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<r.length;f++){let p=r[f];p.step==o-1&&d.eq(r[f].style)&&(h=p)}h?(h.to=c,h.step=o):r.push({style:d,from:Math.max(a,t),to:c,step:o})}}}),r.forEach(s=>i.step(new Et(s.from,s.to,s.style)))}function Ql(i,t,e,n=e.contentMatch,r=!0){let o=i.doc.nodeAt(t),s=[],a=t+1;for(let l=0;l<o.childCount;l++){let c=o.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)s.push(new De(a,u,q.empty));else{n=d;for(let h=0;h<c.marks.length;h++)e.allowsMarkType(c.marks[h].type)||i.step(new Et(a,u,c.marks[h]));if(r&&c.isText&&e.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new q(z.from(e.schema.text(" ",e.allowedMarks(c.marks))),0,0)),s.push(new De(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(z.empty,!0);i.replace(a,a,new q(l,0,0))}for(let l=s.length-1;l>=0;l--)i.step(s[l])}function Cx(i,t,e){return(t==0||i.canReplace(t,i.childCount))&&(e==i.childCount||i.canReplace(0,e))}function wn(i){let e=i.parent.content.cutByIndex(i.startIndex,i.endIndex);for(let n=i.depth;;--n){let r=i.$from.node(n),o=i.$from.index(n),s=i.$to.indexAfter(n);if(n<i.depth&&r.canReplace(o,s,e))return n;if(n==0||r.type.spec.isolating||!Cx(r,o,s))break}return null}function Lx(i,t,e){let{$from:n,$to:r,depth:o}=t,s=n.before(o+1),a=r.after(o+1),l=s,c=a,u=z.empty,d=0;for(let p=o,m=!1;p>e;p--)m||n.index(p)>0?(m=!0,u=z.from(n.node(p).copy(u)),d++):l--;let h=z.empty,f=0;for(let p=o,m=!1;p>e;p--)m||r.after(p+1)<r.end(p)?(m=!0,h=z.from(r.node(p).copy(h)),f++):c++;i.step(new _e(l,c,s,a,new q(u.append(h),d,f),u.size-d,!0))}function Yi(i,t,e=null,n=i){let r=Rx(i,t),o=r&&Ax(n,t);return o?r.map(gp).concat({type:t,attrs:e}).concat(o.map(gp)):null}function gp(i){return{type:i,attrs:null}}function Rx(i,t){let{parent:e,startIndex:n,endIndex:r}=i,o=e.contentMatchAt(n).findWrapping(t);if(!o)return null;let s=o.length?o[0]:t;return e.canReplaceWith(n,r,s)?o:null}function Ax(i,t){let{parent:e,startIndex:n,endIndex:r}=i,o=e.child(n),s=t.contentMatch.findWrapping(o.type);if(!s)return null;let l=(s.length?s[s.length-1]:t).contentMatch;for(let c=n;l&&c<r;c++)l=l.matchType(e.child(c).type);return!l||!l.validEnd?null:s}function Ix(i,t,e){let n=z.empty;for(let s=e.length-1;s>=0;s--){if(n.size){let a=e[s].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=z.from(e[s].type.create(e[s].attrs,n))}let r=t.start,o=t.end;i.step(new _e(r,o,r,o,new q(n,0,0),e.length,!0))}function Nx(i,t,e,n,r){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=i.steps.length;i.doc.nodesBetween(t,e,(s,a)=>{let l=typeof r=="function"?r(s):r;if(s.isTextblock&&!s.hasMarkup(n,l)&&Px(i.doc,i.mapping.slice(o).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&kp(i,s,a,o),Ql(i,i.mapping.slice(o).map(a,1),n,void 0,c===null);let u=i.mapping.slice(o),d=u.map(a,1),h=u.map(a+s.nodeSize,1);return i.step(new _e(d,h,d+1,h-1,new q(z.from(n.create(l,null,s.marks)),0,0),1,!0)),c===!0&&Sp(i,s,a,o),!1}})}function Sp(i,t,e,n){t.forEach((r,o)=>{if(r.isText){let s,a=/\r?\n|\r/g;for(;s=a.exec(r.text);){let l=i.mapping.slice(n).map(e+1+o+s.index);i.replaceWith(l,l+1,t.type.schema.linebreakReplacement.create())}}})}function kp(i,t,e,n){t.forEach((r,o)=>{if(r.type==r.type.schema.linebreakReplacement){let s=i.mapping.slice(n).map(e+1+o);i.replaceWith(s,s+1,t.type.schema.text(`
`))}})}function Px(i,t,e){let n=i.resolve(t),r=n.index();return n.parent.canReplaceWith(r,r+1,e)}function _x(i,t,e,n,r){let o=i.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);let s=e.create(n,null,r||o.marks);if(o.isLeaf)return i.replaceWith(t,t+o.nodeSize,s);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);i.step(new _e(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new q(z.from(s),0,0),1,!0))}function At(i,t,e=1,n){let r=i.resolve(t),o=r.depth-e,s=n&&n[n.length-1]||r.parent;if(o<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!s.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,u=e-2;c>o;c--,u--){let d=r.node(c),h=r.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=r.indexAfter(o),l=n&&n[0];return r.node(o).canReplaceWith(a,a,l?l.type:r.node(o+1).type)}function Ox(i,t,e=1,n){let r=i.doc.resolve(t),o=z.empty,s=z.empty;for(let a=r.depth,l=r.depth-e,c=e-1;a>l;a--,c--){o=z.from(r.node(a).copy(o));let u=n&&n[c];s=z.from(u?u.type.create(u.attrs,s):r.node(a).copy(s))}i.step(new De(t,t,new q(o.append(s),e,e),!0))}function Ot(i,t){let e=i.resolve(t),n=e.index();return wp(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(n,n+1)}function Dx(i,t){t.content.size||i.type.compatibleContent(t.type);let e=i.contentMatchAt(i.childCount),{linebreakReplacement:n}=i.type.schema;for(let r=0;r<t.childCount;r++){let o=t.child(r),s=o.type==n?i.type.schema.nodes.text:o.type;if(e=e.matchType(s),!e||!i.type.allowsMarks(o.marks))return!1}return e.validEnd}function wp(i,t){return!!(i&&t&&!i.isLeaf&&Dx(i,t))}function vi(i,t,e=-1){let n=i.resolve(t);for(let r=n.depth;;r--){let o,s,a=n.index(r);if(r==n.depth?(o=n.nodeBefore,s=n.nodeAfter):e>0?(o=n.node(r+1),a++,s=n.node(r).maybeChild(a)):(o=n.node(r).maybeChild(a-1),s=n.node(r+1)),o&&!o.isTextblock&&wp(o,s)&&n.node(r).canReplace(a,a+1))return t;if(r==0)break;t=e<0?n.before(r):n.after(r)}}function Bx(i,t,e){let n=null,{linebreakReplacement:r}=i.doc.type.schema,o=i.doc.resolve(t-e),s=o.node().type;if(r&&s.inlineContent){let u=s.whitespace=="pre",d=!!s.contentMatch.matchType(r);u&&!d?n=!1:!u&&d&&(n=!0)}let a=i.steps.length;if(n===!1){let u=i.doc.resolve(t+e);kp(i,u.node(),u.before(),a)}s.inlineContent&&Ql(i,t+e-1,s,o.node().contentMatchAt(o.index()),n==null);let l=i.mapping.slice(a),c=l.map(t-e);if(i.step(new De(c,l.map(t+e,-1),q.empty,!0)),n===!0){let u=i.doc.resolve(c);Sp(i,u.node(),u.before(),i.steps.length)}return i}function Fx(i,t,e){let n=i.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),e))return t;if(n.parentOffset==0)for(let r=n.depth-1;r>=0;r--){let o=n.index(r);if(n.node(r).canReplaceWith(o,o,e))return n.before(r+1);if(o>0)return null}if(n.parentOffset==n.parent.content.size)for(let r=n.depth-1;r>=0;r--){let o=n.indexAfter(r);if(n.node(r).canReplaceWith(o,o,e))return n.after(r+1);if(o<n.node(r).childCount)return null}return null}function is(i,t,e){let n=i.resolve(t);if(!e.content.size)return t;let r=e.content;for(let o=0;o<e.openStart;o++)r=r.firstChild.content;for(let o=1;o<=(e.openStart==0&&e.size?2:1);o++)for(let s=n.depth;s>=0;s--){let a=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(a>0?1:0),c=n.node(s),u=!1;if(o==1)u=c.canReplace(l,l,r);else{let d=c.contentMatchAt(l).findWrapping(r.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?n.pos:a<0?n.before(s+1):n.after(s+1)}return null}function qr(i,t,e=t,n=q.empty){if(t==e&&!n.size)return null;let r=i.resolve(t),o=i.resolve(e);return Mp(r,o,n)?new De(t,e,n):new Jl(r,o,n).fit()}function Mp(i,t,e){return!e.openStart&&!e.openEnd&&i.start()==t.start()&&i.parent.canReplace(i.index(),t.index(),e.content)}var Jl=class{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=z.empty;for(let r=0;r<=t.depth;r++){let o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}for(let r=t.depth;r>0;r--)this.placed=z.from(t.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(t<0?this.$to:n.doc.resolve(t));if(!r)return null;let o=this.placed,s=n.depth,a=r.depth;for(;s&&a&&o.childCount==1;)o=o.firstChild.content,s--,a--;let l=new q(o,s,a);return t>-1?new _e(n.pos,t,this.$to.pos,this.$to.end(),l,e):l.size||n.pos!=this.$to.pos?new De(n.pos,r.pos,l):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<t;n++){let o=e.firstChild;if(e.childCount>1&&(r=0),o.type.spec.isolating&&r<=n){t=n;break}e=o.content}for(let e=1;e<=2;e++)for(let n=e==1?t:this.unplaced.openStart;n>=0;n--){let r,o=null;n?(o=jl(this.unplaced.content,n-1).firstChild,r=o.content):r=this.unplaced.content;let s=r.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(e==1&&(s?c.matchType(s.type)||(d=c.fillBefore(z.from(s),!1)):o&&l.compatibleContent(o.type)))return{sliceDepth:n,frontierDepth:a,parent:o,inject:d};if(e==2&&s&&(u=c.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:a,parent:o,wrap:u};if(o&&c.matchType(o.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,r=jl(t,e);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new q(t,e+1,Math.max(n,r.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,r=jl(t,e);if(r.childCount<=1&&e>0){let o=t.size-e<=e+r.size;this.unplaced=new q(Wr(t,e-1,1),e-1,o?e-1:n)}else this.unplaced=new q(Wr(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:r,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let m=0;m<o.length;m++)this.openFrontierNode(o[m]);let s=this.unplaced,a=n?n.content:s.content,l=s.openStart-t,c=0,u=[],{match:d,type:h}=this.frontier[e];if(r){for(let m=0;m<r.childCount;m++)u.push(r.child(m));d=d.matchFragment(r)}let f=a.size+t-(s.content.size-s.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Tp(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Ur(this.placed,e,z.from(u)),this.frontier[e].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let b=g.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),g=b.content}this.unplaced=p?t==0?q.empty:new q(Wr(s.content,t-1,1),t-1,f<0?s.openEnd:t-1):new q(Wr(s.content,t,c),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!Yl(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(t){e:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:r}=this.frontier[e],o=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=Yl(t,e,r,n,o);if(s){for(let a=e-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Yl(t,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:e,fit:s,move:o?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Ur(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t}openFrontierNode(t,e=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Ur(this.placed,this.depth,z.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(z.empty,!0);e.childCount&&(this.placed=Ur(this.placed,this.frontier.length,e))}};function Wr(i,t,e){return t==0?i.cutByIndex(e,i.childCount):i.replaceChild(0,i.firstChild.copy(Wr(i.firstChild.content,t-1,e)))}function Ur(i,t,e){return t==0?i.append(e):i.replaceChild(i.childCount-1,i.lastChild.copy(Ur(i.lastChild.content,t-1,e)))}function jl(i,t){for(let e=0;e<t;e++)i=i.firstChild.content;return i}function Tp(i,t,e){if(t<=0)return i;let n=i.content;return t>1&&(n=n.replaceChild(0,Tp(n.firstChild,t-1,n.childCount==1?e-1:0))),t>0&&(n=i.type.contentMatch.fillBefore(n).append(n),e<=0&&(n=n.append(i.type.contentMatch.matchFragment(n).fillBefore(z.empty,!0)))),i.copy(n)}function Yl(i,t,e,n,r){let o=i.node(t),s=r?i.indexAfter(t):i.index(t);if(s==o.childCount&&!e.compatibleContent(o.type))return null;let a=n.fillBefore(o.content,!0,s);return a&&!Hx(e,o.content,s)?a:null}function Hx(i,t,e){for(let n=e;n<t.childCount;n++)if(!i.allowsMarks(t.child(n).marks))return!0;return!1}function zx(i){return i.spec.defining||i.spec.definingForContent}function Vx(i,t,e,n){if(!n.size)return i.deleteRange(t,e);let r=i.doc.resolve(t),o=i.doc.resolve(e);if(Mp(r,o,n))return i.step(new De(t,e,n));let s=Lp(r,i.doc.resolve(e));s[s.length-1]==0&&s.pop();let a=-(r.depth+1);s.unshift(a);for(let h=r.depth,f=r.pos-1;h>0;h--,f--){let p=r.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;s.indexOf(h)>-1?a=h:r.before(h)==f&&s.splice(1,0,-h)}let l=s.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=zx(f.type);if(p&&!f.sameMarkup(r.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<s.length;m++){let g=s[(m+l)%s.length],b=!0;g<0&&(b=!1,g=-g);let v=r.node(g-1),y=r.index(g-1);if(v.canReplaceWith(y,y,p.type,p.marks))return i.replace(r.before(g),b?o.after(g):e,new q(Cp(n.content,0,n.openStart,f),f,n.openEnd))}}let d=i.steps.length;for(let h=s.length-1;h>=0&&(i.replace(t,e,n),!(i.steps.length>d));h--){let f=s[h];f<0||(t=r.before(f),e=o.after(f))}}function Cp(i,t,e,n,r){if(t<e){let o=i.firstChild;i=i.replaceChild(0,o.copy(Cp(o.content,t+1,e,n,o)))}if(t>n){let o=r.contentMatchAt(0),s=o.fillBefore(i).append(i);i=s.append(o.matchFragment(s).fillBefore(z.empty,!0))}return i}function $x(i,t,e,n){if(!n.isInline&&t==e&&i.doc.resolve(t).parent.content.size){let r=Fx(i.doc,t,n.type);r!=null&&(t=e=r)}i.replaceRange(t,e,new q(z.from(n),0,0))}function Wx(i,t,e){let n=i.doc.resolve(t),r=i.doc.resolve(e),o=Lp(n,r);for(let s=0;s<o.length;s++){let a=o[s],l=s==o.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return i.delete(n.start(a),r.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),r.indexAfter(a-1))))return i.delete(n.before(a),r.after(a))}for(let s=1;s<=n.depth&&s<=r.depth;s++)if(t-n.start(s)==n.depth-s&&e>n.end(s)&&r.end(s)-e!=r.depth-s&&n.start(s-1)==r.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),r.index(s-1)))return i.delete(n.before(s),e);i.delete(t,e)}function Lp(i,t){let e=[],n=Math.min(i.depth,t.depth);for(let r=n;r>=0;r--){let o=i.start(r);if(o<i.pos-(i.depth-r)||t.end(r)>t.pos+(t.depth-r)||i.node(r).type.spec.isolating||t.node(r).type.spec.isolating)break;(o==t.start(r)||r==i.depth&&r==t.depth&&i.parent.inlineContent&&t.parent.inlineContent&&r&&t.start(r-1)==o-1)&&e.push(r)}return e}var Un=class extends Ye{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return Be.fail("No node at attribute step's position");let n=Object.create(null);for(let o in e.attrs)n[o]=e.attrs[o];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return Be.fromReplace(t,this.pos,this.pos+1,new q(z.from(r),0,e.isLeaf?0:1))}getMap(){return ft.empty}invert(t){return new Un(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Un(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Un(e.pos,e.attr,e.value)}};Ye.jsonID("attr",Un);var yi=class extends Ye{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let r in t.attrs)e[r]=t.attrs[r];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return Be.ok(n)}getMap(){return ft.empty}invert(t){return new yi(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new yi(e.attr,e.value)}};Ye.jsonID("docAttr",yi);var Gi=class extends Error{};Gi=function i(t){let e=Error.call(this,t);return e.__proto__=i.prototype,e};Gi.prototype=Object.create(Error.prototype);Gi.prototype.constructor=Gi;Gi.prototype.name="TransformError";var ji=class{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Kn}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new Gi(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=q.empty){let r=qr(this.doc,t,e,n);return r&&this.step(r),this}replaceWith(t,e,n){return this.replace(t,e,new q(z.from(n),0,0))}delete(t,e){return this.replace(t,e,q.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return Vx(this,t,e,n),this}replaceRangeWith(t,e,n){return $x(this,t,e,n),this}deleteRange(t,e){return Wx(this,t,e),this}lift(t,e){return Lx(this,t,e),this}join(t,e=1){return Bx(this,t,e),this}wrap(t,e){return Ix(this,t,e),this}setBlockType(t,e=t,n,r=null){return Nx(this,t,e,n,r),this}setNodeMarkup(t,e,n=null,r){return _x(this,t,e,n,r),this}setNodeAttribute(t,e,n){return this.step(new Un(t,e,n)),this}setDocAttribute(t,e){return this.step(new yi(t,e)),this}addNodeMark(t,e){return this.step(new rn(t,e)),this}removeNodeMark(t,e){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e instanceof ve)e.isInSet(n.marks)&&this.step(new kn(t,e));else{let r=n.marks,o,s=[];for(;o=e.isInSet(r);)s.push(new kn(t,o)),r=o.removeFromSet(r);for(let a=s.length-1;a>=0;a--)this.step(s[a])}return this}split(t,e=1,n){return Ox(this,t,e,n),this}addMark(t,e,n){return Mx(this,t,e,n),this}removeMark(t,e,n){return Tx(this,t,e,n),this}clearIncompatible(t,e,n){return Ql(this,t,e,n),this}};var ec=Object.create(null),re=class{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new ss(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=q.empty){let n=e.content.lastChild,r=null;for(let a=0;a<e.openEnd;a++)r=n,n=n.lastChild;let o=t.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],u=t.mapping.slice(o);t.replaceRange(u.map(l.pos),u.map(c.pos),a?q.empty:e),a==0&&Ip(t,o,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:s,$to:a}=r[o],l=t.mapping.slice(n),c=l.map(s.pos),u=l.map(a.pos);o?t.deleteRange(c,u):(t.replaceRangeWith(c,u,e),Ip(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new G(t):Xi(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let o=t.depth-1;o>=0;o--){let s=e<0?Xi(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):Xi(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(s)return s}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new qe(t.node(0))}static atStart(t){return Xi(t,t,0,0,1)||new qe(t)}static atEnd(t){return Xi(t,t,t.content.size,t.childCount,-1)||new qe(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=ec[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in ec)throw new RangeError("Duplicate use of selection JSON ID "+t);return ec[t]=e,e.prototype.jsonID=t,e}getBookmark(){return G.between(this.$anchor,this.$head).getBookmark()}};re.prototype.visible=!0;var ss=class{constructor(t,e){this.$from=t,this.$to=e}},Rp=!1;function Ap(i){!Rp&&!i.parent.inlineContent&&(Rp=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+i.parent.type.name+")"))}var G=class extends re{constructor(t,e=t){Ap(t),Ap(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return re.near(n);let r=t.resolve(e.map(this.anchor));return new G(r.parent.inlineContent?r:n,n)}replace(t,e=q.empty){if(super.replace(t,e),e==q.empty){let n=this.$from.marksAcross(this.$to);n&&t.ensureMarks(n)}}eq(t){return t instanceof G&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Ji(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new G(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if((!n||r)&&(n=r>=0?1:-1),!e.parent.inlineContent){let o=re.findFrom(e,n,!0)||re.findFrom(e,-n,!0);if(o)e=o.$head;else return re.near(e,n)}return t.parent.inlineContent||(r==0?t=e:(t=(re.findFrom(t,-n,!0)||re.findFrom(t,n,!0)).$anchor,t.pos<e.pos!=r<0&&(t=e))),new G(t,e)}};re.jsonID("text",G);var Ji=class{constructor(t,e){this.anchor=t,this.head=e}map(t){return new Ji(t.map(this.anchor),t.map(this.head))}resolve(t){return G.between(t.resolve(this.anchor),t.resolve(this.head))}},Y=class extends re{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),o=t.resolve(r);return n?re.near(o):new Y(o)}content(){return new q(z.from(this.node),0,0)}eq(t){return t instanceof Y&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new jr(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Y(t.resolve(e.anchor))}static create(t,e){return new Y(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}};Y.prototype.visible=!1;re.jsonID("node",Y);var jr=class{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new Ji(n,n):new jr(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Y.isSelectable(n)?new Y(e):re.near(e)}},qe=class extends re{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=q.empty){if(e==q.empty){t.delete(0,t.doc.content.size);let n=re.atStart(t.doc);n.eq(t.selection)||t.setSelection(n)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new qe(t)}map(t){return new qe(t)}eq(t){return t instanceof qe}getBookmark(){return Ux}};re.jsonID("all",qe);var Ux={map(){return this},resolve(i){return new qe(i)}};function Xi(i,t,e,n,r,o=!1){if(t.inlineContent)return G.create(i,e);for(let s=n-(r>0?0:1);r>0?s<t.childCount:s>=0;s+=r){let a=t.child(s);if(a.isAtom){if(!o&&Y.isSelectable(a))return Y.create(i,e-(r<0?a.nodeSize:0))}else{let l=Xi(i,a,e+r,r<0?a.childCount:0,r,o);if(l)return l}e+=a.nodeSize*r}return null}function Ip(i,t,e){let n=i.steps.length-1;if(n<t)return;let r=i.steps[n];if(!(r instanceof De||r instanceof _e))return;let o=i.mapping.maps[n],s;o.forEach((a,l,c,u)=>{s==null&&(s=u)}),i.setSelection(re.near(i.doc.resolve(s),e))}var Np=1,rs=2,Pp=4,nc=class extends ji{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Np)&~rs,this.storedMarks=null,this}get selectionSet(){return(this.updated&Np)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=rs,this}ensureMarks(t){return ve.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&rs)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&~rs,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||ve.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let r=this.doc.type.schema;if(e==null)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();{if(n==null&&(n=e),n=n==null?e:n,!t)return this.deleteRange(e,n);let o=this.storedMarks;if(!o){let s=this.doc.resolve(e);o=n==e?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(re.near(this.selection.$to)),this}}setMeta(t,e){return this.meta[typeof t=="string"?t:t.key]=e,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Pp,this}get scrolledIntoView(){return(this.updated&Pp)>0}};function _p(i,t){return!t||!i?i:i.bind(t)}var Ei=class{constructor(t,e,n){this.name=t,this.init=_p(e.init,n),this.apply=_p(e.apply,n)}},Kx=[new Ei("doc",{init(i){return i.doc||i.schema.topNodeType.createAndFill()},apply(i){return i.doc}}),new Ei("selection",{init(i,t){return i.selection||re.atStart(t.doc)},apply(i){return i.selection}}),new Ei("storedMarks",{init(i){return i.storedMarks||null},apply(i,t,e,n){return n.selection.$cursor?i.storedMarks:null}}),new Ei("scrollToSelection",{init(){return 0},apply(i,t){return i.scrolledIntoView?t+1:t}})],Gr=class{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Kx.slice(),e&&e.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Ei(n.key,n.spec.state,n))})}},Mn=class{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),r=null;for(;;){let o=!1;for(let s=0;s<this.config.plugins.length;s++){let a=this.config.plugins[s];if(a.spec.appendTransaction){let l=r?r[s].n:0,c=r?r[s].state:this,u=l<e.length&&a.spec.appendTransaction.call(a,l?e.slice(l):e,c,n);if(u&&n.filterTransaction(u,s)){if(u.setMeta("appendedTransaction",t),!r){r=[];for(let d=0;d<this.config.plugins.length;d++)r.push(d<s?{state:n,n:e.length}:{state:this,n:0})}e.push(u),n=n.applyInner(u),o=!0}r&&(r[s]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new Mn(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}return e}get tr(){return new nc(this)}static create(t){let e=new Gr(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new Mn(e);for(let r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n}reconfigure(t){let e=new Gr(this.schema,t.plugins),n=e.fields,r=new Mn(e);for(let o=0;o<n.length;o++){let s=n[o].name;r[s]=this.hasOwnProperty(s)?this[s]:n[o].init(t,r)}return r}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(n=>n.toJSON())),t&&typeof t=="object")for(let n in t){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let r=new Gr(t.schema,t.plugins),o=new Mn(r);return r.fields.forEach(s=>{if(s.name=="doc")o.doc=tt.fromJSON(t.schema,e.doc);else if(s.name=="selection")o.selection=re.fromJSON(o.doc,e.selection);else if(s.name=="storedMarks")e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let a in n){let l=n[a],c=l.spec.state;if(l.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(e,a)){o[s.name]=c.fromJSON.call(l,t,e[a],o);return}}o[s.name]=s.init(t,o)}}),o}};function Op(i,t,e){for(let n in i){let r=i[n];r instanceof Function?r=r.bind(t):n=="handleDOMEvents"&&(r=Op(r,t,{})),e[n]=r}return e}var X=class{constructor(t){this.spec=t,this.props={},t.props&&Op(t.props,this,this.props),this.key=t.key?t.key.key:Dp("plugin")}getState(t){return t[this.key]}},tc=Object.create(null);function Dp(i){return i in tc?i+"$"+ ++tc[i]:(tc[i]=0,i+"$")}var se=class{constructor(t="key"){this.key=Dp(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}};var ic=!1;function rc(i){ic=i}function Bp(...i){ic&&console.log(...i)}function Ee(...i){ic&&console.warn(...i)}var c2=jp();var bS="\u300A",yS="\u300B",vS=/<ruby\b[^>]*>[\s\S]*?<\/ruby>/gi,ES={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" "},hc=typeof document!="undefined";function jt(i=bS,t=yS){let e=Yp(i),n=Yp(t);return new RegExp(`(?:(?:[|\\uFF5C]?(?<body1>[\\u4E00-\\u9FA0\\u3005]+?))|(?:[|\\uFF5C](?<body2>[^|\\uFF5C]+?)))${e}(?<ruby>.+?)${n}`,"gm")}function pc(i){var s,a,l,c,u,d,h,f,p,m;if(!i||!hc)return!1;let t=[],e=document.createTreeWalker(i,NodeFilter.SHOW_TEXT),n=e.nextNode();for(;n;)n instanceof Text&&t.push(n),n=e.nextNode();if(t.length===0)return!1;let r=!1,o=jt();for(let g of t){if(!g.parentElement||wS(g,i))continue;let b=g.textContent;if(!b)continue;let v=Array.from(b.matchAll(o));if(v.length===0)continue;let y=g;for(let E of v){let x=(s=E.groups)!=null?s:{},S=(l=(a=x.body2)!=null?a:x.body1)!=null?l:"",w=(c=x.ruby)!=null?c:"",k=E[0];if(!S||!w||!y.textContent)continue;let M=y.textContent.indexOf(k);if(M===-1)continue;let L=y.splitText(M),_=L.splitText(k.length),P=(d=(u=y.ownerDocument)==null?void 0:u.createElement("ruby"))!=null?d:document.createElement("ruby");P.textContent="";let I=(f=(h=y.ownerDocument)==null?void 0:h.createTextNode(S))!=null?f:document.createTextNode(S);P.appendChild(I);let N=(m=(p=y.ownerDocument)==null?void 0:p.createElement("rt"))!=null?m:document.createElement("rt");N.textContent=w,P.appendChild(N),L.replaceWith(P),y=_,r=!0}}return r}function Zi(i){if(!i)return i;if(hc){let t=document.createElement("div");return t.innerHTML=i,pc(t),t.innerHTML}return i.replace(jt(),(t,...e)=>{var s,a,l,c;let n=(s=e[e.length-1])!=null?s:{},r=(l=(a=n.body2)!=null?a:n.body1)!=null?l:"",o=(c=n.ruby)!=null?c:"";return!r||!o?t:`<ruby>${r}<rt>${o}</rt></ruby>`})}function qn(i,t={}){var n,r,o;if(!i)return i;let e=(n=t.addDelimiter)!=null?n:!0;if(hc){let s=document.createElement("div");s.innerHTML=i;let a=Array.from(s.querySelectorAll("ruby"));for(let l of a){let c=xS(l,e),u=(o=(r=s.ownerDocument)==null?void 0:r.createTextNode(c))!=null?o:document.createTextNode(c);l.replaceWith(u)}return s.innerHTML}return i.replace(vS,s=>SS(s,e))}function xS(i,t){var l;let e=i.querySelector("rt");if(!e)return i.outerHTML;let n=cs((l=e.textContent)!=null?l:"").trim(),r=[];i.childNodes.forEach(c=>{var u;if(c!==e){if(c.nodeType===Node.ELEMENT_NODE){let d=c.tagName;if(d==="RT"||d==="RP")return}r.push((u=c.textContent)!=null?u:"")}});let s=cs(r.join("")).replace(/\u00A0/g," ").trim();return s?`${t?"\uFF5C":""}${s}\u300A${n}\u300B`:i.outerHTML}function SS(i,t){var c,u;let e=i.match(/^<ruby\b[^>]*>([\s\S]*?)<\/ruby>$/i);if(!e)return i;let n=(c=e[1])!=null?c:"",r=n.match(/<rt[^>]*>([\s\S]*?)<\/rt>/i);if(!r)return i;let o=cs((u=r[1])!=null?u:"").trim(),s=n.replace(r[0],""),a=cs(kS(s)).replace(/\u00A0/g," ").trim();return a?`${t?"\uFF5C":""}${a}\u300A${o}\u300B`:i}function kS(i){return i.replace(/<[^>]*?>/g,"")}function Yp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function cs(i){return i.replace(/&[a-zA-Z#0-9]+;/g,t=>{var e;return(e=ES[t])!=null?e:t})}function wS(i,t){let e=i.parentNode;for(;e&&e!==t;){if(e.nodeType===Node.ELEMENT_NODE){let n=e.tagName;if(n==="CODE"||n==="PRE"||n==="RUBY"||n==="SCRIPT"||n==="STYLE"||n==="TEXTAREA")return!0}e=e.parentNode}return!1}var us=require("@codemirror/view"),Jp=require("@codemirror/state");var Qi=require("@codemirror/commands"),Zp=require("@codemirror/language");var Ge=require("obsidian");var xi=require("obsidian"),ds=class extends xi.Modal{constructor(e,n,r){super(e);this.result=null;this.styleElement=null;this.conflictData=n,this.onResolve=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-conflict-resolution-modal"),e.createEl("h2",{text:"\u30D5\u30A1\u30A4\u30EB\u7AF6\u5408\u306E\u89E3\u6C7A"});let n=e.createDiv("conflict-description");n.createEl("p",{text:`\u30D5\u30A1\u30A4\u30EB: ${this.conflictData.filePath}`}),n.createEl("p",{text:"\u3053\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u5916\u90E8\u3067\u5909\u66F4\u3055\u308C\u307E\u3057\u305F\u304C\u3001\u672A\u4FDD\u5B58\u306E\u7DE8\u96C6\u5185\u5BB9\u304C\u3042\u308A\u307E\u3059\u3002\u4FDD\u5B58\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"});let r=e.createDiv("conflict-buttons");r.style.cssText=`
			display: flex;
			gap: 0.5em;
			justify-content: flex-end;
			margin-top: 1em;
			padding-top: 1em;
			border-top: 1px solid var(--background-modifier-border);
		`,new xi.ButtonComponent(r).setButtonText("\u73FE\u5728\u306E\u5185\u5BB9\u3067\u4E0A\u66F8\u304D\u4FDD\u5B58").setClass("mod-cta").onClick(()=>{this.result={action:"overwrite"},this.close()}),new xi.ButtonComponent(r).setButtonText("\u5916\u90E8\u5909\u66F4\u3092\u53D6\u308A\u8FBC\u3080").onClick(()=>{this.result={action:"accept-external"},this.close()}),new xi.ButtonComponent(r).setButtonText("\u4E21\u65B9\u306E\u30D0\u30FC\u30B8\u30E7\u30F3\u3092\u4FDD\u5B58").onClick(()=>{this.result={action:"keep-both"},this.close()}),new xi.ButtonComponent(r).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.result={action:"cancel"},this.close()}),this.addModalStyles()}addModalStyles(){this.styleElement=document.createElement("style"),this.styleElement.textContent=`
			.tategaki-conflict-resolution-modal .conflict-description {
				margin-bottom: 1em;
				padding: 0.75em;
				background: var(--background-secondary);
				border-radius: 4px;
			}

			.tategaki-conflict-resolution-modal .conflict-buttons .clickable-icon {
				padding: 0.5em 1em;
				margin: 0;
			}

			.tategaki-conflict-resolution-modal .conflict-buttons {
				flex-wrap: wrap;
				justify-content: flex-end;
			}
		`,document.head.appendChild(this.styleElement)}onClose(){let{contentEl:e}=this;e.empty(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null),this.onResolve(this.result)}};var Qp=require("obsidian"),hs=class extends Qp.Modal{constructor(e,n,r){super(e);this.result=null;this.styleElement=null;this.data=n,this.onResolve=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-file-switch-modal"),e.createEl("h2",{text:"\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059"});let n=e.createDiv("file-switch-warning");n.style.cssText=`
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 16px;
			margin-bottom: 16px;
			background: var(--background-modifier-error);
			border: 1px solid var(--background-modifier-border);
			border-radius: 6px;
		`;let r=n.createDiv("warning-icon");r.innerHTML=`
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
				<line x1="12" y1="9" x2="12" y2="13"/>
				<line x1="12" y1="17" x2="12.01" y2="17"/>
			</svg>
		`,r.style.cssText=`
			color: var(--text-error);
			flex-shrink: 0;
		`;let o=n.createDiv("warning-text");o.innerHTML=`
			<strong>\u30D5\u30A1\u30A4\u30EB\u3092\u5207\u308A\u66FF\u3048\u3088\u3046\u3068\u3057\u3066\u3044\u307E\u3059</strong>
			<div style="margin-top: 4px; color: var(--text-muted); font-size: 0.9em;">
				\u73FE\u5728\u306E\u30D5\u30A1\u30A4\u30EB\u306B\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002\u5909\u66F4\u3092\u4FDD\u5B58\u3057\u307E\u3059\u304B\uFF1F
			</div>
		`;let s=e.createDiv("file-switch-info");s.style.cssText=`
			margin-bottom: 24px;
			padding: 12px;
			background: var(--background-secondary);
			border-radius: 4px;
		`;let a=s.createDiv();a.innerHTML=`
			<div style="margin-bottom: 8px;">
				<strong>\u73FE\u5728\u306E\u30D5\u30A1\u30A4\u30EB:</strong> ${this.data.currentFilePath}
				<span style="color: var(--text-error); margin-left: 8px;">\u25CF\u672A\u4FDD\u5B58</span>
			</div>
		`;let l=s.createDiv();l.innerHTML=`
			<strong>\u5207\u308A\u66FF\u3048\u5148:</strong> ${this.data.newFilePath}
		`;let c=e.createDiv("options-description");c.style.cssText=`
			margin-bottom: 20px;
			color: var(--text-muted);
			font-size: 0.95em;
		`,c.innerHTML=`
			<p>\u6B21\u306E\u3044\u305A\u308C\u304B\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\uFF1A</p>
			<ul style="margin: 8px 0; padding-left: 20px;">
				<li><strong>\u4FDD\u5B58\u3057\u3066\u5207\u308A\u66FF\u3048:</strong> \u73FE\u5728\u306E\u5909\u66F4\u3092\u4FDD\u5B58\u3057\u3066\u304B\u3089\u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u958B\u304D\u307E\u3059</li>
				<li><strong>\u7834\u68C4\u3057\u3066\u5207\u308A\u66FF\u3048:</strong> \u5909\u66F4\u3092\u7834\u68C4\u3057\u3066\u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u958B\u304D\u307E\u3059</li>
				<li><strong>\u30AD\u30E3\u30F3\u30BB\u30EB:</strong> \u30D5\u30A1\u30A4\u30EB\u5207\u308A\u66FF\u3048\u3092\u30AD\u30E3\u30F3\u30BB\u30EB\u3057\u307E\u3059</li>
			</ul>
		`;let u=e.createDiv("file-switch-buttons");u.style.cssText=`
			display: flex;
			gap: 8px;
			justify-content: flex-end;
			padding-top: 16px;
			border-top: 1px solid var(--background-modifier-border);
		`;let d=u.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB",cls:"mod-cta"});d.addEventListener("click",()=>{this.result={action:"cancel"},this.close()}),u.createEl("button",{text:"\u7834\u68C4\u3057\u3066\u5207\u308A\u66FF\u3048",cls:"mod-warning"}).addEventListener("click",()=>{this.result={action:"discard-and-switch"},this.close()}),u.createEl("button",{text:"\u4FDD\u5B58\u3057\u3066\u5207\u308A\u66FF\u3048",cls:"mod-cta"}).addEventListener("click",()=>{this.result={action:"save-and-switch"},this.close()}),this.addModalStyles(),setTimeout(()=>{d.focus()},100)}addModalStyles(){this.styleElement=document.createElement("style"),this.styleElement.textContent=`
			.tategaki-file-switch-modal .file-switch-buttons button {
				padding: 8px 16px;
				margin: 0 4px;
				min-width: 100px;
				border-radius: 4px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
				color: var(--text-normal);
				cursor: pointer;
			}

			.tategaki-file-switch-modal .file-switch-buttons button:hover {
				background: var(--background-modifier-hover);
			}

			.tategaki-file-switch-modal .file-switch-buttons button.mod-cta {
				background: var(--interactive-accent);
				color: var(--text-on-accent);
				border-color: var(--interactive-accent);
			}

			.tategaki-file-switch-modal .file-switch-buttons button.mod-warning {
				background: var(--color-orange);
				color: var(--text-on-accent);
				border-color: var(--color-orange);
			}

			.tategaki-file-switch-modal .modal-content {
				max-width: 550px;
			}

			.tategaki-file-switch-modal .file-switch-info strong {
				color: var(--text-normal);
			}

			.tategaki-file-switch-modal .options-description ul {
				list-style-type: disc;
			}

			.tategaki-file-switch-modal .options-description li {
				margin: 4px 0;
			}
		`,document.head.appendChild(this.styleElement)}onClose(){let{contentEl:e}=this;e.empty(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null),this.result===null&&(this.result={action:"cancel"}),this.onResolve(this.result)}};var fc=require("obsidian"),NS={maxWithin24h:20,usageDaysToKeep:7},er=".obsidian/tategaki-sync-backups",rf=er;async function ps(i,t,e,n,r={}){var d;let o=(d=r.reason)!=null?d:"manual-sync";await tf(i,er);let s=PS(t),a=`${er}/${s}`;await tf(i,a);let l=DS(new Date),c=await nf(i,`${a}/${l}_${o}__before.md`),u=await nf(i,`${a}/${l}_${o}__after.md`);return await Promise.all([i.vault.create(c,e),i.vault.create(u,n)]),await HS(i,a,NS),{backupFolderPath:a,beforePath:c,afterPath:u,timestamp:l,reason:o}}function fs(i,t){let e=ef(i),n=ef(t);return!!(e===n||e.endsWith(`
`)&&e.slice(0,-1)===n||n.endsWith(`
`)&&n.slice(0,-1)===e)}function ef(i){return i.replace(/\r\n/g,`
`)}async function of(i,t={}){let e=i.vault.adapter;if(!await e.exists(er))return"none";if(t.system!==!1)try{if(await e.trashSystem(er))return"system"}catch(o){}return await e.trashLocal(er),"local"}function PS(i){let t=_S(i.basename||"untitled"),e=OS(i.path);return`${t}__${e}`}function _S(i){let t=i.replace(/[^A-Za-z0-9._-]+/g,"_");return t.length>0?t:"file"}function OS(i){let t=2166136261;for(let e=0;e<i.length;e++)t^=i.charCodeAt(e),t=Math.imul(t,16777619);return(t>>>0).toString(16).padStart(8,"0")}function DS(i){let t=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),r=String(i.getHours()).padStart(2,"0"),o=String(i.getMinutes()).padStart(2,"0");return`${t}${e}${n}-${r}${o}`}function BS(i){return i.slice(0,8)}function FS(i){let t=i.match(/^(\d{4})(\d{2})(\d{2})-(\d{2})(\d{2})/);if(!t)return null;let[,e,n,r,o,s]=t;return new Date(parseInt(e,10),parseInt(n,10)-1,parseInt(r,10),parseInt(o,10),parseInt(s,10))}async function tf(i,t){let e=i.vault.getAbstractFileByPath(t);if(e){if(!(e instanceof fc.TFolder))throw new Error(`Backup path exists but is not a folder: ${t}`);return}let n=t.split("/").filter(Boolean),r="";for(let o of n){r=r?`${r}/${o}`:o;let s=i.vault.getAbstractFileByPath(r);if(!s){try{await i.vault.createFolder(r)}catch(a){if(!((a==null?void 0:a.message)||"").includes("Folder already exists"))throw a}continue}if(!(s instanceof fc.TFolder))throw new Error(`Backup path segment exists but is not a folder: ${r}`)}}async function nf(i,t){if(!i.vault.getAbstractFileByPath(t))return t;let e=1;for(;e<1e3;){let n=t.replace(/\.md$/,`-${e}.md`);if(!i.vault.getAbstractFileByPath(n))return n;e+=1}throw new Error(`Failed to allocate unique backup path: ${t}`)}async function HS(i,t,e){var d,h;let n=null;try{n=await i.vault.adapter.list(t)}catch(f){return}let r=new Map;for(let f of n.files){let p=(d=f.split("/").pop())!=null?d:"",m=p.indexOf("__");if(m<=0)continue;let g=p.slice(0,m),b=g.indexOf("_"),v=b>0?g.slice(0,b):g;r.has(g)||r.set(g,{groupKey:g,timestamp:v,datePart:BS(v),files:[],createdAt:FS(v)}),(h=r.get(g))==null||h.files.push(f)}if(r.size===0)return;let o=[...r.values()].sort((f,p)=>!f.createdAt||!p.createdAt?0:p.createdAt.getTime()-f.createdAt.getTime()),s=Date.now(),a=24*60*60*1e3,l=new Set,c=0;for(let f of o)f.createdAt&&s-f.createdAt.getTime()<=a&&c<e.maxWithin24h&&(l.add(f.groupKey),c++);let u=new Set;for(let f of o){if(l.has(f.groupKey)){u.add(f.datePart);continue}u.size<e.usageDaysToKeep&&(u.has(f.datePart)||(l.add(f.groupKey),u.add(f.datePart)))}for(let f of o)if(!l.has(f.groupKey))for(let p of f.files){let m=i.vault.getAbstractFileByPath(p);if(m){await i.vault.delete(m,!0);continue}try{await i.vault.adapter.remove(p)}catch(g){}}}var zS={bigPasteCharThreshold:200,bigPasteNewlineThreshold:2,autoIntervalMs:12e5},ms=class{constructor(t={}){this.lastBackupAt=null;this.sessionStartBackupDone=!1;this.config={...zS,...t}}needsSessionStartBackup(){return!this.sessionStartBackupDone}markSessionStartBackupDone(){this.sessionStartBackupDone=!0,this.lastBackupAt=Date.now()}recordBackup(){this.lastBackupAt=Date.now()}needsAutoIntervalBackup(){return this.lastBackupAt===null?!0:Date.now()-this.lastBackupAt>=this.config.autoIntervalMs}isBigPaste(t,e){if(e.length-t.length>=this.config.bigPasteCharThreshold)return!0;let r=(t.match(/\n/g)||[]).length;return(e.match(/\n/g)||[]).length-r>=this.config.bigPasteNewlineThreshold}isRiskyChange(t,e){let n=(t.match(/<ruby[\s>]/gi)||[]).length;if((e.match(/<ruby[\s>]/gi)||[]).length>n)return!0;let o=(t.match(/<span\s+class=/gi)||[]).length;return(e.match(/<span\s+class=/gi)||[]).length>o}detectBackupReason(t,e,n,r){return n?"manual-sync":this.needsSessionStartBackup()?"session-start":this.isRiskyChange(t,e)?"risky-change":this.isBigPaste(t,e)?"big-paste":r&&this.needsAutoIntervalBackup()?"auto-interval":null}reset(){this.sessionStartBackupDone=!1,this.lastBackupAt=null}};var VS=500,mc=class{constructor(t){this.currentFile=null;this.lastSavedMarkdown="";this.lastAppliedMarkdown="";this.isApplyingExternalUpdate=!1;this.isSaving=!1;this.dirty=!1;this.saveTimer=null;this.isHandlingFileSwitch=!1;this.lastCancelledFileSwitch=null;this.isManualSyncInProgress=!1;this.app=t.app,this.editor=t.editor,this.getSettings=t.getSettings,this.onStateChange=t.onStateChange,this.onBeforeApplyMarkdown=t.onBeforeApplyMarkdown,this.backupTriggerDetector=new ms,this.state={mode:this.resolveSyncMode(),dirty:!1,saving:!1,lastSavedAt:null,currentFilePath:null,lastSyncResult:null,lastSyncMessage:null}}async initialize(t){t!==void 0&&await this.loadFile(t)}dispose(){this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null),this.currentFile=null,this.lastSavedMarkdown="",this.lastAppliedMarkdown="",this.dirty=!1,this.isApplyingExternalUpdate=!1,this.isSaving=!1,this.isHandlingFileSwitch=!1}async flush(){this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null),this.dirty&&await this.persistChanges({force:!0})}onSettingsChanged(t){let e=this.resolveSyncMode(t);this.updateState({mode:e}),e==="manual"?this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null):this.dirty&&this.scheduleSave()}handleEditorUpdate(){if(!this.isApplyingExternalUpdate&&this.currentFile){if(!this.dirty){let t=this.editor.getMarkdown();if(fs(t,this.lastSavedMarkdown)||fs(t,this.lastAppliedMarkdown))return;this.dirty=!0,this.updateState({dirty:!0})}this.resolveSyncMode()==="auto"&&this.scheduleSave()}}async triggerManualSync(){if(!this.currentFile){new Ge.Notice("\u540C\u671F\u3059\u308B\u30D5\u30A1\u30A4\u30EB\u304C\u958B\u304B\u308C\u3066\u3044\u307E\u305B\u3093\u3002",2e3);return}this.isManualSyncInProgress=!0;try{await this.persistChanges({force:!0}),new Ge.Notice("\u30D5\u30A1\u30A4\u30EB\u3092\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002",2e3)}finally{this.isManualSyncInProgress=!1}}async loadFile(t,e={}){if(this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null),!t){this.currentFile=null,this.lastSavedMarkdown="",this.lastAppliedMarkdown="",this.dirty=!1,this.backupTriggerDetector.reset(),this.updateState({currentFilePath:null,dirty:!1,saving:!1,lastSavedAt:null});return}if(!this.currentFile){this.backupTriggerDetector.reset(),await this.applyMarkdownFromFile(t,"load")&&(this.currentFile=t);return}if(this.currentFile.path===t.path||e.forceReload){await this.applyMarkdownFromFile(t,"load");return}if(this.isHandlingFileSwitch)return;this.isHandlingFileSwitch=!0;let n=this.getState(),r=this.currentFile,o=this.lastSavedMarkdown,s=this.lastAppliedMarkdown,a=this.dirty;try{if(!await this.showFileSwitchConfirmation(this.currentFile.path,t.path,this.dirty))return;if(this.backupTriggerDetector.reset(),this.currentFile=t,this.dirty=!1,!await this.applyMarkdownFromFile(t,"load")){this.currentFile=r,this.lastSavedMarkdown=o,this.lastAppliedMarkdown=s,this.dirty=a,this.updateState(n);return}}finally{this.isHandlingFileSwitch=!1}}getState(){return{...this.state}}adoptExternalBaseline(t){this.lastSavedMarkdown=t,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty?(this.dirty=!1,this.updateState({dirty:!1})):this.updateState({lastSavedAt:Date.now()})}hasUnsavedChanges(){return this.dirty}clearDirtyFlag(){this.dirty=!1,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.updateState({dirty:!1})}async handleExternalChange(t){if(!this.currentFile||t.path!==this.currentFile.path||this.isSaving)return!1;let e=await this.app.vault.read(t);if(e===this.lastSavedMarkdown)return!1;let n=this.editor.getMarkdown(),r=this.dirty||n!==this.lastAppliedMarkdown;return r&&!this.dirty&&(this.dirty=!0,this.updateState({dirty:!0})),r?(await this.showConflictResolutionDialog(e),!0):(await this.applyMarkdownWithDecision(e,t,"external")).applied?(this.lastSavedMarkdown=e,this.updateState({dirty:this.dirty,saving:!1,lastSavedAt:Date.now()}),!0):!1}resolveSyncMode(t){var n;return(n=(t!=null?t:this.getSettings()).wysiwyg.syncMode)!=null?n:"manual"}scheduleSave(){this.saveTimer!=null&&window.clearTimeout(this.saveTimer),this.saveTimer=window.setTimeout(()=>{this.saveTimer=null,this.persistChanges()},VS)}async persistChanges(t={}){var o;if(!this.currentFile)return;let e=this.editor.getMarkdown(),n=e!==this.lastAppliedMarkdown;if(!t.force&&!this.dirty&&!n)return;if(!t.force&&!n){this.dirty=!1,this.updateState({dirty:!1});return}let r;try{r=await this.app.vault.read(this.currentFile)}catch(s){console.error("Tategaki BlockSync: failed to read file before save",s),new Ge.Notice("\u4FDD\u5B58\u524D\u306E\u8AAD\u307F\u53D6\u308A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3e3),this.updateState({lastSyncResult:"error",lastSyncMessage:"\u4FDD\u5B58\u524D\u306E\u8AAD\u307F\u53D6\u308A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"});return}if(!t.skipConflictCheck&&r!==this.lastSavedMarkdown){await this.showConflictResolutionDialog(r);return}this.isSaving=!0,this.updateState({saving:!0,lastSyncResult:null,lastSyncMessage:null});try{if((o=this.getSettings().wysiwyg.enableSyncBackup)!=null?o:!0){let l=this.backupTriggerDetector.detectBackupReason(r,e,this.isManualSyncInProgress,this.dirty);if(l)try{await ps(this.app,this.currentFile,r,e,{reason:l}),l==="session-start"?this.backupTriggerDetector.markSessionStartBackupDone():this.backupTriggerDetector.recordBackup()}catch(c){console.error("Tategaki BlockSync: failed to write sync backup",c),new Ge.Notice("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\uFF08\u4FDD\u5B58\u306F\u7D9A\u884C\u3057\u307E\u3059\uFF09\u3002",3500)}}await this.app.vault.modify(this.currentFile,e);let a;try{a=await this.app.vault.read(this.currentFile)}catch(l){console.error("Tategaki BlockSync: failed to read back file after save",l),new Ge.Notice("\u4FDD\u5B58\u5F8C\u306E\u8AAD\u307F\u623B\u3057\u691C\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\uFF08\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u6E08\u307F\uFF09\u3002",4e3),this.lastSavedMarkdown=e,this.lastAppliedMarkdown=e,this.dirty=!1,this.updateState({saving:!1,dirty:!1,lastSavedAt:Date.now(),lastSyncResult:"error",lastSyncMessage:"\u4FDD\u5B58\u5F8C\u306E\u8AAD\u307F\u623B\u3057\u691C\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"});return}if(!fs(e,a)){console.error("Tategaki BlockSync: read-back verification mismatch after save",{file:this.currentFile.path}),new Ge.Notice("\u540C\u671F\u306B\u5931\u6557\u3057\u305F\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\uFF08\u8AAD\u307F\u623B\u3057\u4E0D\u4E00\u81F4\uFF09\u3002\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u6E08\u307F\u3067\u3059\u3002",5e3);try{await this.app.vault.modify(this.currentFile,r),new Ge.Notice("\u5B89\u5168\u306E\u305F\u3081\u540C\u671F\u524D\u306E\u5185\u5BB9\u3078\u30ED\u30FC\u30EB\u30D0\u30C3\u30AF\u3057\u307E\u3057\u305F\u3002",4500)}catch(l){console.error("Tategaki BlockSync: rollback failed",l),new Ge.Notice("\u30ED\u30FC\u30EB\u30D0\u30C3\u30AF\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304B\u3089\u5FA9\u5143\u3057\u3066\u304F\u3060\u3055\u3044\u3002",6e3)}this.lastSavedMarkdown=r,this.lastAppliedMarkdown=e,this.dirty=!0,this.updateState({saving:!1,dirty:!0,lastSyncResult:"error",lastSyncMessage:"\u8AAD\u307F\u623B\u3057\u4E0D\u4E00\u81F4\u306E\u305F\u3081\u30ED\u30FC\u30EB\u30D0\u30C3\u30AF\u3057\u307E\u3057\u305F\u3002"});return}this.lastSavedMarkdown=a,this.lastAppliedMarkdown=e,this.dirty=!1,this.updateState({saving:!1,dirty:!1,lastSavedAt:Date.now(),lastSyncResult:"ok",lastSyncMessage:null})}catch(s){console.error("Tategaki BlockSync: failed to save file",s),new Ge.Notice("\u30D5\u30A1\u30A4\u30EB\u306E\u4FDD\u5B58\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3e3),this.updateState({saving:!1,lastSyncResult:"error",lastSyncMessage:"\u30D5\u30A1\u30A4\u30EB\u306E\u4FDD\u5B58\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"})}finally{this.isSaving=!1}}setEditorMarkdown(t){this.isApplyingExternalUpdate=!0;try{this.editor.setMarkdown(t)}finally{this.isApplyingExternalUpdate=!1}}async applyMarkdownFromFile(t,e){try{let n=await this.app.vault.read(t);return(await this.applyMarkdownWithDecision(n,t,e)).applied?(this.lastSavedMarkdown=n,this.updateState({currentFilePath:t.path,dirty:this.dirty,saving:!1,lastSavedAt:Date.now(),lastSyncResult:null,lastSyncMessage:null}),!0):!1}catch(n){return console.error("Tategaki BlockSync: failed to load file",n),new Ge.Notice("\u30D5\u30A1\u30A4\u30EB\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2e3),!1}}async applyMarkdownWithDecision(t,e,n){let r=null;if(this.onBeforeApplyMarkdown)try{r=await this.onBeforeApplyMarkdown(t,{file:e,source:n})}catch(a){Ee("Tategaki BlockSync: before-apply hook failed",a),r=null}if(r&&r.action==="cancel")return{applied:!1,markDirty:!1};let o=(r==null?void 0:r.action)==="apply"&&r.markdown!=null?r.markdown:t,s=(r==null?void 0:r.action)==="apply"&&r.markDirty===!0;return this.setEditorMarkdown(o),s?(this.lastAppliedMarkdown=t,this.dirty=!0,this.updateState({dirty:!0})):(this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty=!1,this.updateState({dirty:!1})),{applied:!0,markDirty:s}}async showConflictResolutionDialog(t){if(!this.currentFile)return;let e=this.editor.getMarkdown(),n={currentContent:e,externalContent:t,filePath:this.currentFile.path};return new Promise(r=>{new ds(this.app,n,async s=>{if(!s||s.action==="cancel"){new Ge.Notice("\u7AF6\u5408\u89E3\u6C7A\u304C\u30AD\u30E3\u30F3\u30BB\u30EB\u3055\u308C\u307E\u3057\u305F\u3002",3e3),r();return}try{switch(s.action){case"overwrite":await this.persistChanges({force:!0,skipConflictCheck:!0}),new Ge.Notice("\u73FE\u5728\u306E\u5185\u5BB9\u3067\u4E0A\u66F8\u304D\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002",3e3);break;case"accept-external":this.setEditorMarkdown(t),this.lastSavedMarkdown=t,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty=!1,this.updateState({dirty:!1,saving:!1,lastSavedAt:Date.now()}),new Ge.Notice("\u5916\u90E8\u5909\u66F4\u3092\u53D6\u308A\u8FBC\u307F\u307E\u3057\u305F\u3002",3e3);break;case"keep-both":await this.saveBothVersions(e,t);break}}catch(a){console.error("Tategaki BlockSync: conflict resolution failed",a),new Ge.Notice("\u7AF6\u5408\u89E3\u6C7A\u51E6\u7406\u3067\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002",4e3)}r()}).open()})}async saveBothVersions(t,e){var u,d;if(!this.currentFile)return;let n=(d=(u=this.currentFile.parent)==null?void 0:u.path)!=null?d:"",r=this.currentFile.basename,o=this.currentFile.extension||"md",s=this.formatTimestamp(new Date),a=0,l;do{let h=a===0?"":`-${a}`,f=`${r} (\u7AF6\u5408\u30B3\u30D4\u30FC ${s}${h}).${o}`;l=n?`${n}/${f}`:f,a+=1}while(this.app.vault.getAbstractFileByPath(l));await this.app.vault.create(l,t),this.setEditorMarkdown(e),this.lastSavedMarkdown=e,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty=!1,this.updateState({dirty:!1,saving:!1,lastSavedAt:Date.now()});let c=this.extractFileName(l);new Ge.Notice(`\u73FE\u5728\u306E\u5185\u5BB9\u3092\u300C${c}\u300D\u3068\u3057\u3066\u4FDD\u5B58\u3057\u3001\u5916\u90E8\u5909\u66F4\u3092\u53CD\u6620\u3057\u307E\u3057\u305F\u3002`,4e3)}formatTimestamp(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return`${e}${n}${r}-${o}${s}${a}`}extractFileName(t){var n;let e=t.split("/");return(n=e[e.length-1])!=null?n:t}async showFileSwitchConfirmation(t,e,n){if(!n)return!0;let r=this.lastCancelledFileSwitch;if(r&&r.currentFilePath===t&&r.newFilePath===e&&Date.now()-r.at<mc.FILE_SWITCH_CANCEL_COOLDOWN_MS)return!1;let o={currentFilePath:t,newFilePath:e,hasUnsavedChanges:n};return new Promise(s=>{new hs(this.app,o,l=>{if(!l||l.action==="cancel"){this.lastCancelledFileSwitch={currentFilePath:t,newFilePath:e,at:Date.now()},s(!1);return}this.lastCancelledFileSwitch=null,this.executeFileSwitchAction(l.action).then(()=>s(!0)).catch(c=>{console.error("Tategaki BlockSync: file switch action failed",c),new Ge.Notice("\u30D5\u30A1\u30A4\u30EB\u5207\u308A\u66FF\u3048\u51E6\u7406\u3067\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002",3e3),s(!1)})}).open()})}async executeFileSwitchAction(t){switch(t){case"save-and-switch":await this.persistChanges({force:!0}),new Ge.Notice("\u5909\u66F4\u3092\u4FDD\u5B58\u3057\u3066\u30D5\u30A1\u30A4\u30EB\u3092\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002",2e3);break;case"discard-and-switch":this.dirty=!1,this.updateState({dirty:!1}),new Ge.Notice("\u5909\u66F4\u3092\u7834\u68C4\u3057\u3066\u30D5\u30A1\u30A4\u30EB\u3092\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002",2e3);break}}updateState(t){var e;this.state={...this.state,...t},(e=this.onStateChange)==null||e.call(this,this.getState())}},Yr=mc;Yr.FILE_SWITCH_CANCEL_COOLDOWN_MS=800;var sf=require("obsidian"),tr=class extends sf.Modal{constructor(e,n="\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002"){super(e);this.message=n;this.result=null;this.resolvePromise=null}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\u672A\u4FDD\u5B58\u306E\u5909\u66F4"}),e.createEl("p",{text:this.message});let n=e.createDiv({cls:"modal-button-container"});n.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
		`,n.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",()=>{this.result="save",this.close()}),n.createEl("button",{text:"\u7834\u68C4",cls:"mod-warning"}).addEventListener("click",()=>{this.result="discard",this.close()}),n.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB"}).addEventListener("click",()=>{this.result="cancel",this.close()})}onClose(){let{contentEl:e}=this;e.empty(),this.resolvePromise&&this.resolvePromise(this.result||"cancel")}async waitForChoice(){return new Promise(e=>{this.resolvePromise=e,this.open()})}};var on=require("obsidian");var gc=class extends on.Modal{constructor(e,n){super(e);this.inputEl=null;this.onSubmit=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\u30C6\u30FC\u30DE\u540D\u3092\u5165\u529B"}),new on.Setting(e).setName("\u30C6\u30FC\u30DE\u540D").addText(n=>{this.inputEl=n.inputEl,n.setPlaceholder("\u4F8B: \u30DE\u30A4\u30C6\u30FC\u30DE").onChange(()=>{}),n.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),this.submit())})}),new on.Setting(e).addButton(n=>n.setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.close()})).addButton(n=>n.setButtonText("\u4FDD\u5B58").setCta().onClick(()=>{this.submit()})),setTimeout(()=>{this.inputEl&&(this.inputEl.focus(),this.inputEl.select())},50)}submit(){var n;let e=(n=this.inputEl)==null?void 0:n.value.trim();e&&(this.onSubmit(e),this.close())}onClose(){let{contentEl:e}=this;e.empty()}};function $S(i,t,e){let n=document.createElement("div");n.style.cssText=`
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.5);
		z-index: 10000;
		display: flex;
		align-items: center;
		justify-content: center;
	`;let r=document.createElement("div");r.style.cssText=`
		background: var(--background-primary);
		border: 1px solid var(--background-modifier-border);
		border-radius: var(--radius-m);
		padding: 20px;
		min-width: 300px;
		box-shadow: var(--shadow-l);
	`;let o=document.createElement("h3");o.textContent=i,o.style.cssText=`
		margin: 0 0 16px 0;
		color: var(--text-normal);
	`;let s=document.createElement("div");s.style.cssText=`
		display: flex;
		gap: 12px;
		align-items: center;
		margin-bottom: 20px;
	`;let a=document.createElement("input");a.type="color",a.value=t,a.style.cssText=`
		width: 60px;
		height: 40px;
		border: 1px solid var(--background-modifier-border);
		border-radius: var(--radius-s);
		cursor: pointer;
	`;let l=document.createElement("input");l.type="text",l.value=t,l.style.cssText=`
		flex: 1;
		padding: 8px 12px;
		border: 1px solid var(--background-modifier-border);
		border-radius: var(--radius-s);
		background: var(--background-primary);
		color: var(--text-normal);
		font-family: var(--font-monospace);
	`,a.addEventListener("input",()=>{l.value=a.value}),l.addEventListener("input",()=>{/^#[0-9a-fA-F]{6}$/.test(l.value)&&(a.value=l.value)});let c=document.createElement("div");c.style.cssText=`
		display: flex;
		gap: 8px;
		justify-content: flex-end;
	`;let u=document.createElement("button");u.textContent="\u30AD\u30E3\u30F3\u30BB\u30EB",u.className="mod-cta";let d=document.createElement("button");d.textContent="OK",d.className="mod-cta";let h=()=>{document.body.removeChild(n)};u.addEventListener("click",h),d.addEventListener("click",()=>{e(a.value),h()}),l.addEventListener("keydown",f=>{f.key==="Enter"?(e(a.value),h()):f.key==="Escape"&&h()}),n.addEventListener("click",f=>{f.target===n&&h()}),s.appendChild(a),s.appendChild(l),c.appendChild(u),c.appendChild(d),r.appendChild(o),r.appendChild(s),r.appendChild(c),n.appendChild(r),document.body.appendChild(n),setTimeout(()=>l.focus(),100)}var bc=class extends on.Modal{constructor(e,n,r,o){var s,a;super(e);this.applySettingsTimer=null;this.lastAppliedSettingsSnapshot="";this.plugin=n,this.onSettingsChange=r,this.tempSettings=JSON.parse(JSON.stringify(n.settings)),Array.isArray(this.tempSettings.customFonts)||(this.tempSettings.customFonts=[]),this.panelContext={mode:(s=o==null?void 0:o.mode)!=null?s:"sot",isCeImeMode:(a=o==null?void 0:o.isCeImeMode)!=null?a:!1}}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tategaki-settings-modal"),this.containerEl.addClass("tategaki-settings-modal-container"),e.createEl("h2",{text:"\u8868\u793A\u8A2D\u5B9A"});let n=e.createDiv("settings-scroll-container");n.style.cssText=`
			max-height: 60vh;
			overflow-y: auto;
			padding-right: 10px;
		`,this.createSettingsUI(n)}createCollapsibleSection(e,n,r,o,s){let a=o,l=e.createDiv("tategaki-settings-section");l.style.cssText=`
			margin-bottom: 4px;
			border: 1px solid var(--background-modifier-border);
			border-radius: 8px;
			overflow: hidden;
		`;let c=l.createDiv("tategaki-settings-section-header");c.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 10px 14px;
			cursor: pointer;
			user-select: none;
			background: var(--background-secondary);
			transition: background 0.15s ease;
		`,c.addEventListener("mouseenter",()=>{c.style.background="var(--background-modifier-hover)"}),c.addEventListener("mouseleave",()=>{c.style.background="var(--background-secondary)"});let u=c.createSpan();u.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: center;
			width: 16px;
			height: 16px;
			color: var(--text-muted);
			transition: transform 0.2s ease;
		`,(0,on.setIcon)(u,a?"chevron-down":"chevron-right");let d=c.createSpan();d.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: center;
			width: 18px;
			height: 18px;
			color: var(--text-muted);
		`,(0,on.setIcon)(d,n);let h=c.createSpan();h.textContent=r,h.style.cssText=`
			font-weight: 600;
			color: var(--text-normal);
			font-size: 0.95em;
		`;let f=l.createDiv("tategaki-settings-section-content");f.style.cssText=`
			padding: ${a?"4px 14px 10px":"0 14px"};
			max-height: ${a?"2000px":"0"};
			overflow: hidden;
			transition: max-height 0.3s ease, padding 0.3s ease;
		`;let p=a;return c.addEventListener("click",()=>{p=!p,(0,on.setIcon)(u,p?"chevron-down":"chevron-right"),f.style.maxHeight=p?"2000px":"0",f.style.padding=p?"4px 14px 10px":"0 14px"}),s(f),l}createSettingsUI(e){let n=this.panelContext.mode==="compat",r=!!this.panelContext.isCeImeMode,o=n||r,s=n?"\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093":"CE\u88DC\u52A9(IME)\u4E2D\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093",a=n||r,l=n?"\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093":"CE\u88DC\u52A9(IME)\u4E2D\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093",c=n,u="\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u5229\u7528\u3067\u304D\u307E\u305B\u3093",d,h,f,p,m=null,g=null;this.createCollapsibleSection(e,"sliders-horizontal","\u57FA\u672C\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u66F8\u5B57\u65B9\u5411","\u7E26\u66F8\u304D\u307E\u305F\u306F\u6A2A\u66F8\u304D\u3092\u9078\u629E",v=>{let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
						`,y.createEl("option",{text:"\u7E26\u66F8\u304D",value:"vertical-rl"}),y.createEl("option",{text:"\u6A2A\u66F8\u304D",value:"horizontal-tb"}),y.value=this.tempSettings.common.writingMode,y.addEventListener("change",()=>{this.tempSettings.common.writingMode=y.value,this.applySettings()})}),this.createSettingItem(b,"\u9078\u629E\u3092\u30CD\u30A4\u30C6\u30A3\u30D6\u306B\u3059\u308B","\u5927\u304D\u306A\u7BC4\u56F2\u9078\u629E\u30FB\u7AEF\u8D85\u3048\u30AA\u30FC\u30C8\u30B9\u30AF\u30ED\u30FC\u30EB\u6642\u306E\u307F\u30CD\u30A4\u30C6\u30A3\u30D6\u9078\u629E\u3092\u88DC\u52A9\u7684\u306B\u4F7F\u3044\u307E\u3059\uFF08\u901A\u5E38\u6642\u306FSoT\u9078\u629E\u3092\u512A\u5148\uFF09",v=>{let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=()=>this.tempSettings.wysiwyg.useNativeSelection===!0,x=S=>{y.textContent=S?"\u4F7F\u7528\u3059\u308B":"\u4F7F\u7528\u3057\u306A\u3044",y.setAttr("aria-pressed",S?"true":"false"),y.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};x(E()),y.addEventListener("click",()=>{let S=!E();this.tempSettings.wysiwyg.useNativeSelection=S,x(S),this.applySettings()})},{disabled:n,disabledReason:n?"\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093":void 0}),this.createSettingItem(b,"\u5168\u6587\u30D7\u30EC\u30FC\u30F3\u8868\u793A\uFF08SoT\uFF09","Markdown\u88C5\u98FE\u30FB\u30EB\u30D3\u306E\u8868\u793A\u3092\u884C\u308F\u305A\u3001\u8A18\u53F7\u3092\u305D\u306E\u307E\u307E\u8868\u793A\u3057\u307E\u3059\uFF08\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u306F\u7121\u52B9\uFF09",v=>{let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=()=>this.tempSettings.wysiwyg.plainTextView===!0,x=S=>{y.textContent=S?"\u6709\u52B9":"\u7121\u52B9",y.setAttr("aria-pressed",S?"true":"false"),y.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};x(E()),y.addEventListener("click",()=>{let S=!E();this.tempSettings.wysiwyg.plainTextView=S,x(S),this.applySettings()})},{disabled:n,disabledReason:n?"\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093":void 0}),this.createSettingItem(b,"\u30DA\u30FC\u30B8\u67A0\u306E\u8868\u793A","\u30DA\u30FC\u30B8\u67A0\u3092\u8868\u793A\u3059\u308B\u304B\u3001\u5168\u753B\u9762\u8868\u793A\u306B\u3059\u308B\u304B\u3092\u9078\u629E",v=>{let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=()=>{var w;return Number((w=this.tempSettings.common.pageScale)!=null?w:1)<=1},x=S=>{y.textContent=S?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A",y.setAttr("aria-pressed",S?"true":"false"),y.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};x(E()),y.addEventListener("click",()=>{let S=!E();this.tempSettings.common.pageScale=S?1:1.05,x(S),this.applySettings()})})}),this.createCollapsibleSection(e,"type","\u30D5\u30A9\u30F3\u30C8",!1,b=>{this.createSettingItem(b,"\u30D5\u30A9\u30F3\u30C8","\u30B4\u30B7\u30C3\u30AF\u4F53\u3001\u660E\u671D\u4F53\u3001\u307E\u305F\u306F\u30AB\u30B9\u30BF\u30E0\u30D5\u30A9\u30F3\u30C8\u3092\u9078\u629E\u3067\u304D\u307E\u3059",async v=>{var O,H,K;Array.isArray(this.tempSettings.customFonts)||(this.tempSettings.customFonts=[]);let y=v.createDiv();y.style.cssText=`
							display: flex;
							flex-direction: column;
							gap: 8px;
							min-width: 220px;
						`;let E=y.createEl("select");E.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 200px;
						`;let x='-apple-system, BlinkMacSystemFont, "Segoe UI", "Yu Gothic", "Hiragino Sans", "Noto Sans JP", "Noto Sans CJK JP", "Source Han Sans", Roboto, "Helvetica Neue", Arial, sans-serif',S='"Yu Mincho", "Hiragino Mincho ProN", "Noto Serif JP", "Noto Serif CJK JP", "Source Han Serif", Georgia, "Times New Roman", serif';E.createEl("option",{text:"\u30B4\u30B7\u30C3\u30AF\u4F53",value:x}),E.createEl("option",{text:"\u660E\u671D\u4F53",value:S});let w=E.createEl("optgroup");w.label="\u30AB\u30B9\u30BF\u30E0";let k=y.createDiv();k.style.cssText=`
							font-size: 0.8em;
							color: var(--text-muted);
						`,k.textContent="\u5404\u30B7\u30B9\u30C6\u30E0\u306E\u6A19\u6E96\u7684\u306A\u30D5\u30A9\u30F3\u30C8\u304C\u4F7F\u7528\u3055\u308C\u307E\u3059\u3002";let M=y.createDiv();M.style.cssText=`
							display: flex;
							flex-direction: column;
							gap: 6px;
							margin-top: 8px;
							padding-top: 8px;
							border-top: 1px solid var(--background-modifier-border);
						`;let L=M.createEl("div");L.style.cssText=`
							font-size: 0.9em;
							font-weight: 500;
							margin-bottom: 4px;
						`,L.textContent="\u30AB\u30B9\u30BF\u30E0\u30D5\u30A9\u30F3\u30C8";let _=M.createDiv();_.style.cssText=`
							display: flex;
							gap: 6px;
						`;let P=_.createEl("input");P.type="text",P.placeholder="\u30D5\u30A9\u30F3\u30C8\u540D\u3092\u5165\u529B\uFF08\u4F8B: Noto Serif JP\uFF09",P.style.cssText=`
							flex: 1;
							padding: 6px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
						`;let I=_.createEl("button");I.textContent="\u8FFD\u52A0",I.style.cssText=`
							padding: 6px 10px;
						`;let N=M.createDiv();N.style.cssText=`
							display: flex;
							flex-direction: column;
							gap: 4px;
							margin-top: 8px;
							max-height: 100px;
							overflow-y: auto;
							padding-right: 4px;
						`;let D=null,R=()=>{for(;w.firstChild;)w.removeChild(w.firstChild);for(;N.firstChild;)N.removeChild(N.firstChild);this.tempSettings.customFonts&&this.tempSettings.customFonts.length>0&&this.tempSettings.customFonts.forEach((W,te)=>{w.createEl("option",{text:W,value:W});let J=N.createDiv();J.draggable=!0,J.setAttribute("data-font-index",te.toString()),J.style.cssText=`
										display: flex;
										align-items: center;
										justify-content: space-between;
										padding: 4px 8px;
										background: var(--background-modifier-hover);
										border-radius: var(--radius-s);
										font-size: 0.9em;
										cursor: grab;
										transition: opacity 0.2s, transform 0.2s;
									`;let Q=J.createSpan();Q.textContent="\u22EE\u22EE",Q.style.cssText=`
										margin-right: 8px;
										color: var(--text-muted);
										cursor: grab;
										user-select: none;
									`;let Ae=J.createSpan();Ae.textContent=W,Ae.style.cssText=`
										flex: 1;
										font-family: ${W};
									`;let $e=J.createEl("button");$e.textContent="\u524A\u9664",$e.style.cssText=`
										padding: 2px 8px;
										font-size: 0.85em;
										background: var(--interactive-normal);
										color: var(--text-normal);
										border: 1px solid var(--background-modifier-border);
										border-radius: var(--radius-s);
										cursor: pointer;
									`,$e.addEventListener("click",()=>{let ke=this.tempSettings.customFonts.indexOf(W);ke>-1&&(this.tempSettings.customFonts.splice(ke,1),R(),this.tempSettings.common.fontFamily===W&&(E.value=x,this.tempSettings.common.fontFamily=x,this.applySettings()))}),J.addEventListener("dragstart",ke=>{D=te,J.style.opacity="0.5",J.style.cursor="grabbing",ke.dataTransfer&&(ke.dataTransfer.effectAllowed="move")}),J.addEventListener("dragend",()=>{J.style.opacity="1",J.style.cursor="grab",D=null}),J.addEventListener("dragover",ke=>{ke.preventDefault(),!(D===null||D===te)&&(ke.dataTransfer&&(ke.dataTransfer.dropEffect="move"),J.style.borderTop=D<te?"2px solid var(--interactive-accent)":"",J.style.borderBottom=D>te?"2px solid var(--interactive-accent)":"")}),J.addEventListener("dragleave",()=>{J.style.borderTop="",J.style.borderBottom=""}),J.addEventListener("drop",ke=>{if(ke.preventDefault(),J.style.borderTop="",J.style.borderBottom="",D===null||D===te)return;let ce=[...this.tempSettings.customFonts],[We]=ce.splice(D,1);ce.splice(te,0,We),this.tempSettings.customFonts=ce,R(),this.applySettings()})})},A=()=>{let W=P.value.trim();if(!W)return;if(Array.isArray(this.tempSettings.customFonts)||(this.tempSettings.customFonts=[]),this.tempSettings.customFonts.some(J=>J.toLowerCase()===W.toLowerCase())){P.value="",E.value=W,this.tempSettings.common.fontFamily=W,this.applySettings();return}this.tempSettings.customFonts.push(W),P.value="",R(),E.value=W,this.tempSettings.common.fontFamily=W,this.applySettings()};I.addEventListener("click",()=>{A()}),P.addEventListener("keydown",W=>{W.key==="Enter"&&!W.isComposing&&(W.preventDefault(),A())}),E.addEventListener("change",()=>{E.value&&(this.tempSettings.common.fontFamily=E.value,this.applySettings())}),R();let C=(H=(O=this.tempSettings.common.fontFamily)==null?void 0:O.trim())!=null?H:"";C===x||C.includes("sans-serif")||!C?E.value=x:C===S||C.includes("serif")?E.value=S:(K=this.tempSettings.customFonts)!=null&&K.includes(C)?E.value=C:E.value=x}),this.createSettingItem(b,"\u30D5\u30A9\u30F3\u30C8\u30B5\u30A4\u30BA","\u6587\u5B57\u306E\u5927\u304D\u3055\u3092\u8ABF\u6574",v=>{let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="12",E.max="32",E.step="1",E.value=this.tempSettings.common.fontSize.toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=y.createEl("span");x.textContent=`${this.tempSettings.common.fontSize}px`,x.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let S=parseInt(E.value);this.tempSettings.common.fontSize=S,x.textContent=`${S}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u884C\u9593","\u884C\u306E\u9593\u9694\u3092\u8ABF\u6574",v=>{let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`,d=y.createEl("input"),d.type="range",d.min="1.5",d.max="3.0",d.step="0.1",d.value=this.tempSettings.common.lineHeight.toFixed(1),d.style.cssText=`
							flex: 1;
							min-width: 100px;
						`,h=y.createEl("span"),h.textContent=this.tempSettings.common.lineHeight.toFixed(1),h.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,d.addEventListener("input",()=>{let E=parseFloat(d.value);this.tempSettings.common.lineHeight=E,h.textContent=E.toFixed(1),this.applySettings({debounce:!0})}),d.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u6587\u5B57\u9593","\u6587\u5B57\u306E\u9593\u9694\u3092\u8ABF\u6574\uFF080 = \u901A\u5E38\uFF09",v=>{let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="-0.1",E.max="0.5",E.step="0.01",E.value=this.tempSettings.common.letterSpacing.toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=y.createEl("span");x.textContent=this.tempSettings.common.letterSpacing.toFixed(2),x.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let S=parseFloat(E.value);this.tempSettings.common.letterSpacing=S,x.textContent=S.toFixed(2),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"gem","\u30EB\u30D3",!1,b=>{this.createSettingItem(b,"\u30EB\u30D3\u8868\u793A","\u30AA\u30D5\u306B\u3059\u308B\u3068\u30EB\u30D3\u30BF\u30B0\u3092\u751F\u6210\u305B\u305A\u3001\u9752\u7A7A\u8A18\u6CD5\uFF08\uFF5C\u672C\u6587\u300A\u3088\u307F\u300B\uFF09\u306E\u307E\u307E\u8868\u793A\u3057\u307E\u3059",v=>{let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=S=>{y.textContent=S?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A",y.setAttr("aria-pressed",S?"true":"false"),y.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`},x=()=>this.tempSettings.wysiwyg.enableRuby!==!1;E(x()),y.addEventListener("click",()=>{let S=!x();this.tempSettings.wysiwyg.enableRuby=S,E(S),this.applySettings()})}),this.createSettingItem(b,"\u30EB\u30D3\u30B5\u30A4\u30BA","\u30EB\u30D3\uFF08\u3075\u308A\u304C\u306A\uFF09\u306E\u5927\u304D\u3055\u3092\u8ABF\u6574",v=>{let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`,f=y.createEl("input"),f.type="range",f.min="0.3",f.max="1.0",f.step="0.05",f.value=this.tempSettings.common.rubySize.toFixed(2),f.style.cssText=`
							flex: 1;
							min-width: 100px;
						`,p=y.createEl("span"),p.textContent=this.tempSettings.common.rubySize.toFixed(2),p.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,f.addEventListener("input",()=>{let E=parseFloat(f.value);this.tempSettings.common.rubySize=E,p.textContent=E.toFixed(2),this.applySettings({debounce:!0})}),f.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u30EB\u30D3\u4F4D\u7F6E","\u5DE6\uFF1D\u6587\u5B57\u306B\u8FD1\u3065\u3051\u308B / \u53F3\uFF1D\u6587\u5B57\u304B\u3089\u9060\u3056\u3051\u308B\uFF08\u7E26\u306F\u52A0\u6E1B\u7B97\u3001\u6A2A\u306F\u9006\u7B26\u53F7\u3067\u52A0\u6E1B\u7B97\uFF09",v=>{var k;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
							flex-wrap: wrap;
						`;let E=y.createEl("input");E.type="range",E.min="-1.5",E.max="1.5",E.step="0.1";let x=Math.min(1.5,Math.max(-1.5,(k=this.tempSettings.common.rubyVerticalGap)!=null?k:0));E.value=x.toString(),E.style.cssText=`
							flex: 1;
							min-width: 140px;
						`,m=E;let S=y.createEl("span");S.textContent=x.toFixed(1),S.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,g=S;let w=M=>{let L=Math.min(1.5,Math.max(-1.5,M)),_=L,P=-L-1;this.tempSettings.common.rubyVerticalGap=_,this.tempSettings.common.rubyHorizontalGap=P,g&&(g.textContent=L.toFixed(1)),m&&m.value!==L.toString()&&(m.value=L.toString())};E.addEventListener("input",()=>{let M=parseFloat(E.value);w(M),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"palette","\u8272\u8A2D\u5B9A",!1,b=>{this.createColorSettingItem(b,"\u6587\u5B57\u8272",this.tempSettings.common.textColor,v=>{this.tempSettings.common.textColor=v,this.applySettings()}),this.createColorSettingItem(b,"\u30DA\u30FC\u30B8\u8272",this.tempSettings.common.backgroundColor,v=>{this.tempSettings.common.backgroundColor=v,this.applySettings()}),this.createColorSettingItem(b,"\u80CC\u666F\u8272",this.tempSettings.common.pageBackgroundColor,v=>{this.tempSettings.common.pageBackgroundColor=v,this.applySettings()})}),this.createCollapsibleSection(e,"heading","\u898B\u51FA\u3057\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u898B\u51FA\u3057\u30D5\u30A9\u30F3\u30C8","\u898B\u51FA\u3057\u5C02\u7528\u306E\u30D5\u30A9\u30F3\u30C8\u3092\u9078\u629E\uFF08\u672C\u6587\u306E\u30AB\u30B9\u30BF\u30E0\u30D5\u30A9\u30F3\u30C8\u3082\u4F7F\u7528\u53EF\u80FD\uFF09",v=>{var M,L,_;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 200px;
						`;let E='-apple-system, BlinkMacSystemFont, "Segoe UI", "Yu Gothic", "Hiragino Sans", "Noto Sans JP", "Noto Sans CJK JP", "Source Han Sans", Roboto, "Helvetica Neue", Arial, sans-serif',x='"Yu Mincho", "Hiragino Mincho ProN", "Noto Serif JP", "Noto Serif CJK JP", "Source Han Serif", Georgia, "Times New Roman", serif';y.createEl("option",{text:"\u672C\u6587\u3068\u540C\u3058",value:""}),y.createEl("option",{text:"\u30B4\u30B7\u30C3\u30AF\u4F53",value:E}),y.createEl("option",{text:"\u660E\u671D\u4F53",value:x});let S=y.createEl("optgroup");S.label="\u30AB\u30B9\u30BF\u30E0",(()=>{for(;S.firstChild;)S.removeChild(S.firstChild);this.tempSettings.customFonts&&this.tempSettings.customFonts.length>0&&this.tempSettings.customFonts.forEach(P=>{S.createEl("option",{text:P,value:P})})})();let k=(L=(M=this.tempSettings.common.headingFontFamily)==null?void 0:M.trim())!=null?L:"";k?k===E||k.includes("sans-serif")?y.value=E:k===x||k.includes("serif")?y.value=x:(_=this.tempSettings.customFonts)!=null&&_.includes(k)?y.value=k:k?(S.createEl("option",{text:k,value:k}),y.value=k):y.value="":y.value="",y.addEventListener("change",()=>{this.tempSettings.common.headingFontFamily=y.value,this.applySettings()})}),this.createColorSettingItem(b,"\u898B\u51FA\u3057\u6587\u5B57\u8272",this.tempSettings.common.headingTextColor||this.tempSettings.common.textColor,v=>{this.tempSettings.common.headingTextColor=v,this.applySettings()}),this.createSettingItem(b,"\u898B\u51FA\u3057\u6587\u5B57\u8272\u3092\u30EA\u30BB\u30C3\u30C8","\u672C\u6587\u3068\u540C\u3058\u8272\u306B\u623B\u3057\u307E\u3059",v=>{let y=v.createEl("button");y.textContent="\u30EA\u30BB\u30C3\u30C8",y.style.cssText=`
							padding: 6px 12px;
						`,y.addEventListener("click",()=>{this.tempSettings.common.headingTextColor="",this.applySettings(),this.onOpen()})})}),this.createCollapsibleSection(e,"move-horizontal","\u4F59\u767D\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u4E0A\u4F59\u767D","\u30DA\u30FC\u30B8\u4E0A\u90E8\u306E\u4F59\u767D\u3092\u8ABF\u6574\uFF080\u301C200px\uFF09",v=>{var S,w;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="0",E.max="200",E.step="2",E.value=((S=this.tempSettings.wysiwyg.sotPaddingTop)!=null?S:32).toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=y.createEl("span");x.textContent=`${(w=this.tempSettings.wysiwyg.sotPaddingTop)!=null?w:32}px`,x.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let k=parseInt(E.value);this.tempSettings.wysiwyg.sotPaddingTop=k,x.textContent=`${k}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u4E0B\u4F59\u767D","\u30DA\u30FC\u30B8\u4E0B\u90E8\u306E\u4F59\u767D\u3092\u8ABF\u6574\uFF080\u301C200px\uFF09",v=>{var S,w;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="0",E.max="200",E.step="2",E.value=((S=this.tempSettings.wysiwyg.sotPaddingBottom)!=null?S:16).toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=y.createEl("span");x.textContent=`${(w=this.tempSettings.wysiwyg.sotPaddingBottom)!=null?w:16}px`,x.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let k=parseInt(E.value);this.tempSettings.wysiwyg.sotPaddingBottom=k,x.textContent=`${k}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"text-cursor","\u30AD\u30E3\u30EC\u30C3\u30C8\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u8272","\u6587\u5B57\u8272 / \u30CF\u30A4\u30E9\u30A4\u30C8\u8272 / \u30AB\u30B9\u30BF\u30E0\u8272 \u304B\u3089\u9078\u629E\u3067\u304D\u307E\u3059",v=>{var E,x;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,y.createEl("option",{text:"\u6587\u5B57\u8272",value:"text"}),y.createEl("option",{text:"\u30CF\u30A4\u30E9\u30A4\u30C8\u8272",value:"accent"}),y.createEl("option",{text:"\u30AB\u30B9\u30BF\u30E0\u8272",value:"custom"}),y.value=(x=(E=this.tempSettings.wysiwyg.caretColorMode)!=null?E:ae.wysiwyg.caretColorMode)!=null?x:"accent",y.addEventListener("change",()=>{this.tempSettings.wysiwyg.caretColorMode=y.value,this.applySettings()})}),this.createColorSettingItem(b,"\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u30AB\u30B9\u30BF\u30E0\u8272",this.tempSettings.wysiwyg.caretCustomColor||ae.wysiwyg.caretCustomColor||"#1e90ff",v=>{this.tempSettings.wysiwyg.caretCustomColor=v,this.applySettings()}),this.createSettingItem(b,"\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u5E45","\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u592A\u3055\u3092\u8ABF\u6574\u3057\u307E\u3059\uFF08px\uFF09",v=>{var w,k;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="1",E.max="8",E.step="0.5";let x=(k=(w=this.tempSettings.wysiwyg.caretWidthPx)!=null?w:ae.wysiwyg.caretWidthPx)!=null?k:3;E.value=x.toString(),E.style.cssText=`
							flex: 1;
							min-width: 120px;
						`;let S=y.createEl("span");S.textContent=`${x}px`,S.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let M=parseFloat(E.value);this.tempSettings.wysiwyg.caretWidthPx=M,S.textContent=`${M}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})},{disabled:a,disabledReason:a?l:void 0}),this.createSettingItem(b,"CE\u88DC\u52A9\u30E2\u30FC\u30C9\u3067\u30CD\u30A4\u30C6\u30A3\u30D6\u30AD\u30E3\u30EC\u30C3\u30C8\u3092\u4F7F\u7528","CE\u88DC\u52A9(IME)\u3092\u30AA\u30F3\u306B\u3057\u305F\u3068\u304D\u3001OS\u6A19\u6E96\u306E\u30AD\u30E3\u30EC\u30C3\u30C8\u3092\u4F7F\u3046\u304B\u9078\u3079\u307E\u3059",v=>{let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=()=>this.tempSettings.wysiwyg.ceUseNativeCaret!==!1,x=S=>{y.textContent=S?"\u4F7F\u7528\u3059\u308B":"\u4F7F\u7528\u3057\u306A\u3044",y.setAttr("aria-pressed",S?"true":"false"),y.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};x(E()),y.addEventListener("click",()=>{let S=!E();this.tempSettings.wysiwyg.ceUseNativeCaret=S,x(S),this.applySettings()})},{disabled:c,disabledReason:c?u:void 0})}),this.createCollapsibleSection(e,"keyboard","IME\u8868\u793A\u306E\u88DC\u6B63",!1,b=>{this.createSettingItem(b,"\u6A2A\u66F8\u304D: \u4E0A\u65B9\u5411\u88DC\u6B63","\u6A2A\u66F8\u304DIME\u306E\u8868\u793A\u4F4D\u7F6E\u3092\u3001\u4E0A\u65B9\u5411(+) / \u4E0B\u65B9\u5411(-)\u306B\u8ABF\u6574\u3057\u307E\u3059\uFF08em\u5358\u4F4D\uFF09",v=>{var w,k;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="-1",E.max="1",E.step="0.01";let x=(k=(w=this.tempSettings.wysiwyg.imeOffsetHorizontalEm)!=null?w:ae.wysiwyg.imeOffsetHorizontalEm)!=null?k:0;E.value=x.toFixed(2),E.style.cssText=`
							flex: 1;
							min-width: 120px;
						`;let S=y.createEl("span");S.textContent=x.toFixed(2),S.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let M=parseFloat(E.value);this.tempSettings.wysiwyg.imeOffsetHorizontalEm=M,S.textContent=M.toFixed(2),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})},{disabled:o,disabledReason:o?s:void 0}),this.createSettingItem(b,"\u7E26\u66F8\u304D: \u53F3\u65B9\u5411\u88DC\u6B63","\u7E26\u66F8\u304DIME\u306E\u8868\u793A\u4F4D\u7F6E\u3092\u3001\u53F3\u65B9\u5411(+) / \u5DE6\u65B9\u5411(-)\u306B\u8ABF\u6574\u3057\u307E\u3059\uFF08em\u5358\u4F4D\uFF09",v=>{var w,k;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="-1",E.max="1",E.step="0.01";let x=(k=(w=this.tempSettings.wysiwyg.imeOffsetVerticalEm)!=null?w:ae.wysiwyg.imeOffsetVerticalEm)!=null?k:0;E.value=x.toFixed(2),E.style.cssText=`
							flex: 1;
							min-width: 120px;
						`;let S=y.createEl("span");S.textContent=x.toFixed(2),S.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let M=parseFloat(E.value);this.tempSettings.wysiwyg.imeOffsetVerticalEm=M,S.textContent=M.toFixed(2),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})},{disabled:o,disabledReason:o?s:void 0})}),this.createCollapsibleSection(e,"file-text","\u53C2\u7167\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u30D5\u30ED\u30F3\u30C8\u30DE\u30BF\u30FC\u60C5\u5831\u3092\u8868\u793A","YAML\u81EA\u4F53\u3067\u306F\u306A\u304F\u3001title/author\u306A\u3069\u306E\u5185\u5BB9\u3092\u672C\u6587\u5148\u982D\u306B\u8868\u793A\u3057\u307E\u3059",v=>{var S;let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=w=>{let k=!w;this.tempSettings.preview.hideFrontmatter=k,this.tempSettings.preview.showFrontmatterTitle=w,this.tempSettings.preview.showFrontmatterSubtitle=w,this.tempSettings.preview.showFrontmatterOriginalTitle=w,this.tempSettings.preview.showFrontmatterAuthor=w,this.tempSettings.preview.showFrontmatterCoAuthors=w,this.tempSettings.preview.showFrontmatterTranslator=w,this.tempSettings.preview.showFrontmatterCoTranslators=w,this.applySettings()},x=()=>{var k;let w=!((k=this.tempSettings.preview.hideFrontmatter)==null||k);y.textContent=w?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A",y.setAttr("aria-pressed",w?"true":"false"),y.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${w?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${w?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};E(!((S=this.tempSettings.preview.hideFrontmatter)==null||S)),x(),y.addEventListener("click",()=>{var k;let w=!((k=this.tempSettings.preview.hideFrontmatter)==null||k);E(!w),x()})})}),this.createCollapsibleSection(e,"book-open","\u66F8\u7C4D\u30E2\u30FC\u30C9",!1,b=>{this.createSettingItem(b,"\u30D8\u30C3\u30C0\u30FC\u306E\u5185\u5BB9","\u66F8\u7C4D\u30E2\u30FC\u30C9\u306E\u30D8\u30C3\u30C0\u30FC\u306B\u8868\u793A\u3059\u308B\u5185\u5BB9\u3092\u9078\u3073\u307E\u3059",v=>{var E;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,y.createEl("option",{text:"\u8868\u793A\u3057\u306A\u3044",value:"none"}),y.createEl("option",{text:"\u30BF\u30A4\u30C8\u30EB",value:"title"}),y.createEl("option",{text:"\u30DA\u30FC\u30B8\u756A\u53F7",value:"pageNumber"}),y.value=(E=this.tempSettings.preview.headerContent)!=null?E:"none",y.addEventListener("change",()=>{this.tempSettings.preview.headerContent=y.value,this.applySettings()})}),this.createSettingItem(b,"\u30D8\u30C3\u30C0\u30FC\u306E\u914D\u7F6E","\u30D8\u30C3\u30C0\u30FC\u306E\u8868\u793A\u4F4D\u7F6E\uFF08\u5DE6/\u4E2D\u592E/\u53F3\uFF09\u3092\u9078\u3073\u307E\u3059",v=>{var E;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,y.createEl("option",{text:"\u5DE6",value:"left"}),y.createEl("option",{text:"\u4E2D\u592E",value:"center"}),y.createEl("option",{text:"\u53F3",value:"right"}),y.value=(E=this.tempSettings.preview.headerAlign)!=null?E:"center",y.addEventListener("change",()=>{this.tempSettings.preview.headerAlign=y.value,this.applySettings()})}),this.createSettingItem(b,"\u30D5\u30C3\u30BF\u30FC\u306E\u5185\u5BB9","\u66F8\u7C4D\u30E2\u30FC\u30C9\u306E\u30D5\u30C3\u30BF\u30FC\u306B\u8868\u793A\u3059\u308B\u5185\u5BB9\u3092\u9078\u3073\u307E\u3059",v=>{var E;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,y.createEl("option",{text:"\u8868\u793A\u3057\u306A\u3044",value:"none"}),y.createEl("option",{text:"\u30BF\u30A4\u30C8\u30EB",value:"title"}),y.createEl("option",{text:"\u30DA\u30FC\u30B8\u756A\u53F7",value:"pageNumber"}),y.value=(E=this.tempSettings.preview.footerContent)!=null?E:"pageNumber",y.addEventListener("change",()=>{this.tempSettings.preview.footerContent=y.value,this.applySettings()})}),this.createSettingItem(b,"\u30D5\u30C3\u30BF\u30FC\u306E\u914D\u7F6E","\u30D5\u30C3\u30BF\u30FC\u306E\u8868\u793A\u4F4D\u7F6E\uFF08\u5DE6/\u4E2D\u592E/\u53F3\uFF09\u3092\u9078\u3073\u307E\u3059",v=>{var E;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,y.createEl("option",{text:"\u5DE6",value:"left"}),y.createEl("option",{text:"\u4E2D\u592E",value:"center"}),y.createEl("option",{text:"\u53F3",value:"right"}),y.value=(E=this.tempSettings.preview.footerAlign)!=null?E:"center",y.addEventListener("change",()=>{this.tempSettings.preview.footerAlign=y.value,this.applySettings()})}),this.createSettingItem(b,"\u30DA\u30FC\u30B8\u756A\u53F7\u306E\u5F62\u5F0F","\u73FE\u5728\u30DA\u30FC\u30B8\u306E\u307F / \u73FE\u5728\u30DA\u30FC\u30B8\u3068\u7DCF\u30DA\u30FC\u30B8\u6570 \u3092\u9078\u3079\u307E\u3059",v=>{var E;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 200px;
						`,y.createEl("option",{text:"\u73FE\u5728\u30DA\u30FC\u30B8",value:"current"}),y.createEl("option",{text:"\u73FE\u5728\u30DA\u30FC\u30B8/\u7DCF\u30DA\u30FC\u30B8\u6570",value:"currentTotal"}),y.value=(E=this.tempSettings.preview.pageNumberFormat)!=null?E:"currentTotal",y.addEventListener("change",()=>{this.tempSettings.preview.pageNumberFormat=y.value,this.applySettings()})}),this.createSettingItem(b,"\u30DA\u30FC\u30B8\u9077\u79FB\u52B9\u679C","\u30DA\u30FC\u30B8\u79FB\u52D5\u6642\u306E\u8996\u899A\u52B9\u679C\u3092\u9078\u3073\u307E\u3059",v=>{var E;let y=v.createEl("select");y.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,y.createEl("option",{text:"\u306A\u3057",value:"none"}),y.createEl("option",{text:"\u30D5\u30A7\u30FC\u30C9",value:"fade"}),y.createEl("option",{text:"\u30B9\u30E9\u30A4\u30C9",value:"slide"}),y.createEl("option",{text:"\u307C\u304B\u3057",value:"blur"}),y.value=(E=this.tempSettings.preview.pageTransitionEffect)!=null?E:"fade",y.addEventListener("change",()=>{this.tempSettings.preview.pageTransitionEffect=y.value,this.applySettings()})}),this.createSettingItem(b,"\u4E0A\u4F59\u767D","\u66F8\u7C4D\u30E2\u30FC\u30C9\u672C\u6587\u30A8\u30EA\u30A2\u306E\u4E0A\u4F59\u767D\u3092\u8ABF\u6574\uFF080\u301C200px\uFF09",v=>{var S,w,k,M;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="0",E.max="200",E.step="2",E.value=((w=(S=this.tempSettings.preview.bookPaddingTop)!=null?S:ae.preview.bookPaddingTop)!=null?w:44).toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=y.createEl("span");x.textContent=`${(M=(k=this.tempSettings.preview.bookPaddingTop)!=null?k:ae.preview.bookPaddingTop)!=null?M:44}px`,x.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let L=parseInt(E.value,10);this.tempSettings.preview.bookPaddingTop=L,x.textContent=`${L}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u4E0B\u4F59\u767D","\u66F8\u7C4D\u30E2\u30FC\u30C9\u672C\u6587\u30A8\u30EA\u30A2\u306E\u4E0B\u4F59\u767D\u3092\u8ABF\u6574\uFF080\u301C200px\uFF09",v=>{var S,w,k,M;let y=v.createDiv();y.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=y.createEl("input");E.type="range",E.min="0",E.max="200",E.step="2",E.value=((w=(S=this.tempSettings.preview.bookPaddingBottom)!=null?S:ae.preview.bookPaddingBottom)!=null?w:32).toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=y.createEl("span");x.textContent=`${(M=(k=this.tempSettings.preview.bookPaddingBottom)!=null?k:ae.preview.bookPaddingBottom)!=null?M:32}px`,x.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let L=parseInt(E.value,10);this.tempSettings.preview.bookPaddingBottom=L,x.textContent=`${L}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"paintbrush","\u30C6\u30FC\u30DE",!1,b=>{this.createThemeSelector(b)}),n&&this.createCollapsibleSection(e,"archive","\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\uFF08\u4E92\u63DB\u30E2\u30FC\u30C9\uFF09",!1,b=>{this.createSettingItem(b,"\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210","\u4E92\u63DB\u30E2\u30FC\u30C9\u306E\u540C\u671F\u6642\u306B\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002OFF\u306B\u3059\u308B\u3068\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u4F5C\u6210\u3055\u308C\u307E\u305B\u3093\uFF08\u4E8B\u6545\u6642\u306FObsidian\u306E\u300COpen version history\u300D\u3092\u5229\u7528\u3057\u3066\u304F\u3060\u3055\u3044\uFF09\u3002",v=>{let y=v.createEl("button",{cls:"tategaki-toggle-button"}),E=S=>{y.textContent=S?"\u6709\u52B9":"\u7121\u52B9",y.setAttr("aria-pressed",S?"true":"false"),y.style.cssText=`
									min-width: 96px;
									padding: 6px 12px;
									border-radius: 6px;
									border: 1px solid var(--background-modifier-border);
									background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
									color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
									cursor: pointer;
									transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
								`},x=()=>!!this.tempSettings.wysiwyg.enableSyncBackup;E(x()),y.addEventListener("click",()=>{this.tempSettings.wysiwyg.enableSyncBackup=!x(),this.applySettings(),E(x())})}),this.createSettingItem(b,"\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u304F","\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u4FDD\u5B58\u5148\uFF08.obsidian/tategaki-sync-backups\uFF09\u3092\u958B\u304D\u307E\u3059\u3002",v=>{let y=v.createEl("button");y.textContent="\u958B\u304F",y.style.cssText=`
								padding: 6px 12px;
							`,y.addEventListener("click",()=>{this.plugin.openSyncBackupFolder()})}),this.createSettingItem(b,"\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5","\u540C\u671F\u306E\u5B89\u5168\u7B56\u3068\u3057\u3066\u4F5C\u6210\u3055\u308C\u305F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3059\uFF08\u5FA9\u5143\u3067\u304D\u306A\u304F\u306A\u308B\u306E\u3067\u6CE8\u610F\uFF09\u3002",v=>{let y=v.createEl("button");y.textContent="\u79FB\u52D5",y.style.cssText=`
								padding: 6px 12px;
								color: var(--text-on-accent);
								background: var(--text-accent);
								border: 1px solid var(--text-accent);
								border-radius: 6px;
							`,y.addEventListener("click",()=>{this.plugin.moveSyncBackupsToTrash()})})})}createSettingItem(e,n,r,o,s){let a=e.createDiv("setting-item");a.style.cssText=`
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px 0;
			border-bottom: 1px solid var(--background-modifier-border);
		`;let l=(s==null?void 0:s.disabled)===!0;l&&(a.style.opacity="0.6");let c=a.createDiv("setting-item-info");c.style.cssText=`
			flex: 1;
			margin-right: 20px;
		`,c.createDiv({text:n,attr:{style:"font-weight: 500; color: var(--text-normal); margin-bottom: 4px;"}}),c.createDiv({text:r,attr:{style:"font-size: 0.9em; color: var(--text-muted);"}}),s!=null&&s.disabledReason&&c.createDiv({text:s.disabledReason,attr:{style:"font-size: 0.85em; color: var(--text-accent); margin-top: 4px; padding: 2px 6px; border-radius: 6px; background: var(--background-secondary); display: inline-block;"}});let u=a.createDiv("setting-item-control"),d=o(u);d instanceof Promise?d.then(()=>{l&&this.disableControls(u)}).catch(h=>console.error("Error building control:",h)):l&&this.disableControls(u)}disableControls(e){e.style.pointerEvents="none",e.style.opacity="0.65",e.querySelectorAll("input, select, textarea, button").forEach(r=>{r.disabled=!0})}createColorSettingItem(e,n,r,o){this.createSettingItem(e,n,"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u8272\u3092\u5909\u66F4",s=>{let a=s.createEl("button");a.style.cssText=`
					width: 60px;
					height: 30px;
					border: 1px solid var(--background-modifier-border);
					border-radius: var(--radius-s);
					cursor: pointer;
					background: ${r};
				`,a.addEventListener("click",()=>{$S(`${n}\u3092\u9078\u629E`,r,l=>{a.style.background=l,o(l)})})})}createThemeSelector(e){let n=e.createDiv();n.style.cssText=`
			padding: 12px 0;
		`;let r=n.createDiv();r.style.cssText=`
			display: flex;
			gap: 8px;
			margin-bottom: 10px;
		`;let o=r.createEl("select");o.style.cssText=`
			flex: 1;
			padding: 8px 12px;
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			background: var(--background-primary);
			color: var(--text-normal);
		`,o.createEl("option",{text:"Obsidian \u30D9\u30FC\u30B9\u30C6\u30FC\u30DE",value:"obsidian-base"});let s=this.tempSettings.themes||[];s.forEach(h=>{o.createEl("option",{text:h.name,value:h.id})}),o.value=this.tempSettings.activeTheme||"obsidian-base";let a=r.createEl("button");a.textContent="\u518D\u9069\u7528",a.style.cssText=`
			padding: 8px 16px;
		`;let l=r.createEl("button");l.textContent="\u524A\u9664",l.className="mod-warning",l.style.cssText=`
			padding: 8px 16px;
		`;let c=h=>h==="obsidian-base"||Yo.includes(h);l.disabled=c(o.value);let u=async h=>{await this.plugin.loadTheme(h),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen()};a.addEventListener("click",async()=>{await u(o.value)}),o.addEventListener("change",async()=>{let h=o.value;l.disabled=c(h),await u(h)}),l.addEventListener("click",async()=>{let h=o.value;if(c(h))return;let f=s.find(m=>m.id===h);if(!f)return;confirm(`\u30C6\u30FC\u30DE\u300C${f.name}\u300D\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F`)&&(await this.plugin.deleteTheme(h),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen())});let d=n.createEl("button");d.textContent="\u73FE\u5728\u306E\u8A2D\u5B9A\u3092\u30C6\u30FC\u30DE\u3068\u3057\u3066\u4FDD\u5B58",d.className="mod-cta",d.style.cssText=`
			width: 100%;
			padding: 8px 12px;
		`,d.addEventListener("click",async()=>{try{new gc(this.app,async f=>{try{await this.plugin.updateSettings(this.tempSettings),await this.plugin.createThemeFromCurrentSettings(f),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen()}catch(p){console.error("Tategaki: Failed to save theme:",p)}}).open()}catch(h){console.error("Tategaki: Failed to open theme name modal:",h)}})}applySettings(e){if(e!=null&&e.debounce){this.applySettingsTimer!==null&&window.clearTimeout(this.applySettingsTimer),this.applySettingsTimer=window.setTimeout(()=>{this.applySettingsTimer=null,this.applySettings()},bc.APPLY_DEBOUNCE_MS);return}this.applySettingsTimer!==null&&(window.clearTimeout(this.applySettingsTimer),this.applySettingsTimer=null);let n=JSON.stringify(this.tempSettings);if(n===this.lastAppliedSettingsSnapshot)return;let r=this.lastAppliedSettingsSnapshot;this.lastAppliedSettingsSnapshot=n;let o=JSON.parse(n);try{let s=this.onSettingsChange(o);s instanceof Promise&&s.catch(a=>{this.lastAppliedSettingsSnapshot=r,console.error("Tategaki SettingsPanel: failed to apply settings",a)})}catch(s){this.lastAppliedSettingsSnapshot=r,console.error("Tategaki SettingsPanel: failed to apply settings",s)}}async saveAsTheme(e){await this.plugin.updateSettings(this.tempSettings),await this.plugin.createThemeFromCurrentSettings(e,"\u30E6\u30FC\u30B6\u30FC\u4F5C\u6210\u30C6\u30FC\u30DE"),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen()}onClose(){this.applySettingsTimer!==null&&(window.clearTimeout(this.applySettingsTimer),this.applySettingsTimer=null);let{contentEl:e}=this;e.empty()}},Tn=bc;Tn.APPLY_DEBOUNCE_MS=120;var gs=class{constructor(t){this.activeDragHandlers=null;this.options=t,this.containerEl=t.parent.createDiv("tategaki-auxiliary-input"),this.textareaEl=this.containerEl.createEl("textarea",{cls:"tategaki-auxiliary-textarea",attr:{placeholder:"\u5165\u529B\u3057\u3066 Enter \u3067\u633F\u5165\u3001Shift+Enter \u3067\u6539\u884C...",rows:"3"}}),this.textareaEl.addEventListener("focus",()=>{var n,r;(r=(n=this.options).onFocus)==null||r.call(n),window.setTimeout(()=>{this.textareaEl.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},200)}),this.textareaEl.addEventListener("blur",()=>{var n,r;(r=(n=this.options).onBlur)==null||r.call(n)}),this.buttonsEl=this.containerEl.createDiv("tategaki-auxiliary-buttons"),this.buttonsEl.createEl("button",{text:"\u633F\u5165",cls:"mod-cta"}).addEventListener("click",()=>this.handleInsert()),this.textareaEl.addEventListener("keydown",n=>{var r,o,s,a,l,c;if(n.key==="Enter"&&!n.shiftKey){if(n.isComposing)return;n.preventDefault(),this.handleInsert();return}if(this.textareaEl.value.length===0&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(n.key)){n.preventDefault(),n.stopPropagation(),(o=(r=this.options).onNavigate)==null||o.call(r,n);return}if(n.key==="Backspace"&&(n.metaKey||n.ctrlKey)&&this.textareaEl.value.length===0){n.preventDefault(),(a=(s=this.options).onBackspaceEmpty)==null||a.call(s);return}if(n.key==="Backspace"&&this.textareaEl.value.length===0){n.preventDefault(),(c=(l=this.options).onBackspace)==null||c.call(l);return}}),this.resizeHandleVertical=this.containerEl.createDiv("tategaki-auxiliary-resize-bar vertical"),this.resizeHandleHorizontal=this.containerEl.createDiv("tategaki-auxiliary-resize-bar horizontal"),this.attachResizeHandlers(),this.updateLayout(t.isVertical)}attachResizeHandlers(){let t=(e,n)=>{e.preventDefault(),e.stopPropagation(),this.clearDragHandlers();let r=e.clientX,o=e.clientY,s=this.containerEl.offsetWidth,a=this.containerEl.offsetHeight,l=u=>{var d,h;if(n==="vertical"){let f=u.clientX-r,p=Math.max(80,s+f);this.containerEl.style.width=`${p}px`}else{let f=o-u.clientY,p=Math.max(60,a+f);this.containerEl.style.height=`${p}px`}(h=(d=this.options).onResize)==null||h.call(d)},c=()=>{this.clearDragHandlers()};this.activeDragHandlers={onMove:l,onUp:c},document.addEventListener("pointermove",l),document.addEventListener("pointerup",c)};this.resizeHandleVertical.addEventListener("pointerdown",e=>t(e,"vertical")),this.resizeHandleHorizontal.addEventListener("pointerdown",e=>t(e,"horizontal"))}handleInsert(){let t=this.textareaEl.value,e=t.length>0?t:`
`;this.options.onInsert(e),this.textareaEl.value=""}updateLayout(t){this.containerEl.removeClass("is-vertical","is-horizontal"),this.containerEl.addClass(t?"is-vertical":"is-horizontal"),this.containerEl.style.width="",this.containerEl.style.height="",this.resizeHandleVertical.toggleClass("visible",t),this.resizeHandleHorizontal.toggleClass("visible",!t)}show(){this.containerEl.style.display="flex"}hide(){this.containerEl.style.display="none"}destroy(){this.clearDragHandlers(),this.containerEl.remove()}clearDragHandlers(){this.activeDragHandlers&&(document.removeEventListener("pointermove",this.activeDragHandlers.onMove),document.removeEventListener("pointerup",this.activeDragHandlers.onUp),this.activeDragHandlers=null)}};var bs=(i,t)=>i.selection.empty?!1:(t&&t(i.tr.deleteSelection().scrollIntoView()),!0);function lf(i,t){let{$cursor:e}=i.selection;return!e||(t?!t.endOfTextblock("backward",i):e.parentOffset>0)?null:e}var vc=(i,t,e)=>{let n=lf(i,e);if(!n)return!1;let r=xc(n);if(!r){let s=n.blockRange(),a=s&&wn(s);return a==null?!1:(t&&t(i.tr.lift(s,a).scrollIntoView()),!0)}let o=r.nodeBefore;if(bf(i,r,t,-1))return!0;if(n.parent.content.size==0&&(nr(o,"end")||Y.isSelectable(o)))for(let s=n.depth;;s--){let a=qr(i.doc,n.before(s),n.after(s),q.empty);if(a&&a.slice.size<a.to-a.from){if(t){let l=i.tr.step(a);l.setSelection(nr(o,"end")?re.findFrom(l.doc.resolve(l.mapping.map(r.pos,-1)),-1):Y.create(l.doc,r.pos-o.nodeSize)),t(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return o.isAtom&&r.depth==n.depth-1?(t&&t(i.tr.delete(r.pos-o.nodeSize,r.pos).scrollIntoView()),!0):!1},cf=(i,t,e)=>{let n=lf(i,e);if(!n)return!1;let r=xc(n);return r?df(i,r,t):!1},uf=(i,t,e)=>{let n=hf(i,e);if(!n)return!1;let r=wc(n);return r?df(i,r,t):!1};function df(i,t,e){let n=t.nodeBefore,r=n,o=t.pos-1;for(;!r.isTextblock;o--){if(r.type.spec.isolating)return!1;let u=r.lastChild;if(!u)return!1;r=u}let s=t.nodeAfter,a=s,l=t.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=qr(i.doc,o,l,q.empty);if(!c||c.from!=o||c instanceof De&&c.slice.size>=l-o)return!1;if(e){let u=i.tr.step(c);u.setSelection(G.create(u.doc,o)),e(u.scrollIntoView())}return!0}function nr(i,t,e=!1){for(let n=i;n;n=t=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(e&&n.childCount!=1)return!1}return!1}var Ec=(i,t,e)=>{let{$head:n,empty:r}=i.selection,o=n;if(!r)return!1;if(n.parent.isTextblock){if(e?!e.endOfTextblock("backward",i):n.parentOffset>0)return!1;o=xc(n)}let s=o&&o.nodeBefore;return!s||!Y.isSelectable(s)?!1:(t&&t(i.tr.setSelection(Y.create(i.doc,o.pos-s.nodeSize)).scrollIntoView()),!0)};function xc(i){if(!i.parent.type.spec.isolating)for(let t=i.depth-1;t>=0;t--){if(i.index(t)>0)return i.doc.resolve(i.before(t+1));if(i.node(t).type.spec.isolating)break}return null}function hf(i,t){let{$cursor:e}=i.selection;return!e||(t?!t.endOfTextblock("forward",i):e.parentOffset<e.parent.content.size)?null:e}var Sc=(i,t,e)=>{let n=hf(i,e);if(!n)return!1;let r=wc(n);if(!r)return!1;let o=r.nodeAfter;if(bf(i,r,t,1))return!0;if(n.parent.content.size==0&&(nr(o,"start")||Y.isSelectable(o))){let s=qr(i.doc,n.before(),n.after(),q.empty);if(s&&s.slice.size<s.to-s.from){if(t){let a=i.tr.step(s);a.setSelection(nr(o,"start")?re.findFrom(a.doc.resolve(a.mapping.map(r.pos)),1):Y.create(a.doc,a.mapping.map(r.pos))),t(a.scrollIntoView())}return!0}}return o.isAtom&&r.depth==n.depth-1?(t&&t(i.tr.delete(r.pos,r.pos+o.nodeSize).scrollIntoView()),!0):!1},kc=(i,t,e)=>{let{$head:n,empty:r}=i.selection,o=n;if(!r)return!1;if(n.parent.isTextblock){if(e?!e.endOfTextblock("forward",i):n.parentOffset<n.parent.content.size)return!1;o=wc(n)}let s=o&&o.nodeAfter;return!s||!Y.isSelectable(s)?!1:(t&&t(i.tr.setSelection(Y.create(i.doc,o.pos)).scrollIntoView()),!0)};function wc(i){if(!i.parent.type.spec.isolating)for(let t=i.depth-1;t>=0;t--){let e=i.node(t);if(i.index(t)+1<e.childCount)return i.doc.resolve(i.after(t+1));if(e.type.spec.isolating)break}return null}var pf=(i,t)=>{let e=i.selection,n=e instanceof Y,r;if(n){if(e.node.isTextblock||!Ot(i.doc,e.from))return!1;r=e.from}else if(r=vi(i.doc,e.from,-1),r==null)return!1;if(t){let o=i.tr.join(r);n&&o.setSelection(Y.create(o.doc,r-i.doc.resolve(r).nodeBefore.nodeSize)),t(o.scrollIntoView())}return!0},ff=(i,t)=>{let e=i.selection,n;if(e instanceof Y){if(e.node.isTextblock||!Ot(i.doc,e.to))return!1;n=e.to}else if(n=vi(i.doc,e.to,1),n==null)return!1;return t&&t(i.tr.join(n).scrollIntoView()),!0},mf=(i,t)=>{let{$from:e,$to:n}=i.selection,r=e.blockRange(n),o=r&&wn(r);return o==null?!1:(t&&t(i.tr.lift(r,o).scrollIntoView()),!0)},Mc=(i,t)=>{let{$head:e,$anchor:n}=i.selection;return!e.parent.type.spec.code||!e.sameParent(n)?!1:(t&&t(i.tr.insertText(`
`).scrollIntoView()),!0)};function Tc(i){for(let t=0;t<i.edgeCount;t++){let{type:e}=i.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}var Cc=(i,t)=>{let{$head:e,$anchor:n}=i.selection;if(!e.parent.type.spec.code||!e.sameParent(n))return!1;let r=e.node(-1),o=e.indexAfter(-1),s=Tc(r.contentMatchAt(o));if(!s||!r.canReplaceWith(o,o,s))return!1;if(t){let a=e.after(),l=i.tr.replaceWith(a,a,s.createAndFill());l.setSelection(re.near(l.doc.resolve(a),1)),t(l.scrollIntoView())}return!0},Lc=(i,t)=>{let e=i.selection,{$from:n,$to:r}=e;if(e instanceof qe||n.parent.inlineContent||r.parent.inlineContent)return!1;let o=Tc(r.parent.contentMatchAt(r.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let s=(!n.parentOffset&&r.index()<r.parent.childCount?n:r).pos,a=i.tr.insert(s,o.createAndFill());a.setSelection(G.create(a.doc,s+1)),t(a.scrollIntoView())}return!0},Rc=(i,t)=>{let{$cursor:e}=i.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let o=e.before();if(At(i.doc,o))return t&&t(i.tr.split(o).scrollIntoView()),!0}let n=e.blockRange(),r=n&&wn(n);return r==null?!1:(t&&t(i.tr.lift(n,r).scrollIntoView()),!0)};function WS(i){return(t,e)=>{let{$from:n,$to:r}=t.selection;if(t.selection instanceof Y&&t.selection.node.isBlock)return!n.parentOffset||!At(t.doc,n.pos)?!1:(e&&e(t.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let o=[],s,a,l=!1,c=!1;for(let f=n.depth;;f--)if(n.node(f).isBlock){l=n.end(f)==n.pos+(n.depth-f),c=n.start(f)==n.pos-(n.depth-f),a=Tc(n.node(f-1).contentMatchAt(n.indexAfter(f-1)));let m=i&&i(r.parent,l,n);o.unshift(m||(l&&a?{type:a}:null)),s=f;break}else{if(f==1)return!1;o.unshift(null)}let u=t.tr;(t.selection instanceof G||t.selection instanceof qe)&&u.deleteSelection();let d=u.mapping.map(n.pos),h=At(u.doc,d,o.length,o);if(h||(o[0]=a?{type:a}:null,h=At(u.doc,d,o.length,o)),!h)return!1;if(u.split(d,o.length,o),!l&&c&&n.node(s).type!=a){let f=u.mapping.map(n.before(s)),p=u.doc.resolve(f);a&&n.node(s-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(n.before(s)),a)}return e&&e(u.scrollIntoView()),!0}}var US=WS();var gf=(i,t)=>{let{$from:e,to:n}=i.selection,r,o=e.sharedDepth(n);return o==0?!1:(r=e.before(o),t&&t(i.tr.setSelection(Y.create(i.doc,r))),!0)},KS=(i,t)=>(t&&t(i.tr.setSelection(new qe(i.doc))),!0);function qS(i,t,e){let n=t.nodeBefore,r=t.nodeAfter,o=t.index();return!n||!r||!n.type.compatibleContent(r.type)?!1:!n.content.size&&t.parent.canReplace(o-1,o)?(e&&e(i.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(o,o+1)||!(r.isTextblock||Ot(i.doc,t.pos))?!1:(e&&e(i.tr.join(t.pos).scrollIntoView()),!0)}function bf(i,t,e,n){let r=t.nodeBefore,o=t.nodeAfter,s,a,l=r.type.spec.isolating||o.type.spec.isolating;if(!l&&qS(i,t,e))return!0;let c=!l&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(s=(a=r.contentMatchAt(r.childCount)).findWrapping(o.type))&&a.matchType(s[0]||o.type).validEnd){if(e){let f=t.pos+o.nodeSize,p=z.empty;for(let b=s.length-1;b>=0;b--)p=z.from(s[b].create(null,p));p=z.from(r.copy(p));let m=i.tr.step(new _e(t.pos-1,f,t.pos,f,new q(p,1,0),s.length,!0)),g=m.doc.resolve(f+2*s.length);g.nodeAfter&&g.nodeAfter.type==r.type&&Ot(m.doc,g.pos)&&m.join(g.pos),e(m.scrollIntoView())}return!0}let u=o.type.spec.isolating||n>0&&l?null:re.findFrom(t,1),d=u&&u.$from.blockRange(u.$to),h=d&&wn(d);if(h!=null&&h>=t.depth)return e&&e(i.tr.lift(d,h).scrollIntoView()),!0;if(c&&nr(o,"start",!0)&&nr(r,"end")){let f=r,p=[];for(;p.push(f),!f.isTextblock;)f=f.lastChild;let m=o,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(f.canReplace(f.childCount,f.childCount,m.content)){if(e){let b=z.empty;for(let y=p.length-1;y>=0;y--)b=z.from(p[y].copy(b));let v=i.tr.step(new _e(t.pos-p.length,t.pos+o.nodeSize,t.pos+g,t.pos+o.nodeSize-g,new q(b,p.length,0),0,!0));e(v.scrollIntoView())}return!0}}return!1}function yf(i){return function(t,e){let n=t.selection,r=i<0?n.$from:n.$to,o=r.depth;for(;r.node(o).isInline;){if(!o)return!1;o--}return r.node(o).isTextblock?(e&&e(t.tr.setSelection(G.create(t.doc,i<0?r.start(o):r.end(o)))),!0):!1}}var Ac=yf(-1),Ic=yf(1);function vf(i,t=null){return function(e,n){let{$from:r,$to:o}=e.selection,s=r.blockRange(o),a=s&&Yi(s,i,t);return a?(n&&n(e.tr.wrap(s,a).scrollIntoView()),!0):!1}}function Nc(i,t=null){return function(e,n){let r=!1;for(let o=0;o<e.selection.ranges.length&&!r;o++){let{$from:{pos:s},$to:{pos:a}}=e.selection.ranges[o];e.doc.nodesBetween(s,a,(l,c)=>{if(r)return!1;if(!(!l.isTextblock||l.hasMarkup(i,t)))if(l.type==i)r=!0;else{let u=e.doc.resolve(c),d=u.index();r=u.parent.canReplaceWith(d,d+1,i)}})}if(!r)return!1;if(n){let o=e.tr;for(let s=0;s<e.selection.ranges.length;s++){let{$from:{pos:a},$to:{pos:l}}=e.selection.ranges[s];o.setBlockType(a,l,i,t)}n(o.scrollIntoView())}return!0}}function Pc(...i){return function(t,e,n){for(let r=0;r<i.length;r++)if(i[r](t,e,n))return!0;return!1}}var yc=Pc(bs,vc,Ec),af=Pc(bs,Sc,kc),Gn={Enter:Pc(Mc,Lc,Rc,US),"Mod-Enter":Cc,Backspace:yc,"Mod-Backspace":yc,"Shift-Backspace":yc,Delete:af,"Mod-Delete":af,"Mod-a":KS},GS={"Ctrl-h":Gn.Backspace,"Alt-Backspace":Gn["Mod-Backspace"],"Ctrl-d":Gn.Delete,"Ctrl-Alt-Backspace":Gn["Mod-Delete"],"Alt-Delete":Gn["Mod-Delete"],"Alt-d":Gn["Mod-Delete"],"Ctrl-a":Ac,"Ctrl-e":Ic};for(let i in Gn)GS[i]=Gn[i];var v_=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform?os.platform()=="darwin":!1;function Ef(i,t=null){return function(e,n){let{$from:r,$to:o}=e.selection,s=r.blockRange(o);if(!s)return!1;let a=n?e.tr:null;return jS(a,s,i,t)?(n&&n(a.scrollIntoView()),!0):!1}}function jS(i,t,e,n=null){let r=!1,o=t,s=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let l=s.resolve(t.start-2);o=new gi(l,l,t.depth),t.endIndex<t.parent.childCount&&(t=new gi(t.$from,s.resolve(t.$to.end(t.depth)),t.depth)),r=!0}let a=Yi(o,e,n,t);return a?(i&&YS(i,t,a,r,e),!0):!1}function YS(i,t,e,n,r){let o=z.empty;for(let u=e.length-1;u>=0;u--)o=z.from(e[u].type.create(e[u].attrs,o));i.step(new _e(t.start-(n?2:0),t.end,t.start,t.end,new q(o,0,0),e.length,!0));let s=0;for(let u=0;u<e.length;u++)e[u].type==r&&(s=u+1);let a=e.length-s,l=t.start+e.length-(n?2:0),c=t.parent;for(let u=t.startIndex,d=t.endIndex,h=!0;u<d;u++,h=!1)!h&&At(i.doc,l,a)&&(i.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return i}function xf(i){return function(t,e){let{$from:n,$to:r}=t.selection,o=n.blockRange(r,s=>s.childCount>0&&s.firstChild.type==i);return o?e?n.node(o.depth-1).type==i?XS(t,e,i,o):JS(t,e,o):!0:!1}}function XS(i,t,e,n){let r=i.tr,o=n.end,s=n.$to.end(n.depth);o<s&&(r.step(new _e(o-1,s,o,s,new q(z.from(e.create(null,n.parent.copy())),1,0),1,!0)),n=new gi(r.doc.resolve(n.$from.pos),r.doc.resolve(s),n.depth));let a=wn(n);if(a==null)return!1;r.lift(n,a);let l=r.doc.resolve(r.mapping.map(o,-1)-1);return Ot(r.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&r.join(l.pos),t(r.scrollIntoView()),!0}function JS(i,t,e){let n=i.tr,r=e.parent;for(let f=e.end,p=e.endIndex-1,m=e.startIndex;p>m;p--)f-=r.child(p).nodeSize,n.delete(f-1,f+1);let o=n.doc.resolve(e.start),s=o.nodeAfter;if(n.mapping.map(e.end)!=e.start+o.nodeAfter.nodeSize)return!1;let a=e.startIndex==0,l=e.endIndex==r.childCount,c=o.node(-1),u=o.index(-1);if(!c.canReplace(u+(a?0:1),u+1,s.content.append(l?z.empty:z.from(r))))return!1;let d=o.pos,h=d+s.nodeSize;return n.step(new _e(d-(a?1:0),h+(l?1:0),d+1,h-1,new q((a?z.empty:z.from(r.copy(z.empty))).append(l?z.empty:z.from(r.copy(z.empty))),a?0:1,l?0:1),a?0:1)),t(n.scrollIntoView()),!0}function Sf(i){return function(t,e){let{$from:n,$to:r}=t.selection,o=n.blockRange(r,c=>c.childCount>0&&c.firstChild.type==i);if(!o)return!1;let s=o.startIndex;if(s==0)return!1;let a=o.parent,l=a.child(s-1);if(l.type!=i)return!1;if(e){let c=l.lastChild&&l.lastChild.type==a.type,u=z.from(c?i.create():null),d=new q(z.from(i.create(null,z.from(a.type.create(null,u)))),c?3:1,0),h=o.start,f=o.end;e(t.tr.step(new _e(h-(c?3:1),f,h,f,d,1,!0)).scrollIntoView())}return!0}}var it=function(i){for(var t=0;;t++)if(i=i.previousSibling,!i)return t},ar=function(i){let t=i.assignedSlot||i.parentNode;return t&&t.nodeType==11?t.host:t},Hc=null,Ln=function(i,t,e){let n=Hc||(Hc=document.createRange());return n.setEnd(i,e==null?i.nodeValue.length:e),n.setStart(i,t||0),n},ZS=function(){Hc=null},Ci=function(i,t,e,n){return e&&(kf(i,t,e,n,-1)||kf(i,t,e,n,1))},QS=/^(img|br|input|textarea|hr)$/i;function kf(i,t,e,n,r){for(var o;;){if(i==e&&t==n)return!0;if(t==(r<0?0:Bt(i))){let s=i.parentNode;if(!s||s.nodeType!=1||ro(i)||QS.test(i.nodeName)||i.contentEditable=="false")return!1;t=it(i)+(r<0?0:1),i=s}else if(i.nodeType==1){let s=i.childNodes[t+(r<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((o=s.pmViewDesc)===null||o===void 0)&&o.ignoreForSelection)t+=r;else return!1;else i=s,t=r<0?Bt(i):0}else return!1}}function Bt(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function ek(i,t){for(;;){if(i.nodeType==3&&t)return i;if(i.nodeType==1&&t>0){if(i.contentEditable=="false")return null;i=i.childNodes[t-1],t=Bt(i)}else if(i.parentNode&&!ro(i))t=it(i),i=i.parentNode;else return null}}function tk(i,t){for(;;){if(i.nodeType==3&&t<i.nodeValue.length)return i;if(i.nodeType==1&&t<i.childNodes.length){if(i.contentEditable=="false")return null;i=i.childNodes[t],t=0}else if(i.parentNode&&!ro(i))t=it(i)+1,i=i.parentNode;else return null}}function nk(i,t,e){for(let n=t==0,r=t==Bt(i);n||r;){if(i==e)return!0;let o=it(i);if(i=i.parentNode,!i)return!1;n=n&&o==0,r=r&&o==Bt(i)}}function ro(i){let t;for(let e=i;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==i||t.contentDOM==i)}var Ms=function(i){return i.focusNode&&Ci(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)};function Si(i,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=i,e.key=e.code=t,e}function ik(i){let t=i.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function rk(i,t,e){if(i.caretPositionFromPoint)try{let n=i.caretPositionFromPoint(t,e);if(n)return{node:n.offsetNode,offset:Math.min(Bt(n.offsetNode),n.offset)}}catch(n){}if(i.caretRangeFromPoint){let n=i.caretRangeFromPoint(t,e);if(n)return{node:n.startContainer,offset:Math.min(Bt(n.startContainer),n.startOffset)}}}var cn=typeof navigator!="undefined"?navigator:null,wf=typeof document!="undefined"?document:null,Zn=cn&&cn.userAgent||"",zc=/Edge\/(\d+)/.exec(Zn),nm=/MSIE \d/.exec(Zn),Vc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Zn),xt=!!(nm||Vc||zc),Jn=nm?document.documentMode:Vc?+Vc[1]:zc?+zc[1]:0,Ft=!xt&&/gecko\/(\d+)/i.test(Zn);Ft&&+(/Firefox\/(\d+)/.exec(Zn)||[0,0])[1];var $c=!xt&&/Chrome\/(\d+)/.exec(Zn),ut=!!$c,im=$c?+$c[1]:0,mt=!xt&&!!cn&&/Apple Computer/.test(cn.vendor),lr=mt&&(/Mobile\/\w+/.test(Zn)||!!cn&&cn.maxTouchPoints>2),Dt=lr||(cn?/Mac/.test(cn.platform):!1),ok=cn?/Win/.test(cn.platform):!1,Rn=/Android \d/.test(Zn),oo=!!wf&&"webkitFontSmoothing"in wf.documentElement.style,sk=oo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ak(i){let t=i.defaultView&&i.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:i.documentElement.clientWidth,top:0,bottom:i.documentElement.clientHeight}}function Cn(i,t){return typeof i=="number"?i:i[t]}function lk(i){let t=i.getBoundingClientRect(),e=t.width/i.offsetWidth||1,n=t.height/i.offsetHeight||1;return{left:t.left,right:t.left+i.clientWidth*e,top:t.top,bottom:t.top+i.clientHeight*n}}function Mf(i,t,e){let n=i.someProp("scrollThreshold")||0,r=i.someProp("scrollMargin")||5,o=i.dom.ownerDocument;for(let s=e||i.dom;s;){if(s.nodeType!=1){s=ar(s);continue}let a=s,l=a==o.body,c=l?ak(o):lk(a),u=0,d=0;if(t.top<c.top+Cn(n,"top")?d=-(c.top-t.top+Cn(r,"top")):t.bottom>c.bottom-Cn(n,"bottom")&&(d=t.bottom-t.top>c.bottom-c.top?t.top+Cn(r,"top")-c.top:t.bottom-c.bottom+Cn(r,"bottom")),t.left<c.left+Cn(n,"left")?u=-(c.left-t.left+Cn(r,"left")):t.right>c.right-Cn(n,"right")&&(u=t.right-c.right+Cn(r,"right")),u||d)if(l)o.defaultView.scrollBy(u,d);else{let f=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-f,g=a.scrollTop-p;t={left:t.left-m,top:t.top-g,right:t.right-m,bottom:t.bottom-g}}let h=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(h))break;s=h=="absolute"?s.offsetParent:ar(s)}}function ck(i){let t=i.dom.getBoundingClientRect(),e=Math.max(0,t.top),n,r;for(let o=(t.left+t.right)/2,s=e+1;s<Math.min(innerHeight,t.bottom);s+=5){let a=i.root.elementFromPoint(o,s);if(!a||a==i.dom||!i.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=e-20){n=a,r=l.top;break}}return{refDOM:n,refTop:r,stack:rm(i.dom)}}function rm(i){let t=[],e=i.ownerDocument;for(let n=i;n&&(t.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),i!=e);n=ar(n));return t}function uk({refDOM:i,refTop:t,stack:e}){let n=i?i.getBoundingClientRect().top:0;om(e,n==0?0:n-t)}function om(i,t){for(let e=0;e<i.length;e++){let{dom:n,top:r,left:o}=i[e];n.scrollTop!=r+t&&(n.scrollTop=r+t),n.scrollLeft!=o&&(n.scrollLeft=o)}}var ir=null;function dk(i){if(i.setActive)return i.setActive();if(ir)return i.focus(ir);let t=rm(i);i.focus(ir==null?{get preventScroll(){return ir={preventScroll:!0},!0}}:void 0),ir||(ir=!1,om(t,0))}function sm(i,t){let e,n=2e8,r,o=0,s=t.top,a=t.top,l,c;for(let u=i.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=Ln(u).getClientRects();else continue;for(let f=0;f<h.length;f++){let p=h[f];if(p.top<=s&&p.bottom>=a){s=Math.max(p.bottom,s),a=Math.min(p.top,a);let m=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(m<n){e=u,n=m,r=m&&e.nodeType==3?{left:p.right<t.left?p.right:p.left,top:t.top}:t,u.nodeType==1&&m&&(o=d+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!l&&p.left<=t.left&&p.right>=t.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!e&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(o=d+1)}}return!e&&l&&(e=l,r=c,n=0),e&&e.nodeType==3?hk(e,r):!e||n&&e.nodeType==1?{node:i,offset:o}:sm(e,r)}function hk(i,t){let e=i.nodeValue.length,n=document.createRange();for(let r=0;r<e;r++){n.setEnd(i,r+1),n.setStart(i,r);let o=jn(n,1);if(o.top!=o.bottom&&nu(t,o))return{node:i,offset:r+(t.left>=(o.left+o.right)/2?1:0)}}return{node:i,offset:0}}function nu(i,t){return i.left>=t.left-1&&i.left<=t.right+1&&i.top>=t.top-1&&i.top<=t.bottom+1}function pk(i,t){let e=i.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<i.getBoundingClientRect().left?e:i}function fk(i,t,e){let{node:n,offset:r}=sm(t,e),o=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();o=s.left!=s.right&&e.left>(s.left+s.right)/2?1:-1}return i.docView.posFromDOM(n,r,o)}function mk(i,t,e,n){let r=-1;for(let o=t,s=!1;o!=i.dom;){let a=i.docView.nearestDesc(o,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!s&&l.left>n.left||l.top>n.top?r=a.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(r=a.posAfter),s=!0),!a.contentDOM&&r<0&&!a.node.isText))return(a.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;o=a.dom.parentNode}return r>-1?r:i.docView.posFromDOM(t,e,-1)}function am(i,t,e){let n=i.childNodes.length;if(n&&e.top<e.bottom)for(let r=Math.max(0,Math.min(n-1,Math.floor(n*(t.top-e.top)/(e.bottom-e.top))-2)),o=r;;){let s=i.childNodes[o];if(s.nodeType==1){let a=s.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(nu(t,c))return am(s,t,c)}}if((o=(o+1)%n)==r)break}return i}function gk(i,t){let e=i.dom.ownerDocument,n,r=0,o=rk(e,t.left,t.top);o&&({node:n,offset:r}=o);let s=(i.root.elementFromPoint?i.root:e).elementFromPoint(t.left,t.top),a;if(!s||!i.dom.contains(s.nodeType!=1?s.parentNode:s)){let c=i.dom.getBoundingClientRect();if(!nu(t,c)||(s=am(i.dom,t,c),!s))return null}if(mt)for(let c=s;n&&c;c=ar(c))c.draggable&&(n=void 0);if(s=pk(s,t),n){if(Ft&&n.nodeType==1&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let u=n.childNodes[r],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=t.left&&d.bottom>t.top&&r++}let c;oo&&r&&n.nodeType==1&&(c=n.childNodes[r-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=t.top&&r--,n==i.dom&&r==n.childNodes.length-1&&n.lastChild.nodeType==1&&t.top>n.lastChild.getBoundingClientRect().bottom?a=i.state.doc.content.size:(r==0||n.nodeType!=1||n.childNodes[r-1].nodeName!="BR")&&(a=mk(i,n,r,t))}a==null&&(a=fk(i,s,t));let l=i.docView.nearestDesc(s,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function Tf(i){return i.top<i.bottom||i.left<i.right}function jn(i,t){let e=i.getClientRects();if(e.length){let n=e[t<0?0:e.length-1];if(Tf(n))return n}return Array.prototype.find.call(e,Tf)||i.getBoundingClientRect()}var bk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function lm(i,t,e){let{node:n,offset:r,atom:o}=i.docView.domFromPos(t,e<0?-1:1),s=oo||Ft;if(n.nodeType==3)if(s&&(bk.test(n.nodeValue)||(e<0?!r:r==n.nodeValue.length))){let l=jn(Ln(n,r,r),e);if(Ft&&r&&/\s/.test(n.nodeValue[r-1])&&r<n.nodeValue.length){let c=jn(Ln(n,r-1,r-1),-1);if(c.top==l.top){let u=jn(Ln(n,r,r+1),-1);if(u.top!=l.top)return Xr(u,u.left<c.left)}}return l}else{let l=r,c=r,u=e<0?1:-1;return e<0&&!r?(c++,u=-1):e>=0&&r==n.nodeValue.length?(l--,u=1):e<0?l--:c++,Xr(jn(Ln(n,l,c),u),u<0)}if(!i.state.doc.resolve(t-(o||0)).parent.inlineContent){if(o==null&&r&&(e<0||r==Bt(n))){let l=n.childNodes[r-1];if(l.nodeType==1)return _c(l.getBoundingClientRect(),!1)}if(o==null&&r<Bt(n)){let l=n.childNodes[r];if(l.nodeType==1)return _c(l.getBoundingClientRect(),!0)}return _c(n.getBoundingClientRect(),e>=0)}if(o==null&&r&&(e<0||r==Bt(n))){let l=n.childNodes[r-1],c=l.nodeType==3?Ln(l,Bt(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Xr(jn(c,1),!1)}if(o==null&&r<Bt(n)){let l=n.childNodes[r];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Ln(l,0,s?0:1):l.nodeType==1?l:null:null;if(c)return Xr(jn(c,-1),!0)}return Xr(jn(n.nodeType==3?Ln(n):n,-e),e>=0)}function Xr(i,t){if(i.width==0)return i;let e=t?i.left:i.right;return{top:i.top,bottom:i.bottom,left:e,right:e}}function _c(i,t){if(i.height==0)return i;let e=t?i.top:i.bottom;return{top:e,bottom:e,left:i.left,right:i.right}}function cm(i,t,e){let n=i.state,r=i.root.activeElement;n!=t&&i.updateState(t),r!=i.dom&&i.focus();try{return e()}finally{n!=t&&i.updateState(n),r!=i.dom&&r&&r.focus()}}function yk(i,t,e){let n=t.selection,r=e=="up"?n.$from:n.$to;return cm(i,t,()=>{let{node:o}=i.docView.domFromPos(r.pos,e=="up"?-1:1);for(;;){let a=i.docView.nearestDesc(o,!0);if(!a)break;if(a.node.isBlock){o=a.contentDOM||a.dom;break}o=a.dom.parentNode}let s=lm(i,r.pos,1);for(let a=o.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Ln(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(e=="up"?s.top-u.top>(u.bottom-s.top)*2:u.bottom-s.bottom>(s.bottom-u.top)*2))return!1}}return!0})}var vk=/[\u0590-\u08ac]/;function Ek(i,t,e){let{$head:n}=t.selection;if(!n.parent.isTextblock)return!1;let r=n.parentOffset,o=!r,s=r==n.parent.content.size,a=i.domSelection();return a?!vk.test(n.parent.textContent)||!a.modify?e=="left"||e=="backward"?o:s:cm(i,t,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=i.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",e,"character");let f=n.depth?i.docView.domAfterPos(n.before()):i.dom,{focusNode:p,focusOffset:m}=i.domSelectionRange(),g=p&&!f.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch(b){}return h!=null&&(a.caretBidiLevel=h),g}):n.pos==n.start()||n.pos==n.end()}var Cf=null,Lf=null,Rf=!1;function xk(i,t,e){return Cf==t&&Lf==e?Rf:(Cf=t,Lf=e,Rf=e=="up"||e=="down"?yk(i,t,e):Ek(i,t,e))}var Ht=0,Af=1,ki=2,un=3,Li=class{constructor(t,e,n,r){this.parent=t,this.children=e,this.dom=n,this.contentDOM=r,this.dirty=Ht,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let r=this.children[e];if(r==t)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(n<0){let o,s;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(s)+s.size:this.posAtStart}else{let o,s;if(t==this.contentDOM)o=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.nextSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(s):this.posAtEnd}let r;if(t==this.dom&&this.contentDOM)r=e>it(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(e==0)for(let o=t;;o=o.parentNode){if(o==this.dom){r=!1;break}if(o.previousSibling)break}if(r==null&&e==t.childNodes.length)for(let o=t;;o=o.parentNode){if(o==this.dom){r=!0;break}if(o.nextSibling)break}}return(r==null?n>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,r=t;r;r=r.parentNode){let o=this.getDesc(r),s;if(o&&(!e||o.node))if(n&&(s=o.nodeDOM)&&!(s.nodeType==1?s.contains(t.nodeType==1?t:t.parentNode):s==t))n=!1;else return o}}getDesc(t){let e=t.pmViewDesc;for(let n=e;n;n=n.parent)if(n==this)return e}posFromDOM(t,e,n){for(let r=t;r;r=r.parentNode){let o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let r=this.children[e],o=n+r.size;if(n==t&&o!=n){for(;!r.border&&r.children.length;)for(let s=0;s<r.children.length;s++){let a=r.children[s];if(a.size){r=a;break}}return r}if(t<o)return r.descAt(t-n-r.border);n=o}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,r=0;for(let o=0;n<this.children.length;n++){let s=this.children[n],a=o+s.size;if(a>t||s instanceof vs){r=t-o;break}o=a}if(r)return this.children[n].domFromPos(r-this.children[n].border,e);for(let o;n&&!(o=this.children[n-1]).size&&o instanceof ys&&o.side>=0;n--);if(e<=0){let o,s=!0;for(;o=n?this.children[n-1]:null,!(!o||o.dom.parentNode==this.contentDOM);n--,s=!1);return o&&e&&s&&!o.border&&!o.domAtom?o.domFromPos(o.size,e):{node:this.contentDOM,offset:o?it(o.dom)+1:0}}else{let o,s=!0;for(;o=n<this.children.length?this.children[n]:null,!(!o||o.dom.parentNode==this.contentDOM);n++,s=!1);return o&&s&&!o.border&&!o.domAtom?o.domFromPos(0,e):{node:this.contentDOM,offset:o?it(o.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,o=-1;for(let s=n,a=0;;a++){let l=this.children[a],c=s+l.size;if(r==-1&&t<=c){let u=s+l.border;if(t>=u&&e<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(t,e,u);t=s;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){r=it(h.dom)+1;break}t-=h.size}r==-1&&(r=0)}if(r>-1&&(c>e||a==this.children.length-1)){e=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){o=it(d.dom);break}e+=d.size}o==-1&&(o=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return e.size==0||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(e.nodeType!=1||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,r=!1){let o=Math.min(t,e),s=Math.max(t,e);for(let f=0,p=0;f<this.children.length;f++){let m=this.children[f],g=p+m.size;if(o>p&&s<g)return m.setSelection(t-p-m.border,e-p-m.border,n,r);p=g}let a=this.domFromPos(t,t?-1:1),l=e==t?a:this.domFromPos(e,e?-1:1),c=n.root.getSelection(),u=n.domSelectionRange(),d=!1;if((Ft||mt)&&t==e){let{node:f,offset:p}=a;if(f.nodeType==3){if(d=!!(p&&f.nodeValue[p-1]==`
`),d&&p==f.nodeValue.length)for(let m=f,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:it(g)+1});break}let b=m.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{let m=f.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(Ft&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(r=!0)}if(!(r||d&&mt)&&Ci(a.node,a.offset,u.anchorNode,u.anchorOffset)&&Ci(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||t==e)&&!(d&&Ft)){c.collapse(a.node,a.offset);try{t!=e&&c.extend(l.node,l.offset),h=!0}catch(f){}}if(!h){if(t>e){let p=a;a=l,l=p}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,r=0;r<this.children.length;r++){let o=this.children[r],s=n+o.size;if(n==s?t<=s&&e>=n:t<s&&e>n){let a=n+o.border,l=s-o.border;if(t>=a&&e<=l){this.dirty=t==n||e==s?ki:Af,t==a&&e==l&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=un:o.markDirty(t-a,e-a);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?ki:un}n=s}this.dirty=ki}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=t==1?ki:Af;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}},ys=class extends Li{constructor(t,e,n,r){let o,s=e.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!o)return r;if(o.parent)return o.parent.posBeforeChild(o)})),!e.type.spec.raw){if(s.nodeType!=1){let a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(t,[],s,null),this.widget=e,this.widget=e,o=this}matchesWidget(t){return this.dirty==Ht&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return e?e(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}},Wc=class extends Li{constructor(t,e,n,r){super(t,[],e,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}},In=class extends Li{constructor(t,e,n,r,o){super(t,[],n,r),this.mark=e,this.spec=o}static create(t,e,n,r){let o=r.nodeViews[e.type.name],s=o&&o(e,r,n);return(!s||!s.dom)&&(s=Rt.renderSpec(document,e.type.spec.toDOM(e,n),null,e.attrs)),new In(t,e,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&un||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=un&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=Ht){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Ht}}slice(t,e,n){let r=In.create(this.parent,this.mark,!0,n),o=this.children,s=this.size;e<s&&(o=Gc(o,e,s,n)),t>0&&(o=Gc(o,0,t,n));for(let a=0;a<o.length;a++)o[a].parent=r;return r.children=o,r}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}},an=class extends Li{constructor(t,e,n,r,o,s,a,l,c){super(t,[],o,s),this.node=e,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=a}static create(t,e,n,r,o,s){let a=o.nodeViews[e.type.name],l,c=a&&a(e,o,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,r),u=c&&c.dom,d=c&&c.contentDOM;if(e.isText){if(!u)u=document.createTextNode(e.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=Rt.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs));!d&&!e.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),e.type.spec.draggable&&(u.draggable=!0));let h=u;return u=hm(u,n,e),c?l=new Uc(t,e,n,r,u,d||null,h,c,o,s+1):e.isText?new cr(t,e,n,r,u,h,o):new an(t,e,n,r,u,d||null,h,o,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>z.empty)}return t}matchesNode(t,e,n){return this.dirty==Ht&&t.eq(this.node)&&Es(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,r=e,o=t.composing?this.localCompositionInfo(t,e):null,s=o&&o.pos>-1?o:null,a=o&&o.pos<0,l=new qc(this,s&&s.node,t);Mk(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,n,t):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?ve.none:this.node.child(u).marks,n,t),l.placeWidget(c,t,r)},(c,u,d,h)=>{l.syncToMarks(c.marks,n,t);let f;l.findNodeMatch(c,u,d,h)||a&&t.state.selection.from>r&&t.state.selection.to<r+c.nodeSize&&(f=l.findIndexWithChild(o.node))>-1&&l.updateNodeAt(c,u,d,f,t)||l.updateNextNode(c,u,d,t,h,r)||l.addNode(c,u,d,t,r),r+=c.nodeSize}),l.syncToMarks([],n,t),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ki)&&(s&&this.protectLocalComposition(t,s),um(this.contentDOM,this.children,t),lr&&Tk(this.dom))}localCompositionInfo(t,e){let{from:n,to:r}=t.state.selection;if(!(t.state.selection instanceof G)||n<e||r>e+this.node.content.size)return null;let o=t.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let s=o.nodeValue,a=Ck(this.node.content,s,n-e,r-e);return a<0?null:{node:o,pos:a,text:s}}else return{node:o,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:r}){if(this.getDesc(e))return;let o=e;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let s=new Wc(this,o,e,r);t.input.compositionNodes.push(s),this.children=Gc(this.children,n,n+r.length,t,s)}update(t,e,n,r){return this.dirty==un||!t.sameMarkup(this.node)?!1:(this.updateInner(t,e,n,r),!0)}updateInner(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=Ht}updateOuterDeco(t){if(Es(t,this.outerDeco))return;let e=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=dm(this.dom,this.nodeDOM,Kc(this.outerDeco,this.node,e),Kc(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}};function If(i,t,e,n,r){hm(n,t,i);let o=new an(void 0,i,t,e,n,n,n,r,0);return o.contentDOM&&o.updateChildren(r,0),o}var cr=class extends an{constructor(t,e,n,r,o,s,a){super(t,e,n,r,o,null,s,a,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,n,r){return this.dirty==un||this.dirty!=Ht&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(e),(this.dirty!=Ht||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=Ht,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,e,n){let r=this.node.cut(t,e),o=document.createTextNode(r.text);return new cr(this.parent,r,this.outerDeco,this.innerDeco,o,o,n)}markDirty(t,e){super.markDirty(t,e),this.dom!=this.nodeDOM&&(t==0||e==this.nodeDOM.nodeValue.length)&&(this.dirty=un)}get domAtom(){return!1}isText(t){return this.node.text==t}},vs=class extends Li{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==Ht&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}},Uc=class extends an{constructor(t,e,n,r,o,s,a,l,c,u){super(t,e,n,r,o,s,a,c,u),this.spec=l}update(t,e,n,r){if(this.dirty==un)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let o=this.spec.update(t,e,n);return o&&this.updateInner(t,e,n,r),o}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,e,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,r){this.spec.setSelection?this.spec.setSelection(t,e,n.root):super.setSelection(t,e,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}};function um(i,t,e){let n=i.firstChild,r=!1;for(let o=0;o<t.length;o++){let s=t[o],a=s.dom;if(a.parentNode==i){for(;a!=n;)n=Nf(n),r=!0;n=n.nextSibling}else r=!0,i.insertBefore(a,n);if(s instanceof In){let l=n?n.previousSibling:i.lastChild;um(s.contentDOM,s.children,e),n=l?l.nextSibling:i.firstChild}}for(;n;)n=Nf(n),r=!0;r&&e.trackWrites==i&&(e.trackWrites=null)}var Jr=function(i){i&&(this.nodeName=i)};Jr.prototype=Object.create(null);var wi=[new Jr];function Kc(i,t,e){if(i.length==0)return wi;let n=e?wi[0]:new Jr,r=[n];for(let o=0;o<i.length;o++){let s=i[o].type.attrs;if(s){s.nodeName&&r.push(n=new Jr(s.nodeName));for(let a in s){let l=s[a];l!=null&&(e&&r.length==1&&r.push(n=new Jr(t.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return r}function dm(i,t,e,n){if(e==wi&&n==wi)return t;let r=t;for(let o=0;o<n.length;o++){let s=n[o],a=e[o];if(o){let l;a&&a.nodeName==s.nodeName&&r!=i&&(l=r.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(r),a=wi[0]),r=l}Sk(r,a||wi[0],s)}return r}function Sk(i,t,e){for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&!(n in e)&&i.removeAttribute(n);for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&e[n]!=t[n]&&i.setAttribute(n,e[n]);if(t.class!=e.class){let n=t.class?t.class.split(" ").filter(Boolean):[],r=e.class?e.class.split(" ").filter(Boolean):[];for(let o=0;o<n.length;o++)r.indexOf(n[o])==-1&&i.classList.remove(n[o]);for(let o=0;o<r.length;o++)n.indexOf(r[o])==-1&&i.classList.add(r[o]);i.classList.length==0&&i.removeAttribute("class")}if(t.style!=e.style){if(t.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=n.exec(t.style);)i.style.removeProperty(r[1])}e.style&&(i.style.cssText+=e.style)}}function hm(i,t,e){return dm(i,i,wi,Kc(t,e,i.nodeType!=1))}function Es(i,t){if(i.length!=t.length)return!1;for(let e=0;e<i.length;e++)if(!i[e].type.eq(t[e].type))return!1;return!0}function Nf(i){let t=i.nextSibling;return i.parentNode.removeChild(i),t}var qc=class{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=kk(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let r=0,o=this.stack.length>>1,s=Math.min(o,t.length);for(;r<s&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&t[r].type.spec.spanning!==!1;)r++;for(;r<o;)this.destroyRest(),this.top.dirty=Ht,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(t[o])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=In.create(this.top,t[o],e,n);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,o++}}findNodeMatch(t,e,n,r){let o=-1,s;if(r>=this.preMatch.index&&(s=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&s.matchesNode(t,e,n))o=this.top.children.indexOf(s,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(t,e,n)&&!this.preMatch.matched.has(c)){o=a;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(t,e,n,r,o){let s=this.top.children[r];return s.dirty==un&&s.dom==s.contentDOM&&(s.dirty=ki),s.update(t,e,n,o)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let n=t.pmViewDesc;if(n){for(let r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==n)return r}return-1}t=e}}updateNextNode(t,e,n,r,o,s){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof an){let c=this.preMatch.matched.get(l);if(c!=null&&c!=o)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(t.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==t.text&&l.dirty!=un&&Es(e,l.outerDeco));if(!h&&l.update(t,e,n,r))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,t,e,n,r,s)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=ki,d.updateChildren(r,s+1),d.dirty=Ht),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,n,r,o,s){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!Es(n,t.outerDeco)||!r.eq(t.innerDeco))return null;let a=an.create(this.top,e,n,r,o,s);if(a.contentDOM){a.children=t.children,t.children=[];for(let l of a.children)l.parent=a}return t.destroy(),a}addNode(t,e,n,r,o){let s=an.create(this.top,t,e,n,r,o);s.contentDOM&&s.updateChildren(r,o+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(t,e,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(t)&&(t==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let o=new ys(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof In;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof cr)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((mt||ut)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);t=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),t=="BR"&&(n.className="ProseMirror-trailingBreak");let r=new vs(this.top,[],n,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}};function kk(i,t){let e=t,n=e.children.length,r=i.childCount,o=new Map,s=[];e:for(;r>0;){let a;for(;;)if(n){let c=e.children[n-1];if(c instanceof In)e=c,n=c.children.length;else{a=c,n--;break}}else{if(e==t)break e;n=e.parent.children.indexOf(e),e=e.parent}let l=a.node;if(l){if(l!=i.child(r-1))break;--r,o.set(a,r),s.push(a)}}return{index:r,matched:o,matches:s.reverse()}}function wk(i,t){return i.type.side-t.type.side}function Mk(i,t,e,n){let r=t.locals(i),o=0;if(r.length==0){for(let c=0;c<i.childCount;c++){let u=i.child(c);n(u,r,t.forChild(o,u),c),o+=u.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){let u,d;for(;s<r.length&&r[s].to==o;){let g=r[s++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(wk);for(let g=0;g<d.length;g++)e(d[g],c,!!l)}else e(u,c,!!l);let h,f;if(l)f=-1,h=l,l=null;else if(c<i.childCount)f=c,h=i.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=o&&a.splice(g--,1);for(;s<r.length&&r[s].from<=o&&r[s].to>o;)a.push(r[s++]);let p=o+h.nodeSize;if(h.isText){let g=p;s<r.length&&r[s].from<g&&(g=r[s].from);for(let b=0;b<a.length;b++)a[b].to<g&&(g=a[b].to);g<p&&(l=h.cut(g-o),h=h.cut(0,g-o),p=g,f=-1)}else for(;s<r.length&&r[s].to<p;)s++;let m=h.isInline&&!h.isLeaf?a.filter(g=>!g.inline):a.slice();n(h,m,t.forChild(o,h),f),o=p}}function Tk(i){if(i.nodeName=="UL"||i.nodeName=="OL"){let t=i.style.cssText;i.style.cssText=t+"; list-style: square !important",window.getComputedStyle(i).listStyle,i.style.cssText=t}}function Ck(i,t,e,n){for(let r=0,o=0;r<i.childCount&&o<=n;){let s=i.child(r++),a=o;if(o+=s.nodeSize,!s.isText)continue;let l=s.text;for(;r<i.childCount;){let c=i.child(r++);if(o+=c.nodeSize,!c.isText)break;l+=c.text}if(o>=e){if(o>=n&&l.slice(n-t.length-a,n-a)==t)return n-t.length;let c=a<n?l.lastIndexOf(t,n-a-1):-1;if(c>=0&&c+t.length+a>=e)return a+c;if(e==n&&l.length>=n+t.length-a&&l.slice(n-a,n-a+t.length)==t)return n}}return-1}function Gc(i,t,e,n,r){let o=[];for(let s=0,a=0;s<i.length;s++){let l=i[s],c=a,u=a+=l.size;c>=e||u<=t?o.push(l):(c<t&&o.push(l.slice(0,t-c,n)),r&&(o.push(r),r=void 0),u>e&&o.push(l.slice(e-c,l.size,n)))}return o}function iu(i,t=null){let e=i.domSelectionRange(),n=i.state.doc;if(!e.focusNode)return null;let r=i.docView.nearestDesc(e.focusNode),o=r&&r.size==0,s=i.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(s<0)return null;let a=n.resolve(s),l,c;if(Ms(e)){for(l=s;r&&!r.node;)r=r.parent;let d=r.node;if(r&&d.isAtom&&Y.isSelectable(d)&&r.parent&&!(d.isInline&&nk(e.focusNode,e.focusOffset,r.dom))){let h=r.posBefore;c=new Y(s==h?a:n.resolve(h))}}else{if(e instanceof i.dom.ownerDocument.defaultView.Selection&&e.rangeCount>1){let d=s,h=s;for(let f=0;f<e.rangeCount;f++){let p=e.getRangeAt(f);d=Math.min(d,i.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,i.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,s]=h==i.state.selection.anchor?[h,d]:[d,h],a=n.resolve(s)}else l=i.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(l<0)return null}let u=n.resolve(l);if(!c){let d=t=="pointer"||i.state.selection.head<a.pos&&!o?1:-1;c=ru(i,u,a,d)}return c}function pm(i){return i.editable?i.hasFocus():mm(i)&&document.activeElement&&document.activeElement.contains(i.dom)}function An(i,t=!1){let e=i.state.selection;if(fm(i,e),!!pm(i)){if(!t&&i.input.mouseDown&&i.input.mouseDown.allowDefault&&ut){let n=i.domSelectionRange(),r=i.domObserver.currentSelection;if(n.anchorNode&&r.anchorNode&&Ci(n.anchorNode,n.anchorOffset,r.anchorNode,r.anchorOffset)){i.input.mouseDown.delayedSelectionSync=!0,i.domObserver.setCurSelection();return}}if(i.domObserver.disconnectSelection(),i.cursorWrapper)Rk(i);else{let{anchor:n,head:r}=e,o,s;Pf&&!(e instanceof G)&&(e.$from.parent.inlineContent||(o=_f(i,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(s=_f(i,e.to))),i.docView.setSelection(n,r,i,t),Pf&&(o&&Of(o),s&&Of(s)),e.visible?i.dom.classList.remove("ProseMirror-hideselection"):(i.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Lk(i))}i.domObserver.setCurSelection(),i.domObserver.connectSelection()}}var Pf=mt||ut&&im<63;function _f(i,t){let{node:e,offset:n}=i.docView.domFromPos(t,0),r=n<e.childNodes.length?e.childNodes[n]:null,o=n?e.childNodes[n-1]:null;if(mt&&r&&r.contentEditable=="false")return Oc(r);if((!r||r.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(r)return Oc(r);if(o)return Oc(o)}}function Oc(i){return i.contentEditable="true",mt&&i.draggable&&(i.draggable=!1,i.wasDraggable=!0),i}function Of(i){i.contentEditable="false",i.wasDraggable&&(i.draggable=!0,i.wasDraggable=null)}function Lk(i){let t=i.dom.ownerDocument;t.removeEventListener("selectionchange",i.input.hideSelectionGuard);let e=i.domSelectionRange(),n=e.anchorNode,r=e.anchorOffset;t.addEventListener("selectionchange",i.input.hideSelectionGuard=()=>{(e.anchorNode!=n||e.anchorOffset!=r)&&(t.removeEventListener("selectionchange",i.input.hideSelectionGuard),setTimeout(()=>{(!pm(i)||i.state.selection.visible)&&i.dom.classList.remove("ProseMirror-hideselection")},20))})}function Rk(i){let t=i.domSelection();if(!t)return;let e=i.cursorWrapper.dom,n=e.nodeName=="IMG";n?t.collapse(e.parentNode,it(e)+1):t.collapse(e,0),!n&&!i.state.selection.visible&&xt&&Jn<=11&&(e.disabled=!0,e.disabled=!1)}function fm(i,t){if(t instanceof Y){let e=i.docView.descAt(t.from);e!=i.lastSelectedViewDesc&&(Df(i),e&&e.selectNode(),i.lastSelectedViewDesc=e)}else Df(i)}function Df(i){i.lastSelectedViewDesc&&(i.lastSelectedViewDesc.parent&&i.lastSelectedViewDesc.deselectNode(),i.lastSelectedViewDesc=void 0)}function ru(i,t,e,n){return i.someProp("createSelectionBetween",r=>r(i,t,e))||G.between(t,e,n)}function Bf(i){return i.editable&&!i.hasFocus()?!1:mm(i)}function mm(i){let t=i.domSelectionRange();if(!t.anchorNode)return!1;try{return i.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(i.editable||i.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function Ak(i){let t=i.docView.domFromPos(i.state.selection.anchor,0),e=i.domSelectionRange();return Ci(t.node,t.offset,e.anchorNode,e.anchorOffset)}function jc(i,t){let{$anchor:e,$head:n}=i.selection,r=t>0?e.max(n):e.min(n),o=r.parent.inlineContent?r.depth?i.doc.resolve(t>0?r.after():r.before()):null:r;return o&&re.findFrom(o,t)}function Yn(i,t){return i.dispatch(i.state.tr.setSelection(t).scrollIntoView()),!0}function Ff(i,t,e){let n=i.state.selection;if(n instanceof G)if(e.indexOf("s")>-1){let{$head:r}=n,o=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let s=i.state.doc.resolve(r.pos+o.nodeSize*(t<0?-1:1));return Yn(i,new G(n.$anchor,s))}else if(n.empty){if(i.endOfTextblock(t>0?"forward":"backward")){let r=jc(i.state,t);return r&&r instanceof Y?Yn(i,r):!1}else if(!(Dt&&e.indexOf("m")>-1)){let r=n.$head,o=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter,s;if(!o||o.isText)return!1;let a=t<0?r.pos-o.nodeSize:r.pos;return o.isAtom||(s=i.docView.descAt(a))&&!s.contentDOM?Y.isSelectable(o)?Yn(i,new Y(t<0?i.state.doc.resolve(r.pos-o.nodeSize):r)):oo?Yn(i,new G(i.state.doc.resolve(t<0?a:a+o.nodeSize))):!1:!1}}else return!1;else{if(n instanceof Y&&n.node.isInline)return Yn(i,new G(t>0?n.$to:n.$from));{let r=jc(i.state,t);return r?Yn(i,r):!1}}}function xs(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Zr(i,t){let e=i.pmViewDesc;return e&&e.size==0&&(t<0||i.nextSibling||i.nodeName!="BR")}function rr(i,t){return t<0?Ik(i):Nk(i)}function Ik(i){let t=i.domSelectionRange(),e=t.focusNode,n=t.focusOffset;if(!e)return;let r,o,s=!1;for(Ft&&e.nodeType==1&&n<xs(e)&&Zr(e.childNodes[n],-1)&&(s=!0);;)if(n>0){if(e.nodeType!=1)break;{let a=e.childNodes[n-1];if(Zr(a,-1))r=e,o=--n;else if(a.nodeType==3)e=a,n=e.nodeValue.length;else break}}else{if(gm(e))break;{let a=e.previousSibling;for(;a&&Zr(a,-1);)r=e.parentNode,o=it(a),a=a.previousSibling;if(a)e=a,n=xs(e);else{if(e=e.parentNode,e==i.dom)break;n=0}}}s?Yc(i,e,n):r&&Yc(i,r,o)}function Nk(i){let t=i.domSelectionRange(),e=t.focusNode,n=t.focusOffset;if(!e)return;let r=xs(e),o,s;for(;;)if(n<r){if(e.nodeType!=1)break;let a=e.childNodes[n];if(Zr(a,1))o=e,s=++n;else break}else{if(gm(e))break;{let a=e.nextSibling;for(;a&&Zr(a,1);)o=a.parentNode,s=it(a)+1,a=a.nextSibling;if(a)e=a,n=0,r=xs(e);else{if(e=e.parentNode,e==i.dom)break;n=r=0}}}o&&Yc(i,o,s)}function gm(i){let t=i.pmViewDesc;return t&&t.node&&t.node.isBlock}function Pk(i,t){for(;i&&t==i.childNodes.length&&!ro(i);)t=it(i)+1,i=i.parentNode;for(;i&&t<i.childNodes.length;){let e=i.childNodes[t];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;i=e,t=0}}function _k(i,t){for(;i&&!t&&!ro(i);)t=it(i),i=i.parentNode;for(;i&&t;){let e=i.childNodes[t-1];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;i=e,t=i.childNodes.length}}function Yc(i,t,e){if(t.nodeType!=3){let o,s;(s=Pk(t,e))?(t=s,e=0):(o=_k(t,e))&&(t=o,e=o.nodeValue.length)}let n=i.domSelection();if(!n)return;if(Ms(n)){let o=document.createRange();o.setEnd(t,e),o.setStart(t,e),n.removeAllRanges(),n.addRange(o)}else n.extend&&n.extend(t,e);i.domObserver.setCurSelection();let{state:r}=i;setTimeout(()=>{i.state==r&&An(i)},50)}function Hf(i,t){let e=i.state.doc.resolve(t);if(!(ut||ok)&&e.parent.inlineContent){let r=i.coordsAtPos(t);if(t>e.start()){let o=i.coordsAtPos(t-1),s=(o.top+o.bottom)/2;if(s>r.top&&s<r.bottom&&Math.abs(o.left-r.left)>1)return o.left<r.left?"ltr":"rtl"}if(t<e.end()){let o=i.coordsAtPos(t+1),s=(o.top+o.bottom)/2;if(s>r.top&&s<r.bottom&&Math.abs(o.left-r.left)>1)return o.left>r.left?"ltr":"rtl"}}return getComputedStyle(i.dom).direction=="rtl"?"rtl":"ltr"}function zf(i,t,e){let n=i.state.selection;if(n instanceof G&&!n.empty||e.indexOf("s")>-1||Dt&&e.indexOf("m")>-1)return!1;let{$from:r,$to:o}=n;if(!r.parent.inlineContent||i.endOfTextblock(t<0?"up":"down")){let s=jc(i.state,t);if(s&&s instanceof Y)return Yn(i,s)}if(!r.parent.inlineContent){let s=t<0?r:o,a=n instanceof qe?re.near(s,t):re.findFrom(s,t);return a?Yn(i,a):!1}return!1}function Vf(i,t){if(!(i.state.selection instanceof G))return!0;let{$head:e,$anchor:n,empty:r}=i.state.selection;if(!e.sameParent(n))return!0;if(!r)return!1;if(i.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(o&&!o.isText){let s=i.state.tr;return t<0?s.delete(e.pos-o.nodeSize,e.pos):s.delete(e.pos,e.pos+o.nodeSize),i.dispatch(s),!0}return!1}function $f(i,t,e){i.domObserver.stop(),t.contentEditable=e,i.domObserver.start()}function Ok(i){if(!mt||i.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=i.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let n=t.firstChild;$f(i,n,"true"),setTimeout(()=>$f(i,n,"false"),20)}return!1}function Dk(i){let t="";return i.ctrlKey&&(t+="c"),i.metaKey&&(t+="m"),i.altKey&&(t+="a"),i.shiftKey&&(t+="s"),t}function Bk(i,t){let e=t.keyCode,n=Dk(t);if(e==8||Dt&&e==72&&n=="c")return Vf(i,-1)||rr(i,-1);if(e==46&&!t.shiftKey||Dt&&e==68&&n=="c")return Vf(i,1)||rr(i,1);if(e==13||e==27)return!0;if(e==37||Dt&&e==66&&n=="c"){let r=e==37?Hf(i,i.state.selection.from)=="ltr"?-1:1:-1;return Ff(i,r,n)||rr(i,r)}else if(e==39||Dt&&e==70&&n=="c"){let r=e==39?Hf(i,i.state.selection.from)=="ltr"?1:-1:1;return Ff(i,r,n)||rr(i,r)}else{if(e==38||Dt&&e==80&&n=="c")return zf(i,-1,n)||rr(i,-1);if(e==40||Dt&&e==78&&n=="c")return Ok(i)||zf(i,1,n)||rr(i,1);if(n==(Dt?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function ou(i,t){i.someProp("transformCopied",f=>{t=f(t,i)});let e=[],{content:n,openStart:r,openEnd:o}=t;for(;r>1&&o>1&&n.childCount==1&&n.firstChild.childCount==1;){r--,o--;let f=n.firstChild;e.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),n=f.content}let s=i.someProp("clipboardSerializer")||Rt.fromSchema(i.state.schema),a=Sm(),l=a.createElement("div");l.appendChild(s.serializeFragment(n,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=xm[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${r} ${o}${d?` -${d}`:""} ${JSON.stringify(e)}`);let h=i.someProp("clipboardTextSerializer",f=>f(t,i))||t.content.textBetween(0,t.content.size,`

`);return{dom:l,text:h,slice:t}}function bm(i,t,e,n,r){let o=r.parent.type.spec.code,s,a;if(!e&&!t)return null;let l=!!t&&(n||o||!e);if(l){if(i.someProp("transformPastedText",h=>{t=h(t,o||n,i)}),o)return a=new q(z.from(i.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0),i.someProp("transformPasted",h=>{a=h(a,i,!0)}),a;let d=i.someProp("clipboardTextParser",h=>h(t,r,n,i));if(d)a=d;else{let h=r.marks(),{schema:f}=i.state,p=Rt.fromSchema(f);s=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=s.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(f.text(m,h)))})}}else i.someProp("transformPastedHTML",d=>{e=d(e,i)}),s=Vk(e),oo&&$k(s);let c=s&&s.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=s.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;s=h}if(a||(a=(i.someProp("clipboardParser")||i.someProp("domParser")||nt.fromSchema(i.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||u),context:r,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!Fk.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Wk(Wf(a,+u[1],+u[2]),u[4]);else if(a=q.maxOpen(Hk(a.content,r),!0),a.openStart||a.openEnd){let d=0,h=0;for(let f=a.content.firstChild;d<a.openStart&&!f.type.spec.isolating;d++,f=f.firstChild);for(let f=a.content.lastChild;h<a.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);a=Wf(a,d,h)}return i.someProp("transformPasted",d=>{a=d(a,i,l)}),a}var Fk=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Hk(i,t){if(i.childCount<2)return i;for(let e=t.depth;e>=0;e--){let r=t.node(e).contentMatchAt(t.index(e)),o,s=[];if(i.forEach(a=>{if(!s)return;let l=r.findWrapping(a.type),c;if(!l)return s=null;if(c=s.length&&o.length&&vm(l,o,a,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Em(s[s.length-1],o.length));let u=ym(a,l);s.push(u),r=r.matchType(u.type),o=l}}),s)return z.from(s)}return i}function ym(i,t,e=0){for(let n=t.length-1;n>=e;n--)i=t[n].create(null,z.from(i));return i}function vm(i,t,e,n,r){if(r<i.length&&r<t.length&&i[r]==t[r]){let o=vm(i,t,e,n.lastChild,r+1);if(o)return n.copy(n.content.replaceChild(n.childCount-1,o));if(n.contentMatchAt(n.childCount).matchType(r==i.length-1?e.type:i[r+1]))return n.copy(n.content.append(z.from(ym(e,i,r+1))))}}function Em(i,t){if(t==0)return i;let e=i.content.replaceChild(i.childCount-1,Em(i.lastChild,t-1)),n=i.contentMatchAt(i.childCount).fillBefore(z.empty,!0);return i.copy(e.append(n))}function Xc(i,t,e,n,r,o){let s=t<0?i.firstChild:i.lastChild,a=s.content;return i.childCount>1&&(o=0),r<n-1&&(a=Xc(a,t,e,n,r+1,o)),r>=e&&(a=t<0?s.contentMatchAt(0).fillBefore(a,o<=r).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(z.empty,!0))),i.replaceChild(t<0?0:i.childCount-1,s.copy(a))}function Wf(i,t,e){return t<i.openStart&&(i=new q(Xc(i.content,-1,t,i.openStart,0,i.openEnd),t,i.openEnd)),e<i.openEnd&&(i=new q(Xc(i.content,1,e,i.openEnd,0,0),i.openStart,e)),i}var xm={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Uf=null;function Sm(){return Uf||(Uf=document.implementation.createHTMLDocument("title"))}var Dc=null;function zk(i){let t=window.trustedTypes;return t?(Dc||(Dc=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e})),Dc.createHTML(i)):i}function Vk(i){let t=/^(\s*<meta [^>]*>)*/.exec(i);t&&(i=i.slice(t[0].length));let e=Sm().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(i),r;if((r=n&&xm[n[1].toLowerCase()])&&(i=r.map(o=>"<"+o+">").join("")+i+r.map(o=>"</"+o+">").reverse().join("")),e.innerHTML=zk(i),r)for(let o=0;o<r.length;o++)e=e.querySelector(r[o])||e;return e}function $k(i){let t=i.querySelectorAll(ut?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let n=t[e];n.childNodes.length==1&&n.textContent=="\xA0"&&n.parentNode&&n.parentNode.replaceChild(i.ownerDocument.createTextNode(" "),n)}}function Wk(i,t){if(!i.size)return i;let e=i.content.firstChild.type.schema,n;try{n=JSON.parse(t)}catch(a){return i}let{content:r,openStart:o,openEnd:s}=i;for(let a=n.length-2;a>=0;a-=2){let l=e.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;r=z.from(l.create(n[a+1],r)),o++,s++}return new q(r,o,s)}var gt={},bt={},Uk={touchstart:!0,touchmove:!0},Jc=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function Kk(i){for(let t in gt){let e=gt[t];i.dom.addEventListener(t,i.input.eventHandlers[t]=n=>{Gk(i,n)&&!su(i,n)&&(i.editable||!(n.type in bt))&&e(i,n)},Uk[t]?{passive:!0}:void 0)}mt&&i.dom.addEventListener("input",()=>null),Zc(i)}function Xn(i,t){i.input.lastSelectionOrigin=t,i.input.lastSelectionTime=Date.now()}function qk(i){i.domObserver.stop();for(let t in i.input.eventHandlers)i.dom.removeEventListener(t,i.input.eventHandlers[t]);clearTimeout(i.input.composingTimeout),clearTimeout(i.input.lastIOSEnterFallbackTimeout)}function Zc(i){i.someProp("handleDOMEvents",t=>{for(let e in t)i.input.eventHandlers[e]||i.dom.addEventListener(e,i.input.eventHandlers[e]=n=>su(i,n))})}function su(i,t){return i.someProp("handleDOMEvents",e=>{let n=e[t.type];return n?n(i,t)||t.defaultPrevented:!1})}function Gk(i,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target;e!=i.dom;e=e.parentNode)if(!e||e.nodeType==11||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0}function jk(i,t){!su(i,t)&&gt[t.type]&&(i.editable||!(t.type in bt))&&gt[t.type](i,t)}bt.keydown=(i,t)=>{let e=t;if(i.input.shiftKey=e.keyCode==16||e.shiftKey,!wm(i,e)&&(i.input.lastKeyCode=e.keyCode,i.input.lastKeyCodeTime=Date.now(),!(Rn&&ut&&e.keyCode==13)))if(e.keyCode!=229&&i.domObserver.forceFlush(),lr&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let n=Date.now();i.input.lastIOSEnter=n,i.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{i.input.lastIOSEnter==n&&(i.someProp("handleKeyDown",r=>r(i,Si(13,"Enter"))),i.input.lastIOSEnter=0)},200)}else i.someProp("handleKeyDown",n=>n(i,e))||Bk(i,e)?e.preventDefault():Xn(i,"key")};bt.keyup=(i,t)=>{t.keyCode==16&&(i.input.shiftKey=!1)};bt.keypress=(i,t)=>{let e=t;if(wm(i,e)||!e.charCode||e.ctrlKey&&!e.altKey||Dt&&e.metaKey)return;if(i.someProp("handleKeyPress",r=>r(i,e))){e.preventDefault();return}let n=i.state.selection;if(!(n instanceof G)||!n.$from.sameParent(n.$to)){let r=String.fromCharCode(e.charCode),o=()=>i.state.tr.insertText(r).scrollIntoView();!/[\r\n]/.test(r)&&!i.someProp("handleTextInput",s=>s(i,n.$from.pos,n.$to.pos,r,o))&&i.dispatch(o()),e.preventDefault()}};function Ts(i){return{left:i.clientX,top:i.clientY}}function Yk(i,t){let e=t.x-i.clientX,n=t.y-i.clientY;return e*e+n*n<100}function au(i,t,e,n,r){if(n==-1)return!1;let o=i.state.doc.resolve(n);for(let s=o.depth+1;s>0;s--)if(i.someProp(t,a=>s>o.depth?a(i,e,o.nodeAfter,o.before(s),r,!0):a(i,e,o.node(s),o.before(s),r,!1)))return!0;return!1}function sr(i,t,e){if(i.focused||i.focus(),i.state.selection.eq(t))return;let n=i.state.tr.setSelection(t);e=="pointer"&&n.setMeta("pointer",!0),i.dispatch(n)}function Xk(i,t){if(t==-1)return!1;let e=i.state.doc.resolve(t),n=e.nodeAfter;return n&&n.isAtom&&Y.isSelectable(n)?(sr(i,new Y(e),"pointer"),!0):!1}function Jk(i,t){if(t==-1)return!1;let e=i.state.selection,n,r;e instanceof Y&&(n=e.node);let o=i.state.doc.resolve(t);for(let s=o.depth+1;s>0;s--){let a=s>o.depth?o.nodeAfter:o.node(s);if(Y.isSelectable(a)){n&&e.$from.depth>0&&s>=e.$from.depth&&o.before(e.$from.depth+1)==e.$from.pos?r=o.before(e.$from.depth):r=o.before(s);break}}return r!=null?(sr(i,Y.create(i.state.doc,r),"pointer"),!0):!1}function Zk(i,t,e,n,r){return au(i,"handleClickOn",t,e,n)||i.someProp("handleClick",o=>o(i,t,n))||(r?Jk(i,e):Xk(i,e))}function Qk(i,t,e,n){return au(i,"handleDoubleClickOn",t,e,n)||i.someProp("handleDoubleClick",r=>r(i,t,n))}function ew(i,t,e,n){return au(i,"handleTripleClickOn",t,e,n)||i.someProp("handleTripleClick",r=>r(i,t,n))||tw(i,e,n)}function tw(i,t,e){if(e.button!=0)return!1;let n=i.state.doc;if(t==-1)return n.inlineContent?(sr(i,G.create(n,0,n.content.size),"pointer"),!0):!1;let r=n.resolve(t);for(let o=r.depth+1;o>0;o--){let s=o>r.depth?r.nodeAfter:r.node(o),a=r.before(o);if(s.inlineContent)sr(i,G.create(n,a+1,a+1+s.content.size),"pointer");else if(Y.isSelectable(s))sr(i,Y.create(n,a),"pointer");else continue;return!0}}function lu(i){return Ss(i)}var km=Dt?"metaKey":"ctrlKey";gt.mousedown=(i,t)=>{let e=t;i.input.shiftKey=e.shiftKey;let n=lu(i),r=Date.now(),o="singleClick";r-i.input.lastClick.time<500&&Yk(e,i.input.lastClick)&&!e[km]&&i.input.lastClick.button==e.button&&(i.input.lastClick.type=="singleClick"?o="doubleClick":i.input.lastClick.type=="doubleClick"&&(o="tripleClick")),i.input.lastClick={time:r,x:e.clientX,y:e.clientY,type:o,button:e.button};let s=i.posAtCoords(Ts(e));s&&(o=="singleClick"?(i.input.mouseDown&&i.input.mouseDown.done(),i.input.mouseDown=new Qc(i,s,e,!!n)):(o=="doubleClick"?Qk:ew)(i,s.pos,s.inside,e)?e.preventDefault():Xn(i,"pointer"))};var Qc=class{constructor(t,e,n,r){this.view=t,this.pos=e,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[km],this.allowDefault=n.shiftKey;let o,s;if(e.inside>-1)o=t.state.doc.nodeAt(e.inside),s=e.inside;else{let u=t.state.doc.resolve(e.pos);o=u.parent,s=u.depth?u.before():0}let a=r?null:n.target,l=a?t.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=t.state;(n.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||c instanceof Y&&c.from<=s&&c.to>s)&&(this.mightDrag={node:o,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ft&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Xn(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>An(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Ts(t))),this.updateAllowDefault(t),this.allowDefault||!e?Xn(this.view,"pointer"):Zk(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||mt&&this.mightDrag&&!this.mightDrag.node.isAtom||ut&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(sr(this.view,re.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):Xn(this.view,"pointer")}move(t){this.updateAllowDefault(t),Xn(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}};gt.touchstart=i=>{i.input.lastTouch=Date.now(),lu(i),Xn(i,"pointer")};gt.touchmove=i=>{i.input.lastTouch=Date.now(),Xn(i,"pointer")};gt.contextmenu=i=>lu(i);function wm(i,t){return i.composing?!0:mt&&Math.abs(t.timeStamp-i.input.compositionEndedAt)<500?(i.input.compositionEndedAt=-2e8,!0):!1}var nw=Rn?5e3:-1;bt.compositionstart=bt.compositionupdate=i=>{if(!i.composing){i.domObserver.flush();let{state:t}=i,e=t.selection.$to;if(t.selection instanceof G&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))i.markCursor=i.state.storedMarks||e.marks(),Ss(i,!0),i.markCursor=null;else if(Ss(i,!t.selection.empty),Ft&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let n=i.domSelectionRange();for(let r=n.focusNode,o=n.focusOffset;r&&r.nodeType==1&&o!=0;){let s=o<0?r.lastChild:r.childNodes[o-1];if(!s)break;if(s.nodeType==3){let a=i.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else r=s,o=-1}}i.input.composing=!0}Mm(i,nw)};bt.compositionend=(i,t)=>{i.composing&&(i.input.composing=!1,i.input.compositionEndedAt=t.timeStamp,i.input.compositionPendingChanges=i.domObserver.pendingRecords().length?i.input.compositionID:0,i.input.compositionNode=null,i.input.compositionPendingChanges&&Promise.resolve().then(()=>i.domObserver.flush()),i.input.compositionID++,Mm(i,20))};function Mm(i,t){clearTimeout(i.input.composingTimeout),t>-1&&(i.input.composingTimeout=setTimeout(()=>Ss(i),t))}function Tm(i){for(i.composing&&(i.input.composing=!1,i.input.compositionEndedAt=rw());i.input.compositionNodes.length>0;)i.input.compositionNodes.pop().markParentsDirty()}function iw(i){let t=i.domSelectionRange();if(!t.focusNode)return null;let e=ek(t.focusNode,t.focusOffset),n=tk(t.focusNode,t.focusOffset);if(e&&n&&e!=n){let r=n.pmViewDesc,o=i.domObserver.lastChangedTextNode;if(e==o||n==o)return o;if(!r||!r.isText(n.nodeValue))return n;if(i.input.compositionNode==n){let s=e.pmViewDesc;if(!(!s||!s.isText(e.nodeValue)))return n}}return e||n}function rw(){let i=document.createEvent("Event");return i.initEvent("event",!0,!0),i.timeStamp}function Ss(i,t=!1){if(!(Rn&&i.domObserver.flushingSoon>=0)){if(i.domObserver.forceFlush(),Tm(i),t||i.docView&&i.docView.dirty){let e=iu(i),n=i.state.selection;return e&&!e.eq(n)?i.dispatch(i.state.tr.setSelection(e)):(i.markCursor||t)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?i.dispatch(i.state.tr.deleteSelection()):i.updateState(i.state),!0}return!1}}function ow(i,t){if(!i.dom.parentNode)return;let e=i.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),r=document.createRange();r.selectNodeContents(t),i.dom.blur(),n.removeAllRanges(),n.addRange(r),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),i.focus()},50)}var Qr=xt&&Jn<15||lr&&sk<604;gt.copy=bt.cut=(i,t)=>{let e=t,n=i.state.selection,r=e.type=="cut";if(n.empty)return;let o=Qr?null:e.clipboardData,s=n.content(),{dom:a,text:l}=ou(i,s);o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):ow(i,a),r&&i.dispatch(i.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function sw(i){return i.openStart==0&&i.openEnd==0&&i.content.childCount==1?i.content.firstChild:null}function aw(i,t){if(!i.dom.parentNode)return;let e=i.input.shiftKey||i.state.selection.$from.parent.type.spec.code,n=i.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let r=i.input.shiftKey&&i.input.lastKeyCode!=45;setTimeout(()=>{i.focus(),n.parentNode&&n.parentNode.removeChild(n),e?eo(i,n.value,null,r,t):eo(i,n.textContent,n.innerHTML,r,t)},50)}function eo(i,t,e,n,r){let o=bm(i,t,e,n,i.state.selection.$from);if(i.someProp("handlePaste",l=>l(i,r,o||q.empty)))return!0;if(!o)return!1;let s=sw(o),a=s?i.state.tr.replaceSelectionWith(s,n):i.state.tr.replaceSelection(o);return i.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Cm(i){let t=i.getData("text/plain")||i.getData("Text");if(t)return t;let e=i.getData("text/uri-list");return e?e.replace(/\r?\n/g," "):""}bt.paste=(i,t)=>{let e=t;if(i.composing&&!Rn)return;let n=Qr?null:e.clipboardData,r=i.input.shiftKey&&i.input.lastKeyCode!=45;n&&eo(i,Cm(n),n.getData("text/html"),r,e)?e.preventDefault():aw(i,e)};var ks=class{constructor(t,e,n){this.slice=t,this.move=e,this.node=n}},lw=Dt?"altKey":"ctrlKey";function Lm(i,t){let e=i.someProp("dragCopies",n=>!n(t));return e!=null?e:!t[lw]}gt.dragstart=(i,t)=>{let e=t,n=i.input.mouseDown;if(n&&n.done(),!e.dataTransfer)return;let r=i.state.selection,o=r.empty?null:i.posAtCoords(Ts(e)),s;if(!(o&&o.pos>=r.from&&o.pos<=(r instanceof Y?r.to-1:r.to))){if(n&&n.mightDrag)s=Y.create(i.state.doc,n.mightDrag.pos);else if(e.target&&e.target.nodeType==1){let d=i.docView.nearestDesc(e.target,!0);d&&d.node.type.spec.draggable&&d!=i.docView&&(s=Y.create(i.state.doc,d.posBefore))}}let a=(s||i.state.selection).content(),{dom:l,text:c,slice:u}=ou(i,a);(!e.dataTransfer.files.length||!ut||im>120)&&e.dataTransfer.clearData(),e.dataTransfer.setData(Qr?"Text":"text/html",l.innerHTML),e.dataTransfer.effectAllowed="copyMove",Qr||e.dataTransfer.setData("text/plain",c),i.dragging=new ks(u,Lm(i,e),s)};gt.dragend=i=>{let t=i.dragging;window.setTimeout(()=>{i.dragging==t&&(i.dragging=null)},50)};bt.dragover=bt.dragenter=(i,t)=>t.preventDefault();bt.drop=(i,t)=>{let e=t,n=i.dragging;if(i.dragging=null,!e.dataTransfer)return;let r=i.posAtCoords(Ts(e));if(!r)return;let o=i.state.doc.resolve(r.pos),s=n&&n.slice;s?i.someProp("transformPasted",p=>{s=p(s,i,!1)}):s=bm(i,Cm(e.dataTransfer),Qr?null:e.dataTransfer.getData("text/html"),!1,o);let a=!!(n&&Lm(i,e));if(i.someProp("handleDrop",p=>p(i,e,s||q.empty,a))){e.preventDefault();return}if(!s)return;e.preventDefault();let l=s?is(i.state.doc,o.pos,s):o.pos;l==null&&(l=o.pos);let c=i.state.tr;if(a){let{node:p}=n;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,s.content.firstChild):c.replaceRange(u,u,s),c.doc.eq(h))return;let f=c.doc.resolve(u);if(d&&Y.isSelectable(s.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new Y(f));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,b,v)=>p=v),c.setSelection(ru(i,f,c.doc.resolve(p)))}i.focus(),i.dispatch(c.setMeta("uiEvent","drop"))};gt.focus=i=>{i.input.lastFocus=Date.now(),i.focused||(i.domObserver.stop(),i.dom.classList.add("ProseMirror-focused"),i.domObserver.start(),i.focused=!0,setTimeout(()=>{i.docView&&i.hasFocus()&&!i.domObserver.currentSelection.eq(i.domSelectionRange())&&An(i)},20))};gt.blur=(i,t)=>{let e=t;i.focused&&(i.domObserver.stop(),i.dom.classList.remove("ProseMirror-focused"),i.domObserver.start(),e.relatedTarget&&i.dom.contains(e.relatedTarget)&&i.domObserver.currentSelection.clear(),i.focused=!1)};gt.beforeinput=(i,t)=>{if(ut&&Rn&&t.inputType=="deleteContentBackward"){i.domObserver.flushSoon();let{domChangeCount:n}=i.input;setTimeout(()=>{if(i.input.domChangeCount!=n||(i.dom.blur(),i.focus(),i.someProp("handleKeyDown",o=>o(i,Si(8,"Backspace")))))return;let{$cursor:r}=i.state.selection;r&&r.pos>0&&i.dispatch(i.state.tr.delete(r.pos-1,r.pos).scrollIntoView())},50)}};for(let i in bt)gt[i]=bt[i];function to(i,t){if(i==t)return!0;for(let e in i)if(i[e]!==t[e])return!1;for(let e in t)if(!(e in i))return!1;return!0}var ur=class{constructor(t,e){this.toDOM=t,this.spec=e||Mi,this.side=this.spec.side||0}map(t,e,n,r){let{pos:o,deleted:s}=t.mapResult(e.from+r,this.side<0?-1:1);return s?null:new Me(o-n,o-n,this)}valid(){return!0}eq(t){return this==t||t instanceof ur&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&to(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}},ln=class{constructor(t,e){this.attrs=t,this.spec=e||Mi}map(t,e,n,r){let o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,s=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=s?null:new Me(o,s,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof ln&&to(this.attrs,t.attrs)&&to(this.spec,t.spec)}static is(t){return t.type instanceof ln}destroy(){}},no=class{constructor(t,e){this.attrs=t,this.spec=e||Mi}map(t,e,n,r){let o=t.mapResult(e.from+r,1);if(o.deleted)return null;let s=t.mapResult(e.to+r,-1);return s.deleted||s.pos<=o.pos?null:new Me(o.pos-n,s.pos-n,this)}valid(t,e){let{index:n,offset:r}=t.content.findIndex(e.from),o;return r==e.from&&!(o=t.child(n)).isText&&r+o.nodeSize==e.to}eq(t){return this==t||t instanceof no&&to(this.attrs,t.attrs)&&to(this.spec,t.spec)}destroy(){}},Me=class{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new Me(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new Me(t,t,new ur(e,n))}static inline(t,e,n,r){return new Me(t,e,new ln(n,r))}static node(t,e,n,r){return new Me(t,e,new no(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof ln}get widget(){return this.type instanceof ur}},or=[],Mi={},me=class{constructor(t,e){this.local=t.length?t:or,this.children=e.length?e:or}static create(t,e){return e.length?ws(e,t,0,Mi):ct}find(t,e,n){let r=[];return this.findInner(t==null?0:t,e==null?1e9:e,r,0,n),r}findInner(t,e,n,r,o){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=e&&a.to>=t&&(!o||o(a.spec))&&n.push(a.copy(a.from+r,a.to+r))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){let a=this.children[s]+1;this.children[s+2].findInner(t-a,e-a,n,r+a,o)}}map(t,e,n){return this==ct||t.maps.length==0?this:this.mapInner(t,e,0,0,n||Mi)}mapInner(t,e,n,r,o){let s;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(t,n,r);l&&l.type.valid(e,l)?(s||(s=[])).push(l):o.onRemove&&o.onRemove(this.local[a].spec)}return this.children.length?cw(this.children,s||[],t,e,n,r,o):s?new me(s.sort(Ti),or):ct}add(t,e){return e.length?this==ct?me.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let r,o=0;t.forEach((a,l)=>{let c=l+n,u;if(u=Am(e,a,c)){for(r||(r=this.children.slice());o<r.length&&r[o]<l;)o+=3;r[o]==l?r[o+2]=r[o+2].addInner(a,u,c+1):r.splice(o,0,l,l+a.nodeSize,ws(u,a,c+1,Mi)),o+=3}});let s=Rm(o?Im(e):e,-n);for(let a=0;a<s.length;a++)s[a].type.valid(t,s[a])||s.splice(a--,1);return new me(s.length?this.local.concat(s).sort(Ti):this.local,r||this.children)}remove(t){return t.length==0||this==ct?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,r=this.local;for(let o=0;o<n.length;o+=3){let s,a=n[o]+e,l=n[o+1]+e;for(let u=0,d;u<t.length;u++)(d=t[u])&&d.from>a&&d.to<l&&(t[u]=null,(s||(s=[])).push(d));if(!s)continue;n==this.children&&(n=this.children.slice());let c=n[o+2].removeInner(s,a+1);c!=ct?n[o+2]=c:(n.splice(o,3),o-=3)}if(r.length){for(let o=0,s;o<t.length;o++)if(s=t[o])for(let a=0;a<r.length;a++)r[a].eq(s,e)&&(r==this.local&&(r=this.local.slice()),r.splice(a--,1))}return n==this.children&&r==this.local?this:r.length||n.length?new me(r,n):ct}forChild(t,e){if(this==ct)return this;if(e.isLeaf)return me.empty;let n,r;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=t){this.children[a]==t&&(n=this.children[a+2]);break}let o=t+1,s=o+e.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<s&&l.to>o&&l.type instanceof ln){let c=Math.max(o,l.from)-o,u=Math.min(s,l.to)-o;c<u&&(r||(r=[])).push(l.copy(c,u))}}if(r){let a=new me(r.sort(Ti),or);return n?new sn([a,n]):a}return n||ct}eq(t){if(this==t)return!0;if(!(t instanceof me)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return cu(this.localsInner(t))}localsInner(t){if(this==ct)return or;if(t.inlineContent||!this.local.some(ln.is))return this.local;let e=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof ln||e.push(this.local[n]);return e}forEachSet(t){t(this)}};me.empty=new me([],[]);me.removeOverlap=cu;var ct=me.empty,sn=class{constructor(t){this.members=t}map(t,e){let n=this.members.map(r=>r.map(t,e,Mi));return sn.from(n)}forChild(t,e){if(e.isLeaf)return me.empty;let n=[];for(let r=0;r<this.members.length;r++){let o=this.members[r].forChild(t,e);o!=ct&&(o instanceof sn?n=n.concat(o.members):n.push(o))}return sn.from(n)}eq(t){if(!(t instanceof sn)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let r=0;r<this.members.length;r++){let o=this.members[r].localsInner(t);if(o.length)if(!e)e=o;else{n&&(e=e.slice(),n=!1);for(let s=0;s<o.length;s++)e.push(o[s])}}return e?cu(n?e:e.sort(Ti)):or}static from(t){switch(t.length){case 0:return ct;case 1:return t[0];default:return new sn(t.every(e=>e instanceof me)?t:t.reduce((e,n)=>e.concat(n instanceof me?n:n.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}};function cw(i,t,e,n,r,o,s){let a=i.slice();for(let c=0,u=o;c<e.maps.length;c++){let d=0;e.maps[c].forEach((h,f,p,m)=>{let g=m-p-(f-h);for(let b=0;b<a.length;b+=3){let v=a[b+1];if(v<0||h>v+u-d)continue;let y=a[b]+u-d;f>=y?a[b+1]=h<=y?-2:-1:h>=u&&g&&(a[b]+=g,a[b+1]+=g)}d+=g}),u=e.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=e.map(i[c]+o),d=u-r;if(d<0||d>=n.content.size){l=!0;continue}let h=e.map(i[c+1]+o,-1),f=h-r,{index:p,offset:m}=n.content.findIndex(d),g=n.maybeChild(p);if(g&&m==d&&m+g.nodeSize==f){let b=a[c+2].mapInner(e,g,u+1,i[c]+o+1,s);b!=ct?(a[c]=d,a[c+1]=f,a[c+2]=b):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=uw(a,i,t,e,r,o,s),u=ws(c,n,0,s);t=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let f=u.children[d];for(;h<a.length&&a[h]<f;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new me(t.sort(Ti),a)}function Rm(i,t){if(!t||!i.length)return i;let e=[];for(let n=0;n<i.length;n++){let r=i[n];e.push(new Me(r.from+t,r.to+t,r.type))}return e}function uw(i,t,e,n,r,o,s){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(n,r,c);d?e.push(d):s.onRemove&&s.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<i.length;l+=3)i[l+1]==-1&&a(i[l+2],t[l]+o+1);return e}function Am(i,t,e){if(t.isLeaf)return null;let n=e+t.nodeSize,r=null;for(let o=0,s;o<i.length;o++)(s=i[o])&&s.from>e&&s.to<n&&((r||(r=[])).push(s),i[o]=null);return r}function Im(i){let t=[];for(let e=0;e<i.length;e++)i[e]!=null&&t.push(i[e]);return t}function ws(i,t,e,n){let r=[],o=!1;t.forEach((a,l)=>{let c=Am(i,a,l+e);if(c){o=!0;let u=ws(c,a,e+l+1,n);u!=ct&&r.push(l,l+a.nodeSize,u)}});let s=Rm(o?Im(i):i,-e).sort(Ti);for(let a=0;a<s.length;a++)s[a].type.valid(t,s[a])||(n.onRemove&&n.onRemove(s[a].spec),s.splice(a--,1));return s.length||r.length?new me(s,r):ct}function Ti(i,t){return i.from-t.from||i.to-t.to}function cu(i){let t=i;for(let e=0;e<t.length-1;e++){let n=t[e];if(n.from!=n.to)for(let r=e+1;r<t.length;r++){let o=t[r];if(o.from==n.from){o.to!=n.to&&(t==i&&(t=i.slice()),t[r]=o.copy(o.from,n.to),Kf(t,r+1,o.copy(n.to,o.to)));continue}else{o.from<n.to&&(t==i&&(t=i.slice()),t[e]=n.copy(n.from,o.from),Kf(t,r,n.copy(o.from,n.to)));break}}}return t}function Kf(i,t,e){for(;t<i.length&&Ti(e,i[t])>0;)t++;i.splice(t,0,e)}function Bc(i){let t=[];return i.someProp("decorations",e=>{let n=e(i.state);n&&n!=ct&&t.push(n)}),i.cursorWrapper&&t.push(me.create(i.state.doc,[i.cursorWrapper.deco])),sn.from(t)}var dw={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},hw=xt&&Jn<=11,eu=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}},tu=class{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new eu,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let r=0;r<n.length;r++)this.queue.push(n[r]);xt&&Jn<=11&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),hw&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,dw)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Bf(this.view)){if(this.suppressingSelectionUpdates)return An(this.view);if(xt&&Jn<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&Ci(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e=new Set,n;for(let o=t.focusNode;o;o=ar(o))e.add(o);for(let o=t.anchorNode;o;o=ar(o))if(e.has(o)){n=o;break}let r=n&&this.view.docView.nearestDesc(n);if(r&&r.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=t.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Bf(t)&&!this.ignoreSelectionChange(n),o=-1,s=-1,a=!1,l=[];if(t.editable)for(let u=0;u<e.length;u++){let d=this.registerMutation(e[u],l);d&&(o=o<0?d.from:Math.min(d.from,o),s=s<0?d.to:Math.max(d.to,s),d.typeOver&&(a=!0))}if(Ft&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let f=h.parentNode;f&&f.nodeName=="LI"&&(!d||mw(t,d)!=f)&&h.remove()}}}let c=null;o<0&&r&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&Ms(n)&&(c=iu(t))&&c.eq(re.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,An(t),this.currentSelection.set(n),t.scrollToSelection()):(o>-1||r)&&(o>-1&&(t.docView.markDirty(o,s),pw(t)),this.handleDOMChange(o,s,a,l),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||An(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(n==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!n||n.ignoreMutation(t))return null;if(t.type=="childList"){for(let u=0;u<t.addedNodes.length;u++){let d=t.addedNodes[u];e.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let r=t.previousSibling,o=t.nextSibling;if(xt&&Jn<=11&&t.addedNodes.length)for(let u=0;u<t.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=t.addedNodes[u];(!d||Array.prototype.indexOf.call(t.addedNodes,d)<0)&&(r=d),(!h||Array.prototype.indexOf.call(t.addedNodes,h)<0)&&(o=h)}let s=r&&r.parentNode==t.target?it(r)+1:0,a=n.localPosFromDOM(t.target,s,-1),l=o&&o.parentNode==t.target?it(o):t.target.childNodes.length,c=n.localPosFromDOM(t.target,l,1);return{from:a,to:c}}else return t.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}},qf=new WeakMap,Gf=!1;function pw(i){if(!qf.has(i)&&(qf.set(i,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(i.dom).whiteSpace)!==-1)){if(i.requiresGeckoHackNode=Ft,Gf)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Gf=!0}}function jf(i,t){let e=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,s=i.domAtPos(i.state.selection.anchor);return Ci(s.node,s.offset,r,o)&&([e,n,r,o]=[r,o,e,n]),{anchorNode:e,anchorOffset:n,focusNode:r,focusOffset:o}}function fw(i,t){if(t.getComposedRanges){let r=t.getComposedRanges(i.root)[0];if(r)return jf(i,r)}let e;function n(r){r.preventDefault(),r.stopImmediatePropagation(),e=r.getTargetRanges()[0]}return i.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),i.dom.removeEventListener("beforeinput",n,!0),e?jf(i,e):null}function mw(i,t){for(let e=t.parentNode;e&&e!=i.dom;e=e.parentNode){let n=i.docView.nearestDesc(e,!0);if(n&&n.node.isBlock)return e}return null}function gw(i,t,e){let{node:n,fromOffset:r,toOffset:o,from:s,to:a}=i.docView.parseRange(t,e),l=i.domSelectionRange(),c,u=l.anchorNode;if(u&&i.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Ms(l)||c.push({node:l.focusNode,offset:l.focusOffset})),ut&&i.input.lastKeyCode===8)for(let g=o;g>r;g--){let b=n.childNodes[g-1],v=b.pmViewDesc;if(b.nodeName=="BR"&&!v){o=g;break}if(!v||v.size)break}let d=i.state.doc,h=i.someProp("domParser")||nt.fromSchema(i.state.schema),f=d.resolve(s),p=null,m=h.parse(n,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:r,to:o,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:bw,context:f});if(c&&c[0].pos!=null){let g=c[0].pos,b=c[1]&&c[1].pos;b==null&&(b=g),p={anchor:g+s,head:b+s}}return{doc:m,sel:p,from:s,to:a}}function bw(i){let t=i.pmViewDesc;if(t)return t.parseRule();if(i.nodeName=="BR"&&i.parentNode){if(mt&&/^(ul|ol)$/i.test(i.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}else if(i.parentNode.lastChild==i||mt&&/^(tr|table)$/i.test(i.parentNode.nodeName))return{ignore:!0}}else if(i.nodeName=="IMG"&&i.getAttribute("mark-placeholder"))return{ignore:!0};return null}var yw=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function vw(i,t,e,n,r){let o=i.input.compositionPendingChanges||(i.composing?i.input.compositionID:0);if(i.input.compositionPendingChanges=0,t<0){let k=i.input.lastSelectionTime>Date.now()-50?i.input.lastSelectionOrigin:null,M=iu(i,k);if(M&&!i.state.selection.eq(M)){if(ut&&Rn&&i.input.lastKeyCode===13&&Date.now()-100<i.input.lastKeyCodeTime&&i.someProp("handleKeyDown",_=>_(i,Si(13,"Enter"))))return;let L=i.state.tr.setSelection(M);k=="pointer"?L.setMeta("pointer",!0):k=="key"&&L.scrollIntoView(),o&&L.setMeta("composition",o),i.dispatch(L)}return}let s=i.state.doc.resolve(t),a=s.sharedDepth(e);t=s.before(a+1),e=i.state.doc.resolve(e).after(a+1);let l=i.state.selection,c=gw(i,t,e),u=i.state.doc,d=u.slice(c.from,c.to),h,f;i.input.lastKeyCode===8&&Date.now()-100<i.input.lastKeyCodeTime?(h=i.state.selection.to,f="end"):(h=i.state.selection.from,f="start"),i.input.lastKeyCode=null;let p=Sw(d.content,c.doc.content,c.from,h,f);if(p&&i.input.domChangeCount++,(lr&&i.input.lastIOSEnter>Date.now()-225||Rn)&&r.some(k=>k.nodeType==1&&!yw.test(k.nodeName))&&(!p||p.endA>=p.endB)&&i.someProp("handleKeyDown",k=>k(i,Si(13,"Enter")))){i.input.lastIOSEnter=0;return}if(!p)if(n&&l instanceof G&&!l.empty&&l.$head.sameParent(l.$anchor)&&!i.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let k=Yf(i,i.state.doc,c.sel);if(k&&!k.eq(i.state.selection)){let M=i.state.tr.setSelection(k);o&&M.setMeta("composition",o),i.dispatch(M)}}return}i.state.selection.from<i.state.selection.to&&p.start==p.endB&&i.state.selection instanceof G&&(p.start>i.state.selection.from&&p.start<=i.state.selection.from+2&&i.state.selection.from>=c.from?p.start=i.state.selection.from:p.endA<i.state.selection.to&&p.endA>=i.state.selection.to-2&&i.state.selection.to<=c.to&&(p.endB+=i.state.selection.to-p.endA,p.endA=i.state.selection.to)),xt&&Jn<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" \xA0"&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),b=u.resolve(p.start),v=m.sameParent(g)&&m.parent.inlineContent&&b.end()>=p.endA,y;if((lr&&i.input.lastIOSEnter>Date.now()-225&&(!v||r.some(k=>k.nodeName=="DIV"||k.nodeName=="P"))||!v&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"",""))&&(y=re.findFrom(c.doc.resolve(m.pos+1),1,!0))&&y.head>m.pos)&&i.someProp("handleKeyDown",k=>k(i,Si(13,"Enter")))){i.input.lastIOSEnter=0;return}if(i.state.selection.anchor>p.start&&xw(u,p.start,p.endA,m,g)&&i.someProp("handleKeyDown",k=>k(i,Si(8,"Backspace")))){Rn&&ut&&i.domObserver.suppressSelectionUpdates();return}ut&&p.endB==p.start&&(i.input.lastChromeDelete=Date.now()),Rn&&!v&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{i.someProp("handleKeyDown",function(k){return k(i,Si(13,"Enter"))})},20));let E=p.start,x=p.endA,S=k=>{let M=k||i.state.tr.replace(E,x,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let L=Yf(i,M.doc,c.sel);L&&!(ut&&i.composing&&L.empty&&(p.start!=p.endB||i.input.lastChromeDelete<Date.now()-100)&&(L.head==E||L.head==M.mapping.map(x)-1)||xt&&L.empty&&L.head==E)&&M.setSelection(L)}return o&&M.setMeta("composition",o),M.scrollIntoView()},w;if(v){if(m.pos==g.pos){xt&&Jn<=11&&m.parentOffset==0&&(i.domObserver.suppressSelectionUpdates(),setTimeout(()=>An(i),20));let k=S(i.state.tr.delete(E,x)),M=u.resolve(p.start).marksAcross(u.resolve(p.endA));M&&k.ensureMarks(M),i.dispatch(k)}else if(p.endA==p.endB&&(w=Ew(m.parent.content.cut(m.parentOffset,g.parentOffset),b.parent.content.cut(b.parentOffset,p.endA-b.start())))){let k=S(i.state.tr);w.type=="add"?k.addMark(E,x,w.mark):k.removeMark(E,x,w.mark),i.dispatch(k)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let k=m.parent.textBetween(m.parentOffset,g.parentOffset),M=()=>S(i.state.tr.insertText(k,E,x));i.someProp("handleTextInput",L=>L(i,E,x,k,M))||i.dispatch(M())}}else i.dispatch(S())}function Yf(i,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:ru(i,t.resolve(e.anchor),t.resolve(e.head))}function Ew(i,t){let e=i.firstChild.marks,n=t.firstChild.marks,r=e,o=n,s,a,l;for(let u=0;u<n.length;u++)r=n[u].removeFromSet(r);for(let u=0;u<e.length;u++)o=e[u].removeFromSet(o);if(r.length==1&&o.length==0)a=r[0],s="add",l=u=>u.mark(a.addToSet(u.marks));else if(r.length==0&&o.length==1)a=o[0],s="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<t.childCount;u++)c.push(l(t.child(u)));if(z.from(c).eq(i))return{mark:a,type:s}}function xw(i,t,e,n,r){if(e-t<=r.pos-n.pos||Fc(n,!0,!1)<r.pos)return!1;let o=i.resolve(t);if(!n.parent.isTextblock){let a=o.nodeAfter;return a!=null&&e==t+a.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let s=i.resolve(Fc(o,!0,!0));return!s.parent.isTextblock||s.pos>e||Fc(s,!0,!1)<e?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function Fc(i,t,e){let n=i.depth,r=t?i.end():i.pos;for(;n>0&&(t||i.indexAfter(n)==i.node(n).childCount);)n--,r++,t=!1;if(e){let o=i.node(n).maybeChild(i.indexAfter(n));for(;o&&!o.isLeaf;)o=o.firstChild,r++}return r}function Sw(i,t,e,n,r){let o=i.findDiffStart(t,e);if(o==null)return null;let{a:s,b:a}=i.findDiffEnd(t,e+i.size,e+t.size);if(r=="end"){let l=Math.max(0,o-Math.min(s,a));n-=s+l-o}if(s<o&&i.size<t.size){let l=n<=o&&n>=s?o-n:0;o-=l,o&&o<t.size&&Xf(t.textBetween(o-1,o+1))&&(o+=l?1:-1),a=o+(a-s),s=o}else if(a<o){let l=n<=o&&n>=a?o-n:0;o-=l,o&&o<i.size&&Xf(i.textBetween(o-1,o+1))&&(o+=l?1:-1),s=o+(s-a),a=o}return{start:o,endA:s,endB:a}}function Xf(i){if(i.length!=2)return!1;let t=i.charCodeAt(0),e=i.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}var io=class{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Jc,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(tm),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=Qf(this),Zf(this),this.nodeViews=em(this),this.docView=If(this.state.doc,Jf(this),Bc(this),this.dom,this),this.domObserver=new tu(this,(n,r,o,s)=>vw(this,n,r,o,s)),this.domObserver.start(),Kk(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Zc(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(tm),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var n;let r=this.state,o=!1,s=!1;t.storedMarks&&this.composing&&(Tm(this),s=!0),this.state=t;let a=r.plugins!=t.plugins||this._props.plugins!=e.plugins;if(a||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let f=em(this);ww(f,this.nodeViews)&&(this.nodeViews=f,o=!0)}(a||e.handleDOMEvents!=this._props.handleDOMEvents)&&Zc(this),this.editable=Qf(this),Zf(this);let l=Bc(this),c=Jf(this),u=r.plugins!=t.plugins&&!r.doc.eq(t.doc)?"reset":t.scrollToSelection>r.scrollToSelection?"to selection":"preserve",d=o||!this.docView.matchesNode(t.doc,c,l);(d||!t.selection.eq(r.selection))&&(s=!0);let h=u=="preserve"&&s&&this.dom.style.overflowAnchor==null&&ck(this);if(s){this.domObserver.stop();let f=d&&(xt||ut)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&kw(r.selection,t.selection);if(d){let p=ut?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=iw(this)),(o||!this.docView.update(t.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=If(t.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Ak(this))?An(this,f):(fm(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),!((n=this.dragging)===null||n===void 0)&&n.node&&!r.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,r),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&uk(h)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof Y){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&Mf(this,e.getBoundingClientRect(),t)}else Mf(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let n=this.directPlugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let n=this.state.plugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}}updateDraggedNode(t,e){let n=t.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let o=n.from+(this.state.doc.content.size-e.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==n.node&&(r=o)}this.dragging=new ks(t.slice,t.move,r<0?void 0:Y.create(this.state.doc,r))}someProp(t,e){let n=this._props&&this._props[t],r;if(n!=null&&(r=e?e(n):n))return r;for(let s=0;s<this.directPlugins.length;s++){let a=this.directPlugins[s].props[t];if(a!=null&&(r=e?e(a):a))return r}let o=this.state.plugins;if(o)for(let s=0;s<o.length;s++){let a=o[s].props[t];if(a!=null&&(r=e?e(a):a))return r}}hasFocus(){if(xt){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&dk(this.dom),An(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return t||document}updateRoot(){this._root=null}posAtCoords(t){return gk(this,t)}coordsAtPos(t,e=1){return lm(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let r=this.docView.posFromDOM(t,e,n);if(r==null)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(t,e){return xk(this,e||this.state,t)}pasteHTML(t,e){return eo(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return eo(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return ou(this,t)}destroy(){this.docView&&(qk(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Bc(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,ZS())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return jk(this,t)}domSelectionRange(){let t=this.domSelection();return t?mt&&this.root.nodeType===11&&ik(this.dom.ownerDocument)==this.dom&&fw(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};io.prototype.dispatch=function(i){let t=this._props.dispatchTransaction;t?t.call(this,i):this.updateState(this.state.apply(i))};function Jf(i){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(i.editable),i.someProp("attributes",e=>{if(typeof e=="function"&&(e=e(i.state)),e)for(let n in e)n=="class"?t.class+=" "+e[n]:n=="style"?t.style=(t.style?t.style+";":"")+e[n]:!t[n]&&n!="contenteditable"&&n!="nodeName"&&(t[n]=String(e[n]))}),t.translate||(t.translate="no"),[Me.node(0,i.state.doc.content.size,t)]}function Zf(i){if(i.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),i.cursorWrapper={dom:t,deco:Me.widget(i.state.selection.from,t,{raw:!0,marks:i.markCursor})}}else i.cursorWrapper=null}function Qf(i){return!i.someProp("editable",t=>t(i.state)===!1)}function kw(i,t){let e=Math.min(i.$anchor.sharedDepth(i.head),t.$anchor.sharedDepth(t.head));return i.$anchor.start(e)!=t.$anchor.start(e)}function em(i){let t=Object.create(null);function e(n){for(let r in n)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=n[r])}return i.someProp("nodeViews",e),i.someProp("markViews",e),t}function ww(i,t){let e=0,n=0;for(let r in i){if(i[r]!=t[r])return!0;e++}for(let r in t)n++;return e!=n}function tm(i){if(i.spec.state||i.spec.filterTransaction||i.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Nn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ls={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Mw=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),Tw=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(Ke=0;Ke<10;Ke++)Nn[48+Ke]=Nn[96+Ke]=String(Ke);var Ke;for(Ke=1;Ke<=24;Ke++)Nn[Ke+111]="F"+Ke;var Ke;for(Ke=65;Ke<=90;Ke++)Nn[Ke]=String.fromCharCode(Ke+32),Ls[Ke]=String.fromCharCode(Ke);var Ke;for(Cs in Nn)Ls.hasOwnProperty(Cs)||(Ls[Cs]=Nn[Cs]);var Cs;function Nm(i){var t=Mw&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||Tw&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",e=!t&&i.key||(i.shiftKey?Ls:Nn)[i.keyCode]||i.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}var Cw=typeof navigator!="undefined"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Lw=typeof navigator!="undefined"&&/Win/.test(navigator.platform);function Rw(i){let t=i.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let n,r,o,s;for(let a=0;a<t.length-1;a++){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))Cw?s=!0:r=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(e="Alt-"+e),r&&(e="Ctrl-"+e),s&&(e="Meta-"+e),o&&(e="Shift-"+e),e}function Aw(i){let t=Object.create(null);for(let e in i)t[Rw(e)]=i[e];return t}function uu(i,t,e=!0){return t.altKey&&(i="Alt-"+i),t.ctrlKey&&(i="Ctrl-"+i),t.metaKey&&(i="Meta-"+i),e&&t.shiftKey&&(i="Shift-"+i),i}function Pm(i){return new X({props:{handleKeyDown:du(i)}})}function du(i){let t=Aw(i);return function(e,n){let r=Nm(n),o,s=t[uu(r,n)];if(s&&s(e.state,e.dispatch,e))return!0;if(r.length==1&&r!=" "){if(n.shiftKey){let a=t[uu(r,n,!1)];if(a&&a(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Lw&&n.ctrlKey&&n.altKey)&&(o=Nn[n.keyCode])&&o!=r){let a=t[uu(o,n)];if(a&&a(e.state,e.dispatch,e))return!0}}return!1}}var Iw=Object.defineProperty,bu=(i,t)=>{for(var e in t)Iw(i,e,{get:t[e],enumerable:!0})};function Ds(i){let{state:t,transaction:e}=i,{selection:n}=e,{doc:r}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return n},get doc(){return r},get tr(){return n=e.selection,r=e.doc,o=e.storedMarks,e}}}var Bs=class{constructor(i){this.editor=i.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=i.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:i,editor:t,state:e}=this,{view:n}=t,{tr:r}=e,o=this.buildProps(r);return Object.fromEntries(Object.entries(i).map(([s,a])=>[s,(...c)=>{let u=a(...c)(o);return!r.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(r),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(i,t=!0){let{rawCommands:e,editor:n,state:r}=this,{view:o}=n,s=[],a=!!i,l=i||r.tr,c=()=>(!a&&t&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(l),s.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(e).map(([d,h])=>[d,(...p)=>{let m=this.buildProps(l,t),g=h(...p)(m);return s.push(g),u}])),run:c};return u}createCan(i){let{rawCommands:t,state:e}=this,n=!1,r=i||e.tr,o=this.buildProps(r,n);return{...Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...c)=>l(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(r,n)}}buildProps(i,t=!0){let{rawCommands:e,editor:n,state:r}=this,{view:o}=n,s={tr:i,editor:n,view:o,state:Ds({state:r,transaction:i}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(i,t),can:()=>this.createCan(i),get commands(){return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)(s)]))}};return s}},$m={};bu($m,{blur:()=>Nw,clearContent:()=>Pw,clearNodes:()=>_w,command:()=>Ow,createParagraphNear:()=>Dw,cut:()=>Bw,deleteCurrentNode:()=>Fw,deleteNode:()=>Hw,deleteRange:()=>zw,deleteSelection:()=>Vw,enter:()=>$w,exitCode:()=>Ww,extendMarkRange:()=>Uw,first:()=>Kw,focus:()=>Gw,forEach:()=>jw,insertContent:()=>Yw,insertContentAt:()=>Zw,joinBackward:()=>t1,joinDown:()=>e1,joinForward:()=>n1,joinItemBackward:()=>i1,joinItemForward:()=>r1,joinTextblockBackward:()=>o1,joinTextblockForward:()=>s1,joinUp:()=>Qw,keyboardShortcut:()=>l1,lift:()=>c1,liftEmptyBlock:()=>u1,liftListItem:()=>d1,newlineInCode:()=>h1,resetAttributes:()=>p1,scrollIntoView:()=>f1,selectAll:()=>m1,selectNodeBackward:()=>g1,selectNodeForward:()=>b1,selectParentNode:()=>y1,selectTextblockEnd:()=>v1,selectTextblockStart:()=>E1,setContent:()=>x1,setMark:()=>B1,setMeta:()=>F1,setNode:()=>H1,setNodeSelection:()=>z1,setTextDirection:()=>V1,setTextSelection:()=>$1,sinkListItem:()=>W1,splitBlock:()=>U1,splitListItem:()=>K1,toggleList:()=>q1,toggleMark:()=>G1,toggleNode:()=>j1,toggleWrap:()=>Y1,undoInputRule:()=>X1,unsetAllMarks:()=>J1,unsetMark:()=>Z1,unsetTextDirection:()=>Q1,updateAttributes:()=>eM,wrapIn:()=>tM,wrapInList:()=>nM});var Nw=()=>({editor:i,view:t})=>(requestAnimationFrame(()=>{var e;i.isDestroyed||(t.dom.blur(),(e=window==null?void 0:window.getSelection())==null||e.removeAllRanges())}),!0),Pw=(i=!0)=>({commands:t})=>t.setContent("",{emitUpdate:i}),_w=()=>({state:i,tr:t,dispatch:e})=>{let{selection:n}=t,{ranges:r}=n;return e&&r.forEach(({$from:o,$to:s})=>{i.doc.nodesBetween(o.pos,s.pos,(a,l)=>{if(a.type.isText)return;let{doc:c,mapping:u}=t,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;let p=wn(f);if(a.type.isTextblock){let{defaultType:m}=d.parent.contentMatchAt(d.index());t.setNodeMarkup(f.start,m)}(p||p===0)&&t.lift(f,p)})}),!0},Ow=i=>t=>i(t),Dw=()=>({state:i,dispatch:t})=>Lc(i,t),Bw=(i,t)=>({editor:e,tr:n})=>{let{state:r}=e,o=r.doc.slice(i.from,i.to);n.deleteRange(i.from,i.to);let s=n.mapping.map(t);return n.insert(s,o.content),n.setSelection(new G(n.doc.resolve(Math.max(s-1,0)))),!0},Fw=()=>({tr:i,dispatch:t})=>{let{selection:e}=i,n=e.$anchor.node();if(n.content.size>0)return!1;let r=i.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===n.type){if(t){let a=r.before(o),l=r.after(o);i.delete(a,l).scrollIntoView()}return!0}return!1};function Fe(i,t){if(typeof i=="string"){if(!t.nodes[i])throw Error(`There is no node type named '${i}'. Maybe you forgot to add the extension?`);return t.nodes[i]}return i}var Hw=i=>({tr:t,state:e,dispatch:n})=>{let r=Fe(i,e.schema),o=t.selection.$anchor;for(let s=o.depth;s>0;s-=1)if(o.node(s).type===r){if(n){let l=o.before(s),c=o.after(s);t.delete(l,c).scrollIntoView()}return!0}return!1},zw=i=>({tr:t,dispatch:e})=>{let{from:n,to:r}=i;return e&&t.delete(n,r),!0},Vw=()=>({state:i,dispatch:t})=>bs(i,t),$w=()=>({commands:i})=>i.keyboardShortcut("Enter"),Ww=()=>({state:i,dispatch:t})=>Cc(i,t);function yu(i){return Object.prototype.toString.call(i)==="[object RegExp]"}function _s(i,t,e={strict:!0}){let n=Object.keys(t);return n.length?n.every(r=>e.strict?t[r]===i[r]:yu(t[r])?t[r].test(i[r]):t[r]===i[r]):!0}function Wm(i,t,e={}){return i.find(n=>n.type===t&&_s(Object.fromEntries(Object.keys(e).map(r=>[r,n.attrs[r]])),e))}function _m(i,t,e={}){return!!Wm(i,t,e)}function vu(i,t,e){var n;if(!i||!t)return;let r=i.parent.childAfter(i.parentOffset);if((!r.node||!r.node.marks.some(u=>u.type===t))&&(r=i.parent.childBefore(i.parentOffset)),!r.node||!r.node.marks.some(u=>u.type===t)||(e=e||((n=r.node.marks[0])==null?void 0:n.attrs),!Wm([...r.node.marks],t,e)))return;let s=r.index,a=i.start()+r.offset,l=s+1,c=a+r.node.nodeSize;for(;s>0&&_m([...i.parent.child(s-1).marks],t,e);)s-=1,a-=i.parent.child(s).nodeSize;for(;l<i.parent.childCount&&_m([...i.parent.child(l).marks],t,e);)c+=i.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Pn(i,t){if(typeof i=="string"){if(!t.marks[i])throw Error(`There is no mark type named '${i}'. Maybe you forgot to add the extension?`);return t.marks[i]}return i}var Uw=(i,t={})=>({tr:e,state:n,dispatch:r})=>{let o=Pn(i,n.schema),{doc:s,selection:a}=e,{$from:l,from:c,to:u}=a;if(r){let d=vu(l,o,t);if(d&&d.from<=c&&d.to>=u){let h=G.create(s,d.from,d.to);e.setSelection(h)}}return!0},Kw=i=>t=>{let e=typeof i=="function"?i(t):i;for(let n=0;n<e.length;n+=1)if(e[n](t))return!0;return!1};function Um(i){return i instanceof G}function Ri(i=0,t=0,e=0){return Math.min(Math.max(i,t),e)}function Km(i,t=null){if(!t)return null;let e=re.atStart(i),n=re.atEnd(i);if(t==="start"||t===!0)return e;if(t==="end")return n;let r=e.from,o=n.to;return t==="all"?G.create(i,Ri(0,r,o),Ri(i.content.size,r,o)):G.create(i,Ri(t,r,o),Ri(t,r,o))}function qw(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Eu(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Gw=(i=null,t={})=>({editor:e,view:n,tr:r,dispatch:o})=>{t={scrollIntoView:!0,...t};let s=()=>{(Eu()||qw())&&n.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(n.focus(),t!=null&&t.scrollIntoView&&e.commands.scrollIntoView())})};if(n.hasFocus()&&i===null||i===!1)return!0;if(o&&i===null&&!Um(e.state.selection))return s(),!0;let a=Km(r.doc,i)||e.state.selection,l=e.state.selection.eq(a);return o&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),s()),!0},jw=(i,t)=>e=>i.every((n,r)=>t(n,{...e,index:r})),Yw=(i,t)=>({tr:e,commands:n})=>n.insertContentAt({from:e.selection.from,to:e.selection.to},i,t),qm=i=>{let t=i.childNodes;for(let e=t.length-1;e>=0;e-=1){let n=t[e];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?i.removeChild(n):n.nodeType===1&&qm(n)}return i};function Rs(i){if(typeof window=="undefined")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");let t=`<body>${i}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return qm(e)}function so(i,t,e){if(i instanceof tt||i instanceof z)return i;e={slice:!0,parseOptions:{},...e};let n=typeof i=="object"&&i!==null,r=typeof i=="string";if(n)try{if(Array.isArray(i)&&i.length>0)return z.fromArray(i.map(a=>t.nodeFromJSON(a)));let s=t.nodeFromJSON(i);return e.errorOnInvalidContent&&s.check(),s}catch(o){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",i,"Error:",o),so("",t,e)}if(r){if(e.errorOnInvalidContent){let s=!1,a="",l=new qi({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(s=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(e.slice?nt.fromSchema(l).parseSlice(Rs(i),e.parseOptions):nt.fromSchema(l).parse(Rs(i),e.parseOptions),e.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}let o=nt.fromSchema(t);return e.slice?o.parseSlice(Rs(i),e.parseOptions).content:o.parse(Rs(i),e.parseOptions)}return so("",t,e)}function Xw(i,t,e){let n=i.steps.length-1;if(n<t)return;let r=i.steps[n];if(!(r instanceof De||r instanceof _e))return;let o=i.mapping.maps[n],s=0;o.forEach((a,l,c,u)=>{s===0&&(s=u)}),i.setSelection(re.near(i.doc.resolve(s),e))}var Jw=i=>!("type"in i),Zw=(i,t,e)=>({tr:n,dispatch:r,editor:o})=>{var s;if(r){e={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let a,l=g=>{o.emit("contentError",{editor:o,error:g,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{so(t,o.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=so(t,o.schema,{parseOptions:c,errorOnInvalidContent:(s=e.errorOnInvalidContent)!=null?s:o.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof i=="number"?{from:i,to:i}:{from:i.from,to:i.to},h=!0,f=!0;if((Jw(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){let{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(t))m=t.map(g=>g.text||"").join("");else if(t instanceof z){let g="";t.forEach(b=>{b.text&&(g+=b.text)}),m=g}else typeof t=="object"&&t&&t.text?m=t.text:m=t;n.insertText(m,u,d)}else{m=a;let g=n.doc.resolve(u),b=g.node(),v=g.parentOffset===0,y=b.isText||b.isTextblock,E=b.content.size>0;v&&y&&E&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}e.updateSelection&&Xw(n,n.steps.length-1,-1),e.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),e.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},Qw=()=>({state:i,dispatch:t})=>pf(i,t),e1=()=>({state:i,dispatch:t})=>ff(i,t),t1=()=>({state:i,dispatch:t})=>vc(i,t),n1=()=>({state:i,dispatch:t})=>Sc(i,t),i1=()=>({state:i,dispatch:t,tr:e})=>{try{let n=vi(i.doc,i.selection.$from.pos,-1);return n==null?!1:(e.join(n,2),t&&t(e),!0)}catch(n){return!1}},r1=()=>({state:i,dispatch:t,tr:e})=>{try{let n=vi(i.doc,i.selection.$from.pos,1);return n==null?!1:(e.join(n,2),t&&t(e),!0)}catch(n){return!1}},o1=()=>({state:i,dispatch:t})=>cf(i,t),s1=()=>({state:i,dispatch:t})=>uf(i,t);function Gm(){return typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1}function a1(i){let t=i.split(/-(?!$)/),e=t[t.length-1];e==="Space"&&(e=" ");let n,r,o,s;for(let a=0;a<t.length-1;a+=1){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))Eu()||Gm()?s=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(e=`Alt-${e}`),r&&(e=`Ctrl-${e}`),s&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}var l1=i=>({editor:t,view:e,tr:n,dispatch:r})=>{let o=a1(i).split(/-(?!$)/),s=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{e.someProp("handleKeyDown",c=>c(e,a))});return l==null||l.steps.forEach(c=>{let u=c.map(n.mapping);u&&r&&n.maybeStep(u)}),!0};function dn(i,t,e={}){let{from:n,to:r,empty:o}=i.selection,s=t?Fe(t,i.schema):null,a=[];i.doc.nodesBetween(n,r,(d,h)=>{if(d.isText)return;let f=Math.max(n,h),p=Math.min(r,h+d.nodeSize);a.push({node:d,from:f,to:p})});let l=r-n,c=a.filter(d=>s?s.name===d.node.type.name:!0).filter(d=>_s(d.node.attrs,e,{strict:!1}));return o?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var c1=(i,t={})=>({state:e,dispatch:n})=>{let r=Fe(i,e.schema);return dn(e,r,t)?mf(e,n):!1},u1=()=>({state:i,dispatch:t})=>Rc(i,t),d1=i=>({state:t,dispatch:e})=>{let n=Fe(i,t.schema);return xf(n)(t,e)},h1=()=>({state:i,dispatch:t})=>Mc(i,t);function Fs(i,t){return t.nodes[i]?"node":t.marks[i]?"mark":null}function Om(i,t){let e=typeof t=="string"?[t]:t;return Object.keys(i).reduce((n,r)=>(e.includes(r)||(n[r]=i[r]),n),{})}var p1=(i,t)=>({tr:e,state:n,dispatch:r})=>{let o=null,s=null,a=Fs(typeof i=="string"?i:i.name,n.schema);if(!a)return!1;a==="node"&&(o=Fe(i,n.schema)),a==="mark"&&(s=Pn(i,n.schema));let l=!1;return e.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{o&&o===u.type&&(l=!0,r&&e.setNodeMarkup(d,void 0,Om(u.attrs,t))),s&&u.marks.length&&u.marks.forEach(h=>{s===h.type&&(l=!0,r&&e.addMark(d,d+u.nodeSize,s.create(Om(h.attrs,t))))})})}),l},f1=()=>({tr:i,dispatch:t})=>(t&&i.scrollIntoView(),!0),m1=()=>({tr:i,dispatch:t})=>{if(t){let e=new qe(i.doc);i.setSelection(e)}return!0},g1=()=>({state:i,dispatch:t})=>Ec(i,t),b1=()=>({state:i,dispatch:t})=>kc(i,t),y1=()=>({state:i,dispatch:t})=>gf(i,t),v1=()=>({state:i,dispatch:t})=>Ic(i,t),E1=()=>({state:i,dispatch:t})=>Ac(i,t);function mu(i,t,e={},n={}){return so(i,t,{slice:!1,parseOptions:e,errorOnInvalidContent:n.errorOnInvalidContent})}var x1=(i,{errorOnInvalidContent:t,emitUpdate:e=!0,parseOptions:n={}}={})=>({editor:r,tr:o,dispatch:s,commands:a})=>{let{doc:l}=o;if(n.preserveWhitespace!=="full"){let c=mu(i,r.schema,n,{errorOnInvalidContent:t!=null?t:r.options.enableContentCheck});return s&&o.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!e),!0}return s&&o.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:l.content.size},i,{parseOptions:n,errorOnInvalidContent:t!=null?t:r.options.enableContentCheck})};function jm(i,t){let e=Pn(t,i.schema),{from:n,to:r,empty:o}=i.selection,s=[];o?(i.storedMarks&&s.push(...i.storedMarks),s.push(...i.selection.$head.marks())):i.doc.nodesBetween(n,r,l=>{s.push(...l.marks)});let a=s.find(l=>l.type.name===e.name);return a?{...a.attrs}:{}}function xu(i,t){let e=new ji(i);return t.forEach(n=>{n.steps.forEach(r=>{e.step(r)})}),e}function S1(i){for(let t=0;t<i.edgeCount;t+=1){let{type:e}=i.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function Hs(i,t){let e=[];return i.descendants((n,r)=>{t(n)&&e.push({node:n,pos:r})}),e}function Ym(i,t,e){let n=[];return i.nodesBetween(t.from,t.to,(r,o)=>{e(r)&&n.push({node:r,pos:o})}),n}function k1(i,t){for(let e=i.depth;e>0;e-=1){let n=i.node(e);if(t(n))return{pos:e>0?i.before(e):0,start:i.start(e),depth:e,node:n}}}function zs(i){return t=>k1(t.$from,i)}function Z(i,t,e){return i.config[t]===void 0&&i.parent?Z(i.parent,t,e):typeof i.config[t]=="function"?i.config[t].bind({...e,parent:i.parent?Z(i.parent,t,e):null}):i.config[t]}function Su(i){return i.map(t=>{let e={name:t.name,options:t.options,storage:t.storage},n=Z(t,"addExtensions",e);return n?[t,...Su(n())]:t}).flat(10)}function ku(i,t){let e=Rt.fromSchema(t).serializeFragment(i),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(e),r.innerHTML}function Xm(i){return typeof i=="function"}function we(i,t=void 0,...e){return Xm(i)?t?i.bind(t)(...e):i(...e):i}function w1(i={}){return Object.keys(i).length===0&&i.constructor===Object}function hr(i){let t=i.filter(r=>r.type==="extension"),e=i.filter(r=>r.type==="node"),n=i.filter(r=>r.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:n}}function Jm(i){let t=[],{nodeExtensions:e,markExtensions:n}=hr(i),r=[...e,...n],o={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return i.forEach(s=>{let a={name:s.name,options:s.options,storage:s.storage,extensions:r},l=Z(s,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,f])=>{t.push({type:d,name:h,attribute:{...o,...f}})})})})}),r.forEach(s=>{let a={name:s.name,options:s.options,storage:s.storage},l=Z(s,"addAttributes",a);if(!l)return;let c=l();Object.entries(c).forEach(([u,d])=>{let h={...o,...d};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,t.push({type:s.name,name:u,attribute:h})})}),t}function pe(...i){return i.filter(t=>!!t).reduce((t,e)=>{let n={...t};return Object.entries(e).forEach(([r,o])=>{if(!n[r]){n[r]=o;return}if(r==="class"){let a=o?String(o).split(" "):[],l=n[r]?n[r].split(" "):[],c=a.filter(u=>!l.includes(u));n[r]=[...l,...c].join(" ")}else if(r==="style"){let a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[r]?n[r].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{let[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{let[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[r]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[r]=o}),n},{})}function Os(i,t){return t.filter(e=>e.type===i.type.name).filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(i.attrs)||{}:{[e.name]:i.attrs[e.name]}).reduce((e,n)=>pe(e,n),{})}function M1(i){return typeof i!="string"?i:i.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(i):i==="true"?!0:i==="false"?!1:i}function Dm(i,t){return"style"in i?i:{...i,getAttrs:e=>{let n=i.getAttrs?i.getAttrs(e):i.attrs;if(n===!1)return!1;let r=t.reduce((o,s)=>{let a=s.attribute.parseHTML?s.attribute.parseHTML(e):M1(e.getAttribute(s.name));return a==null?o:{...o,[s.name]:a}},{});return{...n,...r}}}}function Bm(i){return Object.fromEntries(Object.entries(i).filter(([t,e])=>t==="attrs"&&w1(e)?!1:e!=null))}function Fm(i){var t,e;let n={};return!((t=i==null?void 0:i.attribute)!=null&&t.isRequired)&&"default"in((i==null?void 0:i.attribute)||{})&&(n.default=i.attribute.default),((e=i==null?void 0:i.attribute)==null?void 0:e.validate)!==void 0&&(n.validate=i.attribute.validate),[i.name,n]}function T1(i,t){var e;let n=Jm(i),{nodeExtensions:r,markExtensions:o}=hr(i),s=(e=r.find(c=>Z(c,"topNode")))==null?void 0:e.name,a=Object.fromEntries(r.map(c=>{let u=n.filter(b=>b.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:t},h=i.reduce((b,v)=>{let y=Z(v,"extendNodeSchema",d);return{...b,...y?y(c):{}}},{}),f=Bm({...h,content:we(Z(c,"content",d)),marks:we(Z(c,"marks",d)),group:we(Z(c,"group",d)),inline:we(Z(c,"inline",d)),atom:we(Z(c,"atom",d)),selectable:we(Z(c,"selectable",d)),draggable:we(Z(c,"draggable",d)),code:we(Z(c,"code",d)),whitespace:we(Z(c,"whitespace",d)),linebreakReplacement:we(Z(c,"linebreakReplacement",d)),defining:we(Z(c,"defining",d)),isolating:we(Z(c,"isolating",d)),attrs:Object.fromEntries(u.map(Fm))}),p=we(Z(c,"parseHTML",d));p&&(f.parseDOM=p.map(b=>Dm(b,u)));let m=Z(c,"renderHTML",d);m&&(f.toDOM=b=>m({node:b,HTMLAttributes:Os(b,u)}));let g=Z(c,"renderText",d);return g&&(f.toText=g),[c.name,f]})),l=Object.fromEntries(o.map(c=>{let u=n.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:t},h=i.reduce((g,b)=>{let v=Z(b,"extendMarkSchema",d);return{...g,...v?v(c):{}}},{}),f=Bm({...h,inclusive:we(Z(c,"inclusive",d)),excludes:we(Z(c,"excludes",d)),group:we(Z(c,"group",d)),spanning:we(Z(c,"spanning",d)),code:we(Z(c,"code",d)),attrs:Object.fromEntries(u.map(Fm))}),p=we(Z(c,"parseHTML",d));p&&(f.parseDOM=p.map(g=>Dm(g,u)));let m=Z(c,"renderHTML",d);return m&&(f.toDOM=g=>m({mark:g,HTMLAttributes:Os(g,u)})),[c.name,f]}));return new qi({topNode:s,nodes:a,marks:l})}function C1(i){let t=i.filter((e,n)=>i.indexOf(e)!==n);return Array.from(new Set(t))}function wu(i){return i.sort((e,n)=>{let r=Z(e,"priority")||100,o=Z(n,"priority")||100;return r>o?-1:r<o?1:0})}function Zm(i){let t=wu(Su(i)),e=C1(t.map(n=>n.name));return e.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${e.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),t}function Qm(i,t,e){let{from:n,to:r}=t,{blockSeparator:o=`

`,textSerializers:s={}}=e||{},a="";return i.nodesBetween(n,r,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=o);let f=s==null?void 0:s[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:t})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)==null?void 0:h.slice(Math.max(n,c)-c,r-c))}),a}function L1(i,t){let e={from:0,to:i.content.size};return Qm(i,e,t)}function eg(i){return Object.fromEntries(Object.entries(i.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}function R1(i,t){let e=Fe(t,i.schema),{from:n,to:r}=i.selection,o=[];i.doc.nodesBetween(n,r,a=>{o.push(a)});let s=o.reverse().find(a=>a.type.name===e.name);return s?{...s.attrs}:{}}function Mu(i,t){let e=Fs(typeof t=="string"?t:t.name,i.schema);return e==="node"?R1(i,t):e==="mark"?jm(i,t):{}}function A1(i,t=JSON.stringify){let e={};return i.filter(n=>{let r=t(n);return Object.prototype.hasOwnProperty.call(e,r)?!1:e[r]=!0})}function I1(i){let t=A1(i);return t.length===1?t:t.filter((e,n)=>!t.filter((o,s)=>s!==n).some(o=>e.oldRange.from>=o.oldRange.from&&e.oldRange.to<=o.oldRange.to&&e.newRange.from>=o.newRange.from&&e.newRange.to<=o.newRange.to))}function Tu(i){let{mapping:t,steps:e}=i,n=[];return t.maps.forEach((r,o)=>{let s=[];if(r.ranges.length)r.forEach((a,l)=>{s.push({from:a,to:l})});else{let{from:a,to:l}=e[o];if(a===void 0||l===void 0)return;s.push({from:a,to:l})}s.forEach(({from:a,to:l})=>{let c=t.slice(o).map(a,-1),u=t.slice(o).map(l),d=t.invert().map(c,-1),h=t.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),I1(n)}function Vs(i,t,e){let n=[];return i===t?e.resolve(i).marks().forEach(r=>{let o=e.resolve(i),s=vu(o,r.type);s&&n.push({mark:r,...s})}):e.nodesBetween(i,t,(r,o)=>{!r||(r==null?void 0:r.nodeSize)===void 0||n.push(...r.marks.map(s=>({from:o,to:o+r.nodeSize,mark:s})))}),n}var tg=(i,t,e,n=20)=>{let r=i.doc.resolve(e),o=n,s=null;for(;o>0&&s===null;){let a=r.node(o);(a==null?void 0:a.type.name)===t?s=a:o-=1}return[s,o]};function hu(i,t){return t.nodes[i]||t.marks[i]||null}function Ps(i,t,e){return Object.fromEntries(Object.entries(e).filter(([n])=>{let r=i.find(o=>o.type===t&&o.name===n);return r?r.attribute.keepOnSplit:!1}))}var N1=(i,t=500)=>{let e="",n=i.parentOffset;return i.parent.nodesBetween(Math.max(0,n-t),n,(r,o,s,a)=>{var l,c;let u=((c=(l=r.type.spec).toText)==null?void 0:c.call(l,{node:r,pos:o,parent:s,index:a}))||r.textContent||"%leaf%";e+=r.isAtom&&!r.isText?u:u.slice(0,Math.max(0,n-o))}),e};function gu(i,t,e={}){let{empty:n,ranges:r}=i.selection,o=t?Pn(t,i.schema):null;if(n)return!!(i.storedMarks||i.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>_s(d.attrs,e,{strict:!1}));let s=0,a=[];if(r.forEach(({$from:d,$to:h})=>{let f=d.pos,p=h.pos;i.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;let b=Math.max(f,g),v=Math.min(p,g+m.nodeSize),y=v-b;s+=y,a.push(...m.marks.map(E=>({mark:E,from:b,to:v})))})}),s===0)return!1;let l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>_s(d.mark.attrs,e,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=s}function P1(i,t,e={}){if(!t)return dn(i,null,e)||gu(i,null,e);let n=Fs(t,i.schema);return n==="node"?dn(i,t,e):n==="mark"?gu(i,t,e):!1}var ng=(i,t)=>{let{$from:e,$to:n,$anchor:r}=i.selection;if(t){let o=zs(a=>a.type.name===t)(i.selection);if(!o)return!1;let s=i.doc.resolve(o.pos+1);return r.pos+1===s.end()}return!(n.parentOffset<n.parent.nodeSize-2||e.pos!==n.pos)},ig=i=>{let{$from:t,$to:e}=i.selection;return!(t.parentOffset>0||t.pos!==e.pos)};function Hm(i,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===i.name):t}function zm(i,t){let{nodeExtensions:e}=hr(t),n=e.find(s=>s.name===i);if(!n)return!1;let r={name:n.name,options:n.options,storage:n.storage},o=we(Z(n,"group",r));return typeof o!="string"?!1:o.split(" ").includes("list")}function ao(i,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var n;if(e){if(i.type.name==="hardBreak")return!0;if(i.isText)return/^\s*$/m.test((n=i.text)!=null?n:"")}if(i.isText)return!i.text;if(i.isAtom||i.isLeaf)return!1;if(i.content.childCount===0)return!0;if(t){let r=!0;return i.content.forEach(o=>{r!==!1&&(ao(o,{ignoreWhitespace:e,checkChildren:t})||(r=!1))}),r}return!1}function $s(i){return i instanceof Y}var rg=class og{constructor(t){this.position=t}static fromJSON(t){return new og(t.position)}toJSON(){return{position:this.position}}};function _1(i,t){let e=t.mapping.mapResult(i.position);return{position:new rg(e.pos),mapResult:e}}function O1(i){return new rg(i)}function D1(i,t,e){var n;let{selection:r}=t,o=null;if(Um(r)&&(o=r.$cursor),o){let a=(n=i.storedMarks)!=null?n:o.marks();return o.parent.type.allowsMarkType(e)&&(!!e.isInSet(a)||!a.some(c=>c.type.excludes(e)))}let{ranges:s}=r;return s.some(({$from:a,$to:l})=>{let c=a.depth===0?i.doc.inlineContent&&i.doc.type.allowsMarkType(e):!1;return i.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){let f=!h||h.type.allowsMarkType(e),p=!!e.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(e));c=f&&p}return!c}),c})}var B1=(i,t={})=>({tr:e,state:n,dispatch:r})=>{let{selection:o}=e,{empty:s,ranges:a}=o,l=Pn(i,n.schema);if(r)if(s){let c=jm(n,l);e.addStoredMark(l.create({...c,...t}))}else a.forEach(c=>{let u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{let p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(b=>b.type===l)?h.marks.forEach(b=>{l===b.type&&e.addMark(p,m,l.create({...b.attrs,...t}))}):e.addMark(p,m,l.create(t))})});return D1(n,e,l)},F1=(i,t)=>({tr:e})=>(e.setMeta(i,t),!0),H1=(i,t={})=>({state:e,dispatch:n,chain:r})=>{let o=Fe(i,e.schema),s;return e.selection.$anchor.sameParent(e.selection.$head)&&(s=e.selection.$anchor.parent.attrs),o.isTextblock?r().command(({commands:a})=>Nc(o,{...s,...t})(e)?!0:a.clearNodes()).command(({state:a})=>Nc(o,{...s,...t})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},z1=i=>({tr:t,dispatch:e})=>{if(e){let{doc:n}=t,r=Ri(i,0,n.content.size),o=Y.create(n,r);t.setSelection(o)}return!0},V1=(i,t)=>({tr:e,state:n,dispatch:r})=>{let{selection:o}=n,s,a;return typeof t=="number"?(s=t,a=t):t&&"from"in t&&"to"in t?(s=t.from,a=t.to):(s=o.from,a=o.to),r&&e.doc.nodesBetween(s,a,(l,c)=>{l.isText||e.setNodeMarkup(c,void 0,{...l.attrs,dir:i})}),!0},$1=i=>({tr:t,dispatch:e})=>{if(e){let{doc:n}=t,{from:r,to:o}=typeof i=="number"?{from:i,to:i}:i,s=G.atStart(n).from,a=G.atEnd(n).to,l=Ri(r,s,a),c=Ri(o,s,a),u=G.create(n,l,c);t.setSelection(u)}return!0},W1=i=>({state:t,dispatch:e})=>{let n=Fe(i,t.schema);return Sf(n)(t,e)};function Vm(i,t){let e=i.storedMarks||i.selection.$to.parentOffset&&i.selection.$from.marks();if(e){let n=e.filter(r=>t==null?void 0:t.includes(r.type.name));i.tr.ensureMarks(n)}}var U1=({keepMarks:i=!0}={})=>({tr:t,state:e,dispatch:n,editor:r})=>{let{selection:o,doc:s}=t,{$from:a,$to:l}=o,c=r.extensionManager.attributes,u=Ps(c,a.node().type.name,a.node().attrs);if(o instanceof Y&&o.node.isBlock)return!a.parentOffset||!At(s,a.pos)?!1:(n&&(i&&Vm(e,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;let d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:S1(a.node(-1).contentMatchAt(a.indexAfter(-1))),f=d&&h?[{type:h,attrs:u}]:void 0,p=At(t.doc,t.mapping.map(a.pos),1,f);if(!f&&!p&&At(t.doc,t.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(o instanceof G&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){let m=t.mapping.map(a.before()),g=t.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&t.setNodeMarkup(t.mapping.map(a.before()),h)}i&&Vm(e,r.extensionManager.splittableMarks),t.scrollIntoView()}return p},K1=(i,t={})=>({tr:e,state:n,dispatch:r,editor:o})=>{var s;let a=Fe(i,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;let d=l.node(-1);if(d.type!==a)return!1;let h=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let b=z.empty,v=l.index(-1)?1:l.index(-2)?2:3;for(let k=l.depth-v;k>=l.depth-3;k-=1)b=z.from(l.node(k).copy(b));let y=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,E={...Ps(h,l.node().type.name,l.node().attrs),...t},x=((s=a.contentMatch.defaultType)==null?void 0:s.createAndFill(E))||void 0;b=b.append(z.from(a.createAndFill(null,x)||void 0));let S=l.before(l.depth-(v-1));e.replace(S,l.after(-y),new q(b,4-v,0));let w=-1;e.doc.nodesBetween(S,e.doc.content.size,(k,M)=>{if(w>-1)return!1;k.isTextblock&&k.content.size===0&&(w=M+1)}),w>-1&&e.setSelection(G.near(e.doc.resolve(w))),e.scrollIntoView()}return!0}let f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Ps(h,d.type.name,d.attrs),...t},m={...Ps(h,l.node().type.name,l.node().attrs),...t};e.delete(l.pos,c.pos);let g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!At(e.doc,l.pos,2))return!1;if(r){let{selection:b,storedMarks:v}=n,{splittableMarks:y}=o.extensionManager,E=v||b.$to.parentOffset&&b.$from.marks();if(e.split(l.pos,2,g).scrollIntoView(),!E||!r)return!0;let x=E.filter(S=>y.includes(S.type.name));e.ensureMarks(x)}return!0},pu=(i,t)=>{let e=zs(s=>s.type===t)(i.selection);if(!e)return!0;let n=i.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(n===void 0)return!0;let r=i.doc.nodeAt(n);return e.node.type===(r==null?void 0:r.type)&&Ot(i.doc,e.pos)&&i.join(e.pos),!0},fu=(i,t)=>{let e=zs(s=>s.type===t)(i.selection);if(!e)return!0;let n=i.doc.resolve(e.start).after(e.depth);if(n===void 0)return!0;let r=i.doc.nodeAt(n);return e.node.type===(r==null?void 0:r.type)&&Ot(i.doc,n)&&i.join(n),!0},q1=(i,t,e,n={})=>({editor:r,tr:o,state:s,dispatch:a,chain:l,commands:c,can:u})=>{let{extensions:d,splittableMarks:h}=r.extensionManager,f=Fe(i,s.schema),p=Fe(t,s.schema),{selection:m,storedMarks:g}=s,{$from:b,$to:v}=m,y=b.blockRange(v),E=g||m.$to.parentOffset&&m.$from.marks();if(!y)return!1;let x=zs(S=>zm(S.type.name,d))(m);if(y.depth>=1&&x&&y.depth-x.depth<=1){if(x.node.type===f)return c.liftListItem(p);if(zm(x.node.type.name,d)&&f.validContent(x.node.content)&&a)return l().command(()=>(o.setNodeMarkup(x.pos,f),!0)).command(()=>pu(o,f)).command(()=>fu(o,f)).run()}return!e||!E||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>pu(o,f)).command(()=>fu(o,f)).run():l().command(()=>{let S=u().wrapInList(f,n),w=E.filter(k=>h.includes(k.type.name));return o.ensureMarks(w),S?!0:c.clearNodes()}).wrapInList(f,n).command(()=>pu(o,f)).command(()=>fu(o,f)).run()},G1=(i,t={},e={})=>({state:n,commands:r})=>{let{extendEmptyMarkRange:o=!1}=e,s=Pn(i,n.schema);return gu(n,s,t)?r.unsetMark(s,{extendEmptyMarkRange:o}):r.setMark(s,t)},j1=(i,t,e={})=>({state:n,commands:r})=>{let o=Fe(i,n.schema),s=Fe(t,n.schema),a=dn(n,o,e),l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?r.setNode(s,l):r.setNode(o,{...l,...e})},Y1=(i,t={})=>({state:e,commands:n})=>{let r=Fe(i,e.schema);return dn(e,r,t)?n.lift(r):n.wrapIn(r,t)},X1=()=>({state:i,dispatch:t})=>{let e=i.plugins;for(let n=0;n<e.length;n+=1){let r=e[n],o;if(r.spec.isInputRules&&(o=r.getState(i))){if(t){let s=i.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)s.step(a.steps[l].invert(a.docs[l]));if(o.text){let l=s.doc.resolve(o.from).marks();s.replaceWith(o.from,o.to,i.schema.text(o.text,l))}else s.delete(o.from,o.to)}return!0}}return!1},J1=()=>({tr:i,dispatch:t})=>{let{selection:e}=i,{empty:n,ranges:r}=e;return n||t&&r.forEach(o=>{i.removeMark(o.$from.pos,o.$to.pos)}),!0},Z1=(i,t={})=>({tr:e,state:n,dispatch:r})=>{var o;let{extendEmptyMarkRange:s=!1}=t,{selection:a}=e,l=Pn(i,n.schema),{$from:c,empty:u,ranges:d}=a;if(!r)return!0;if(u&&s){let{from:h,to:f}=a,p=(o=c.marks().find(g=>g.type===l))==null?void 0:o.attrs,m=vu(c,l,p);m&&(h=m.from,f=m.to),e.removeMark(h,f,l)}else d.forEach(h=>{e.removeMark(h.$from.pos,h.$to.pos,l)});return e.removeStoredMark(l),!0},Q1=i=>({tr:t,state:e,dispatch:n})=>{let{selection:r}=e,o,s;return typeof i=="number"?(o=i,s=i):i&&"from"in i&&"to"in i?(o=i.from,s=i.to):(o=r.from,s=r.to),n&&t.doc.nodesBetween(o,s,(a,l)=>{if(a.isText)return;let c={...a.attrs};delete c.dir,t.setNodeMarkup(l,void 0,c)}),!0},eM=(i,t={})=>({tr:e,state:n,dispatch:r})=>{let o=null,s=null,a=Fs(typeof i=="string"?i:i.name,n.schema);if(!a)return!1;a==="node"&&(o=Fe(i,n.schema)),a==="mark"&&(s=Pn(i,n.schema));let l=!1;return e.selection.ranges.forEach(c=>{let u=c.$from.pos,d=c.$to.pos,h,f,p,m;e.selection.empty?n.doc.nodesBetween(u,d,(g,b)=>{o&&o===g.type&&(l=!0,p=Math.max(b,u),m=Math.min(b+g.nodeSize,d),h=b,f=g)}):n.doc.nodesBetween(u,d,(g,b)=>{b<u&&o&&o===g.type&&(l=!0,p=Math.max(b,u),m=Math.min(b+g.nodeSize,d),h=b,f=g),b>=u&&b<=d&&(o&&o===g.type&&(l=!0,r&&e.setNodeMarkup(b,void 0,{...g.attrs,...t})),s&&g.marks.length&&g.marks.forEach(v=>{if(s===v.type&&(l=!0,r)){let y=Math.max(b,u),E=Math.min(b+g.nodeSize,d);e.addMark(y,E,s.create({...v.attrs,...t}))}}))}),f&&(h!==void 0&&r&&e.setNodeMarkup(h,void 0,{...f.attrs,...t}),s&&f.marks.length&&f.marks.forEach(g=>{s===g.type&&r&&e.addMark(p,m,s.create({...g.attrs,...t}))}))}),l},tM=(i,t={})=>({state:e,dispatch:n})=>{let r=Fe(i,e.schema);return vf(r,t)(e,n)},nM=(i,t={})=>({state:e,dispatch:n})=>{let r=Fe(i,e.schema);return Ef(r,t)(e,n)},iM=class{constructor(){this.callbacks={}}on(i,t){return this.callbacks[i]||(this.callbacks[i]=[]),this.callbacks[i].push(t),this}emit(i,...t){let e=this.callbacks[i];return e&&e.forEach(n=>n.apply(this,t)),this}off(i,t){let e=this.callbacks[i];return e&&(t?this.callbacks[i]=e.filter(n=>n!==t):delete this.callbacks[i]),this}once(i,t){let e=(...n)=>{this.off(i,e),t.apply(this,n)};return this.on(i,e)}removeAllListeners(){this.callbacks={}}},pr=class{constructor(i){var t;this.find=i.find,this.handler=i.handler,this.undoable=(t=i.undoable)!=null?t:!0}},rM=(i,t)=>{if(yu(t))return t.exec(i);let e=t(i);if(!e)return null;let n=[e.text];return n.index=e.index,n.input=i,n.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(e.replaceWith)),n};function As(i){var t;let{editor:e,from:n,to:r,text:o,rules:s,plugin:a}=i,{view:l}=e;if(l.composing)return!1;let c=l.state.doc.resolve(n);if(c.parent.type.spec.code||(t=c.nodeBefore||c.nodeAfter)!=null&&t.marks.find(h=>h.type.spec.code))return!1;let u=!1,d=N1(c)+o;return s.forEach(h=>{if(u)return;let f=rM(d,h.find);if(!f)return;let p=l.state.tr,m=Ds({state:l.state,transaction:p}),g={from:n-(f[0].length-o.length),to:r},{commands:b,chain:v,can:y}=new Bs({editor:e,state:m});h.handler({state:m,range:g,match:f,commands:b,chain:v,can:y})===null||!p.steps.length||(h.undoable&&p.setMeta(a,{transform:p,from:n,to:r,text:o}),l.dispatch(p),u=!0)}),u}function oM(i){let{editor:t,rules:e}=i,n=new X({state:{init(){return null},apply(r,o,s){let a=r.getMeta(n);if(a)return a;let l=r.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=ku(z.from(u),s.schema);let{from:d}=l,h=d+u.length;As({editor:t,from:d,to:h,text:u,rules:e,plugin:n})}),r.selectionSet||r.docChanged?null:o}},props:{handleTextInput(r,o,s,a){return As({editor:t,from:o,to:s,text:a,rules:e,plugin:n})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{let{$cursor:o}=r.state.selection;o&&As({editor:t,from:o.pos,to:o.pos,text:"",rules:e,plugin:n})}),!1)},handleKeyDown(r,o){if(o.key!=="Enter")return!1;let{$cursor:s}=r.state.selection;return s?As({editor:t,from:s.pos,to:s.pos,text:`
`,rules:e,plugin:n}):!1}},isInputRules:!0});return n}function sM(i){return Object.prototype.toString.call(i).slice(8,-1)}function Is(i){return sM(i)!=="Object"?!1:i.constructor===Object&&Object.getPrototypeOf(i)===Object.prototype}function sg(i,t){let e={...i};return Is(i)&&Is(t)&&Object.keys(t).forEach(n=>{Is(t[n])&&Is(i[n])?e[n]=sg(i[n],t[n]):e[n]=t[n]}),e}var Cu=class{constructor(i={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...i},this.name=this.config.name}get options(){return{...we(Z(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...we(Z(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(i={}){let t=this.extend({...this.config,addOptions:()=>sg(this.options,i)});return t.name=this.name,t.parent=this.parent,t}extend(i={}){let t=new this.constructor({...this.config,...i});return t.parent=this,this.child=t,t.name="name"in i?i.name:t.parent.name,t}},Ve=class ag extends Cu{constructor(){super(...arguments),this.type="mark"}static create(t={}){let e=typeof t=="function"?t():t;return new ag(e)}static handleExit({editor:t,mark:e}){let{tr:n}=t.state,r=t.state.selection.$from;if(r.pos===r.end()){let s=r.marks();if(!!!s.find(c=>(c==null?void 0:c.type.name)===e.name))return!1;let l=s.find(c=>(c==null?void 0:c.type.name)===e.name);return l&&n.removeStoredMark(l),n.insertText(" ",r.pos),t.view.dispatch(n),!0}return!1}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}};function aM(i){return typeof i=="number"}var lM=class{constructor(i){this.find=i.find,this.handler=i.handler}},cM=(i,t,e)=>{if(yu(t))return[...i.matchAll(t)];let n=t(i,e);return n?n.map(r=>{let o=[r.text];return o.index=r.index,o.input=i,o.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(r.replaceWith)),o}):[]};function uM(i){let{editor:t,state:e,from:n,to:r,rule:o,pasteEvent:s,dropEvent:a}=i,{commands:l,chain:c,can:u}=new Bs({editor:t,state:e}),d=[];return e.doc.nodesBetween(n,r,(f,p)=>{var m,g,b,v,y;if((g=(m=f.type)==null?void 0:m.spec)!=null&&g.code||!(f.isText||f.isTextblock||f.isInline))return;let E=(y=(v=(b=f.content)==null?void 0:b.size)!=null?v:f.nodeSize)!=null?y:0,x=Math.max(n,p),S=Math.min(r,p+E);if(x>=S)return;let w=f.isText?f.text||"":f.textBetween(x-p,S-p,void 0,"\uFFFC");cM(w,o.find,s).forEach(M=>{if(M.index===void 0)return;let L=x+M.index+1,_=L+M[0].length,P={from:e.tr.mapping.map(L),to:e.tr.mapping.map(_)},I=o.handler({state:e,range:P,match:M,commands:l,chain:c,can:u,pasteEvent:s,dropEvent:a});d.push(I)})}),d.every(f=>f!==null)}var Ns=null,dM=i=>{var t;let e=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=e.clipboardData)==null||t.setData("text/html",i),e};function hM(i){let{editor:t,rules:e}=i,n=null,r=!1,o=!1,s=typeof ClipboardEvent!="undefined"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent!="undefined"?new DragEvent("drop"):null}catch(u){a=null}let l=({state:u,from:d,to:h,rule:f,pasteEvt:p})=>{let m=u.tr,g=Ds({state:u,transaction:m});if(!(!uM({editor:t,state:g,from:Math.max(d-1,0),to:h.b-1,rule:f,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent!="undefined"?new DragEvent("drop"):null}catch(v){a=null}return s=typeof ClipboardEvent!="undefined"?new ClipboardEvent("paste"):null,m}};return e.map(u=>new X({view(d){let h=p=>{var m;n=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,n&&(Ns=t)},f=()=>{Ns&&(Ns=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,h)=>{if(o=n===d.dom.parentElement,a=h,!o){let f=Ns;f!=null&&f.isEditable&&setTimeout(()=>{let p=f.state.selection;p&&f.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,h)=>{var f;let p=(f=h.clipboardData)==null?void 0:f.getData("text/html");return s=h,r=!!(p!=null&&p.includes("data-pm-slice")),!1}}},appendTransaction:(d,h,f)=>{let p=d[0],m=p.getMeta("uiEvent")==="paste"&&!r,g=p.getMeta("uiEvent")==="drop"&&!o,b=p.getMeta("applyPasteRules"),v=!!b;if(!m&&!g&&!v)return;if(v){let{text:x}=b;typeof x=="string"?x=x:x=ku(z.from(x),f.schema);let{from:S}=b,w=S+x.length,k=dM(x);return l({rule:u,state:f,from:S,to:{b:w},pasteEvt:k})}let y=h.doc.content.findDiffStart(f.doc.content),E=h.doc.content.findDiffEnd(f.doc.content);if(!(!aM(y)||!E||y===E.b))return l({rule:u,state:f,from:y,to:E,pasteEvt:s})}}))}var Ws=class{constructor(i,t){this.splittableMarks=[],this.editor=t,this.baseExtensions=i,this.extensions=Zm(i),this.schema=T1(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((i,t)=>{let e={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:hu(t.name,this.schema)},n=Z(t,"addCommands",e);return n?{...i,...n()}:i},{})}get plugins(){let{editor:i}=this;return wu([...this.extensions].reverse()).flatMap(n=>{let r={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:i,type:hu(n.name,this.schema)},o=[],s=Z(n,"addKeyboardShortcuts",r),a={};if(n.type==="mark"&&Z(n,"exitable",r)&&(a.ArrowRight=()=>Ve.handleExit({editor:i,mark:n})),s){let h=Object.fromEntries(Object.entries(s()).map(([f,p])=>[f,()=>p({editor:i})]));a={...a,...h}}let l=Pm(a);o.push(l);let c=Z(n,"addInputRules",r);if(Hm(n,i.options.enableInputRules)&&c){let h=c();if(h&&h.length){let f=oM({editor:i,rules:h}),p=Array.isArray(f)?f:[f];o.push(...p)}}let u=Z(n,"addPasteRules",r);if(Hm(n,i.options.enablePasteRules)&&u){let h=u();if(h&&h.length){let f=hM({editor:i,rules:h});o.push(...f)}}let d=Z(n,"addProseMirrorPlugins",r);if(d){let h=d();o.push(...h)}return o})}get attributes(){return Jm(this.extensions)}get nodeViews(){let{editor:i}=this,{nodeExtensions:t}=hr(this.extensions);return Object.fromEntries(t.filter(e=>!!Z(e,"addNodeView")).map(e=>{let n=this.attributes.filter(l=>l.type===e.name),r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:i,type:Fe(e.name,this.schema)},o=Z(e,"addNodeView",r);if(!o)return[];let s=o();if(!s)return[];let a=(l,c,u,d,h)=>{let f=Os(l,n);return s({node:l,view:c,getPos:u,decorations:d,innerDecorations:h,editor:i,extension:e,HTMLAttributes:f})};return[e.name,a]}))}get markViews(){let{editor:i}=this,{markExtensions:t}=hr(this.extensions);return Object.fromEntries(t.filter(e=>!!Z(e,"addMarkView")).map(e=>{let n=this.attributes.filter(a=>a.type===e.name),r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:i,type:Pn(e.name,this.schema)},o=Z(e,"addMarkView",r);if(!o)return[];let s=(a,l,c)=>{let u=Os(a,n);return o()({mark:a,view:l,inline:c,editor:i,extension:e,HTMLAttributes:u,updateAttributes:d=>{MM(a,i,d)}})};return[e.name,s]}))}setupExtensions(){let i=this.extensions;this.editor.extensionStorage=Object.fromEntries(i.map(t=>[t.name,t.storage])),i.forEach(t=>{var e;let n={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:hu(t.name,this.schema)};t.type==="mark"&&((e=we(Z(t,"keepOnSplit",n)))==null||e)&&this.splittableMarks.push(t.name);let r=Z(t,"onBeforeCreate",n),o=Z(t,"onCreate",n),s=Z(t,"onUpdate",n),a=Z(t,"onSelectionUpdate",n),l=Z(t,"onTransaction",n),c=Z(t,"onFocus",n),u=Z(t,"onBlur",n),d=Z(t,"onDestroy",n);r&&this.editor.on("beforeCreate",r),o&&this.editor.on("create",o),s&&this.editor.on("update",s),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};Ws.resolve=Zm;Ws.sort=wu;Ws.flatten=Su;var pM={};bu(pM,{ClipboardTextSerializer:()=>cg,Commands:()=>ug,Delete:()=>dg,Drop:()=>hg,Editable:()=>pg,FocusEvents:()=>mg,Keymap:()=>gg,Paste:()=>bg,Tabindex:()=>yg,TextDirection:()=>vg,focusEventsPluginKey:()=>fg});var ue=class lg extends Cu{constructor(){super(...arguments),this.type="extension"}static create(t={}){let e=typeof t=="function"?t():t;return new lg(e)}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}},cg=ue.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new X({key:new se("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:i}=this,{state:t,schema:e}=i,{doc:n,selection:r}=t,{ranges:o}=r,s=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),l=eg(e);return Qm(n,{from:s,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),ug=ue.create({name:"commands",addCommands(){return{...$m}}}),dg=ue.create({name:"delete",onUpdate({transaction:i,appendedTransactions:t}){var e,n,r;let o=()=>{var s,a,l,c;if((c=(l=(a=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,i))!=null?c:i.getMeta("y-sync$"))return;let u=xu(i.before,[i,...t]);Tu(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{let g=m+p.nodeSize-2,b=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!b,editor:this.editor,transaction:i,combinedTransform:u})})});let h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Et){let b=h.slice(p).map(f.from,-1),v=h.slice(p).map(f.to),y=h.invert().map(b,-1),E=h.invert().map(v),x=(m=u.doc.nodeAt(b-1))==null?void 0:m.marks.some(w=>w.eq(f.mark)),S=(g=u.doc.nodeAt(v))==null?void 0:g.marks.some(w=>w.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:y,to:E},newRange:{from:b,to:v},partial:Boolean(S||x),editor:this.editor,transaction:i,combinedTransform:u})}})};(r=(n=(e=this.editor.options.coreExtensionOptions)==null?void 0:e.delete)==null?void 0:n.async)==null||r?setTimeout(o,0):o()}}),hg=ue.create({name:"drop",addProseMirrorPlugins(){return[new X({key:new se("tiptapDrop"),props:{handleDrop:(i,t,e,n)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:n})}}})]}}),pg=ue.create({name:"editable",addProseMirrorPlugins(){return[new X({key:new se("editable"),props:{editable:()=>this.editor.options.editable}})]}}),fg=new se("focusEvents"),mg=ue.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:i}=this;return[new X({key:fg,props:{handleDOMEvents:{focus:(t,e)=>{i.isFocused=!0;let n=i.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(n),!1},blur:(t,e)=>{i.isFocused=!1;let n=i.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(n),!1}}}})]}}),gg=ue.create({name:"keymap",addKeyboardShortcuts(){let i=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:a})=>{let{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,b=m&&p.parent.childCount===1?g===d.pos:re.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!b||b&&d.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:i,"Mod-Backspace":i,"Shift-Backspace":i,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},r={...n},o={...n,"Ctrl-h":i,"Alt-Backspace":i,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Eu()||Gm()?o:r},addProseMirrorPlugins(){return[new X({key:new se("clearDocument"),appendTransaction:(i,t,e)=>{if(i.some(m=>m.getMeta("composition")))return;let n=i.some(m=>m.docChanged)&&!t.doc.eq(e.doc),r=i.some(m=>m.getMeta("preventClearDocument"));if(!n||r)return;let{empty:o,from:s,to:a}=t.selection,l=re.atStart(t.doc).from,c=re.atEnd(t.doc).to;if(o||!(s===l&&a===c)||!ao(e.doc))return;let h=e.tr,f=Ds({state:e,transaction:h}),{commands:p}=new Bs({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),bg=ue.create({name:"paste",addProseMirrorPlugins(){return[new X({key:new se("tiptapPaste"),props:{handlePaste:(i,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),yg=ue.create({name:"tabindex",addProseMirrorPlugins(){return[new X({key:new se("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),vg=ue.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:i}=hr(this.extensions);return[{types:i.filter(t=>t.name!=="text").map(t=>t.name),attributes:{dir:{default:this.options.direction,parseHTML:t=>{let e=t.getAttribute("dir");return e&&(e==="ltr"||e==="rtl"||e==="auto")?e:this.options.direction},renderHTML:t=>t.dir?{dir:t.dir}:{}}}}]},addProseMirrorPlugins(){return[new X({key:new se("textDirection"),props:{attributes:()=>{let i=this.options.direction;return i?{dir:i}:{}}}})]}}),fM=class dr{constructor(t,e,n=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=t,this.editor=e,this.currentNode=r}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!=null?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}e=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:e,to:n},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;let t=this.resolvedPos.start(this.resolvedPos.depth-1),e=this.resolvedPos.doc.resolve(t);return new dr(e,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new dr(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new dr(t,this.editor)}get children(){let t=[];return this.node.content.forEach((e,n)=>{let r=e.isBlock&&!e.isTextblock,o=e.isAtom&&!e.isText,s=this.pos+n+(o?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;let a=this.resolvedPos.doc.resolve(s);if(!r&&a.depth<=this.depth)return;let l=new dr(a,this.editor,r,r?e:null);r&&(l.actualDepth=this.depth+1),t.push(new dr(a,this.editor,r,r?e:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){let t=this.children;return t[t.length-1]||null}closest(t,e={}){let n=null,r=this.parent;for(;r&&!n;){if(r.node.type.name===t)if(Object.keys(e).length>0){let o=r.node.attrs,s=Object.keys(e);for(let a=0;a<s.length;a+=1){let l=s[a];if(o[l]!==e[l])break}}else n=r;r=r.parent}return n}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},n=!1){let r=[];if(!this.children||this.children.length===0)return r;let o=Object.keys(e);return this.children.forEach(s=>{n&&r.length>0||(s.node.type.name===t&&o.every(l=>e[l]===s.node.attrs[l])&&r.push(s),!(n&&r.length>0)&&(r=r.concat(s.querySelectorAll(t,e,n))))}),r}setAttribute(t){let{tr:e}=this.editor.state;e.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(e)}},mM=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function gM(i,t,e){let n=document.querySelector(`style[data-tiptap-style${e?`-${e}`:""}]`);if(n!==null)return n;let r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute(`data-tiptap-style${e?`-${e}`:""}`,""),r.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(r),r}var Eg=class extends iM{constructor(i={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document!="undefined"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:_1,createMappablePosition:O1},this.setOptions(i),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:o})=>this.options.onDrop(n,r,o)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),this.on("delete",this.options.onDelete);let t=this.createDoc(),e=Km(t,this.options.autofocus);this.editorState=Mn.create({doc:t,schema:this.schema,selection:e||void 0}),this.options.element&&this.mount(this.options.element)}mount(i){if(typeof document=="undefined")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(i),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){let i=this.editorView.dom;i!=null&&i.editor&&delete i.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(i){console.warn("Failed to remove CSS element:",i)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document!="undefined"&&(this.css=gM(mM,this.options.injectNonce))}setOptions(i={}){this.options={...this.options,...i},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(i,t=!0){this.setOptions({editable:i}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:i=>{this.editorState=i},dispatch:i=>{this.dispatchTransaction(i)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(i,t)=>{if(this.editorView)return this.editorView[t];if(t==="state")return this.editorState;if(t in i)return Reflect.get(i,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(i,t){let e=Xm(t)?t(i,[...this.state.plugins]):[...this.state.plugins,i],n=this.state.reconfigure({plugins:e});return this.view.updateState(n),n}unregisterPlugin(i){if(this.isDestroyed)return;let t=this.state.plugins,e=t;if([].concat(i).forEach(r=>{let o=typeof r=="string"?`${r}$`:r.key;e=e.filter(s=>!s.key.startsWith(o))}),t.length===e.length)return;let n=this.state.reconfigure({plugins:e});return this.view.updateState(n),n}createExtensionManager(){var i,t;let n=[...this.options.enableCoreExtensions?[pg,cg.configure({blockSeparator:(t=(i=this.options.coreExtensionOptions)==null?void 0:i.clipboardTextSerializer)==null?void 0:t.blockSeparator}),ug,mg,gg,yg,hg,bg,dg,vg.configure({direction:this.options.textDirection})].filter(r=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[r.name]!==!1:!0):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new Ws(n,this)}createCommandManager(){this.commandManager=new Bs({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let i;try{i=mu(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(e=>e.name!=="collaboration"),this.createExtensionManager()}}),i=mu(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return i}createView(i){var t;this.editorView=new io(i,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)==null?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});let e=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(e),this.prependClass(),this.injectCSS();let n=this.view.dom;n.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(i){this.isCapturingTransaction=!0,i(),this.isCapturingTransaction=!1;let t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(i){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=i;return}i.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}let{state:t,transactions:e}=this.state.applyTransaction(i),n=!this.state.selection.eq(t.selection),r=e.includes(i),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:i,nextState:t}),!r)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:i,appendedTransactions:e.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:i});let s=e.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=s==null?void 0:s.getMeta("focus"),l=s==null?void 0:s.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(i.getMeta("preventUpdate")||!e.some(c=>c.docChanged)||o.doc.eq(t.doc))&&this.emit("update",{editor:this,transaction:i,appendedTransactions:e.slice(1)})}getAttributes(i){return Mu(this.state,i)}isActive(i,t){let e=typeof i=="string"?i:null,n=typeof i=="string"?t:i;return P1(this.state,e,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return ku(this.state.doc.content,this.schema)}getText(i){let{blockSeparator:t=`

`,textSerializers:e={}}=i||{};return L1(this.state.doc,{blockSeparator:t,textSerializers:{...eg(this.schema),...e}})}get isEmpty(){return ao(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var i,t;return(t=(i=this.editorView)==null?void 0:i.isDestroyed)!=null?t:!0}$node(i,t){var e;return((e=this.$doc)==null?void 0:e.querySelector(i,t))||null}$nodes(i,t){var e;return((e=this.$doc)==null?void 0:e.querySelectorAll(i,t))||null}$pos(i){let t=this.state.doc.resolve(i);return new fM(t,this)}get $doc(){return this.$pos(0)}};function zt(i){return new pr({find:i.find,handler:({state:t,range:e,match:n})=>{let r=we(i.getAttributes,void 0,n);if(r===!1||r===null)return null;let{tr:o}=t,s=n[n.length-1],a=n[0];if(s){let l=a.search(/\S/),c=e.from+a.indexOf(s),u=c+s.length;if(Vs(e.from,e.to,t.doc).filter(f=>f.mark.type.excluded.find(m=>m===i.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;u<e.to&&o.delete(u,e.to),c>e.from&&o.delete(e.from+l,c);let h=e.from+l+s.length;o.addMark(e.from+l,h,i.type.create(r||{})),o.removeStoredMark(i.type)}},undoable:i.undoable})}function xg(i){return new pr({find:i.find,handler:({state:t,range:e,match:n})=>{let r=we(i.getAttributes,void 0,n)||{},{tr:o}=t,s=e.from,a=e.to,l=i.type.create(r);if(n[1]){let c=n[0].lastIndexOf(n[1]),u=s+c;u>a?u=a:a=u+n[1].length;let d=n[0][n[0].length-1];o.insertText(d,s+n[0].length-1),o.replaceWith(u,a,l)}else if(n[0]){let c=i.type.isInline?s:s-1;o.insert(c,i.type.create(r)).delete(o.mapping.map(s),o.mapping.map(a))}o.scrollIntoView()},undoable:i.undoable})}function lo(i){return new pr({find:i.find,handler:({state:t,range:e,match:n})=>{let r=t.doc.resolve(e.from),o=we(i.getAttributes,void 0,n)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),i.type))return null;t.tr.delete(e.from,e.to).setBlockType(e.from,e.from,i.type,o)},undoable:i.undoable})}function hn(i){return new pr({find:i.find,handler:({state:t,range:e,match:n,chain:r})=>{let o=we(i.getAttributes,void 0,n)||{},s=t.tr.delete(e.from,e.to),l=s.doc.resolve(e.from).blockRange(),c=l&&Yi(l,i.type,o);if(!c)return null;if(s.wrap(l,c),i.keepMarks&&i.editor){let{selection:d,storedMarks:h}=t,{splittableMarks:f}=i.editor.extensionManager,p=h||d.$to.parentOffset&&d.$from.marks();if(p){let m=p.filter(g=>f.includes(g.type.name));s.ensureMarks(m)}}if(i.keepAttributes){let d=i.type.name==="bulletList"||i.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(d,o).run()}let u=s.doc.resolve(e.from-1).nodeBefore;u&&u.type===i.type&&Ot(s.doc,e.from-1)&&(!i.joinPredicate||i.joinPredicate(n,u))&&s.join(e.from-1)},undoable:i.undoable})}function Sg(i,t){let{selection:e}=i,{$from:n}=e;if(e instanceof Y){let o=n.index();return n.parent.canReplaceWith(o,o+1,t)}let r=n.depth;for(;r>=0;){let o=n.index(r);if(n.node(r).contentMatchAt(o).matchType(t))return!0;r-=1}return!1}var bM={};bu(bM,{createAtomBlockMarkdownSpec:()=>yM,createBlockMarkdownSpec:()=>vM,createInlineMarkdownSpec:()=>SM,parseAttributes:()=>Lu,parseIndentedBlocks:()=>kM,renderNestedMarkdownContent:()=>wM,serializeAttributes:()=>Ru});function Lu(i){if(!(i!=null&&i.trim()))return{};let t={},e=[],n=i.replace(/["']([^"']*)["']/g,c=>(e.push(c),`__QUOTED_${e.length-1}__`)),r=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(r){let c=r.map(u=>u.trim().slice(1));t.class=c.join(" ")}let o=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);o&&(t.id=o[1]);let s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(s)).forEach(([,c,u])=>{var d;let h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=e[h];f&&(t[c]=f.slice(1,-1))});let l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(t[u]=!0)}),t}function Ru(i){if(!i||Object.keys(i).length===0)return"";let t=[];return i.class&&String(i.class).split(/\s+/).filter(Boolean).forEach(n=>t.push(`.${n}`)),i.id&&t.push(`#${i.id}`),Object.entries(i).forEach(([e,n])=>{e==="class"||e==="id"||(n===!0?t.push(e):n!==!1&&n!=null&&t.push(`${e}="${String(n)}"`))}),t.join(" ")}function yM(i){let{nodeName:t,name:e,parseAttributes:n=Lu,serializeAttributes:r=Ru,defaultAttributes:o={},requiredAttributes:s=[],allowedAttributes:a}=i,l=e||t,c=u=>{if(!a)return u;let d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{let h={...o,...u.attributes};return d.createNode(t,h,[])},markdownTokenizer:{name:t,level:"block",start(u){var d;let h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){let f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;let m=p[1]||"",g=n(m);if(!s.find(v=>!(v in g)))return{type:t,raw:p[0],attributes:g}}},renderMarkdown:u=>{let d=c(u.attrs||{}),h=r(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function vM(i){let{nodeName:t,name:e,getContent:n,parseAttributes:r=Lu,serializeAttributes:o=Ru,defaultAttributes:s={},content:a="block",allowedAttributes:l}=i,c=e||t,u=d=>{if(!l)return d;let h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){let m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);let p={...s,...d.attributes};return h.createNode(t,p,f)},markdownTokenizer:{name:t,level:"block",start(d){var h;let f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;let m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;let[b,v=""]=g,y=r(v),E=1,x=b.length,S="",w=/^:::([\w-]*)(\s.*)?/gm,k=d.slice(x);for(w.lastIndex=0;;){let M=w.exec(k);if(M===null)break;let L=M.index,_=M[1];if(!((p=M[2])!=null&&p.endsWith(":::"))){if(_)E+=1;else if(E-=1,E===0){let P=k.slice(0,L);S=P.trim();let I=d.slice(0,x+L+M[0].length),N=[];if(S)if(a==="block")for(N=f.blockTokens(P),N.forEach(D=>{D.text&&(!D.tokens||D.tokens.length===0)&&(D.tokens=f.inlineTokens(D.text))});N.length>0;){let D=N[N.length-1];if(D.type==="paragraph"&&(!D.text||D.text.trim()===""))N.pop();else break}else N=f.inlineTokens(S);return{type:t,raw:I,attributes:y,content:S,tokens:N}}}}}},renderMarkdown:(d,h)=>{let f=u(d.attrs||{}),p=o(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function EM(i){if(!i.trim())return{};let t={},e=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,n=e.exec(i);for(;n!==null;){let[,r,o,s]=n;t[r]=o||s,n=e.exec(i)}return t}function xM(i){return Object.entries(i).filter(([,t])=>t!=null).map(([t,e])=>`${t}="${e}"`).join(" ")}function SM(i){let{nodeName:t,name:e,getContent:n,parseAttributes:r=EM,serializeAttributes:o=xM,defaultAttributes:s={},selfClosing:a=!1,allowedAttributes:l}=i,c=e||t,u=h=>{if(!l)return h;let f={};return l.forEach(p=>{let m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){let b=h[m];if(g!==void 0&&b===g)return;f[m]=b}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{let p={...s,...h.attributes};if(a)return f.createNode(t,p);let m=n?n(h):h.content||"";return m?f.createNode(t,p,[f.createTextNode(m)]):f.createNode(t,p,[])},markdownTokenizer:{name:t,level:"inline",start(h){let f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p==null?void 0:p.index;return m!==void 0?m:-1},tokenize(h,f,p){let m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let b="",v="";if(a){let[,E]=g;v=E}else{let[,E,x]=g;v=E,b=x||""}let y=r(v.trim());return{type:t,raw:g[0],content:b.trim(),attributes:y}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(b=>b.type==="text").map(b=>b.text).join(""));let p=u(h.attrs||{}),m=o(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function kM(i,t,e){var n,r,o,s;let a=i.split(`
`),l=[],c="",u=0,d=t.baseIndentSize||2;for(;u<a.length;){let h=a[u],f=h.match(t.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}let p=t.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;let b=[g];for(u+=1;u<a.length;){let x=a[u];if(x.trim()===""){let w=a.slice(u+1).findIndex(L=>L.trim()!=="");if(w===-1)break;if((((r=(n=a[u+1+w].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:r.length)||0)>m){b.push(x),c=`${c}${x}
`,u+=1;continue}else break}if((((s=(o=x.match(/^(\s*)/))==null?void 0:o[1])==null?void 0:s.length)||0)>m)b.push(x),c=`${c}${x}
`,u+=1;else break}let v,y=b.slice(1);if(y.length>0){let x=y.map(S=>S.slice(m+d)).join(`
`);x.trim()&&(t.customNestedParser?v=t.customNestedParser(x):v=e.blockTokens(x))}let E=t.createToken(p,v);l.push(E)}if(l.length!==0)return{items:l,raw:c}}function wM(i,t,e,n){if(!i||!Array.isArray(i.content))return"";let r=typeof e=="function"?e(n):e,[o,...s]=i.content,a=t.renderChildren([o]),l=[`${r}${a}`];return s&&s.length>0&&s.forEach(c=>{let u=t.renderChildren([c]);if(u){let d=u.split(`
`).map(h=>h?t.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}function MM(i,t,e={}){let{state:n}=t,{doc:r,tr:o}=n,s=i;r.descendants((a,l)=>{let c=o.mapping.map(l),u=o.mapping.map(l)+a.nodeSize,d=null;if(a.marks.forEach(f=>{if(f!==s)return!1;d=f}),!d)return;let h=!1;if(Object.keys(e).forEach(f=>{e[f]!==d.attrs[f]&&(h=!0)}),h){let f=i.type.create({...i.attrs,...e});o.removeMark(c,u,i.type),o.addMark(c,u,f)}}),o.docChanged&&t.view.dispatch(o)}var Se=class kg extends Cu{constructor(){super(...arguments),this.type="node"}static create(t={}){let e=typeof t=="function"?t():t;return new kg(e)}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}};function St(i){return new lM({find:i.find,handler:({state:t,range:e,match:n,pasteEvent:r})=>{let o=we(i.getAttributes,void 0,n,r);if(o===!1||o===null)return null;let{tr:s}=t,a=n[n.length-1],l=n[0],c=e.to;if(a){let u=l.search(/\S/),d=e.from+l.indexOf(a),h=d+a.length;if(Vs(e.from,e.to,t.doc).filter(p=>p.mark.type.excluded.find(g=>g===i.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;h<e.to&&s.delete(h,e.to),d>e.from&&s.delete(e.from+u,d),c=e.from+u+a.length,s.addMark(e.from+u,c,i.type.create(o||{})),s.removeStoredMark(i.type)}}})}var fr=(i,t)=>{if(i==="slot")return 0;if(i instanceof Function)return i(t);let{children:e,...n}=t!=null?t:{};if(i==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[i,n,e]};var TM=/^\s*>\s$/,Au=Se.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:i}){return fr("blockquote",{...pe(this.options.HTMLAttributes,i),children:fr("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:i})=>i.wrapIn(this.name),toggleBlockquote:()=>({commands:i})=>i.toggleWrap(this.name),unsetBlockquote:()=>({commands:i})=>i.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[hn({find:TM,type:this.type})]}}),wg=Au;var CM=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,LM=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,RM=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,AM=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Iu=Ve.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:i=>i.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:i=>i.type.name===this.name},{style:"font-weight",getAttrs:i=>/^(bold(er)?|[5-9]\d{2,})$/.test(i)&&null}]},renderHTML({HTMLAttributes:i}){return fr("strong",{...pe(this.options.HTMLAttributes,i),children:fr("slot",{})})},addCommands(){return{setBold:()=>({commands:i})=>i.setMark(this.name),toggleBold:()=>({commands:i})=>i.toggleMark(this.name),unsetBold:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[zt({find:CM,type:this.type}),zt({find:RM,type:this.type})]},addPasteRules(){return[St({find:LM,type:this.type}),St({find:AM,type:this.type})]}}),Mg=Iu;var IM=/(^|[^`])`([^`]+)`(?!`)$/,NM=/(^|[^`])`([^`]+)`(?!`)/g,Nu=Ve.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:i}){return["code",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{setCode:()=>({commands:i})=>i.setMark(this.name),toggleCode:()=>({commands:i})=>i.toggleMark(this.name),unsetCode:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[zt({find:IM,type:this.type})]},addPasteRules(){return[St({find:NM,type:this.type})]}}),Tg=Nu;var PM=/^```([a-z]+)?[\s\n]$/,_M=/^~~~([a-z]+)?[\s\n]$/,Pu=Se.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:i=>{var t;let{languageClassPrefix:e}=this.options,o=[...((t=i.firstElementChild)==null?void 0:t.classList)||[]].filter(s=>s.startsWith(e)).map(s=>s.replace(e,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:i,HTMLAttributes:t}){return["pre",pe(this.options.HTMLAttributes,t),["code",{class:i.attrs.language?this.options.languageClassPrefix+i.attrs.language:null},0]]},addCommands(){return{setCodeBlock:i=>({commands:t})=>t.setNode(this.name,i),toggleCodeBlock:i=>({commands:t})=>t.toggleNode(this.name,"paragraph",i)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:i,$anchor:t}=this.editor.state.selection,e=t.pos===1;return!i||t.parent.type.name!==this.name?!1:e||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:i})=>{if(!this.options.enableTabIndentation)return!1;let{state:t}=i,{selection:e}=t,{$from:n,empty:r}=e;if(n.parent.type!==this.type)return!1;let o=" ".repeat(this.options.tabSize);return r?i.commands.insertContent(o):i.commands.command(({tr:s})=>{let{from:a,to:l}=e,d=t.doc.textBetween(a,l,`
`,`
`).split(`
`).map(h=>o+h).join(`
`);return s.replaceWith(a,l,t.schema.text(d)),!0})},"Shift-Tab":({editor:i})=>{if(!this.options.enableTabIndentation)return!1;let{state:t}=i,{selection:e}=t,{$from:n,empty:r}=e;return n.parent.type!==this.type?!1:r?i.commands.command(({tr:o})=>{var s;let{pos:a}=n,l=n.start(),c=n.end(),d=t.doc.textBetween(l,c,`
`,`
`).split(`
`),h=0,f=0,p=a-l;for(let E=0;E<d.length;E+=1){if(f+d[E].length>=p){h=E;break}f+=d[E].length+1}let g=((s=d[h].match(/^ */))==null?void 0:s[0])||"",b=Math.min(g.length,this.options.tabSize);if(b===0)return!0;let v=l;for(let E=0;E<h;E+=1)v+=d[E].length+1;return o.delete(v,v+b),a-v<=b&&o.setSelection(G.create(o.doc,v)),!0}):i.commands.command(({tr:o})=>{let{from:s,to:a}=e,u=t.doc.textBetween(s,a,`
`,`
`).split(`
`).map(d=>{var h;let f=((h=d.match(/^ */))==null?void 0:h[0])||"",p=Math.min(f.length,this.options.tabSize);return d.slice(p)}).join(`
`);return o.replaceWith(s,a,t.schema.text(u)),!0})},Enter:({editor:i})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:t}=i,{selection:e}=t,{$from:n,empty:r}=e;if(!r||n.parent.type!==this.type)return!1;let o=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!o||!s?!1:i.chain().command(({tr:a})=>(a.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:i})=>{if(!this.options.exitOnArrowDown)return!1;let{state:t}=i,{selection:e,doc:n}=t,{$from:r,empty:o}=e;if(!o||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;let a=r.after();return a===void 0?!1:n.nodeAt(a)?i.commands.command(({tr:c})=>(c.setSelection(re.near(n.resolve(a))),!0)):i.commands.exitCode()}}},addInputRules(){return[lo({find:PM,type:this.type,getAttributes:i=>({language:i[1]})}),lo({find:_M,type:this.type,getAttributes:i=>({language:i[1]})})]},addProseMirrorPlugins(){return[new X({key:new se("codeBlockVSCodeHandler"),props:{handlePaste:(i,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;let e=t.clipboardData.getData("text/plain"),n=t.clipboardData.getData("vscode-editor-data"),r=n?JSON.parse(n):void 0,o=r==null?void 0:r.mode;if(!e||!o)return!1;let{tr:s,schema:a}=i.state,l=a.text(e.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:o},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(G.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),i.dispatch(s),!0}}})]}}),Cg=Pu;var _u=Se.create({name:"doc",topNode:!0,content:"block+"}),Lg=_u;var Ou=Se.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:i}){return["br",pe(this.options.HTMLAttributes,i)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:i,chain:t,state:e,editor:n})=>i.first([()=>i.exitCode(),()=>i.command(()=>{let{selection:r,storedMarks:o}=e;if(r.$from.parent.type.spec.isolating)return!1;let{keepMarks:s}=this.options,{splittableMarks:a}=n.extensionManager,l=o||r.$to.parentOffset&&r.$from.marks();return t().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&s){let d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Rg=Ou;var Du=Se.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(i=>({tag:`h${i}`,attrs:{level:i}}))},renderHTML({node:i,HTMLAttributes:t}){return[`h${this.options.levels.includes(i.attrs.level)?i.attrs.level:this.options.levels[0]}`,pe(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:i=>({commands:t})=>this.options.levels.includes(i.level)?t.setNode(this.name,i):!1,toggleHeading:i=>({commands:t})=>this.options.levels.includes(i.level)?t.toggleNode(this.name,"paragraph",i):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((i,t)=>({...i,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(i=>lo({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${i}})\\s$`),type:this.type,getAttributes:{level:i}}))}}),Ag=Du;var Bu=Se.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:i}){return["hr",pe(this.options.HTMLAttributes,i)]},addCommands(){return{setHorizontalRule:()=>({chain:i,state:t})=>{if(!Sg(t,t.schema.nodes[this.name]))return!1;let{selection:e}=t,{$to:n}=e,r=i();return $s(e)?r.insertContentAt(n.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({tr:o,dispatch:s})=>{var a;if(s){let{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(G.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(Y.create(o.doc,l.pos)):o.setSelection(G.create(o.doc,l.pos));else{let u=(a=l.parent.type.contentMatch.defaultType)==null?void 0:a.create();u&&(o.insert(c,u),o.setSelection(G.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[xg({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),Ig=Bu;var OM=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,DM=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,BM=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,FM=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Fu=Ve.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:i=>i.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:i=>i.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:i}){return["em",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{setItalic:()=>({commands:i})=>i.setMark(this.name),toggleItalic:()=>({commands:i})=>i.toggleMark(this.name),unsetItalic:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[zt({find:OM,type:this.type}),zt({find:BM,type:this.type})]},addPasteRules(){return[St({find:DM,type:this.type}),St({find:FM,type:this.type})]}}),Ng=Fu;var HM="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5m\xF6gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",zM="\u03B5\u03BB1\u03C52\u0431\u04331\u0435\u043B3\u0434\u0435\u0442\u04384\u0435\u044E2\u043A\u0430\u0442\u043E\u043B\u0438\u043A6\u043E\u043C3\u043C\u043A\u04342\u043E\u043D1\u0441\u043A\u0432\u04306\u043E\u043D\u043B\u0430\u0439\u043D5\u0440\u04333\u0440\u0443\u04412\u04442\u0441\u0430\u0439\u04423\u0440\u04313\u0443\u043A\u04403\u049B\u0430\u04373\u0570\u0561\u05753\u05D9\u05E9\u05E8\u05D0\u05DC5\u05E7\u05D5\u05DD3\u0627\u0628\u0648\u0638\u0628\u064A5\u0631\u0627\u0645\u0643\u06485\u0644\u0627\u0631\u062F\u06464\u0628\u062D\u0631\u064A\u06465\u062C\u0632\u0627\u0626\u06315\u0633\u0639\u0648\u062F\u064A\u06296\u0639\u0644\u064A\u0627\u06465\u0645\u063A\u0631\u06285\u0645\u0627\u0631\u0627\u062A5\u06CC\u0631\u0627\u06465\u0628\u0627\u0631\u062A2\u0632\u0627\u06314\u064A\u062A\u06433\u06BE\u0627\u0631\u062A5\u062A\u0648\u0646\u06334\u0633\u0648\u062F\u0627\u06463\u0631\u064A\u06295\u0634\u0628\u0643\u06294\u0639\u0631\u0627\u06422\u06282\u0645\u0627\u06464\u0641\u0644\u0633\u0637\u064A\u06466\u0642\u0637\u06313\u0643\u0627\u062B\u0648\u0644\u064A\u06436\u0648\u06453\u0645\u0635\u06312\u0644\u064A\u0633\u064A\u06275\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u06277\u0642\u06394\u0647\u0645\u0631\u0627\u06475\u067E\u0627\u06A9\u0633\u062A\u0627\u06467\u0680\u0627\u0631\u062A4\u0915\u0949\u092E3\u0928\u0947\u091F3\u092D\u093E\u0930\u09240\u092E\u094D3\u094B\u09245\u0938\u0902\u0917\u0920\u09285\u09AC\u09BE\u0982\u09B2\u09BE5\u09AD\u09BE\u09B0\u09A42\u09F0\u09A44\u0A2D\u0A3E\u0A30\u0A244\u0AAD\u0ABE\u0AB0\u0AA44\u0B2D\u0B3E\u0B30\u0B244\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE6\u0BB2\u0B99\u0BCD\u0B95\u0BC86\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD11\u0C2D\u0C3E\u0C30\u0C24\u0C4D5\u0CAD\u0CBE\u0CB0\u0CA44\u0D2D\u0D3E\u0D30\u0D24\u0D025\u0DBD\u0D82\u0D9A\u0DCF4\u0E04\u0E2D\u0E213\u0E44\u0E17\u0E223\u0EA5\u0EB2\u0EA73\u10D2\u10D42\u307F\u3093\u306A3\u30A2\u30DE\u30BE\u30F34\u30AF\u30E9\u30A6\u30C94\u30B0\u30FC\u30B0\u30EB4\u30B3\u30E02\u30B9\u30C8\u30A23\u30BB\u30FC\u30EB3\u30D5\u30A1\u30C3\u30B7\u30E7\u30F36\u30DD\u30A4\u30F3\u30C84\u4E16\u754C2\u4E2D\u4FE11\u56FD1\u570B1\u6587\u7F513\u4E9A\u9A6C\u900A3\u4F01\u4E1A2\u4F5B\u5C712\u4FE1\u606F2\u5065\u5EB72\u516B\u53662\u516C\u53F81\u76CA2\u53F0\u6E7E1\u70632\u5546\u57CE1\u5E971\u68072\u5609\u91CC0\u5927\u9152\u5E975\u5728\u7EBF2\u5927\u62FF2\u5929\u4E3B\u65593\u5A31\u4E502\u5BB6\u96FB2\u5E7F\u4E1C2\u5FAE\u535A2\u6148\u55842\u6211\u7231\u4F603\u624B\u673A2\u62DB\u80582\u653F\u52A11\u5E9C2\u65B0\u52A0\u57612\u95FB2\u65F6\u5C1A2\u66F8\u7C4D2\u673A\u67842\u6DE1\u9A6C\u95213\u6E38\u620F2\u6FB3\u95802\u70B9\u770B2\u79FB\u52A82\u7EC4\u7EC7\u673A\u67844\u7F51\u57401\u5E971\u7AD91\u7EDC2\u8054\u901A2\u8C37\u6B4C2\u8D2D\u72692\u901A\u8CA92\u96C6\u56E22\u96FB\u8A0A\u76C8\u79D14\u98DE\u5229\u6D663\u98DF\u54C12\u9910\u53852\u9999\u683C\u91CC\u62C93\u6E2F2\uB2F7\uB1371\uCEF42\uC0BC\uC1312\uD55C\uAD6D2",Ku="numeric",qu="ascii",Gu="alpha",ho="asciinumeric",uo="alphanumeric",ju="domain",Hg="emoji",VM="scheme",$M="slashscheme",Hu="whitespace";function WM(i,t){return i in t||(t[i]=[]),t[i]}function Ai(i,t,e){t[Ku]&&(t[ho]=!0,t[uo]=!0),t[qu]&&(t[ho]=!0,t[Gu]=!0),t[ho]&&(t[uo]=!0),t[Gu]&&(t[uo]=!0),t[uo]&&(t[ju]=!0),t[Hg]&&(t[ju]=!0);for(let n in t){let r=WM(n,e);r.indexOf(i)<0&&r.push(i)}}function UM(i,t){let e={};for(let n in t)t[n].indexOf(i)>=0&&(e[n]=!0);return e}function kt(i=null){this.j={},this.jr=[],this.jd=null,this.t=i}kt.groups={};kt.prototype={accepts(){return!!this.t},go(i){let t=this,e=t.j[i];if(e)return e;for(let n=0;n<t.jr.length;n++){let r=t.jr[n][0],o=t.jr[n][1];if(o&&r.test(i))return o}return t.jd},has(i,t=!1){return t?i in this.j:!!this.go(i)},ta(i,t,e,n){for(let r=0;r<i.length;r++)this.tt(i[r],t,e,n)},tr(i,t,e,n){n=n||kt.groups;let r;return t&&t.j?r=t:(r=new kt(t),e&&n&&Ai(t,e,n)),this.jr.push([i,r]),r},ts(i,t,e,n){let r=this,o=i.length;if(!o)return r;for(let s=0;s<o-1;s++)r=r.tt(i[s]);return r.tt(i[o-1],t,e,n)},tt(i,t,e,n){n=n||kt.groups;let r=this;if(t&&t.j)return r.j[i]=t,t;let o=t,s,a=r.go(i);if(a?(s=new kt,Object.assign(s.j,a.j),s.jr.push.apply(s.jr,a.jr),s.jd=a.jd,s.t=a.t):s=new kt,o){if(n)if(s.t&&typeof s.t=="string"){let l=Object.assign(UM(s.t,n),e);Ai(o,l,n)}else e&&Ai(o,e,n);s.t=o}return r.j[i]=s,s}};var fe=(i,t,e,n,r)=>i.ta(t,e,n,r),He=(i,t,e,n,r)=>i.tr(t,e,n,r),Pg=(i,t,e,n,r)=>i.ts(t,e,n,r),$=(i,t,e,n,r)=>i.tt(t,e,n,r),Dn="WORD",Yu="UWORD",zg="ASCIINUMERICAL",Vg="ALPHANUMERICAL",yo="LOCALHOST",Xu="TLD",Ju="UTLD",Gs="SCHEME",mr="SLASH_SCHEME",Qu="NUM",Zu="WS",ed="NL",po="OPENBRACE",fo="CLOSEBRACE",js="OPENBRACKET",Ys="CLOSEBRACKET",Xs="OPENPAREN",Js="CLOSEPAREN",Zs="OPENANGLEBRACKET",Qs="CLOSEANGLEBRACKET",ea="FULLWIDTHLEFTPAREN",ta="FULLWIDTHRIGHTPAREN",na="LEFTCORNERBRACKET",ia="RIGHTCORNERBRACKET",ra="LEFTWHITECORNERBRACKET",oa="RIGHTWHITECORNERBRACKET",sa="FULLWIDTHLESSTHAN",aa="FULLWIDTHGREATERTHAN",la="AMPERSAND",ca="APOSTROPHE",ua="ASTERISK",ei="AT",da="BACKSLASH",ha="BACKTICK",pa="CARET",ti="COLON",td="COMMA",fa="DOLLAR",pn="DOT",ma="EQUALS",nd="EXCLAMATION",$t="HYPHEN",mo="PERCENT",ga="PIPE",ba="PLUS",ya="POUND",go="QUERY",id="QUOTE",$g="FULLWIDTHMIDDLEDOT",rd="SEMI",fn="SLASH",bo="TILDE",va="UNDERSCORE",Wg="EMOJI",Ea="SYM",Ug=Object.freeze({__proto__:null,ALPHANUMERICAL:Vg,AMPERSAND:la,APOSTROPHE:ca,ASCIINUMERICAL:zg,ASTERISK:ua,AT:ei,BACKSLASH:da,BACKTICK:ha,CARET:pa,CLOSEANGLEBRACKET:Qs,CLOSEBRACE:fo,CLOSEBRACKET:Ys,CLOSEPAREN:Js,COLON:ti,COMMA:td,DOLLAR:fa,DOT:pn,EMOJI:Wg,EQUALS:ma,EXCLAMATION:nd,FULLWIDTHGREATERTHAN:aa,FULLWIDTHLEFTPAREN:ea,FULLWIDTHLESSTHAN:sa,FULLWIDTHMIDDLEDOT:$g,FULLWIDTHRIGHTPAREN:ta,HYPHEN:$t,LEFTCORNERBRACKET:na,LEFTWHITECORNERBRACKET:ra,LOCALHOST:yo,NL:ed,NUM:Qu,OPENANGLEBRACKET:Zs,OPENBRACE:po,OPENBRACKET:js,OPENPAREN:Xs,PERCENT:mo,PIPE:ga,PLUS:ba,POUND:ya,QUERY:go,QUOTE:id,RIGHTCORNERBRACKET:ia,RIGHTWHITECORNERBRACKET:oa,SCHEME:Gs,SEMI:rd,SLASH:fn,SLASH_SCHEME:mr,SYM:Ea,TILDE:bo,TLD:Xu,UNDERSCORE:va,UTLD:Ju,UWORD:Yu,WORD:Dn,WS:Zu}),_n=/[a-z]/,co=/\p{L}/u,zu=/\p{Emoji}/u;var On=/\d/,Vu=/\s/;var _g="\r",$u=`
`,KM="\uFE0F",qM="\u200D",Wu="\uFFFC",Us=null,Ks=null;function GM(i=[]){let t={};kt.groups=t;let e=new kt;Us==null&&(Us=Og(HM)),Ks==null&&(Ks=Og(zM)),$(e,"'",ca),$(e,"{",po),$(e,"}",fo),$(e,"[",js),$(e,"]",Ys),$(e,"(",Xs),$(e,")",Js),$(e,"<",Zs),$(e,">",Qs),$(e,"\uFF08",ea),$(e,"\uFF09",ta),$(e,"\u300C",na),$(e,"\u300D",ia),$(e,"\u300E",ra),$(e,"\u300F",oa),$(e,"\uFF1C",sa),$(e,"\uFF1E",aa),$(e,"&",la),$(e,"*",ua),$(e,"@",ei),$(e,"`",ha),$(e,"^",pa),$(e,":",ti),$(e,",",td),$(e,"$",fa),$(e,".",pn),$(e,"=",ma),$(e,"!",nd),$(e,"-",$t),$(e,"%",mo),$(e,"|",ga),$(e,"+",ba),$(e,"#",ya),$(e,"?",go),$(e,'"',id),$(e,"/",fn),$(e,";",rd),$(e,"~",bo),$(e,"_",va),$(e,"\\",da),$(e,"\u30FB",$g);let n=He(e,On,Qu,{[Ku]:!0});He(n,On,n);let r=He(n,_n,zg,{[ho]:!0}),o=He(n,co,Vg,{[uo]:!0}),s=He(e,_n,Dn,{[qu]:!0});He(s,On,r),He(s,_n,s),He(r,On,r),He(r,_n,r);let a=He(e,co,Yu,{[Gu]:!0});He(a,_n),He(a,On,o),He(a,co,a),He(o,On,o),He(o,_n),He(o,co,o);let l=$(e,$u,ed,{[Hu]:!0}),c=$(e,_g,Zu,{[Hu]:!0}),u=He(e,Vu,Zu,{[Hu]:!0});$(e,Wu,u),$(c,$u,l),$(c,Wu,u),He(c,Vu,u),$(u,_g),$(u,$u),He(u,Vu,u),$(u,Wu,u);let d=He(e,zu,Wg,{[Hg]:!0});$(d,"#"),He(d,zu,d),$(d,KM,d);let h=$(d,qM);$(h,"#"),He(h,zu,d);let f=[[_n,s],[On,r]],p=[[_n,null],[co,a],[On,o]];for(let m=0;m<Us.length;m++)Qn(e,Us[m],Xu,Dn,f);for(let m=0;m<Ks.length;m++)Qn(e,Ks[m],Ju,Yu,p);Ai(Xu,{tld:!0,ascii:!0},t),Ai(Ju,{utld:!0,alpha:!0},t),Qn(e,"file",Gs,Dn,f),Qn(e,"mailto",Gs,Dn,f),Qn(e,"http",mr,Dn,f),Qn(e,"https",mr,Dn,f),Qn(e,"ftp",mr,Dn,f),Qn(e,"ftps",mr,Dn,f),Ai(Gs,{scheme:!0,ascii:!0},t),Ai(mr,{slashscheme:!0,ascii:!0},t),i=i.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<i.length;m++){let g=i[m][0],v=i[m][1]?{[VM]:!0}:{[$M]:!0};g.indexOf("-")>=0?v[ju]=!0:_n.test(g)?On.test(g)?v[ho]=!0:v[qu]=!0:v[Ku]=!0,Pg(e,g,g,v)}return Pg(e,"localhost",yo,{ascii:!0}),e.jd=new kt(Ea),{start:e,tokens:Object.assign({groups:t},Ug)}}function Kg(i,t){let e=jM(t.replace(/[A-Z]/g,a=>a.toLowerCase())),n=e.length,r=[],o=0,s=0;for(;s<n;){let a=i,l=null,c=0,u=null,d=-1,h=-1;for(;s<n&&(l=a.go(e[s]));)a=l,a.accepts()?(d=0,h=0,u=a):d>=0&&(d+=e[s].length,h++),c+=e[s].length,o+=e[s].length,s++;o-=d,s-=h,c-=d,r.push({t:u.t,v:t.slice(o-c,o),s:o-c,e:o})}return r}function jM(i){let t=[],e=i.length,n=0;for(;n<e;){let r=i.charCodeAt(n),o,s=r<55296||r>56319||n+1===e||(o=i.charCodeAt(n+1))<56320||o>57343?i[n]:i.slice(n,n+2);t.push(s),n+=s.length}return t}function Qn(i,t,e,n,r){let o,s=t.length;for(let a=0;a<s-1;a++){let l=t[a];i.j[l]?o=i.j[l]:(o=new kt(n),o.jr=r.slice(),i.j[l]=o),i=o}return o=new kt(e),o.jr=r.slice(),i.j[t[s-1]]=o,o}function Og(i){let t=[],e=[],n=0,r="0123456789";for(;n<i.length;){let o=0;for(;r.indexOf(i[n+o])>=0;)o++;if(o>0){t.push(e.join(""));for(let s=parseInt(i.substring(n,n+o),10);s>0;s--)e.pop();n+=o}else e.push(i[n]),n++}return t}var vo={defaultProtocol:"http",events:null,format:Dg,formatHref:Dg,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function od(i,t=null){let e=Object.assign({},vo);i&&(e=Object.assign(e,i instanceof od?i.o:i));let n=e.ignoreTags,r=[];for(let o=0;o<n.length;o++)r.push(n[o].toUpperCase());this.o=e,t&&(this.defaultRender=t),this.ignoreTags=r}od.prototype={o:vo,ignoreTags:[],defaultRender(i){return i},check(i){return this.get("validate",i.toString(),i)},get(i,t,e){let n=t!=null,r=this.o[i];return r&&(typeof r=="object"?(r=e.t in r?r[e.t]:vo[i],typeof r=="function"&&n&&(r=r(t,e))):typeof r=="function"&&n&&(r=r(t,e.t,e)),r)},getObj(i,t,e){let n=this.o[i];return typeof n=="function"&&t!=null&&(n=n(t,e.t,e)),n},render(i){let t=i.render(this);return(this.get("render",null,i)||this.defaultRender)(t,i.t,i)}};function Dg(i){return i}function qg(i,t){this.t="token",this.v=i,this.tk=t}qg.prototype={isLink:!1,toString(){return this.v},toHref(i){return this.toString()},toFormattedString(i){let t=this.toString(),e=i.get("truncate",t,this),n=i.get("format",t,this);return e&&n.length>e?n.substring(0,e)+"\u2026":n},toFormattedHref(i){return i.get("formatHref",this.toHref(i.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(i=vo.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(i),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(i){return{type:this.t,value:this.toFormattedString(i),isLink:this.isLink,href:this.toFormattedHref(i),start:this.startIndex(),end:this.endIndex()}},validate(i){return i.get("validate",this.toString(),this)},render(i){let t=this,e=this.toHref(i.get("defaultProtocol")),n=i.get("formatHref",e,this),r=i.get("tagName",e,t),o=this.toFormattedString(i),s={},a=i.get("className",e,t),l=i.get("target",e,t),c=i.get("rel",e,t),u=i.getObj("attributes",e,t),d=i.getObj("events",e,t);return s.href=n,a&&(s.class=a),l&&(s.target=l),c&&(s.rel=c),u&&Object.assign(s,u),{tagName:r,attributes:s,content:o,eventListeners:d}}};function xa(i,t){class e extends qg{constructor(r,o){super(r,o),this.t=i}}for(let n in t)e.prototype[n]=t[n];return e.t=i,e}var Bg=xa("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Fg=xa("text"),YM=xa("nl"),qs=xa("url",{isLink:!0,toHref(i=vo.defaultProtocol){return this.hasProtocol()?this.v:`${i}://${this.v}`},hasProtocol(){let i=this.tk;return i.length>=2&&i[0].t!==yo&&i[1].t===ti}});var Vt=i=>new kt(i);function XM({groups:i}){let t=i.domain.concat([la,ua,ei,da,ha,pa,fa,ma,$t,Qu,mo,ga,ba,ya,fn,Ea,bo,va]),e=[ca,ti,td,pn,nd,mo,go,id,rd,Zs,Qs,po,fo,Ys,js,Xs,Js,ea,ta,na,ia,ra,oa,sa,aa],n=[la,ca,ua,da,ha,pa,fa,ma,$t,po,fo,mo,ga,ba,ya,go,fn,Ea,bo,va],r=Vt(),o=$(r,bo);fe(o,n,o),fe(o,i.domain,o);let s=Vt(),a=Vt(),l=Vt();fe(r,i.domain,s),fe(r,i.scheme,a),fe(r,i.slashscheme,l),fe(s,n,o),fe(s,i.domain,s);let c=$(s,ei);$(o,ei,c),$(a,ei,c),$(l,ei,c);let u=$(o,pn);fe(u,n,o),fe(u,i.domain,o);let d=Vt();fe(c,i.domain,d),fe(d,i.domain,d);let h=$(d,pn);fe(h,i.domain,d);let f=Vt(Bg);fe(h,i.tld,f),fe(h,i.utld,f),$(c,yo,f);let p=$(d,$t);$(p,$t,p),fe(p,i.domain,d),fe(f,i.domain,d),$(f,pn,h),$(f,$t,p);let m=$(f,ti);fe(m,i.numeric,Bg);let g=$(s,$t),b=$(s,pn);$(g,$t,g),fe(g,i.domain,s),fe(b,n,o),fe(b,i.domain,s);let v=Vt(qs);fe(b,i.tld,v),fe(b,i.utld,v),fe(v,i.domain,s),fe(v,n,o),$(v,pn,b),$(v,$t,g),$(v,ei,c);let y=$(v,ti),E=Vt(qs);fe(y,i.numeric,E);let x=Vt(qs),S=Vt();fe(x,t,x),fe(x,e,S),fe(S,t,x),fe(S,e,S),$(v,fn,x),$(E,fn,x);let w=$(a,ti),k=$(l,ti),M=$(k,fn),L=$(M,fn);fe(a,i.domain,s),$(a,pn,b),$(a,$t,g),fe(l,i.domain,s),$(l,pn,b),$(l,$t,g),fe(w,i.domain,x),$(w,fn,x),$(w,go,x),fe(L,i.domain,x),fe(L,t,x),$(L,fn,x);let _=[[po,fo],[js,Ys],[Xs,Js],[Zs,Qs],[ea,ta],[na,ia],[ra,oa],[sa,aa]];for(let P=0;P<_.length;P++){let[I,N]=_[P],D=$(x,I);$(S,I,D),$(D,N,x);let R=Vt(qs);fe(D,t,R);let A=Vt();fe(D,e),fe(R,t,R),fe(R,e,A),fe(A,t,R),fe(A,e,A),$(R,N,x),$(A,N,x)}return $(r,yo,v),$(r,ed,YM),{start:r,tokens:Ug}}function JM(i,t,e){let n=e.length,r=0,o=[],s=[];for(;r<n;){let a=i,l=null,c=null,u=0,d=null,h=-1;for(;r<n&&!(l=a.go(e[r].t));)s.push(e[r++]);for(;r<n&&(c=l||a.go(e[r].t));)l=null,a=c,a.accepts()?(h=0,d=a):h>=0&&h++,r++,u++;if(h<0)r-=u,r<n&&(s.push(e[r]),r++);else{s.length>0&&(o.push(Uu(Fg,t,s)),s=[]),r-=h,u-=h;let f=d.t,p=e.slice(r-u,r);o.push(Uu(f,t,p))}}return s.length>0&&o.push(Uu(Fg,t,s)),o}function Uu(i,t,e){let n=e[0].s,r=e[e.length-1].e,o=t.slice(n,r);return new i(o,e)}var ZM=typeof console!="undefined"&&console&&console.warn||(()=>{}),QM="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Pe={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Gg(){return kt.groups={},Pe.scanner=null,Pe.parser=null,Pe.tokenQueue=[],Pe.pluginQueue=[],Pe.customSchemes=[],Pe.initialized=!1,Pe}function sd(i,t=!1){if(Pe.initialized&&ZM(`linkifyjs: already initialized - will not register custom scheme "${i}" ${QM}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(i))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Pe.customSchemes.push([i,t])}function eT(){Pe.scanner=GM(Pe.customSchemes);for(let i=0;i<Pe.tokenQueue.length;i++)Pe.tokenQueue[i][1]({scanner:Pe.scanner});Pe.parser=XM(Pe.scanner.tokens);for(let i=0;i<Pe.pluginQueue.length;i++)Pe.pluginQueue[i][1]({scanner:Pe.scanner,parser:Pe.parser});return Pe.initialized=!0,Pe}function Sa(i){return Pe.initialized||eT(),JM(Pe.parser.start,i,Kg(Pe.scanner.start,i))}Sa.scan=Kg;function ka(i,t=null,e=null){if(t&&typeof t=="object"){if(e)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);e=t,t=null}let n=new od(e),r=Sa(i),o=[];for(let s=0;s<r.length;s++){let a=r[s];a.isLink&&(!t||a.t===t)&&n.check(a)&&o.push(a.toFormattedObject(n))}return o}var ad="[\0- \xA0\u1680\u180E\u2000-\u2029\u205F\u3000]",tT=new RegExp(ad),nT=new RegExp(`${ad}$`),iT=new RegExp(ad,"g");function rT(i){return i.length===1?i[0].isLink:i.length===3&&i[1].isLink?["()","[]"].includes(i[0].value+i[2].value):!1}function oT(i){return new X({key:new se("autolink"),appendTransaction:(t,e,n)=>{let r=t.some(c=>c.docChanged)&&!e.doc.eq(n.doc),o=t.some(c=>c.getMeta("preventAutolink"));if(!r||o)return;let{tr:s}=n,a=xu(e.doc,[...t]);if(Tu(a).forEach(({newRange:c})=>{let u=Ym(n.doc,c,f=>f.isTextblock),d,h;if(u.length>1)d=u[0],h=n.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){let f=n.doc.textBetween(c.from,c.to," "," ");if(!nT.test(f))return;d=u[0],h=n.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&h){let f=h.split(tT).filter(Boolean);if(f.length<=0)return!1;let p=f[f.length-1],m=d.pos+h.lastIndexOf(p);if(!p)return!1;let g=Sa(p).map(b=>b.toObject(i.defaultProtocol));if(!rT(g))return!1;g.filter(b=>b.isLink).map(b=>({...b,from:m+b.start+1,to:m+b.end+1})).filter(b=>n.schema.marks.code?!n.doc.rangeHasMark(b.from,b.to,n.schema.marks.code):!0).filter(b=>i.validate(b.value)).filter(b=>i.shouldAutoLink(b.value)).forEach(b=>{Vs(b.from,b.to,n.doc).some(v=>v.mark.type===i.type)||s.addMark(b.from,b.to,i.type.create({href:b.href}))})}}),!!s.steps.length)return s}})}function sT(i){return new X({key:new se("handleClickLink"),props:{handleClick:(t,e,n)=>{var r,o;if(n.button!==0||!t.editable)return!1;let s=null;if(n.target instanceof HTMLAnchorElement)s=n.target;else{let u=n.target,d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;s=d.find(h=>h.nodeName==="A")}if(!s)return!1;let a=Mu(t.state,i.type.name),l=(r=s==null?void 0:s.href)!=null?r:a.href,c=(o=s==null?void 0:s.target)!=null?o:a.target;return i.enableClickSelection&&i.editor.commands.extendMarkRange(i.type.name),s&&l?(window.open(l,c),!0):!1}}})}function aT(i){return new X({key:new se("handlePasteLink"),props:{handlePaste:(t,e,n)=>{let{state:r}=t,{selection:o}=r,{empty:s}=o;if(s)return!1;let a="";n.content.forEach(c=>{a+=c.textContent});let l=ka(a,{defaultProtocol:i.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:i.editor.commands.setMark(i.type,{href:l.href})}}})}function Ii(i,t){let e=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(n=>{let r=typeof n=="string"?n:n.scheme;r&&e.push(r)}),!i||i.replace(iT,"").match(new RegExp(`^(?:(?:${e.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var ld=Ve.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(i=>{if(typeof i=="string"){sd(i);return}sd(i.scheme,i.optionalSlashes)})},onDestroy(){Gg()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(i,t)=>!!Ii(i,t.protocols),validate:i=>!!i,shouldAutoLink:i=>!!i}},addAttributes(){return{href:{default:null,parseHTML(i){return i.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:i=>{let t=i.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:e=>!!Ii(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:i}){return this.options.isAllowedUri(i.href,{defaultValidate:t=>!!Ii(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",pe(this.options.HTMLAttributes,i),0]:["a",pe(this.options.HTMLAttributes,{...i,href:""}),0]},addCommands(){return{setLink:i=>({chain:t})=>{let{href:e}=i;return this.options.isAllowedUri(e,{defaultValidate:n=>!!Ii(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,i).setMeta("preventAutolink",!0).run():!1},toggleLink:i=>({chain:t})=>{let{href:e}=i||{};return e&&!this.options.isAllowedUri(e,{defaultValidate:n=>!!Ii(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:t().toggleMark(this.name,i,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:i})=>i().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[St({find:i=>{let t=[];if(i){let{protocols:e,defaultProtocol:n}=this.options,r=ka(i).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:s=>!!Ii(s,e),protocols:e,defaultProtocol:n}));r.length&&r.forEach(o=>t.push({text:o.value,data:{href:o.href},index:o.start}))}return t},type:this.type,getAttributes:i=>{var t;return{href:(t=i.data)==null?void 0:t.href}}})]},addProseMirrorPlugins(){let i=[],{protocols:t,defaultProtocol:e}=this.options;return this.options.autolink&&i.push(oT({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:r=>!!Ii(r,t),protocols:t,defaultProtocol:e}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&i.push(sT({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&i.push(aT({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),i}}),jg=ld;var lT=Object.defineProperty,cT=(i,t)=>{for(var e in t)lT(i,e,{get:t[e],enumerable:!0})},uT="listItem",Yg="textStyle",Xg=/^\s*([-+*])\s$/,gr=Se.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:i}){return["ul",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{toggleBulletList:()=>({commands:i,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(uT,this.editor.getAttributes(Yg)).run():i.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let i=hn({find:Xg,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(i=hn({find:Xg,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Yg),editor:this.editor})),[i]}}),br=Se.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:i}){return["li",pe(this.options.HTMLAttributes,i),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),dT={};cT(dT,{findListItemPos:()=>Eo,getNextListDepth:()=>dd,handleBackspace:()=>cd,handleDelete:()=>ud,hasListBefore:()=>Qg,hasListItemAfter:()=>hT,hasListItemBefore:()=>e0,listItemHasSubList:()=>t0,nextListIsDeeper:()=>n0,nextListIsHigher:()=>i0});var Eo=(i,t)=>{let{$from:e}=t.selection,n=Fe(i,t.schema),r=null,o=e.depth,s=e.pos,a=null;for(;o>0&&a===null;)r=e.node(o),r.type===n?a=o:(o-=1,s-=1);return a===null?null:{$pos:t.doc.resolve(s),depth:a}},dd=(i,t)=>{let e=Eo(i,t);if(!e)return!1;let[,n]=tg(t,i,e.$pos.pos+4);return n},Qg=(i,t,e)=>{let{$anchor:n}=i.selection,r=Math.max(0,n.pos-2),o=i.doc.resolve(r).node();return!(!o||!e.includes(o.type.name))},e0=(i,t)=>{var e;let{$anchor:n}=t.selection,r=t.doc.resolve(n.pos-2);return!(r.index()===0||((e=r.nodeBefore)==null?void 0:e.type.name)!==i)},t0=(i,t,e)=>{if(!e)return!1;let n=Fe(i,t.schema),r=!1;return e.descendants(o=>{o.type===n&&(r=!0)}),r},cd=(i,t,e)=>{if(i.commands.undoInputRule())return!0;if(i.state.selection.from!==i.state.selection.to)return!1;if(!dn(i.state,t)&&Qg(i.state,t,e)){let{$anchor:a}=i.state.selection,l=i.state.doc.resolve(a.before()-1),c=[];l.node().descendants((h,f)=>{h.type.name===t&&c.push({node:h,pos:f})});let u=c.at(-1);if(!u)return!1;let d=i.state.doc.resolve(l.start()+u.pos+1);return i.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!dn(i.state,t)||!ig(i.state))return!1;let n=Eo(t,i.state);if(!n)return!1;let o=i.state.doc.resolve(n.$pos.pos-2).node(n.depth),s=t0(t,i.state,o);return e0(t,i.state)&&!s?i.commands.joinItemBackward():i.chain().liftListItem(t).run()},n0=(i,t)=>{let e=dd(i,t),n=Eo(i,t);return!n||!e?!1:e>n.depth},i0=(i,t)=>{let e=dd(i,t),n=Eo(i,t);return!n||!e?!1:e<n.depth},ud=(i,t)=>{if(!dn(i.state,t)||!ng(i.state,t))return!1;let{selection:e}=i.state,{$from:n,$to:r}=e;return!e.empty&&n.sameParent(r)?!1:n0(t,i.state)?i.chain().focus(i.state.selection.from+4).lift(t).joinBackward().run():i0(t,i.state)?i.chain().joinForward().joinBackward().run():i.commands.joinItemForward()},hT=(i,t)=>{var e;let{$anchor:n}=t.selection,r=t.doc.resolve(n.pos-n.parentOffset-2);return!(r.index()===r.parent.childCount-1||((e=r.nodeAfter)==null?void 0:e.type.name)!==i)},hd=ue.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:i})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{i.state.schema.nodes[e]!==void 0&&ud(i,e)&&(t=!0)}),t},"Mod-Delete":({editor:i})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{i.state.schema.nodes[e]!==void 0&&ud(i,e)&&(t=!0)}),t},Backspace:({editor:i})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:n})=>{i.state.schema.nodes[e]!==void 0&&cd(i,e,n)&&(t=!0)}),t},"Mod-Backspace":({editor:i})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:n})=>{i.state.schema.nodes[e]!==void 0&&cd(i,e,n)&&(t=!0)}),t}}}}),pT="listItem",Jg="textStyle",Zg=/^(\d+)\.\s$/,yr=Se.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:i=>i.hasAttribute("start")?parseInt(i.getAttribute("start")||"",10):1},type:{default:null,parseHTML:i=>i.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:i}){let{start:t,...e}=i;return t===1?["ol",pe(this.options.HTMLAttributes,e),0]:["ol",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{toggleOrderedList:()=>({commands:i,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(pT,this.editor.getAttributes(Jg)).run():i.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let i=hn({find:Zg,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(i=hn({find:Zg,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(Jg)}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1],editor:this.editor})),[i]}}),fT=/^\s*(\[([( |x])?\])\s$/,mT=Se.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:i=>{let t=i.getAttribute("data-checked");return t===""||t==="true"},renderHTML:i=>({"data-checked":i.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:i,HTMLAttributes:t}){return["li",pe(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:i.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){let i={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...i,Tab:()=>this.editor.commands.sinkListItem(this.name)}:i},addNodeView(){return({node:i,HTMLAttributes:t,getPos:e,editor:n})=>{let r=document.createElement("li"),o=document.createElement("label"),s=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,h;a.ariaLabel=((h=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:h.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(i),o.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}let{checked:d}=u.target;n.isEditable&&typeof e=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{let f=e();if(typeof f!="number")return!1;let p=h.doc.nodeAt(f);return h.setNodeMarkup(f,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(i,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{r.setAttribute(u,d)}),r.dataset.checked=i.attrs.checked,a.checked=i.attrs.checked,o.append(a,s),r.append(o,l),Object.entries(t).forEach(([u,d])=>{r.setAttribute(u,d)}),{dom:r,contentDOM:l,update:u=>u.type!==this.type?!1:(r.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[hn({find:fT,type:this.type,getAttributes:i=>({checked:i[i.length-1]==="x"})})]}}),gT=Se.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:i}){return["ul",pe(this.options.HTMLAttributes,i,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:i})=>i.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),QD=ue.create({name:"listKit",addExtensions(){let i=[];return this.options.bulletList!==!1&&i.push(gr.configure(this.options.bulletList)),this.options.listItem!==!1&&i.push(br.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(hd.configure(this.options.listKeymap)),this.options.orderedList!==!1&&i.push(yr.configure(this.options.orderedList)),this.options.taskItem!==!1&&i.push(mT.configure(this.options.taskItem)),this.options.taskList!==!1&&i.push(gT.configure(this.options.taskList)),i}});var pd=Se.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:i}){return["p",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{setParagraph:()=>({commands:i})=>i.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),r0=pd;var bT=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,yT=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,fd=Ve.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:i=>i.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:i}){return["s",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{setStrike:()=>({commands:i})=>i.setMark(this.name),toggleStrike:()=>({commands:i})=>i.toggleMark(this.name),unsetStrike:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[zt({find:bT,type:this.type})]},addPasteRules(){return[St({find:yT,type:this.type})]}}),o0=fd;var md=Se.create({name:"text",group:"inline"}),s0=md;var gd=Ve.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:i=>i.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:i}){return["u",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{setUnderline:()=>({commands:i})=>i.setMark(this.name),toggleUnderline:()=>({commands:i})=>i.toggleMark(this.name),unsetUnderline:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),a0=gd;function l0(i={}){return new X({view(t){return new bd(t,i)}})}var bd=class{constructor(t,e){var n;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=e.width)!==null&&n!==void 0?n:1,this.color=e.color===!1?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let o=s=>{this[r](s)};return t.dom.addEventListener(r,o),{name:r,handler:o}})}destroy(){this.handlers.forEach(({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e))}update(t,e){this.cursorPos!=null&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),e=!t.parent.inlineContent,n,r=this.editorView.dom,o=r.getBoundingClientRect(),s=o.width/r.offsetWidth,a=o.height/r.offsetHeight;if(e){let d=t.nodeBefore,h=t.nodeAfter;if(d||h){let f=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(f){let p=f.getBoundingClientRect(),m=d?p.bottom:p.top;d&&h&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;n={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!n){let d=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*s;n={left:d.left-h,right:d.left+h,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",e),this.element.classList.toggle("prosemirror-dropcursor-inline",!e);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),h=d.width/l.offsetWidth,f=d.height/l.offsetHeight;c=d.left-l.scrollLeft*h,u=d.top-l.scrollTop*f}this.element.style.left=(n.left-c)/s+"px",this.element.style.top=(n.top-u)/a+"px",this.element.style.width=(n.right-n.left)/s+"px",this.element.style.height=(n.bottom-n.top)/a+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=n&&n.type.spec.disableDropCursor,o=typeof r=="function"?r(this.editorView,e,t):r;if(e&&!o){let s=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=is(this.editorView.state.doc,s,this.editorView.dragging.slice);a!=null&&(s=a)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}};var Oe=class extends re{constructor(t){super(t,t)}map(t,e){let n=t.resolve(e.map(this.head));return Oe.valid(n)?new Oe(n):re.near(n)}content(){return q.empty}eq(t){return t instanceof Oe&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Oe(t.resolve(e.pos))}getBookmark(){return new xo(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!vT(t)||!ET(t))return!1;let n=e.type.spec.allowGapCursor;if(n!=null)return n;let r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(t,e,n=!1){e:for(;;){if(!n&&Oe.valid(t))return t;let r=t.pos,o=null;for(let s=t.depth;;s--){let a=t.node(s);if(e>0?t.indexAfter(s)<a.childCount:t.index(s)>0){o=a.child(e>0?t.indexAfter(s):t.index(s)-1);break}else if(s==0)return null;r+=e;let l=t.doc.resolve(r);if(Oe.valid(l))return l}for(;;){let s=e>0?o.firstChild:o.lastChild;if(!s){if(o.isAtom&&!o.isText&&!Y.isSelectable(o)){t=t.doc.resolve(r+o.nodeSize*e),n=!1;continue e}break}o=s,r+=e;let a=t.doc.resolve(r);if(Oe.valid(a))return a}return null}}};Oe.prototype.visible=!1;Oe.findFrom=Oe.findGapCursorFrom;re.jsonID("gapcursor",Oe);var xo=class{constructor(t){this.pos=t}map(t){return new xo(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return Oe.valid(e)?new Oe(e):re.near(e)}};function vT(i){for(let t=i.depth;t>=0;t--){let e=i.index(t),n=i.node(t);if(e==0){if(n.type.spec.isolating)return!0;continue}for(let r=n.child(e-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function ET(i){for(let t=i.depth;t>=0;t--){let e=i.indexAfter(t),n=i.node(t);if(e==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let r=n.child(e);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function c0(){return new X({props:{decorations:wT,createSelectionBetween(i,t,e){return t.pos==e.pos&&Oe.valid(e)?new Oe(e):null},handleClick:ST,handleKeyDown:xT,handleDOMEvents:{beforeinput:kT}}})}var xT=du({ArrowLeft:wa("horiz",-1),ArrowRight:wa("horiz",1),ArrowUp:wa("vert",-1),ArrowDown:wa("vert",1)});function wa(i,t){let e=i=="vert"?t>0?"down":"up":t>0?"right":"left";return function(n,r,o){let s=n.selection,a=t>0?s.$to:s.$from,l=s.empty;if(s instanceof G){if(!o.endOfTextblock(e)||a.depth==0)return!1;l=!1,a=n.doc.resolve(t>0?a.after():a.before())}let c=Oe.findGapCursorFrom(a,t,l);return c?(r&&r(n.tr.setSelection(new Oe(c))),!0):!1}}function ST(i,t,e){if(!i||!i.editable)return!1;let n=i.state.doc.resolve(t);if(!Oe.valid(n))return!1;let r=i.posAtCoords({left:e.clientX,top:e.clientY});return r&&r.inside>-1&&Y.isSelectable(i.state.doc.nodeAt(r.inside))?!1:(i.dispatch(i.state.tr.setSelection(new Oe(n))),!0)}function kT(i,t){if(t.inputType!="insertCompositionText"||!(i.state.selection instanceof Oe))return!1;let{$from:e}=i.state.selection,n=e.parent.contentMatchAt(e.index()).findWrapping(i.state.schema.nodes.text);if(!n)return!1;let r=z.empty;for(let s=n.length-1;s>=0;s--)r=z.from(n[s].createAndFill(null,r));let o=i.state.tr.replace(e.pos,e.pos,new q(r,0,0));return o.setSelection(G.near(o.doc.resolve(e.pos+1))),i.dispatch(o),!1}function wT(i){if(!(i.selection instanceof Oe))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",me.create(i.doc,[Me.widget(i.selection.head,t,{key:"gapcursor"})])}var Ma=200,rt=function(){};rt.prototype.append=function(t){return t.length?(t=rt.from(t),!this.length&&t||t.length<Ma&&this.leafAppend(t)||this.length<Ma&&t.leafPrepend(this)||this.appendInner(t)):this};rt.prototype.prepend=function(t){return t.length?rt.from(t).append(this):this};rt.prototype.appendInner=function(t){return new MT(this,t)};rt.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.length),t>=e?rt.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))};rt.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};rt.prototype.forEach=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)};rt.prototype.map=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=this.length);var r=[];return this.forEach(function(o,s){return r.push(t(o,s))},e,n),r};rt.from=function(t){return t instanceof rt?t:t&&t.length?new u0(t):rt.empty};var u0=function(i){function t(n){i.call(this),this.values=n}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(r,o){return r==0&&o==this.length?this:new t(this.values.slice(r,o))},t.prototype.getInner=function(r){return this.values[r]},t.prototype.forEachInner=function(r,o,s,a){for(var l=o;l<s;l++)if(r(this.values[l],a+l)===!1)return!1},t.prototype.forEachInvertedInner=function(r,o,s,a){for(var l=o-1;l>=s;l--)if(r(this.values[l],a+l)===!1)return!1},t.prototype.leafAppend=function(r){if(this.length+r.length<=Ma)return new t(this.values.concat(r.flatten()))},t.prototype.leafPrepend=function(r){if(this.length+r.length<=Ma)return new t(r.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t}(rt);rt.empty=new u0([]);var MT=function(i){function t(e,n){i.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},t.prototype.forEachInner=function(n,r,o,s){var a=this.left.length;if(r<a&&this.left.forEachInner(n,r,Math.min(o,a),s)===!1||o>a&&this.right.forEachInner(n,Math.max(r-a,0),Math.min(this.length,o)-a,s+a)===!1)return!1},t.prototype.forEachInvertedInner=function(n,r,o,s){var a=this.left.length;if(r>a&&this.right.forEachInvertedInner(n,r-a,Math.max(o,a)-a,s+a)===!1||o<a&&this.left.forEachInvertedInner(n,Math.min(r,a),o,s)===!1)return!1},t.prototype.sliceInner=function(n,r){if(n==0&&r==this.length)return this;var o=this.left.length;return r<=o?this.left.slice(n,r):n>=o?this.right.slice(n-o,r-o):this.left.slice(n,o).append(this.right.slice(0,r-o))},t.prototype.leafAppend=function(n){var r=this.right.leafAppend(n);if(r)return new t(this.left,r)},t.prototype.leafPrepend=function(n){var r=this.left.leafPrepend(n);if(r)return new t(r,this.right)},t.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new t(this.left,new t(this.right,n)):new t(this,n)},t}(rt),yd=rt;var TT=500,It=class{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let r,o;e&&(r=this.remapping(n,this.items.length),o=r.maps.length);let s=t.tr,a,l,c=[],u=[];return this.items.forEach((d,h)=>{if(!d.step){r||(r=this.remapping(n,h+1),o=r.maps.length),o--,u.push(d);return}if(r){u.push(new Wt(d.map));let f=d.step.map(r.slice(o)),p;f&&s.maybeStep(f).doc&&(p=s.mapping.maps[s.mapping.maps.length-1],c.push(new Wt(p,void 0,void 0,c.length+u.length))),o--,p&&r.appendMap(p,o)}else s.maybeStep(d.step);if(d.selection)return a=r?d.selection.map(r.slice(o)):d.selection,l=new It(this.items.slice(0,n).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:a}}addTransform(t,e,n,r){let o=[],s=this.eventCount,a=this.items,l=!r&&a.length?a.get(a.length-1):null;for(let u=0;u<t.steps.length;u++){let d=t.steps[u].invert(t.docs[u]),h=new Wt(t.mapping.maps[u],d,e),f;(f=l&&l.merge(h))&&(h=f,u?o.pop():a=a.slice(0,a.length-1)),o.push(h),e&&(s++,e=void 0),r||(l=h)}let c=s-n.depth;return c>LT&&(a=CT(a,c),s-=c),new It(a.append(o),s)}remapping(t,e){let n=new Kn;return this.items.forEach((r,o)=>{let s=r.mirrorOffset!=null&&o-r.mirrorOffset>=t?n.maps.length-r.mirrorOffset:void 0;n.appendMap(r.map,s)},t,e),n}addMaps(t){return this.eventCount==0?this:new It(this.items.append(t.map(e=>new Wt(e))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-e),o=t.mapping,s=t.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},r);let l=e;this.items.forEach(h=>{let f=o.getMirror(--l);if(f==null)return;s=Math.min(s,f);let p=o.maps[f];if(h.step){let m=t.steps[f].invert(t.docs[f]),g=h.selection&&h.selection.map(o.slice(l+1,f));g&&a++,n.push(new Wt(p,m,g))}else n.push(new Wt(p))},r);let c=[];for(let h=e;h<s;h++)c.push(new Wt(o.maps[h]));let u=this.items.slice(0,r).append(c).append(n),d=new It(u,a);return d.emptyItemCount()>TT&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let t=0;return this.items.forEach(e=>{e.step||t++}),t}compress(t=this.items.length){let e=this.remapping(0,t),n=e.maps.length,r=[],o=0;return this.items.forEach((s,a)=>{if(a>=t)r.push(s),s.selection&&o++;else if(s.step){let l=s.step.map(e.slice(n)),c=l&&l.getMap();if(n--,c&&e.appendMap(c,n),l){let u=s.selection&&s.selection.map(e.slice(n));u&&o++;let d=new Wt(c.invert(),l,u),h,f=r.length-1;(h=r.length&&r[f].merge(d))?r[f]=h:r.push(d)}}else s.map&&n--},this.items.length,0),new It(yd.from(r.reverse()),o)}};It.empty=new It(yd.empty,0);function CT(i,t){let e;return i.forEach((n,r)=>{if(n.selection&&t--==0)return e=r,!1}),i.slice(e)}var Wt=class{constructor(t,e,n,r){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new Wt(e.getMap().invert(),e,this.selection)}}},mn=class{constructor(t,e,n,r,o){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=r,this.prevComposition=o}},LT=20;function RT(i,t,e,n){let r=e.getMeta(Ni),o;if(r)return r.historyState;e.getMeta(NT)&&(i=new mn(i.done,i.undone,null,0,-1));let s=e.getMeta("appendedTransaction");if(e.steps.length==0)return i;if(s&&s.getMeta(Ni))return s.getMeta(Ni).redo?new mn(i.done.addTransform(e,void 0,n,Ta(t)),i.undone,d0(e.mapping.maps),i.prevTime,i.prevComposition):new mn(i.done,i.undone.addTransform(e,void 0,n,Ta(t)),null,i.prevTime,i.prevComposition);if(e.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let a=e.getMeta("composition"),l=i.prevTime==0||!s&&i.prevComposition!=a&&(i.prevTime<(e.time||0)-n.newGroupDelay||!AT(e,i.prevRanges)),c=s?vd(i.prevRanges,e.mapping):d0(e.mapping.maps);return new mn(i.done.addTransform(e,l?t.selection.getBookmark():void 0,n,Ta(t)),It.empty,c,e.time,a==null?i.prevComposition:a)}else return(o=e.getMeta("rebased"))?new mn(i.done.rebased(e,o),i.undone.rebased(e,o),vd(i.prevRanges,e.mapping),i.prevTime,i.prevComposition):new mn(i.done.addMaps(e.mapping.maps),i.undone.addMaps(e.mapping.maps),vd(i.prevRanges,e.mapping),i.prevTime,i.prevComposition)}function AT(i,t){if(!t)return!1;if(!i.docChanged)return!0;let e=!1;return i.mapping.maps[0].forEach((n,r)=>{for(let o=0;o<t.length;o+=2)n<=t[o+1]&&r>=t[o]&&(e=!0)}),e}function d0(i){let t=[];for(let e=i.length-1;e>=0&&t.length==0;e--)i[e].forEach((n,r,o,s)=>t.push(o,s));return t}function vd(i,t){if(!i)return null;let e=[];for(let n=0;n<i.length;n+=2){let r=t.map(i[n],1),o=t.map(i[n+1],-1);r<=o&&e.push(r,o)}return e}function IT(i,t,e){let n=Ta(t),r=Ni.get(t).spec.config,o=(e?i.undone:i.done).popEvent(t,n);if(!o)return null;let s=o.selection.resolve(o.transform.doc),a=(e?i.done:i.undone).addTransform(o.transform,t.selection.getBookmark(),r,n),l=new mn(e?a:o.remaining,e?o.remaining:a,null,0,-1);return o.transform.setSelection(s).setMeta(Ni,{redo:e,historyState:l})}var Ed=!1,h0=null;function Ta(i){let t=i.plugins;if(h0!=t){Ed=!1,h0=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Ed=!0;break}}return Ed}var Ni=new se("history"),NT=new se("closeHistory");function p0(i={}){return i={depth:i.depth||100,newGroupDelay:i.newGroupDelay||500},new X({key:Ni,state:{init(){return new mn(It.empty,It.empty,null,0,-1)},apply(t,e,n){return RT(e,n,t,i)}},config:i,props:{handleDOMEvents:{beforeinput(t,e){let n=e.inputType,r=n=="historyUndo"?xd:n=="historyRedo"?Sd:null;return r?(e.preventDefault(),r(t.state,t.dispatch)):!1}}}})}function Ca(i,t){return(e,n)=>{let r=Ni.getState(e);if(!r||(i?r.undone:r.done).eventCount==0)return!1;if(n){let o=IT(r,e,i);o&&n(t?o.scrollIntoView():o)}return!0}}var xd=Ca(!1,!0),Sd=Ca(!0,!0),MB=Ca(!1,!1),TB=Ca(!0,!1);var NB=ue.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:i=>i.length,wordCounter:i=>i.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=i=>{let t=(i==null?void 0:i.node)||this.editor.state.doc;if(((i==null?void 0:i.mode)||this.options.mode)==="textSize"){let n=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(n)}return t.nodeSize},this.storage.words=i=>{let t=(i==null?void 0:i.node)||this.editor.state.doc,e=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(e)}},addProseMirrorPlugins(){let i=!1;return[new X({key:new se("characterCount"),appendTransaction:(t,e,n)=>{if(i)return;let r=this.options.limit;if(r==null||r===0){i=!0;return}let o=this.storage.characters({node:n.doc});if(o>r){let s=o-r,a=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${r} characters. Content was automatically trimmed.`);let c=n.tr.deleteRange(a,l);return i=!0,c}i=!0},filterTransaction:(t,e)=>{let n=this.options.limit;if(!t.docChanged||n===0||n===null||n===void 0)return!0;let r=this.storage.characters({node:e.doc}),o=this.storage.characters({node:t.doc});if(o<=n||r>n&&o>n&&o<=r)return!0;if(r>n&&o>n&&o>r||!t.getMeta("paste"))return!1;let a=t.selection.$head.pos,l=o-n,c=a-l,u=a;return t.deleteRange(c,u),!(this.storage.characters({node:t.doc})>n)}})]}}),m0=ue.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[l0(this.options)]}}),FB=ue.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new X({key:new se("focus"),props:{decorations:({doc:i,selection:t})=>{let{isEditable:e,isFocused:n}=this.editor,{anchor:r}=t,o=[];if(!e||!n)return me.create(i,[]);let s=0;this.options.mode==="deepest"&&i.descendants((l,c)=>{if(l.isText)return;if(!(r>=c&&r<=c+l.nodeSize-1))return!1;s+=1});let a=0;return i.descendants((l,c)=>{if(l.isText||!(r>=c&&r<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&s-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";o.push(Me.node(c,c+l.nodeSize,{class:this.options.className}))}),me.create(i,o)}}})]}}),g0=ue.create({name:"gapCursor",addProseMirrorPlugins(){return[c0()]},extendNodeSchema(i){var t;let e={name:i.name,options:i.options,storage:i.storage};return{allowGapCursor:(t=we(Z(i,"allowGapCursor",e)))!=null?t:null}}}),UB=ue.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something \u2026",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new X({key:new se("placeholder"),props:{decorations:({doc:i,selection:t})=>{let e=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=t,r=[];if(!e)return null;let o=this.editor.isEmpty;return i.descendants((s,a)=>{let l=n>=a&&n<=a+s.nodeSize,c=!s.isLeaf&&ao(s);if((l||!this.options.showOnlyCurrent)&&c){let u=[this.options.emptyNodeClass];o&&u.push(this.options.emptyEditorClass);let d=Me.node(a,a+s.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:a,hasAnchor:l}):this.options.placeholder});r.push(d)}return this.options.includeChildren}),me.create(i,r)}}})]}}),jB=ue.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){let{editor:i,options:t}=this;return[new X({key:new se("selection"),props:{decorations(e){return e.selection.empty||i.isFocused||!i.isEditable||$s(e.selection)||i.view.dragging?null:me.create(e.doc,[Me.inline(e.selection.from,e.selection.to,{class:t.className})])}}})]}});function f0({types:i,node:t}){return t&&Array.isArray(i)&&i.includes(t.type)||(t==null?void 0:t.type)===i}var b0=ue.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){let i=new se(this.name),t=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(this.options.node).includes(e.name));return[new X({key:i,appendTransaction:(e,n,r)=>{let{doc:o,tr:s,schema:a}=r,l=i.getState(r),c=o.content.size,u=a.nodes[this.options.node];if(l)return s.insert(c,u.create())},state:{init:(e,n)=>{let r=n.tr.doc.lastChild;return!f0({node:r,types:t})},apply:(e,n)=>{if(!e.docChanged)return n;let r=e.doc.lastChild;return!f0({node:r,types:t})}}})]}}),y0=ue.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:i,dispatch:t})=>xd(i,t),redo:()=>({state:i,dispatch:t})=>Sd(i,t)}},addProseMirrorPlugins(){return[p0(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}});var PT=ue.create({name:"starterKit",addExtensions(){var i,t,e,n;let r=[];return this.options.bold!==!1&&r.push(Iu.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(Au.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(gr.configure(this.options.bulletList)),this.options.code!==!1&&r.push(Nu.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(Pu.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(_u.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(m0.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(g0.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push(Ou.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push(Du.configure(this.options.heading)),this.options.undoRedo!==!1&&r.push(y0.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&r.push(Bu.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(Fu.configure(this.options.italic)),this.options.listItem!==!1&&r.push(br.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(hd.configure((i=this.options)==null?void 0:i.listKeymap)),this.options.link!==!1&&r.push(ld.configure((t=this.options)==null?void 0:t.link)),this.options.orderedList!==!1&&r.push(yr.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(pd.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(fd.configure(this.options.strike)),this.options.text!==!1&&r.push(md.configure(this.options.text)),this.options.underline!==!1&&r.push(gd.configure((e=this.options)==null?void 0:e.underline)),this.options.trailingNode!==!1&&r.push(b0.configure((n=this.options)==null?void 0:n.trailingNode)),r}}),v0=PT;var E0=gr;var x0=yr;var S0=br;var k0=ue.create({name:"disableShortcuts",addKeyboardShortcuts(){return{Enter:({editor:i})=>i.isEditable?i.isActive("listItem")?i.commands.splitListItem("listItem"):i.commands.splitBlock():!0,"Shift-Enter":({editor:i})=>i.isEditable?i.commands.setHardBreak():!0,Tab:({editor:i})=>i.isEditable&&i.isActive("listItem")?i.commands.sinkListItem("listItem"):!0,"Shift-Tab":({editor:i})=>i.isEditable&&i.isActive("listItem")?i.commands.liftListItem("listItem"):!0,"Mod-b":()=>!0,"Mod-B":()=>!0,"Mod-Shift-b":()=>!0,"Mod-Shift-B":()=>!0,"Mod-i":()=>!0,"Mod-I":()=>!0,"Mod-Shift-i":()=>!0,"Mod-Shift-I":()=>!0,"Mod-e":()=>!0,"Mod-E":()=>!0,"Mod-Shift-e":()=>!0,"Mod-Shift-E":()=>!0,"Mod-Shift-x":()=>!0,"Mod-Shift-X":()=>!0,"Mod-Shift-1":()=>!0,"Mod-Shift-2":()=>!0,"Mod-Shift-3":()=>!0,"Mod-Shift-7":()=>!0,"Mod-Shift-8":()=>!0,"Mod-Shift-9":()=>!0,"Mod-Alt-c":()=>!0,"Mod-Alt-C":()=>!0,"Mod-s":()=>!0,"Mod-S":()=>!0,"Mod-Shift-s":()=>!0,"Mod-Shift-S":()=>!0}},priority:1e3});var w0=ue.create({name:"verticalArrowKeys",addOptions(){return{isVertical:()=>!1}},addKeyboardShortcuts(){return{ArrowLeft:({editor:i})=>{var o;if(!this.options.isVertical())return!1;let{state:t}=i,{$anchor:e}=t.selection,n=e.parent;if(n.type.name==="paragraph"&&n.childCount===0||n.type.name==="paragraph"&&n.childCount===1&&((o=n.firstChild)==null?void 0:o.type.name)==="hardBreak"){let s=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",bubbles:!0,cancelable:!0});return i.view.dom.dispatchEvent(s),!0}return!1},ArrowRight:({editor:i})=>{var o;if(!this.options.isVertical())return!1;let{state:t}=i,{$anchor:e}=t.selection,n=e.parent;if(n.type.name==="paragraph"&&n.childCount===0||n.type.name==="paragraph"&&n.childCount===1&&((o=n.firstChild)==null?void 0:o.type.name)==="hardBreak"){let s=new KeyboardEvent("keydown",{key:"ArrowUp",code:"ArrowUp",bubbles:!0,cancelable:!0});return i.view.dom.dispatchEvent(s),!0}return!1}}},priority:900});var T0=ue.create({name:"listItemMove",addOptions(){return{isVertical:()=>!1}},addKeyboardShortcuts(){let i=()=>this.editor.isEditable?this.editor.commands.moveListItemUp():!1,t=()=>this.editor.isEditable?this.editor.commands.moveListItemDown():!1;return{"Mod-ArrowUp":()=>this.options.isVertical()?!1:i(),"Mod-ArrowDown":()=>this.options.isVertical()?!1:t(),"Mod-ArrowRight":()=>this.options.isVertical()?i():!1,"Mod-ArrowLeft":()=>this.options.isVertical()?t():!1}},addCommands(){return{moveListItemUp:()=>({state:i,dispatch:t})=>this.editor.isEditable?M0(i,t,"up"):!1,moveListItemDown:()=>({state:i,dispatch:t})=>this.editor.isEditable?M0(i,t,"down"):!1}}});function M0(i,t,e){let{$from:n}=i.selection,r=-1,o=null;for(let y=n.depth;y>0;y--){let E=n.node(y);if(E.type.name==="listItem"){r=y,o=E;break}}if(r===-1||!o)return!1;let s=r-1;if(s<1)return!1;let a=n.node(s);if(a.type.name!=="bulletList"&&a.type.name!=="orderedList")return!1;let l=n.index(s),c=e==="up"?l-1:l+1;if(c<0||c>=a.childCount)return!1;if(!t)return!0;let d=n.before(s)+1,h=[];for(let y=0;y<a.childCount;y++){let E=a.child(y);h.push({start:d,end:d+E.nodeSize,node:E}),d+=E.nodeSize}let f=h[l],p=h[c];if(!f||!p)return!1;let m=i.tr,g=n.pos-f.start;e==="up"?(m.delete(f.start,f.end),m.insert(p.start,f.node)):(m.delete(p.start,p.end),m.insert(f.start,p.node));let b;e==="up"?b=p.start+g:b=f.start+p.node.nodeSize+g;let v=m.doc.content.size;b=Math.max(1,Math.min(b,v-1));try{m.setSelection(G.create(m.doc,b))}catch(y){try{let E=e==="up"?p.start+1:f.start+p.node.nodeSize+1;m.setSelection(G.create(m.doc,Math.max(1,Math.min(E,v-1))))}catch(E){}}return t(m),!0}var G0=Go(q0(),1);var j0=G0.default;function J0(i,t=[]){return i.flatMap(e=>{let n=[...t,...e.properties?e.properties.className:[]];return e.children?J0(e.children,n):{text:e.value,classes:n}})}function Y0(i){return i.value||i.children||[]}function kC(i){return Boolean(j0.getLanguage(i))}function X0({doc:i,name:t,lowlight:e,defaultLanguage:n}){let r=[];return Hs(i,o=>o.type.name===t).forEach(o=>{var s;let a=o.pos+1,l=o.node.attrs.language||n,c=e.listLanguages(),u=l&&(c.includes(l)||kC(l)||(s=e.registered)!=null&&s.call(e,l))?Y0(e.highlight(l,o.node.textContent)):Y0(e.highlightAuto(o.node.textContent));J0(u).forEach(d=>{let h=a+d.text.length;if(d.classes.length){let f=Me.inline(a,h,{class:d.classes.join(" ")});r.push(f)}a=h})}),me.create(i,r)}function wC(i){return typeof i=="function"}function MC({name:i,lowlight:t,defaultLanguage:e}){if(!["highlight","highlightAuto","listLanguages"].every(r=>wC(t[r])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");let n=new X({key:new se("lowlight"),state:{init:(r,{doc:o})=>X0({doc:o,name:i,lowlight:t,defaultLanguage:e}),apply:(r,o,s,a)=>{let l=s.selection.$head.parent.type.name,c=a.selection.$head.parent.type.name,u=Hs(s.doc,h=>h.type.name===i),d=Hs(a.doc,h=>h.type.name===i);return r.docChanged&&([l,c].includes(i)||d.length!==u.length||r.steps.some(h=>h.from!==void 0&&h.to!==void 0&&u.some(f=>f.pos>=h.from&&f.pos+f.node.nodeSize<=h.to)))?X0({doc:r.doc,name:i,lowlight:t,defaultLanguage:e}):o.map(r.mapping,r.doc)}},props:{decorations(r){return n.getState(r)}}});return n}var TC=Cg.extend({addOptions(){var i;return{...(i=this.parent)==null?void 0:i.call(this),lowlight:{},languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},addProseMirrorPlugins(){var i;return[...((i=this.parent)==null?void 0:i.call(this))||[],MC({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),Z0=TC;function CC(i){let t=i.regex,e=i.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),n="decltype\\(auto\\)",r="[a-zA-Z_]\\w*::",o="<[^<>]+>",s="(?!struct)("+n+"|"+t.optional(r)+"[a-zA-Z_]\\w*"+t.optional(o)+")",a={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},l="\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)",c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[i.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+l+"|.)",end:"'",illegal:"."},i.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},u={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},d={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},i.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},e,i.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:t.optional(r)+i.IDENT_RE,relevance:0},f=t.optional(r)+i.IDENT_RE+"\\s*\\(",p=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],m=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],g=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],b=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],E={type:m,keyword:p,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:g},x={className:"function.dispatch",relevance:0,keywords:{_hint:b},begin:t.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,i.IDENT_RE,t.lookahead(/(<[^<>]+>|)\s*\(/))},S=[x,d,a,e,i.C_BLOCK_COMMENT_MODE,u,c],w={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:E,contains:S.concat([{begin:/\(/,end:/\)/,keywords:E,contains:S.concat(["self"]),relevance:0}]),relevance:0},k={className:"function",begin:"("+s+"[\\*&\\s]+)+"+f,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:E,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:n,keywords:E,relevance:0},{begin:f,returnBegin:!0,contains:[h],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[c,u]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:[e,i.C_BLOCK_COMMENT_MODE,c,u,a,{begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:["self",e,i.C_BLOCK_COMMENT_MODE,c,u,a]}]},a,e,i.C_BLOCK_COMMENT_MODE,d]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:E,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(w,k,x,S,[d,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function)\\s*<(?!<)",end:">",keywords:E,contains:["self",a]},{begin:i.IDENT_RE+"::",keywords:E},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}function Q0(i){let t={type:["boolean","byte","word","String"],built_in:["KeyboardController","MouseController","SoftwareSerial","EthernetServer","EthernetClient","LiquidCrystal","RobotControl","GSMVoiceCall","EthernetUDP","EsploraTFT","HttpClient","RobotMotor","WiFiClient","GSMScanner","FileSystem","Scheduler","GSMServer","YunClient","YunServer","IPAddress","GSMClient","GSMModem","Keyboard","Ethernet","Console","GSMBand","Esplora","Stepper","Process","WiFiUDP","GSM_SMS","Mailbox","USBHost","Firmata","PImage","Client","Server","GSMPIN","FileIO","Bridge","Serial","EEPROM","Stream","Mouse","Audio","Servo","File","Task","GPRS","WiFi","Wire","TFT","GSM","SPI","SD"],_hints:["setup","loop","runShellCommandAsynchronously","analogWriteResolution","retrieveCallingNumber","printFirmwareVersion","analogReadResolution","sendDigitalPortPair","noListenOnLocalhost","readJoystickButton","setFirmwareVersion","readJoystickSwitch","scrollDisplayRight","getVoiceCallStatus","scrollDisplayLeft","writeMicroseconds","delayMicroseconds","beginTransmission","getSignalStrength","runAsynchronously","getAsynchronously","listenOnLocalhost","getCurrentCarrier","readAccelerometer","messageAvailable","sendDigitalPorts","lineFollowConfig","countryNameWrite","runShellCommand","readStringUntil","rewindDirectory","readTemperature","setClockDivider","readLightSensor","endTransmission","analogReference","detachInterrupt","countryNameRead","attachInterrupt","encryptionType","readBytesUntil","robotNameWrite","readMicrophone","robotNameRead","cityNameWrite","userNameWrite","readJoystickY","readJoystickX","mouseReleased","openNextFile","scanNetworks","noInterrupts","digitalWrite","beginSpeaker","mousePressed","isActionDone","mouseDragged","displayLogos","noAutoscroll","addParameter","remoteNumber","getModifiers","keyboardRead","userNameRead","waitContinue","processInput","parseCommand","printVersion","readNetworks","writeMessage","blinkVersion","cityNameRead","readMessage","setDataMode","parsePacket","isListening","setBitOrder","beginPacket","isDirectory","motorsWrite","drawCompass","digitalRead","clearScreen","serialEvent","rightToLeft","setTextSize","leftToRight","requestFrom","keyReleased","compassRead","analogWrite","interrupts","WiFiServer","disconnect","playMelody","parseFloat","autoscroll","getPINUsed","setPINUsed","setTimeout","sendAnalog","readSlider","analogRead","beginWrite","createChar","motorsStop","keyPressed","tempoWrite","readButton","subnetMask","debugPrint","macAddress","writeGreen","randomSeed","attachGPRS","readString","sendString","remotePort","releaseAll","mouseMoved","background","getXChange","getYChange","answerCall","getResult","voiceCall","endPacket","constrain","getSocket","writeJSON","getButton","available","connected","findUntil","readBytes","exitValue","readGreen","writeBlue","startLoop","IPAddress","isPressed","sendSysex","pauseMode","gatewayIP","setCursor","getOemKey","tuneWrite","noDisplay","loadImage","switchPIN","onRequest","onReceive","changePIN","playFile","noBuffer","parseInt","overflow","checkPIN","knobRead","beginTFT","bitClear","updateIR","bitWrite","position","writeRGB","highByte","writeRed","setSpeed","readBlue","noStroke","remoteIP","transfer","shutdown","hangCall","beginSMS","endWrite","attached","maintain","noCursor","checkReg","checkPUK","shiftOut","isValid","shiftIn","pulseIn","connect","println","localIP","pinMode","getIMEI","display","noBlink","process","getBand","running","beginSD","drawBMP","lowByte","setBand","release","bitRead","prepare","pointTo","readRed","setMode","noFill","remove","listen","stroke","detach","attach","noTone","exists","buffer","height","bitSet","circle","config","cursor","random","IRread","setDNS","endSMS","getKey","micros","millis","begin","print","write","ready","flush","width","isPIN","blink","clear","press","mkdir","rmdir","close","point","yield","image","BSSID","click","delay","read","text","move","peek","beep","rect","line","open","seek","fill","size","turn","stop","home","find","step","tone","sqrt","RSSI","SSID","end","bit","tan","cos","sin","pow","map","abs","max","min","get","run","put"],literal:["DIGITAL_MESSAGE","FIRMATA_STRING","ANALOG_MESSAGE","REPORT_DIGITAL","REPORT_ANALOG","INPUT_PULLUP","SET_PIN_MODE","INTERNAL2V56","SYSTEM_RESET","LED_BUILTIN","INTERNAL1V1","SYSEX_START","INTERNAL","EXTERNAL","DEFAULT","OUTPUT","INPUT","HIGH","LOW"]},e=CC(i),n=e.keywords;return n.type=[...n.type,...t.type],n.literal=[...n.literal,...t.literal],n.built_in=[...n.built_in,...t.built_in],n._hints=t._hints,e.name="Arduino",e.aliases=["ino"],e.supersetOf="cpp",e}function eb(i){let t=i.regex,e={},n={begin:/\$\{/,end:/\}/,contains:["self",{begin:/:-/,contains:[e]}]};Object.assign(e,{className:"variable",variants:[{begin:t.concat(/\$[\w\d#@][\w\d_]*/,"(?![\\w\\d])(?![$])")},n]});let r={className:"subst",begin:/\$\(/,end:/\)/,contains:[i.BACKSLASH_ESCAPE]},o={begin:/<<-?\s*(?=\w+)/,starts:{contains:[i.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,className:"string"})]}},s={className:"string",begin:/"/,end:/"/,contains:[i.BACKSLASH_ESCAPE,e,r]};r.contains.push(s);let a={className:"",begin:/\\"/},l={className:"string",begin:/'/,end:/'/},c={begin:/\$?\(\(/,end:/\)\)/,contains:[{begin:/\d+#[0-9a-f]+/,className:"number"},i.NUMBER_MODE,e]},u=["fish","bash","zsh","sh","csh","ksh","tcsh","dash","scsh"],d=i.SHEBANG({binary:`(${u.join("|")})`,relevance:10}),h={className:"function",begin:/\w[\w\d_]*\s*\(\s*\)\s*\{/,returnBegin:!0,contains:[i.inherit(i.TITLE_MODE,{begin:/\w[\w\d_]*/})],relevance:0},f=["if","then","else","elif","fi","for","while","until","in","do","done","case","esac","function","select"],p=["true","false"],m={match:/(\/[a-z._-]+)+/},g=["break","cd","continue","eval","exec","exit","export","getopts","hash","pwd","readonly","return","shift","test","times","trap","umask","unset"],b=["alias","bind","builtin","caller","command","declare","echo","enable","help","let","local","logout","mapfile","printf","read","readarray","source","type","typeset","ulimit","unalias"],v=["autoload","bg","bindkey","bye","cap","chdir","clone","comparguments","compcall","compctl","compdescribe","compfiles","compgroups","compquote","comptags","comptry","compvalues","dirs","disable","disown","echotc","echoti","emulate","fc","fg","float","functions","getcap","getln","history","integer","jobs","kill","limit","log","noglob","popd","print","pushd","pushln","rehash","sched","setcap","setopt","stat","suspend","ttyctl","unfunction","unhash","unlimit","unsetopt","vared","wait","whence","where","which","zcompile","zformat","zftp","zle","zmodload","zparseopts","zprof","zpty","zregexparse","zsocket","zstyle","ztcp"],y=["chcon","chgrp","chown","chmod","cp","dd","df","dir","dircolors","ln","ls","mkdir","mkfifo","mknod","mktemp","mv","realpath","rm","rmdir","shred","sync","touch","truncate","vdir","b2sum","base32","base64","cat","cksum","comm","csplit","cut","expand","fmt","fold","head","join","md5sum","nl","numfmt","od","paste","ptx","pr","sha1sum","sha224sum","sha256sum","sha384sum","sha512sum","shuf","sort","split","sum","tac","tail","tr","tsort","unexpand","uniq","wc","arch","basename","chroot","date","dirname","du","echo","env","expr","factor","groups","hostid","id","link","logname","nice","nohup","nproc","pathchk","pinky","printenv","printf","pwd","readlink","runcon","seq","sleep","stat","stdbuf","stty","tee","test","timeout","tty","uname","unlink","uptime","users","who","whoami","yes"];return{name:"Bash",aliases:["sh"],keywords:{$pattern:/\b[a-z][a-z0-9._-]+\b/,keyword:f,literal:p,built_in:[...g,...b,"set","shopt",...v,...y]},contains:[d,i.SHEBANG(),h,c,i.HASH_COMMENT_MODE,o,m,s,a,l,e]}}function tb(i){let t=i.regex,e=i.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),n="decltype\\(auto\\)",r="[a-zA-Z_]\\w*::",o="<[^<>]+>",s="("+n+"|"+t.optional(r)+"[a-zA-Z_]\\w*"+t.optional(o)+")",a={className:"type",variants:[{begin:"\\b[a-z\\d_]*_t\\b"},{match:/\batomic_[a-z]{3,6}\b/}]},l="\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)",c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[i.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+l+"|.)",end:"'",illegal:"."},i.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},u={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},d={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},i.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},e,i.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:t.optional(r)+i.IDENT_RE,relevance:0},f=t.optional(r)+i.IDENT_RE+"\\s*\\(",g={keyword:["asm","auto","break","case","continue","default","do","else","enum","extern","for","fortran","goto","if","inline","register","restrict","return","sizeof","struct","switch","typedef","union","volatile","while","_Alignas","_Alignof","_Atomic","_Generic","_Noreturn","_Static_assert","_Thread_local","alignas","alignof","noreturn","static_assert","thread_local","_Pragma"],type:["float","double","signed","unsigned","int","short","long","char","void","_Bool","_Complex","_Imaginary","_Decimal32","_Decimal64","_Decimal128","const","static","complex","bool","imaginary"],literal:"true false NULL",built_in:"std string wstring cin cout cerr clog stdin stdout stderr stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set pair bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap priority_queue make_pair array shared_ptr abort terminate abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf future isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc realloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf endl initializer_list unique_ptr"},b=[d,a,e,i.C_BLOCK_COMMENT_MODE,u,c],v={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:g,contains:b.concat([{begin:/\(/,end:/\)/,keywords:g,contains:b.concat(["self"]),relevance:0}]),relevance:0},y={begin:"("+s+"[\\*&\\s]+)+"+f,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:g,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:n,keywords:g,relevance:0},{begin:f,returnBegin:!0,contains:[i.inherit(h,{className:"title.function"})],relevance:0},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:g,relevance:0,contains:[e,i.C_BLOCK_COMMENT_MODE,c,u,a,{begin:/\(/,end:/\)/,keywords:g,relevance:0,contains:["self",e,i.C_BLOCK_COMMENT_MODE,c,u,a]}]},a,e,i.C_BLOCK_COMMENT_MODE,d]};return{name:"C",aliases:["h"],keywords:g,disableAutodetect:!0,illegal:"</",contains:[].concat(v,y,b,[d,{begin:i.IDENT_RE+"::",keywords:g},{className:"class",beginKeywords:"enum class struct union",end:/[{;:<>=]/,contains:[{beginKeywords:"final class struct"},i.TITLE_MODE]}]),exports:{preprocessor:d,strings:c,keywords:g}}}function nb(i){let t=i.regex,e=i.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),n="decltype\\(auto\\)",r="[a-zA-Z_]\\w*::",o="<[^<>]+>",s="(?!struct)("+n+"|"+t.optional(r)+"[a-zA-Z_]\\w*"+t.optional(o)+")",a={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},l="\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)",c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[i.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+l+"|.)",end:"'",illegal:"."},i.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},u={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},d={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},i.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},e,i.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:t.optional(r)+i.IDENT_RE,relevance:0},f=t.optional(r)+i.IDENT_RE+"\\s*\\(",p=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],m=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],g=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],b=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],E={type:m,keyword:p,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:g},x={className:"function.dispatch",relevance:0,keywords:{_hint:b},begin:t.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,i.IDENT_RE,t.lookahead(/(<[^<>]+>|)\s*\(/))},S=[x,d,a,e,i.C_BLOCK_COMMENT_MODE,u,c],w={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:E,contains:S.concat([{begin:/\(/,end:/\)/,keywords:E,contains:S.concat(["self"]),relevance:0}]),relevance:0},k={className:"function",begin:"("+s+"[\\*&\\s]+)+"+f,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:E,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:n,keywords:E,relevance:0},{begin:f,returnBegin:!0,contains:[h],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[c,u]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:[e,i.C_BLOCK_COMMENT_MODE,c,u,a,{begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:["self",e,i.C_BLOCK_COMMENT_MODE,c,u,a]}]},a,e,i.C_BLOCK_COMMENT_MODE,d]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:E,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(w,k,x,S,[d,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function)\\s*<(?!<)",end:">",keywords:E,contains:["self",a]},{begin:i.IDENT_RE+"::",keywords:E},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}function ib(i){let t=["bool","byte","char","decimal","delegate","double","dynamic","enum","float","int","long","nint","nuint","object","sbyte","short","string","ulong","uint","ushort"],e=["public","private","protected","static","internal","protected","abstract","async","extern","override","unsafe","virtual","new","sealed","partial"],n=["default","false","null","true"],r=["abstract","as","base","break","case","catch","class","const","continue","do","else","event","explicit","extern","finally","fixed","for","foreach","goto","if","implicit","in","interface","internal","is","lock","namespace","new","operator","out","override","params","private","protected","public","readonly","record","ref","return","scoped","sealed","sizeof","stackalloc","static","struct","switch","this","throw","try","typeof","unchecked","unsafe","using","virtual","void","volatile","while"],o=["add","alias","and","ascending","async","await","by","descending","equals","from","get","global","group","init","into","join","let","nameof","not","notnull","on","or","orderby","partial","remove","select","set","unmanaged","value|0","var","when","where","with","yield"],s={keyword:r.concat(o),built_in:t,literal:n},a=i.inherit(i.TITLE_MODE,{begin:"[a-zA-Z](\\.?\\w)*"}),l={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)(u|U|l|L|ul|UL|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},c={className:"string",begin:'@"',end:'"',contains:[{begin:'""'}]},u=i.inherit(c,{illegal:/\n/}),d={className:"subst",begin:/\{/,end:/\}/,keywords:s},h=i.inherit(d,{illegal:/\n/}),f={className:"string",begin:/\$"/,end:'"',illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},i.BACKSLASH_ESCAPE,h]},p={className:"string",begin:/\$@"/,end:'"',contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},d]},m=i.inherit(p,{illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},h]});d.contains=[p,f,c,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,l,i.C_BLOCK_COMMENT_MODE],h.contains=[m,f,u,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,l,i.inherit(i.C_BLOCK_COMMENT_MODE,{illegal:/\n/})];let g={variants:[p,f,c,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE]},b={begin:"<",end:">",contains:[{beginKeywords:"in out"},a]},v=i.IDENT_RE+"(<"+i.IDENT_RE+"(\\s*,\\s*"+i.IDENT_RE+")*>)?(\\[\\])?",y={begin:"@"+i.IDENT_RE,relevance:0};return{name:"C#",aliases:["cs","c#"],keywords:s,illegal:/::/,contains:[i.COMMENT("///","$",{returnBegin:!0,contains:[{className:"doctag",variants:[{begin:"///",relevance:0},{begin:"<!--|-->"},{begin:"</?",end:">"}]}]}),i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,{className:"meta",begin:"#",end:"$",keywords:{keyword:"if else elif endif define undef warning error line region endregion pragma checksum"}},g,l,{beginKeywords:"class interface",relevance:0,end:/[{;=]/,illegal:/[^\s:,]/,contains:[{beginKeywords:"where class"},a,b,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},{beginKeywords:"namespace",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[a,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},{beginKeywords:"record",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[a,b,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},{className:"meta",begin:"^\\s*\\[(?=[\\w])",excludeBegin:!0,end:"\\]",excludeEnd:!0,contains:[{className:"string",begin:/"/,end:/"/}]},{beginKeywords:"new return throw await else",relevance:0},{className:"function",begin:"("+v+"\\s+)+"+i.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,end:/\s*[{;=]/,excludeEnd:!0,keywords:s,contains:[{beginKeywords:e.join(" "),relevance:0},{begin:i.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,contains:[i.TITLE_MODE,b],relevance:0},{match:/\(\)/},{className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:s,relevance:0,contains:[g,l,i.C_BLOCK_COMMENT_MODE]},i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},y]}}var LC=i=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:i.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[i.APOS_STRING_MODE,i.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:i.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),RC=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],AC=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],IC=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],NC=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],PC=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function rb(i){let t=i.regex,e=LC(i),n={begin:/-(webkit|moz|ms|o)-(?=[a-z])/},r="and or not only",o=/@-?\w[\w]*(-\w+)*/,s="[a-zA-Z-][a-zA-Z0-9_-]*",a=[i.APOS_STRING_MODE,i.QUOTE_STRING_MODE];return{name:"CSS",case_insensitive:!0,illegal:/[=|'\$]/,keywords:{keyframePosition:"from to"},classNameAliases:{keyframePosition:"selector-tag"},contains:[e.BLOCK_COMMENT,n,e.CSS_NUMBER_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/,relevance:0},{className:"selector-class",begin:"\\."+s,relevance:0},e.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",variants:[{begin:":("+IC.join("|")+")"},{begin:":(:)?("+NC.join("|")+")"}]},e.CSS_VARIABLE,{className:"attribute",begin:"\\b("+PC.join("|")+")\\b"},{begin:/:/,end:/[;}{]/,contains:[e.BLOCK_COMMENT,e.HEXCOLOR,e.IMPORTANT,e.CSS_NUMBER_MODE,...a,{begin:/(url|data-uri)\(/,end:/\)/,relevance:0,keywords:{built_in:"url data-uri"},contains:[...a,{className:"string",begin:/[^)]/,endsWithParent:!0,excludeEnd:!0}]},e.FUNCTION_DISPATCH]},{begin:t.lookahead(/@/),end:"[{;]",relevance:0,illegal:/:/,contains:[{className:"keyword",begin:o},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:{$pattern:/[a-z-]+/,keyword:r,attribute:AC.join(" ")},contains:[{begin:/[a-z-]+(?=:)/,className:"attribute"},...a,e.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"\\b("+RC.join("|")+")\\b"}]}}function ob(i){let t=i.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:t.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:t.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}function sb(i){let o={keyword:["break","case","chan","const","continue","default","defer","else","fallthrough","for","func","go","goto","if","import","interface","map","package","range","return","select","struct","switch","type","var"],type:["bool","byte","complex64","complex128","error","float32","float64","int8","int16","int32","int64","string","uint8","uint16","uint32","uint64","int","uint","uintptr","rune"],literal:["true","false","iota","nil"],built_in:["append","cap","close","complex","copy","imag","len","make","new","panic","print","println","real","recover","delete"]};return{name:"Go",aliases:["golang"],keywords:o,illegal:"</",contains:[i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,{className:"string",variants:[i.QUOTE_STRING_MODE,i.APOS_STRING_MODE,{begin:"`",end:"`"}]},{className:"number",variants:[{begin:i.C_NUMBER_RE+"[i]",relevance:1},i.C_NUMBER_MODE]},{begin:/:=/},{className:"function",beginKeywords:"func",end:"\\s*(\\{|$)",excludeEnd:!0,contains:[i.TITLE_MODE,{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:o,illegal:/["']/}]}]}}function ab(i){let t=i.regex,e=/[_A-Za-z][_0-9A-Za-z]*/;return{name:"GraphQL",aliases:["gql"],case_insensitive:!0,disableAutodetect:!1,keywords:{keyword:["query","mutation","subscription","type","input","schema","directive","interface","union","scalar","fragment","enum","on"],literal:["true","false","null"]},contains:[i.HASH_COMMENT_MODE,i.QUOTE_STRING_MODE,i.NUMBER_MODE,{scope:"punctuation",match:/[.]{3}/,relevance:0},{scope:"punctuation",begin:/[\!\(\)\:\=\[\]\{\|\}]{1}/,relevance:0},{scope:"variable",begin:/\$/,end:/\W/,excludeEnd:!0,relevance:0},{scope:"meta",match:/@\w+/,excludeEnd:!0},{scope:"symbol",begin:t.concat(e,t.lookahead(/\s*:/)),relevance:0}],illegal:[/[;<']/,/BEGIN/]}}function lb(i){let t=i.regex,e={className:"number",relevance:0,variants:[{begin:/([+-]+)?[\d]+_[\d_]+/},{begin:i.NUMBER_RE}]},n=i.COMMENT();n.variants=[{begin:/;/,end:/$/},{begin:/#/,end:/$/}];let r={className:"variable",variants:[{begin:/\$[\w\d"][\w\d_]*/},{begin:/\$\{(.*?)\}/}]},o={className:"literal",begin:/\bon|off|true|false|yes|no\b/},s={className:"string",contains:[i.BACKSLASH_ESCAPE],variants:[{begin:"'''",end:"'''",relevance:10},{begin:'"""',end:'"""',relevance:10},{begin:'"',end:'"'},{begin:"'",end:"'"}]},a={begin:/\[/,end:/\]/,contains:[n,o,r,s,e,"self"],relevance:0},l=/[A-Za-z0-9_-]+/,c=/"(\\"|[^"])*"/,u=/'[^']*'/,d=t.either(l,c,u),h=t.concat(d,"(\\s*\\.\\s*",d,")*",t.lookahead(/\s*=\s*[^#\s]/));return{name:"TOML, also INI",aliases:["toml"],case_insensitive:!0,illegal:/\S/,contains:[n,{className:"section",begin:/\[+/,end:/\]+/},{begin:h,className:"attr",starts:{end:/$/,contains:[n,a,o,r,s,e]}}]}}var xr="[0-9](_*[0-9])*",Na=`\\.(${xr})`,Pa="[0-9a-fA-F](_*[0-9a-fA-F])*",cb={className:"number",variants:[{begin:`(\\b(${xr})((${Na})|\\.)?|(${Na}))[eE][+-]?(${xr})[fFdD]?\\b`},{begin:`\\b(${xr})((${Na})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${Na})[fFdD]?\\b`},{begin:`\\b(${xr})[fFdD]\\b`},{begin:`\\b0[xX]((${Pa})\\.?|(${Pa})?\\.(${Pa}))[pP][+-]?(${xr})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${Pa})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function ub(i,t,e){return e===-1?"":i.replace(t,n=>ub(i,t,e-1))}function db(i){let t=i.regex,e="[\xC0-\u02B8a-zA-Z_$][\xC0-\u02B8a-zA-Z_$0-9]*",n=e+ub("(?:<"+e+"~~~(?:\\s*,\\s*"+e+"~~~)*>)?",/~~~/g,2),l={keyword:["synchronized","abstract","private","var","static","if","const ","for","while","strictfp","finally","protected","import","native","final","void","enum","else","break","transient","catch","instanceof","volatile","case","assert","package","default","public","try","switch","continue","throws","protected","public","private","module","requires","exports","do","sealed","yield","permits"],literal:["false","true","null"],type:["char","boolean","long","float","int","byte","short","double"],built_in:["super","this"]},c={className:"meta",begin:"@"+e,contains:[{begin:/\(/,end:/\)/,contains:["self"]}]},u={className:"params",begin:/\(/,end:/\)/,keywords:l,relevance:0,contains:[i.C_BLOCK_COMMENT_MODE],endsParent:!0};return{name:"Java",aliases:["jsp"],keywords:l,illegal:/<\/|#/,contains:[i.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{begin:/\w+@/,relevance:0},{className:"doctag",begin:"@[A-Za-z]+"}]}),{begin:/import java\.[a-z]+\./,keywords:"import",relevance:2},i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,{begin:/"""/,end:/"""/,className:"string",contains:[i.BACKSLASH_ESCAPE]},i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,{match:[/\b(?:class|interface|enum|extends|implements|new)/,/\s+/,e],className:{1:"keyword",3:"title.class"}},{match:/non-sealed/,scope:"keyword"},{begin:[t.concat(/(?!else)/,e),/\s+/,e,/\s+/,/=(?!=)/],className:{1:"type",3:"variable",5:"operator"}},{begin:[/record/,/\s+/,e],className:{1:"keyword",3:"title.class"},contains:[u,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},{beginKeywords:"new throw return else",relevance:0},{begin:["(?:"+n+"\\s+)",i.UNDERSCORE_IDENT_RE,/\s*(?=\()/],className:{2:"title.function"},keywords:l,contains:[{className:"params",begin:/\(/,end:/\)/,keywords:l,relevance:0,contains:[c,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,cb,i.C_BLOCK_COMMENT_MODE]},i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},cb,c]}}var hb="[A-Za-z$_][0-9A-Za-z$_]*",_C=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],OC=["true","false","null","undefined","NaN","Infinity"],pb=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],fb=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],mb=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],DC=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],BC=[].concat(mb,pb,fb);function gb(i){let t=i.regex,e=(C,{after:O})=>{let H="</"+C[0].slice(1);return C.input.indexOf(H,O)!==-1},n=hb,r={begin:"<>",end:"</>"},o=/<[A-Za-z0-9\\._:-]+\s*\/>/,s={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(C,O)=>{let H=C[0].length+C.index,K=C.input[H];if(K==="<"||K===","){O.ignoreMatch();return}K===">"&&(e(C,{after:H})||O.ignoreMatch());let W,te=C.input.substring(H);if(W=te.match(/^\s*=/)){O.ignoreMatch();return}if((W=te.match(/^\s+extends\s+/))&&W.index===0){O.ignoreMatch();return}}},a={$pattern:hb,keyword:_C,literal:OC,built_in:BC,"variable.language":DC},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",d={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},h={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},f={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[i.BACKSLASH_ESCAPE,h],subLanguage:"xml"}},p={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[i.BACKSLASH_ESCAPE,h],subLanguage:"css"}},m={begin:"gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[i.BACKSLASH_ESCAPE,h],subLanguage:"graphql"}},g={className:"string",begin:"`",end:"`",contains:[i.BACKSLASH_ESCAPE,h]},v={className:"comment",variants:[i.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:n+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),i.C_BLOCK_COMMENT_MODE,i.C_LINE_COMMENT_MODE]},y=[i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,f,p,m,g,{match:/\$\d+/},d];h.contains=y.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(y)});let E=[].concat(v,h.contains),x=E.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(E)}]),S={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x},w={variants:[{match:[/class/,/\s+/,n,/\s+/,/extends/,/\s+/,t.concat(n,"(",t.concat(/\./,n),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,n],scope:{1:"keyword",3:"title.class"}}]},k={relevance:0,match:t.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...pb,...fb]}},M={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},L={variants:[{match:[/function/,/\s+/,n,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[S],illegal:/%/},_={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function P(C){return t.concat("(?!",C.join("|"),")")}let I={match:t.concat(/\b/,P([...mb,"super","import"]),n,t.lookahead(/\(/)),className:"title.function",relevance:0},N={begin:t.concat(/\./,t.lookahead(t.concat(n,/(?![0-9A-Za-z$_(])/))),end:n,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},D={match:[/get|set/,/\s+/,n,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},S]},R="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+i.UNDERSCORE_IDENT_RE+")\\s*=>",A={match:[/const|var|let/,/\s+/,n,/\s*/,/=\s*/,/(async\s*)?/,t.lookahead(R)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[S]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:x,CLASS_REFERENCE:k},illegal:/#(?![$_A-z])/,contains:[i.SHEBANG({label:"shebang",binary:"node",relevance:5}),M,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,f,p,m,g,v,{match:/\$\d+/},d,k,{className:"attr",begin:n+t.lookahead(":"),relevance:0},A,{begin:"("+i.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[v,i.REGEXP_MODE,{className:"function",begin:R,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:i.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:r.begin,end:r.end},{match:o},{begin:s.begin,"on:begin":s.isTrulyOpeningTag,end:s.end}],subLanguage:"xml",contains:[{begin:s.begin,end:s.end,skip:!0,contains:["self"]}]}]},L,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+i.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[S,i.inherit(i.TITLE_MODE,{begin:n,className:"title.function"})]},{match:/\.\.\./,relevance:0},N,{match:"\\$"+n,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[S]},I,_,w,D,{match:/\$[(.]/}]}}function bb(i){let t={className:"attr",begin:/"(\\.|[^\\"\r\n])*"(?=\s*:)/,relevance:1.01},e={match:/[{}[\],:]/,className:"punctuation",relevance:0},n=["true","false","null"],r={scope:"literal",beginKeywords:n.join(" ")};return{name:"JSON",keywords:{literal:n},contains:[t,e,i.QUOTE_STRING_MODE,r,i.C_NUMBER_MODE,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE],illegal:"\\S"}}var Sr="[0-9](_*[0-9])*",_a=`\\.(${Sr})`,Oa="[0-9a-fA-F](_*[0-9a-fA-F])*",FC={className:"number",variants:[{begin:`(\\b(${Sr})((${_a})|\\.)?|(${_a}))[eE][+-]?(${Sr})[fFdD]?\\b`},{begin:`\\b(${Sr})((${_a})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${_a})[fFdD]?\\b`},{begin:`\\b(${Sr})[fFdD]\\b`},{begin:`\\b0[xX]((${Oa})\\.?|(${Oa})?\\.(${Oa}))[pP][+-]?(${Sr})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${Oa})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function yb(i){let t={keyword:"abstract as val var vararg get set class object open private protected public noinline crossinline dynamic final enum if else do while for when throw try catch finally import package is in fun override companion reified inline lateinit init interface annotation data sealed internal infix operator out by constructor super tailrec where const inner suspend typealias external expect actual",built_in:"Byte Short Char Int Long Boolean Float Double Void Unit Nothing",literal:"true false null"},e={className:"keyword",begin:/\b(break|continue|return|this)\b/,starts:{contains:[{className:"symbol",begin:/@\w+/}]}},n={className:"symbol",begin:i.UNDERSCORE_IDENT_RE+"@"},r={className:"subst",begin:/\$\{/,end:/\}/,contains:[i.C_NUMBER_MODE]},o={className:"variable",begin:"\\$"+i.UNDERSCORE_IDENT_RE},s={className:"string",variants:[{begin:'"""',end:'"""(?=[^"])',contains:[o,r]},{begin:"'",end:"'",illegal:/\n/,contains:[i.BACKSLASH_ESCAPE]},{begin:'"',end:'"',illegal:/\n/,contains:[i.BACKSLASH_ESCAPE,o,r]}]};r.contains.push(s);let a={className:"meta",begin:"@(?:file|property|field|get|set|receiver|param|setparam|delegate)\\s*:(?:\\s*"+i.UNDERSCORE_IDENT_RE+")?"},l={className:"meta",begin:"@"+i.UNDERSCORE_IDENT_RE,contains:[{begin:/\(/,end:/\)/,contains:[i.inherit(s,{className:"string"}),"self"]}]},c=FC,u=i.COMMENT("/\\*","\\*/",{contains:[i.C_BLOCK_COMMENT_MODE]}),d={variants:[{className:"type",begin:i.UNDERSCORE_IDENT_RE},{begin:/\(/,end:/\)/,contains:[]}]},h=d;return h.variants[1].contains=[d],d.variants[1].contains=[h],{name:"Kotlin",aliases:["kt","kts"],keywords:t,contains:[i.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"}]}),i.C_LINE_COMMENT_MODE,u,e,n,a,l,{className:"function",beginKeywords:"fun",end:"[(]|$",returnBegin:!0,excludeEnd:!0,keywords:t,relevance:5,contains:[{begin:i.UNDERSCORE_IDENT_RE+"\\s*\\(",returnBegin:!0,relevance:0,contains:[i.UNDERSCORE_TITLE_MODE]},{className:"type",begin:/</,end:/>/,keywords:"reified",relevance:0},{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:t,relevance:0,contains:[{begin:/:/,end:/[=,\/]/,endsWithParent:!0,contains:[d,i.C_LINE_COMMENT_MODE,u],relevance:0},i.C_LINE_COMMENT_MODE,u,a,l,s,i.C_NUMBER_MODE]},u]},{begin:[/class|interface|trait/,/\s+/,i.UNDERSCORE_IDENT_RE],beginScope:{3:"title.class"},keywords:"class interface trait",end:/[:\{(]|$/,excludeEnd:!0,illegal:"extends implements",contains:[{beginKeywords:"public protected internal private constructor"},i.UNDERSCORE_TITLE_MODE,{className:"type",begin:/</,end:/>/,excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:/[,:]\s*/,end:/[<\(,){\s]|$/,excludeBegin:!0,returnEnd:!0},a,l]},s,{className:"meta",begin:"^#!/usr/bin/env",end:"$",illegal:`
`},c]}}var HC=i=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:i.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[i.APOS_STRING_MODE,i.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:i.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),zC=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],VC=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],vb=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],Eb=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],$C=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse(),WC=vb.concat(Eb);function xb(i){let t=HC(i),e=WC,n="and or not only",r="[\\w-]+",o="("+r+"|@\\{"+r+"\\})",s=[],a=[],l=function(y){return{className:"string",begin:"~?"+y+".*?"+y}},c=function(y,E,x){return{className:y,begin:E,relevance:x}},u={$pattern:/[a-z-]+/,keyword:n,attribute:VC.join(" ")},d={begin:"\\(",end:"\\)",contains:a,keywords:u,relevance:0};a.push(i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,l("'"),l('"'),t.CSS_NUMBER_MODE,{begin:"(url|data-uri)\\(",starts:{className:"string",end:"[\\)\\n]",excludeEnd:!0}},t.HEXCOLOR,d,c("variable","@@?"+r,10),c("variable","@\\{"+r+"\\}"),c("built_in","~?`[^`]*?`"),{className:"attribute",begin:r+"\\s*:",end:":",returnBegin:!0,excludeEnd:!0},t.IMPORTANT,{beginKeywords:"and not"},t.FUNCTION_DISPATCH);let h=a.concat({begin:/\{/,end:/\}/,contains:s}),f={beginKeywords:"when",endsWithParent:!0,contains:[{beginKeywords:"and not"}].concat(a)},p={begin:o+"\\s*:",returnBegin:!0,end:/[;}]/,relevance:0,contains:[{begin:/-(webkit|moz|ms|o)-/},t.CSS_VARIABLE,{className:"attribute",begin:"\\b("+$C.join("|")+")\\b",end:/(?=:)/,starts:{endsWithParent:!0,illegal:"[<=$]",relevance:0,contains:a}}]},m={className:"keyword",begin:"@(import|media|charset|font-face|(-[a-z]+-)?keyframes|supports|document|namespace|page|viewport|host)\\b",starts:{end:"[;{}]",keywords:u,returnEnd:!0,contains:a,relevance:0}},g={className:"variable",variants:[{begin:"@"+r+"\\s*:",relevance:15},{begin:"@"+r}],starts:{end:"[;}]",returnEnd:!0,contains:h}},b={variants:[{begin:"[\\.#:&\\[>]",end:"[;{}]"},{begin:o,end:/\{/}],returnBegin:!0,returnEnd:!0,illegal:`[<='$"]`,relevance:0,contains:[i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,f,c("keyword","all\\b"),c("variable","@\\{"+r+"\\}"),{begin:"\\b("+zC.join("|")+")\\b",className:"selector-tag"},t.CSS_NUMBER_MODE,c("selector-tag",o,0),c("selector-id","#"+o),c("selector-class","\\."+o,0),c("selector-tag","&",0),t.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",begin:":("+vb.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+Eb.join("|")+")"},{begin:/\(/,end:/\)/,relevance:0,contains:h},{begin:"!important"},t.FUNCTION_DISPATCH]},v={begin:r+`:(:)?(${e.join("|")})`,returnBegin:!0,contains:[b]};return s.push(i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,m,g,v,p,b,f,t.FUNCTION_DISPATCH),{name:"Less",case_insensitive:!0,illegal:`[=>'/<($"]`,contains:s}}function Sb(i){let t="\\[=*\\[",e="\\]=*\\]",n={begin:t,end:e,contains:["self"]},r=[i.COMMENT("--(?!"+t+")","$"),i.COMMENT("--"+t,e,{contains:[n],relevance:10})];return{name:"Lua",keywords:{$pattern:i.UNDERSCORE_IDENT_RE,literal:"true false nil",keyword:"and break do else elseif end for goto if in local not or repeat return then until while",built_in:"_G _ENV _VERSION __index __newindex __mode __call __metatable __tostring __len __gc __add __sub __mul __div __mod __pow __concat __unm __eq __lt __le assert collectgarbage dofile error getfenv getmetatable ipairs load loadfile loadstring module next pairs pcall print rawequal rawget rawset require select setfenv setmetatable tonumber tostring type unpack xpcall arg self coroutine resume yield status wrap create running debug getupvalue debug sethook getmetatable gethook setmetatable setlocal traceback setfenv getinfo setupvalue getlocal getregistry getfenv io lines write close flush open output type read stderr stdin input stdout popen tmpfile math log max acos huge ldexp pi cos tanh pow deg tan cosh sinh random randomseed frexp ceil floor rad abs sqrt modf asin min mod fmod log10 atan2 exp sin atan os exit setlocale date getenv difftime remove time clock tmpname rename execute package preload loadlib loaded loaders cpath config path seeall string sub upper len gfind rep find match char dump gmatch reverse byte format gsub lower table setn insert getn foreachi maxn foreach concat sort remove"},contains:r.concat([{className:"function",beginKeywords:"function",end:"\\)",contains:[i.inherit(i.TITLE_MODE,{begin:"([_a-zA-Z]\\w*\\.)*([_a-zA-Z]\\w*:)?[_a-zA-Z]\\w*"}),{className:"params",begin:"\\(",endsWithParent:!0,contains:r}].concat(r)},i.C_NUMBER_MODE,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,{className:"string",begin:t,end:e,contains:[n],relevance:5}])}}function kb(i){let t={className:"variable",variants:[{begin:"\\$\\("+i.UNDERSCORE_IDENT_RE+"\\)",contains:[i.BACKSLASH_ESCAPE]},{begin:/\$[@%<?\^\+\*]/}]},e={className:"string",begin:/"/,end:/"/,contains:[i.BACKSLASH_ESCAPE,t]},n={className:"variable",begin:/\$\([\w-]+\s/,end:/\)/,keywords:{built_in:"subst patsubst strip findstring filter filter-out sort word wordlist firstword lastword dir notdir suffix basename addsuffix addprefix join wildcard realpath abspath error warning shell origin flavor foreach if or and call eval file value"},contains:[t]},r={begin:"^"+i.UNDERSCORE_IDENT_RE+"\\s*(?=[:+?]?=)"},o={className:"meta",begin:/^\.PHONY:/,end:/$/,keywords:{$pattern:/[\.\w]+/,keyword:".PHONY"}},s={className:"section",begin:/^[^\s]+:/,end:/$/,contains:[t]};return{name:"Makefile",aliases:["mk","mak","make"],keywords:{$pattern:/[\w-]+/,keyword:"define endef undefine ifdef ifndef ifeq ifneq else endif include -include sinclude override export unexport private vpath"},contains:[i.HASH_COMMENT_MODE,t,e,n,r,o,s]}}function wb(i){let t=i.regex,e={begin:/<\/?[A-Za-z_]/,end:">",subLanguage:"xml",relevance:0},n={begin:"^[-\\*]{3,}",end:"$"},r={className:"code",variants:[{begin:"(`{3,})[^`](.|\\n)*?\\1`*[ ]*"},{begin:"(~{3,})[^~](.|\\n)*?\\1~*[ ]*"},{begin:"```",end:"```+[ ]*$"},{begin:"~~~",end:"~~~+[ ]*$"},{begin:"`.+?`"},{begin:"(?=^( {4}|\\t))",contains:[{begin:"^( {4}|\\t)",end:"(\\n)$"}],relevance:0}]},o={className:"bullet",begin:"^[ 	]*([*+-]|(\\d+\\.))(?=\\s+)",end:"\\s+",excludeEnd:!0},s={begin:/^\[[^\n]+\]:/,returnBegin:!0,contains:[{className:"symbol",begin:/\[/,end:/\]/,excludeBegin:!0,excludeEnd:!0},{className:"link",begin:/:\s*/,end:/$/,excludeBegin:!0}]},a=/[A-Za-z][A-Za-z0-9+.-]*/,l={variants:[{begin:/\[.+?\]\[.*?\]/,relevance:0},{begin:/\[.+?\]\(((data|javascript|mailto):|(?:http|ftp)s?:\/\/).*?\)/,relevance:2},{begin:t.concat(/\[.+?\]\(/,a,/:\/\/.*?\)/),relevance:2},{begin:/\[.+?\]\([./?&#].*?\)/,relevance:1},{begin:/\[.*?\]\(.*?\)/,relevance:0}],returnBegin:!0,contains:[{match:/\[(?=\])/},{className:"string",relevance:0,begin:"\\[",end:"\\]",excludeBegin:!0,returnEnd:!0},{className:"link",relevance:0,begin:"\\]\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0},{className:"symbol",relevance:0,begin:"\\]\\[",end:"\\]",excludeBegin:!0,excludeEnd:!0}]},c={className:"strong",contains:[],variants:[{begin:/_{2}(?!\s)/,end:/_{2}/},{begin:/\*{2}(?!\s)/,end:/\*{2}/}]},u={className:"emphasis",contains:[],variants:[{begin:/\*(?![*\s])/,end:/\*/},{begin:/_(?![_\s])/,end:/_/,relevance:0}]},d=i.inherit(c,{contains:[]}),h=i.inherit(u,{contains:[]});c.contains.push(h),u.contains.push(d);let f=[e,l];return[c,u,d,h].forEach(g=>{g.contains=g.contains.concat(f)}),f=f.concat(c,u),{name:"Markdown",aliases:["md","mkdown","mkd"],contains:[{className:"section",variants:[{begin:"^#{1,6}",end:"$",contains:f},{begin:"(?=^.+?\\n[=-]{2,}$)",contains:[{begin:"^[=-]*$"},{begin:"^",end:"\\n",contains:f}]}]},e,o,c,u,{className:"quote",begin:"^>\\s+",contains:f,end:"$"},r,n,l,s]}}function Mb(i){let t={className:"built_in",begin:"\\b(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)\\w+"},e=/[a-zA-Z@][a-zA-Z0-9_]*/,a={"variable.language":["this","super"],$pattern:e,keyword:["while","export","sizeof","typedef","const","struct","for","union","volatile","static","mutable","if","do","return","goto","enum","else","break","extern","asm","case","default","register","explicit","typename","switch","continue","inline","readonly","assign","readwrite","self","@synchronized","id","typeof","nonatomic","IBOutlet","IBAction","strong","weak","copy","in","out","inout","bycopy","byref","oneway","__strong","__weak","__block","__autoreleasing","@private","@protected","@public","@try","@property","@end","@throw","@catch","@finally","@autoreleasepool","@synthesize","@dynamic","@selector","@optional","@required","@encode","@package","@import","@defs","@compatibility_alias","__bridge","__bridge_transfer","__bridge_retained","__bridge_retain","__covariant","__contravariant","__kindof","_Nonnull","_Nullable","_Null_unspecified","__FUNCTION__","__PRETTY_FUNCTION__","__attribute__","getter","setter","retain","unsafe_unretained","nonnull","nullable","null_unspecified","null_resettable","class","instancetype","NS_DESIGNATED_INITIALIZER","NS_UNAVAILABLE","NS_REQUIRES_SUPER","NS_RETURNS_INNER_POINTER","NS_INLINE","NS_AVAILABLE","NS_DEPRECATED","NS_ENUM","NS_OPTIONS","NS_SWIFT_UNAVAILABLE","NS_ASSUME_NONNULL_BEGIN","NS_ASSUME_NONNULL_END","NS_REFINED_FOR_SWIFT","NS_SWIFT_NAME","NS_SWIFT_NOTHROW","NS_DURING","NS_HANDLER","NS_ENDHANDLER","NS_VALUERETURN","NS_VOIDRETURN"],literal:["false","true","FALSE","TRUE","nil","YES","NO","NULL"],built_in:["dispatch_once_t","dispatch_queue_t","dispatch_sync","dispatch_async","dispatch_once"],type:["int","float","char","unsigned","signed","short","long","double","wchar_t","unichar","void","bool","BOOL","id|0","_Bool"]},l={$pattern:e,keyword:["@interface","@class","@protocol","@implementation"]};return{name:"Objective-C",aliases:["mm","objc","obj-c","obj-c++","objective-c++"],keywords:a,illegal:"</",contains:[t,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,i.C_NUMBER_MODE,i.QUOTE_STRING_MODE,i.APOS_STRING_MODE,{className:"string",variants:[{begin:'@"',end:'"',illegal:"\\n",contains:[i.BACKSLASH_ESCAPE]}]},{className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},i.inherit(i.QUOTE_STRING_MODE,{className:"string"}),{className:"string",begin:/<.*?>/,end:/$/,illegal:"\\n"},i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},{className:"class",begin:"("+l.keyword.join("|")+")\\b",end:/(\{|$)/,excludeEnd:!0,keywords:l,contains:[i.UNDERSCORE_TITLE_MODE]},{begin:"\\."+i.UNDERSCORE_IDENT_RE,relevance:0}]}}function Tb(i){let t=i.regex,e=["abs","accept","alarm","and","atan2","bind","binmode","bless","break","caller","chdir","chmod","chomp","chop","chown","chr","chroot","close","closedir","connect","continue","cos","crypt","dbmclose","dbmopen","defined","delete","die","do","dump","each","else","elsif","endgrent","endhostent","endnetent","endprotoent","endpwent","endservent","eof","eval","exec","exists","exit","exp","fcntl","fileno","flock","for","foreach","fork","format","formline","getc","getgrent","getgrgid","getgrnam","gethostbyaddr","gethostbyname","gethostent","getlogin","getnetbyaddr","getnetbyname","getnetent","getpeername","getpgrp","getpriority","getprotobyname","getprotobynumber","getprotoent","getpwent","getpwnam","getpwuid","getservbyname","getservbyport","getservent","getsockname","getsockopt","given","glob","gmtime","goto","grep","gt","hex","if","index","int","ioctl","join","keys","kill","last","lc","lcfirst","length","link","listen","local","localtime","log","lstat","lt","ma","map","mkdir","msgctl","msgget","msgrcv","msgsnd","my","ne","next","no","not","oct","open","opendir","or","ord","our","pack","package","pipe","pop","pos","print","printf","prototype","push","q|0","qq","quotemeta","qw","qx","rand","read","readdir","readline","readlink","readpipe","recv","redo","ref","rename","require","reset","return","reverse","rewinddir","rindex","rmdir","say","scalar","seek","seekdir","select","semctl","semget","semop","send","setgrent","sethostent","setnetent","setpgrp","setpriority","setprotoent","setpwent","setservent","setsockopt","shift","shmctl","shmget","shmread","shmwrite","shutdown","sin","sleep","socket","socketpair","sort","splice","split","sprintf","sqrt","srand","stat","state","study","sub","substr","symlink","syscall","sysopen","sysread","sysseek","system","syswrite","tell","telldir","tie","tied","time","times","tr","truncate","uc","ucfirst","umask","undef","unless","unlink","unpack","unshift","untie","until","use","utime","values","vec","wait","waitpid","wantarray","warn","when","while","write","x|0","xor","y|0"],n=/[dualxmsipngr]{0,12}/,r={$pattern:/[\w.]+/,keyword:e.join(" ")},o={className:"subst",begin:"[$@]\\{",end:"\\}",keywords:r},s={begin:/->\{/,end:/\}/},a={variants:[{begin:/\$\d/},{begin:t.concat(/[$%@](\^\w\b|#\w+(::\w+)*|\{\w+\}|\w+(::\w*)*)/,"(?![A-Za-z])(?![@$%])")},{begin:/[$%@][^\s\w{]/,relevance:0}]},l=[i.BACKSLASH_ESCAPE,o,a],c=[/!/,/\//,/\|/,/\?/,/'/,/"/,/#/],u=(f,p,m="\\1")=>{let g=m==="\\1"?m:t.concat(m,p);return t.concat(t.concat("(?:",f,")"),p,/(?:\\.|[^\\\/])*?/,g,/(?:\\.|[^\\\/])*?/,m,n)},d=(f,p,m)=>t.concat(t.concat("(?:",f,")"),p,/(?:\\.|[^\\\/])*?/,m,n),h=[a,i.HASH_COMMENT_MODE,i.COMMENT(/^=\w/,/=cut/,{endsWithParent:!0}),s,{className:"string",contains:l,variants:[{begin:"q[qwxr]?\\s*\\(",end:"\\)",relevance:5},{begin:"q[qwxr]?\\s*\\[",end:"\\]",relevance:5},{begin:"q[qwxr]?\\s*\\{",end:"\\}",relevance:5},{begin:"q[qwxr]?\\s*\\|",end:"\\|",relevance:5},{begin:"q[qwxr]?\\s*<",end:">",relevance:5},{begin:"qw\\s+q",end:"q",relevance:5},{begin:"'",end:"'",contains:[i.BACKSLASH_ESCAPE]},{begin:'"',end:'"'},{begin:"`",end:"`",contains:[i.BACKSLASH_ESCAPE]},{begin:/\{\w+\}/,relevance:0},{begin:"-?\\w+\\s*=>",relevance:0}]},{className:"number",begin:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",relevance:0},{begin:"(\\/\\/|"+i.RE_STARTERS_RE+"|\\b(split|return|print|reverse|grep)\\b)\\s*",keywords:"split return print reverse grep",relevance:0,contains:[i.HASH_COMMENT_MODE,{className:"regexp",variants:[{begin:u("s|tr|y",t.either(...c,{capture:!0}))},{begin:u("s|tr|y","\\(","\\)")},{begin:u("s|tr|y","\\[","\\]")},{begin:u("s|tr|y","\\{","\\}")}],relevance:2},{className:"regexp",variants:[{begin:/(m|qr)\/\//,relevance:0},{begin:d("(?:m|qr)?",/\//,/\//)},{begin:d("m|qr",t.either(...c,{capture:!0}),/\1/)},{begin:d("m|qr",/\(/,/\)/)},{begin:d("m|qr",/\[/,/\]/)},{begin:d("m|qr",/\{/,/\}/)}]}]},{className:"function",beginKeywords:"sub",end:"(\\s*\\(.*?\\))?[;{]",excludeEnd:!0,relevance:5,contains:[i.TITLE_MODE]},{begin:"-\\w\\b",relevance:0},{begin:"^__DATA__$",end:"^__END__$",subLanguage:"mojolicious",contains:[{begin:"^@@.*",end:"$",className:"comment"}]}];return o.contains=h,s.contains=h,{name:"Perl",aliases:["pl","pm"],keywords:r,contains:h}}function Cb(i){let t=i.regex,e=/(?![A-Za-z0-9])(?![$])/,n=t.concat(/[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/,e),r=t.concat(/(\\?[A-Z][a-z0-9_\x7f-\xff]+|\\?[A-Z]+(?=[A-Z][a-z0-9_\x7f-\xff])){1,}/,e),o={scope:"variable",match:"\\$+"+n},s={scope:"meta",variants:[{begin:/<\?php/,relevance:10},{begin:/<\?=/},{begin:/<\?/,relevance:.1},{begin:/\?>/}]},a={scope:"subst",variants:[{begin:/\$\w+/},{begin:/\{\$/,end:/\}/}]},l=i.inherit(i.APOS_STRING_MODE,{illegal:null}),c=i.inherit(i.QUOTE_STRING_MODE,{illegal:null,contains:i.QUOTE_STRING_MODE.contains.concat(a)}),u={begin:/<<<[ \t]*(?:(\w+)|"(\w+)")\n/,end:/[ \t]*(\w+)\b/,contains:i.QUOTE_STRING_MODE.contains.concat(a),"on:begin":(I,N)=>{N.data._beginMatch=I[1]||I[2]},"on:end":(I,N)=>{N.data._beginMatch!==I[1]&&N.ignoreMatch()}},d=i.END_SAME_AS_BEGIN({begin:/<<<[ \t]*'(\w+)'\n/,end:/[ \t]*(\w+)\b/}),h=`[ 	
]`,f={scope:"string",variants:[c,l,u,d]},p={scope:"number",variants:[{begin:"\\b0[bB][01]+(?:_[01]+)*\\b"},{begin:"\\b0[oO][0-7]+(?:_[0-7]+)*\\b"},{begin:"\\b0[xX][\\da-fA-F]+(?:_[\\da-fA-F]+)*\\b"},{begin:"(?:\\b\\d+(?:_\\d+)*(\\.(?:\\d+(?:_\\d+)*))?|\\B\\.\\d+)(?:[eE][+-]?\\d+)?"}],relevance:0},m=["false","null","true"],g=["__CLASS__","__DIR__","__FILE__","__FUNCTION__","__COMPILER_HALT_OFFSET__","__LINE__","__METHOD__","__NAMESPACE__","__TRAIT__","die","echo","exit","include","include_once","print","require","require_once","array","abstract","and","as","binary","bool","boolean","break","callable","case","catch","class","clone","const","continue","declare","default","do","double","else","elseif","empty","enddeclare","endfor","endforeach","endif","endswitch","endwhile","enum","eval","extends","final","finally","float","for","foreach","from","global","goto","if","implements","instanceof","insteadof","int","integer","interface","isset","iterable","list","match|0","mixed","new","never","object","or","private","protected","public","readonly","real","return","string","switch","throw","trait","try","unset","use","var","void","while","xor","yield"],b=["Error|0","AppendIterator","ArgumentCountError","ArithmeticError","ArrayIterator","ArrayObject","AssertionError","BadFunctionCallException","BadMethodCallException","CachingIterator","CallbackFilterIterator","CompileError","Countable","DirectoryIterator","DivisionByZeroError","DomainException","EmptyIterator","ErrorException","Exception","FilesystemIterator","FilterIterator","GlobIterator","InfiniteIterator","InvalidArgumentException","IteratorIterator","LengthException","LimitIterator","LogicException","MultipleIterator","NoRewindIterator","OutOfBoundsException","OutOfRangeException","OuterIterator","OverflowException","ParentIterator","ParseError","RangeException","RecursiveArrayIterator","RecursiveCachingIterator","RecursiveCallbackFilterIterator","RecursiveDirectoryIterator","RecursiveFilterIterator","RecursiveIterator","RecursiveIteratorIterator","RecursiveRegexIterator","RecursiveTreeIterator","RegexIterator","RuntimeException","SeekableIterator","SplDoublyLinkedList","SplFileInfo","SplFileObject","SplFixedArray","SplHeap","SplMaxHeap","SplMinHeap","SplObjectStorage","SplObserver","SplPriorityQueue","SplQueue","SplStack","SplSubject","SplTempFileObject","TypeError","UnderflowException","UnexpectedValueException","UnhandledMatchError","ArrayAccess","BackedEnum","Closure","Fiber","Generator","Iterator","IteratorAggregate","Serializable","Stringable","Throwable","Traversable","UnitEnum","WeakReference","WeakMap","Directory","__PHP_Incomplete_Class","parent","php_user_filter","self","static","stdClass"],y={keyword:g,literal:(I=>{let N=[];return I.forEach(D=>{N.push(D),D.toLowerCase()===D?N.push(D.toUpperCase()):N.push(D.toLowerCase())}),N})(m),built_in:b},E=I=>I.map(N=>N.replace(/\|\d+$/,"")),x={variants:[{match:[/new/,t.concat(h,"+"),t.concat("(?!",E(b).join("\\b|"),"\\b)"),r],scope:{1:"keyword",4:"title.class"}}]},S=t.concat(n,"\\b(?!\\()"),w={variants:[{match:[t.concat(/::/,t.lookahead(/(?!class\b)/)),S],scope:{2:"variable.constant"}},{match:[/::/,/class/],scope:{2:"variable.language"}},{match:[r,t.concat(/::/,t.lookahead(/(?!class\b)/)),S],scope:{1:"title.class",3:"variable.constant"}},{match:[r,t.concat("::",t.lookahead(/(?!class\b)/))],scope:{1:"title.class"}},{match:[r,/::/,/class/],scope:{1:"title.class",3:"variable.language"}}]},k={scope:"attr",match:t.concat(n,t.lookahead(":"),t.lookahead(/(?!::)/))},M={relevance:0,begin:/\(/,end:/\)/,keywords:y,contains:[k,o,w,i.C_BLOCK_COMMENT_MODE,f,p,x]},L={relevance:0,match:[/\b/,t.concat("(?!fn\\b|function\\b|",E(g).join("\\b|"),"|",E(b).join("\\b|"),"\\b)"),n,t.concat(h,"*"),t.lookahead(/(?=\()/)],scope:{3:"title.function.invoke"},contains:[M]};M.contains.push(L);let _=[k,w,i.C_BLOCK_COMMENT_MODE,f,p,x],P={begin:t.concat(/#\[\s*/,r),beginScope:"meta",end:/]/,endScope:"meta",keywords:{literal:m,keyword:["new","array"]},contains:[{begin:/\[/,end:/]/,keywords:{literal:m,keyword:["new","array"]},contains:["self",..._]},..._,{scope:"meta",match:r}]};return{case_insensitive:!1,keywords:y,contains:[P,i.HASH_COMMENT_MODE,i.COMMENT("//","$"),i.COMMENT("/\\*","\\*/",{contains:[{scope:"doctag",match:"@[A-Za-z]+"}]}),{match:/__halt_compiler\(\);/,keywords:"__halt_compiler",starts:{scope:"comment",end:i.MATCH_NOTHING_RE,contains:[{match:/\?>/,scope:"meta",endsParent:!0}]}},s,{scope:"variable.language",match:/\$this\b/},o,L,w,{match:[/const/,/\s/,n],scope:{1:"keyword",3:"variable.constant"}},x,{scope:"function",relevance:0,beginKeywords:"fn function",end:/[;{]/,excludeEnd:!0,illegal:"[$%\\[]",contains:[{beginKeywords:"use"},i.UNDERSCORE_TITLE_MODE,{begin:"=>",endsParent:!0},{scope:"params",begin:"\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0,keywords:y,contains:["self",o,w,i.C_BLOCK_COMMENT_MODE,f,p]}]},{scope:"class",variants:[{beginKeywords:"enum",illegal:/[($"]/},{beginKeywords:"class interface trait",illegal:/[:($"]/}],relevance:0,end:/\{/,excludeEnd:!0,contains:[{beginKeywords:"extends implements"},i.UNDERSCORE_TITLE_MODE]},{beginKeywords:"namespace",relevance:0,end:";",illegal:/[.']/,contains:[i.inherit(i.UNDERSCORE_TITLE_MODE,{scope:"title.class"})]},{beginKeywords:"use",relevance:0,end:";",contains:[{match:/\b(as|const|function)\b/,scope:"keyword"},i.UNDERSCORE_TITLE_MODE]},f,p]}}function Lb(i){return{name:"PHP template",subLanguage:"xml",contains:[{begin:/<\?(php|=)?/,end:/\?>/,subLanguage:"php",contains:[{begin:"/\\*",end:"\\*/",skip:!0},{begin:'b"',end:'"',skip:!0},{begin:"b'",end:"'",skip:!0},i.inherit(i.APOS_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0}),i.inherit(i.QUOTE_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0})]}]}}function Rb(i){return{name:"Plain text",aliases:["text","txt"],disableAutodetect:!0}}function Ab(i){let t=i.regex,e=/[\p{XID_Start}_]\p{XID_Continue}*/u,n=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],a={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:n,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},l={className:"meta",begin:/^(>>>|\.\.\.) /},c={className:"subst",begin:/\{/,end:/\}/,keywords:a,illegal:/#/},u={begin:/\{\{/,relevance:0},d={className:"string",contains:[i.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[i.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[i.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[i.BACKSLASH_ESCAPE,l,u,c]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[i.BACKSLASH_ESCAPE,l,u,c]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[i.BACKSLASH_ESCAPE,u,c]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[i.BACKSLASH_ESCAPE,u,c]},i.APOS_STRING_MODE,i.QUOTE_STRING_MODE]},h="[0-9](_?[0-9])*",f=`(\\b(${h}))?\\.(${h})|\\b(${h})\\.`,p=`\\b|${n.join("|")}`,m={className:"number",relevance:0,variants:[{begin:`(\\b(${h})|(${f}))[eE][+-]?(${h})[jJ]?(?=${p})`},{begin:`(${f})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${p})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${p})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${p})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${p})`},{begin:`\\b(${h})[jJ](?=${p})`}]},g={className:"comment",begin:t.lookahead(/# type:/),end:/$/,keywords:a,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},b={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:["self",l,m,d,i.HASH_COMMENT_MODE]}]};return c.contains=[d,m,l],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:a,illegal:/(<\/|\?)|=>/,contains:[l,m,{begin:/\bself\b/},{beginKeywords:"if",relevance:0},d,g,i.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,e],scope:{1:"keyword",3:"title.function"},contains:[b]},{variants:[{match:[/\bclass/,/\s+/,e,/\s*/,/\(\s*/,e,/\s*\)/]},{match:[/\bclass/,/\s+/,e]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[m,b,d]}]}}function Ib(i){return{aliases:["pycon"],contains:[{className:"meta.prompt",starts:{end:/ |$/,starts:{end:"$",subLanguage:"python"}},variants:[{begin:/^>>>(?=[ ]|$)/},{begin:/^\.\.\.(?=[ ]|$)/}]}]}}function Nb(i){let t=i.regex,e=/(?:(?:[a-zA-Z]|\.[._a-zA-Z])[._a-zA-Z0-9]*)|\.(?!\d)/,n=t.either(/0[xX][0-9a-fA-F]+\.[0-9a-fA-F]*[pP][+-]?\d+i?/,/0[xX][0-9a-fA-F]+(?:[pP][+-]?\d+)?[Li]?/,/(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?[Li]?/),r=/[=!<>:]=|\|\||&&|:::?|<-|<<-|->>|->|\|>|[-+*\/?!$&|:<=>@^~]|\*\*/,o=t.either(/[()]/,/[{}]/,/\[\[/,/[[\]]/,/\\/,/,/);return{name:"R",keywords:{$pattern:e,keyword:"function if in break next repeat else for while",literal:"NULL NA TRUE FALSE Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10",built_in:"LETTERS letters month.abb month.name pi T F abs acos acosh all any anyNA Arg as.call as.character as.complex as.double as.environment as.integer as.logical as.null.default as.numeric as.raw asin asinh atan atanh attr attributes baseenv browser c call ceiling class Conj cos cosh cospi cummax cummin cumprod cumsum digamma dim dimnames emptyenv exp expression floor forceAndCall gamma gc.time globalenv Im interactive invisible is.array is.atomic is.call is.character is.complex is.double is.environment is.expression is.finite is.function is.infinite is.integer is.language is.list is.logical is.matrix is.na is.name is.nan is.null is.numeric is.object is.pairlist is.raw is.recursive is.single is.symbol lazyLoadDBfetch length lgamma list log max min missing Mod names nargs nzchar oldClass on.exit pos.to.env proc.time prod quote range Re rep retracemem return round seq_along seq_len seq.int sign signif sin sinh sinpi sqrt standardGeneric substitute sum switch tan tanh tanpi tracemem trigamma trunc unclass untracemem UseMethod xtfrm"},contains:[i.COMMENT(/#'/,/$/,{contains:[{scope:"doctag",match:/@examples/,starts:{end:t.lookahead(t.either(/\n^#'\s*(?=@[a-zA-Z]+)/,/\n^(?!#')/)),endsParent:!0}},{scope:"doctag",begin:"@param",end:/$/,contains:[{scope:"variable",variants:[{match:e},{match:/`(?:\\.|[^`\\])+`/}],endsParent:!0}]},{scope:"doctag",match:/@[a-zA-Z]+/},{scope:"keyword",match:/\\[a-zA-Z]+/}]}),i.HASH_COMMENT_MODE,{scope:"string",contains:[i.BACKSLASH_ESCAPE],variants:[i.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\(/,end:/\)(-*)"/}),i.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\{/,end:/\}(-*)"/}),i.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\[/,end:/\](-*)"/}),i.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\(/,end:/\)(-*)'/}),i.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\{/,end:/\}(-*)'/}),i.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\[/,end:/\](-*)'/}),{begin:'"',end:'"',relevance:0},{begin:"'",end:"'",relevance:0}]},{relevance:0,variants:[{scope:{1:"operator",2:"number"},match:[r,n]},{scope:{1:"operator",2:"number"},match:[/%[^%]*%/,n]},{scope:{1:"punctuation",2:"number"},match:[o,n]},{scope:{2:"number"},match:[/[^a-zA-Z0-9._]|^/,n]}]},{scope:{3:"operator"},match:[e,/\s+/,/<-/,/\s+/]},{scope:"operator",relevance:0,variants:[{match:r},{match:/%[^%]*%/}]},{scope:"punctuation",relevance:0,match:o},{begin:"`",end:"`",contains:[{begin:/\\./}]}]}}function Pb(i){let t=i.regex,e="([a-zA-Z_]\\w*[!?=]?|[-+~]@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?)",n=t.either(/\b([A-Z]+[a-z0-9]+)+/,/\b([A-Z]+[a-z0-9]+)+[A-Z]+/),r=t.concat(n,/(::\w+)*/),s={"variable.constant":["__FILE__","__LINE__","__ENCODING__"],"variable.language":["self","super"],keyword:["alias","and","begin","BEGIN","break","case","class","defined","do","else","elsif","end","END","ensure","for","if","in","module","next","not","or","redo","require","rescue","retry","return","then","undef","unless","until","when","while","yield",...["include","extend","prepend","public","private","protected","raise","throw"]],built_in:["proc","lambda","attr_accessor","attr_reader","attr_writer","define_method","private_constant","module_function"],literal:["true","false","nil"]},a={className:"doctag",begin:"@[A-Za-z]+"},l={begin:"#<",end:">"},c=[i.COMMENT("#","$",{contains:[a]}),i.COMMENT("^=begin","^=end",{contains:[a],relevance:10}),i.COMMENT("^__END__",i.MATCH_NOTHING_RE)],u={className:"subst",begin:/#\{/,end:/\}/,keywords:s},d={className:"string",contains:[i.BACKSLASH_ESCAPE,u],variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/`/,end:/`/},{begin:/%[qQwWx]?\(/,end:/\)/},{begin:/%[qQwWx]?\[/,end:/\]/},{begin:/%[qQwWx]?\{/,end:/\}/},{begin:/%[qQwWx]?</,end:/>/},{begin:/%[qQwWx]?\//,end:/\//},{begin:/%[qQwWx]?%/,end:/%/},{begin:/%[qQwWx]?-/,end:/-/},{begin:/%[qQwWx]?\|/,end:/\|/},{begin:/\B\?(\\\d{1,3})/},{begin:/\B\?(\\x[A-Fa-f0-9]{1,2})/},{begin:/\B\?(\\u\{?[A-Fa-f0-9]{1,6}\}?)/},{begin:/\B\?(\\M-\\C-|\\M-\\c|\\c\\M-|\\M-|\\C-\\M-)[\x20-\x7e]/},{begin:/\B\?\\(c|C-)[\x20-\x7e]/},{begin:/\B\?\\?\S/},{begin:t.concat(/<<[-~]?'?/,t.lookahead(/(\w+)(?=\W)[^\n]*\n(?:[^\n]*\n)*?\s*\1\b/)),contains:[i.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,contains:[i.BACKSLASH_ESCAPE,u]})]}]},h="[1-9](_?[0-9])*|0",f="[0-9](_?[0-9])*",p={className:"number",relevance:0,variants:[{begin:`\\b(${h})(\\.(${f}))?([eE][+-]?(${f})|r)?i?\\b`},{begin:"\\b0[dD][0-9](_?[0-9])*r?i?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*r?i?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*r?i?\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*r?i?\\b"},{begin:"\\b0(_?[0-7])+r?i?\\b"}]},m={variants:[{match:/\(\)/},{className:"params",begin:/\(/,end:/(?=\))/,excludeBegin:!0,endsParent:!0,keywords:s}]},S=[d,{variants:[{match:[/class\s+/,r,/\s+<\s+/,r]},{match:[/\b(class|module)\s+/,r]}],scope:{2:"title.class",4:"title.class.inherited"},keywords:s},{match:[/(include|extend)\s+/,r],scope:{2:"title.class"},keywords:s},{relevance:0,match:[r,/\.new[. (]/],scope:{1:"title.class"}},{relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"},{relevance:0,match:n,scope:"title.class"},{match:[/def/,/\s+/,e],scope:{1:"keyword",3:"title.function"},contains:[m]},{begin:i.IDENT_RE+"::"},{className:"symbol",begin:i.UNDERSCORE_IDENT_RE+"(!|\\?)?:",relevance:0},{className:"symbol",begin:":(?!\\s)",contains:[d,{begin:e}],relevance:0},p,{className:"variable",begin:"(\\$\\W)|((\\$|@@?)(\\w+))(?=[^@$?])(?![A-Za-z])(?![@$?'])"},{className:"params",begin:/\|/,end:/\|/,excludeBegin:!0,excludeEnd:!0,relevance:0,keywords:s},{begin:"("+i.RE_STARTERS_RE+"|unless)\\s*",keywords:"unless",contains:[{className:"regexp",contains:[i.BACKSLASH_ESCAPE,u],illegal:/\n/,variants:[{begin:"/",end:"/[a-z]*"},{begin:/%r\{/,end:/\}[a-z]*/},{begin:"%r\\(",end:"\\)[a-z]*"},{begin:"%r!",end:"![a-z]*"},{begin:"%r\\[",end:"\\][a-z]*"}]}].concat(l,c),relevance:0}].concat(l,c);u.contains=S,m.contains=S;let w="[>?]>",k="[\\w#]+\\(\\w+\\):\\d+:\\d+[>*]",M="(\\w+-)?\\d+\\.\\d+\\.\\d+(p\\d+)?[^\\d][^>]+>",L=[{begin:/^\s*=>/,starts:{end:"$",contains:S}},{className:"meta.prompt",begin:"^("+w+"|"+k+"|"+M+")(?=[ ])",starts:{end:"$",keywords:s,contains:S}}];return c.unshift(l),{name:"Ruby",aliases:["rb","gemspec","podspec","thor","irb"],keywords:s,illegal:/\/\*/,contains:[i.SHEBANG({binary:"ruby"})].concat(L).concat(c).concat(S)}}function _b(i){let t=i.regex,e={className:"title.function.invoke",relevance:0,begin:t.concat(/\b/,/(?!let\b)/,i.IDENT_RE,t.lookahead(/\s*\(/))},n="([ui](8|16|32|64|128|size)|f(32|64))?",r=["abstract","as","async","await","become","box","break","const","continue","crate","do","dyn","else","enum","extern","false","final","fn","for","if","impl","in","let","loop","macro","match","mod","move","mut","override","priv","pub","ref","return","self","Self","static","struct","super","trait","true","try","type","typeof","unsafe","unsized","use","virtual","where","while","yield"],o=["true","false","Some","None","Ok","Err"],s=["drop ","Copy","Send","Sized","Sync","Drop","Fn","FnMut","FnOnce","ToOwned","Clone","Debug","PartialEq","PartialOrd","Eq","Ord","AsRef","AsMut","Into","From","Default","Iterator","Extend","IntoIterator","DoubleEndedIterator","ExactSizeIterator","SliceConcatExt","ToString","assert!","assert_eq!","bitflags!","bytes!","cfg!","col!","concat!","concat_idents!","debug_assert!","debug_assert_eq!","env!","panic!","file!","format!","format_args!","include_bytes!","include_str!","line!","local_data_key!","module_path!","option_env!","print!","println!","select!","stringify!","try!","unimplemented!","unreachable!","vec!","write!","writeln!","macro_rules!","assert_ne!","debug_assert_ne!"],a=["i8","i16","i32","i64","i128","isize","u8","u16","u32","u64","u128","usize","f32","f64","str","char","bool","Box","Option","Result","String","Vec"];return{name:"Rust",aliases:["rs"],keywords:{$pattern:i.IDENT_RE+"!?",type:a,keyword:r,literal:o,built_in:s},illegal:"</",contains:[i.C_LINE_COMMENT_MODE,i.COMMENT("/\\*","\\*/",{contains:["self"]}),i.inherit(i.QUOTE_STRING_MODE,{begin:/b?"/,illegal:null}),{className:"string",variants:[{begin:/b?r(#*)"(.|\n)*?"\1(?!#)/},{begin:/b?'\\?(x\w{2}|u\w{4}|U\w{8}|.)'/}]},{className:"symbol",begin:/'[a-zA-Z_][a-zA-Z0-9_]*/},{className:"number",variants:[{begin:"\\b0b([01_]+)"+n},{begin:"\\b0o([0-7_]+)"+n},{begin:"\\b0x([A-Fa-f0-9_]+)"+n},{begin:"\\b(\\d[\\d_]*(\\.[0-9_]+)?([eE][+-]?[0-9_]+)?)"+n}],relevance:0},{begin:[/fn/,/\s+/,i.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.function"}},{className:"meta",begin:"#!?\\[",end:"\\]",contains:[{className:"string",begin:/"/,end:/"/}]},{begin:[/let/,/\s+/,/(?:mut\s+)?/,i.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"keyword",4:"variable"}},{begin:[/for/,/\s+/,i.UNDERSCORE_IDENT_RE,/\s+/,/in/],className:{1:"keyword",3:"variable",5:"keyword"}},{begin:[/type/,/\s+/,i.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.class"}},{begin:[/(?:trait|enum|struct|union|impl|for)/,/\s+/,i.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.class"}},{begin:i.IDENT_RE+"::",keywords:{keyword:"Self",built_in:s,type:a}},{className:"punctuation",begin:"->"},e]}}var UC=i=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:i.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[i.APOS_STRING_MODE,i.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:i.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),KC=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],qC=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],GC=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],jC=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],YC=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function Ob(i){let t=UC(i),e=jC,n=GC,r="@[a-z-]+",o="and or not only",a={className:"variable",begin:"(\\$"+"[a-zA-Z-][a-zA-Z0-9_-]*"+")\\b",relevance:0};return{name:"SCSS",case_insensitive:!0,illegal:"[=/|']",contains:[i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,t.CSS_NUMBER_MODE,{className:"selector-id",begin:"#[A-Za-z0-9_-]+",relevance:0},{className:"selector-class",begin:"\\.[A-Za-z0-9_-]+",relevance:0},t.ATTRIBUTE_SELECTOR_MODE,{className:"selector-tag",begin:"\\b("+KC.join("|")+")\\b",relevance:0},{className:"selector-pseudo",begin:":("+n.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+e.join("|")+")"},a,{begin:/\(/,end:/\)/,contains:[t.CSS_NUMBER_MODE]},t.CSS_VARIABLE,{className:"attribute",begin:"\\b("+YC.join("|")+")\\b"},{begin:"\\b(whitespace|wait|w-resize|visible|vertical-text|vertical-ideographic|uppercase|upper-roman|upper-alpha|underline|transparent|top|thin|thick|text|text-top|text-bottom|tb-rl|table-header-group|table-footer-group|sw-resize|super|strict|static|square|solid|small-caps|separate|se-resize|scroll|s-resize|rtl|row-resize|ridge|right|repeat|repeat-y|repeat-x|relative|progress|pointer|overline|outside|outset|oblique|nowrap|not-allowed|normal|none|nw-resize|no-repeat|no-drop|newspaper|ne-resize|n-resize|move|middle|medium|ltr|lr-tb|lowercase|lower-roman|lower-alpha|loose|list-item|line|line-through|line-edge|lighter|left|keep-all|justify|italic|inter-word|inter-ideograph|inside|inset|inline|inline-block|inherit|inactive|ideograph-space|ideograph-parenthesis|ideograph-numeric|ideograph-alpha|horizontal|hidden|help|hand|groove|fixed|ellipsis|e-resize|double|dotted|distribute|distribute-space|distribute-letter|distribute-all-lines|disc|disabled|default|decimal|dashed|crosshair|collapse|col-resize|circle|char|center|capitalize|break-word|break-all|bottom|both|bolder|bold|block|bidi-override|below|baseline|auto|always|all-scroll|absolute|table|table-cell)\\b"},{begin:/:/,end:/[;}{]/,relevance:0,contains:[t.BLOCK_COMMENT,a,t.HEXCOLOR,t.CSS_NUMBER_MODE,i.QUOTE_STRING_MODE,i.APOS_STRING_MODE,t.IMPORTANT,t.FUNCTION_DISPATCH]},{begin:"@(page|font-face)",keywords:{$pattern:r,keyword:"@page @font-face"}},{begin:"@",end:"[{;]",returnBegin:!0,keywords:{$pattern:/[a-z-]+/,keyword:o,attribute:qC.join(" ")},contains:[{begin:r,className:"keyword"},{begin:/[a-z-]+(?=:)/,className:"attribute"},a,i.QUOTE_STRING_MODE,i.APOS_STRING_MODE,t.HEXCOLOR,t.CSS_NUMBER_MODE]},t.FUNCTION_DISPATCH]}}function Db(i){return{name:"Shell Session",aliases:["console","shellsession"],contains:[{className:"meta.prompt",begin:/^\s{0,3}[/~\w\d[\]()@-]*[>%$#][ ]?/,starts:{end:/[^\\](?=\s*$)/,subLanguage:"bash"}}]}}function Bb(i){let t=i.regex,e=i.COMMENT("--","$"),n={className:"string",variants:[{begin:/'/,end:/'/,contains:[{begin:/''/}]}]},r={begin:/"/,end:/"/,contains:[{begin:/""/}]},o=["true","false","unknown"],s=["double precision","large object","with timezone","without timezone"],a=["bigint","binary","blob","boolean","char","character","clob","date","dec","decfloat","decimal","float","int","integer","interval","nchar","nclob","national","numeric","real","row","smallint","time","timestamp","varchar","varying","varbinary"],l=["add","asc","collation","desc","final","first","last","view"],c=["abs","acos","all","allocate","alter","and","any","are","array","array_agg","array_max_cardinality","as","asensitive","asin","asymmetric","at","atan","atomic","authorization","avg","begin","begin_frame","begin_partition","between","bigint","binary","blob","boolean","both","by","call","called","cardinality","cascaded","case","cast","ceil","ceiling","char","char_length","character","character_length","check","classifier","clob","close","coalesce","collate","collect","column","commit","condition","connect","constraint","contains","convert","copy","corr","corresponding","cos","cosh","count","covar_pop","covar_samp","create","cross","cube","cume_dist","current","current_catalog","current_date","current_default_transform_group","current_path","current_role","current_row","current_schema","current_time","current_timestamp","current_path","current_role","current_transform_group_for_type","current_user","cursor","cycle","date","day","deallocate","dec","decimal","decfloat","declare","default","define","delete","dense_rank","deref","describe","deterministic","disconnect","distinct","double","drop","dynamic","each","element","else","empty","end","end_frame","end_partition","end-exec","equals","escape","every","except","exec","execute","exists","exp","external","extract","false","fetch","filter","first_value","float","floor","for","foreign","frame_row","free","from","full","function","fusion","get","global","grant","group","grouping","groups","having","hold","hour","identity","in","indicator","initial","inner","inout","insensitive","insert","int","integer","intersect","intersection","interval","into","is","join","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","language","large","last_value","lateral","lead","leading","left","like","like_regex","listagg","ln","local","localtime","localtimestamp","log","log10","lower","match","match_number","match_recognize","matches","max","member","merge","method","min","minute","mod","modifies","module","month","multiset","national","natural","nchar","nclob","new","no","none","normalize","not","nth_value","ntile","null","nullif","numeric","octet_length","occurrences_regex","of","offset","old","omit","on","one","only","open","or","order","out","outer","over","overlaps","overlay","parameter","partition","pattern","per","percent","percent_rank","percentile_cont","percentile_disc","period","portion","position","position_regex","power","precedes","precision","prepare","primary","procedure","ptf","range","rank","reads","real","recursive","ref","references","referencing","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","release","result","return","returns","revoke","right","rollback","rollup","row","row_number","rows","running","savepoint","scope","scroll","search","second","seek","select","sensitive","session_user","set","show","similar","sin","sinh","skip","smallint","some","specific","specifictype","sql","sqlexception","sqlstate","sqlwarning","sqrt","start","static","stddev_pop","stddev_samp","submultiset","subset","substring","substring_regex","succeeds","sum","symmetric","system","system_time","system_user","table","tablesample","tan","tanh","then","time","timestamp","timezone_hour","timezone_minute","to","trailing","translate","translate_regex","translation","treat","trigger","trim","trim_array","true","truncate","uescape","union","unique","unknown","unnest","update","upper","user","using","value","values","value_of","var_pop","var_samp","varbinary","varchar","varying","versioning","when","whenever","where","width_bucket","window","with","within","without","year"],u=["abs","acos","array_agg","asin","atan","avg","cast","ceil","ceiling","coalesce","corr","cos","cosh","count","covar_pop","covar_samp","cume_dist","dense_rank","deref","element","exp","extract","first_value","floor","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","last_value","lead","listagg","ln","log","log10","lower","max","min","mod","nth_value","ntile","nullif","percent_rank","percentile_cont","percentile_disc","position","position_regex","power","rank","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","row_number","sin","sinh","sqrt","stddev_pop","stddev_samp","substring","substring_regex","sum","tan","tanh","translate","translate_regex","treat","trim","trim_array","unnest","upper","value_of","var_pop","var_samp","width_bucket"],d=["current_catalog","current_date","current_default_transform_group","current_path","current_role","current_schema","current_transform_group_for_type","current_user","session_user","system_time","system_user","current_time","localtime","current_timestamp","localtimestamp"],h=["create table","insert into","primary key","foreign key","not null","alter table","add constraint","grouping sets","on overflow","character set","respect nulls","ignore nulls","nulls first","nulls last","depth first","breadth first"],f=u,p=[...c,...l].filter(y=>!u.includes(y)),m={className:"variable",begin:/@[a-z0-9][a-z0-9_]*/},g={className:"operator",begin:/[-+*/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?/,relevance:0},b={begin:t.concat(/\b/,t.either(...f),/\s*\(/),relevance:0,keywords:{built_in:f}};function v(y,{exceptions:E,when:x}={}){let S=x;return E=E||[],y.map(w=>w.match(/\|\d+$/)||E.includes(w)?w:S(w)?`${w}|0`:w)}return{name:"SQL",case_insensitive:!0,illegal:/[{}]|<\//,keywords:{$pattern:/\b[\w\.]+/,keyword:v(p,{when:y=>y.length<3}),literal:o,type:a,built_in:d},contains:[{begin:t.either(...h),relevance:0,keywords:{$pattern:/[\w\.]+/,keyword:p.concat(h),literal:o,type:a}},{className:"type",begin:t.either(...s)},b,m,n,r,i.C_NUMBER_MODE,i.C_BLOCK_COMMENT_MODE,e,g]}}function Vb(i){return i?typeof i=="string"?i:i.source:null}function Da(i){return Le("(?=",i,")")}function Le(...i){return i.map(e=>Vb(e)).join("")}function XC(i){let t=i[i.length-1];return typeof t=="object"&&t.constructor===Object?(i.splice(i.length-1,1),t):{}}function wt(...i){return"("+(XC(i).capture?"":"?:")+i.map(n=>Vb(n)).join("|")+")"}var Pd=i=>Le(/\b/,i,/\w$/.test(i)?/\b/:/\B/),JC=["Protocol","Type"].map(Pd),Fb=["init","self"].map(Pd),ZC=["Any","Self"],Ad=["actor","any","associatedtype","async","await",/as\?/,/as!/,"as","break","case","catch","class","continue","convenience","default","defer","deinit","didSet","distributed","do","dynamic","else","enum","extension","fallthrough",/fileprivate\(set\)/,"fileprivate","final","for","func","get","guard","if","import","indirect","infix",/init\?/,/init!/,"inout",/internal\(set\)/,"internal","in","is","isolated","nonisolated","lazy","let","mutating","nonmutating",/open\(set\)/,"open","operator","optional","override","postfix","precedencegroup","prefix",/private\(set\)/,"private","protocol",/public\(set\)/,"public","repeat","required","rethrows","return","set","some","static","struct","subscript","super","switch","throws","throw",/try\?/,/try!/,"try","typealias",/unowned\(safe\)/,/unowned\(unsafe\)/,"unowned","var","weak","where","while","willSet"],Hb=["false","nil","true"],QC=["assignment","associativity","higherThan","left","lowerThan","none","right"],eL=["#colorLiteral","#column","#dsohandle","#else","#elseif","#endif","#error","#file","#fileID","#fileLiteral","#filePath","#function","#if","#imageLiteral","#keyPath","#line","#selector","#sourceLocation","#warn_unqualified_access","#warning"],zb=["abs","all","any","assert","assertionFailure","debugPrint","dump","fatalError","getVaList","isKnownUniquelyReferenced","max","min","numericCast","pointwiseMax","pointwiseMin","precondition","preconditionFailure","print","readLine","repeatElement","sequence","stride","swap","swift_unboxFromSwiftValueWithType","transcode","type","unsafeBitCast","unsafeDowncast","withExtendedLifetime","withUnsafeMutablePointer","withUnsafePointer","withVaList","withoutActuallyEscaping","zip"],$b=wt(/[/=\-+!*%<>&|^~?]/,/[\u00A1-\u00A7]/,/[\u00A9\u00AB]/,/[\u00AC\u00AE]/,/[\u00B0\u00B1]/,/[\u00B6\u00BB\u00BF\u00D7\u00F7]/,/[\u2016-\u2017]/,/[\u2020-\u2027]/,/[\u2030-\u203E]/,/[\u2041-\u2053]/,/[\u2055-\u205E]/,/[\u2190-\u23FF]/,/[\u2500-\u2775]/,/[\u2794-\u2BFF]/,/[\u2E00-\u2E7F]/,/[\u3001-\u3003]/,/[\u3008-\u3020]/,/[\u3030]/),Wb=wt($b,/[\u0300-\u036F]/,/[\u1DC0-\u1DFF]/,/[\u20D0-\u20FF]/,/[\uFE00-\uFE0F]/,/[\uFE20-\uFE2F]/),Id=Le($b,Wb,"*"),Ub=wt(/[a-zA-Z_]/,/[\u00A8\u00AA\u00AD\u00AF\u00B2-\u00B5\u00B7-\u00BA]/,/[\u00BC-\u00BE\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF]/,/[\u0100-\u02FF\u0370-\u167F\u1681-\u180D\u180F-\u1DBF]/,/[\u1E00-\u1FFF]/,/[\u200B-\u200D\u202A-\u202E\u203F-\u2040\u2054\u2060-\u206F]/,/[\u2070-\u20CF\u2100-\u218F\u2460-\u24FF\u2776-\u2793]/,/[\u2C00-\u2DFF\u2E80-\u2FFF]/,/[\u3004-\u3007\u3021-\u302F\u3031-\u303F\u3040-\uD7FF]/,/[\uF900-\uFD3D\uFD40-\uFDCF\uFDF0-\uFE1F\uFE30-\uFE44]/,/[\uFE47-\uFEFE\uFF00-\uFFFD]/),Ba=wt(Ub,/\d/,/[\u0300-\u036F\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]/),Bn=Le(Ub,Ba,"*"),Nd=Le(/[A-Z]/,Ba,"*"),tL=["autoclosure",Le(/convention\(/,wt("swift","block","c"),/\)/),"discardableResult","dynamicCallable","dynamicMemberLookup","escaping","frozen","GKInspectable","IBAction","IBDesignable","IBInspectable","IBOutlet","IBSegueAction","inlinable","main","nonobjc","NSApplicationMain","NSCopying","NSManaged",Le(/objc\(/,Bn,/\)/),"objc","objcMembers","propertyWrapper","requires_stored_property_inits","resultBuilder","testable","UIApplicationMain","unknown","usableFromInline"],nL=["iOS","iOSApplicationExtension","macOS","macOSApplicationExtension","macCatalyst","macCatalystApplicationExtension","watchOS","watchOSApplicationExtension","tvOS","tvOSApplicationExtension","swift"];function Kb(i){let t={match:/\s+/,relevance:0},e=i.COMMENT("/\\*","\\*/",{contains:["self"]}),n=[i.C_LINE_COMMENT_MODE,e],r={match:[/\./,wt(...JC,...Fb)],className:{2:"keyword"}},o={match:Le(/\./,wt(...Ad)),relevance:0},s=Ad.filter(ce=>typeof ce=="string").concat(["_|0"]),a=Ad.filter(ce=>typeof ce!="string").concat(ZC).map(Pd),l={variants:[{className:"keyword",match:wt(...a,...Fb)}]},c={$pattern:wt(/\b\w+/,/#\w+/),keyword:s.concat(eL),literal:Hb},u=[r,o,l],d={match:Le(/\./,wt(...zb)),relevance:0},h={className:"built_in",match:Le(/\b/,wt(...zb),/(?=\()/)},f=[d,h],p={match:/->/,relevance:0},m={className:"operator",relevance:0,variants:[{match:Id},{match:`\\.(\\.|${Wb})+`}]},g=[p,m],b="([0-9]_*)+",v="([0-9a-fA-F]_*)+",y={className:"number",relevance:0,variants:[{match:`\\b(${b})(\\.(${b}))?([eE][+-]?(${b}))?\\b`},{match:`\\b0x(${v})(\\.(${v}))?([pP][+-]?(${b}))?\\b`},{match:/\b0o([0-7]_*)+\b/},{match:/\b0b([01]_*)+\b/}]},E=(ce="")=>({className:"subst",variants:[{match:Le(/\\/,ce,/[0\\tnr"']/)},{match:Le(/\\/,ce,/u\{[0-9a-fA-F]{1,8}\}/)}]}),x=(ce="")=>({className:"subst",match:Le(/\\/,ce,/[\t ]*(?:[\r\n]|\r\n)/)}),S=(ce="")=>({className:"subst",label:"interpol",begin:Le(/\\/,ce,/\(/),end:/\)/}),w=(ce="")=>({begin:Le(ce,/"""/),end:Le(/"""/,ce),contains:[E(ce),x(ce),S(ce)]}),k=(ce="")=>({begin:Le(ce,/"/),end:Le(/"/,ce),contains:[E(ce),S(ce)]}),M={className:"string",variants:[w(),w("#"),w("##"),w("###"),k(),k("#"),k("##"),k("###")]},L={match:Le(/`/,Bn,/`/)},_={className:"variable",match:/\$\d+/},P={className:"variable",match:`\\$${Ba}+`},I=[L,_,P],N={match:/(@|#(un)?)available/,className:"keyword",starts:{contains:[{begin:/\(/,end:/\)/,keywords:nL,contains:[...g,y,M]}]}},D={className:"keyword",match:Le(/@/,wt(...tL))},R={className:"meta",match:Le(/@/,Bn)},A=[N,D,R],C={match:Da(/\b[A-Z]/),relevance:0,contains:[{className:"type",match:Le(/(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)/,Ba,"+")},{className:"type",match:Nd,relevance:0},{match:/[?!]+/,relevance:0},{match:/\.\.\./,relevance:0},{match:Le(/\s+&\s+/,Da(Nd)),relevance:0}]},O={begin:/</,end:/>/,keywords:c,contains:[...n,...u,...A,p,C]};C.contains.push(O);let H={match:Le(Bn,/\s*:/),keywords:"_|0",relevance:0},K={begin:/\(/,end:/\)/,relevance:0,keywords:c,contains:["self",H,...n,...u,...f,...g,y,M,...I,...A,C]},W={begin:/</,end:/>/,contains:[...n,C]},te={begin:wt(Da(Le(Bn,/\s*:/)),Da(Le(Bn,/\s+/,Bn,/\s*:/))),end:/:/,relevance:0,contains:[{className:"keyword",match:/\b_\b/},{className:"params",match:Bn}]},J={begin:/\(/,end:/\)/,keywords:c,contains:[te,...n,...u,...g,y,M,...A,C,K],endsParent:!0,illegal:/["']/},Q={match:[/func/,/\s+/,wt(L.match,Bn,Id)],className:{1:"keyword",3:"title.function"},contains:[W,J,t],illegal:[/\[/,/%/]},Ae={match:[/\b(?:subscript|init[?!]?)/,/\s*(?=[<(])/],className:{1:"keyword"},contains:[W,J,t],illegal:/\[|%/},$e={match:[/operator/,/\s+/,Id],className:{1:"keyword",3:"title"}},ke={begin:[/precedencegroup/,/\s+/,Nd],className:{1:"keyword",3:"title"},contains:[C],keywords:[...QC,...Hb],end:/}/};for(let ce of M.variants){let We=ce.contains.find(Ct=>Ct.label==="interpol");We.keywords=c;let dt=[...u,...f,...g,y,M,...I];We.contains=[...dt,{begin:/\(/,end:/\)/,contains:["self",...dt]}]}return{name:"Swift",keywords:c,contains:[...n,Q,Ae,{beginKeywords:"struct protocol class extension enum actor",end:"\\{",excludeEnd:!0,keywords:c,contains:[i.inherit(i.TITLE_MODE,{className:"title.class",begin:/[A-Za-z$_][\u00C0-\u02B80-9A-Za-z$_]*/}),...u]},$e,ke,{beginKeywords:"import",end:/$/,contains:[...n],relevance:0},...u,...f,...g,y,M,...I,...A,C,K]}}var Fa="[A-Za-z$_][0-9A-Za-z$_]*",qb=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],Gb=["true","false","null","undefined","NaN","Infinity"],jb=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],Yb=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Xb=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],Jb=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],Zb=[].concat(Xb,jb,Yb);function iL(i){let t=i.regex,e=(C,{after:O})=>{let H="</"+C[0].slice(1);return C.input.indexOf(H,O)!==-1},n=Fa,r={begin:"<>",end:"</>"},o=/<[A-Za-z0-9\\._:-]+\s*\/>/,s={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(C,O)=>{let H=C[0].length+C.index,K=C.input[H];if(K==="<"||K===","){O.ignoreMatch();return}K===">"&&(e(C,{after:H})||O.ignoreMatch());let W,te=C.input.substring(H);if(W=te.match(/^\s*=/)){O.ignoreMatch();return}if((W=te.match(/^\s+extends\s+/))&&W.index===0){O.ignoreMatch();return}}},a={$pattern:Fa,keyword:qb,literal:Gb,built_in:Zb,"variable.language":Jb},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",d={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},h={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},f={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[i.BACKSLASH_ESCAPE,h],subLanguage:"xml"}},p={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[i.BACKSLASH_ESCAPE,h],subLanguage:"css"}},m={begin:"gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[i.BACKSLASH_ESCAPE,h],subLanguage:"graphql"}},g={className:"string",begin:"`",end:"`",contains:[i.BACKSLASH_ESCAPE,h]},v={className:"comment",variants:[i.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:n+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),i.C_BLOCK_COMMENT_MODE,i.C_LINE_COMMENT_MODE]},y=[i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,f,p,m,g,{match:/\$\d+/},d];h.contains=y.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(y)});let E=[].concat(v,h.contains),x=E.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(E)}]),S={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x},w={variants:[{match:[/class/,/\s+/,n,/\s+/,/extends/,/\s+/,t.concat(n,"(",t.concat(/\./,n),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,n],scope:{1:"keyword",3:"title.class"}}]},k={relevance:0,match:t.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...jb,...Yb]}},M={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},L={variants:[{match:[/function/,/\s+/,n,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[S],illegal:/%/},_={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function P(C){return t.concat("(?!",C.join("|"),")")}let I={match:t.concat(/\b/,P([...Xb,"super","import"]),n,t.lookahead(/\(/)),className:"title.function",relevance:0},N={begin:t.concat(/\./,t.lookahead(t.concat(n,/(?![0-9A-Za-z$_(])/))),end:n,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},D={match:[/get|set/,/\s+/,n,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},S]},R="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+i.UNDERSCORE_IDENT_RE+")\\s*=>",A={match:[/const|var|let/,/\s+/,n,/\s*/,/=\s*/,/(async\s*)?/,t.lookahead(R)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[S]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:x,CLASS_REFERENCE:k},illegal:/#(?![$_A-z])/,contains:[i.SHEBANG({label:"shebang",binary:"node",relevance:5}),M,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,f,p,m,g,v,{match:/\$\d+/},d,k,{className:"attr",begin:n+t.lookahead(":"),relevance:0},A,{begin:"("+i.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[v,i.REGEXP_MODE,{className:"function",begin:R,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:i.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:r.begin,end:r.end},{match:o},{begin:s.begin,"on:begin":s.isTrulyOpeningTag,end:s.end}],subLanguage:"xml",contains:[{begin:s.begin,end:s.end,skip:!0,contains:["self"]}]}]},L,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+i.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[S,i.inherit(i.TITLE_MODE,{begin:n,className:"title.function"})]},{match:/\.\.\./,relevance:0},N,{match:"\\$"+n,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[S]},I,_,w,D,{match:/\$[(.]/}]}}function Qb(i){let t=iL(i),e=Fa,n=["any","void","number","boolean","string","object","never","symbol","bigint","unknown"],r={beginKeywords:"namespace",end:/\{/,excludeEnd:!0,contains:[t.exports.CLASS_REFERENCE]},o={beginKeywords:"interface",end:/\{/,excludeEnd:!0,keywords:{keyword:"interface extends",built_in:n},contains:[t.exports.CLASS_REFERENCE]},s={className:"meta",relevance:10,begin:/^\s*['"]use strict['"]/},a=["type","namespace","interface","public","private","protected","implements","declare","abstract","readonly","enum","override"],l={$pattern:Fa,keyword:qb.concat(a),literal:Gb,built_in:Zb.concat(n),"variable.language":Jb},c={className:"meta",begin:"@"+e},u=(h,f,p)=>{let m=h.contains.findIndex(g=>g.label===f);if(m===-1)throw new Error("can not find mode to replace");h.contains.splice(m,1,p)};Object.assign(t.keywords,l),t.exports.PARAMS_CONTAINS.push(c),t.contains=t.contains.concat([c,r,o]),u(t,"shebang",i.SHEBANG()),u(t,"use_strict",s);let d=t.contains.find(h=>h.label==="func.def");return d.relevance=0,Object.assign(t,{name:"TypeScript",aliases:["ts","tsx","mts","cts"]}),t}function ey(i){let t=i.regex,e={className:"string",begin:/"(""|[^/n])"C\b/},n={className:"string",begin:/"/,end:/"/,illegal:/\n/,contains:[{begin:/""/}]},r=/\d{1,2}\/\d{1,2}\/\d{4}/,o=/\d{4}-\d{1,2}-\d{1,2}/,s=/(\d|1[012])(:\d+){0,2} *(AM|PM)/,a=/\d{1,2}(:\d{1,2}){1,2}/,l={className:"literal",variants:[{begin:t.concat(/# */,t.either(o,r),/ *#/)},{begin:t.concat(/# */,a,/ *#/)},{begin:t.concat(/# */,s,/ *#/)},{begin:t.concat(/# */,t.either(o,r),/ +/,t.either(s,a),/ *#/)}]},c={className:"number",relevance:0,variants:[{begin:/\b\d[\d_]*((\.[\d_]+(E[+-]?[\d_]+)?)|(E[+-]?[\d_]+))[RFD@!#]?/},{begin:/\b\d[\d_]*((U?[SIL])|[%&])?/},{begin:/&H[\dA-F_]+((U?[SIL])|[%&])?/},{begin:/&O[0-7_]+((U?[SIL])|[%&])?/},{begin:/&B[01_]+((U?[SIL])|[%&])?/}]},u={className:"label",begin:/^\w+:/},d=i.COMMENT(/'''/,/$/,{contains:[{className:"doctag",begin:/<\/?/,end:/>/}]}),h=i.COMMENT(null,/$/,{variants:[{begin:/'/},{begin:/([\t ]|^)REM(?=\s)/}]});return{name:"Visual Basic .NET",aliases:["vb"],case_insensitive:!0,classNameAliases:{label:"symbol"},keywords:{keyword:"addhandler alias aggregate ansi as async assembly auto binary by byref byval call case catch class compare const continue custom declare default delegate dim distinct do each equals else elseif end enum erase error event exit explicit finally for friend from function get global goto group handles if implements imports in inherits interface into iterator join key let lib loop me mid module mustinherit mustoverride mybase myclass namespace narrowing new next notinheritable notoverridable of off on operator option optional order overloads overridable overrides paramarray partial preserve private property protected public raiseevent readonly redim removehandler resume return select set shadows shared skip static step stop structure strict sub synclock take text then throw to try unicode until using when where while widening with withevents writeonly yield",built_in:"addressof and andalso await directcast gettype getxmlnamespace is isfalse isnot istrue like mod nameof new not or orelse trycast typeof xor cbool cbyte cchar cdate cdbl cdec cint clng cobj csbyte cshort csng cstr cuint culng cushort",type:"boolean byte char date decimal double integer long object sbyte short single string uinteger ulong ushort",literal:"true false nothing"},illegal:"//|\\{|\\}|endif|gosub|variant|wend|^\\$ ",contains:[e,n,l,c,u,d,h,{className:"meta",begin:/[\t ]*#(const|disable|else|elseif|enable|end|externalsource|if|region)\b/,end:/$/,keywords:{keyword:"const disable else elseif enable end externalsource if region then"},contains:[h]}]}}function ty(i){i.regex;let t=i.COMMENT(/\(;/,/;\)/);t.contains.push("self");let e=i.COMMENT(/;;/,/$/),n=["anyfunc","block","br","br_if","br_table","call","call_indirect","data","drop","elem","else","end","export","func","global.get","global.set","local.get","local.set","local.tee","get_global","get_local","global","if","import","local","loop","memory","memory.grow","memory.size","module","mut","nop","offset","param","result","return","select","set_global","set_local","start","table","tee_local","then","type","unreachable"],r={begin:[/(?:func|call|call_indirect)/,/\s+/,/\$[^\s)]+/],className:{1:"keyword",3:"title.function"}},o={className:"variable",begin:/\$[\w_]+/},s={match:/(\((?!;)|\))+/,className:"punctuation",relevance:0},a={className:"number",relevance:0,match:/[+-]?\b(?:\d(?:_?\d)*(?:\.\d(?:_?\d)*)?(?:[eE][+-]?\d(?:_?\d)*)?|0x[\da-fA-F](?:_?[\da-fA-F])*(?:\.[\da-fA-F](?:_?[\da-fA-D])*)?(?:[pP][+-]?\d(?:_?\d)*)?)\b|\binf\b|\bnan(?::0x[\da-fA-F](?:_?[\da-fA-D])*)?\b/},l={match:/(i32|i64|f32|f64)(?!\.)/,className:"type"},c={className:"keyword",match:/\b(f32|f64|i32|i64)(?:\.(?:abs|add|and|ceil|clz|const|convert_[su]\/i(?:32|64)|copysign|ctz|demote\/f64|div(?:_[su])?|eqz?|extend_[su]\/i32|floor|ge(?:_[su])?|gt(?:_[su])?|le(?:_[su])?|load(?:(?:8|16|32)_[su])?|lt(?:_[su])?|max|min|mul|nearest|neg?|or|popcnt|promote\/f32|reinterpret\/[fi](?:32|64)|rem_[su]|rot[lr]|shl|shr_[su]|store(?:8|16|32)?|sqrt|sub|trunc(?:_[su]\/f(?:32|64))?|wrap\/i64|xor))\b/};return{name:"WebAssembly",keywords:{$pattern:/[\w.]+/,keyword:n},contains:[e,t,{match:[/(?:offset|align)/,/\s*/,/=/],className:{1:"keyword",3:"operator"}},o,s,r,i.QUOTE_STRING_MODE,l,c,a]}}function ny(i){let t=i.regex,e=t.concat(/[\p{L}_]/u,t.optional(/[\p{L}0-9_.-]*:/u),/[\p{L}0-9_.-]*/u),n=/[\p{L}0-9._:-]+/u,r={className:"symbol",begin:/&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;/},o={begin:/\s/,contains:[{className:"keyword",begin:/#?[a-z_][a-z1-9_-]+/,illegal:/\n/}]},s=i.inherit(o,{begin:/\(/,end:/\)/}),a=i.inherit(i.APOS_STRING_MODE,{className:"string"}),l=i.inherit(i.QUOTE_STRING_MODE,{className:"string"}),c={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:n,relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[r]},{begin:/'/,end:/'/,contains:[r]},{begin:/[^\s"'=<>`]+/}]}]}]};return{name:"HTML, XML",aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,unicodeRegex:!0,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,relevance:10,contains:[o,l,a,s,{begin:/\[/,end:/\]/,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,contains:[o,s,l,a]}]}]},i.COMMENT(/<!--/,/-->/,{relevance:10}),{begin:/<!\[CDATA\[/,end:/\]\]>/,relevance:10},r,{className:"meta",end:/\?>/,variants:[{begin:/<\?xml/,relevance:10,contains:[l]},{begin:/<\?[a-z][a-z0-9]+/}]},{className:"tag",begin:/<style(?=\s|>)/,end:/>/,keywords:{name:"style"},contains:[c],starts:{end:/<\/style>/,returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:/<script(?=\s|>)/,end:/>/,keywords:{name:"script"},contains:[c],starts:{end:/<\/script>/,returnEnd:!0,subLanguage:["javascript","handlebars","xml"]}},{className:"tag",begin:/<>|<\/>/},{className:"tag",begin:t.concat(/</,t.lookahead(t.concat(e,t.either(/\/>/,/>/,/\s/)))),end:/\/?>/,contains:[{className:"name",begin:e,relevance:0,starts:c}]},{className:"tag",begin:t.concat(/<\//,t.lookahead(t.concat(e,/>/))),contains:[{className:"name",begin:e,relevance:0},{begin:/>/,relevance:0,endsParent:!0}]}]}}function iy(i){let t="true false yes no null",e="[\\w#;/?:@&=+$,.~*'()[\\]]+",n={className:"attr",variants:[{begin:"\\w[\\w :\\/.-]*:(?=[ 	]|$)"},{begin:'"\\w[\\w :\\/.-]*":(?=[ 	]|$)'},{begin:"'\\w[\\w :\\/.-]*':(?=[ 	]|$)"}]},r={className:"template-variable",variants:[{begin:/\{\{/,end:/\}\}/},{begin:/%\{/,end:/\}/}]},o={className:"string",relevance:0,variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/\S+/}],contains:[i.BACKSLASH_ESCAPE,r]},s=i.inherit(o,{variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/[^\s,{}[\]]+/}]}),a="[0-9]{4}(-[0-9][0-9]){0,2}",l="([Tt \\t][0-9][0-9]?(:[0-9][0-9]){2})?",c="(\\.[0-9]*)?",u="([ \\t])*(Z|[-+][0-9][0-9]?(:[0-9][0-9])?)?",d={className:"number",begin:"\\b"+a+l+c+u+"\\b"},h={end:",",endsWithParent:!0,excludeEnd:!0,keywords:t,relevance:0},f={begin:/\{/,end:/\}/,contains:[h],illegal:"\\n",relevance:0},p={begin:"\\[",end:"\\]",contains:[h],illegal:"\\n",relevance:0},m=[n,{className:"meta",begin:"^---\\s*$",relevance:10},{className:"string",begin:"[\\|>]([1-9]?[+-])?[ ]*\\n( +)[^ ][^\\n]*\\n(\\2[^\\n]+\\n?)*"},{begin:"<%[%=-]?",end:"[%-]?%>",subLanguage:"ruby",excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:"!\\w+!"+e},{className:"type",begin:"!<"+e+">"},{className:"type",begin:"!"+e},{className:"type",begin:"!!"+e},{className:"meta",begin:"&"+i.UNDERSCORE_IDENT_RE+"$"},{className:"meta",begin:"\\*"+i.UNDERSCORE_IDENT_RE+"$"},{className:"bullet",begin:"-(?=[ ]|$)",relevance:0},i.HASH_COMMENT_MODE,{beginKeywords:t,keywords:{literal:t}},d,{className:"number",begin:i.C_NUMBER_RE+"\\b",relevance:0},f,p,o],g=[...m];return g.pop(),g.push(s),h.contains=g,{name:"YAML",case_insensitive:!0,aliases:["yml"],contains:m}}var wy=Go(ky(),1);var Ut=wy.default;var Ty=Go(My(),1),Lo=Object.assign(Bi(Error),{eval:Bi(EvalError),range:Bi(RangeError),reference:Bi(ReferenceError),syntax:Bi(SyntaxError),type:Bi(TypeError),uri:Bi(URIError)});function Bi(i){return t.displayName=i.displayName||i.name,t;function t(e,...n){let r=e&&(0,Ty.default)(e,...n);return new i(r)}}var GL={}.hasOwnProperty,Cy="hljs-";function Ly(i,t,e={}){let n=e.prefix;if(typeof i!="string")throw Lo("Expected `string` for name, got `%s`",i);if(!Ut.getLanguage(i))throw Lo("Unknown language: `%s` is not registered",i);if(typeof t!="string")throw Lo("Expected `string` for value, got `%s`",t);n==null&&(n=Cy),Ut.configure({__emitter:$d,classPrefix:n});let r=Ut.highlight(t,{language:i,ignoreIllegals:!0});if(Ut.configure({}),r.errorRaised)throw r.errorRaised;return r._emitter.root.data.language=r.language,r._emitter.root.data.relevance=r.relevance,r._emitter.root}function jL(i,t={}){let e=t.subset||Ut.listLanguages(),n=t.prefix,r=-1,o={type:"root",data:{language:null,relevance:0},children:[]};if(n==null&&(n=Cy),typeof i!="string")throw Lo("Expected `string` for value, got `%s`",i);for(;++r<e.length;){let s=e[r];if(!Ut.getLanguage(s))continue;let a=Ly(s,i,t);a.data.relevance>o.data.relevance&&(o=a)}return o}function YL(i,t){Ut.registerLanguage(i,t)}var XL=function(i,t){if(typeof i=="string")Ut.registerAliases(t,{languageName:i});else{let e;for(e in i)GL.call(i,e)&&Ut.registerAliases(i[e],{languageName:e})}};function JL(i){return Boolean(Ut.getLanguage(i))}function ZL(){return Ut.listLanguages()}var $d=class{constructor(t){this.options=t,this.root={type:"root",data:{language:null,relevance:0},children:[]},this.stack=[this.root]}addText(t){if(t==="")return;let e=this.stack[this.stack.length-1],n=e.children[e.children.length-1];n&&n.type==="text"?n.value+=t:e.children.push({type:"text",value:t})}startScope(t){this.openNode(String(t))}endScope(){this.closeNode()}__addSublanguage(t,e){let n=this.stack[this.stack.length-1],r=t.root.children;e?n.children.push({type:"element",tagName:"span",properties:{className:[e]},children:r}):n.children.push(...r)}openNode(t){let e=t.split(".").map((o,s)=>s?o+"_".repeat(s):this.options.classPrefix+o),n=this.stack[this.stack.length-1],r={type:"element",tagName:"span",properties:{className:e},children:[]};n.children.push(r),this.stack.push(r)}closeNode(){this.stack.pop()}finalize(){}toHTML(){return""}},le={highlight:Ly,highlightAuto:jL,registerLanguage:YL,registered:JL,listLanguages:ZL,registerAlias:XL};le.registerLanguage("arduino",Q0);le.registerLanguage("bash",eb);le.registerLanguage("c",tb);le.registerLanguage("cpp",nb);le.registerLanguage("csharp",ib);le.registerLanguage("css",rb);le.registerLanguage("diff",ob);le.registerLanguage("go",sb);le.registerLanguage("graphql",ab);le.registerLanguage("ini",lb);le.registerLanguage("java",db);le.registerLanguage("javascript",gb);le.registerLanguage("json",bb);le.registerLanguage("kotlin",yb);le.registerLanguage("less",xb);le.registerLanguage("lua",Sb);le.registerLanguage("makefile",kb);le.registerLanguage("markdown",wb);le.registerLanguage("objectivec",Mb);le.registerLanguage("perl",Tb);le.registerLanguage("php",Cb);le.registerLanguage("php-template",Lb);le.registerLanguage("plaintext",Rb);le.registerLanguage("python",Ab);le.registerLanguage("python-repl",Ib);le.registerLanguage("r",Nb);le.registerLanguage("ruby",Pb);le.registerLanguage("rust",_b);le.registerLanguage("scss",Ob);le.registerLanguage("shell",Db);le.registerLanguage("sql",Bb);le.registerLanguage("swift",Kb);le.registerLanguage("typescript",Qb);le.registerLanguage("vbnet",ey);le.registerLanguage("wasm",ty);le.registerLanguage("xml",ny);le.registerLanguage("yaml",iy);var Ry=Z0.configure({lowlight:le,HTMLAttributes:{class:"tategaki-code-block"},languageClassPrefix:"language-"});var Ay=Ig.extend({selectable:!0,addProseMirrorPlugins(){var t,e;let i=this.name;return[...(e=(t=this.parent)==null?void 0:t.call(this))!=null?e:[],new X({props:{handleClickOn:(n,r,o,s,a,l)=>{if(!l||o.type.name!==i)return!1;let c=n.state.tr.setSelection(Y.create(n.state.doc,s));return n.dispatch(c),!0}}})]}});function QL(i,t){return i==="vertical-rl"||i==="horizontal-tb"?i:t}var Iy=ue.create({name:"verticalWriting",addOptions(){return{defaultMode:"vertical-rl",targetNodeTypes:["paragraph","heading"]}},addStorage(){return{currentMode:this.options.defaultMode}},onCreate(){this.storage.currentMode=this.options.defaultMode},addGlobalAttributes(){return[{types:this.options.targetNodeTypes,attributes:{writingMode:{default:this.options.defaultMode,parseHTML:i=>i.style.writingMode||this.storage.currentMode,renderHTML:i=>{if(!i.writingMode)return{};let t=i.writingMode==="vertical-rl";return{style:`writing-mode: ${i.writingMode}; text-orientation: ${t?"mixed":"initial"};`}}}}}]},addProseMirrorPlugins(){return[new X({appendTransaction:(i,t,e)=>{if(!i.some(a=>a.docChanged))return;let n=this.storage.currentMode,r=new Set(this.options.targetNodeTypes),o=e.tr,s=!1;if(e.doc.descendants((a,l)=>{var u;if(!r.has(a.type.name)||((u=a.attrs)==null?void 0:u.writingMode)===n)return!0;let c={...a.attrs,writingMode:n};return o=o.setNodeMarkup(l,a.type,c,a.marks),s=!0,!0}),!!s)return o.setMeta("addToHistory",!1),o}})]},addCommands(){return{setWritingMode:i=>({state:t,dispatch:e})=>{var l;let n=QL(i,this.options.defaultMode),{tr:r}=t;r.setMeta("addToHistory",!1);let o=new Set(this.options.targetNodeTypes),s=!1;t.doc.descendants((c,u)=>{var h;if(!o.has(c.type.name)||((h=c.attrs)==null?void 0:h.writingMode)===n)return!0;let d={...c.attrs,writingMode:n};return r.setNodeMarkup(u,c.type,d,c.marks),s=!0,!0}),e&&s&&e(r),this.storage.currentMode=n;let a=(l=this.editor)==null?void 0:l.view.dom;if(a){a.setAttribute("data-writing-mode",n);let c=a.closest(".tategaki-wysiwyg-editor");c&&(c.setAttribute("data-writing-mode",n),c.style.setProperty("--tategaki-writing-mode",n))}return!0}}}});var Ny=Rg.extend({addStorage(){return{markdown:{serialize(i){i.write(`
`)}}}}});var Fn=new se("tategaki-search-highlight");function Wd(i,t,e){let n=[];return t.forEach((r,o)=>{let s=o===e;n.push(Me.inline(r.from,r.to,{class:s?"tategaki-search-match-active":"tategaki-search-match"}))}),me.create(i,n)}var eR=ue.create({name:"searchHighlight",addProseMirrorPlugins(){return[new X({key:Fn,state:{init(i,t){return{results:[],currentIndex:-1,decorations:me.create(t.doc,[])}},apply(i,t,e,n){let r=i.getMeta(Fn),o=t;if(i.docChanged){let s=t.results.map(a=>({from:i.mapping.map(a.from),to:i.mapping.map(a.to)})).filter(a=>a.from<a.to);o={...o,results:s,decorations:Wd(n.doc,s,t.currentIndex)}}if(r)switch(r.type){case"set":return{results:r.results,currentIndex:r.currentIndex,decorations:Wd(n.doc,r.results,r.currentIndex)};case"index":return{...o,currentIndex:r.currentIndex,decorations:Wd(n.doc,o.results,r.currentIndex)};case"clear":return{results:[],currentIndex:-1,decorations:me.create(n.doc,[])}}return o}},props:{decorations(i){var t;return((t=Fn.getState(i))==null?void 0:t.decorations)||null}}})]},addCommands(){return{setSearchResults:(i,t)=>({tr:e,dispatch:n})=>(n&&n(e.setMeta(Fn,{type:"set",results:i,currentIndex:t})),!0),setSearchCurrentIndex:i=>({tr:t,dispatch:e})=>(e&&e(t.setMeta(Fn,{type:"index",currentIndex:i})),!0),clearSearchResults:()=>({tr:i,dispatch:t})=>(t&&t(i.setMeta(Fn,{type:"clear"})),!0)}}}),Py=eR;var tR=/(?:(?:[|\uFF5C]?(?<body1>[\u4E00-\u9FA0\u3005]+?))|(?:[|\uFF5C](?<body2>[^|\uFF5C]+?)))(?<ruby>.+?)$/,_y=/(?:(?:[|\uFF5C]?(?<body1>[\u4E00-\u9FA0\u3005]+?))|(?:[|\uFF5C](?<body2>[^|\uFF5C]+?)))(?<ruby>.+?)/g,Oy=Se.create({name:"aozoraRuby",inline:!0,group:"inline",content:"text*",selectable:!0,addAttributes(){return{ruby:{default:""},hasDelimiter:{default:!1}}},parseHTML(){return[{tag:"span.tategaki-aozora-ruby[data-aozora-ruby]",getAttrs:i=>{var r;if(!(i instanceof HTMLElement))return!1;let t=(r=i.querySelector(".tategaki-aozora-ruby-rt"))==null?void 0:r.textContent,e=t!=null?t:"",n=i.getAttribute("data-aozora-delimiter")==="1";return{ruby:e,hasDelimiter:n}},contentElement:i=>i.querySelector("span[data-aozora-base]")},{tag:"ruby[data-aozora-ruby]",getAttrs:i=>{var r;if(!(i instanceof HTMLElement))return!1;let t=i.querySelector("rt"),e=(r=t==null?void 0:t.textContent)!=null?r:"",n=i.getAttribute("data-aozora-delimiter")==="1";return{ruby:e,hasDelimiter:n}},contentElement:i=>i.querySelector("span[data-aozora-base]")},{tag:"ruby",getAttrs:i=>{var n;if(!(i instanceof HTMLElement)||i.hasAttribute("data-aozora-ruby"))return!1;let t=i.querySelector("rt");return{ruby:(n=t==null?void 0:t.textContent)!=null?n:"",hasDelimiter:!1}},contentElement:i=>{var n,r;let t=i,e=(r=(n=t.ownerDocument)==null?void 0:n.createElement("span"))!=null?r:document.createElement("span");for(let o of Array.from(t.childNodes)){if(o instanceof HTMLElement){let s=o.tagName.toUpperCase();if(s==="RT"||s==="RP")continue}e.appendChild(o.cloneNode(!0))}return e}}]},renderHTML({node:i}){var e;return["span",{...{"data-aozora-ruby":"1","data-aozora-delimiter":i.attrs.hasDelimiter?"1":"0"},class:"tategaki-aozora-ruby"},["span",{"data-aozora-base":"1"},0],["span",{class:"tategaki-aozora-ruby-rt","data-pm-ignore":"true",contenteditable:"false",draggable:"false","aria-hidden":"true"},(e=i.attrs.ruby)!=null?e:""]]},addInputRules(){return[new pr({find:tR,handler:({commands:i,match:t,range:e})=>{var a,l,c,u;let n=t.groups,r=(l=(a=n==null?void 0:n.body2)!=null?a:n==null?void 0:n.body1)!=null?l:"",o=(c=n==null?void 0:n.ruby)!=null?c:"";if(!r||!o)return null;let s=/^[|\uFF5C]/.test((u=t[0])!=null?u:"");return i.insertContentAt(e,{type:this.name,attrs:{ruby:o,hasDelimiter:s},content:[{type:"text",text:r}]}),null}})]},addProseMirrorPlugins(){let i=this.type,t=e=>{if(e.isText&&e.text){let n=e.text,r=Array.from(n.matchAll(_y));if(r.length===0)return e;let o=[],s=0;if(r.forEach(a=>{var h,f,p,m,g;let l=(h=a.index)!=null?h:0;if(l>s){let b=n.slice(s,l);o.push(i.schema.text(b,e.marks))}let c=a.groups,u=(p=(f=c==null?void 0:c.body2)!=null?f:c==null?void 0:c.body1)!=null?p:"",d=(m=c==null?void 0:c.ruby)!=null?m:"";if(u&&d){let b=/^[|\uFF5C]/.test((g=a[0])!=null?g:""),v=i.create({ruby:d,hasDelimiter:b},i.schema.text(u));o.push(v)}s=l+a[0].length}),s<n.length){let a=n.slice(s);o.push(i.schema.text(a,e.marks))}return o}else if(e.content&&e.content.size>0){let n=[];return e.content.forEach(r=>{let o=t(r);Array.isArray(o)?n.push(...o):n.push(o)}),e.copy(z.from(n))}return e};return[new X({key:new se("aozoraRubyPaste"),props:{transformPasted:e=>{let n=[];return e.content.forEach(r=>{let o=t(r);Array.isArray(o)?n.push(...o):n.push(o)}),new q(z.from(n),e.openStart,e.openEnd)},transformPastedText:e=>{let n=e;return Array.from(e.matchAll(_y)).length>0?e:n}}})]},addStorage(){return{markdown:{serialize:(i,t)=>{var o,s,a,l;let e=(o=t.textContent)!=null?o:"",n=String((a=(s=t.attrs)==null?void 0:s.ruby)!=null?a:"");if(!e||!n){i.text(e||n||"",!1);return}let r=(l=t.attrs)!=null&&l.hasDelimiter?"\uFF5C":"";i.write(`${r}${e}\u300A${n}\u300B`)}}}}});var nR=/(?:^|\s)(==(?!\s+==)((?:[^=\n]+))==)$/,iR=/(?:^|\s)(==(?!\s+==)((?:[^=\n]+))==)/g,Dy=Ve.create({name:"obsidianHighlight",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:i}){return["mark",pe(this.options.HTMLAttributes,i),0]},addCommands(){return{setObsidianHighlight:()=>({commands:i})=>i.setMark(this.name),toggleObsidianHighlight:()=>({commands:i})=>i.toggleMark(this.name),unsetObsidianHighlight:()=>({commands:i})=>i.unsetMark(this.name)}},addInputRules(){return[zt({find:nR,type:this.type})]},addPasteRules(){return[St({find:iR,type:this.type})]},addStorage(){return{markdown:{serialize:{open:"==",close:"==",expelEnclosingWhitespace:!0},parse:{}}}}});var Ro=new se("tategakiExternalCursor");function rR(i,t){let e=Math.max(0,i.doc.content.size);return Math.max(0,Math.min(t,e))}function oR(i,t){if(typeof t!="number")return null;let e=rR(i,t),n=Me.widget(e,()=>{let r=document.createElement("span");return r.className="cursor-indicator tategaki-external-caret",r},{side:-1});return me.create(i.doc,[n])}function sR(i,t,e){let n=e.getMeta(Ro);return n?n.type==="clear"?{pos:null}:n.type==="set"?{pos:n.pos}:t:t}var By=ue.create({name:"externalCursor",addCommands(){return{setExternalCursor:i=>({tr:t,dispatch:e})=>(e==null||e(t.setMeta(Ro,{type:"set",pos:i})),!0),clearExternalCursor:()=>({tr:i,dispatch:t})=>(t==null||t(i.setMeta(Ro,{type:"clear"})),!0)}},addProseMirrorPlugins(){return[new X({key:Ro,state:{init:()=>({pos:null}),apply:(i,t,e,n)=>sR(n,t,i)},props:{decorations:i=>{var e;let t=Ro.getState(i);return oR(i,(e=t==null?void 0:t.pos)!=null?e:null)}},view:i=>({destroy:()=>{}})})]}});var Fy=Ve.create({name:"spanStyle",addAttributes(){return{class:{default:null},style:{default:null},dataAttrs:{default:{}}}},parseHTML(){return[{tag:"span",getAttrs:i=>{if(!(i instanceof HTMLElement)||i.classList.contains("tategaki-aozora-ruby")||i.classList.contains("tategaki-aozora-ruby-rt")||i.hasAttribute("data-aozora-base"))return!1;let t=i.getAttribute("class"),e=i.getAttribute("style"),n={};for(let r of i.getAttributeNames()){if(!r.startsWith("data-"))continue;let o=i.getAttribute(r);o!=null&&(n[r]=o)}return{class:t||null,style:e||null,dataAttrs:n}}}]},renderHTML({mark:i}){var o,s,a,l,c,u;let t={},e=(s=(o=i.attrs)==null?void 0:o.class)!=null?s:null,n=(l=(a=i.attrs)==null?void 0:a.style)!=null?l:null;e&&(t.class=e),n&&(t.style=n);let r=(u=(c=i.attrs)==null?void 0:c.dataAttrs)!=null?u:{};for(let[d,h]of Object.entries(r))d.startsWith("data-")&&(t[d]=h);return["span",t,0]}});var Hy=Ve.create({name:"superscript",parseHTML(){return[{tag:"sup"}]},renderHTML(){return["sup",0]}}),zy=Ve.create({name:"subscript",parseHTML(){return[{tag:"sub"}]},renderHTML(){return["sub",0]}}),Vy=Ve.create({name:"smallText",parseHTML(){return[{tag:"small"}]},renderHTML(){return["small",0]}});var $y=Se.create({name:"wbr",inline:!0,group:"inline",atom:!0,selectable:!1,parseHTML(){return[{tag:"wbr"}]},renderHTML(){return["wbr"]}});var Wy=Se.create({name:"tategakiImage",group:"inline",inline:!0,atom:!0,draggable:!0,selectable:!0,addAttributes(){return{src:{default:""},alt:{default:""},title:{default:""},source:{default:"markdown"},originalSrc:{default:""},obsidianSrc:{default:""},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:"img",getAttrs:i=>{var d,h,f,p,m,g,b,v;if(!(i instanceof HTMLElement))return!1;let t=(d=i.getAttribute("src"))!=null?d:"",e=(h=i.getAttribute("alt"))!=null?h:"",n=(f=i.getAttribute("title"))!=null?f:"",r=(p=i.getAttribute("data-tategaki-source"))!=null?p:"markdown",o=(m=i.getAttribute("data-tategaki-original-src"))!=null?m:"",s=(g=i.getAttribute("data-tategaki-obsidian-src"))!=null?g:"",a=(b=i.getAttribute("data-tategaki-width"))!=null?b:i.getAttribute("width"),l=(v=i.getAttribute("data-tategaki-height"))!=null?v:i.getAttribute("height"),c=a?Number(a):null,u=l?Number(l):null;return{src:t,alt:e,title:n,source:r==="obsidian"?"obsidian":"markdown",originalSrc:o,obsidianSrc:s,width:Number.isFinite(c)?c:null,height:Number.isFinite(u)?u:null}}}]},renderHTML({HTMLAttributes:i}){var c,u,d,h,f,p;let t={src:String((c=i.src)!=null?c:"")},e=String((u=i.alt)!=null?u:"");e&&(t.alt=e);let n=String((d=i.title)!=null?d:"");n&&(t.title=n);let r=String((h=i.source)!=null?h:"markdown");t["data-tategaki-source"]=r==="obsidian"?"obsidian":"markdown";let o=String((f=i.originalSrc)!=null?f:"");o&&(t["data-tategaki-original-src"]=o);let s=String((p=i.obsidianSrc)!=null?p:"");s&&(t["data-tategaki-obsidian-src"]=s);let a=i.width;typeof a=="number"&&Number.isFinite(a)&&(t["data-tategaki-width"]=String(a));let l=i.height;return typeof l=="number"&&Number.isFinite(l)&&(t["data-tategaki-height"]=String(l)),t.contenteditable="false",["img",pe(t)]}});function Ud(i){let{element:t,content:e="",onUpdate:n,settings:r}=i,o=r.common.writingMode;t.classList.add("tategaki-wysiwyg-editor"),t.setAttribute("data-writing-mode",o),t.setAttribute("lang","ja");let s=new Eg({element:t,extensions:[k0,w0.configure({isVertical:()=>t.getAttribute("data-writing-mode")==="vertical-rl"}),T0.configure({isVertical:()=>t.getAttribute("data-writing-mode")==="vertical-rl"}),Py,By,Fy,Hy,zy,Vy,$y,Wy,Lg,r0,s0,Dy,Oy,Ag.configure({levels:[1,2,3,4,5,6]}),Mg,Ng,o0,a0,E0,x0,S0,wg,Tg,Ry,Ny,Ay,jg.configure({autolink:!0,openOnClick:!0,linkOnPaste:!0,HTMLAttributes:{rel:"noopener noreferrer",target:"_blank"}}),Iy.configure({defaultMode:o,targetNodeTypes:["paragraph","heading"]}),v0.configure({document:!1,paragraph:!1,text:!1,heading:!1,bold:!1,italic:!1,bulletList:!1,orderedList:!1,listItem:!1,blockquote:!1,code:!1,hardBreak:!1,strike:!1,underline:!1,horizontalRule:!1,link:!1,codeBlock:!1})],content:e,editorProps:{handleDOMEvents:{copy:(a,l)=>{var m,g,b,v,y,E,x,S;if(!(l instanceof ClipboardEvent))return!1;let c=window.getSelection();if(!c||c.rangeCount===0)return!1;let u=c.getRangeAt(0),d=document.createElement("div");d.appendChild(u.cloneContents()),d.querySelectorAll("br[data-tategaki-placeholder]").forEach(w=>w.remove()),d.querySelectorAll("br.Apple-interchange-newline").forEach(w=>w.remove());let h=Array.from(d.querySelectorAll(".tategaki-aozora-ruby"));for(let w of h){let k=(m=w.querySelector("span[data-aozora-base]"))==null?void 0:m.textContent,M=(g=w.querySelector(".tategaki-aozora-ruby-rt"))==null?void 0:g.textContent,L=w.getAttribute("data-aozora-delimiter")==="1";if(!k||!M)continue;let _=(v=(b=w.ownerDocument)==null?void 0:b.createElement("ruby"))!=null?v:document.createElement("ruby");_.setAttribute("data-aozora-ruby","1"),_.setAttribute("data-aozora-delimiter",L?"1":"0");let P=(E=(y=w.ownerDocument)==null?void 0:y.createElement("span"))!=null?E:document.createElement("span");P.setAttribute("data-aozora-base","1"),P.textContent=k;let I=(S=(x=w.ownerDocument)==null?void 0:x.createElement("rt"))!=null?S:document.createElement("rt");I.textContent=M,_.appendChild(P),_.appendChild(I),w.replaceWith(_)}let f=d.innerHTML,p=qn(f,{addDelimiter:!0});return l.clipboardData?(l.preventDefault(),l.clipboardData.setData("text/plain",p),l.clipboardData.setData("text/markdown",p),l.clipboardData.setData("text/html",f),!0):!1}},transformPastedHTML:a=>Zi(a),transformPastedText:a=>Zi(a),clipboardTextSerializer:a=>a.content.textBetween(0,a.content.size,`
`,`
`)},onUpdate:({editor:a})=>{n==null||n(a)}});return s.commands.setWritingMode(o),s}var ot=require("obsidian");function Hn(i,t){return i.isActive("heading",{level:t})?i.chain().focus().toggleHeading({level:t}).run():i.chain().focus().command(({state:e,tr:n,dispatch:r})=>{var M;let{selection:o}=e,{$from:s}=o,a=s.parent,l=e.schema.nodes.heading,c=e.schema.nodes.paragraph;if(!a.isTextblock||!l||!c)return!1;let u=s.parentOffset,d=a.content.size,h=0,f=0,p=d,m=d;a.forEach((L,_)=>{if(L.type.name==="hardBreak"){if(_<u){h=_,f=_+L.nodeSize;return}_>=u&&p===d&&(p=_,m=_+L.nodeSize)}});let g=h>0?a.content.cut(0,h):null,b=a.content.cut(f,p),v=m<d?a.content.cut(m,d):null;if(!b||b.size===0)return!1;let y=[],E=typeof((M=a.attrs)==null?void 0:M.writingMode)=="string"?{writingMode:a.attrs.writingMode}:void 0,x=E?{...E,level:t}:{level:t},S=E!=null?E:void 0;g&&g.size>0&&y.push(c.create(S||null,g)),y.push(l.create(x,b)),v&&v.size>0&&y.push(c.create(S||null,v));let w=s.before(s.depth),k=s.after(s.depth);return n.replaceWith(w,k,y),r==null||r(n.scrollIntoView()),!0}).run()}var ri=require("obsidian"),Yt=class extends ri.Modal{constructor(e,n,r){super(e);this.result={url:null,text:null,cancelled:!0};this.urlInput=null;this.textInput=null;this.selectedText=n,this.needsTextInput=!n||n.trim()==="",this.onResolve=r}onOpen(){var s;let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-link-input-modal"),e.createEl("h2",{text:"\u30EA\u30F3\u30AF\u306E\u633F\u5165"});let n=e.createDiv("link-url-container");n.style.cssText=`
			margin-bottom: 1em;
		`;let r=n.createEl("label",{text:"URL"});if(r.style.cssText=`
			display: block;
			margin-bottom: 0.5em;
			font-weight: 500;
		`,this.urlInput=new ri.TextComponent(n),this.urlInput.inputEl.style.cssText=`
			width: 100%;
			box-sizing: border-box;
		`,this.urlInput.setPlaceholder("https://example.com"),this.urlInput.setValue("https://"),this.needsTextInput){let a=e.createDiv("link-text-container");a.style.cssText=`
				margin-bottom: 1em;
			`;let l=a.createEl("label",{text:"\u30EA\u30F3\u30AF\u30C6\u30AD\u30B9\u30C8"});l.style.cssText=`
				display: block;
				margin-bottom: 0.5em;
				font-weight: 500;
			`,this.textInput=new ri.TextComponent(a),this.textInput.inputEl.style.cssText=`
				width: 100%;
				box-sizing: border-box;
			`,this.textInput.setPlaceholder("\u30EA\u30F3\u30AF\u306E\u30C6\u30AD\u30B9\u30C8")}else{let a=e.createDiv("link-text-container");a.style.cssText=`
				margin-bottom: 1em;
			`;let l=a.createEl("label",{text:"\u30EA\u30F3\u30AF\u30C6\u30AD\u30B9\u30C8"});l.style.cssText=`
				display: block;
				margin-bottom: 0.5em;
				font-weight: 500;
			`;let c=a.createDiv();c.style.cssText=`
				padding: 0.5em;
				background: var(--background-secondary);
				border-radius: 4px;
				color: var(--text-muted);
			`,c.textContent=this.selectedText}let o=e.createDiv("link-buttons");o.style.cssText=`
			display: flex;
			gap: 0.75em;
			justify-content: flex-end;
			padding-top: 1em;
			border-top: 1px solid var(--background-modifier-border);
		`,new ri.ButtonComponent(o).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.result={url:null,text:null,cancelled:!0},this.close()}),new ri.ButtonComponent(o).setButtonText("\u633F\u5165").setClass("mod-cta").onClick(()=>{this.submitLink()}),(s=this.urlInput)==null||s.inputEl.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),this.needsTextInput&&this.textInput?this.textInput.inputEl.focus():this.submitLink())}),this.textInput&&this.textInput.inputEl.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),this.submitLink())}),setTimeout(()=>{var a,l;(a=this.urlInput)==null||a.inputEl.focus(),(l=this.urlInput)==null||l.inputEl.setSelectionRange(8,8)},10)}submitLink(){var r,o,s;let e=((r=this.urlInput)==null?void 0:r.getValue())||"";if(!e||e==="https://"){(o=this.urlInput)==null||o.inputEl.focus();return}let n=this.selectedText;this.needsTextInput&&(n=((s=this.textInput)==null?void 0:s.getValue())||e),this.result={url:e,text:n,cancelled:!1},this.close()}onClose(){let{contentEl:e}=this;e.empty(),this.onResolve(this.result)}};var zn=require("obsidian"),Xt=class extends zn.Modal{constructor(e,n,r){super(e);this.result={text:null,ruby:null,isDot:!1,cancelled:!0};this.rubyInput=null;this.dotToggle=null;this.isComposing=!1;this.selectedText=n,this.onResolve=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-ruby-input-modal"),this.modalEl.style.cssText=`
			max-width: 500px;
			width: 90%;
		`,e.style.cssText=`
			padding: 20px;
		`,e.createEl("h2",{text:"\u30EB\u30D3\u306E\u633F\u5165"});let n=e.createDiv({cls:"tategaki-modal-text-display"});n.style.cssText=`
			margin-bottom: 15px;
			display: flex;
			flex-direction: column;
			gap: 8px;
		`;let r=n.createEl("label",{text:"\u5BFE\u8C61\u30C6\u30AD\u30B9\u30C8:"});r.style.fontWeight="bold";let o=n.createEl("div",{text:this.selectedText,cls:"tategaki-modal-selected-text"});o.style.cssText=`
			padding: 8px 12px;
			background: var(--background-secondary);
			border-radius: 4px;
			color: var(--text-normal);
		`;let s=e.createDiv({cls:"tategaki-modal-input-container"});s.style.cssText=`
			margin-bottom: 15px;
			display: flex;
			flex-direction: column;
			gap: 8px;
		`,s.createEl("label",{text:"\u30EB\u30D3:"}),this.rubyInput=new zn.TextComponent(s),this.rubyInput.inputEl.addClass("tategaki-modal-input-full"),this.rubyInput.inputEl.style.width="100%",this.rubyInput.inputEl.placeholder="\u3075\u308A\u304C\u306A",this.rubyInput.inputEl.addEventListener("compositionstart",()=>{this.isComposing=!0}),this.rubyInput.inputEl.addEventListener("compositionend",()=>{this.isComposing=!1}),this.rubyInput.inputEl.addEventListener("keydown",c=>{c.key==="Enter"&&!this.isComposing&&(c.preventDefault(),this.submitRuby())});let a=e.createDiv({cls:"tategaki-modal-input-container"});a.style.cssText=`
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 10px;
		`,a.createEl("label",{text:"\u508D\u70B9:"}),this.dotToggle=new zn.ToggleComponent(a),this.dotToggle.onChange(c=>{c&&this.rubyInput?(this.rubyInput.setValue("\u30FB"),this.rubyInput.inputEl.disabled=!0):this.rubyInput&&(this.rubyInput.setValue(""),this.rubyInput.inputEl.disabled=!1,this.rubyInput.inputEl.focus())});let l=e.createDiv({cls:"tategaki-modal-button-container"});l.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 10px;
			margin-top: 20px;
		`,new zn.ButtonComponent(l).setButtonText("\u633F\u5165").setCta().onClick(()=>{this.submitRuby()}),new zn.ButtonComponent(l).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.close()}),setTimeout(()=>{var c;(c=this.rubyInput)==null||c.inputEl.focus()},100)}submitRuby(){var o,s;let e=this.selectedText,n=((o=this.rubyInput)==null?void 0:o.getValue())||"",r=((s=this.dotToggle)==null?void 0:s.getValue())||!1;this.result={text:e,ruby:r?"\u30FB":n,isDot:r,cancelled:!1},this.close()}onClose(){let{contentEl:e}=this;e.empty(),this.onResolve(this.result)}};var Wa=class{constructor(t,e,n,r={app:n}){this.buttons=new Map;this.isReadOnly=!1;this.hideEditingButtonsWhenReadOnly=!1;this.separators=[];this.writingModeButton=null;this.horizontalRuleButton=null;this.readingModeButton=null;this.statusElement=null;this.rubyToggleButton=null;this.auxiliaryToggleButton=null;this.plainEditToggleButton=null;this.fileSwitchButton=null;this.container=t,this.editor=e,this.app=n,this.options=r,this.createToolbar(),this.setupUpdateListener()}createToolbar(){var r,o;if(this.container.empty(),this.container.addClass("contenteditable-toolbar"),this.separators=[],ot.Platform.isMobile||ot.Platform.isMobileApp){if(this.container.addClass("tiptap-toolbar-mobile"),this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: nowrap;
				flex: 1 1 auto;
				min-width: 0;
				width: 100%;
				max-width: 100%;
				overflow-x: auto;
				overflow-y: hidden;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				touch-action: pan-x;
				overscroll-behavior-x: contain;
			`,!document.getElementById("tiptap-toolbar-mobile-scrollbar-style")){let s=document.createElement("style");s.id="tiptap-toolbar-mobile-scrollbar-style",s.textContent=`
					.tiptap-toolbar-mobile::-webkit-scrollbar {
						display: none;
					}
					.tiptap-toolbar-mobile .contenteditable-toolbar-button,
					.tiptap-toolbar-mobile .contenteditable-toolbar-separator {
						flex: 0 0 auto;
					}
				`,document.head.appendChild(s)}}else this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: wrap;
				flex: 1 1 auto;
				min-width: 0;
			`;this.options.onToggleWritingMode&&this.options.getWritingMode&&(this.writingModeButton=this.createButton("arrow-down-up","\u66F8\u5B57\u65B9\u5411\u5207\u308A\u66FF\u3048",()=>{var s,a;(a=(s=this.options).onToggleWritingMode)==null||a.call(s),this.updateWritingModeButton(),this.updateHorizontalRuleIcon()}),this.updateWritingModeButton(),this.createSeparator()),this.options.onOpenFileSwitcher&&(this.fileSwitchButton=this.createButton("folder-open","\u30D5\u30A1\u30A4\u30EB\u5207\u66FF",()=>{var s,a;return(a=(s=this.options).onOpenFileSwitcher)==null?void 0:a.call(s)}),this.createSeparator()),this.createButton("undo","\u5143\u306B\u623B\u3059",()=>this.safeUndo()),this.createButton("redo","\u3084\u308A\u76F4\u3059",()=>this.safeRedo()),this.createSeparator(),this.createButton("bold","\u592A\u5B57",()=>this.runInlineCommand({type:"bold"},()=>this.editor.chain().focus().toggleBold().run())),this.createButton("italic","\u30A4\u30BF\u30EA\u30C3\u30AF",()=>this.runInlineCommand({type:"italic"},()=>this.editor.chain().focus().toggleItalic().run())),this.createButton("strikethrough","\u53D6\u308A\u6D88\u3057\u7DDA",()=>this.runInlineCommand({type:"strike"},()=>this.editor.chain().focus().toggleStrike().run())),this.createButton("underline","\u4E0B\u7DDA",()=>this.runInlineCommand({type:"underline"},()=>this.editor.chain().focus().toggleUnderline().run())),this.createButton("highlighter","\u30CF\u30A4\u30E9\u30A4\u30C8",()=>this.runInlineCommand({type:"highlight"},()=>this.editor.chain().focus().toggleMark("obsidianHighlight").run())),this.createSeparator(),this.createHeadingMenuButton(),this.createSeparator(),this.createButton("list","\u7B87\u6761\u66F8\u304D\u30EA\u30B9\u30C8",()=>this.editor.chain().focus().toggleBulletList().run()),this.createButton("list-ordered","\u756A\u53F7\u4ED8\u304D\u30EA\u30B9\u30C8",()=>this.editor.chain().focus().toggleOrderedList().run()),this.createButton("quote","\u5F15\u7528",()=>this.toggleBlockquoteWithTrailingParagraph()),this.createButton("code-2","\u30B3\u30FC\u30C9\u30D6\u30ED\u30C3\u30AF",()=>this.editor.chain().focus().toggleCodeBlock().run()),this.createSeparator(),this.createButton("link","\u30EA\u30F3\u30AF\u633F\u5165",()=>this.insertLink()),this.createButton("gem","\u30EB\u30D3\u633F\u5165",()=>this.insertRuby());let n=(((o=(r=this.options).getWritingMode)==null?void 0:o.call(r))||"horizontal-tb")==="vertical-rl"?"separator-vertical":"separator-horizontal";this.horizontalRuleButton=this.createButton(n,"\u533A\u5207\u308A\u7DDA",()=>this.editor.chain().focus().setHorizontalRule().run()),this.createSeparator(),this.createButton("eraser","\u66F8\u5F0F\u30AF\u30EA\u30A2",()=>this.clearFormatting()),this.options.onToggleRuby&&(this.createSeparator(),this.rubyToggleButton=this.createButton("eye","\u30EB\u30D3\u8868\u793A\u306E\u30AA\u30F3/\u30AA\u30D5",()=>{var s,a;(a=(s=this.options).onToggleRuby)==null||a.call(s),this.updateRubyButton()}),this.updateRubyButton()),this.options.onSettings&&(this.createSeparator(),this.createButton("settings","\u8868\u793A\u8A2D\u5B9A",()=>{var s,a;(a=(s=this.options).onSettings)==null||a.call(s)})),this.options.onFindReplace&&(this.createSeparator(),this.createButton("search","\u691C\u7D22\u30FB\u7F6E\u63DB",()=>{var s,a;(a=(s=this.options).onFindReplace)==null||a.call(s,!0)})),this.options.onToggleOutline&&(this.createSeparator(),this.createButton("list-tree","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",()=>{var s,a;(a=(s=this.options).onToggleOutline)==null||a.call(s)})),this.options.onToggleReadingMode&&(this.createSeparator(),this.readingModeButton=this.createButton("book","\u66F8\u7C4D\u30E2\u30FC\u30C9\uFF08\u30DA\u30FC\u30B8\u30CD\u30FC\u30B7\u30E7\u30F3\uFF09",()=>{var s,a;(a=(s=this.options).onToggleReadingMode)==null||a.call(s),this.updateReadingModeButton()}),this.updateReadingModeButton()),this.options.onToggleAuxiliary&&(this.createSeparator(),this.auxiliaryToggleButton=this.createButton("keyboard","\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB",()=>{var s,a;return(a=(s=this.options).onToggleAuxiliary)==null?void 0:a.call(s)}),this.updateAuxiliaryButton()),this.options.onTogglePlainEdit&&(this.createSeparator(),this.plainEditToggleButton=this.createButton("file-text","\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6",()=>{var s,a;return(a=(s=this.options).onTogglePlainEdit)==null?void 0:a.call(s)}),this.updatePlainEditButton()),this.createSeparator(),this.statusElement=this.container.createDiv("contenteditable-toolbar-status"),this.statusElement.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			margin-left: 8px;
			font-size: 12px;
			color: var(--text-muted);
		`,this.updateButtonStates()}createButton(t,e,n){let r=this.container.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":e}});return(0,ot.setIcon)(r,t),r.addEventListener("click",o=>{o.preventDefault(),n(),this.updateButtonStates()}),this.buttons.set(t,r),r}createHeadingMenuButton(){let t=this.container.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":"\u898B\u51FA\u3057"}});(0,ot.setIcon)(t,"heading");let e={1:"heading-1",2:"heading-2",3:"heading-3",4:"heading-4",5:"heading-5",6:"heading-6"};t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();let r=new ot.Menu,o=0;for(let a=1;a<=6;a++)if(this.editor.isActive("heading",{level:a})){o=a;break}for(let a=1;a<=6;a++){let l=a;r.addItem(c=>{c.setTitle(` \u898B\u51FA\u3057${l}`).setIcon(e[l]).onClick(()=>{Hn(this.editor,l),this.updateButtonStates()}),o===l&&c.setChecked(!0)})}r.addItem(a=>{a.setTitle("\u898B\u51FA\u3057\u89E3\u9664").setIcon("text").onClick(()=>{this.editor.chain().focus().setParagraph().run(),this.updateButtonStates()}),o===0&&a.setChecked(!0)});let s=t.getBoundingClientRect();r.showAtPosition({x:s.left,y:s.bottom})}),this.buttons.set("heading",t)}createSeparator(){let t=this.container.createEl("div",{cls:"contenteditable-toolbar-separator"});t.style.cssText=`
			width: 1px;
			height: 24px;
			background-color: var(--background-modifier-border);
			margin: 0 4px;
		`,this.separators.push(t)}insertLink(){var r,o,s,a,l;if((o=(r=this.options).getPlainEditEnabled)!=null&&o.call(r)){let c=(l=(a=(s=this.options).getPlainEditSelectionText)==null?void 0:a.call(s))!=null?l:"";new Yt(this.app,c,u=>{var h,f;if(u.cancelled||!u.url)return;let d=u.text&&u.text.trim().length>0?u.text:c||u.url;(f=(h=this.options).onPlainEditCommand)==null||f.call(h,{type:"link",url:u.url,text:d})}).open();return}let{from:t,to:e}=this.editor.state.selection,n=this.editor.state.doc.textBetween(t,e," ");new Yt(this.app,n,c=>{if(c.cancelled||!c.url)return;let u=c.text&&c.text.trim().length>0?c.text:n||c.url;this.editor.chain().focus().extendMarkRange("link").setLink({href:c.url}).insertContent(u).run(),this.updateButtonStates()}).open()}insertRuby(){var d,h,f,p,m;if((h=(d=this.options).getPlainEditEnabled)!=null&&h.call(d)){let g=(m=(p=(f=this.options).getPlainEditSelectionText)==null?void 0:p.call(f))!=null?m:"";if(!g||g.trim()==="")return;new Xt(this.app,g,b=>{var v,y,E;b.cancelled||(E=(y=this.options).onPlainEditCommand)==null||E.call(y,{type:"ruby",text:g,ruby:(v=b.ruby)!=null?v:"",isDot:b.isDot})}).open();return}let{from:t,to:e}=this.editor.state.selection,n=this.editor.state.doc.textBetween(t,e,"");if(!n||n.trim()==="")return;let r=t,o=e,s=!1,a="",l=this.editor.state.doc.resolve(t),c=this.editor.state.doc.resolve(e);for(let g=l.depth;g>0;g--){let b=l.node(g);if(b.type.name==="aozoraRuby"){let v=l.before(g);r=Math.min(r,v),o=Math.max(o,v+b.nodeSize),a=b.textContent,s=!0;break}}for(let g=c.depth;g>0;g--){let b=c.node(g);if(b.type.name==="aozoraRuby"){let v=c.before(g);r=Math.min(r,v),o=Math.max(o,v+b.nodeSize),a=b.textContent,s=!0;break}}let u=s&&a===n?a:n;new Xt(this.app,u,g=>{var v,y,E;if(g.cancelled)return;let b=(E=(y=(v=this.options).getRubyEnabled)==null?void 0:y.call(v))!=null?E:!0;if(!g.ruby||g.ruby.trim()===""){s&&this.editor.chain().focus().deleteRange({from:r,to:o}).insertContent(n).run();return}if(!b){if(this.editor.chain().focus().deleteRange({from:r,to:o}).run(),g.isDot){let x=Array.from(u).map(S=>`\uFF5C${S}\u300A\u30FB\u300B`).join("");this.editor.chain().focus().insertContent(x).run()}else{let x=`\uFF5C${u}\u300A${g.ruby}\u300B`;this.editor.chain().focus().insertContent(x).run()}this.updateButtonStates();return}this.editor.chain().focus().deleteRange({from:r,to:o}).run(),g.isDot?Array.from(u).forEach(x=>{this.editor.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:"\u30FB",hasDelimiter:!0},content:[{type:"text",text:x}]}).run()}):this.editor.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:g.ruby,hasDelimiter:!0},content:[{type:"text",text:u}]}).run(),this.updateButtonStates()}).open()}clearFormatting(){if(this.runInlineCommand({type:"clear"},()=>{})){this.updateButtonStates();return}this.editor.chain().focus().unsetAllMarks().run(),this.updateButtonStates()}runInlineCommand(t,e){var n,r,o,s,a;return(r=(n=this.options).getPlainEditEnabled)!=null&&r.call(n)&&((a=(s=(o=this.options).onPlainEditCommand)==null?void 0:s.call(o,t))!=null?a:!1)?!0:(e(),!1)}setupUpdateListener(){this.editor.on("selectionUpdate",()=>{this.updateButtonStates()}),this.editor.on("transaction",()=>{this.updateButtonStates()})}updateButtonStates(){if(this.isReadOnly){this.updateReadingModeButton();return}this.updateButtonState("bold",this.editor.isActive("bold")),this.updateButtonState("italic",this.editor.isActive("italic")),this.updateButtonState("strikethrough",this.editor.isActive("strike")),this.updateButtonState("underline",this.editor.isActive("underline")),this.updateButtonState("highlighter",this.editor.isActive("obsidianHighlight")),this.updateButtonState("list",this.editor.isActive("bulletList")),this.updateButtonState("list-ordered",this.editor.isActive("orderedList")),this.updateButtonState("quote",this.editor.isActive("blockquote")),this.updateButtonState("code-2",this.editor.isActive("codeBlock"));let t=!1;for(let r=1;r<=6;r++)if(this.editor.isActive("heading",{level:r})){t=!0;break}this.updateButtonState("heading",t);let e=this.buttons.get("undo");e&&(e.disabled=!this.editor.can().undo(),e.style.opacity=e.disabled?"0.5":"1");let n=this.buttons.get("redo");n&&(n.disabled=!this.editor.can().redo(),n.style.opacity=n.disabled?"0.5":"1")}updateReadingModeButton(){var n,r,o;if(!this.readingModeButton)return;let t=(o=(r=(n=this.options).getReadingModeEnabled)==null?void 0:r.call(n))!=null?o:!1;this.setButtonActive(this.readingModeButton,t);let e=t?"book-open":"book";(0,ot.setIcon)(this.readingModeButton,e)}safeUndo(){this.editor.chain().focus().undo().run()&&this.reapplyCurrentWritingMode()}safeRedo(){this.editor.chain().focus().redo().run()&&this.reapplyCurrentWritingMode()}reapplyCurrentWritingMode(){var e,n,r;let t=(r=(n=(e=this.options).getWritingMode)==null?void 0:n.call(e))!=null?r:"vertical-rl";try{this.editor.commands.setWritingMode(t)}catch(o){}}updateSyncStatus(t){if(!this.statusElement||(this.statusElement.empty(),this.isReadOnly))return;if(this.statusElement.style.cssText=`
			display: flex;
			align-items: center;
			gap: 4px;
			margin-left: auto;
		`,t.mode){let s=t.mode==="manual",a=Boolean(this.options.onToggleSyncMode)&&!this.isReadOnly,l=this.statusElement.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":s?"\u624B\u52D5\u540C\u671F\u30E2\u30FC\u30C9\uFF08\u30AF\u30EA\u30C3\u30AF\u3067\u81EA\u52D5\u540C\u671F\u306B\u5207\u66FF\uFF09":"\u81EA\u52D5\u540C\u671F\u30E2\u30FC\u30C9\uFF08\u30AF\u30EA\u30C3\u30AF\u3067\u624B\u52D5\u540C\u671F\u306B\u5207\u66FF\uFF09"}});(0,ot.setIcon)(l,s?"refresh-cw-off":"refresh-ccw"),l.style.cssText=`
				opacity: ${a?.85:.7};
				cursor: ${a?"pointer":"default"};
			`,l.disabled=!a,a&&l.addEventListener("click",u=>{var d,h;u.preventDefault(),u.stopPropagation(),(h=(d=this.options).onToggleSyncMode)==null||h.call(d)})}let e=this.statusElement.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button"}),n="check-circle",r="\u4FDD\u5B58\u6E08\u307F",o="var(--text-success)";if(t.saving?(n="loader",r="\u4FDD\u5B58\u4E2D...",o="var(--text-accent)",e.addClass("is-loading")):t.lastSyncResult==="error"?(n="x-circle",r=t.lastSyncMessage||"\u540C\u671F\u30A8\u30E9\u30FC",o="var(--text-error)"):t.dirty&&(n="circle-dot",r="\u672A\u4FDD\u5B58",o="var(--text-warning)"),e.setAttribute("aria-label",r),(0,ot.setIcon)(e,n),e.style.cssText=`
			color: ${o};
			opacity: 1;
			cursor: default;
		`,e.disabled=!0,!this.isReadOnly&&t.mode==="manual"&&this.options.onManualSync){let s=ot.Platform.isMacOS?"\u2318":"Ctrl",a=this.statusElement.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":`\u4FDD\u5B58 (${s}+Shift+S)`}});(0,ot.setIcon)(a,"save"),t.dirty?a.style.cssText=`
					color: var(--text-accent);
				`:a.style.cssText=`
					opacity: 0.5;
				`,a.addEventListener("click",l=>{var c,u;l.preventDefault(),l.stopPropagation(),(u=(c=this.options).onManualSync)==null||u.call(c)})}}updateButtonState(t,e){let n=this.buttons.get(t);n&&this.setButtonActive(n,e)}setButtonActive(t,e){e?(t.addClass("is-active"),t.style.backgroundColor="var(--interactive-accent)",t.style.color="var(--text-on-accent)"):(t.removeClass("is-active"),t.style.backgroundColor="",t.style.color="")}updateHorizontalRuleIcon(){if(!this.horizontalRuleButton||!this.options.getWritingMode)return;let e=this.options.getWritingMode()==="vertical-rl"?"separator-vertical":"separator-horizontal";this.horizontalRuleButton.empty(),(0,ot.setIcon)(this.horizontalRuleButton,e)}updateWritingModeButton(){if(!this.writingModeButton||!this.options.getWritingMode)return;let e=this.options.getWritingMode()==="vertical-rl";this.writingModeButton.empty();let n=this.writingModeButton.createSpan();(0,ot.setIcon)(n,e?"arrow-down-up":"arrow-left-right"),this.writingModeButton.setAttribute("aria-label",e?"\u6A2A\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048":"\u7E26\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048")}refreshRubyToggle(){this.updateRubyButton()}updateAuxiliaryButton(){this.updateAuxiliaryButtonInternal()}updateAuxiliaryButtonInternal(){var e,n,r;if(!this.auxiliaryToggleButton)return;let t=(r=(n=(e=this.options).getAuxiliaryEnabled)==null?void 0:n.call(e))!=null?r:!1;this.setButtonActive(this.auxiliaryToggleButton,t),this.auxiliaryToggleButton.setAttribute("aria-label",t?"\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u3092\u30AA\u30D5\u306B\u3059\u308B":"\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u3092\u30AA\u30F3\u306B\u3059\u308B")}updatePlainEditButton(){this.updatePlainEditButtonInternal()}updatePlainEditButtonInternal(){var n,r,o;if(!this.plainEditToggleButton)return;let t=(o=(r=(n=this.options).getPlainEditEnabled)==null?void 0:r.call(n))!=null?o:!1,e=t?"file-code":"file-text";this.plainEditToggleButton.empty(),(0,ot.setIcon)(this.plainEditToggleButton,e),this.setButtonActive(this.plainEditToggleButton,t),this.plainEditToggleButton.setAttribute("aria-label",t?"\u88C5\u98FE\u8868\u793A\u306B\u623B\u3059":"\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u30E2\u30FC\u30C9")}updateRubyButton(){var n,r,o;if(!this.rubyToggleButton)return;let t=(o=(r=(n=this.options).getRubyEnabled)==null?void 0:r.call(n))!=null?o:!0,e=t?"eye":"eye-off";this.rubyToggleButton.empty(),(0,ot.setIcon)(this.rubyToggleButton,e),this.rubyToggleButton.setAttribute("aria-label",t?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3059\u308B":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3059\u308B"),this.setButtonActive(this.rubyToggleButton,t)}toggleBlockquoteWithTrailingParagraph(){let t=this.editor.isActive("blockquote"),e=this.editor.chain().focus().toggleBlockquote().run();if(this.updateButtonStates(),!e)return;let n=this.editor.isActive("blockquote");t||!n||this.insertBlankParagraphAfterCurrentBlockquote()}insertBlankParagraphAfterCurrentBlockquote(){let t=this.editor.state.schema.nodes.paragraph;if(!t)return;let{state:e}=this.editor,{$from:n,$to:r}=e.selection;if(!n.blockRange(r,p=>p.type.name==="blockquote"))return;let s=-1;for(let p=n.depth;p>0;p--)if(n.node(p).type.name==="blockquote"){s=p;break}if(s===-1)return;let a=n.after(s),l=e.doc.nodeAt(a);if(l&&l.type.name==="paragraph"&&l.content.size===0){let p=e.tr.setSelection(G.near(e.doc.resolve(a+1)));this.editor.view.dispatch(p);return}let c=e.doc.resolve(a),u=c.parent,d=c.index();if(!u.canReplaceWith(d,d,t))return;let h=t.createAndFill();if(!h)return;let f=e.tr.insert(a,h);f=f.setSelection(G.near(f.doc.resolve(a+1))),this.editor.view.dispatch(f)}destroy(){this.container.empty(),this.buttons.clear()}setReadOnly(t,e={}){this.isReadOnly=t,this.hideEditingButtonsWhenReadOnly=!!e.hideEditingButtons&&t,this.applyReadOnlyButtonStates(),this.updateButtonStates(),this.statusElement&&(this.statusElement.style.opacity=t?"0.6":"1")}applyReadOnlyButtonStates(){let t=new Set(["arrow-down-up","folder-open","book","eye","settings","search","list-tree"]);for(let[e,n]of this.buttons.entries()){let r=!this.isReadOnly||t.has(e);n.disabled=!r,n.style.opacity=n.disabled?"0.35":"1",this.hideEditingButtonsWhenReadOnly&&!r?n.style.display="none":n.style.display=""}this.updateSeparatorVisibility(),this.updateReadingModeButton(),this.statusElement&&(this.statusElement.style.opacity=this.isReadOnly?"0.6":"1")}updateSeparatorVisibility(){let t=Array.from(this.container.children),e=u=>u.classList.contains("contenteditable-toolbar-separator"),n=u=>u.style.display!=="none",r=u=>{for(let d=u-1;d>=0;d--){let h=t[d];if(n(h)&&!e(h))return h}return null},o=u=>{for(let d=u+1;d<t.length;d++){let h=t[d];if(n(h)&&!e(h))return h}return null};for(let u=0;u<t.length;u++){let d=t[u];if(!e(d))continue;if(!this.hideEditingButtonsWhenReadOnly){d.style.display="";continue}let h=!!r(u),f=!!o(u);d.style.display=h&&f?"":"none"}let s=t.filter(n),a=!1;for(let u=0;u<s.length;u++){let d=s[u];if(!e(d)){a=!0;continue}if(!a){d.style.display="none";continue}let h=null;for(let f=u+1;f<s.length;f++){let p=s[f];if(!e(p)){h=p;break}}if(!h){d.style.display="none";continue}a=!1}let l=t.filter(n),c=!1;for(let u of l){if(!e(u)){c=!1;continue}if(c){u.style.display="none";continue}c=!0}}updateEditor(t){this.editor=t,this.setupUpdateListener(),this.updateButtonStates()}};var Ao=require("obsidian");var Ua=class{constructor(t,e){this.editor=t,this.options=e,this.app=e.app,this.actions=this.getDefaultActions()}isReadOnly(){var t,e,n;return(n=(e=(t=this.options).isReadOnly)==null?void 0:e.call(t))!=null?n:!1}getDefaultActions(){let t=e=>{var a,l,c,u;let n=(l=(a=e.view)==null?void 0:a.dom)==null?void 0:l.closest(".tategaki-wysiwyg-editor"),r=n==null?void 0:n.getAttribute("data-writing-mode"),o=(u=(c=e.storage)==null?void 0:c.verticalWriting)==null?void 0:u.currentMode,s=r==="vertical-rl"||r==="horizontal-tb"?r:o==="vertical-rl"||o==="horizontal-tb"?o:"vertical-rl";try{e.commands.setWritingMode(s)}catch(d){}};return[{name:"cut",title:"\u5207\u308A\u53D6\u308A",icon:"scissors",action:()=>{document.execCommand("cut")},isDisabled:e=>e.state.selection.empty},{name:"copy",title:"\u30B3\u30D4\u30FC",icon:"copy",action:()=>{document.execCommand("copy")},isDisabled:e=>e.state.selection.empty},{name:"paste",title:"\u8CBC\u308A\u4ED8\u3051",icon:"clipboard-paste",action:async e=>{try{if(navigator.clipboard&&navigator.clipboard.readText){let n=await navigator.clipboard.readText();n&&e.chain().focus().insertContent(n).run()}else document.execCommand("paste")}catch(n){Ee("Tategaki TipTap: paste failed",n),new Ao.Notice("\u8CBC\u308A\u4ED8\u3051\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30D6\u30E9\u30A6\u30B6\u306E\u6A29\u9650\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",3e3)}}},{name:"selectAll",title:"\u3059\u3079\u3066\u9078\u629E",icon:"select-all",action:e=>{e.chain().focus().selectAll().run()}},{name:"separator1",title:"",icon:"",action:()=>{},separator:!0},{name:"undo",title:"\u5143\u306B\u623B\u3059",icon:"undo",action:e=>{e.chain().focus().undo().run()&&t(e)},isDisabled:e=>!e.can().undo()},{name:"redo",title:"\u3084\u308A\u76F4\u3057",icon:"redo",action:e=>{e.chain().focus().redo().run()&&t(e)},isDisabled:e=>!e.can().redo()},{name:"separator2",title:"",icon:"",action:()=>{},separator:!0},{name:"bold",title:"\u592A\u5B57",icon:"bold",action:e=>this.runInlineCommand({type:"bold"},()=>e.chain().focus().toggleBold().run()),isActive:e=>e.isActive("bold"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"italic",title:"\u659C\u4F53",icon:"italic",action:e=>this.runInlineCommand({type:"italic"},()=>e.chain().focus().toggleItalic().run()),isActive:e=>e.isActive("italic"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"strike",title:"\u53D6\u308A\u6D88\u3057\u7DDA",icon:"strikethrough",action:e=>this.runInlineCommand({type:"strike"},()=>e.chain().focus().toggleStrike().run()),isActive:e=>e.isActive("strike"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"underline",title:"\u4E0B\u7DDA",icon:"underline",action:e=>this.runInlineCommand({type:"underline"},()=>e.chain().focus().toggleUnderline().run()),isActive:e=>e.isActive("underline"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"highlight",title:"\u30CF\u30A4\u30E9\u30A4\u30C8",icon:"highlighter",action:e=>this.runInlineCommand({type:"highlight"},()=>e.chain().focus().toggleMark("obsidianHighlight").run()),isActive:e=>e.isActive("obsidianHighlight"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"link",title:"\u30EA\u30F3\u30AF\u633F\u5165",icon:"link",action:e=>{this.insertLink(e)},isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"ruby",title:"\u30EB\u30D3\u633F\u5165",icon:"gem",action:e=>{this.insertRuby(e)},isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"clear",title:"\u66F8\u5F0F\u30AF\u30EA\u30A2",icon:"eraser",action:e=>this.runInlineCommand({type:"clear"},()=>e.chain().focus().unsetAllMarks().run()),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"separator3",title:"",icon:"",action:()=>{},separator:!0},{name:"heading1",title:"\u898B\u51FA\u30571",icon:"heading-1",action:e=>Hn(e,1),isActive:e=>e.isActive("heading",{level:1})},{name:"heading2",title:"\u898B\u51FA\u30572",icon:"heading-2",action:e=>Hn(e,2),isActive:e=>e.isActive("heading",{level:2})},{name:"heading3",title:"\u898B\u51FA\u30573",icon:"heading-3",action:e=>Hn(e,3),isActive:e=>e.isActive("heading",{level:3})},{name:"heading4",title:"\u898B\u51FA\u30574",icon:"heading-4",action:e=>Hn(e,4),isActive:e=>e.isActive("heading",{level:4})},{name:"heading5",title:"\u898B\u51FA\u30575",icon:"heading-5",action:e=>Hn(e,5),isActive:e=>e.isActive("heading",{level:5})},{name:"heading6",title:"\u898B\u51FA\u30576",icon:"heading-6",action:e=>Hn(e,6),isActive:e=>e.isActive("heading",{level:6})},{name:"separator4",title:"",icon:"",action:()=>{},separator:!0},{name:"blockquote",title:"\u5F15\u7528",icon:"quote",action:e=>e.chain().focus().toggleBlockquote().run(),isActive:e=>e.isActive("blockquote")},{name:"separator5",title:"",icon:"",action:()=>{},separator:!0},{name:"plainEdit",title:"\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6",icon:"file-text",action:()=>{this.options.onTogglePlainEdit&&this.options.onTogglePlainEdit()},isActive:()=>{var e,n,r;return(r=(n=(e=this.options).getPlainEditEnabled)==null?void 0:n.call(e))!=null?r:!1}},{name:"findReplace",title:"\u691C\u7D22\u30FB\u7F6E\u63DB",icon:"search",action:()=>{this.options.onFindReplace?this.options.onFindReplace(!0):new Ao.Notice("\u691C\u7D22\u30FB\u7F6E\u63DB\u306F\u672A\u5B9F\u88C5\u3067\u3059\u3002",2500)}}]}runInlineCommand(t,e){var n,r,o;this.isPlainEditActive()&&((o=(r=(n=this.options).onPlainEditCommand)==null?void 0:r.call(n,t))!=null&&o)||e()}isPlainEditActive(){var t,e,n;return(n=(e=(t=this.options).getPlainEditEnabled)==null?void 0:e.call(t))!=null?n:!1}hasPlainEditSelection(){var e,n,r;return((r=(n=(e=this.options).getPlainEditSelectionText)==null?void 0:n.call(e))!=null?r:"").length>0}insertLink(t){var o,s,a;if(this.isPlainEditActive()){let l=(a=(s=(o=this.options).getPlainEditSelectionText)==null?void 0:s.call(o))!=null?a:"";new Yt(this.app,l,c=>{var d,h;if(c.cancelled||!c.url)return;let u=c.text&&c.text.trim().length>0?c.text:l||c.url;(h=(d=this.options).onPlainEditCommand)==null||h.call(d,{type:"link",url:c.url,text:u})}).open();return}let{from:e,to:n}=t.state.selection,r=t.state.doc.textBetween(e,n," ");new Yt(this.app,r,l=>{if(l.cancelled||!l.url)return;let c=l.text&&l.text.trim().length>0?l.text:r||l.url;t.chain().focus().extendMarkRange("link").setLink({href:l.url}).insertContent(c).run()}).open()}insertRuby(t){var h,f,p;if(this.isPlainEditActive()){let m=(p=(f=(h=this.options).getPlainEditSelectionText)==null?void 0:f.call(h))!=null?p:"";if(!m||m.trim()==="")return;new Xt(this.app,m,g=>{var b,v,y;g.cancelled||(y=(v=this.options).onPlainEditCommand)==null||y.call(v,{type:"ruby",text:m,ruby:(b=g.ruby)!=null?b:"",isDot:g.isDot})}).open();return}let{from:e,to:n}=t.state.selection,r=t.state.doc.textBetween(e,n," ");if(!r||r.trim()==="")return;let o=e,s=n,a=!1,l="",c=t.state.doc.resolve(e),u=t.state.doc.resolve(n);for(let m=c.depth;m>0;m--){let g=c.node(m);if(g.type.name==="aozoraRuby"){let b=c.before(m);o=Math.min(o,b),s=Math.max(s,b+g.nodeSize),l=g.textContent,a=!0;break}}for(let m=u.depth;m>0;m--){let g=u.node(m);if(g.type.name==="aozoraRuby"){let b=u.before(m);o=Math.min(o,b),s=Math.max(s,b+g.nodeSize),l=g.textContent,a=!0;break}}let d=a&&l===r?l:r;new Xt(this.app,d,m=>{var b,v,y;if(m.cancelled)return;let g=(y=(v=(b=this.options).getRubyEnabled)==null?void 0:v.call(b))!=null?y:!0;if(!m.ruby||m.ruby.trim()===""){a&&t.chain().focus().deleteRange({from:o,to:s}).insertContent(r).run();return}if(!g){if(t.chain().focus().deleteRange({from:o,to:s}).run(),m.isDot){let E=Array.from(d).map(x=>`\uFF5C${x}\u300A\u30FB\u300B`).join("");t.chain().focus().insertContent(E).run()}else{let E=`\uFF5C${d}\u300A${m.ruby}\u300B`;t.chain().focus().insertContent(E).run()}return}t.chain().focus().deleteRange({from:o,to:s}).run(),m.isDot?Array.from(d).forEach(E=>{t.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:"\u30FB",hasDelimiter:!0},content:[{type:"text",text:E}]}).run()}):t.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:m.ruby,hasDelimiter:!0},content:[{type:"text",text:d}]}).run()}).open()}show(t){t.preventDefault(),t.stopPropagation();let e=new Ao.Menu,n=this.isReadOnly(),r=new Set(["cut","paste","undo","redo","bold","italic","strike","underline","highlight","link","ruby","clear","heading1","heading2","heading3","heading4","heading5","heading6","blockquote","plainEdit"]);document.body.addClass("tategaki-context-menu-active");let o=e.hide.bind(e);e.hide=()=>(document.body.removeClass("tategaki-context-menu-active"),o());for(let s of this.actions){if(s.separator){e.addSeparator();continue}let a=n&&r.has(s.name)||(s.isDisabled?s.isDisabled(this.editor):!1),l=s.isActive?s.isActive(this.editor):!1;e.addItem(c=>{c.setTitle(s.title).setIcon(s.icon).setDisabled(a).setChecked(l||!1).onClick(()=>{a||s.action(this.editor)})})}e.showAtMouseEvent(t)}updateEditor(t){this.editor=t}destroy(){}};var Ka=class{constructor(t){this.editor=t}search(t,e){if(!t)return[];let n=this.editor.state.doc,r=[],o=this.normalizeText(t,e.caseSensitive);return this.traverseDoc(n,(s,a)=>{if(!s.isText||!s.text)return;let l=this.findMatches(s.text,o,a,e);r.push(...l)}),r}replace(t,e){try{let n=this.editor.state.tr;return e.length===0?n.delete(t.from,t.to):n.replaceWith(t.from,t.to,this.editor.state.schema.text(e)),this.editor.view.dispatch(n),!0}catch(n){return console.error("Tategaki TipTap: replace error",n),!1}}replaceAll(t,e){if(t.length===0)return 0;try{let n=[...t].sort((s,a)=>a.from-s.from),r=this.editor.state.tr,o=0;for(let s of n)e.length===0?r.delete(s.from,s.to):r.replaceWith(s.from,s.to,this.editor.state.schema.text(e)),o+=1;return this.editor.view.dispatch(r),o}catch(n){return console.error("Tategaki TipTap: replace all error",n),0}}highlightMatches(t,e){let n=this.editor.state.tr;n.setMeta(Fn,{type:"set",results:t.map(r=>({from:r.from,to:r.to})),currentIndex:e}),this.editor.view.dispatch(n)}clearHighlights(){let t=this.editor.state.tr;t.setMeta(Fn,{type:"clear"}),this.editor.view.dispatch(t)}scrollToMatch(t){var e;try{let n=this.editor.view.coordsAtPos(t.from),r=(e=this.editor.view.dom.closest(".tategaki-tiptap-compat-editor-host"))!=null?e:this.editor.view.dom.closest(".tategaki-editor-area");if(!r||!n)return;let o=r.getBoundingClientRect(),s=n.top-o.top+r.scrollTop,a=n.left-o.left+r.scrollLeft;r.scrollTo({top:s-r.clientHeight/2,left:a-r.clientWidth/2,behavior:"smooth"})}catch(n){console.error("Tategaki TipTap: scroll to match error",n)}}updateEditor(t){this.editor=t,this.clearHighlights()}destroy(){this.clearHighlights()}findMatches(t,e,n,r){let o=[];if(!e)return o;let s=this.normalizeText(t,r.caseSensitive),a=0;for(;a<=s.length-e.length;){let l=s.indexOf(e,a);if(l===-1)break;o.push({from:n+l,to:n+l+e.length,text:t.slice(l,l+e.length)}),a=l+e.length}return o}normalizeText(t,e){return e?t:t.toLocaleLowerCase()}traverseDoc(t,e){t.nodesBetween(0,t.content.size,(n,r)=>{e(n,r)})}};var qa=class{constructor(t,e,n){this.isVisible=!1;this.panel=null;this.searchInput=null;this.replaceInput=null;this.caseSensitiveCheckbox=null;this.matchCountElement=null;this.searchOptions={caseSensitive:!1};this.currentResults=[];this.currentIndex=-1;this.searchDebounceTimer=null;this.searchDebounceDelay=300;this.isReadOnly=!1;this.container=t,this.editor=e,this.onUpdateCallback=n,this.searchEngine=new Ka(e)}show(t=!1){if(t&&this.isReadOnly&&(t=!1),this.isVisible){this.focus();return}this.createPanel(t),this.isVisible=!0,this.focus()}hide(){!this.isVisible||!this.panel||(this.clearSearch(),this.panel.remove(),this.panel=null,this.isVisible=!1,this.editor.commands.focus())}toggle(t=!1){this.isVisible?this.hide():this.show(t)}createPanel(t){this.panel=document.createElement("div"),this.panel.className="tategaki-search-replace-panel",this.panel.style.cssText=`
			position: absolute;
			top: 10px;
			right: 10px;
			width: 320px;
			background: var(--background-primary);
			border: 1px solid var(--background-modifier-border);
			border-radius: 6px;
			box-shadow: var(--shadow-s);
			z-index: 1000;
			padding: 12px;
			font-size: 13px;
		`;let e=this.panel.createDiv("search-section");e.style.cssText="margin-bottom: 8px;";let n=e.createDiv();n.style.cssText="display: flex; align-items: center; margin-bottom: 6px;",this.searchInput=n.createEl("input"),this.searchInput.type="text",this.searchInput.placeholder="\u691C\u7D22...",this.searchInput.style.cssText=`
			flex: 1;
			padding: 4px 8px;
			border: 1px solid var(--background-modifier-border);
			border-radius: 3px;
			margin-right: 6px;
			background: var(--background-primary);
			color: var(--text-normal);
		`;let r=n.createDiv();r.style.cssText="display: flex; gap: 2px; margin-right: 6px;";let o=r.createEl("button");o.textContent="\u2191",o.title="\u524D\u3092\u691C\u7D22",o.style.cssText=`
			width: 24px; height: 24px;
			border: 1px solid var(--background-modifier-border);
			background: var(--background-primary);
			border-radius: 3px;
			cursor: pointer;
		`,o.addEventListener("click",()=>this.findPrevious());let s=r.createEl("button");s.textContent="\u2193",s.title="\u6B21\u3092\u691C\u7D22",s.style.cssText=`
			width: 24px; height: 24px;
			border: 1px solid var(--background-modifier-border);
			background: var(--background-primary);
			border-radius: 3px;
			cursor: pointer;
		`,s.addEventListener("click",()=>this.findNext());let a=n.createEl("button");if(a.textContent="\xD7",a.title="\u9589\u3058\u308B",a.style.cssText=`
			width: 24px; height: 24px;
			border: 1px solid var(--background-modifier-border);
			background: var(--background-primary);
			border-radius: 3px;
			cursor: pointer;
		`,a.addEventListener("click",()=>this.hide()),this.matchCountElement=e.createDiv(),this.matchCountElement.style.cssText=`
			font-size: 11px;
			color: var(--text-muted);
			margin-bottom: 6px;
		`,this.matchCountElement.textContent="",t){let u=this.panel.createDiv("replace-section");u.style.cssText="margin-bottom: 8px;";let d=u.createDiv();d.style.cssText="display: flex; align-items: center; margin-bottom: 6px;",this.replaceInput=d.createEl("input"),this.replaceInput.type="text",this.replaceInput.placeholder="\u7F6E\u63DB...",this.replaceInput.style.cssText=`
				flex: 1;
				padding: 4px 8px;
				border: 1px solid var(--background-modifier-border);
				border-radius: 3px;
				margin-right: 6px;
				background: var(--background-primary);
				color: var(--text-normal);
			`;let h=d.createDiv();h.style.cssText="display: flex; gap: 4px;";let f=h.createEl("button");f.textContent="\u7F6E\u63DB",f.style.cssText=`
				padding: 4px 8px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
				border-radius: 3px;
				cursor: pointer;
				font-size: 11px;
			`,f.addEventListener("click",()=>this.replaceOne());let p=h.createEl("button");p.textContent="\u5168\u7F6E\u63DB",p.style.cssText=`
				padding: 4px 8px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
				border-radius: 3px;
				cursor: pointer;
				font-size: 11px;
			`,p.addEventListener("click",()=>this.replaceAll())}let l=this.panel.createDiv("options-section");l.style.cssText="display: flex; gap: 12px; font-size: 11px;";let c=l.createEl("label");c.style.cssText="display: flex; align-items: center; cursor: pointer;",this.caseSensitiveCheckbox=c.createEl("input"),this.caseSensitiveCheckbox.type="checkbox",this.caseSensitiveCheckbox.style.cssText="margin-right: 4px;",c.createSpan().textContent="\u5927\u6587\u5B57\u5C0F\u6587\u5B57\u533A\u5225",this.setupEventListeners(),this.container.appendChild(this.panel)}setupEventListeners(){this.searchInput&&(this.searchInput.addEventListener("input",()=>this.performSearchDebounced()),this.searchInput.addEventListener("keydown",t=>this.handleSearchKeydown(t))),this.replaceInput&&this.replaceInput.addEventListener("keydown",t=>this.handleReplaceKeydown(t)),this.caseSensitiveCheckbox&&this.caseSensitiveCheckbox.addEventListener("change",()=>{this.updateSearchOptions(),this.performSearch()})}handleSearchKeydown(t){switch(t.key){case"Enter":t.preventDefault(),t.shiftKey?this.findPrevious():this.findNext();break;case"Escape":t.preventDefault(),this.hide();break}}handleReplaceKeydown(t){switch(t.key){case"Enter":t.preventDefault(),this.replaceOne();break;case"Escape":t.preventDefault(),this.hide();break}}updateSearchOptions(){var t,e;this.searchOptions={caseSensitive:(e=(t=this.caseSensitiveCheckbox)==null?void 0:t.checked)!=null?e:!1}}performSearchDebounced(){this.searchDebounceTimer!==null&&window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=window.setTimeout(()=>{this.searchDebounceTimer=null,this.performSearch()},this.searchDebounceDelay)}performSearch(){var n;let t=((n=this.searchInput)==null?void 0:n.value)||"";if(!t){this.clearSearch();return}let e={...this.searchOptions};this.currentResults=this.searchEngine.search(t,e),this.currentIndex=this.currentResults.length>0?0:-1,this.updateMatchCount(),this.highlightMatches(),this.currentResults.length>0&&this.scrollToCurrentMatch()}clearSearch(){this.currentResults=[],this.currentIndex=-1,this.searchEngine.clearHighlights(),this.updateMatchCount()}findNext(){this.currentResults.length!==0&&(this.currentIndex=(this.currentIndex+1)%this.currentResults.length,this.updateMatchCount(),this.highlightMatches(),this.scrollToCurrentMatch())}findPrevious(){this.currentResults.length!==0&&(this.currentIndex=this.currentIndex<=0?this.currentResults.length-1:this.currentIndex-1,this.updateMatchCount(),this.highlightMatches(),this.scrollToCurrentMatch())}replaceOne(){var n;if(this.isReadOnly||!this.replaceInput||this.currentIndex===-1)return;let t=this.replaceInput.value;this.searchEngine.replace(this.currentResults[this.currentIndex],t)&&((n=this.onUpdateCallback)==null||n.call(this),this.performSearch())}replaceAll(){var n;if(this.isReadOnly||!this.replaceInput||this.currentResults.length===0)return;let t=this.replaceInput.value;this.searchEngine.replaceAll(this.currentResults,t)>0&&((n=this.onUpdateCallback)==null||n.call(this),this.performSearch())}updateMatchCount(){this.matchCountElement&&(this.currentResults.length===0?this.matchCountElement.textContent="\u30DE\u30C3\u30C1\u306A\u3057":this.matchCountElement.textContent=`${this.currentIndex+1} / ${this.currentResults.length}`)}highlightMatches(){this.searchEngine.highlightMatches(this.currentResults,this.currentIndex)}scrollToCurrentMatch(){if(this.currentIndex===-1)return;let t=this.currentResults[this.currentIndex];t&&this.searchEngine.scrollToMatch(t)}focus(){this.searchInput&&(this.searchInput.focus(),this.searchInput.select())}updateEditor(t){this.editor=t,this.searchEngine.updateEditor(t)}setReadOnly(t){this.isReadOnly=t}destroy(){this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null),this.hide(),this.searchEngine.destroy()}};var Ar="\u2060",lN=Jv(),Ho=new lN({html:!0,breaks:!1,linkify:!1,typographer:!1});function eE(i,t={}){return new bh(i,t)}var bh=class{constructor(t,e){this.isApplying=!1;this.frontmatterBlock=null;this.editor=t,this.getSettings=e.getSettings,this.getContextFilePath=e.getContextFilePath,this.resolveImageSrc=e.resolveImageSrc}setMarkdown(t){var a,l,c,u;let e=Vo(t);this.frontmatterBlock=e.frontmatter||null;let n=((l=(a=this.getSettings)==null?void 0:a.call(this).wysiwyg)==null?void 0:l.enableRuby)!==!1,r=(u=(c=this.getContextFilePath)==null?void 0:c.call(this))!=null?u:null,o=zo(e.body),s=$o(o,{enableRuby:n,contextFilePath:r,resolveImageSrc:this.resolveImageSrc});this.isApplying=!0;try{this.editor.chain().command(({tr:d})=>(d.setMeta("addToHistory",!1),!0)).setContent(s,{emitUpdate:!1}).run(),this.reapplyWritingMode()}finally{this.isApplying=!1}}getMarkdown(){var r;let t=bN(this.editor),e=vN(t),n=cN(e);return`${(r=this.frontmatterBlock)!=null?r:""}${n}`}isApplyingExternalUpdate(){return this.isApplying}reapplyWritingMode(){var o,s,a,l;let t=(s=(o=this.editor.view)==null?void 0:o.dom)==null?void 0:s.closest(".tategaki-wysiwyg-editor"),e=t==null?void 0:t.getAttribute("data-writing-mode"),n=(l=(a=this.editor.storage)==null?void 0:a.verticalWriting)==null?void 0:l.currentMode,r=e==="vertical-rl"||e==="horizontal-tb"?e:n==="vertical-rl"||n==="horizontal-tb"?n:"vertical-rl";this.editor.commands.setWritingMode(r)}};function zo(i){let t=/^([ \t\u3000]*)([-*+]|[0-9]+[.)])\s+/,e=/^([ \t]{0,3}#{1,6}[ \t])([ \t\u3000]+)(.*)$/;return oE(i).map(o=>{if(!o.convert)return o.text;let s=o.text.split(`
`),a=!1;return s.map(c=>{let u=c.trim(),d=t.test(c),h=/^[ \t\u3000]+\S/.test(c);if(d)return a=!0,c;if(a){if(u===""||h)return c;a=!1}let f=e.exec(c);if(f){let p=f[2].split("").map(m=>m==="\u3000"?"&#12288;":"&nbsp;").join("");return`${f[1]}${p}${f[3]}`}return c.replace(/^([ \u3000]+)/,p=>p.split("").map(g=>g==="\u3000"?"&#12288;":"&nbsp;").join(""))}).join(`
`)}).join("")}function cN(i){let t=i;return t=t.replace(/&#12288;/g,"\u3000"),t=t.replace(/&nbsp;/g," "),t=t.replace(/\u00A0/g," "),t=t.replace(/\u3000/g,"\u3000"),t}function Vo(i){let t=i.match(/^(?:\uFEFF)?---\s*\n[\s\S]*?\n---\s*\n/);if(!t)return{frontmatter:"",body:i};let e=t[0];return{frontmatter:e,body:i.slice(e.length)}}function $o(i,t){var o,s;let e=(t==null?void 0:t.enableRuby)!==!1,n=uN(i,e,{contextFilePath:(o=t==null?void 0:t.contextFilePath)!=null?o:null,resolveImageSrc:t==null?void 0:t.resolveImageSrc}),r=dN(n,e,{contextFilePath:(s=t==null?void 0:t.contextFilePath)!=null?s:null,resolveImageSrc:t==null?void 0:t.resolveImageSrc});return iE(r)}function uN(i,t,e){return oE(i).map(r=>r.convert?EN(r.text,o=>{let s=pN(o,e);return tE(s,t)}):r.text).join("")}function dN(i,t,e){let n=[],r=i.split(`
`);for(let l=0;l<r.length;l++){let c=r[l],u=c.trim();if(!u){n.push(`<p>${Ar}</p>`);continue}let d=u.match(/^(`{3,}|~{3,})/);if(d){let f=d[1][0],p=d[1].length,m=u.slice(p).trim(),g=m.length>0?m.split(/\s+/)[0]:"",b=[c],v=l+1,y=!1;for(;v<r.length;){let w=r[v];b.push(w);let M=w.trim().match(/^(`{3,}|~{3,})\s*$/);if(M&&M[1][0]===f&&M[1].length>=p){y=!0;break}v++}if(!y){n.push(Ho.render(c));continue}let x=b.slice(1,-1).join(`
`),S=g?` class="language-${Pt(g)}"`:"";n.push(`<pre><code${S}>${Pt(x)}</code></pre>`),l=v;continue}if(/^(\s*)[-*+]\s+/.test(c)||/^(\s*)\d+[.)]\s+/.test(c)){let f=[c],p=l+1;for(;p<r.length;){let m=r[p];if(!m.trim()){if(p+1<r.length){let b=r[p+1];if(!(/^(\s*)[-*+]\s+/.test(b)||/^(\s*)\d+[.)]\s+/.test(b)))break}f.push(m),p++;continue}if(/^(\s*)[-*+]\s+/.test(m)||/^(\s*)\d+[.)]\s+/.test(m)||/^\s+\S/.test(m)){f.push(m),p++;continue}break}n.push(Ho.render(f.join(`
`))),l=p-1;continue}if(u.startsWith(">")){let f=[c],p=l+1;for(;p<r.length;){let m=r[p];if(m.trim().startsWith(">")){f.push(m),p++;continue}break}n.push(Ho.render(f.join(`
`))),l=p-1;continue}n.push(Ho.render(c))}let o=n.join(`
`),s=yh(o),a=hN(s,e);return t?a:qn(a,{addDelimiter:!1})}function hN(i,t){var r;if(typeof document=="undefined"||!t.resolveImageSrc)return i;let e=document.implementation.createHTMLDocument("");e.body.innerHTML=i;let n=Array.from(e.body.querySelectorAll("img"));for(let o of n){if(o.getAttribute("data-tategaki-source"))continue;let a=(r=o.getAttribute("src"))!=null?r:"";if(!a)continue;o.setAttribute("data-tategaki-source","markdown"),o.setAttribute("data-tategaki-original-src",a);let l=t.resolveImageSrc(a,t.contextFilePath);l&&l!==a&&o.setAttribute("src",l)}return e.body.innerHTML}function pN(i,t){let e=/!\[\[([^\]]+)\]\]/g;return i.replace(e,(n,r)=>{var f;let o=String(r).split("|").map(p=>p.trim()).filter(Boolean);if(o.length===0)return n;let s=(f=o[0])!=null?f:"";if(!fN(s))return n;let a=null,l=null,c="";for(let p of o.slice(1)){let m=p.match(/^(\d+)(?:\s*x\s*(\d+))?$/i);if(m){a=Number(m[1]),l=m[2]?Number(m[2]):null;continue}c||(c=p)}let d=(t.resolveImageSrc?t.resolveImageSrc(s,t.contextFilePath):null)||s,h=[`src="${Pt(d)}"`,'data-tategaki-source="obsidian"',`data-tategaki-obsidian-src="${Pt(s)}"`];return c&&h.push(`alt="${Pt(c)}"`),a!=null&&Number.isFinite(a)&&h.push(`data-tategaki-width="${Pt(String(a))}"`),l!=null&&Number.isFinite(l)&&h.push(`data-tategaki-height="${Pt(String(l))}"`),`<img ${h.join(" ")} />`})}function fN(i){var r,o;let t=(o=(r=i.split("#")[0])==null?void 0:r.split("?")[0])!=null?o:i,e=t.lastIndexOf(".");if(e<0)return!1;let n=t.slice(e+1).toLowerCase();return n==="png"||n==="jpg"||n==="jpeg"||n==="gif"||n==="webp"||n==="svg"||n==="bmp"||n==="avif"}function tE(i,t){let e=i;return t?(e=mN(e),e):(e=rE(e),e)}function nE(i,t={}){let e=t.enableRuby!==!1,n=tE(i,e);return iE(Ho.renderInline(n))}function mN(i){let t=jt();t.lastIndex=0;let e=i.replace(t,(n,...r)=>{var u,d,h;let o=r[r.length-1],s=(d=(u=o==null?void 0:o.body2)!=null?u:o==null?void 0:o.body1)!=null?d:"",a=(h=o==null?void 0:o.ruby)!=null?h:"";return!s||!a?n:`<ruby data-aozora-ruby="1" data-aozora-delimiter="${/^[|\uFF5C]/.test(n)?"1":"0"}"><span data-aozora-base="1">${Pt(s)}</span><rt>${Pt(a)}</rt></ruby>`});return e=rE(e),e}function iE(i){let t=yh(i);if(!(typeof DOMParser!="undefined"&&typeof document!="undefined"))return gN(t);let r=new DOMParser().parseFromString(t,"text/html"),o=new Set(["script","iframe","object","embed","svg","math","link","meta","style"]),s=(u,d,h)=>{let f=u.trim();if(!f||f.startsWith("#")||/^[./]/.test(f))return!0;let p=f.toLowerCase();return p.startsWith("javascript:")||p.startsWith("vbscript:")?!1:p.startsWith("data:")?d==="src"&&h==="img"&&p.startsWith("data:image/"):(p.startsWith("http:")||p.startsWith("https:")||p.startsWith("app:")||p.startsWith("obsidian:")||p.startsWith("file:"),!0)},a=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT),l=[],c=a.nextNode();for(;c;){let u=c,d=u.tagName.toLowerCase();if(o.has(d)){l.push(u),c=a.nextNode();continue}for(let h of Array.from(u.attributes)){let f=h.name.toLowerCase();if(f.startsWith("on")){u.removeAttribute(h.name);continue}(f==="href"||f==="src"||f==="xlink:href")&&(s(h.value,f,d)||u.removeAttribute(h.name))}c=a.nextNode()}for(let u of l)u.remove();return r.body.innerHTML}function gN(i){return yh(i)}function yh(i){let t=i;return t=t.replace(/<\s*(script|svg|math|iframe|object|embed|link|meta|style)[^>]*>[\s\S]*?<\s*\/\s*\1\s*>/gi,""),t=t.replace(/<\s*(script|svg|math|iframe|object|embed|link|meta|style)[^>]*\/\s*>/gi,""),t=t.replace(/\son\w+\s*=\s*(['"]).*?\1/gi,""),t=t.replace(/\son\w+\s*=\s*[^>\s]+/gi,""),t=t.replace(/\s(href|src|xlink:href)\s*=\s*(['"])\s*(?:javascript|vbscript):[\s\S]*?\2/gi,""),t}function rE(i){let t=/==([^=\n]+)==/g;return i.replace(t,(e,n)=>n?`<mark>${Pt(n)}</mark>`:e)}function bN(i){let{doc:t}=i.state,e=[];for(let n=0;n<t.childCount;n++){let r=t.child(n),o=vh(r,0,n,t.childCount);if(o!=null&&(e.push(o),r.type.name==="blockquote"&&n<t.childCount-1)){let s=t.child(n+1);if(s.type.name==="paragraph"){let a=Rr(s);a.trim()===""||a===Ar||e.push(Ar)}}}return e.join(`
`)}function vh(i,t,e,n){var r,o;switch(i.type.name){case"heading":{let s=Rr(i);return`${"#".repeat((r=i.attrs.level)!=null?r:1)} ${s}`}case"paragraph":{let s=Rr(i);return s.trim()===""||s===Ar?Ar:s}case"blockquote":return Qv(i,t).split(`
`).map(a=>`> ${a}`).join(`
`);case"bulletList":return Zv(i,t,"-");case"orderedList":return Zv(i,t,"1.");case"listItem":return Qv(i,t);case"codeBlock":{let s=i.attrs.language?i.attrs.language:"",a=(o=i.textContent)!=null?o:"",l=a.endsWith(`
`)?a.slice(0,-1):a;return["```"+s,l,"```"].join(`
`)}case"horizontalRule":return"---";default:return Rr(i)}}function Zv(i,t,e){var s;let n=[],r=" ".repeat(t),o=" ".repeat(t+e.length+1);for(let a=0;a<i.childCount;a++){let l=i.child(a),c=(s=vh(l,t+e.length+1,a,i.childCount))!=null?s:"",u=`${r}${e} `;n.push(c.split(`
`).map((d,h)=>h===0?u+d:/^\s/.test(d)?d:`${o}${d}`).join(`
`))}return n.join(`
`)}function Qv(i,t){let e=[];for(let n=0;n<i.childCount;n++){let r=i.child(n),o=vh(r,t,n,i.childCount);o!=null&&e.push(o)}return e.join(`
`)}function Rr(i){var e,n,r,o,s,a,l;if(i.isText)return yN(i);if(i.type.name==="tategakiImage"){let c=(e=i.attrs)!=null?e:{},u=c.source==="obsidian"?"obsidian":"markdown",d=String((n=c.alt)!=null?n:""),h=String((r=c.title)!=null?r:""),f=typeof c.width=="number"?c.width:null,p=typeof c.height=="number"?c.height:null;if(u==="obsidian"){let b=String(c.obsidianSrc||c.originalSrc||"");if(!b)return"";let v=[];if(f!=null&&Number.isFinite(f)){let E=p!=null&&Number.isFinite(p)?`${f}x${p}`:String(f);v.push(E)}d&&v.push(d);let y=v.length>0?`|${v.join("|")}`:"";return`![[${b}${y}]]`}let m=String(c.originalSrc||c.src||"");if(!m)return"";let g=h?` "${h.replace(/"/g,'\\"')}"`:"";return`![${d}](${m}${g})`}if(i.type.name==="hardBreak")return"<br>";if(i.type.name==="wbr")return"<wbr>";if(i.type.name==="aozoraRuby"){let c=(o=i.textContent)!=null?o:"",u=(a=(s=i.attrs)==null?void 0:s.ruby)!=null?a:"";return!c||!u?c:`${(l=i.attrs)!=null&&l.hasDelimiter?"\uFF5C":""}${c}\u300A${u}\u300B`}let t="";for(let c=0;c<i.childCount;c++)t+=Rr(i.child(c));return t}function Wo(i){return Rr(i)}function yN(i){var o,s,a,l,c,u,d,h,f;let t=(o=i.text)!=null?o:"";if(!t)return"";let e=(s=i.marks)!=null?s:[],n=e.find(p=>p.type.name==="spanStyle"),r=e.filter(p=>p.type.name!=="spanStyle");for(let p of r)switch(p.type.name){case"bold":t=`**${t}**`;break;case"italic":t=`*${t}*`;break;case"strike":t=`~~${t}~~`;break;case"underline":t=`<u>${t}</u>`;break;case"code":t=`\`${t}\``;break;case"obsidianHighlight":t=`==${t}==`;break;case"link":{let m=((a=p.attrs)==null?void 0:a.href)||"";t=`[${t}](${m})`;break}case"superscript":t=`<sup>${t}</sup>`;break;case"subscript":t=`<sub>${t}</sub>`;break;case"smallText":t=`<small>${t}</small>`;break}if(n){let p=(c=(l=n.attrs)==null?void 0:l.class)!=null?c:"",m=(d=(u=n.attrs)==null?void 0:u.style)!=null?d:"",g=(f=(h=n.attrs)==null?void 0:h.dataAttrs)!=null?f:{},b=[];p&&b.push(`class="${Pt(p)}"`),m&&b.push(`style="${Pt(m)}"`);for(let[y,E]of Object.entries(g))y.startsWith("data-")&&b.push(`${y}="${Pt(E)}"`);t=`<span${b.length>0?` ${b.join(" ")}`:""}>${t}</span>`}return t}function vN(i){let t=new RegExp(`[\\t ]*${xN(Ar)}[\\t ]*`,"g");return i.replace(t,"")}function EN(i,t){let e="",n="",r=null;for(let o=0;o<i.length;){let s=i[o];if(s!=="`"){n+=s,o+=1;continue}let a=o;for(;a<i.length&&i[a]==="`";)a+=1;let l=i.slice(o,a);if(r===null){e+=t(n),n="",e+=l,r=l,o=a;continue}if(l.length===r.length){e+=n,n="",e+=l,r=null,o=a;continue}n+=l,o=a}return r===null?e+=t(n):e+=n,e}function oE(i){let t=i.split(`
`),e=[],n="",r="",o=!1,s="",a=0,l=()=>{n&&(e.push({text:n,convert:!0}),n="")},c=()=>{r&&(e.push({text:r,convert:!1}),r="")};for(let u=0;u<t.length;u++){let d=t[u],h=u===t.length-1?"":`
`;if(!o){let m=d.match(/^\s*(`{3,}|~{3,})/);if(m){l(),o=!0,s=m[1][0],a=m[1].length,r+=d+h;continue}n+=d+h;continue}r+=d+h;let f=d.match(/^\s*(`{3,}|~{3,})\s*$/);if(!f)continue;let p=f[1];p[0]===s&&(p.length<a||(o=!1,s="",a=0,c()))}return r&&c(),n&&l(),e}function xN(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Pt(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var cl=class{constructor(t){this.isActive=!1;this.currentPlainParagraph=null;this.pluginKey=new se("tategakiPlainEdit");this.plugin=null;this.overlayEl=null;this.overlayHost=null;this.overlayActivePos=null;this.overlayBaseRect=null;this.isApplying=!1;this.lastView=null;this.isComposing=!1;this.pendingSelection=null;this.suppressFocusOnNextStart=!1;this.outsidePointerHandler=null;this.options=t}isPlainMode(){return this.isActive}suspendOverlay(){this.overlayEl&&(document.activeElement===this.overlayEl&&this.overlayEl.blur(),this.overlayEl.style.display="none",this.overlayEl.style.pointerEvents="none")}resumeOverlay(){this.overlayEl&&this.isActive&&this.overlayActivePos!=null&&(this.overlayEl.style.display="",this.overlayEl.style.pointerEvents="")}blurOverlay(){this.suspendOverlay()}getSelectionText(){var o,s;if(!this.overlayEl)return"";let t=(o=this.overlayEl.selectionStart)!=null?o:0,e=(s=this.overlayEl.selectionEnd)!=null?s:t,n=Math.min(t,e),r=Math.max(t,e);return this.overlayEl.value.slice(n,r)}applyInlineCommand(t){var e,n;if(!this.isActive||!this.overlayEl)return!1;switch(t.type){case"bold":return this.wrapSelection("**","**"),!0;case"italic":return this.wrapSelection("*","*"),!0;case"strike":return this.wrapSelection("~~","~~"),!0;case"underline":return this.wrapSelection("<u>","</u>"),!0;case"highlight":return this.wrapSelection("==","=="),!0;case"clear":return this.clearSelectionFormatting(),!0;case"link":return this.insertLink((e=t.text)!=null?e:"",t.url),!0;case"ruby":return this.insertRuby((n=t.text)!=null?n:"",t.ruby,t.isDot),!0}return!1}isOverlayTarget(t){return!this.overlayEl||!t||!(t instanceof Node)?!1:t===this.overlayEl||this.overlayEl.contains(t)}activate(){var t,e;this.isActive||(this.isActive=!0,this.registerPlugin(),this.registerOutsidePointerHandler(),(e=(t=this.options).onModeChange)==null||e.call(t,!0))}deactivate(){var t,e;this.isActive&&(this.commitCurrentPlainParagraph(!0),this.unregisterOutsidePointerHandler(),this.unregisterPlugin(),this.isActive=!1,(e=(t=this.options).onModeChange)==null||e.call(t,!1))}toggle(){this.isActive?this.deactivate():this.activate()}registerPlugin(){this.plugin||(this.plugin=this.createPlainEditPlugin(),this.options.editor.registerPlugin(this.plugin))}unregisterPlugin(){this.plugin&&(this.options.editor.unregisterPlugin(this.pluginKey),this.plugin=null,this.destroyOverlay())}createPlainEditPlugin(){return new X({key:this.pluginKey,state:{init:(t,e)=>({pos:this.findParagraphPos(e)}),apply:(t,e,n,r)=>({pos:this.findParagraphPos(r)})},props:{decorations:t=>this.buildDecorations(t)},view:t=>this.createOverlayView(t)})}registerOutsidePointerHandler(){this.outsidePointerHandler||(this.outsidePointerHandler=t=>{!this.isActive||this.isApplying||!this.currentPlainParagraph||t.target instanceof Element&&(this.isFocusInsideView(t.target)||(this.suppressFocusOnNextStart=!0,this.commitCurrentPlainParagraph(!0)))},document.addEventListener("pointerdown",this.outsidePointerHandler,!0))}unregisterOutsidePointerHandler(){this.outsidePointerHandler&&(document.removeEventListener("pointerdown",this.outsidePointerHandler,!0),this.outsidePointerHandler=null)}buildDecorations(t){var s;if(!this.isActive)return null;let e=this.pluginKey.getState(t),n=(s=e==null?void 0:e.pos)!=null?s:null;if(n==null)return null;let r=t.doc.nodeAt(n);if(!r||!this.isPlainTargetNode(r))return null;let o=Me.node(n,n+r.nodeSize,{class:"tategaki-plain-overlay-target","data-plain-mode":"true"});return me.create(t.doc,[o])}createOverlayView(t){return this.ensureOverlayElement(t),this.updateOverlayFromView(t),{update:e=>{this.updateOverlayFromView(e)},destroy:()=>{this.destroyOverlay()}}}ensureOverlayElement(t){var r;let e=(r=t.dom.parentElement)!=null?r:t.dom;this.overlayHost=e,this.overlayEl||(this.overlayEl=document.createElement("textarea"),this.overlayEl.className="tategaki-plain-overlay",this.overlayEl.spellcheck=!1,this.overlayEl.wrap="soft",this.overlayEl.addEventListener("mousedown",o=>{o.button===2&&o.preventDefault(),o.stopPropagation()}),this.overlayEl.addEventListener("compositionstart",()=>{this.isComposing=!0}),this.overlayEl.addEventListener("compositionend",()=>{this.isComposing=!1}),this.overlayEl.addEventListener("keydown",o=>{var s,a;if(o.key==="Escape"){o.preventDefault(),this.deactivate();return}if(o.key.startsWith("Arrow")&&!o.shiftKey&&!o.altKey&&!o.metaKey&&!o.ctrlKey&&!o.isComposing&&!this.isComposing&&o.keyCode!==229&&this.handleArrowKey(o.key)){o.preventDefault();return}if(o.key==="Backspace"&&!o.shiftKey&&!o.isComposing&&!this.isComposing&&o.keyCode!==229&&((s=this.overlayEl)==null?void 0:s.selectionStart)===0&&((a=this.overlayEl)==null?void 0:a.selectionEnd)===0){o.preventDefault(),this.handleBackspaceAtStart();return}if(o.key==="Enter"&&!o.shiftKey&&!o.isComposing&&!this.isComposing&&o.keyCode!==229){o.preventDefault(),this.handleEnterKey();return}o.stopPropagation()}),this.overlayEl.addEventListener("input",()=>{var o,s;this.adjustOverlaySizeToContent(),(s=(o=this.options).onUpdate)==null||s.call(o)})),getComputedStyle(e).position==="static"&&(e.style.position="relative"),this.overlayEl.parentElement||e.appendChild(this.overlayEl)}updateOverlayFromView(t){var r;if(!this.isActive||this.isApplying){this.hideOverlay();return}this.lastView=t;let e=this.pluginKey.getState(t.state),n=(r=e==null?void 0:e.pos)!=null?r:null;if(n==null){this.commitCurrentPlainParagraph(!0),this.hideOverlay();return}this.overlayActivePos!==n?(this.commitCurrentPlainParagraph(!0),this.startPlainParagraph(t,n)):this.currentPlainParagraph&&(this.currentPlainParagraph.pos=n),this.positionOverlay(t,n)}startPlainParagraph(t,e){let n=t.state.doc.nodeAt(e);if(!n||!this.isPlainTargetNode(n)){this.overlayActivePos=null,this.hideOverlay();return}let r=this.serializeInlineHtml(n),o=this.serializePlainMarkdown(n);if(this.currentPlainParagraph={pos:e,originalHtml:r,originalMarkdown:o},this.overlayEl&&(this.overlayEl.value=o,this.overlayEl.style.display="",this.suppressFocusOnNextStart||this.overlayEl.focus({preventScroll:!0}),this.suppressFocusOnNextStart=!1,this.pendingSelection)){let s=this.overlayEl.value.length,a=Math.min(this.pendingSelection.start,s),l=Math.min(this.pendingSelection.end,s);try{this.overlayEl.setSelectionRange(a,l)}catch(c){}this.pendingSelection=null}this.overlayActivePos=e}commitCurrentPlainParagraph(t){var r,o,s,a;if(!this.currentPlainParagraph){this.overlayActivePos=null;return}let e=(o=(r=this.overlayEl)==null?void 0:r.value)!=null?o:"";if(t&&e!==this.currentPlainParagraph.originalMarkdown){let{content:l,attrs:c}=this.normalizePlainMarkdown(e),u=this.renderInlineMarkdownToHtml(l);this.applyInlineHtmlToParagraph(this.currentPlainParagraph.pos,u,!0,c),(a=(s=this.options).onCommit)==null||a.call(s)}this.currentPlainParagraph=null,this.overlayActivePos=null}isFocusInsideView(t){var n,r,o;let e=(o=(r=(n=this.options).getViewRoot)==null?void 0:r.call(n))!=null?o:this.overlayHost;return!e||!t?!1:e.contains(t)}positionOverlay(t,e){if(!this.overlayEl||!this.overlayHost)return;let n=this.getParagraphElementAtPos(t,e);if(!n){this.hideOverlay();return}this.syncOverlayStyleFromParagraph(n);let r=n.getBoundingClientRect(),o=this.overlayHost.getBoundingClientRect(),s=this.adjustRectForVerticalListItem(n,r),a=s.top-o.top+this.overlayHost.scrollTop,l=s.left-o.left+this.overlayHost.scrollLeft;this.overlayEl.style.top=`${a}px`,this.overlayEl.style.left=`${l}px`,this.overlayEl.style.width=`${s.width}px`,this.overlayEl.style.height=`${s.height}px`,this.overlayBaseRect={top:a,left:l,width:s.width,height:s.height},this.adjustOverlaySizeToContent()}adjustRectForVerticalListItem(t,e){if(this.getCurrentWritingMode()!=="vertical-rl")return e;let r=t.closest("li");if(!r)return e;let o=getComputedStyle(t),s=parseFloat(o.fontSize)||16,l=(parseFloat(o.lineHeight)||s*1.5)*1.3;if(!(e.width>l*1.5)){let u=r.getBoundingClientRect();return new DOMRect(e.right-l,u.top,l,u.height)}return e}wrapSelection(t,e){if(!this.overlayEl)return;let n=this.getSelectionRange(),r=n.text,o=`${t}${r}${e}`,s=n.start+t.length,a=s+r.length;if(n.start===n.end){this.replaceSelection(o,s,s);return}this.replaceSelection(o,s,a)}clearSelectionFormatting(){if(!this.overlayEl)return;let t=this.getSelectionRange();if(t.start===t.end)return;let e=this.stripInlineFormatting(t.text),n=t.start,r=n+e.length;this.replaceSelection(e,n,r)}insertLink(t,e){if(!this.overlayEl)return;let n=this.getSelectionRange(),r=t||n.text||e;if(!r||!e)return;let o=`[${r}](${e})`,s=n.start+1,a=s+r.length;this.replaceSelection(o,s,a)}insertRuby(t,e,n){if(!this.overlayEl)return;let r=this.getSelectionRange(),o=t||r.text;if(!o)return;if(!e||e.trim()===""){this.replaceSelection(o);return}let s="";n?s=Array.from(o).map(l=>`\uFF5C${l}\u300A\u30FB\u300B`).join(""):s=`\uFF5C${o}\u300A${e}\u300B`;let a=r.start+s.length;this.replaceSelection(s,a,a)}replaceSelection(t,e,n){var d,h;if(!this.overlayEl)return;let r=this.getSelectionRange(),o=this.overlayEl.value,s=o.slice(0,r.start),a=o.slice(r.end);this.overlayEl.value=`${s}${t}${a}`;let l=s.length,c=e!=null?e:l+t.length,u=n!=null?n:c;try{this.overlayEl.setSelectionRange(c,u)}catch(f){}(h=(d=this.options).onUpdate)==null||h.call(d),this.adjustOverlaySizeToContent()}getSelectionRange(){var o,s;if(!this.overlayEl)return{start:0,end:0,text:""};let t=(o=this.overlayEl.selectionStart)!=null?o:0,e=(s=this.overlayEl.selectionEnd)!=null?s:t,n=Math.min(t,e),r=Math.max(t,e);return{start:n,end:r,text:this.overlayEl.value.slice(n,r)}}stripInlineFormatting(t){let e=t;e=e.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),e=e.replace(/==([^=\n]+)==/g,"$1"),e=e.replace(/\*\*([^*\n]+)\*\*/g,"$1"),e=e.replace(/\*([^*\n]+)\*/g,"$1"),e=e.replace(/~~([^~\n]+)~~/g,"$1"),e=e.replace(/<u>([\s\S]*?)<\/u>/gi,"$1");let n=jt();return e=e.replace(n,(r,...o)=>{var a,l;let s=o[o.length-1];return(l=(a=s==null?void 0:s.body2)!=null?a:s==null?void 0:s.body1)!=null?l:r}),e}adjustOverlaySizeToContent(){if(!this.overlayEl||!this.overlayBaseRect)return;let t=this.overlayBaseRect,e=2,n=Math.max(0,Math.ceil(t.width)),r=Math.max(0,Math.ceil(t.height));this.overlayEl.style.width=`${n}px`,this.overlayEl.style.height=`${r}px`;let o=Math.ceil(this.overlayEl.scrollWidth),s=Math.ceil(this.overlayEl.scrollHeight),a=Math.max(n,o+e),l=Math.max(r,s+e);if(this.overlayEl.style.width=`${a}px`,this.overlayEl.style.height=`${l}px`,(this.overlayEl.style.writingMode||getComputedStyle(this.overlayEl).writingMode)==="vertical-rl"){let u=t.left+t.width-a;this.overlayEl.style.left=`${u}px`}else this.overlayEl.style.left=`${t.left}px`;this.overlayEl.style.top=`${t.top}px`}getParagraphElementAtPos(t,e){var o;let n=t.domAtPos(e+1).node,r=n.nodeType===Node.ELEMENT_NODE?n:n.parentElement;return r?(o=r.closest("p, h1, h2, h3, h4, h5, h6"))!=null?o:r:null}findParagraphPos(t){let{$from:e}=t.selection;for(let n=e.depth;n>0;n--){let r=e.node(n);if(this.isPlainTargetNode(r))return e.before(n)}return null}isPlainTargetNode(t){return t.type.name==="paragraph"||t.type.name==="heading"}serializeInlineHtml(t){let e=Rt.fromSchema(this.options.editor.schema),n=document.createElement("div");return n.appendChild(e.serializeFragment(t.content)),n.innerHTML}renderInlineMarkdownToHtml(t){var n,r,o;let e=(o=(r=(n=this.options).getRubyEnabled)==null?void 0:r.call(n))!=null?o:!0;return nE(t,{enableRuby:e})}serializePlainMarkdown(t){var e;if(t.type.name==="heading"){let n=typeof((e=t.attrs)==null?void 0:e.level)=="number"?t.attrs.level:1,r="#".repeat(Math.min(Math.max(n,1),6)),o=Wo(t);return`${r} ${o}`.trimEnd()}return Wo(t)}normalizePlainMarkdown(t){var s;let e=this.currentPlainParagraph?this.options.editor.state.doc.nodeAt(this.currentPlainParagraph.pos):null;if(!e||e.type.name!=="heading")return{content:t};let n=typeof((s=e.attrs)==null?void 0:s.level)=="number"?e.attrs.level:1,r=this.parseHeadingMarkdown(t,n),o={...e.attrs,level:r.level};return{content:r.content,attrs:o}}parseHeadingMarkdown(t,e){var r;let n=t.match(/^(#{1,6})\s+(.*)$/);return n?{level:Math.min(Math.max(n[1].length,1),6),content:(r=n[2])!=null?r:""}:{level:e,content:t}}handleEnterKey(){var M,L,_,P;let t=this.lastView;if(!t||!this.overlayEl||!this.currentPlainParagraph)return;let e=(M=this.overlayEl.value)!=null?M:"",n=(L=this.overlayEl.selectionStart)!=null?L:e.length,r=(_=this.overlayEl.selectionEnd)!=null?_:n,o=e.slice(0,n),s=e.slice(r),a=this.options.editor.state,l=a.doc.nodeAt(this.currentPlainParagraph.pos);if(!l)return;let c=a.schema.nodes.paragraph;if(!c)return;let u=l.type.name==="heading",d=typeof((P=l.attrs)==null?void 0:P.level)=="number"?l.attrs.level:1,h=nt.fromSchema(a.schema),f=document.createElement("div"),p=u?this.parseHeadingMarkdown(o,d):{level:d,content:o};f.innerHTML=this.renderInlineMarkdownToHtml(p.content);let m=h.parseSlice(f,{preserveWhitespace:!0}),g=u?l.type.createChecked({...l.attrs,level:p.level},m.content):c.createChecked(null,m.content),b=document.createElement("div"),v=u?this.stripHeadingPrefix(s):s;b.innerHTML=this.renderInlineMarkdownToHtml(v);let y=h.parseSlice(b,{preserveWhitespace:!0}),E=c.createChecked(null,y.content),x=this.currentPlainParagraph.pos,S=x+l.nodeSize;this.currentPlainParagraph=null,this.overlayActivePos=null,this.hideOverlay();let w=a.tr.replaceWith(x,S,[g,E]),k=x+g.nodeSize+1;w.setSelection(G.create(w.doc,k)),t.dispatch(w),requestAnimationFrame(()=>{this.isActive&&this.lastView&&this.updateOverlayFromView(this.lastView)})}stripHeadingPrefix(t){var n;let e=t.match(/^(#{1,6})\s+(.*)$/);return e?(n=e[2])!=null?n:"":t}handleBackspaceAtStart(){var x;let t=this.lastView;if(!t||!this.overlayEl||!this.currentPlainParagraph)return;let e=this.options.editor.state,n=this.currentPlainParagraph.pos,r=e.doc.nodeAt(n);if(!r)return;let o=e.doc.resolve(n),s=o.index(o.depth);if(s===0)return;let l=o.parent.child(s-1);if(!l||!l.isTextblock)return;let c=n-l.nodeSize,u=Wo(l),d=(x=this.overlayEl.value)!=null?x:"",h=`${u}${d}`,f=nt.fromSchema(e.schema),p=document.createElement("div");p.innerHTML=this.renderInlineMarkdownToHtml(h);let m=f.parseSlice(p,{preserveWhitespace:!0}),g=l.type.createChecked(l.attrs,m.content);this.currentPlainParagraph=null,this.overlayActivePos=c,this.overlayEl.value=h;try{this.overlayEl.setSelectionRange(u.length,u.length)}catch(S){}let b=c,v=n+r.nodeSize,y=e.tr.replaceWith(b,v,g),E=c+1+l.content.size;y.setSelection(G.create(y.doc,E)),t.dispatch(y)}handleArrowKey(t){var m,g,b;if(!this.overlayEl||!this.currentPlainParagraph)return!1;let e=(m=this.overlayEl.value)!=null?m:"",n=(g=this.overlayEl.selectionStart)!=null?g:0,r=(b=this.overlayEl.selectionEnd)!=null?b:n;if(n!==r)return!1;let o=n===0,s=n===e.length;if(!o&&!s)return!1;let a=this.getArrowMoveDirection(t,o,s,this.getCurrentWritingMode());if(!a)return!1;let l=this.currentPlainParagraph.pos;this.commitCurrentPlainParagraph(!0);let c=this.options.editor.state,u=this.findAdjacentPlainParagraph(c,l,a);if(!u)return!1;let d=Wo(u.node),h=a==="prev"?d.length:0;this.pendingSelection={start:h,end:h};let f=a==="prev"?u.pos+u.node.content.size:u.pos+1,p=c.tr.setSelection(G.create(c.doc,f));return this.options.editor.view.dispatch(p),!0}getArrowMoveDirection(t,e,n,r){return r==="vertical-rl"?n&&t==="ArrowLeft"?"next":e&&t==="ArrowRight"?"prev":null:n&&t==="ArrowDown"?"next":e&&t==="ArrowUp"?"prev":null}getCurrentWritingMode(){return this.overlayEl&&getComputedStyle(this.overlayEl).writingMode==="horizontal-tb"?"horizontal-tb":"vertical-rl"}findAdjacentPlainParagraph(t,e,n){let r=t.doc.nodeAt(e);if(!r)return null;let o=t.doc.resolve(e),s=o.depth,a=o.parent,l=o.index(s);if(n==="prev"){let u=e;for(let d=l-1;d>=0;d--){let h=a.child(d);if(u-=h.nodeSize,this.isPlainTargetNode(h))return{pos:u,node:h}}return null}let c=e+r.nodeSize;for(let u=l+1;u<a.childCount;u++){let d=a.child(u);if(this.isPlainTargetNode(d))return{pos:c,node:d};c+=d.nodeSize}return null}syncOverlayStyleFromParagraph(t){var s;if(!this.overlayEl)return;let e=getComputedStyle(t),n=this.overlayHost?getComputedStyle(this.overlayHost):null,r=this.overlayEl.style;r.fontFamily=e.fontFamily,r.fontSize=e.fontSize,r.fontWeight=e.fontWeight,r.fontStyle=e.fontStyle,r.lineHeight=e.lineHeight,r.letterSpacing=e.letterSpacing,r.textAlign=e.textAlign,r.textIndent=e.textIndent;let o=(e.color==="transparent"||e.color==="rgba(0, 0, 0, 0)")&&(s=n==null?void 0:n.color)!=null?s:e.color;r.color=o,r.caretColor=o,r.direction=e.direction,r.setProperty("writing-mode",e.getPropertyValue("writing-mode")),r.setProperty("text-orientation",e.getPropertyValue("text-orientation"))}applyInlineHtmlToParagraph(t,e,n,r){try{let{state:o,view:s}=this.options.editor,a=o.doc.nodeAt(t);if(!a)return;let l=document.createElement("div");l.innerHTML=e;let u=nt.fromSchema(o.schema).parseSlice(l,{preserveWhitespace:!0}),d=t+1,h=t+a.nodeSize-1,f=o.tr.replaceRange(d,h,u);r&&f.setNodeMarkup(t,void 0,r),n||f.setMeta("addToHistory",!1),this.isApplying=!0,s.dispatch(f)}catch(o){Ee("[Tategaki TipTap Plain Edit] Failed to apply html:",o)}finally{this.isApplying=!1}}hideOverlay(){this.overlayEl&&(this.overlayEl.style.display="none"),this.overlayBaseRect=null}destroyOverlay(){this.overlayEl&&(this.overlayEl.remove(),this.overlayEl=null),this.overlayHost=null,this.overlayActivePos=null,this.overlayBaseRect=null,this.currentPlainParagraph=null}destroy(){this.isActive&&this.deactivate()}};var sE=require("obsidian"),ul=class extends sE.Modal{constructor(e,n){super(e);this.result=null;this.resolvePromise=null;this.tags=n}onOpen(){let{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u672A\u5BFE\u5FDCHTML\u30BF\u30B0\u306E\u691C\u51FA"}),e.createEl("p",{text:"\u672A\u5BFE\u5FDC\u306EHTML\u30BF\u30B0\u304C\u542B\u307E\u308C\u3066\u3044\u308B\u305F\u3081\u3001\u305D\u306E\u307E\u307E\u7DE8\u96C6\u3059\u308B\u3068\u5931\u308F\u308C\u308B\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\u3002"}),this.tags.length>0){let a=e.createDiv();a.style.marginTop="8px",a.style.marginBottom="8px",a.createEl("div",{text:`\u691C\u51FA\u3055\u308C\u305F\u30BF\u30B0: ${this.tags.join(", ")}`})}let n=e.createDiv({cls:"modal-button-container"});n.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
			flex-wrap: wrap;
		`,n.createEl("button",{text:"\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u958B\u304F",cls:"mod-cta"}).addEventListener("click",()=>{this.result="read-only",this.close()}),n.createEl("button",{text:"\u7834\u68C4\u3057\u3066\u958B\u304F",cls:"mod-warning"}).addEventListener("click",()=>{this.result="discard",this.close()}),n.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB"}).addEventListener("click",()=>{this.result="cancel",this.close()})}onClose(){this.contentEl.empty(),this.resolvePromise&&this.resolvePromise(this.result||"cancel")}async waitForChoice(){return new Promise(e=>{this.resolvePromise=e,this.open()})}};var dl=new Set(["\u3001","\u3002","\uFF0C","\uFF0E",",",".","\uFF09",")","\uFF3D","]","\uFF5D","}","\u3011","\u300F","\u300D","\u3009","\u300A","\u3017","\u3019","\u301F","\u2019","\u201D","\xBB","\uFF01","\uFF1F","!","?","\uFF1B","\uFF1A",";",":"]),aE=new Set(["\uFF08","\u3014","\uFF3B","\uFF5B","\u3008","\u300A","\u300C","\u300E","\u3010","\u3018","\u3016","\u301D","\u2018","\u201C","\xAB","(","[","{"]),lE=new Set(["P","DIV","LI","BLOCKQUOTE","H1","H2","H3","H4","H5","H6"]);var hl=class{constructor(t){this.cancelled=!1;this.options=t}cancel(){this.cancelled=!0}async paginate(){var p,m;this.cancelled=!1;let t=(p=this.options.timeSliceMs)!=null?p:12,e={start:this.getNow()},n=(m=this.options.container)==null?void 0:m.ownerDocument;if(!n)return[];let r=n.createElement("div");r.innerHTML=this.options.contentHtml;let o=this.collectTextNodes(r,n),s=this.buildPrefixLengths(o),a=this.buildTextNodeRanges(o,s),l=s.length>0?s[s.length-1]:0;if(l===0)return[];let c=this.createBlockSegments(r,this.options.writingMode,n),u={host:r,textNodes:o,prefixLengths:s,textNodeRanges:a,blockSegments:c,startIndex:0,totalLength:l,pageCount:0,cumulativeChars:0,lastCharCount:0,writingMode:this.options.writingMode},d=[],h=0,f=1e4;for(;u.startIndex<u.totalLength&&h<f&&!this.cancelled;){let g=await this.computeNextPagePrecise(u,e,t);if(!g||(d.push(g),this.options.onPage&&this.options.onPage(g),this.options.onProgress&&this.options.onProgress(u.startIndex,u.totalLength),await this.maybeYield(e,t),this.cancelled))break;h++}return d}getNow(){var e,n;let t=(e=this.options.container.ownerDocument.defaultView)==null?void 0:e.performance;return(n=t==null?void 0:t.now())!=null?n:Date.now()}async yieldToMain(){let t=this.options.container.ownerDocument.defaultView;if(t&&typeof t.requestAnimationFrame=="function"){await new Promise(e=>{t.requestAnimationFrame(()=>e())});return}await new Promise(e=>setTimeout(e,0))}async maybeYield(t,e){!Number.isFinite(e)||e<=0||this.getNow()-t.start<e||(await this.yieldToMain(),t.start=this.getNow())}createBlockSegments(t,e,n){var d,h;let r=e==="vertical-rl"||e==="vertical-lr",o=(h=(d=n.defaultView)==null?void 0:d.NodeFilter)!=null?h:NodeFilter,s=n.createTreeWalker(t,o.SHOW_TEXT,null),a=new Map,l=0,c;for(;c=s.nextNode();){let f=c.textContent;if(!f)continue;let p=this.findPaginationBlockAncestor(c,t);if(!p)continue;let m=f.length,g=l,b=l+m;if(l=b,a.has(p)){let v=a.get(p);v.end=b,v.charCount+=m}else a.set(p,{start:g,end:b,charCount:m})}let u=[];return a.forEach((f,p)=>{let m=this.measureBlockAxisSize(p,r);u.push({block:p,startIndex:f.start,endIndex:f.end,charCount:Math.max(1,f.charCount),axisSize:m>0?m:0})}),u.sort((f,p)=>f.startIndex-p.startIndex),u}findPaginationBlockAncestor(t,e){let n=t instanceof HTMLElement?t:t.parentElement;for(;n&&n!==e;){if(this.isPaginationBlockElement(n))return n;n=n.parentElement}return e}isPaginationBlockElement(t){return lE.has(t.tagName)}measureBlockAxisSize(t,e){try{let n=document.createRange();n.selectNodeContents(t);let r=n.getBoundingClientRect(),o=e?r.width:r.height;if(o>0)return o;let s=t.getBoundingClientRect(),a=e?s.width:s.height;if(a>0)return a}catch(n){}return 0}async computeNextPagePrecise(t,e,n){if(this.cancelled||t.startIndex>=t.totalLength)return null;let r=this.createEmptyPage(),o=r.querySelector(".page-content");if(!o)return r.remove(),null;o.style.whiteSpace="normal",o.style.visibility="hidden";let s=t.totalLength-t.startIndex,a=t.lastCharCount,l=t.pageCount>0?Math.ceil(t.cumulativeChars/t.pageCount):0,c=Math.max(a,l);c<=0&&(c=Math.min(s,1800));let u=this.getPageAxisLimit(o,t.writingMode),d=this.estimateCharsForNextPage(t,u);d>0&&(c=Math.max(1,Math.min(s,d)));let h=1,f;if(d>0){let M=Math.max(64,Math.floor(c*.25));f=Math.min(s,c+M),f<1&&(f=Math.max(1,c+M))}else{let M=Math.max(512,Math.floor(c*1.1)),L=Math.min(s,Math.max(M,c+512));h=Math.max(1,Math.min(Math.floor(c*.5),L)),f=L}f<h&&(f=Math.max(h,Math.min(s,h+256)));let p=0;for(;h<=f;){if(this.cancelled||(await this.maybeYield(e,n),this.cancelled))return r.remove(),null;let M=Math.floor((h+f)/2);o.innerHTML="";let L=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,M);o.appendChild(L),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight,this.isOverflow(r,t.writingMode)?f=M-1:(p=M,h=M+1)}let m=Math.max(1,p),g=Math.max(1,Math.floor(Math.max(c,m)*.12));for(;t.startIndex+m<t.totalLength;){if(this.cancelled||(await this.maybeYield(e,n),this.cancelled))return r.remove(),null;let M=Math.min(s,Math.min(t.totalLength-t.startIndex,m+g));if(M<=m)break;o.innerHTML="";let L=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,M);if(o.appendChild(L),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight,this.isOverflow(r,t.writingMode)){if(g===1)break;g=Math.max(1,Math.floor(g/2))}else if(m=M,g=Math.max(1,Math.floor(g*1.5)),m>=s)break}let b=Math.max(1,Math.min(m,s)),v=0,y=32;for(;v<y;){if(this.cancelled||(await this.maybeYield(e,n),this.cancelled))return r.remove(),null;o.innerHTML="";let M=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,b);if(o.appendChild(M),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight,!this.isOverflow(r,t.writingMode)||b<=1)break;b=Math.max(1,b-1),v++}let E=b;if(b=this.adjustBreakForKinsoku(t,r,o,b),b=this.adjustBreakForRuby(t,r,o,b),b=this.adjustBreakForKinsoku(t,r,o,b),b<E){o.innerHTML="";let M=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,b);o.appendChild(M),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight;let L=this.findLastLeafBlock(o),_=L&&this.isPageContinuation(t,t.startIndex+b)?this.getLastLineInlineRatio(L,t.writingMode):null;_!==null&&_<.7&&(b=E)}o.innerHTML="";let x=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,b);o.appendChild(x),this.pruneTrailingWhitespaceNodes(o),o.style.visibility="";let S=t.startIndex+b;if(this.isPageContinuation(t,S)){r.setAttribute("data-continued","true");let M=this.markContinuationBlock(o);M&&this.markShortLastLineIfNeeded(M,t.writingMode)}else r.removeAttribute("data-continued");let k={element:r,startIndex:t.startIndex,endIndex:t.startIndex+b,charCount:b};return t.startIndex+=b,t.pageCount+=1,t.cumulativeChars+=b,t.lastCharCount=b,k}markContinuationBlock(t){let e=this.findLastLeafBlock(t);return e&&e.classList.add("tategaki-continued-block"),e}findLastLeafBlock(t){let e="p, li, blockquote, h1, h2, h3, h4, h5, h6, div",n=Array.from(t.querySelectorAll(e));for(let r=n.length-1;r>=0;r--){let o=n[r];if(!o.querySelector(e))return o}return null}markShortLastLineIfNeeded(t,e){let n=this.getLastLineInlineRatio(t,e);if(n===null){t.classList.remove("tategaki-continued-block-short-last");return}n<.7?t.classList.add("tategaki-continued-block-short-last"):t.classList.remove("tategaki-continued-block-short-last")}getLastLineInlineRatio(t,e){let n=e==="vertical-rl"||e==="vertical-lr",o=t.ownerDocument.createRange(),s=t.style.textAlignLast;t.style.textAlignLast="start",t.offsetWidth,o.selectNodeContents(t);let a=Array.from(o.getClientRects()).filter(h=>h.width>0&&h.height>0),l=a.length>0?a[a.length-1]:null,c=t.getBoundingClientRect();if(t.style.textAlignLast=s,!l)return null;let u=n?l.height:l.width,d=n?c.height:c.width;return!Number.isFinite(d)||d<=0?null:u/d}isPageContinuation(t,e){if(e>=t.totalLength)return!1;let n=Math.max(t.startIndex,e-1),r=this.findContainingBlockSegment(t.blockSegments,n);return r?e<r.endIndex:!1}findContainingBlockSegment(t,e){for(let n of t)if(n.startIndex<=e&&e<n.endIndex)return n;return null}getPageAxisLimit(t,e){let n=e==="vertical-rl"||e==="vertical-lr";t.offsetWidth;let r=n?t.clientWidth:t.clientHeight;return Math.max(1,r)}estimateCharsForNextPage(t,e){if(!Number.isFinite(e)||e<=0||t.blockSegments.length===0)return 0;let n=Math.max(0,t.totalLength-t.startIndex);if(n===0)return 0;let r=t.blockSegments,o=t.startIndex,s=e,a=0,l=this.findFirstBlockSegmentIndex(r,o);for(;l<r.length&&s>0&&o<t.totalLength&&a<n;){let c=r[l];if(c.endIndex<=o){l++;continue}let u=c.endIndex-Math.max(c.startIndex,o);if(u<=0){l++;continue}let h=(c.axisSize>0?c.axisSize:e)/Math.max(1,c.charCount),f=h>0?h:e/Math.max(c.charCount,1);if(f<=0){let b=Math.min(u,Math.max(1,Math.floor(s)));a+=b,o+=b,s-=b*(e/Math.max(n,1)),l++;continue}let p=f*u;if(p<=s*1.05){a+=u,o+=u,s-=p,l++;continue}let m=Math.floor(s/f);if(m<=0)break;let g=Math.max(1,Math.min(u,m));a+=g,o+=g,s-=g*f;break}return Math.min(a,n)}findFirstBlockSegmentIndex(t,e){for(let n=0;n<t.length;n++)if(t[n].endIndex>e)return n;return t.length}createEmptyPage(){let t=this.options.container;if(!t)throw new Error("MeasuredPagination container is missing");let e=t.ownerDocument,n=e.createElement("div");n.className="tategaki-page",n.setAttribute("data-writing-mode",this.options.writingMode);let r=e.createElement("div");return r.className="page-content",n.appendChild(r),t.appendChild(n),n}collectTextNodes(t,e){var a,l;let n=[],r=(l=(a=e.defaultView)==null?void 0:a.NodeFilter)!=null?l:NodeFilter,o=e.createTreeWalker(t,r.SHOW_TEXT,null),s=o.nextNode();for(;s;){if(s.nodeType===Node.TEXT_NODE&&s.nodeValue&&s.nodeValue.length){let c=s;if(this.isRubyAnnotationText(c)){s=o.nextNode();continue}n.push(s)}s=o.nextNode()}return n}isRubyAnnotationText(t){let e=t.parentElement;for(;e;){let n=e.tagName;if(n==="RT"||n==="RP"||e.classList.contains("tategaki-aozora-ruby-rt"))return!0;e=e.parentElement}return!1}buildPrefixLengths(t){let e=[],n=0;for(let r of t){let o=r.nodeValue?r.nodeValue.length:0;n+=o,e.push(n)}return e}buildTextNodeRanges(t,e){var o;let n=new Map,r=0;for(let s=0;s<t.length;s+=1){let a=t[s],l=(o=e[s])!=null?o:r;n.set(a,{start:r,end:l}),r=l}return n}mapCharIndex(t,e,n){if(t.length===0)throw new Error("mapCharIndex called with empty textNodes");let r=Math.max(0,n),o=0,s=e.length-1;for(;o<=s;){let f=o+s>>>1,p=e[f];r<p?s=f-1:o=f+1}let a=Math.min(o,t.length-1),l=a>0?e[a-1]:0,c=t[a],u=c.nodeValue?c.nodeValue.length:0,d=r-l,h=Math.max(0,Math.min(u,d));return{node:c,offset:h}}cloneFragmentByCharRange(t,e,n,r){var c,u;let s=((u=(c=t[0])==null?void 0:c.ownerDocument)!=null?u:this.options.container.ownerDocument).createRange(),a=this.mapCharIndex(t,e,n),l=this.mapCharIndex(t,e,n+Math.max(1,r));return s.setStart(a.node,a.offset),s.setEnd(l.node,l.offset),s.cloneContents()}isOverflow(t,e){let n=t.querySelector(".page-content");if(!n)return!1;if(e==="vertical-rl"||e==="vertical-lr"){let o=n.scrollWidth-n.clientWidth;return!(o<=0||this.isRubyOnlyOverflow(n,e)||this.allowRubyOverhang(n,e,o))}else{let o=n.scrollHeight-n.clientHeight;return!(o<=0||this.isRubyOnlyOverflow(n,e)||this.allowRubyOverhang(n,e,o))}}isRubyOnlyOverflow(t,e){if(!this.wrapperHasRuby(t))return!1;let n=e==="vertical-rl"||e==="vertical-lr";return this.withRubySuppressed(t,()=>(t.offsetWidth,n?t.scrollWidth-t.clientWidth:t.scrollHeight-t.clientHeight))<=0}wrapperHasRuby(t){return!!t.querySelector("ruby")||!!t.querySelector(".tategaki-aozora-ruby")||!!t.querySelector(".tategaki-aozora-ruby-rt")}withRubySuppressed(t,e){let n="tategaki-pagination-ignore-ruby",r=t.classList.contains(n);r||t.classList.add(n);try{return e()}finally{r||t.classList.remove(n)}}allowRubyOverhang(t,e,n){if(n<=0||!this.wrapperHasRuby(t))return!1;let r=this.getRubyOverhangAllowancePx(t,e);return r>0&&n<=r}getRubyOverhangAllowancePx(t,e){let n=t.ownerDocument.defaultView;if(!n)return 0;let r=n.getComputedStyle(t),o=Number.parseFloat(r.fontSize);if(!Number.isFinite(o)||o<=0)return 0;let s=Number.parseFloat(r.getPropertyValue("--tategaki-ruby-size")),a=Number.isFinite(s)?s:.5,l=e==="vertical-rl"||e==="vertical-lr"?"--tategaki-ruby-gap-vertical":"--tategaki-ruby-gap-horizontal",c=Number.parseFloat(r.getPropertyValue(l)),u=Number.isFinite(c)?c:0,d=Math.min(1.2,Math.max(.2,a+u));return o*d}pruneTrailingWhitespaceNodes(t){var n;let e=t.lastChild;for(;e;){if(e.nodeType===Node.TEXT_NODE){let o=(n=e.nodeValue)!=null?n:"";if(/^\s*$/.test(o)){let s=e.previousSibling;t.removeChild(e),e=s;continue}}break}}adjustBreakForKinsoku(t,e,n,r){var a,l,c,u,d,h,f,p;if(r<=1||t.startIndex+r>=t.totalLength)return r;let o=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+r),s=(l=(a=o.node.nodeValue)==null?void 0:a[o.offset])!=null?l:"";if(dl.has(s)){let m=r,g=Math.min(10,t.totalLength-t.startIndex-r),b=!1;for(let v=1;v<=g;v++){m=r+v,n.innerHTML="";let y=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,m);if(n.appendChild(y),this.pruneTrailingWhitespaceNodes(n),n.offsetHeight,this.isOverflow(e,t.writingMode))break;let E=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+m),x=(u=(c=E.node.nodeValue)==null?void 0:c[E.offset])!=null?u:"";if(!dl.has(x)){b=!0,r=m;break}}if(!b){let v=Math.min(80,r-1);for(let y=1;y<=v;y++){let E=r-y,x=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+E),S=(h=(d=x.node.nodeValue)==null?void 0:d[x.offset])!=null?h:"";if(!dl.has(S)){r=Math.max(1,E);break}}}}if(r>0){let m=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+r-1),g=(p=(f=m.node.nodeValue)==null?void 0:f[m.offset])!=null?p:"";if(aE.has(g))return Math.max(1,r-1)}return r}adjustBreakForRuby(t,e,n,r){if(r<=1||t.startIndex+r>=t.totalLength)return r;let o=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+r),s=this.findRubyAncestor(o.node,t.host);if(!s)return r;let a=this.getElementTextRange(s,t.textNodeRanges);if(!a)return r;let l=a.start,c=a.end,u=t.startIndex+r;if(u<=l||u>=c)return r;let d=c-t.startIndex;if(d>r){n.innerHTML="";let f=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,d);if(n.appendChild(f),this.pruneTrailingWhitespaceNodes(n),n.offsetHeight,!this.isOverflow(e,t.writingMode))return d}let h=l-t.startIndex;return h>=1?Math.min(r,h):r}findRubyAncestor(t,e){let n=t instanceof HTMLElement?t:t.parentElement;for(;n&&n!==e;){if(n.tagName==="RUBY"||n.classList.contains("tategaki-aozora-ruby"))return n;n=n.parentElement}return null}getElementTextRange(t,e){var c,u;let n=t.ownerDocument;if(!n)return null;let r=(u=(c=n.defaultView)==null?void 0:c.NodeFilter)!=null?u:NodeFilter,o=n.createTreeWalker(t,r.SHOW_TEXT,null),s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=o.nextNode();for(;l;){if(l.nodeType===Node.TEXT_NODE){let d=e.get(l);d&&(s=Math.min(s,d.start),a=Math.max(a,d.end))}l=o.nextNode()}return!Number.isFinite(s)||!Number.isFinite(a)?null:{start:s,end:a}}};function cE(i,t){return Math.max(1,i+t)}function SN(i,t,e){let n=Math.max(0,Math.floor(i)),r=Math.max(1,t),o=cE(r,e);return n*o}var Ir=class{constructor(t){this.styleEl=null;this.viewportEl=null;this.pagesContainerEl=null;this.pageElements=[];this.headerEl=null;this.footerEl=null;this.headerMaskEl=null;this.footerMaskEl=null;this.pageCount=0;this.pageIndex=0;this.pendingPageIndex=null;this.renderToken=0;this.destroyed=!1;this.isRendering=!1;this.hasRenderedOnce=!1;this.paginationInProgress=!1;this.transitionTimeouts=[];this.pendingRender=!1;this.lastViewportSize=null;this.pendingViewportSize=null;this.activePagination=null;this.debugLayout=!0;this.lastLayoutMetrics=null;this.lastLineMetrics=null;this.layoutLinePitchPx=null;this.resizeObserver=null;this.resizeTimeout=null;this.keydownHandler=null;this.wheelHandler=null;this.pointerDownHandler=null;this.pointerUpHandler=null;this.pointerCancelHandler=null;this.pointerStartX=null;this.pointerStartY=null;this.pointerStartTime=0;var e,n;this.container=t.container,this.contentHtml=t.contentHtml,this.writingMode=t.writingMode,this.settings=t.settings,this.previewSettings=(e=t.previewSettings)!=null?e:{syncCursor:!0,updateInterval:300,headerContent:"none",headerAlign:"center",footerContent:"pageNumber",footerAlign:"center",pageNumberFormat:"currentTotal",bookPaddingTop:44,bookPaddingBottom:32},this.title=(n=t.title)!=null?n:"",this.onPageChange=t.onPageChange,this.onPageAdded=t.onPageAdded,this.onRepaginationRequired=t.onRepaginationRequired,this.onRendered=t.onRendered,this.initialize()}destroy(){var t,e,n,r,o,s,a,l,c,u;this.destroyed=!0,this.renderToken+=1,this.removeInputHandlers(),this.transitionTimeouts.length>0&&(this.transitionTimeouts.forEach(d=>clearTimeout(d)),this.transitionTimeouts=[]),this.resizeTimeout!==null&&(((t=this.container.ownerDocument.defaultView)!=null?t:window).clearTimeout(this.resizeTimeout),this.resizeTimeout=null),(e=this.resizeObserver)==null||e.disconnect(),this.resizeObserver=null,(n=this.activePagination)==null||n.cancel(),this.activePagination=null,(r=this.styleEl)==null||r.remove(),this.styleEl=null,this.pageElements.forEach(d=>d.remove()),this.pageElements=[],(o=this.pagesContainerEl)==null||o.remove(),this.pagesContainerEl=null,(s=this.headerEl)==null||s.remove(),this.headerEl=null,(a=this.footerEl)==null||a.remove(),this.footerEl=null,(l=this.headerMaskEl)==null||l.remove(),this.headerMaskEl=null,(c=this.footerMaskEl)==null||c.remove(),this.footerMaskEl=null,(u=this.viewportEl)==null||u.remove(),this.viewportEl=null,this.pageCount=0,this.pageIndex=0}getProgress(){return this.pageCount<=1?0:this.pageIndex/(this.pageCount-1)}repaginate(){this.destroyed||this.render()}jumpToProgress(t){if(this.pageCount<=1)return;let e=Math.max(0,Math.min(1,t)),n=Math.round(e*(this.pageCount-1));this.goToPage(n,!1)}scrollToPage(t,e=!0){this.goToPage(t,e)}initialize(){this.container.classList.add("tategaki-reading-paged-container"),this.container.hasAttribute("tabindex")||(this.container.tabIndex=-1),this.container.style.setProperty("--tategaki-writing-mode",this.writingMode),this.container.style.setProperty("--tategaki-font-family",this.settings.fontFamily),this.container.style.setProperty("--tategaki-font-size",`${this.settings.fontSize}px`),this.container.style.setProperty("--tategaki-line-height",this.settings.lineHeight.toString()),this.container.style.setProperty("--tategaki-letter-spacing",`${this.settings.letterSpacing}em`),this.container.style.setProperty("--tategaki-text-color",this.settings.textColor),this.container.style.setProperty("--tategaki-background-color",this.settings.backgroundColor),this.container.style.setProperty("--tategaki-page-background-color",this.settings.pageBackgroundColor),this.container.style.setProperty("--tategaki-ruby-size",this.settings.rubySize.toString()),this.container.style.setProperty("--ruby-size",this.settings.rubySize.toString()),this.container.style.setProperty("--tategaki-ruby-gap-vertical",`${this.settings.rubyVerticalGap}em`),this.container.style.setProperty("--tategaki-ruby-gap-horizontal",`${this.settings.rubyHorizontalGap}em`);let t=this.settings.headingFontFamily||this.settings.fontFamily,e=this.settings.headingTextColor||this.settings.textColor;this.container.style.setProperty("--tategaki-heading-font-family",t),this.container.style.setProperty("--tategaki-heading-text-color",e);let n=this.container.ownerDocument;this.styleEl=n.createElement("style"),this.styleEl.setAttribute("data-tategaki-reading-paged","true"),n.head.appendChild(this.styleEl),this.viewportEl=n.createElement("div"),this.viewportEl.className="tategaki-reading-paged-viewport",this.pagesContainerEl=n.createElement("div"),this.pagesContainerEl.className="tategaki-reading-paged-pages-container",this.viewportEl.appendChild(this.pagesContainerEl),this.container.appendChild(this.viewportEl),this.updatePaginationLayoutClasses(),this.ensureFixedHeaderFooterElements(),this.setupInputHandlers();try{this.container.focus()}catch(r){}this.setupResizeObserver(),this.render()}setupResizeObserver(){let t=this.container.ownerDocument.defaultView;!this.container||!(t!=null&&t.ResizeObserver)||(this.resizeObserver=new t.ResizeObserver(()=>{this.resizeTimeout!==null&&t.clearTimeout(this.resizeTimeout),this.resizeTimeout=t.setTimeout(()=>{if(!this.destroyed&&this.viewportEl){if(this.isOverlayOpen())return;let e=this.getViewportSize();if(this.lastViewportSize&&this.lastViewportSize.width===e.width&&this.lastViewportSize.height===e.height)return;if(this.onRepaginationRequired&&this.hasRenderedOnce){this.onRepaginationRequired();return}if(this.isRendering){this.pendingRender=!0,this.pendingViewportSize=e;return}let n=this.getPageGapPx();if(this.writingMode==="vertical-rl"){let r=this.viewportEl.scrollLeft,o=this.viewportEl.clientWidth;if(o>0){let s=Math.max(0,this.viewportEl.scrollWidth-o);this.pageIndex=Math.round((s-r)/(o+n))}}else{let r=this.viewportEl.scrollTop,o=this.viewportEl.clientHeight;o>0&&(this.pageIndex=Math.round(r/(o+n)))}this.render()}},50)}),this.resizeObserver.observe(this.container))}setupInputHandlers(){var t;this.removeInputHandlers(),this.keydownHandler=e=>{if(this.isEventTargetWithinContainer(e.target)&&!this.isOverlayOpen()&&this.isContainerInActiveLeaf()){if(e.key==="PageUp"){e.preventDefault(),this.previousPage();return}if(e.key==="PageDown"){e.preventDefault(),this.nextPage();return}if(e.key==="Home"){e.preventDefault(),this.goToFirstPage();return}if(this.writingMode==="vertical-rl"){if(e.key==="ArrowLeft"){e.preventDefault(),this.nextPage();return}if(e.key==="ArrowRight"){e.preventDefault(),this.previousPage();return}}else{if(e.key==="ArrowDown"){e.preventDefault(),this.nextPage();return}if(e.key==="ArrowUp"){e.preventDefault(),this.previousPage();return}}}},this.wheelHandler=e=>{if(e.defaultPrevented||!this.isEventTargetWithinContainer(e.target)||this.isOverlayOpen()||!this.isContainerInActiveLeaf()||this.isWithinScrollableElement(e.target))return;let n=Math.abs(e.deltaX)>Math.abs(e.deltaY)?e.deltaX:e.deltaY;n!==0&&(e.preventDefault(),n>0?this.nextPage():this.previousPage())},this.pointerDownHandler=e=>{try{this.container.focus()}catch(n){}e.pointerType&&e.pointerType!=="touch"&&e.pointerType!=="pen"||(this.pointerStartX=e.clientX,this.pointerStartY=e.clientY,this.pointerStartTime=Date.now())},this.pointerUpHandler=e=>{if(this.pointerStartX===null||this.pointerStartY===null)return;let n=e.clientX-this.pointerStartX,r=e.clientY-this.pointerStartY,o=Date.now()-this.pointerStartTime;this.pointerStartX=null,this.pointerStartY=null,this.pointerStartTime=0;let s=Math.abs(n),a=Math.abs(r),l=12,c=40;if(s<=l&&a<=l&&o<=400){let h=this.container.getBoundingClientRect(),f=h.left+h.width/2;e.clientX<f?this.nextPage():this.previousPage();return}if(this.writingMode==="vertical-rl"){if(s<c||s<a)return;n<0?this.nextPage():this.previousPage();return}a<c||a<s||(r<0?this.nextPage():this.previousPage())},this.pointerCancelHandler=()=>{this.pointerStartX=null,this.pointerStartY=null,this.pointerStartTime=0},this.container.addEventListener("keydown",this.keydownHandler),this.container.addEventListener("pointerdown",this.pointerDownHandler,{capture:!0}),this.container.addEventListener("pointerup",this.pointerUpHandler),this.container.addEventListener("pointercancel",this.pointerCancelHandler),this.container.addEventListener("wheel",this.wheelHandler,{passive:!1}),(t=this.viewportEl)==null||t.addEventListener("wheel",this.wheelHandler,{passive:!1}),this.container.ownerDocument.addEventListener("wheel",this.wheelHandler,{passive:!1,capture:!0})}updatePaginationLayoutClasses(){if(!this.viewportEl||!this.pagesContainerEl)return;let t=this.writingMode==="vertical-rl";this.viewportEl.classList.toggle("pages-horizontal-reverse",t),this.viewportEl.classList.toggle("pages-vertical",!t),this.pagesContainerEl.classList.toggle("pages-horizontal-reverse",t),this.pagesContainerEl.classList.toggle("pages-vertical",!t)}removeInputHandlers(){var t;this.keydownHandler&&(this.container.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null),this.wheelHandler&&(this.container.removeEventListener("wheel",this.wheelHandler),(t=this.viewportEl)==null||t.removeEventListener("wheel",this.wheelHandler),this.container.ownerDocument.removeEventListener("wheel",this.wheelHandler,{capture:!0}),this.wheelHandler=null),this.pointerDownHandler&&(this.container.removeEventListener("pointerdown",this.pointerDownHandler),this.pointerDownHandler=null),this.pointerUpHandler&&(this.container.removeEventListener("pointerup",this.pointerUpHandler),this.pointerUpHandler=null),this.pointerCancelHandler&&(this.container.removeEventListener("pointercancel",this.pointerCancelHandler),this.pointerCancelHandler=null)}isEventTargetWithinContainer(t){return!t||!(t instanceof Element)?!1:this.container.contains(t)}isOverlayOpen(){let t=this.container.ownerDocument;if(t.querySelectorAll(".modal-container").length>0)return!0;let n=t.querySelector(".menu")!==null,r=t.querySelector(".popover")!==null;return!!(n||r)}isContainerInActiveLeaf(){let t=this.container.ownerDocument,e=t.defaultView;if(e&&e!==window)return!0;let n=t.querySelector(".workspace-leaf.mod-active");return n?n.contains(this.container):!0}isWithinScrollableElement(t){let e=t;for(;e&&e!==this.container;){if(e.classList.contains("modal")||e.classList.contains("modal-container")||e.classList.contains("setting-item")||e.classList.contains("vertical-tab-content")||e.classList.contains("tategaki-control-panel")||e.classList.contains("control-panel-content"))return!0;if(e.classList.contains("view-content")||e.classList.contains("workspace-leaf-content")){e=e.parentElement;continue}let n=getComputedStyle(e),r=n.overflowY,o=n.overflowX;if((r==="auto"||r==="scroll"||o==="auto"||o==="scroll")&&e!==this.viewportEl&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth))return!0;e=e.parentElement}return!1}nextPage(){this.goToPage(this.pageIndex+1,!0)}previousPage(){this.goToPage(this.pageIndex-1,!0)}goToFirstPage(){this.goToPage(0,!0)}goToPage(t,e){let n=Math.max(0,t);this.paginationInProgress&&(this.pendingPageIndex=n);let r=Math.max(0,Math.min(n,this.pageCount-1));if(r===this.pageIndex)return;let o=r<this.pageIndex;this.pageIndex=r,this.scrollToCurrentPage(e,o),this.emitPageChange()}scrollToCurrentPage(t,e=!1){var o;if(!this.viewportEl)return;let n=(o=this.previewSettings.pageTransitionEffect)!=null?o:"fade";if(["fade","blur"].includes(n)&&this.pageElements.length>0){this.applySimpleTransition(n,()=>this.performScrollToCurrentPage());return}this.applyNonFadeTransition(n,e),this.performScrollToCurrentPage()}performScrollToCurrentPage(){if(!this.viewportEl)return;let t="auto",e=this.getPageGapPx(),n=this.pageElements[this.pageIndex];if(this.writingMode==="vertical-rl"){let s=Math.max(1,this.viewportEl.clientWidth);if(this.paginationInProgress&&n){let u=n.offsetLeft+n.offsetWidth-s;this.viewportEl.scrollTo({left:Math.max(0,u),behavior:t});return}let a=s+e,l=Math.max(0,this.viewportEl.scrollWidth-s),c=Math.max(0,l-this.pageIndex*a);this.viewportEl.scrollTo({left:c,behavior:t});return}if(this.paginationInProgress&&n){this.viewportEl.scrollTo({top:Math.max(0,n.offsetTop),behavior:t});return}let r=Math.max(1,this.viewportEl.clientHeight),o=SN(this.pageIndex,r,e);this.viewportEl.scrollTo({top:o,behavior:t})}applySimpleTransition(t,e){if(!this.pagesContainerEl||!this.container){e();return}this.transitionTimeouts.forEach(o=>clearTimeout(o)),this.transitionTimeouts=[],this.container.querySelectorAll(".page-transition-mask").forEach(o=>o.remove()),this.pagesContainerEl.classList.remove("page-transition-fade-out","page-transition-fade-in","page-transition-blur-out","page-transition-blur-in"),this.pagesContainerEl.classList.add(`page-transition-${t}-out`);let n=setTimeout(()=>{this.pagesContainerEl&&(this.pagesContainerEl.style.visibility="hidden",this.pagesContainerEl.classList.remove(`page-transition-${t}-out`),e(),requestAnimationFrame(()=>{this.pagesContainerEl&&(this.pagesContainerEl.style.visibility="",this.pagesContainerEl.classList.add(`page-transition-${t}-in`))}))},200),r=setTimeout(()=>{this.pagesContainerEl&&this.pagesContainerEl.classList.remove(`page-transition-${t}-in`)},400);this.transitionTimeouts.push(n,r)}applyNonFadeTransition(t,e=!1){if(!this.pagesContainerEl||!this.viewportEl||!this.container||t!=="slide")return;this.container.querySelectorAll(".page-transition-mask").forEach(o=>o.remove()),this.pagesContainerEl.classList.remove("page-transition-fade-out","page-transition-fade-in","page-transition-blur-out","page-transition-blur-in"),this.transitionTimeouts.forEach(o=>clearTimeout(o)),this.transitionTimeouts=[];let r=this.container.ownerDocument.createElement("div");r.className="page-transition-mask",this.container.appendChild(r),requestAnimationFrame(()=>{let o=this.writingMode==="vertical-rl"?"slide-horizontal":"slide-vertical";e&&(o+="-reverse"),r.classList.remove("slide-horizontal","slide-vertical","slide-horizontal-reverse","slide-vertical-reverse"),r.offsetWidth,r.classList.add(o);let s=()=>{r.removeEventListener("animationend",s),r.remove()};r.addEventListener("animationend",s)})}emitPageChange(){if(this.updateFixedHeaderFooterContent(),!this.onPageChange)return;let t=this.pageCount,e=this.getProgress();this.onPageChange({currentPage:t===0?0:this.pageIndex+1,totalPages:t,progress:e})}getPagePaddingValues(){var h,f;let l=Number((h=this.previewSettings.bookPaddingTop)!=null?h:44),c=Number((f=this.previewSettings.bookPaddingBottom)!=null?f:32),u=Number.isFinite(l)?Math.max(0,Math.min(200,l)):44,d=Number.isFinite(c)?Math.max(0,Math.min(200,c)):32;return{paddingTop:u,paddingBottom:d,paddingLeft:8,paddingRight:8}}buildStyles(){var h,f,p,m,g;let t=Math.max(1,(f=(h=this.viewportEl)==null?void 0:h.clientWidth)!=null?f:Math.round(this.container.getBoundingClientRect().width)),e=Math.max(1,(m=(p=this.viewportEl)==null?void 0:p.clientHeight)!=null?m:Math.round(this.container.getBoundingClientRect().height)),n=this.writingMode==="vertical-rl"?"vertical-rl":"horizontal-tb",r=(g=this.layoutLinePitchPx)!=null?g:this.getLinePitchPx(),o=r/Math.max(1,this.settings.fontSize),s=0,a=this.getPagePaddingValues(),l=a.paddingTop,c=a.paddingBottom,u=a.paddingLeft,d=a.paddingRight;return this.lastLayoutMetrics={width:t,height:e,paddingTop:l,paddingBottom:c,paddingLeft:u,paddingRight:d,columnGap:0,columnWidth:0,linePitch:r,snappedLineHeight:o},`
.tategaki-reading-paged-container {
	--tategaki-reading-padding-top: ${l}px;
	--tategaki-reading-padding-bottom: ${c}px;
	--tategaki-reading-padding-left: ${u}px;
	--tategaki-reading-padding-right: ${d}px;
	--tategaki-viewport-height: ${e}px;
	--tategaki-reading-page-width: ${t}px;
	--tategaki-reading-page-gap: ${this.getPageGapPx()}px;
	--tategaki-writing-mode: ${n};
}

.tategaki-reading-paged-header {
	top: ${s}px;
}

.tategaki-reading-paged-footer {
	bottom: ${s}px;
}

/* \u30D8\u30C3\u30C0\u30FC/\u30D5\u30C3\u30BF\u30FC\u80CC\u666F\u30DE\u30B9\u30AF */
.tategaki-reading-paged-mask {
	position: absolute;
	left: 0;
	right: 0;
	background: var(--tategaki-background-color, var(--background-primary));
	pointer-events: none;
	z-index: 15;
}

.tategaki-reading-paged-mask.top {
	top: 0;
	height: var(--tategaki-reading-padding-top);
}

.tategaki-reading-paged-mask.bottom {
	bottom: 0;
	height: var(--tategaki-reading-padding-bottom);
}

/* \u30D8\u30C3\u30C0\u30FC/\u30D5\u30C3\u30BF\u30FC\uFF08\u56FA\u5B9A\uFF09 */
.tategaki-reading-paged-header,
.tategaki-reading-paged-footer {
	position: absolute;
	left: 0;
	right: 0;
	height: 24px;
	display: flex;
	align-items: center;
	padding: 0 16px;
	box-sizing: border-box;
	font-size: 12px;
	color: var(--tategaki-text-color, var(--text-muted));
	background: var(--tategaki-background-color, var(--background-primary));
	opacity: 0.7;
	writing-mode: horizontal-tb !important;
	text-orientation: mixed !important;
	pointer-events: none;
	z-index: 16;
}

.tategaki-reading-paged-header.align-left,
.tategaki-reading-paged-footer.align-left {
	justify-content: flex-start;
}

.tategaki-reading-paged-header.align-center,
.tategaki-reading-paged-footer.align-center {
	justify-content: center;
}

.tategaki-reading-paged-header.align-right,
.tategaki-reading-paged-footer.align-right {
	justify-content: flex-end;
}
`}getHeaderFooterContent(t,e,n){switch(t){case"title":return this.title;case"pageNumber":return this.formatPageNumber(e,n);case"none":default:return""}}formatPageNumber(t,e){var r;return((r=this.previewSettings.pageNumberFormat)!=null?r:"currentTotal")==="current"?`${t}`:`${t} / ${e}`}ensureFixedHeaderFooterElements(){var s,a,l,c,u,d;let t=this.container.ownerDocument,e=(s=this.previewSettings.headerContent)!=null?s:"none",n=(a=this.previewSettings.footerContent)!=null?a:"pageNumber",r=(l=this.previewSettings.headerAlign)!=null?l:"center",o=(c=this.previewSettings.footerAlign)!=null?c:"center";this.headerMaskEl||(this.headerMaskEl=t.createElement("div"),this.headerMaskEl.className="tategaki-reading-paged-mask top",this.container.appendChild(this.headerMaskEl)),this.footerMaskEl||(this.footerMaskEl=t.createElement("div"),this.footerMaskEl.className="tategaki-reading-paged-mask bottom",this.container.appendChild(this.footerMaskEl)),e==="none"?((u=this.headerEl)==null||u.remove(),this.headerEl=null):this.headerEl||(this.headerEl=t.createElement("div"),this.container.appendChild(this.headerEl)),this.headerEl&&(this.headerEl.className=`tategaki-reading-paged-header align-${r}`),n==="none"?((d=this.footerEl)==null||d.remove(),this.footerEl=null):this.footerEl||(this.footerEl=t.createElement("div"),this.container.appendChild(this.footerEl)),this.footerEl&&(this.footerEl.className=`tategaki-reading-paged-footer align-${o}`)}updateFixedHeaderFooterContent(){var n,r;let t=this.pageCount,e=t===0?0:this.pageIndex+1;if(this.ensureFixedHeaderFooterElements(),this.headerEl){let o=(n=this.previewSettings.headerContent)!=null?n:"none";this.headerEl.textContent=this.getHeaderFooterContent(o,e,t)}if(this.footerEl){let o=(r=this.previewSettings.footerContent)!=null?r:"pageNumber";this.footerEl.textContent=this.getHeaderFooterContent(o,e,t)}}async render(){if(this.isRendering){this.pendingRender=!0;return}this.isRendering=!0;let t=this.getViewportSize(),e=this.renderToken+=1;try{if(this.destroyed||!this.pagesContainerEl||!this.styleEl||!this.container.isConnected)return;let n=this.buildStyles();if(this.styleEl.textContent=n,e!==this.renderToken||this.destroyed||(await new Promise(r=>requestAnimationFrame(r)),e!==this.renderToken||this.destroyed)||(await new Promise(r=>requestAnimationFrame(r)),e!==this.renderToken||this.destroyed)||(await new Promise(r=>setTimeout(r,50)),e!==this.renderToken||this.destroyed)||(await this.splitContentIntoPages(e),e!==this.renderToken||this.destroyed))return;if(this.recalculatePageCount(),this.pageIndex>=this.pageCount&&(this.pageIndex=Math.max(0,this.pageCount-1)),this.scrollToCurrentPage(!1),this.lastViewportSize=t,this.hasRenderedOnce=!0,this.emitPageChange(),this.logLayoutMetrics(),this.onRendered)try{this.onRendered({pages:this.pageElements})}catch(r){}}finally{this.isRendering=!1;let n=this.getViewportSize(),r=!this.lastViewportSize||this.lastViewportSize.width!==n.width||this.lastViewportSize.height!==n.height;this.pendingRender&&!this.destroyed&&r?(this.pendingRender=!1,this.pendingViewportSize=null,this.render()):(this.pendingRender=!1,this.pendingViewportSize=null)}}getViewportSize(){var n,r,o,s;let t=Math.max(1,(r=(n=this.viewportEl)==null?void 0:n.clientWidth)!=null?r:0),e=Math.max(1,(s=(o=this.viewportEl)==null?void 0:o.clientHeight)!=null?s:0);return{width:t,height:e}}async splitContentIntoPages(t){let e=this.pagesContainerEl,n=this.viewportEl;if(!e||!n){console.error("[Tategaki] Missing container elements:",{pagesContainerEl:!!this.pagesContainerEl,viewportEl:!!this.viewportEl});return}this.activePagination&&(this.activePagination.cancel(),this.activePagination=null),this.paginationInProgress=!0,this.pageElements.forEach(d=>d.remove()),this.pageElements=[],e.textContent="";let r=Math.max(1,n.clientWidth),o=Math.max(1,n.clientHeight),s=this.getPagePaddingValues(),a=[],l=0,c=(d=!1)=>{var p,m,g,b;if(this.destroyed||t!==this.renderToken)return;this.pageElements=a,this.pageCount=Math.max(1,a.length);let h=Math.max(0,this.pageCount-1);if(this.pendingPageIndex!==null&&this.pendingPageIndex<=h){let v=this.pendingPageIndex;if(this.pendingPageIndex=null,v!==this.pageIndex){let y=v<this.pageIndex;this.pageIndex=v,this.scrollToCurrentPage(!1,y)}}else this.pageIndex>h&&(this.pageIndex=h);let f=(b=(g=(m=(p=this.container.ownerDocument.defaultView)==null?void 0:p.performance)==null?void 0:m.now)==null?void 0:g.call(m))!=null?b:Date.now();(d||f-l>120)&&(this.emitPageChange(),l=f)},u=new hl({container:e,contentHtml:this.contentHtml,writingMode:this.writingMode==="vertical-rl"?"vertical-rl":"horizontal-tb",pageWidth:r,pageHeight:o,paddingTop:s.paddingTop,paddingBottom:s.paddingBottom,paddingLeft:s.paddingLeft,paddingRight:s.paddingRight,timeSliceMs:12,onPage:d=>{if(this.destroyed||t!==this.renderToken){d.element.remove();return}let h=a.length;if(d.element.setAttribute("data-page",h.toString()),a.push(d.element),this.onPageAdded)try{this.onPageAdded(d.element,h)}catch(f){}c(a.length===1)},onProgress:(d,h)=>{}});this.activePagination=u;try{let d=await u.paginate();if(this.destroyed||t!==this.renderToken){d.forEach(h=>h.element.remove()),this.pageElements.forEach(h=>h.remove()),this.pageElements=[];return}if(!this.pagesContainerEl||!this.viewportEl){d.forEach(h=>h.element.remove()),this.pageElements.forEach(h=>h.remove()),this.pageElements=[];return}this.pageElements=a.length?a:d.map((h,f)=>(h.element.setAttribute("data-page",f.toString()),h.element))}catch(d){if(this.destroyed||t!==this.renderToken||(console.error("[Tategaki] Pagination failed:",d),!e))return;let h=this.createPageElement(0),f=h.querySelector(".page-content");f&&(f.innerHTML=this.contentHtml),e.appendChild(h),this.pageElements.push(h)}finally{if(this.paginationInProgress=!1,this.pendingPageIndex!==null){let d=Math.max(0,this.pageCount-1),h=Math.max(0,Math.min(this.pendingPageIndex,d));if(this.pendingPageIndex=null,h!==this.pageIndex){let f=h<this.pageIndex;this.pageIndex=h,this.scrollToCurrentPage(!1,f),this.emitPageChange()}}else this.pageIndex>=this.pageCount&&(this.pageIndex=Math.max(0,this.pageCount-1),this.emitPageChange());this.activePagination===u&&(this.activePagination=null)}}createPageElement(t){let e=this.container.ownerDocument,n=e.createElement("div");n.className="tategaki-page",n.setAttribute("data-page",t.toString());let r=e.createElement("div");return r.className="page-content",n.appendChild(r),n}recalculatePageCount(){this.pageCount=Math.max(1,this.pageElements.length)}getPageGapPx(){return 24}getLinePitchPx(){let e=Math.max(1,this.settings.fontSize)*this.settings.lineHeight;return Math.max(1,this.snapToDevicePixel(e))}snapToDevicePixel(t){var n,r,o;let e=(o=(r=(n=this.container.ownerDocument)==null?void 0:n.defaultView)==null?void 0:r.devicePixelRatio)!=null?o:1;return Math.round(t*e)/e}snapToLineGrid(t,e){if(!Number.isFinite(t)||!Number.isFinite(e))return Math.max(1,t);let n=Math.max(1,t),r=Math.max(1,e),o=Math.max(1,Math.floor(n/r));return Math.min(n,o*r)}getRenderStridePx(){if(!this.lastLayoutMetrics)return null;let{height:t}=this.lastLayoutMetrics,e=this.getPageGapPx(),n=t+e;return!Number.isFinite(n)||n<=0?null:n}updateSnappedLineHeightFromComputed(){let t=this.measureComputedLineMetrics();if(!t)return!1;let e=this.snapToDevicePixel(t.lineHeightPx),n=e/Math.max(1,t.fontSizePx),r=parseFloat(this.container.style.getPropertyValue("--tategaki-line-height"))||this.settings.lineHeight;return this.lastLineMetrics={fontSizePx:t.fontSizePx,lineHeightPx:t.lineHeightPx,usedProbe:t.usedProbe,snappedLineHeight:n},this.layoutLinePitchPx=e,Math.abs(r-n)<.001?!1:(this.container.style.setProperty("--tategaki-line-height",n.toString()),!0)}measureComputedLineMetrics(){let t=this.pageElements[0];if(!t)return null;let e=getComputedStyle(t),n=parseFloat(e.fontSize),r=parseFloat(e.lineHeight),o=!1;if(!Number.isFinite(r)||r<=0){let s=this.measureLineHeightWithProbe(t);s>0&&(r=s,o=!0)}return!Number.isFinite(n)||n<=0||!Number.isFinite(r)||r<=0?null:{fontSizePx:n,lineHeightPx:r,usedProbe:o}}measureLineHeightWithProbe(t){let n=t.ownerDocument.createElement("div");n.style.cssText=["position:absolute","visibility:hidden","pointer-events:none","padding:0","margin:0","border:0","white-space:pre","font:inherit","line-height:inherit","writing-mode:inherit","text-orientation:inherit"].join(";"),n.textContent=`\u3042
\u3042`,t.appendChild(n);let r=n.getBoundingClientRect();n.textContent="\u3042";let o=n.getBoundingClientRect();n.remove();let s=this.writingMode==="vertical-rl",a=s?r.width:r.height,l=s?o.width:o.height,c=a-l;return Number.isFinite(c)?c:0}logLayoutMetrics(){var s;if(!this.debugLayout||!this.viewportEl||!this.lastLayoutMetrics)return;let t=this.viewportEl.clientWidth,e=this.viewportEl.clientHeight,n=this.viewportEl.scrollHeight,r=this.getPageGapPx(),o=(s=this.getRenderStridePx())!=null?s:cE(e,r);console.debug("[Tategaki] layout metrics",{viewportWidth:t,viewportHeight:e,viewportScrollHeight:n,pageGap:r,stride:o,lastLayoutMetrics:this.lastLayoutMetrics})}};var pl=require("obsidian"),Nr=class extends pl.FuzzySuggestModal{constructor(e,n,r,o){super(e);this.footerEl=null;this.files=n,this.onSelect=r,this.onCreateNew=o!=null?o:null,this.setPlaceholder("\u5207\u308A\u66FF\u3048\u308B\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E")}onOpen(){super.onOpen(),this.onCreateNew&&(this.footerEl&&(this.footerEl.remove(),this.footerEl=null),this.footerEl=this.modalEl.createDiv("tategaki-file-switch-footer"),this.footerEl.style.cssText=`
			display: flex;
			justify-content: flex-end;
			padding-top: 8px;
			border-top: 1px solid var(--background-modifier-border);
			margin-top: 8px;
		`,new pl.ButtonComponent(this.footerEl).setButtonText("\u65B0\u898F\u30CE\u30FC\u30C8\u3092\u4F5C\u6210").setClass("mod-cta").onClick(()=>{var n,r,o;let e=(r=(n=this.inputEl)==null?void 0:n.value)!=null?r:"";this.close(),(o=this.onCreateNew)==null||o.call(this,e)}))}onClose(){this.footerEl&&(this.footerEl.remove(),this.footerEl=null)}getItems(){return this.files}getItemText(e){return e.path}onChooseItem(e,n){this.onSelect(e)}};var Vn=require("obsidian"),Pr=class extends Vn.Modal{constructor(e,n,r){var o,s;super(e);this.input=null;this.onSubmit=r,this.defaultFolder=(o=n.defaultFolder)!=null?o:null,this.initialValue=(s=n.initialValue)!=null?s:""}onOpen(){let{contentEl:e}=this;e.empty(),this.titleEl.setText("\u65B0\u898F\u30CE\u30FC\u30C8\u3092\u4F5C\u6210");let n=e.createDiv();if(n.style.cssText="margin-bottom: 8px; color: var(--text-muted);",n.setText("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF08.md \u306F\u7701\u7565\u53EF\uFF09"),this.defaultFolder!==null){let s=e.createDiv();s.style.cssText="margin-bottom: 12px; color: var(--text-muted); font-size: 12px;",s.setText(`\u4F5C\u6210\u5148: ${this.defaultFolder||"/"}`)}let r=e.createDiv();r.style.cssText="margin-bottom: 12px;",this.input=new Vn.TextComponent(r),this.input.inputEl.style.cssText="width: 100%; box-sizing: border-box;",this.input.setPlaceholder("\u65B0\u898F\u30CE\u30FC\u30C8\u540D"),this.initialValue&&this.input.setValue(this.initialValue);let o=e.createDiv();o.style.cssText=`
			display: flex;
			gap: 8px;
			justify-content: flex-end;
			padding-top: 8px;
			border-top: 1px solid var(--background-modifier-border);
		`,new Vn.ButtonComponent(o).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>this.close()),new Vn.ButtonComponent(o).setButtonText("\u4F5C\u6210").setClass("mod-cta").onClick(()=>this.submit()),this.input.inputEl.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),this.submit())}),window.setTimeout(()=>{var s,a;(s=this.input)==null||s.inputEl.focus(),(a=this.input)==null||a.inputEl.select()},0)}submit(){var n,r;let e=(r=(n=this.input)==null?void 0:n.getValue().trim())!=null?r:"";if(!e){new Vn.Notice("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2e3);return}this.close(),this.onSubmit(e)}};var Eh=require("obsidian"),xh="(hover: none) and (pointer: coarse) and (max-width: 700px)";function fl(i){let t=i!=null?i:typeof window!="undefined"?window:null;if(!t)return!1;try{if(t.matchMedia(xh).matches)return!0}catch(n){}if(!(Eh.Platform.isMobile||Eh.Platform.isMobileApp))return!1;let e=Math.min(Math.abs(t.innerWidth||0),Math.abs(t.innerHeight||0));return e>0&&e<=700}var st="tategaki-tiptap-compat-view",qt="tategaki-tiptap-dev-view",uE="__tategakiInitialFile",kN="__tategakiInitialViewMode",dE="\u200B\u200C\u200D";function wN(i,t){let e=Math.max(0,Math.min(t,i.length));return i.slice(0,e)+dE+i.slice(e)}function MN(i,t){var s,a,l,c;let e=t.split(`
`),n=Math.max(0,Math.min(i.line,e.length-1)),r=Math.max(0,i.ch),o=0;for(let u=0;u<n;u++)o+=((a=(s=e[u])==null?void 0:s.length)!=null?a:0)+1;return o+=Math.min(r,(c=(l=e[n])==null?void 0:l.length)!=null?c:0),Math.max(0,Math.min(o,t.length))}var Sh=class extends de.ItemView{constructor(e,n,r=null){super(e);this.currentFile=null;this.readingModeActive=!1;this.readingModePager=null;this.readingModeContainerEl=null;this.readingModeLayoutBackup=null;this.proseMirrorBeforeReadingStyle=null;this.editor=null;this.syncManager=null;this.markdownAdapter=null;this.isComposing=!1;this.compositionStartHandler=null;this.compositionEndHandler=null;this.editorHostEl=null;this.editorPaddingTopPx=0;this.editorPaddingBottomPx=0;this.frontmatterContainer=null;this.keyHandler=null;this.formattingToolbar=null;this.contextMenu=null;this.contextMenuHandler=null;this.searchReplacePanel=null;this.plainEditMode=null;this.editorAreaEl=null;this.boundWheelHandler=null;this.wheelThrottleTimer=null;this.cursorSyncTimer=null;this.cursorSyncDebounceTimer=null;this.pendingExternalCursor=null;this.lastExternalCursor=null;this.fileUpdateDebounceTimer=null;this.recentFilePaths=[];this.recentFilePathsInitialized=!1;this.modeBadgeEl=null;this.initialScrollApplied=!1;this.frontmatterUpdateToken=0;this.plainEditAutoPaused=!1;this.beforeInputHandler=null;this.beforeInputKeydownHandler=null;this.lastEnterKeydownAt=0;this.lastEnterKeydownShift=!1;this.updateDebounceTimer=null;this.pendingUpdate=!1;this.UPDATE_DEBOUNCE_MS=180;this.cursorSyncPausedByFocus=!1;this.cursorSyncPausedByAuxiliary=!1;this.cursorFocusInHandler=null;this.cursorFocusOutHandler=null;this.cursorPointerDownHandler=null;this.cursorGlobalPointerDownHandler=null;this.lastPointerDownInsideViewAt=0;this.lastPointerDownInsideLeafAt=0;this.lastAppliedSettings=null;this.lastSyncState=null;this.auxiliaryInputPanel=null;this.auxiliaryCaretEl=null;this.lastAuxiliaryRange=null;this.lastAuxiliaryPos=null;this.scrollHandlerForAuxiliaryCaret=null;this.outlinePanelEl=null;this.outlineUpdateTimer=null;this.pageContainerEl=null;this.borderWrapperEl=null;this.contentWrapperEl=null;this.viewRootEl=null;this.visualViewportResizeHandler=null;this.editorFocusHandler=null;this.selectionUpdateHandler=null;this.selectionUpdateTimer=null;this.lastViewportHeight=0;this.lastViewportOffsetTop=0;this.lastViewportOffsetLeft=0;this.viewportResizeTimer=null;this.isReadOnlyProtected=!1;this.readOnlyProtectionReason=null;this.unsupportedHtmlDecisions=new Map;this.unsupportedHtmlBackedUp=new Set;this.unsupportedHtmlCancelState=new Map;this.unsupportedHtmlPromptInFlight=new Map;this.suppressEditorUpdates=!1;this.listItemMoveCaptureHandler=null;this.plugin=n,this.viewTypeOverride=r}getViewType(){var e;return(e=this.viewTypeOverride)!=null?e:st}getDisplayText(){var r;let e=this.getDisplayFile(),n=(r=this.getFrontmatterTitle(e))!=null?r:e?e.basename:"";return n?`Tategaki: - ${n} -`:"Tategaki"}updatePaneHeaderTitle(){let e=this.getDisplayText(),n=this.containerEl.querySelector(".view-header-title");n&&(n.textContent=e)}ensureRecentFilePathsInitialized(){if(this.recentFilePathsInitialized)return;this.recentFilePathsInitialized=!0;let e=this.app.workspace.getLastOpenFiles();for(let n of e){let r=this.app.vault.getAbstractFileByPath(n);r instanceof de.TFile&&r.extension==="md"&&this.pushRecentFilePath(r.path,!1)}}pushRecentFilePath(e,n=!0){let r=e.trim();if(!r)return;let o=this.recentFilePaths.indexOf(r);o===0&&n||(o>=0&&this.recentFilePaths.splice(o,1),n?this.recentFilePaths.unshift(r):this.recentFilePaths.push(r),this.recentFilePaths.length>20&&(this.recentFilePaths.length=20))}recordRecentFile(e){e&&e.extension==="md"&&(this.ensureRecentFilePathsInitialized(),this.pushRecentFilePath(e.path,!0))}buildFileSwitchItems(){let e=this.app.vault.getMarkdownFiles();if(e.length===0)return[];this.ensureRecentFilePathsInitialized();let n=new Map;for(let s of e)n.set(s.path,s);let r=[],o=new Set;for(let s of this.recentFilePaths){let a=n.get(s);a&&(r.push(a),o.add(s))}for(let s of e)o.has(s.path)||r.push(s);return r}openFileSwitcher(){let e=this.buildFileSwitchItems();new Nr(this.app,e,r=>void this.switchToFile(r),r=>this.openNewNoteModal(r)).open(),e.length===0&&new de.Notice("\u5207\u308A\u66FF\u3048\u53EF\u80FD\u306A\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2e3)}openNewNoteModal(e=""){var o,s,a;let n=(a=(s=(o=this.currentFile)==null?void 0:o.parent)==null?void 0:s.path)!=null?a:"";new Pr(this.app,{defaultFolder:n,initialValue:e},l=>void this.createNewNote(l,n)).open()}async createNewNote(e,n){let r=e.trim();if(!r){new de.Notice("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2e3);return}let o=r.replace(/^[\\/]+/,"").replace(/^\.\//,""),a=o.toLowerCase().endsWith(".md")?o:`${o}.md`,l=n?`${n}/${a}`:a,c=(0,de.normalizePath)(l),u=this.app.vault.getAbstractFileByPath(c);if(u instanceof de.TFile){new de.Notice("\u65E2\u5B58\u30CE\u30FC\u30C8\u3092\u958B\u304D\u307E\u3059\u3002",2e3),await this.switchToFile(u);return}let d=c.split("/").slice(0,-1).join("/");if(d){let h=this.app.vault.getAbstractFileByPath(d);if(h){if(!(h instanceof de.TFolder)){new de.Notice("\u30D5\u30A9\u30EB\u30C0\u540D\u304C\u4E0D\u6B63\u3067\u3059\u3002",2500);return}}else try{await this.app.vault.createFolder(d)}catch(f){console.error("[Tategaki TipTap] Failed to create folder",f),new de.Notice("\u30D5\u30A9\u30EB\u30C0\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500);return}}try{let h=await this.app.vault.create(c,"");await this.switchToFile(h)}catch(h){console.error("[Tategaki TipTap] Failed to create note",h),new de.Notice("\u65B0\u898F\u30CE\u30FC\u30C8\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}async switchToFile(e){var r;if(!this.syncManager)return;if(((r=this.currentFile)==null?void 0:r.path)===e.path){new de.Notice("\u65E2\u306B\u8868\u793A\u4E2D\u306E\u30D5\u30A1\u30A4\u30EB\u3067\u3059\u3002",1500);return}await this.checkUnsavedChanges()&&(this.initialScrollApplied=!1,await this.loadFile(e),this.currentFile=e,this.recordRecentFile(e),this.updatePaneHeaderTitle())}getDisplayFile(){var r,o;if(this.currentFile)return this.currentFile;let e=this.getCurrentFilePath();if(e){let s=this.app.vault.getAbstractFileByPath(e);if(s instanceof de.TFile)return s}let n=(o=(r=this.app.workspace).getActiveFile)==null?void 0:o.call(r);return n!=null?n:null}getFrontmatterTitle(e){var s;if(!e)return null;let n=this.app.metadataCache.getFileCache(e),r=(s=n==null?void 0:n.frontmatter)==null?void 0:s.title;if(r==null)return null;let o=String(r).trim();return o.length>0?o:null}async onOpen(){let e=this.leaf[uE];if(!e){window.setTimeout(()=>{try{this.leaf.detach()}catch(h){}},0);return}delete this.leaf[uE],this.currentFile=e,delete this.leaf[kN];let n=this.containerEl.children[1];this.viewRootEl=n,n.empty(),n.style.cssText=`
				position: relative;
				width: 100%;
				height: 100%;
				display: flex;
				flex-direction: column;
				min-height: 0;
				overflow: hidden;
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			`;let r="(hover: none) and (pointer: coarse) and (max-width: 700px)",o=()=>{let h=this.containerEl.querySelector(".view-header"),f=h?Math.ceil(h.getBoundingClientRect().height):0;n.style.setProperty("--tategaki-view-header-height",`${f}px`);let p=window.matchMedia(r).matches;n.style.paddingTop=p?"calc(var(--tategaki-safe-area-top, 0px) + var(--tategaki-view-header-height, 0px))":"0px";let m=!1,g=n.ownerDocument.activeElement;g&&n.contains(g)&&(m=g.isContentEditable||g.tagName==="TEXTAREA"||g.tagName==="INPUT"),n.style.paddingBottom=p&&!m?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};o(),window.setTimeout(o,0),this.registerDomEvent(window,"resize",o),this.registerDomEvent(n.ownerDocument,"focusin",o),this.registerDomEvent(n.ownerDocument,"focusout",o);let s=this.containerEl.querySelector(".view-header");if(s&&"ResizeObserver"in window){let h=new ResizeObserver(()=>{o()});h.observe(s),this.register(()=>h.disconnect())}let a=n.createDiv("tategaki-tiptap-compat-toolbar-row");a.style.cssText=`
				display: flex;
				align-items: center;
				gap: 8px;
				flex: 0 0 auto;
				padding: 0;
				background: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
			`;let l=a.createDiv();l.style.cssText=`
			display: flex;
			align-items: center;
			flex: 1;
			min-width: 0;
		`;let c=a.createDiv();c.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 0 8px;
			flex-shrink: 0;
		`;let u=c.createDiv();u.textContent="\u4E92\u63DB",u.style.cssText=`
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 2px 8px;
			border-radius: 999px;
			background: var(--background-modifier-hover);
			border: 1px solid var(--background-modifier-border);
			color: var(--text-normal);
			font-size: 11px;
			white-space: nowrap;
		`,this.modeBadgeEl=u;let d=n.createDiv("tategaki-tiptap-compat-editor-area");d.style.cssText=`
				position: relative;
				flex: 1 1 auto;
				min-height: 0;
				width: 100%;
				overflow: hidden;
				display: flex;
			`,this.editorAreaEl=d,this.pageContainerEl=d.createDiv("tategaki-tiptap-page-container"),this.pageContainerEl.style.cssText=`
				flex: 1 1 auto;
				min-width: 0;
				min-height: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				box-sizing: border-box;
				overflow: visible;
				padding: 40px 32px 22px 32px;
				background: transparent;
			`,this.borderWrapperEl=this.pageContainerEl.createDiv("tategaki-tiptap-border-wrapper"),this.borderWrapperEl.style.cssText=`
				position: relative;
				width: 100%;
				height: 100%;
				min-width: 0;
				min-height: 0;
				border: none !important;
				outline: none !important;
				border-radius: 0;
				background: ${this.plugin.settings.common.backgroundColor} !important;
				box-shadow: 0 6px 12px rgba(0,0,0,0.4);
			box-sizing: border-box;
			overflow: hidden;
			transform-origin: center center;
			transform: scale(1);
		`,this.contentWrapperEl=this.borderWrapperEl.createDiv("tategaki-tiptap-content-wrapper"),this.contentWrapperEl.style.cssText=`
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: ${this.plugin.settings.common.backgroundColor};
			color: var(--text-normal);
			display: flex;
			flex-direction: column;
			overflow: hidden;
			border: none !important;
			outline: none !important;
		`,this.editorHostEl=this.contentWrapperEl.createDiv("tategaki-tiptap-compat-editor-host"),this.editorHostEl.style.cssText=`
				flex: 1 1 auto;
				min-width: 0;
				min-height: 0;
				width: 100%;
				position: relative;
				overflow: auto;
				box-sizing: border-box;
				scrollbar-gutter: stable;
			`,this.suppressEditorUpdates=!0,this.editor=Ud({element:this.editorHostEl,settings:this.plugin.settings,onUpdate:()=>{this.handleEditorContentUpdate()}}),this.setupCursorSyncFocusGuards(),this.setupCompositionGuards(),this.setupMobileKeyboardSupport(),this.formattingToolbar=new Wa(l,this.editor,this.app,{app:this.app,onToggleWritingMode:()=>this.toggleWritingMode(),getWritingMode:()=>this.plugin.settings.common.writingMode,onToggleReadingMode:()=>this.toggleReadingMode(),getReadingModeEnabled:()=>this.isReadingViewOpenForCurrentFile(),onSettings:()=>this.openSettingsPanel(),onFindReplace:h=>{var f;return(f=this.searchReplacePanel)==null?void 0:f.show(h!=null?h:!0)},onManualSync:()=>void this.requestManualSync(),onToggleSyncMode:()=>void this.toggleSyncMode(),onToggleRuby:()=>void this.toggleRubyVisibility(),getRubyEnabled:()=>this.plugin.settings.wysiwyg.enableRuby!==!1,onToggleAuxiliary:()=>void this.toggleAuxiliaryPanel(),getAuxiliaryEnabled:()=>!!this.plugin.settings.wysiwyg.enableAssistantInput,onToggleOutline:()=>this.toggleOutlinePanel(),onPlainEditCommand:h=>{var f,p;return(p=(f=this.plainEditMode)==null?void 0:f.applyInlineCommand(h))!=null?p:!1},getPlainEditSelectionText:()=>{var h,f;return(f=(h=this.plainEditMode)==null?void 0:h.getSelectionText())!=null?f:""},onOpenFileSwitcher:()=>this.openFileSwitcher(),onTogglePlainEdit:()=>void this.togglePlainEditMode(),getPlainEditEnabled:()=>{var h,f;return(f=(h=this.plainEditMode)==null?void 0:h.isPlainMode())!=null?f:!1}}),this.registerEvent(this.app.workspace.on("layout-change",()=>{var h;(h=this.formattingToolbar)==null||h.updateReadingModeButton()})),this.updatePaneHeaderTitle(),this.searchReplacePanel=new qa(d,this.editor,()=>{this.handleEditorContentUpdate()}),this.plainEditMode=new cl({editor:this.editor,getRubyEnabled:()=>{var h;return((h=this.plugin.settings.wysiwyg)==null?void 0:h.enableRuby)!==!1},getViewRoot:()=>this.viewRootEl,onModeChange:()=>{var h;(h=this.formattingToolbar)==null||h.updatePlainEditButton()},onUpdate:()=>{},onCommit:()=>{this.flushPendingEditorUpdate()}}),this.contextMenu=new Ua(this.editor,{app:this.app,onFindReplace:()=>{var h;(h=this.searchReplacePanel)==null||h.show(!0)},onTogglePlainEdit:()=>void this.togglePlainEditMode(),getPlainEditEnabled:()=>{var h,f;return(f=(h=this.plainEditMode)==null?void 0:h.isPlainMode())!=null?f:!1},isReadOnly:()=>this.isEditorReadOnly(),onPlainEditCommand:h=>{var f,p;return(p=(f=this.plainEditMode)==null?void 0:f.applyInlineCommand(h))!=null?p:!1},getPlainEditSelectionText:()=>{var h,f;return(f=(h=this.plainEditMode)==null?void 0:h.getSelectionText())!=null?f:""},getRubyEnabled:()=>this.plugin.settings.wysiwyg.enableRuby!==!1}),this.contextMenuHandler=h=>{var g,b,v,y,E;if(!this.contextMenu||!this.editor)return;let f=(b=(g=this.editorHostEl)==null?void 0:g.ownerDocument.defaultView)!=null?b:window;if(fl(f)){h.preventDefault(),h.stopPropagation();return}let p=(y=(v=this.plainEditMode)==null?void 0:v.isPlainMode())!=null?y:!1,m=p&&((E=this.plainEditMode)==null?void 0:E.isOverlayTarget(h.target));!p&&!m&&this.editor.commands.focus(),this.contextMenu.show(h)},this.editorHostEl.addEventListener("contextmenu",this.contextMenuHandler),this.applySettingsToEditor(this.plugin.settings),this.suppressEditorUpdates=!1,this.setupWheelScroll(),this.setupBeforeInputFixes(),this.updateReadOnlyState(),this.markdownAdapter=eE(this.editor,{getSettings:()=>this.plugin.settings,getContextFilePath:()=>{var h,f,p,m;return(m=(p=(h=this.syncManager)==null?void 0:h.getState().currentFilePath)!=null?p:(f=this.currentFile)==null?void 0:f.path)!=null?m:null},resolveImageSrc:(h,f)=>{var v;let p=String(h||"").trim();if(!p||/^(https?:|data:|app:|obsidian:|file:)/i.test(p))return p;let g=((v=p.split("#")[0])!=null?v:p).replace(/^\.\//,"");if(!f)return p;let b=this.app.metadataCache.getFirstLinkpathDest(g,f);if(!b)return p;try{return this.app.vault.getResourcePath(b)}catch(y){return p}}}),this.syncManager=new Yr({app:this.app,editor:this.markdownAdapter,getSettings:()=>this.plugin.settings,onStateChange:h=>this.handleSyncStateChange(h),onBeforeApplyMarkdown:(h,f)=>this.handleBeforeApplyMarkdown(h,f.file,f.source)}),this.registerFileWatchers(),this.registerEditorChangeWatchers(),await this.syncManager.initialize(e),this.recordRecentFile(e),this.registerEvent(this.app.workspace.on("file-open",h=>{this.recordRecentFile(h)})),this.applyCursorSyncSetting(this.plugin.settings),this.applyInitialScrollPosition(),this.updateRubyPluginState(this.plugin.settings),await this.updateFrontmatterDisplay(),this.initializeAuxiliaryInput(),this.handleSyncStateChange(this.syncManager.getState()),this.originalDetach=this.leaf.detach.bind(this.leaf),this.leaf.detach=async()=>{if(this.isReadOnlyProtected){this.originalDetach&&this.originalDetach();return}if(this.syncManager&&this.syncManager.hasUnsavedChanges()&&this.plugin.settings.wysiwyg.syncMode==="manual"){let f=await new tr(this.app,"\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002\u30BF\u30D6\u3092\u9589\u3058\u308B\u524D\u306B\u4FDD\u5B58\u3057\u307E\u3059\u304B\uFF1F").waitForChoice();if(f==="save")await this.syncManager.triggerManualSync();else if(f==="discard")this.syncManager.clearDirtyFlag();else if(f==="cancel")return}this.originalDetach&&this.originalDetach()},this.keyHandler=h=>{var p,m,g;if(!(h.metaKey||h.ctrlKey))return;let f=h.key.toLowerCase();if(f==="s"){if(!h.shiftKey)return;h.preventDefault(),h.stopPropagation(),(p=this.syncManager)==null||p.triggerManualSync();return}if(f==="f"){h.preventDefault(),h.stopPropagation(),(m=this.searchReplacePanel)==null||m.show(!1);return}if(f==="h"){h.preventDefault(),h.stopPropagation(),(g=this.searchReplacePanel)==null||g.show(!0);return}},n.addEventListener("keydown",this.keyHandler,!0),this.setupListItemMoveCaptureHandler()}async onClose(){this.disableReadingMode(),this.teardownListItemMoveCaptureHandler();let e=this.containerEl.children[1];this.keyHandler&&(e.removeEventListener("keydown",this.keyHandler,!0),this.keyHandler=null),this.stopCursorSync(),this.teardownBeforeInputFixes(),this.teardownCompositionGuards(),this.teardownCursorSyncFocusGuards(),this.teardownMobileKeyboardSupport(),this.fileUpdateDebounceTimer!=null&&(window.clearTimeout(this.fileUpdateDebounceTimer),this.fileUpdateDebounceTimer=null),this.teardownWheelScroll(),this.formattingToolbar&&(this.formattingToolbar.destroy(),this.formattingToolbar=null),this.searchReplacePanel&&(this.searchReplacePanel.destroy(),this.searchReplacePanel=null),this.plainEditMode&&(this.plainEditMode.destroy(),this.plainEditMode=null),this.auxiliaryInputPanel&&(this.removeAuxiliaryPanelPadding(),this.auxiliaryInputPanel.destroy(),this.auxiliaryInputPanel=null),this.outlinePanelEl&&(this.outlinePanelEl.remove(),this.outlinePanelEl=null),this.updateDebounceTimer!=null&&(window.clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null,this.pendingUpdate=!1),this.outlineUpdateTimer!=null&&(window.clearTimeout(this.outlineUpdateTimer),this.outlineUpdateTimer=null),this.editorAreaEl=null,this.editorHostEl&&this.contextMenuHandler&&this.editorHostEl.removeEventListener("contextmenu",this.contextMenuHandler),this.contextMenuHandler=null,this.contextMenu&&(this.contextMenu.destroy(),this.contextMenu=null);let n=this.syncManager;if(this.syncManager=null,this.markdownAdapter=null,n){try{await n.flush()}catch(r){Ee("Tategaki TipTap: failed to flush on close",r)}n.dispose()}if(this.editor)try{this.editor.destroy()}finally{this.editor=null}this.clearAuxiliaryCaret(),this.detachScrollHandlerForAuxiliaryCaret(),this.frontmatterContainer&&(this.frontmatterContainer.remove(),this.frontmatterContainer=null),this.editorHostEl=null,this.viewRootEl=null,this.contentWrapperEl=null,this.borderWrapperEl=null,this.pageContainerEl=null,this.originalDetach&&(this.leaf.detach=this.originalDetach,this.originalDetach=void 0),this.currentFile=null}async updateSettings(e){var l;let n=this.lastAppliedSettings,r=n?n.preview.hideFrontmatter!==e.preview.hideFrontmatter||n.preview.showFrontmatterTitle!==e.preview.showFrontmatterTitle||n.preview.showFrontmatterSubtitle!==e.preview.showFrontmatterSubtitle||n.preview.showFrontmatterOriginalTitle!==e.preview.showFrontmatterOriginalTitle||n.preview.showFrontmatterAuthor!==e.preview.showFrontmatterAuthor||n.preview.showFrontmatterCoAuthors!==e.preview.showFrontmatterCoAuthors||n.preview.showFrontmatterTranslator!==e.preview.showFrontmatterTranslator||n.preview.showFrontmatterCoTranslators!==e.preview.showFrontmatterCoTranslators:!0,o=n?n.common.writingMode!==e.common.writingMode:!0,s=n?n.wysiwyg.enableRuby!==e.wysiwyg.enableRuby:!0,a=n?n.wysiwyg.enableAssistantInput!==e.wysiwyg.enableAssistantInput:!0;e.wysiwyg.enableAssistantInput&&(this.plainEditAutoPaused=!1,this.deactivatePlainEditMode()),this.applySettingsToEditor(e),this.setupWheelScroll(),(l=this.syncManager)==null||l.onSettingsChanged(e),this.applyCursorSyncSetting(e),this.updateReadOnlyState(),this.updateRubyPluginState(e),this.auxiliaryInputPanel&&o&&(this.auxiliaryInputPanel.updateLayout(e.common.writingMode==="vertical-rl"),this.addAuxiliaryPanelPadding()),this.formattingToolbar&&(o&&(this.formattingToolbar.updateWritingModeButton(),this.formattingToolbar.updateHorizontalRuleIcon()),a&&(this.initializeAuxiliaryInput(),this.formattingToolbar.updateAuxiliaryButton()),s&&(this.refreshRubyRendering(),this.formattingToolbar.refreshRubyToggle())),(r||o)&&await this.updateFrontmatterDisplay(),this.lastAppliedSettings=JSON.parse(JSON.stringify(e)),this.readingModeActive&&this.rebuildReadingMode()}toggleWritingMode(){let n=this.plugin.settings.common.writingMode==="vertical-rl"?"horizontal-tb":"vertical-rl";if(this.plugin.settings.common.writingMode=n,this.plugin.saveSettings(),this.applySettingsToEditor(this.plugin.settings),this.editor&&this.withSuppressedEditorUpdates(()=>{var r;(r=this.editor)==null||r.commands.setWritingMode(n)}),this.frontmatterContainer?this.applyFrontmatterWritingMode(this.frontmatterContainer,n):this.updateFrontmatterDisplay(),this.auxiliaryInputPanel&&(this.auxiliaryInputPanel.updateLayout(n==="vertical-rl"),this.addAuxiliaryPanelPadding(),this.auxiliaryInputPanel.textareaEl===document.activeElement)){let r=this.captureCurrentInsertionRange();this.renderAuxiliaryCaret(r)}this.readingModeActive&&this.rebuildReadingMode()}async togglePlainEditMode(){if(!this.plainEditMode)return;if(this.isEditorReadOnly()){new de.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u306F\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}this.plainEditAutoPaused=!1,this.plainEditMode.isPlainMode()?this.deactivatePlainEditMode():await this.activatePlainEditMode()}async activatePlainEditMode(){var n;return!this.plainEditMode||this.isEditorReadOnly()?!1:this.plainEditMode.isPlainMode()?!0:((n=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?n:!1)&&!await this.setAuxiliaryPanelEnabled(!1)?!1:(this.plainEditMode.activate(),this.applyCursorSyncSetting(this.plugin.settings),!0)}deactivatePlainEditMode(){var e;(e=this.plainEditMode)!=null&&e.isPlainMode()&&(this.plainEditMode.deactivate(),this.editor&&this.editor.commands.focus(),window.setTimeout(()=>{this.applyCursorSyncSetting(this.plugin.settings)},50))}async setAuxiliaryPanelEnabled(e){var r;if(((r=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?r:!1)===e)return!0;try{return await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableAssistantInput:e}}),await this.updateSettings(this.plugin.settings),!0}catch(o){return console.error("[Tategaki TipTap] Failed to toggle auxiliary panel",o),new de.Notice("\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500),!1}}handleSyncStateChange(e){var n;this.lastSyncState=e,(n=this.formattingToolbar)==null||n.updateSyncStatus(e)}openSettingsPanel(){new Tn(this.app,this.plugin,async n=>{await this.plugin.updateSettings(n)},{mode:"compat"}).open()}async toggleSyncMode(){var r,o,s,a,l;if(this.isReadOnlyProtected){new de.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u540C\u671F\u30E2\u30FC\u30C9\u306F\u5909\u66F4\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}let n=((r=this.plugin.settings.wysiwyg.syncMode)!=null?r:"auto")==="manual"?"auto":"manual";try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,syncMode:n,autoSave:n==="auto"}}),(o=this.syncManager)==null||o.onSettingsChanged(this.plugin.settings),this.handleSyncStateChange((l=(a=(s=this.syncManager)==null?void 0:s.getState())!=null?a:this.lastSyncState)!=null?l:{mode:n,dirty:!1,saving:!1,lastSavedAt:null,currentFilePath:this.getCurrentFilePath(),lastSyncResult:null,lastSyncMessage:null}),new de.Notice(n==="manual"?"\u624B\u52D5\u540C\u671F\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002":"\u81EA\u52D5\u540C\u671F\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002",2e3)}catch(c){console.error("[Tategaki TipTap] Failed to toggle sync mode",c),new de.Notice("\u540C\u671F\u30E2\u30FC\u30C9\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3e3)}}async requestManualSync(){var e;if(this.isReadOnlyProtected){new de.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u4FDD\u5B58\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}await((e=this.syncManager)==null?void 0:e.triggerManualSync())}async toggleRubyVisibility(){var r;let n=!(this.plugin.settings.wysiwyg.enableRuby!==!1);try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableRuby:n}}),await this.updateSettings(this.plugin.settings),new de.Notice(n?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3057\u307E\u3057\u305F\u3002":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3057\u307E\u3057\u305F\u3002",1800)}catch(o){console.error("[Tategaki TipTap] Failed to toggle ruby",o),new de.Notice("\u30EB\u30D3\u8868\u793A\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}finally{(r=this.formattingToolbar)==null||r.refreshRubyToggle()}}refreshRubyRendering(){if(this.markdownAdapter)try{let e=this.markdownAdapter.getMarkdown();this.markdownAdapter.setMarkdown(e)}catch(e){Ee("Tategaki TipTap: failed to refresh ruby rendering",e)}}updateRubyPluginState(e=this.plugin.settings){var l,c,u,d,h;let r=((l=e.wysiwyg)==null?void 0:l.enableRuby)!==!1&&this.isJapaneseNovelRubyActive(),s=Math.max(.2,Math.min(1,(c=e.common.rubySize)!=null?c:.5)).toString(),a=f=>{f&&(f.classList.toggle("tategaki-ruby-plugin-active",r),f.style.setProperty("--tategaki-ruby-size",s),f.style.setProperty("--ruby-size",s))};a((u=this.editorHostEl)!=null?u:null),a((h=(d=this.editor)==null?void 0:d.view.dom)!=null?h:null)}isJapaneseNovelRubyActive(){var n,r;let e=(n=this.app)==null?void 0:n.plugins;if(!e)return!1;try{if(e.enabledPlugins instanceof Set||e.enabledPlugins&&typeof e.enabledPlugins.has=="function")return e.enabledPlugins.has("japanese-novel-ruby")}catch(o){}return Boolean((r=e.plugins)==null?void 0:r["japanese-novel-ruby"])}async toggleAuxiliaryPanel(){var r;if(this.isEditorReadOnly()){new de.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u306F\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}let n=!((r=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?r:!1);n&&this.deactivatePlainEditMode();try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableAssistantInput:n}}),await this.updateSettings(this.plugin.settings)}catch(o){console.error("[Tategaki TipTap] Failed to toggle auxiliary panel",o),new de.Notice("\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}initializeAuxiliaryInput(){if(!(!this.isEditorReadOnly()&&!!this.plugin.settings.wysiwyg.enableAssistantInput)){this.auxiliaryInputPanel&&(this.removeAuxiliaryPanelPadding(),this.auxiliaryInputPanel.destroy(),this.auxiliaryInputPanel=null),this.clearAuxiliaryCaret(),this.detachScrollHandlerForAuxiliaryCaret(),this.cursorSyncPausedByAuxiliary=!1;return}if(this.auxiliaryInputPanel){this.auxiliaryInputPanel.show(),this.addAuxiliaryPanelPadding();return}this.editorAreaEl&&(this.auxiliaryInputPanel=new gs({parent:this.editorAreaEl,isVertical:this.plugin.settings.common.writingMode==="vertical-rl",onInsert:n=>this.handleAuxiliaryInsert(n),onFocus:()=>{this.cursorSyncPausedByAuxiliary=!0,this.stopCursorSync();let n=this.captureCurrentInsertionRange();this.renderAuxiliaryCaret(n),this.attachScrollHandlerForAuxiliaryCaret()},onBlur:()=>{this.clearAuxiliaryCaret(),this.detachScrollHandlerForAuxiliaryCaret(),this.cursorSyncPausedByAuxiliary=!1,this.plugin.settings.wysiwyg.syncCursor&&!this.cursorSyncPausedByFocus&&this.startCursorSync()},onResize:()=>this.addAuxiliaryPanelPadding(),onBackspace:()=>this.handleAuxiliaryBackspace(),onBackspaceEmpty:()=>void this.toggleAuxiliaryPanel(),onNavigate:n=>this.handleAuxiliaryNavigate(n)}),this.addAuxiliaryPanelPadding())}addAuxiliaryPanelPadding(){if(!this.editorHostEl||!this.auxiliaryInputPanel)return;if(this.plugin.settings.common.writingMode==="vertical-rl"){let r=Math.max(0,this.auxiliaryInputPanel.containerEl.offsetWidth);this.editorHostEl.style.paddingLeft=`${r}px`,this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx}px`;return}let n=Math.max(0,this.auxiliaryInputPanel.containerEl.offsetHeight);this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx+n}px`,this.editorHostEl.style.paddingLeft=""}removeAuxiliaryPanelPadding(){this.editorHostEl&&(this.editorHostEl.style.paddingLeft="",this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx}px`)}isSelectionInsideEditor(e){var o,s;let n=(s=(o=this.editor)==null?void 0:o.view)==null?void 0:s.dom;if(!n||e.rangeCount===0)return!1;let r=e.getRangeAt(0).commonAncestorContainer;return r.nodeType===Node.TEXT_NODE&&(r=r.parentNode),n.contains(r)}captureCurrentInsertionRange(){let e=window.getSelection();return e&&e.rangeCount>0&&this.isSelectionInsideEditor(e)&&(this.lastAuxiliaryRange=e.getRangeAt(0).cloneRange(),this.editor&&(this.lastAuxiliaryPos=this.editor.state.selection.from)),this.lastAuxiliaryRange}updateAuxiliaryRangeFromEditor(){if(this.editor)try{let{state:e,view:n}=this.editor,{from:r}=e.selection;this.lastAuxiliaryPos=r;let o=n.domAtPos(r);if(!o||!o.node)return;let s=document.createRange();if(o.node.nodeType===Node.TEXT_NODE)s.setStart(o.node,o.offset),s.setEnd(o.node,o.offset);else{let a=o.node.childNodes[o.offset];a?(s.setStartBefore(a),s.setEndBefore(a)):(s.selectNodeContents(o.node),s.collapse(!1))}this.lastAuxiliaryRange=s}catch(e){Ee("Failed to update auxiliary range from editor",e)}}renderAuxiliaryCaret(e){var w,k,M;if(!this.editorHostEl){this.clearAuxiliaryCaret();return}let n=this.getAuxiliaryCaretRect(e);if(!n){this.clearAuxiliaryCaret();return}if(this.scrollAuxiliaryCaretIntoView(n)&&(n=this.getAuxiliaryCaretRect(e)),!n){this.clearAuxiliaryCaret();return}let r=this.editorHostEl.getBoundingClientRect(),o=this.editorHostEl.scrollTop,s=this.editorHostEl.scrollLeft,a=n.top-r.top,l=n.left-r.left,c=a+o,u=l+s,d=this.plugin.settings.common.writingMode==="vertical-rl",h=(w=this.auxiliaryInputPanel)==null?void 0:w.containerEl.getBoundingClientRect(),f=(k=h==null?void 0:h.height)!=null?k:0,p=(M=h==null?void 0:h.width)!=null?M:0,m=parseFloat(getComputedStyle(this.editorHostEl).fontSize)||16,g=d?m*1.4:2,b=d?3:m*1.4,v=0,y=d?p:0,E=r.height-(d?0:f),x=r.width,S=a<v||l<y||a+b>E||l+g>x;this.auxiliaryCaretEl||(this.auxiliaryCaretEl=document.createElement("div"),this.auxiliaryCaretEl.className="tategaki-auxiliary-caret",this.auxiliaryCaretEl.style.pointerEvents="none",this.auxiliaryCaretEl.style.overflow="hidden",this.editorHostEl.appendChild(this.auxiliaryCaretEl)),this.auxiliaryCaretEl.classList.remove("vertical","horizontal"),this.auxiliaryCaretEl.classList.add(d?"vertical":"horizontal"),this.auxiliaryCaretEl.style.top=`${c}px`,this.auxiliaryCaretEl.style.left=`${u}px`,this.auxiliaryCaretEl.style.display=S?"none":""}getAuxiliaryCaretRect(e){if(this.editor&&this.lastAuxiliaryPos!==null)try{let n=this.lastAuxiliaryPos,r=this.editor.state.doc.resolve(n),o=this.plugin.settings.common.writingMode==="vertical-rl",s=r.parent.content.size>0,a=r.parentOffset>=r.parent.content.size;if(o&&e){let u=this.getRangeRectWithFallback(e);if(u)return u}let l=o&&a&&s?-1:1,c=this.editor.view.coordsAtPos(n,l);return new DOMRect(c.left,c.top,c.right-c.left,c.bottom-c.top)}catch(n){}return e?this.getRangeRectWithFallback(e):null}scrollAuxiliaryCaretIntoView(e){var d,h,f;if(!this.editorHostEl)return!1;let n=this.plugin.settings.common.writingMode==="vertical-rl",r=this.getScrollableElement(n);if(!r)return this.scrollCoordsIntoView({left:e.left,right:e.right,top:e.top,bottom:e.bottom});let o=this.editorHostEl.getBoundingClientRect(),s=(d=this.auxiliaryInputPanel)==null?void 0:d.containerEl.getBoundingClientRect(),a=(h=s==null?void 0:s.height)!=null?h:0,l=(f=s==null?void 0:s.width)!=null?f:0,c=12,u=!1;if(n){let p=o.left+l+c,m=o.right-c;e.left<p?(r.scrollLeft-=p-e.left,u=!0):e.right>m&&(r.scrollLeft+=e.right-m,u=!0)}else{let p=o.top+c,m=o.bottom-a-c;e.bottom>m?(r.scrollTop+=e.bottom-m,u=!0):e.top<p&&(r.scrollTop-=p-e.top,u=!0)}return u}scrollCoordsIntoView(e,n){var u,d,h,f,p;if(!this.editor)return!1;let r=this.editor.view,o=r.dom.ownerDocument,s=(u=r.someProp("scrollThreshold"))!=null?u:0,a=(h=(d=n==null?void 0:n.margin)!=null?d:r.someProp("scrollMargin"))!=null?h:12,l=!1,c={...e};for(let m=(f=n==null?void 0:n.startNode)!=null?f:r.dom;m;){if(m.nodeType!==Node.ELEMENT_NODE){m=this.getParentNode(m);continue}let g=m,b=g===o.body,v=b?this.getWindowRect(o):this.getClientRect(g),y=0,E=0;if(c.top<v.top+this.getScrollSide(s,"top")?E=-(v.top-c.top+this.getScrollSide(a,"top")):c.bottom>v.bottom-this.getScrollSide(s,"bottom")&&(c.bottom-c.top>v.bottom-v.top?E=c.top+this.getScrollSide(a,"top")-v.top:E=c.bottom-v.bottom+this.getScrollSide(a,"bottom")),c.left<v.left+this.getScrollSide(s,"left")?y=-(v.left-c.left+this.getScrollSide(a,"left")):c.right>v.right-this.getScrollSide(s,"right")&&(y=c.right-v.right+this.getScrollSide(a,"right")),y||E)if(l=!0,b)(p=o.defaultView)==null||p.scrollBy(y,E);else{let S=g.scrollLeft,w=g.scrollTop;E&&(g.scrollTop+=E),y&&(g.scrollLeft+=y);let k=g.scrollLeft-S,M=g.scrollTop-w;c={left:c.left-k,right:c.right-k,top:c.top-M,bottom:c.bottom-M}}let x=b?"fixed":getComputedStyle(g).position;if(/^(fixed|sticky)$/.test(x))break;m=x==="absolute"?g.offsetParent:this.getParentNode(g)}return l}getScrollSide(e,n){var r;return typeof e=="number"?e:(r=e[n])!=null?r:0}getWindowRect(e){var r;let n=(r=e.defaultView)==null?void 0:r.visualViewport;return n?{left:n.offsetLeft,right:n.offsetLeft+n.width,top:n.offsetTop,bottom:n.offsetTop+n.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}getClientRect(e){let n=e.getBoundingClientRect(),r=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1;return{left:n.left,right:n.left+e.clientWidth*r,top:n.top,bottom:n.top+e.clientHeight*o}}getParentNode(e){var r,o;let n=(r=e.assignedSlot)!=null?r:e.parentNode;return n&&n.nodeType===Node.DOCUMENT_FRAGMENT_NODE?(o=n.host)!=null?o:null:n}clearAuxiliaryCaret(){this.auxiliaryCaretEl&&(this.auxiliaryCaretEl.remove(),this.auxiliaryCaretEl=null),this.lastAuxiliaryPos=null}attachScrollHandlerForAuxiliaryCaret(){if(this.scrollHandlerForAuxiliaryCaret)return;let e=this.editorHostEl;e&&(this.scrollHandlerForAuxiliaryCaret=()=>{this.lastAuxiliaryRange&&this.renderAuxiliaryCaret(this.lastAuxiliaryRange)},e.addEventListener("scroll",this.scrollHandlerForAuxiliaryCaret,{passive:!0}))}detachScrollHandlerForAuxiliaryCaret(){!this.scrollHandlerForAuxiliaryCaret||!this.editorHostEl||(this.editorHostEl.removeEventListener("scroll",this.scrollHandlerForAuxiliaryCaret),this.scrollHandlerForAuxiliaryCaret=null)}getRangeRectWithFallback(e){let n=e.getBoundingClientRect();if(n&&!(n.width===0&&n.height===0))return n;let r=e.getClientRects();if(r.length>0){let a=r[0];if(!(a.width===0&&a.height===0))return a}let o=e.cloneRange(),s=document.createElement("span");s.className="tategaki-auxiliary-caret-probe",s.style.display="inline-block",s.style.width="0",s.style.height="1em",s.style.pointerEvents="none",s.style.opacity="0";try{return o.insertNode(s),s.getBoundingClientRect()}catch(a){return Ee("Failed to measure auxiliary caret position",a),null}finally{s.remove()}}handleAuxiliaryInsert(e){if(!this.editor||this.isEditorReadOnly())return;let n=e.length>0?e:`
`;try{if(n===`
`||n==="")this.editor.commands.splitBlock()||this.editor.commands.setHardBreak();else{let r=n.replace(/\r\n?/g,`
`).split(`
`);for(let o=0;o<r.length;o++){let s=r[o];s.length>0&&this.editor.commands.insertContent(s),o<r.length-1&&(this.editor.commands.splitBlock()||this.editor.commands.setHardBreak())}}this.updateAuxiliaryRangeFromEditor()}catch(r){Ee("Tategaki TipTap: failed to insert auxiliary text",r)}finally{setTimeout(()=>{this.auxiliaryInputPanel&&this.lastAuxiliaryRange&&(this.auxiliaryInputPanel.textareaEl.focus(),this.renderAuxiliaryCaret(this.lastAuxiliaryRange))},10)}}handleAuxiliaryBackspace(){if(!(!this.editor||this.isEditorReadOnly()))try{let{selection:e}=this.editor.state,{from:n,empty:r,$from:o}=e;r?o.parentOffset===0?!this.editor.commands.joinBackward()&&n>0&&this.editor.chain().deleteRange({from:n-1,to:n}).run():n>0&&this.editor.chain().deleteRange({from:n-1,to:n}).run():this.editor.commands.deleteSelection(),this.updateAuxiliaryRangeFromEditor()}catch(e){Ee("Tategaki TipTap: failed to delete character",e)}finally{setTimeout(()=>{this.auxiliaryInputPanel&&this.lastAuxiliaryRange&&(this.auxiliaryInputPanel.textareaEl.focus(),this.renderAuxiliaryCaret(this.lastAuxiliaryRange))},10)}}handleAuxiliaryNavigate(e){if(!this.editor||!this.auxiliaryInputPanel||this.isEditorReadOnly()||!this.isArrowKey(e.key))return;let{state:n,view:r}=this.editor,o=e.key,s=n.selection.head,a=this.getNextPosForArrow(r,o,s);if(a==null)return;let l=n.doc.resolve(a),c=this.getArrowBias(o),u=e.shiftKey?G.create(n.doc,n.selection.anchor,a):re.near(l,c);u.eq(n.selection)||(r.dispatch(n.tr.setSelection(u).scrollIntoView()),setTimeout(()=>{!this.editor||!this.auxiliaryInputPanel||(this.updateAuxiliaryRangeFromEditor(),this.lastAuxiliaryRange&&this.renderAuxiliaryCaret(this.lastAuxiliaryRange))},0))}isArrowKey(e){return e==="ArrowLeft"||e==="ArrowRight"||e==="ArrowUp"||e==="ArrowDown"}getArrowBias(e){return e==="ArrowLeft"||e==="ArrowUp"?-1:1}getNextPosForArrow(e,n,r){let o=e.state.doc.content.size,s=Math.max(0,Math.min(r,o)),a=this.getNextPosFromCoords(e,n,s);if(a==null||a===s){let l=n==="ArrowLeft"||n==="ArrowUp"?s-1:s+1;a=Math.max(0,Math.min(l,o))}return a}getNextPosFromCoords(e,n,r){var S;let o;try{o=e.coordsAtPos(r)}catch(w){return null}let s=(o.left+o.right)/2,a=(o.top+o.bottom)/2,l=window.getComputedStyle(e.dom),c=parseFloat(l.fontSize)||16,u=parseFloat(l.lineHeight),d=Number.isFinite(u)?u:c*1.6,h=this.plugin.settings.common.writingMode==="vertical-rl",f=Math.max(1,c*.8),p=Math.max(f,d),m=h?p:f,g=h?f:p,b=n==="ArrowLeft"?-m:n==="ArrowRight"?m:0,v=n==="ArrowUp"?-g:n==="ArrowDown"?g:0,y=e.state.doc.resolve(r),E=y.parent,x=y.start()-1;for(let w=1;w<=6;w++){let k=s+b*w,M=a+v*w,L=document.elementFromPoint(k,M);if(L){let P=L,I=!1;for(;P&&P!==e.dom;){if((S=P.classList)!=null&&S.contains("tategaki-aozora-ruby-rt")||P.getAttribute("data-pm-ignore")==="true"){I=!0;break}P=P.parentElement}if(I)continue}let _=e.posAtCoords({left:k,top:M});if(_&&_.pos!==r)try{let P=e.state.doc.resolve(_.pos),I=P.parent,N=P.start()-1;if(E===I&&x===N||(n==="ArrowDown"||n==="ArrowUp"))return _.pos}catch(P){continue}}return null}toggleOutlinePanel(){if(!this.editorAreaEl)return;if(this.outlinePanelEl){this.outlinePanelEl.remove(),this.outlinePanelEl=null;return}let e=this.editorAreaEl.createDiv("tategaki-tiptap-outline-panel");e.style.cssText=`
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			width: 280px;
			background: color-mix(in srgb, var(--background-primary) 80%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			border-left: 1px solid var(--background-modifier-border);
			z-index: 900;
			overflow: auto;
			padding: 8px 0;
		`,this.outlinePanelEl=e,this.renderOutline(e)}renderOutline(e){if(!this.editor)return;e.empty();let n=e.createDiv();n.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 8px 12px;
			border-bottom: 1px solid var(--background-modifier-border);
			font-weight: 600;
			position: sticky;
			top: 0;
			background: color-mix(in srgb, var(--background-primary) 90%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			z-index: 1;
		`,n.createSpan({text:"\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3"});let r=n.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":"\u9589\u3058\u308B"}});(0,de.setIcon)(r,"x"),r.addEventListener("click",a=>{a.preventDefault(),this.toggleOutlinePanel()});let o=e.createDiv();o.style.cssText="padding: 6px 0;";let s=[];try{this.editor.state.doc.descendants((a,l)=>{var c,u,d,h;if(((c=a.type)==null?void 0:c.name)==="heading"){let f=Number((d=(u=a.attrs)==null?void 0:u.level)!=null?d:1),p=(h=a.textContent)!=null?h:"";p.trim().length>0&&s.push({level:f,text:p,pos:l})}return!0})}catch(a){Ee("Tategaki TipTap: failed to build outline",a)}if(s.length===0){let a=o.createDiv();a.textContent="\u898B\u51FA\u3057\u304C\u3042\u308A\u307E\u305B\u3093",a.style.cssText="padding: 8px 12px; color: var(--text-muted);";return}for(let a of s){let l=o.createDiv();l.style.cssText=`
				padding: 6px 12px;
				cursor: pointer;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				padding-left: ${12+Math.max(0,a.level-1)*12}px;
			`,l.textContent=a.text,l.addEventListener("click",c=>{var u,d;c.preventDefault();try{(u=this.editor)==null||u.commands.focus(),(d=this.editor)==null||d.commands.setTextSelection(a.pos+1),this.ensureExternalCursorVisible(a.pos+1)}catch(h){}})}}registerEditorChangeWatchers(){let e=this.app.workspace.on("active-leaf-change",()=>{this.handleWorkspaceFocusChange()});this.registerEvent(e)}async handleWorkspaceFocusChange(){await this.syncPlainEditModeWithWorkspace()}async syncPlainEditModeWithWorkspace(){var r,o,s;let e=this.app.workspace.activeLeaf,n=e==null?void 0:e.view;if(n instanceof de.MarkdownView&&((r=n.getMode)==null?void 0:r.call(n))!=="preview"){(o=this.plainEditMode)!=null&&o.isPlainMode()&&(this.plainEditAutoPaused=!0,this.deactivatePlainEditMode());return}if(n===this){if(!this.plainEditAutoPaused)return;if((s=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?s:!1){this.plainEditAutoPaused=!1;return}await this.activatePlainEditMode(),this.plainEditAutoPaused=!1}}async handleBeforeApplyMarkdown(e,n,r){let o=this.detectUnsupportedHtmlTags(e);if(o.length===0)return this.readOnlyProtectionReason==="unsupported"&&this.setReadOnlyProtection(!1),{action:"apply"};await this.ensureUnsupportedHtmlBackup(n,e);let s=o.slice().sort().join(","),a=this.unsupportedHtmlCancelState.get(n.path);if(a&&a.signature===s&&Date.now()-a.at<Sh.UNSUPPORTED_HTML_CANCEL_COOLDOWN_MS)return{action:"cancel"};let l=this.unsupportedHtmlDecisions.get(n.path);if(l)return this.unsupportedHtmlCancelState.delete(n.path),this.buildUnsupportedHtmlDecision(l);let c=this.unsupportedHtmlPromptInFlight.get(n.path),u;if(c)u=await c.promise;else{let d=(async()=>await new ul(this.app,o).waitForChoice())().finally(()=>{this.unsupportedHtmlPromptInFlight.delete(n.path)});this.unsupportedHtmlPromptInFlight.set(n.path,{signature:s,promise:d}),u=await d}return u==="cancel"?(this.unsupportedHtmlCancelState.set(n.path,{at:Date.now(),signature:s}),{action:"cancel"}):(this.unsupportedHtmlCancelState.delete(n.path),this.unsupportedHtmlDecisions.set(n.path,u),this.buildUnsupportedHtmlDecision(u))}buildUnsupportedHtmlDecision(e){return e==="read-only"?(this.setReadOnlyProtection(!0,"unsupported"),new de.Notice("\u672A\u5BFE\u5FDC\u30BF\u30B0\u304C\u3042\u308B\u305F\u3081\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u958B\u304D\u307E\u3057\u305F\u3002",3500),{action:"apply"}):(this.setReadOnlyProtection(!1),{action:"apply"})}async ensureUnsupportedHtmlBackup(e,n){if(this.plugin.settings.wysiwyg.enableSyncBackup&&!this.unsupportedHtmlBackedUp.has(e.path))try{await ps(this.app,e,n,n),this.unsupportedHtmlBackedUp.add(e.path)}catch(r){Ee("Tategaki TipTap: failed to write unsupported tag backup",r),new de.Notice("\u672A\u5BFE\u5FDC\u30BF\u30B0\u306E\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3500)}}detectUnsupportedHtmlTags(e){var u;let n=new Set(["span","ruby","rt","rp","mark","u","sup","sub","small","br","wbr","img"]),r=this.stripFencedCodeBlocks(e),s=this.stripInlineCode(r).replace(/<!--[\s\S]*?-->/g,""),a=/<\s*\/?\s*([a-zA-Z][\w:-]*)\b[^>]*>/g,l=new Set,c=null;for(;(c=a.exec(s))!==null;){let d=(u=c[1])==null?void 0:u.toLowerCase();d&&!n.has(d)&&l.add(d)}return Array.from(l.values()).sort()}stripFencedCodeBlocks(e){let n=e.split(`
`),r=[],o=!1,s="",a=0;for(let l of n){let c=l.trim();if(!o){let d=c.match(/^(`{3,}|~{3,})/);if(d){o=!0,s=d[1][0],a=d[1].length;continue}r.push(l);continue}let u=c.match(/^(`{3,}|~{3,})\s*$/);u&&u[1][0]===s&&u[1].length>=a&&(o=!1,s="",a=0)}return r.join(`
`)}stripInlineCode(e){let n="",r=!1,o=0;for(let s=0;s<e.length;s++){let a=e[s];if(a==="`"){let l=s;for(;e[l]==="`";)l++;let c=l-s;if(!r){r=!0,o=c,s=l-1;continue}if(c>=o){r=!1,o=0,s=l-1;continue}}r||(n+=a)}return n}applyInitialScrollPosition(){if(this.initialScrollApplied||!this.editorHostEl)return;if(!(this.plugin.settings.common.writingMode==="vertical-rl")){this.initialScrollApplied=!0;return}let n=this.getScrollableElement(!0);if(!n){this.initialScrollApplied=!0;return}requestAnimationFrame(()=>{try{let r=Math.max(0,n.scrollWidth-n.clientWidth);r>0&&n.scrollLeft<1&&(n.scrollLeft=r)}finally{this.initialScrollApplied=!0}})}setupBeforeInputFixes(){if(!this.editor||this.beforeInputHandler)return;let e=this.editor.view.dom,n=o=>{o.key==="Enter"&&(this.lastEnterKeydownAt=Date.now(),this.lastEnterKeydownShift=o.shiftKey)},r=o=>{var a,l,c;if(this.isEditorReadOnly())return;let s=o.inputType;if(s==="insertParagraph"){o.preventDefault(),this.consumeShiftEnterFlag();try{this.runInsertParagraphCommand()||(a=this.editor)==null||a.commands.setHardBreak()}catch(u){}return}if(s==="insertLineBreak"){o.preventDefault();let u=this.consumeShiftEnterFlag();try{u?(l=this.editor)==null||l.commands.setHardBreak():this.runInsertParagraphCommand()||(c=this.editor)==null||c.commands.setHardBreak()}catch(d){}}};this.beforeInputHandler=r,this.beforeInputKeydownHandler=n,e.addEventListener("beforeinput",r),e.addEventListener("keydown",n,!0)}teardownBeforeInputFixes(){if(!this.editor){this.beforeInputHandler=null,this.beforeInputKeydownHandler=null;return}if(!this.beforeInputHandler&&!this.beforeInputKeydownHandler){this.beforeInputHandler=null,this.beforeInputKeydownHandler=null;return}try{let e=this.editor.view.dom;this.beforeInputHandler&&e.removeEventListener("beforeinput",this.beforeInputHandler),this.beforeInputKeydownHandler&&e.removeEventListener("keydown",this.beforeInputKeydownHandler,!0)}finally{this.beforeInputHandler=null,this.beforeInputKeydownHandler=null}}consumeShiftEnterFlag(){let e=Date.now(),n=this.lastEnterKeydownShift&&e-this.lastEnterKeydownAt<400;return this.lastEnterKeydownShift=!1,this.lastEnterKeydownAt=0,n}runInsertParagraphCommand(){var e;return(e=this.editor)!=null&&e.isEditable?this.editor.isActive("listItem")?this.editor.commands.splitListItem("listItem"):this.editor.commands.splitBlock():!1}setupCompositionGuards(){if(!this.editor||this.compositionStartHandler||this.compositionEndHandler)return;let e=this.editor.view.dom;this.compositionStartHandler=()=>{this.isComposing=!0,this.ensureCaretVisible(200)},this.compositionEndHandler=()=>{let n=this.isComposing;this.isComposing=!1,n&&this.flushPendingEditorUpdate()},e.addEventListener("compositionstart",this.compositionStartHandler,!0),e.addEventListener("compositionend",this.compositionEndHandler,!0)}teardownCompositionGuards(){if(!this.editor){this.compositionStartHandler=null,this.compositionEndHandler=null,this.isComposing=!1;return}let e=this.editor.view.dom;this.compositionStartHandler&&e.removeEventListener("compositionstart",this.compositionStartHandler,!0),this.compositionEndHandler&&e.removeEventListener("compositionend",this.compositionEndHandler,!0),this.compositionStartHandler=null,this.compositionEndHandler=null,this.isComposing=!1}ensureCaretVisible(e=300){this.editor&&window.setTimeout(()=>{var a;if(!this.editor)return;let{state:n,view:r}=this.editor,{selection:o}=n,{from:s}=o;try{let l=r.coordsAtPos(s);if(!l)return;let c=r.domAtPos(s),u=(a=c==null?void 0:c.node)!=null?a:r.dom;this.scrollCoordsIntoView({left:l.left,right:l.right,top:l.top,bottom:l.bottom},{startNode:u,margin:80})||r.dispatch(n.tr.scrollIntoView())}catch(l){Ee("[Tategaki TipTap] Failed to ensure caret visible:",l)}},e)}setupMobileKeyboardSupport(){if(typeof window.visualViewport!="undefined"&&window.visualViewport&&(this.lastViewportHeight=window.visualViewport.height,this.lastViewportOffsetTop=window.visualViewport.offsetTop,this.lastViewportOffsetLeft=window.visualViewport.offsetLeft,this.visualViewportResizeHandler=()=>{window.visualViewport&&(this.viewportResizeTimer!=null&&window.clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=window.setTimeout(()=>{if(!window.visualViewport)return;let e=window.visualViewport.height,n=this.lastViewportHeight-e,r=Math.abs(window.visualViewport.offsetTop-this.lastViewportOffsetTop),o=Math.abs(window.visualViewport.offsetLeft-this.lastViewportOffsetLeft);(n>50||r>24||o>24)&&this.ensureCaretVisible(400),this.lastViewportHeight=e,this.lastViewportOffsetTop=window.visualViewport.offsetTop,this.lastViewportOffsetLeft=window.visualViewport.offsetLeft,this.viewportResizeTimer=null},100))},window.visualViewport.addEventListener("resize",this.visualViewportResizeHandler),window.visualViewport.addEventListener("scroll",this.visualViewportResizeHandler)),this.editor){let e=this.editor.view.dom;this.editorFocusHandler=()=>{this.ensureCaretVisible(350)},e.addEventListener("focus",this.editorFocusHandler,!0)}this.editor&&(de.Platform.isMobile||de.Platform.isMobileApp)&&(this.selectionUpdateHandler=()=>{!window.visualViewport||!(window.visualViewport.height<window.innerHeight-80)||(this.selectionUpdateTimer!=null&&window.clearTimeout(this.selectionUpdateTimer),this.selectionUpdateTimer=window.setTimeout(()=>{this.selectionUpdateTimer=null,this.ensureCaretVisible(80)},60))},this.editor.on("selectionUpdate",this.selectionUpdateHandler))}teardownMobileKeyboardSupport(){this.viewportResizeTimer!=null&&(window.clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=null),this.visualViewportResizeHandler&&typeof window.visualViewport!="undefined"&&window.visualViewport&&(window.visualViewport.removeEventListener("resize",this.visualViewportResizeHandler),window.visualViewport.removeEventListener("scroll",this.visualViewportResizeHandler),this.visualViewportResizeHandler=null),this.editorFocusHandler&&this.editor&&(this.editor.view.dom.removeEventListener("focus",this.editorFocusHandler,!0),this.editorFocusHandler=null),this.selectionUpdateTimer!=null&&(window.clearTimeout(this.selectionUpdateTimer),this.selectionUpdateTimer=null),this.selectionUpdateHandler&&this.editor&&(this.editor.off("selectionUpdate",this.selectionUpdateHandler),this.selectionUpdateHandler=null),this.lastViewportHeight=0,this.lastViewportOffsetTop=0,this.lastViewportOffsetLeft=0}setupListItemMoveCaptureHandler(){this.listItemMoveCaptureHandler=e=>{if(!(e.metaKey||e.ctrlKey)||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)||e.shiftKey||e.altKey||!this.editor||!this.editor.isFocused||this.isEditorReadOnly())return;let{$from:o}=this.editor.state.selection,s=!1;for(let u=o.depth;u>0;u--)if(o.node(u).type.name==="listItem"){s=!0;break}if(!s)return;let l=this.plugin.settings.common.writingMode==="vertical-rl",c=null;l?e.key==="ArrowRight"?c="up":e.key==="ArrowLeft"&&(c="down"):e.key==="ArrowUp"?c="up":e.key==="ArrowDown"&&(c="down"),c&&(e.preventDefault(),e.stopImmediatePropagation(),c==="up"?this.editor.commands.moveListItemUp():this.editor.commands.moveListItemDown())},window.addEventListener("keydown",this.listItemMoveCaptureHandler,{capture:!0})}teardownListItemMoveCaptureHandler(){this.listItemMoveCaptureHandler&&(window.removeEventListener("keydown",this.listItemMoveCaptureHandler,{capture:!0}),this.listItemMoveCaptureHandler=null)}handleEditorContentUpdate(){var e,n;this.isComposing||(e=this.editor)!=null&&e.view.composing||this.suppressEditorUpdates||(n=this.markdownAdapter)!=null&&n.isApplyingExternalUpdate()||this.syncManager&&(this.pendingUpdate=!0,this.updateDebounceTimer==null&&(this.updateDebounceTimer=window.setTimeout(()=>{var r;this.updateDebounceTimer=null,this.pendingUpdate&&(this.pendingUpdate=!1,(r=this.syncManager)==null||r.handleEditorUpdate())},this.UPDATE_DEBOUNCE_MS),this.outlinePanelEl&&this.outlineUpdateTimer==null&&(this.outlineUpdateTimer=window.setTimeout(()=>{this.outlineUpdateTimer=null,this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)},200))))}flushPendingEditorUpdate(){this.syncManager&&(this.updateDebounceTimer!=null&&(window.clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null),this.pendingUpdate=!1,this.syncManager.handleEditorUpdate())}updateReadOnlyState(){var n,r;if(!this.editor)return;let e=this.isEditorReadOnly();try{this.editor.setEditable(!e)}catch(o){}(n=this.formattingToolbar)==null||n.setReadOnly(e,{hideEditingButtons:!1}),(r=this.searchReplacePanel)==null||r.setReadOnly(e)}isEditorReadOnly(){return this.isReadOnlyProtected}toggleReadingMode(){this.readingModeActive&&this.disableReadingMode();let e=this.getDisplayFile();if(!e){new de.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}this.plugin.modeManager.toggleReadingView(e,{targetLeaf:this.leaf,returnViewMode:"edit"}).then(n=>{var r;(r=this.formattingToolbar)==null||r.updateReadingModeButton(),new de.Notice(n?"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u958B\u304D\u307E\u3057\u305F\u3002":"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u9589\u3058\u307E\u3057\u305F\u3002",2e3)})}isReadingViewOpenForCurrentFile(){var n,r,o;let e=(o=(r=this.getCurrentFilePath())!=null?r:(n=this.currentFile)==null?void 0:n.path)!=null?o:null;return this.plugin.modeManager.isReadingViewOpenForFile(e)}getEffectiveCommonSettings(e){return typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common}getCurrentBorderScale(e){var s;let n=this.getEffectiveCommonSettings(e),r=Number((s=n.pageScale)!=null?s:1);return r>1?1:Math.max(.7,Math.min(1,r))}enableReadingMode(){var p,m,g,b,v;if(!this.editor||!this.editorHostEl)return!1;this.disableReadingMode();let e=this.editorHostEl.querySelector(".ProseMirror");if(!e)return!1;let n=document.createElement("div");n.className="tategaki-reading-mode-container";let r=window.matchMedia("(hover: none) and (pointer: coarse) and (max-width: 700px)").matches;n.style.cssText=`
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			overflow: hidden;
			background: var(--tategaki-page-background-color, var(--background-primary));
			z-index: 10;
			padding-bottom: ${r?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};
		`,n.addEventListener("pointerdown",()=>{try{n.focus()}catch(y){}},{capture:!0});let o=this.plugin.settings,s=this.getEffectiveCommonSettings(o),l=Number((p=s.pageScale)!=null?p:1)>1;this.applyReadingModeLayout(s.backgroundColor),n.style.color=s.textColor,n.style.setProperty("--tategaki-text-color",s.textColor),n.style.setProperty("--tategaki-page-background-color",l?s.backgroundColor:s.pageBackgroundColor);let c=document.createElement("div");c.className="tategaki-reading-mode-snapshot",c.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
		`,this.frontmatterContainer&&c.appendChild(this.frontmatterContainer.cloneNode(!0));let u=e.cloneNode(!0);u.removeAttribute("contenteditable"),u.setAttribute("contenteditable","false"),u.removeAttribute("tabindex"),u.style.visibility="",u.style.color=s.textColor,c.appendChild(u);let d=c.innerHTML;this.editorHostEl.appendChild(n),this.proseMirrorBeforeReadingStyle={display:e.style.display,visibility:e.style.visibility,pointerEvents:e.style.pointerEvents},e.style.visibility="hidden",e.style.pointerEvents="none";let h=this.currentFile?this.getFrontmatterTitle(this.currentFile):null,f=(g=h!=null?h:(m=this.currentFile)==null?void 0:m.basename)!=null?g:"";try{this.readingModePager=new Ir({container:n,contentHtml:d,writingMode:s.writingMode,settings:s,previewSettings:o.preview,title:f,onRepaginationRequired:()=>{new de.Notice("\u30EC\u30A4\u30A2\u30A6\u30C8\u5909\u66F4\u3092\u691C\u51FA\u3057\u305F\u305F\u3081\u3001\u66F8\u7C4D\u30E2\u30FC\u30C9\u3092\u7D42\u4E86\u3057\u307E\u3057\u305F\u3002",2500),this.disableReadingMode()}})}catch(y){console.error("[Tategaki] Failed to start reading mode",y);try{(b=this.readingModePager)==null||b.destroy()}catch(E){}return this.readingModePager=null,n.remove(),e.style.visibility=this.proseMirrorBeforeReadingStyle.visibility,e.style.pointerEvents=this.proseMirrorBeforeReadingStyle.pointerEvents,this.proseMirrorBeforeReadingStyle=null,!1}this.readingModeContainerEl=n,this.readingModeActive=!0,(v=this.formattingToolbar)==null||v.updateReadingModeButton();try{n.focus()}catch(y){}return!0}disableReadingMode(){var e;if(!(!this.readingModeActive&&!this.readingModePager)){if(this.readingModePager){try{this.readingModePager.destroy()}catch(n){}this.readingModePager=null}if(this.readingModeContainerEl&&(this.readingModeContainerEl.remove(),this.readingModeContainerEl=null),this.editorHostEl){let n=this.editorHostEl.querySelector(".ProseMirror");n&&this.proseMirrorBeforeReadingStyle&&(n.style.display=this.proseMirrorBeforeReadingStyle.display,n.style.visibility=this.proseMirrorBeforeReadingStyle.visibility,n.style.pointerEvents=this.proseMirrorBeforeReadingStyle.pointerEvents)}this.proseMirrorBeforeReadingStyle=null,this.restoreReadingModeLayout(),this.readingModeActive=!1,(e=this.formattingToolbar)==null||e.updateReadingModeButton()}}applyReadingModeLayout(e){this.readingModeLayoutBackup||!this.pageContainerEl||!this.borderWrapperEl||!this.contentWrapperEl||(this.readingModeLayoutBackup={pageContainerPadding:this.pageContainerEl.style.padding,pageContainerAlignItems:this.pageContainerEl.style.alignItems,pageContainerJustifyContent:this.pageContainerEl.style.justifyContent,pageContainerBackground:this.pageContainerEl.style.background,borderWrapperBoxShadow:this.borderWrapperEl.style.boxShadow,borderWrapperBackground:this.borderWrapperEl.style.background,borderWrapperTransform:this.borderWrapperEl.style.transform,borderWrapperBorder:this.borderWrapperEl.style.border,borderWrapperOutline:this.borderWrapperEl.style.outline,contentWrapperBackground:this.contentWrapperEl.style.background},this.pageContainerEl.style.padding="0",this.pageContainerEl.style.alignItems="stretch",this.pageContainerEl.style.justifyContent="stretch",this.pageContainerEl.style.background="transparent",this.borderWrapperEl.style.boxShadow="none",this.borderWrapperEl.style.transform="none",this.borderWrapperEl.style.border="none",this.borderWrapperEl.style.outline="none",this.borderWrapperEl.style.background="transparent",this.contentWrapperEl.style.background=e)}restoreReadingModeLayout(){if(!this.readingModeLayoutBackup||!this.pageContainerEl||!this.borderWrapperEl||!this.contentWrapperEl){this.readingModeLayoutBackup=null;return}this.pageContainerEl.style.padding=this.readingModeLayoutBackup.pageContainerPadding,this.pageContainerEl.style.alignItems=this.readingModeLayoutBackup.pageContainerAlignItems,this.pageContainerEl.style.justifyContent=this.readingModeLayoutBackup.pageContainerJustifyContent,this.pageContainerEl.style.background=this.readingModeLayoutBackup.pageContainerBackground,this.borderWrapperEl.style.boxShadow=this.readingModeLayoutBackup.borderWrapperBoxShadow,this.borderWrapperEl.style.transform=this.readingModeLayoutBackup.borderWrapperTransform,this.borderWrapperEl.style.border=this.readingModeLayoutBackup.borderWrapperBorder,this.borderWrapperEl.style.outline=this.readingModeLayoutBackup.borderWrapperOutline,this.borderWrapperEl.style.background=this.readingModeLayoutBackup.borderWrapperBackground,this.contentWrapperEl.style.background=this.readingModeLayoutBackup.contentWrapperBackground,this.readingModeLayoutBackup=null}rebuildReadingMode(){var r,o,s;if(!this.readingModeActive)return;let e=(o=(r=this.readingModePager)==null?void 0:r.getProgress())!=null?o:0;if(this.enableReadingMode())try{(s=this.readingModePager)==null||s.jumpToProgress(e)}catch(a){}}setReadOnlyProtection(e,n){this.isReadOnlyProtected===e&&this.readOnlyProtectionReason===(e?n!=null?n:"unsupported":null)||(this.isReadOnlyProtected=e,this.readOnlyProtectionReason=e?n!=null?n:"unsupported":null,this.updateReadOnlyState())}isEditorInputFocused(){var n,r;let e=document.activeElement;return e?((n=this.auxiliaryInputPanel)==null?void 0:n.textareaEl)===e?!0:!!((r=this.editorHostEl)!=null&&r.contains(e)):!1}withSuppressedEditorUpdates(e){if(this.suppressEditorUpdates){e();return}this.suppressEditorUpdates=!0;try{e()}finally{this.suppressEditorUpdates=!1}}registerFileWatchers(){let e=this.app.vault.on("modify",n=>{n instanceof de.TFile&&this.handleExternalFileModify(n)});this.registerEvent(e)}async handleExternalFileModify(e){var o;if(!this.syncManager)return;let n=this.syncManager.getState();if(!n.currentFilePath||e.path!==n.currentFilePath)return;let r=(o=this.plugin.settings.preview.updateInterval)!=null?o:300;if(r===0){try{await this.syncManager.handleExternalChange(e),await this.updateFrontmatterDisplay()}catch(s){console.error("Tategaki TipTap: failed to process external modification",s)}return}this.fileUpdateDebounceTimer!=null&&window.clearTimeout(this.fileUpdateDebounceTimer),this.fileUpdateDebounceTimer=window.setTimeout(async()=>{this.fileUpdateDebounceTimer=null;try{this.syncManager&&(await this.syncManager.handleExternalChange(e),await this.updateFrontmatterDisplay())}catch(s){console.error("Tategaki TipTap: failed to process external modification",s)}},r)}applyCursorSyncSetting(e){var n;if(this.stopCursorSync(),e.wysiwyg.syncCursor&&!this.cursorSyncPausedByFocus&&!this.cursorSyncPausedByAuxiliary){if((n=this.plainEditMode)!=null&&n.isPlainMode())return;this.startCursorSync()}}startCursorSync(){if(this.cursorSyncTimer!=null)return;let e=this.plugin.settings.preview.updateInterval||300;this.cursorSyncTimer=window.setInterval(()=>{this.pollExternalCursor()},e)}stopCursorSync(){var e;this.cursorSyncTimer!=null&&(window.clearInterval(this.cursorSyncTimer),this.cursorSyncTimer=null),this.cursorSyncDebounceTimer!=null&&(window.clearTimeout(this.cursorSyncDebounceTimer),this.cursorSyncDebounceTimer=null),this.pendingExternalCursor=null,this.lastExternalCursor=null;try{(e=this.editor)==null||e.commands.clearExternalCursor()}catch(n){}}pollExternalCursor(){var a;if(!this.editor||!this.syncManager||this.cursorSyncPausedByFocus||(a=this.plainEditMode)!=null&&a.isPlainMode())return;if(!this.plugin.settings.wysiwyg.syncCursor){this.stopCursorSync();return}let e=this.syncManager.getState();if(!e.currentFilePath){try{this.editor.commands.clearExternalCursor()}catch(l){}this.pendingExternalCursor=null,this.lastExternalCursor=null;return}let n=this.getMarkdownViewForFile(e.currentFilePath);if(!(n!=null&&n.file)||n.file.path!==e.currentFilePath)return;let r=n.editor.getCursor();if(!r||this.lastExternalCursor&&this.lastExternalCursor.line===r.line&&this.lastExternalCursor.ch===r.ch)return;this.lastExternalCursor={line:r.line,ch:r.ch};let o=n.editor.getValue();this.pendingExternalCursor={filePath:n.file.path,pos:{line:r.line,ch:r.ch},content:o},this.cursorSyncDebounceTimer!=null&&window.clearTimeout(this.cursorSyncDebounceTimer);let s=this.getExternalSyncInterval();s<=0?(this.cursorSyncDebounceTimer=null,this.applyExternalCursorFromPending()):this.cursorSyncDebounceTimer=window.setTimeout(()=>{this.cursorSyncDebounceTimer=null,this.applyExternalCursorFromPending()},s)}getMarkdownViewForFile(e){var o,s;let n=this.app.workspace.getActiveViewOfType(de.MarkdownView);if(((o=n==null?void 0:n.file)==null?void 0:o.path)===e)return n;let r=this.app.workspace.getLeavesOfType("markdown");for(let a of r){let l=a.view;if(l instanceof de.MarkdownView&&((s=l.file)==null?void 0:s.path)===e)return l}return null}getExternalSyncInterval(){var n;let e=(n=this.plugin.settings.preview.updateInterval)!=null?n:300;return Number.isFinite(e)?Math.max(0,e):300}async applyExternalCursorFromPending(){if(!this.editor||!this.editorHostEl||!this.syncManager)return;let e=this.pendingExternalCursor;if(!e)return;let n=this.syncManager.getState();if(!n.currentFilePath||n.currentFilePath!==e.filePath)return;let r=MN(e.pos,e.content),o=Vo(e.content),s=o.frontmatter.length;if(r<=s){try{this.editor.commands.clearExternalCursor()}catch(p){}return}let a=Math.max(0,r-s),l=wN(o.body,a),c=this.plugin.settings.wysiwyg.enableRuby!==!1,u=$o(zo(l),{enableRuby:c}),d=document.createElement("div");d.style.display="none",document.body.appendChild(d);let h=null,f=null;try{h=Ud({element:d,settings:this.plugin.settings,content:u}),f=this.findCursorMarkerPos(h.state.doc)}catch(p){Ee("Tategaki TipTap: failed to parse markdown for cursor sync",p)}finally{h&&h.destroy(),document.body.removeChild(d)}if(f==null){try{this.editor.commands.clearExternalCursor()}catch(p){}return}try{this.editor.commands.setExternalCursor(f),this.ensureExternalCursorVisible(f)}catch(p){Ee("Tategaki TipTap: failed to apply external cursor",p)}}findCursorMarkerPos(e){let n=null;try{e.descendants((r,o)=>{if(n!=null)return!1;if(r!=null&&r.isText&&typeof r.text=="string"){let s=r.text.indexOf(dE);if(s!==-1)return n=o+s,!1}return!0})}catch(r){return null}return n}isFocusInsideView(e){var r;if(!e||!(e instanceof Node))return!1;let n=(r=this.viewRootEl)!=null?r:this.editorHostEl;return n?n.contains(e):!1}isRecentPointerDownInsideView(e){return this.lastPointerDownInsideViewAt?Date.now()-this.lastPointerDownInsideViewAt<=e:!1}getLeafRootEl(){return this.containerEl?this.containerEl.closest(".workspace-leaf"):null}isPointerInsideLeaf(e){if(!e||!(e instanceof Node))return!1;let n=this.getLeafRootEl();return n?n.contains(e):!1}isRecentPointerDownInsideLeaf(e){return this.lastPointerDownInsideLeafAt?Date.now()-this.lastPointerDownInsideLeafAt<=e:!1}setupCursorSyncFocusGuards(){var n;if(!this.editorHostEl||this.cursorFocusInHandler||this.cursorFocusOutHandler||this.cursorPointerDownHandler||this.cursorGlobalPointerDownHandler)return;let e=(n=this.viewRootEl)!=null?n:this.editorHostEl;this.cursorFocusInHandler=()=>{this.cursorSyncPausedByFocus=!0,this.stopCursorSync()},this.cursorFocusOutHandler=r=>{this.isFocusInsideView(r.relatedTarget)||this.isPointerInsideLeaf(r.relatedTarget)||!r.relatedTarget&&(this.isRecentPointerDownInsideView(200)||this.isRecentPointerDownInsideLeaf(200))||(this.captureCurrentInsertionRange(),this.cursorSyncPausedByFocus=!1,window.setTimeout(()=>{this.cursorSyncPausedByAuxiliary||this.cursorSyncPausedByFocus||this.isFocusInsideView(document.activeElement)||this.plugin.settings.wysiwyg.syncCursor&&this.startCursorSync()},0))},this.cursorPointerDownHandler=()=>{this.lastPointerDownInsideViewAt=Date.now(),this.lastPointerDownInsideLeafAt=this.lastPointerDownInsideViewAt},this.cursorGlobalPointerDownHandler=r=>{var s;let o=Date.now();if(this.isPointerInsideLeaf(r.target)){this.lastPointerDownInsideLeafAt=o,this.isFocusInsideView(r.target)&&(this.lastPointerDownInsideViewAt=o);return}this.cursorSyncPausedByFocus&&(this.lastPointerDownInsideViewAt=0,this.lastPointerDownInsideLeafAt=0,this.captureCurrentInsertionRange(),this.cursorSyncPausedByFocus=!1,this.plugin.settings.wysiwyg.syncCursor&&!this.cursorSyncPausedByAuxiliary&&!((s=this.plainEditMode)!=null&&s.isPlainMode())&&this.startCursorSync())},e.addEventListener("focusin",this.cursorFocusInHandler,!0),e.addEventListener("focusout",this.cursorFocusOutHandler,!0),e.addEventListener("pointerdown",this.cursorPointerDownHandler,!0),document.addEventListener("pointerdown",this.cursorGlobalPointerDownHandler,!0)}teardownCursorSyncFocusGuards(){var n;let e=(n=this.viewRootEl)!=null?n:this.editorHostEl;e&&this.cursorFocusInHandler&&e.removeEventListener("focusin",this.cursorFocusInHandler,!0),e&&this.cursorFocusOutHandler&&e.removeEventListener("focusout",this.cursorFocusOutHandler,!0),e&&this.cursorPointerDownHandler&&e.removeEventListener("pointerdown",this.cursorPointerDownHandler,!0),this.cursorGlobalPointerDownHandler&&document.removeEventListener("pointerdown",this.cursorGlobalPointerDownHandler,!0),this.cursorFocusInHandler=null,this.cursorFocusOutHandler=null,this.cursorPointerDownHandler=null,this.cursorGlobalPointerDownHandler=null,this.cursorSyncPausedByFocus=!1,this.cursorSyncPausedByAuxiliary=!1,this.lastPointerDownInsideViewAt=0,this.lastPointerDownInsideLeafAt=0}ensureExternalCursorVisible(e){if(this.readingModeActive||!this.editor||!this.editorHostEl)return;let n=this.getScrollableElement(!0);if(!n)return;let r=Math.max(0,this.editor.state.doc.content.size),o=Math.max(0,Math.min(e,r)),s;try{s=this.editor.view.coordsAtPos(o)}catch(u){return}let a=n.getBoundingClientRect(),l=20;if(this.plugin.settings.common.writingMode==="vertical-rl"){let u=0;s.right<a.left+l?u=a.left-s.right+l:s.left>a.right-l&&(u=a.right-s.left-l),u!==0&&(n.scrollLeft-=u);return}s.top<a.top+l?n.scrollTop-=a.top-s.top+l:s.bottom>a.bottom-l&&(n.scrollTop+=s.bottom-a.bottom+l)}applySettingsToEditor(e){var h,f,p;if(!this.editorHostEl||!this.editor||!this.editorAreaEl)return;let n=typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common;this.applyPageLayout(e);let r=this.editorAreaEl;r.style.setProperty("--tategaki-writing-mode",n.writingMode),r.style.setProperty("--tategaki-font-family",n.fontFamily),r.style.setProperty("--tategaki-font-size",`${n.fontSize}px`),r.style.setProperty("--tategaki-line-height",`${n.lineHeight}`),r.style.setProperty("--tategaki-letter-spacing",`${n.letterSpacing}em`),r.style.setProperty("--tategaki-text-color",n.textColor),r.style.setProperty("--tategaki-background-color",n.backgroundColor),r.style.setProperty("--tategaki-accent-color",n.accentColor);let o=this.resolveCaretColor(e,n);r.style.setProperty("--tategaki-caret-color",o);let s=(h=n.rubyVerticalGap)!=null?h:ae.common.rubyVerticalGap,a=(f=n.rubyHorizontalGap)!=null?f:ae.common.rubyHorizontalGap;r.style.setProperty("--tategaki-ruby-gap-vertical",`${s}em`),r.style.setProperty("--tategaki-ruby-gap-horizontal",`${a}em`);let c=Math.max(.2,Math.min(1,(p=n.rubySize)!=null?p:.5)).toString();r.style.setProperty("--tategaki-ruby-size",c),r.style.setProperty("--ruby-size",c);let u=n.headingFontFamily||n.fontFamily,d=n.headingTextColor||n.textColor;r.style.setProperty("--tategaki-heading-font-family",u),r.style.setProperty("--tategaki-heading-text-color",d),this.editorHostEl.setAttribute("data-writing-mode",n.writingMode),this.withSuppressedEditorUpdates(()=>{var m;(m=this.editor)==null||m.commands.setWritingMode(n.writingMode)}),this.applyScrollbarVisibility(n.writingMode),this.applyEditorPadding(e),this.auxiliaryInputPanel?this.addAuxiliaryPanelPadding():this.removeAuxiliaryPanelPadding()}resolveCaretColor(e,n){var o,s;let r=(o=e.wysiwyg.caretColorMode)!=null?o:"accent";if(r==="text")return n.textColor;if(r==="custom"){let a=(s=e.wysiwyg.caretCustomColor)==null?void 0:s.trim();if(a)return a}return n.accentColor}applyEditorPadding(e){var n,r;this.editorHostEl&&(this.editorPaddingTopPx=(n=e.wysiwyg.sotPaddingTop)!=null?n:32,this.editorPaddingBottomPx=(r=e.wysiwyg.sotPaddingBottom)!=null?r:16,this.editorHostEl.style.paddingTop=`${this.editorPaddingTopPx}px`,this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx}px`)}applyPageLayout(e){var p,m,g,b;let n=typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common,r=Number((p=n.pageScale)!=null?p:1),o=r>1,s=o?1:Math.max(.7,Math.min(1,r)),l=Math.max(.2,Math.min(1,(m=n.rubySize)!=null?m:.5)).toString(),c=(g=n.rubyVerticalGap)!=null?g:ae.common.rubyVerticalGap,u=(b=n.rubyHorizontalGap)!=null?b:ae.common.rubyHorizontalGap,d=`${c}em`,h=`${u}em`;this.borderWrapperEl&&(this.borderWrapperEl.style.transformOrigin="center center",this.borderWrapperEl.style.transform=`scale(${o?1:s})`,this.borderWrapperEl.style.boxShadow=o?"none":"0 6px 12px rgba(0,0,0,0.4)",this.borderWrapperEl.style.setProperty("background",n.backgroundColor,"important"),this.borderWrapperEl.style.setProperty("border","none","important"),this.borderWrapperEl.style.setProperty("outline","none","important")),this.pageContainerEl&&(this.pageContainerEl.style.alignItems=o?"stretch":"center",this.pageContainerEl.style.justifyContent=o?"stretch":"center",this.pageContainerEl.style.padding=o?"0":"40px 32px 22px 32px",this.pageContainerEl.style.background="transparent");let f=this.containerEl.children[1];if(f&&(f.style.background=o?n.backgroundColor:n.pageBackgroundColor),this.contentWrapperEl&&(this.contentWrapperEl.style.background=n.backgroundColor,this.contentWrapperEl.style.color=n.textColor,this.contentWrapperEl.style.letterSpacing=`${n.letterSpacing}em`,this.contentWrapperEl.style.setProperty("--tategaki-font-family",n.fontFamily),this.contentWrapperEl.style.setProperty("--tategaki-font-size",`${n.fontSize}px`),this.contentWrapperEl.style.setProperty("--tategaki-line-height",n.lineHeight.toString()),this.contentWrapperEl.style.setProperty("--tategaki-letter-spacing",`${n.letterSpacing}em`),this.contentWrapperEl.style.setProperty("--tategaki-text-color",n.textColor),this.contentWrapperEl.style.setProperty("--tategaki-background-color",n.backgroundColor),this.contentWrapperEl.style.setProperty("--tategaki-ruby-size",l),this.contentWrapperEl.style.setProperty("--ruby-size",l),this.contentWrapperEl.style.setProperty("--tategaki-ruby-gap-vertical",d),this.contentWrapperEl.style.setProperty("--tategaki-ruby-gap-horizontal",h)),this.editorHostEl){let v=this.editorHostEl.querySelector(".ProseMirror");if(v){let y=v.querySelector("style[data-tategaki-heading-style]");y&&y.remove();let E=document.createElement("style");E.setAttribute("data-tategaki-heading-style","true"),E.textContent=`
					.ProseMirror h1,
					.ProseMirror h2,
					.ProseMirror h3,
					.ProseMirror h4,
					.ProseMirror h5,
					.ProseMirror h6,
					.ProseMirror p {
						color: ${n.textColor} !important;
						line-height: ${n.lineHeight} !important;
					}
				`,v.appendChild(E)}}}applyScrollbarVisibility(e){if(!this.editorHostEl)return;let n=e==="horizontal-tb";this.editorHostEl.style.overflowX=n?"hidden":"scroll",this.editorHostEl.style.overflowY=n?"scroll":"hidden",this.editorHostEl.style.scrollbarGutter="stable"}async updateFrontmatterDisplay(){var o;let e=++this.frontmatterUpdateToken;if(this.frontmatterContainer&&(this.frontmatterContainer.remove(),this.frontmatterContainer=null),!this.editorHostEl||!this.editor)return;let n=this.getCurrentFilePath();if(!n)return;let r=this.app.vault.getAbstractFileByPath(n);if(r instanceof de.TFile){this.currentFile=r;try{let s=await this.app.vault.read(r);if(e!==this.frontmatterUpdateToken||this.getCurrentFilePath()!==r.path)return;let a=this.plugin.settings,{frontmatter:l}=this.parseFrontmatter(s);if(l&&!a.preview.hideFrontmatter){let c=this.renderFrontmatter(l,a);if(c){this.applyFrontmatterWritingMode(c,a.common.writingMode);let u=(o=this.editor.view)==null?void 0:o.dom;u&&this.editorHostEl.contains(u)?this.editorHostEl.insertBefore(c,u):this.editorHostEl.appendChild(c),this.frontmatterContainer=c}}}catch(s){console.error("[Tategaki] Failed to update frontmatter display:",s)}typeof this.leaf.updateHeader=="function"&&this.leaf.updateHeader(),this.updatePaneHeaderTitle(),this.readingModeActive&&this.rebuildReadingMode()}}parseFrontmatter(e){let n=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=e.match(n);if(!r)return{frontmatter:null,contentWithoutFrontmatter:e};let o=r[1],s=e.slice(r[0].length),a={},l=o.split(`
`),c="",u=[],d=!1;for(let h of l){let f=h.trim();if(!f||f.startsWith("#"))continue;if(f.startsWith("- ")){d&&u.push(f.slice(2).trim());continue}d&&!f.startsWith("- ")&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u),d=!1,u=[]);let p=f.indexOf(":");if(p!==-1){let m=f.slice(0,p).trim(),g=f.slice(p+1).trim();switch(m){case"title":a.title=g,c=m;break;case"subtitle":a.subtitle=g,c=m;break;case"original_title":a.original_title=g,c=m;break;case"author":a.author=g,c=m;break;case"translator":a.translator=g,c=m;break;case"co_authors":g?a.co_authors=[g]:(d=!0,c=m,u=[]);break;case"co_translators":g?a.co_translators=[g]:(d=!0,c=m,u=[]);break}}}return d&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u)),{frontmatter:Object.keys(a).length>0?a:null,contentWithoutFrontmatter:s}}renderFrontmatter(e,n){let r=document.createElement("div");r.className="tategaki-frontmatter";let o=!1,s=r.createDiv("tategaki-frontmatter-top");if(e.title&&n.preview.showFrontmatterTitle){let l=s.createEl("h1",{cls:"tategaki-frontmatter-title"});l.textContent=e.title,o=!0}if(e.subtitle&&n.preview.showFrontmatterSubtitle){let l=s.createEl("h2",{cls:"tategaki-frontmatter-subtitle"});l.textContent=e.subtitle,o=!0}if(e.original_title&&n.preview.showFrontmatterOriginalTitle){let l=s.createEl("h2",{cls:"tategaki-frontmatter-original-title"});l.textContent=e.original_title,o=!0}let a=r.createDiv("tategaki-frontmatter-bottom");if(e.author&&n.preview.showFrontmatterAuthor){let l=a.createEl("h4",{cls:"tategaki-frontmatter-author"});l.textContent=e.author,this.applyFrontmatterInlineEndAlignment(l),o=!0}if(e.co_authors&&n.preview.showFrontmatterCoAuthors)for(let l of e.co_authors){let c=a.createEl("h4",{cls:"tategaki-frontmatter-co-author"});c.textContent=l,this.applyFrontmatterInlineEndAlignment(c),o=!0}if(e.translator&&n.preview.showFrontmatterTranslator){let l=a.createEl("h5",{cls:"tategaki-frontmatter-translator"});l.textContent=e.translator,this.applyFrontmatterInlineEndAlignment(l),o=!0}if(e.co_translators&&n.preview.showFrontmatterCoTranslators)for(let l of e.co_translators){let c=a.createEl("h5",{cls:"tategaki-frontmatter-co-translator"});c.textContent=l,this.applyFrontmatterInlineEndAlignment(c),o=!0}return o?r:null}applyFrontmatterInlineEndAlignment(e){e.style.display="block",e.style.setProperty("text-align","end","important"),e.style.setProperty("text-align-last","end","important"),e.style.marginInlineStart="auto",e.style.marginInlineEnd="0",e.style.marginLeft="auto",e.style.marginRight="0",e.style.justifySelf="end"}applyFrontmatterWritingMode(e,n){e.style.writingMode=n,e.style.textOrientation="mixed"}setupWheelScroll(){if(!this.editorHostEl)return;this.boundWheelHandler&&(this.editorHostEl.removeEventListener("wheel",this.boundWheelHandler),this.boundWheelHandler=null);let e=n=>this.handleWheel(n);this.boundWheelHandler=e,this.editorHostEl.addEventListener("wheel",e,{passive:!1})}teardownWheelScroll(){!this.editorHostEl||!this.boundWheelHandler||(this.editorHostEl.removeEventListener("wheel",this.boundWheelHandler),this.boundWheelHandler=null,this.wheelThrottleTimer=null)}handleWheel(e){if(this.readingModeActive||!this.editorHostEl)return;let n=this.plugin.settings.common.writingMode==="horizontal-tb",{deltaX:r,deltaY:o,shiftKey:s}=e,a=this.getScrollableElement(!0);if(a){if(n){if(!s)return;e.preventDefault(),this.throttledWheelScroll(()=>{a.scrollLeft-=o});return}s||(e.preventDefault(),this.throttledWheelScroll(()=>{let l=-o*.8+r;a.scrollLeft+=l}))}}throttledWheelScroll(e){this.wheelThrottleTimer===null&&(e(),this.wheelThrottleTimer=window.setTimeout(()=>{this.wheelThrottleTimer=null},16))}getScrollableElement(e){var r,o;let n=[this.editorHostEl,(o=(r=this.editor)==null?void 0:r.view.dom)!=null?o:null];for(let s of n)if(s){if(e){if(s.scrollWidth-s.clientWidth>1)return s}else if(s.scrollHeight-s.clientHeight>1)return s}return this.editorHostEl}async loadFile(e){var n,r;await((n=this.syncManager)==null?void 0:n.loadFile(e)),await this.updateFrontmatterDisplay(),(r=this.formattingToolbar)==null||r.updateReadingModeButton(),this.readingModeActive&&this.rebuildReadingMode()}getCurrentFilePath(){var e,n,r;return(r=(n=(e=this.syncManager)==null?void 0:e.getState())==null?void 0:n.currentFilePath)!=null?r:null}async checkUnsavedChanges(){var r;if(!((r=this.syncManager)!=null&&r.hasUnsavedChanges()))return!0;let e=new tr(this.app);switch(e.open(),await e.waitForChoice()){case"save":return await this.syncManager.triggerManualSync(),this.syncManager.clearDirtyFlag(),!0;case"discard":return this.syncManager.clearDirtyFlag(),!0;case"cancel":default:return!1}}async requestSave(){if(this.isReadOnlyProtected||!this.syncManager||!this.syncManager.hasUnsavedChanges()||this.plugin.settings.wysiwyg.syncMode!=="manual")return;let n=await new tr(this.app,"\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002\u30BF\u30D6\u3092\u9589\u3058\u308B\u524D\u306B\u4FDD\u5B58\u3057\u307E\u3059\u304B\uFF1F").waitForChoice();if(n==="save")await this.syncManager.triggerManualSync();else if(n==="discard")this.syncManager.clearDirtyFlag();else if(n==="cancel")throw new Error("User cancelled")}async handleAppQuit(e){if(this.syncManager&&!this.isReadOnlyProtected){if(e==="save"){this.flushPendingEditorUpdate(),await this.syncManager.flush();return}this.updateDebounceTimer!=null&&(window.clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null,this.pendingUpdate=!1),this.syncManager.clearDirtyFlag()}}getState(){return{}}},_r=Sh;_r.UNSUPPORTED_HTML_CANCEL_COOLDOWN_MS=1200;var ze=require("obsidian");var _t="tategaki-reading-view",ml=class extends ze.ItemView{constructor(e,n){super(e);this.rootEl=null;this.hostEl=null;this.toolbarLeftEl=null;this.toolbarRightEl=null;this.modeBadgeEl=null;this.writingModeButton=null;this.readingModeButton=null;this.outlineButton=null;this.rubyToggleButton=null;this.searchButton=null;this.pinButton=null;this.outlinePanelEl=null;this.outlineItems=[];this.pager=null;this.filePath=null;this.returnViewMode="sot";this.pendingState=null;this.isReady=!1;this.renderToken=0;this.renderTimer=null;this.plugin=n}getViewType(){return _t}getDisplayText(){let e=this.getDisplayFile(),n=this.getFrontmatterTitle(e);return n?`Tategaki \u66F8\u7C4D: - ${n} -`:"Tategaki \u66F8\u7C4D"}getState(){var e;return{filePath:(e=this.filePath)!=null?e:void 0,returnViewMode:this.returnViewMode}}async setState(e,n){if(e!=null&&e.filePath?this.filePath=e.filePath:this.filePath=null,e!=null&&e.returnViewMode&&(this.returnViewMode=e.returnViewMode==="preview"?"edit":e.returnViewMode,this.updateReturnButton()),!this.isReady){this.pendingState=e;return}this.scheduleRender()}async onOpen(){var u,d;let e=this.containerEl.children[1];e.empty(),e.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			min-height: 0;
			overflow: hidden;
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		`;let n="(hover: none) and (pointer: coarse) and (max-width: 700px)",r=()=>{let h=this.containerEl.querySelector(".view-header"),f=h?Math.ceil(h.getBoundingClientRect().height):0;e.style.setProperty("--tategaki-view-header-height",`${f}px`);let p=window.matchMedia(n).matches;e.style.paddingTop=p?"calc(var(--tategaki-safe-area-top, 0px) + var(--tategaki-view-header-height, 0px))":"0px",e.style.paddingBottom=p?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};r(),window.setTimeout(r,0),this.registerDomEvent(window,"resize",r);let o=this.containerEl.querySelector(".view-header");if(o&&"ResizeObserver"in window){let h=new ResizeObserver(()=>{r()});h.observe(o),this.register(()=>h.disconnect())}let s=e.createDiv("tategaki-reading-toolbar-row");s.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			flex: 0 0 auto;
			padding: 0;
			background: var(--background-secondary);
			border-bottom: 1px solid var(--background-modifier-border);
		`;let a=s.createDiv();a.style.cssText=`
			display: flex;
			align-items: center;
			flex: 1;
			min-width: 0;
		`,this.toolbarLeftEl=a;let l=s.createDiv();l.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 0 8px;
			flex-shrink: 0;
		`,this.toolbarRightEl=l,this.buildToolbar(a,l);let c=e.createDiv("tategaki-reading-view-area");if(c.style.cssText=`
			position: relative;
			flex: 1 1 auto;
			min-height: 0;
			width: 100%;
			overflow: hidden;
			display: flex;
		`,this.rootEl=c.createDiv("tategaki-reading-view-root"),this.rootEl.style.cssText=`
			position: relative;
			flex: 1 1 auto;
			min-width: 0;
			min-height: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
			box-sizing: border-box;
			background: var(--tategaki-page-background-color, var(--background-primary));
		`,this.hostEl=this.rootEl.createDiv("tategaki-reading-view-host"),this.hostEl.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
			overflow: hidden;
		`,this.isReady=!0,(u=this.pendingState)!=null&&u.filePath&&(this.filePath=this.pendingState.filePath),(d=this.pendingState)!=null&&d.returnViewMode&&(this.returnViewMode=this.pendingState.returnViewMode==="preview"?"edit":this.pendingState.returnViewMode),this.pendingState=null,this.updateReturnButton(),!this.filePath){window.setTimeout(()=>{if(!this.filePath){try{this.leaf.detach()}catch(h){}return}this.registerFileWatchers(),this.scheduleRender()},0);return}this.registerFileWatchers(),this.scheduleRender()}async onClose(){this.clearRenderTimer(),this.destroyPager(),this.outlinePanelEl&&(this.outlinePanelEl.remove(),this.outlinePanelEl=null),this.rootEl=null,this.hostEl=null,this.toolbarLeftEl=null,this.toolbarRightEl=null,this.modeBadgeEl=null,this.writingModeButton=null,this.readingModeButton=null,this.outlineButton=null,this.rubyToggleButton=null,this.searchButton=null,this.pinButton=null,this.outlineItems=[],this.isReady=!1,this.pendingState=null,this.returnViewMode="sot"}updateSettings(e){return this.plugin.settings=e,this.updateWritingModeButton(),this.scheduleRender(),Promise.resolve()}getCurrentFilePath(){return this.filePath}getReturnViewMode(){return this.returnViewMode}buildToolbar(e,n){e.empty(),n.empty(),this.applyToolbarLayout(e),this.writingModeButton=this.createToolbarButton(e,"arrow-down-up","\u66F8\u5B57\u65B9\u5411\u5207\u308A\u66FF\u3048",()=>void this.toggleWritingMode()),this.updateWritingModeButton(),this.createSeparator(e),this.outlineButton=this.createToolbarButton(e,"list-tree","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",()=>this.toggleOutlinePanel()),this.createSeparator(e),this.readingModeButton=this.createToolbarButton(e,"corner-left-up","\u623B\u308B",()=>this.exitReadingView()),this.setButtonActive(this.readingModeButton,!0),this.updateReturnButton();let r=n.createDiv();r.textContent="\u66F8\u7C4D",r.style.cssText=`
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 2px 8px;
			border-radius: 999px;
			background: var(--background-modifier-hover);
			border: 1px solid var(--background-modifier-border);
			color: var(--text-normal);
			font-size: 11px;
			white-space: nowrap;
		`,this.modeBadgeEl=r}applyToolbarLayout(e){if(e.addClass("contenteditable-toolbar"),ze.Platform.isMobile||ze.Platform.isMobileApp){e.addClass("tiptap-toolbar-mobile"),e.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				flex-wrap: nowrap;
				flex: 1 1 auto;
				min-width: 0;
				width: 100%;
				max-width: 100%;
				overflow-x: auto;
				overflow-y: hidden;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				touch-action: pan-x;
				overscroll-behavior-x: contain;
			`;let r=e.ownerDocument;if(!r.getElementById("tategaki-reading-toolbar-mobile-scrollbar-style")){let o=r.createElement("style");o.id="tategaki-reading-toolbar-mobile-scrollbar-style",o.textContent=`
					.tiptap-toolbar-mobile::-webkit-scrollbar {
						display: none;
					}
					.tiptap-toolbar-mobile .contenteditable-toolbar-button,
					.tiptap-toolbar-mobile .contenteditable-toolbar-separator {
						flex: 0 0 auto;
					}
				`,r.head.appendChild(o)}}else e.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				flex-wrap: wrap;
				flex: 1 1 auto;
				min-width: 0;
			`}createToolbarButton(e,n,r,o){let s=e.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":r}});return(0,ze.setIcon)(s,n),s.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),o()}),s}createDisabledToolbarButton(e,n,r){let o=e.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":r,"aria-disabled":"true"}});return(0,ze.setIcon)(o,n),o.disabled=!0,o.style.opacity="0.35",o}createSeparator(e){let n=e.createDiv("contenteditable-toolbar-separator");n.style.cssText=`
			width: 1px;
			height: 24px;
			background-color: var(--background-modifier-border);
			margin: 0 4px;
		`}setButtonActive(e,n){e&&(n?(e.addClass("is-active"),e.style.backgroundColor="var(--interactive-accent)",e.style.color="var(--text-on-accent)"):(e.removeClass("is-active"),e.style.backgroundColor="",e.style.color=""))}updateWritingModeButton(){if(!this.writingModeButton)return;let n=this.getEffectiveCommonSettings().writingMode==="vertical-rl";this.writingModeButton.empty();let r=this.writingModeButton.createSpan();(0,ze.setIcon)(r,n?"arrow-down-up":"arrow-left-right"),this.writingModeButton.setAttribute("aria-label",n?"\u6A2A\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048":"\u7E26\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048")}updateReturnButton(){if(!this.readingModeButton)return;let e=this.getReturnViewLabel();this.readingModeButton.empty();let n=this.readingModeButton.createSpan();(0,ze.setIcon)(n,"corner-left-up"),this.readingModeButton.setAttribute("aria-label",`${e}\u3078\u623B\u308B`)}async toggleWritingMode(){let n=this.plugin.settings.common.writingMode==="vertical-rl"?"horizontal-tb":"vertical-rl";try{await this.plugin.updateSettings({common:{...this.plugin.settings.common,writingMode:n}})}catch(r){console.error("[Tategaki] Failed to toggle writing mode",r),new ze.Notice("\u66F8\u5B57\u65B9\u5411\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}openSettingsPanel(){let e=this.getReturnViewLabel();new ze.Notice(`\u8868\u793A\u8A2D\u5B9A\u3092\u958B\u304F\u305F\u3081\u3001${e}\u3078\u5207\u308A\u66FF\u3048\u307E\u3059\u3002`,2e3),this.returnToOriginView().finally(()=>{let n=this.returnViewMode==="edit"?"compat":"sot";new Tn(this.app,this.plugin,async o=>{await this.plugin.updateSettings(o)},{mode:n}).open()})}exitReadingView(){this.returnToOriginView()}getReturnViewLabel(){switch(this.returnViewMode){case"sot":return"SoT\u7DE8\u96C6\u30D3\u30E5\u30FC";case"edit":return"\u4E92\u63DB\u30E2\u30FC\u30C9";default:return"\u4E92\u63DB\u30E2\u30FC\u30C9"}}async returnToOriginView(){let e=this.getDisplayFile();if(!e){new ze.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}if(this.returnViewMode==="sot"){await this.plugin.modeManager.openSoTWysiwygViewInLeaf(e,this.leaf);return}await this.plugin.modeManager.openTipTapViewInLeaf(e,this.leaf,this.returnViewMode)}toggleOutlinePanel(){if(!this.rootEl)return;if(this.outlinePanelEl){this.outlinePanelEl.remove(),this.outlinePanelEl=null;return}let e=this.rootEl.createDiv("tategaki-reading-outline-panel");e.style.cssText=`
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			width: 280px;
			background: color-mix(in srgb, var(--background-primary) 80%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			border-left: 1px solid var(--background-modifier-border);
			z-index: 900;
			overflow: auto;
			padding: 8px 0;
		`,this.outlinePanelEl=e,this.renderOutline(e)}renderOutline(e){e.empty();let n=e.createDiv();n.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 8px 12px;
			border-bottom: 1px solid var(--background-modifier-border);
			font-weight: 600;
			position: sticky;
			top: 0;
			background: color-mix(in srgb, var(--background-primary) 90%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			z-index: 1;
		`,n.createSpan({text:"\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3"});let r=n.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":"\u9589\u3058\u308B"}});(0,ze.setIcon)(r,"x"),r.addEventListener("click",s=>{s.preventDefault(),this.toggleOutlinePanel()});let o=e.createDiv();if(o.style.cssText="padding: 6px 0;",this.outlineItems.length===0){let s=o.createDiv();s.textContent="\u898B\u51FA\u3057\u304C\u3042\u308A\u307E\u305B\u3093",s.style.cssText="padding: 8px 12px; color: var(--text-muted);";return}for(let s of this.outlineItems){let a=o.createDiv();a.style.cssText=`
				padding: 6px 12px;
				cursor: pointer;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				padding-left: ${12+Math.max(0,s.level-1)*12}px;
			`,a.textContent=s.text,a.addEventListener("click",l=>{var c;l.preventDefault(),(c=this.pager)==null||c.scrollToPage(s.pageIndex,!0)})}}appendOutlineItemsFromPage(e,n){var s,a;let r=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")),o=!1;for(let l of r){let c=(a=(s=l.textContent)==null?void 0:s.trim())!=null?a:"";if(!c)continue;let u=Number(l.tagName.replace("H",""))||1;this.outlineItems.push({level:u,text:c,pageIndex:n}),o=!0}o&&this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)}updateOutlineItems(e){let n=[];e.forEach((r,o)=>{var a,l;let s=Array.from(r.querySelectorAll("h1, h2, h3, h4, h5, h6"));for(let c of s){let u=(l=(a=c.textContent)==null?void 0:a.trim())!=null?l:"";if(!u)continue;let d=Number(c.tagName.replace("H",""))||1;n.push({level:d,text:u,pageIndex:o})}}),this.outlineItems=n,this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)}registerFileWatchers(){this.registerEvent(this.app.vault.on("modify",e=>{e instanceof ze.TFile&&e.path===this.filePath&&this.scheduleRender()})),this.registerEvent(this.app.vault.on("rename",(e,n)=>{e instanceof ze.TFile&&this.filePath&&n===this.filePath&&(this.filePath=e.path,this.leaf.setViewState({type:_t,state:{filePath:e.path},active:!1}),this.scheduleRender())})),this.registerEvent(this.app.vault.on("delete",e=>{if(e instanceof ze.TFile&&this.filePath&&e.path===this.filePath){this.filePath=null;try{this.leaf.detach()}catch(n){}}}))}scheduleRender(){this.isReady&&(this.clearRenderTimer(),this.renderTimer=window.setTimeout(()=>{this.renderTimer=null,this.render()},80))}clearRenderTimer(){this.renderTimer!==null&&(window.clearTimeout(this.renderTimer),this.renderTimer=null)}async render(){let e=++this.renderToken;if(!this.hostEl||!this.filePath)return;let n=this.app.vault.getAbstractFileByPath(this.filePath);if(!(n instanceof ze.TFile)){this.destroyPager(),this.hostEl.empty();return}let r="";try{r=await this.app.vault.read(n)}catch(u){console.error("[Tategaki] Failed to read reading view file",u);return}if(e!==this.renderToken)return;let o=this.plugin.settings,s=this.getEffectiveCommonSettings(),a=this.buildSnapshotHtml(r,n.path,o,s);this.destroyPager(),this.hostEl.empty(),this.outlineItems=[],this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl);let l=this.getFrontmatterTitle(n),c=l!=null?l:n.basename;try{this.pager=new Ir({container:this.hostEl,contentHtml:a,writingMode:s.writingMode,settings:s,previewSettings:o.preview,title:c,onPageAdded:(u,d)=>{this.appendOutlineItemsFromPage(u,d)},onRepaginationRequired:()=>{let u=this.getReturnViewLabel();new ze.Notice(`\u30EC\u30A4\u30A2\u30A6\u30C8\u5909\u66F4\u3092\u691C\u51FA\u3057\u305F\u305F\u3081\u3001${u}\u3078\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002`,2500),this.exitReadingView()},onRendered:({pages:u})=>{this.updateOutlineItems(u)}})}catch(u){console.error("[Tategaki] Failed to start reading view",u),this.pager=null}}destroyPager(){if(this.pager){try{this.pager.destroy()}catch(e){}this.pager=null,this.outlineItems=[],this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)}}buildSnapshotHtml(e,n,r,o){var p,m;let s=Vo(e),a=r.wysiwyg.enableRuby!==!1,l=zo(s.body),c=$o(l,{enableRuby:a,contextFilePath:n,resolveImageSrc:(g,b)=>this.resolveImageSrc(g,b)}),u=(m=(p=this.hostEl)==null?void 0:p.ownerDocument)!=null?m:document,d=u.createElement("div");d.className="tategaki-reading-view-snapshot";let{frontmatter:h}=this.parseFrontmatter(e);if(h&&!r.preview.hideFrontmatter){let g=this.renderFrontmatter(h,r);g&&(this.applyFrontmatterWritingMode(g,o.writingMode),d.appendChild(g))}let f=u.createElement("div");return f.className="tiptap ProseMirror",f.setAttribute("contenteditable","false"),f.innerHTML=c,d.appendChild(f),d.innerHTML}resolveImageSrc(e,n){var l;let r=String(e||"").trim();if(!r||/^(https?:|data:|app:|obsidian:|file:)/i.test(r))return r;let s=((l=r.split("#")[0])!=null?l:r).replace(/^\.\//,"");if(!n)return r;let a=this.app.metadataCache.getFirstLinkpathDest(s,n);if(!a)return r;try{return this.app.vault.getResourcePath(a)}catch(c){return r}}parseFrontmatter(e){let n=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=e.match(n);if(!r)return{frontmatter:null,contentWithoutFrontmatter:e};let o=r[1],s=e.slice(r[0].length),a={},l=o.split(`
`),c="",u=[],d=!1;for(let h of l){let f=h.trim();if(!f||f.startsWith("#"))continue;if(f.startsWith("- ")){d&&u.push(f.slice(2).trim());continue}d&&!f.startsWith("- ")&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u),d=!1,u=[]);let p=f.indexOf(":");if(p!==-1){let m=f.slice(0,p).trim(),g=f.slice(p+1).trim();switch(m){case"title":a.title=g,c=m;break;case"subtitle":a.subtitle=g,c=m;break;case"original_title":a.original_title=g,c=m;break;case"author":a.author=g,c=m;break;case"translator":a.translator=g,c=m;break;case"co_authors":g?a.co_authors=[g]:(d=!0,c=m,u=[]);break;case"co_translators":g?a.co_translators=[g]:(d=!0,c=m,u=[]);break}}}return d&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u)),{frontmatter:Object.keys(a).length>0?a:null,contentWithoutFrontmatter:s}}renderFrontmatter(e,n){var c,u;let r=(u=(c=this.hostEl)==null?void 0:c.ownerDocument)!=null?u:document,o=r.createElement("div");o.className="tategaki-frontmatter";let s=!1,a=r.createElement("div");if(a.className="tategaki-frontmatter-top",o.appendChild(a),e.title&&n.preview.showFrontmatterTitle){let d=r.createElement("h1");d.className="tategaki-frontmatter-title",d.textContent=e.title,a.appendChild(d),s=!0}if(e.subtitle&&n.preview.showFrontmatterSubtitle){let d=r.createElement("h2");d.className="tategaki-frontmatter-subtitle",d.textContent=e.subtitle,a.appendChild(d),s=!0}if(e.original_title&&n.preview.showFrontmatterOriginalTitle){let d=r.createElement("h2");d.className="tategaki-frontmatter-original-title",d.textContent=e.original_title,a.appendChild(d),s=!0}let l=r.createElement("div");if(l.className="tategaki-frontmatter-bottom",o.appendChild(l),e.author&&n.preview.showFrontmatterAuthor){let d=r.createElement("h4");d.className="tategaki-frontmatter-author",d.textContent=e.author,this.applyFrontmatterInlineEndAlignment(d),l.appendChild(d),s=!0}if(e.co_authors&&n.preview.showFrontmatterCoAuthors)for(let d of e.co_authors){let h=r.createElement("h4");h.className="tategaki-frontmatter-co-author",h.textContent=d,this.applyFrontmatterInlineEndAlignment(h),l.appendChild(h),s=!0}if(e.translator&&n.preview.showFrontmatterTranslator){let d=r.createElement("h5");d.className="tategaki-frontmatter-translator",d.textContent=e.translator,this.applyFrontmatterInlineEndAlignment(d),l.appendChild(d),s=!0}if(e.co_translators&&n.preview.showFrontmatterCoTranslators)for(let d of e.co_translators){let h=r.createElement("h5");h.className="tategaki-frontmatter-co-translator",h.textContent=d,this.applyFrontmatterInlineEndAlignment(h),l.appendChild(h),s=!0}return s?o:null}applyFrontmatterInlineEndAlignment(e){e.style.display="block",e.style.setProperty("text-align","end","important"),e.style.setProperty("text-align-last","end","important"),e.style.marginInlineStart="auto",e.style.marginInlineEnd="0",e.style.marginLeft="auto",e.style.marginRight="0",e.style.justifySelf="end"}applyFrontmatterWritingMode(e,n){e.style.writingMode=n,e.style.textOrientation="mixed"}getDisplayFile(){if(!this.filePath)return null;let e=this.app.vault.getAbstractFileByPath(this.filePath);return e instanceof ze.TFile?e:null}getFrontmatterTitle(e){var s;if(!e)return null;let n=this.app.metadataCache.getFileCache(e),r=(s=n==null?void 0:n.frontmatter)==null?void 0:s.title;if(r==null)return null;let o=String(r).trim();return o.length>0?o:null}getEffectiveCommonSettings(){return typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():this.plugin.settings.common}};var be=require("obsidian"),_l=require("@codemirror/language");var gl=class{constructor(t,e,n={}){this.isComposing=!1;this.isActive=!0;this.isVertical=!0;this.maxHeight=500;this.maxWidth=500;this.baseLineSize=32;this.textIndentPx=0;this.caretVisibleClass="tategaki-show-native-caret";this.flushTimer=null;this.flushDelayMs=250;this.flushLengthThreshold=8;this.sizeRaf=null;this.immediateFlushChars=new Set([" ","	",`
`,"\u3000","\u3001","\u3002","\uFF0C","\uFF0E","\uFF01","\uFF1F","!","?",",",".",":",";","\uFF1A","\uFF1B"]);this.parentEl=t,this.callbacks=e,this.focusCallbacks=n,this.textarea=t.createEl("textarea",{cls:"tategaki-sot-overlay-textarea"}),this.textarea.spellcheck=!1,this.textarea.autocapitalize="off",this.textarea.autocomplete="off",this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("wrap","soft"),this.textarea.addEventListener("focus",()=>{var r,o;(o=(r=this.focusCallbacks).onFocus)==null||o.call(r)}),this.textarea.addEventListener("blur",()=>{var r,o;(o=(r=this.focusCallbacks).onBlur)==null||o.call(r),this.isComposing||this.flushPending()}),this.textarea.addEventListener("compositionstart",r=>{var s,a,l;this.isComposing=!0,this.clearFlushTimer(),this.textarea.classList.add("tategaki-ime-visible"),(a=(s=this.callbacks).compositionStart)==null||a.call(s);let o=(l=r.data)!=null?l:"";this.updateDynamicSize(o)}),this.textarea.addEventListener("compositionupdate",r=>{var s,a,l;let o=(s=r.data)!=null?s:this.textarea.value;(l=(a=this.callbacks).onPendingText)==null||l.call(a,o),this.updateDynamicSize(o)}),this.textarea.addEventListener("compositionend",r=>{var s,a,l,c,u;this.isComposing=!1,this.textarea.classList.remove("tategaki-ime-visible");let o=(s=r.data)!=null?s:this.textarea.value;this.textarea.value=o,(l=(a=this.callbacks).onPendingText)==null||l.call(a,o),(u=(c=this.callbacks).compositionEnd)==null||u.call(c),this.flushPending()}),this.textarea.addEventListener("input",()=>{var o,s;if(this.isComposing)return;let r=this.textarea.value;if((s=(o=this.callbacks).onPendingText)==null||s.call(o,r),r.length>=this.flushLengthThreshold||this.shouldFlushImmediate(r)){this.flushPending();return}this.scheduleFlush()}),this.textarea.addEventListener("keydown",r=>{var l,c,u,d,h,f,p,m,g,b,v;if(r.key==="Escape"){!this.isComposing&&!r.isComposing&&(r.preventDefault(),(c=(l=this.callbacks).cancelSelection)==null||c.call(l)),r.stopPropagation();return}if((r.metaKey||r.ctrlKey)&&r.shiftKey&&!r.altKey&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r.key)&&!((h=(d=(u=this.callbacks).shouldHandleOutlinerKey)==null?void 0:d.call(u,r))!=null&&h)||r.stopPropagation(),this.isComposing||r.isComposing)return;let s=r.metaKey||r.ctrlKey;if((()=>this.callbacks.listOutliner?this.callbacks.shouldHandleOutlinerKey?this.callbacks.shouldHandleOutlinerKey(r):!s&&!r.altKey&&r.key==="Tab"?!0:s&&!r.shiftKey&&!r.altKey&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r.key):!1)()&&this.callbacks.listOutliner&&(this.flushPending(),this.callbacks.listOutliner(r)||r.key==="Tab")){r.preventDefault();return}if(s&&(r.key==="z"||r.key==="Z")){r.preventDefault(),r.shiftKey?this.callbacks.redo():this.callbacks.undo();return}if(s&&(r.key==="y"||r.key==="Y")){r.preventDefault(),this.callbacks.redo();return}if(s&&(r.key==="a"||r.key==="A")){r.preventDefault(),this.flushPending(),(p=(f=this.callbacks).selectAll)==null||p.call(f);return}if(r.key==="Enter"&&!r.shiftKey){r.preventDefault(),this.flushPending(`
`);return}if(r.key==="Backspace"&&this.textarea.value.length===0){r.preventDefault(),r.metaKey||r.ctrlKey?(g=(m=this.callbacks).backspaceEmpty)==null||g.call(m):this.callbacks.backspace();return}if(r.key==="Delete"&&this.textarea.value.length===0){r.preventDefault(),this.callbacks.del();return}this.textarea.value.length===0&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r.key)&&(r.preventDefault(),(v=(b=this.callbacks).navigate)==null||v.call(b,r))}),this.textarea.addEventListener("keyup",r=>{r.key==="Escape"&&(!this.isComposing&&!r.isComposing&&r.preventDefault(),r.stopPropagation())})}focus(t=!0){if(this.isActive){if(t){let e=this.parentEl.scrollTop,n=this.parentEl.scrollLeft;try{this.textarea.focus({preventScroll:!0})}catch(r){this.textarea.focus()}this.parentEl.scrollTop=e,this.parentEl.scrollLeft=n;return}this.textarea.focus()}}setActive(t){var e,n;this.isActive!==t&&(this.isActive=t,this.textarea.style.display=t?"":"none",this.textarea.disabled=!t,t||(this.isComposing=!1,this.textarea.value="",this.textarea.classList.remove("tategaki-ime-visible"),this.textarea.blur(),(n=(e=this.callbacks).onPendingText)==null||n.call(e,""),this.clearFlushTimer(),this.resetSize()))}isFocused(){return document.activeElement===this.textarea}getSelectionStart(){let t=this.textarea.selectionStart;return t===null||!Number.isFinite(t)?null:Math.max(0,t)}setCaretVisible(t){t?this.textarea.classList.add(this.caretVisibleClass):this.textarea.classList.remove(this.caretVisibleClass)}setAnchorPosition(t,e){this.textarea.style.left=`${t}px`,this.textarea.style.right="",this.textarea.style.top=`${e}px`}setAnchorPositionVertical(t,e){this.textarea.style.left="",this.textarea.style.right=`${this.parentEl.clientWidth-t}px`,this.textarea.style.top=`${e}px`}setConstraints(t,e,n){let r=this.isVertical!==t;this.isVertical=t,this.baseLineSize=n,t?(this.maxHeight=e,this.textarea.style.height=`${e}px`,(r||!this.textarea.style.width)&&(this.textarea.style.width=`${n}px`)):(this.maxWidth=e,this.textarea.style.width=`${e}px`,(r||!this.textarea.style.height)&&(this.textarea.style.height=`${n}px`))}setTextIndent(t){let e=Number.isFinite(t)?Math.max(0,t):0;this.textIndentPx!==e&&(this.textIndentPx=e,this.textarea.style.textIndent=`${e}px`)}updateDynamicSize(t){let e=this.baseLineSize*10,n=0,r=0;if(this.isVertical){let s=Math.ceil(this.textarea.scrollWidth),a=this.textarea.clientWidth||Number.parseFloat(this.textarea.style.width)||0,l=Math.max(this.baseLineSize,Math.min(s,e));s>a+1&&(l=Math.max(l,a+this.baseLineSize)),l=Math.min(l,e);let c=Math.max(a,l);n=a,r=c,this.textarea.style.width=`${c}px`}else{let s=Math.ceil(this.textarea.scrollHeight),a=this.textarea.clientHeight||Number.parseFloat(this.textarea.style.height)||0,l=Math.max(this.baseLineSize,Math.min(s,e));s>a+1&&(l=Math.max(l,a+this.baseLineSize)),l=Math.min(l,e);let c=Math.max(a,l);n=a,r=c,this.textarea.style.height=`${c}px`}r>n+.5&&this.sizeRaf===null&&(this.sizeRaf=window.requestAnimationFrame(()=>{this.sizeRaf=null,this.updateDynamicSize()}))}getPendingText(){return this.textarea.value}isImeVisible(){return this.isComposing}shouldFlushImmediate(t){var n;if(t.length===0)return!1;let e=(n=t[t.length-1])!=null?n:"";return this.immediateFlushChars.has(e)}scheduleFlush(){this.clearFlushTimer(),this.flushTimer=window.setTimeout(()=>{this.flushTimer=null,this.flushPending()},this.flushDelayMs)}clearFlushTimer(){this.flushTimer!==null&&(window.clearTimeout(this.flushTimer),this.flushTimer=null)}flushPending(t=""){var r,o;if(this.isComposing)return;let e=this.textarea.value;if(e.length===0&&t.length===0){this.clearFlushTimer();return}let n=`${e}${t}`;this.callbacks.replaceSelection(n),this.textarea.value="",(o=(r=this.callbacks).onPendingText)==null||o.call(r,""),this.clearFlushTimer(),this.resetSize()}resetSize(){this.isVertical?this.textarea.style.width=`${this.baseLineSize}px`:this.textarea.style.height=`${this.baseLineSize}px`}destroy(){var t,e;(e=(t=this.callbacks).onPendingText)==null||e.call(t,""),this.clearFlushTimer(),this.sizeRaf!==null&&(window.cancelAnimationFrame(this.sizeRaf),this.sizeRaf=null),this.textarea.detach()}};var bl=class{constructor(t){this.replaceRange=null;this.context=t}prepareReplaceRange(){if(!this.context.isActive())return!1;if(this.replaceRange)return!0;let t=null,e=this.context.getDomSelectionOffsets();if(e&&e.anchor!==e.head)t={from:Math.min(e.anchor,e.head),to:Math.max(e.anchor,e.head)};else{let n=this.context.getSotSelection();n.anchor!==n.head&&(t={from:Math.min(n.anchor,n.head),to:Math.max(n.anchor,n.head)})}return!t||t.from===t.to?!1:(this.replaceRange=t,!0)}onCompositionStart(){this.prepareReplaceRange()}onCompositionEnd(){}consumeReplaceRange(){if(!this.replaceRange)return null;let t=this.replaceRange;return this.replaceRange=null,t}cancel(){this.replaceRange=null}};var yl=i=>{var l,c,u,d,h;let t="",e=i,n=e.match(/^([ \t]{0,3}(?:> ?)+)(.*)$/);n&&(t+=(l=n[1])!=null?l:"",e=(c=n[2])!=null?c:"");let r=e.match(/^([ \t]*)([-+*])[ \t]+\[([ xX])\][ \t]+/);if(r&&r[0])t+=r[0],e=e.slice(r[0].length);else{let f=e.match(/^([ \t]*)([-+*])[ \t]+/);if(f&&f[0])t+=f[0],e=e.slice(f[0].length);else{let p=e.match(/^([ \t]*)(\d{1,9})([.)])[ \t]+/);p&&p[0]&&(t+=p[0],e=e.slice(p[0].length))}}let o=e.match(/^(#{1,6})([ \t]+)(.*)$/);if(!o)return{prefix:t,content:e,level:0,hasHeading:!1};let s=(d=(u=o[1])==null?void 0:u.length)!=null?d:0,a=(h=o[3])!=null?h:"";return a=a.replace(/[ \t]+#+[ \t]*$/,""),{prefix:t,content:a,level:s,hasHeading:s>0}},yt=i=>{var l,c,u,d,h,f,p,m,g,b;let t="",e=i,n=e.match(/^([ \t]{0,3}(?:> ?)+)(.*)$/);n&&(t=(l=n[1])!=null?l:"",e=(c=n[2])!=null?c:"");let r=e.match(/^([ \t]*)([-+*])[ \t]+\[([ xX])\][ \t]+(.*)$/);if(r)return{prefix:t,indent:(u=r[1])!=null?u:"",content:(d=r[4])!=null?d:"",kind:"task"};let o=e.match(/^([ \t]*)([-+*])[ \t]+(.*)$/);if(o)return{prefix:t,indent:(h=o[1])!=null?h:"",content:(f=o[3])!=null?f:"",kind:"bullet"};let s=e.match(/^([ \t]*)(\d{1,9})([.)])[ \t]+(.*)$/);if(s)return{prefix:t,indent:(p=s[1])!=null?p:"",content:(m=s[4])!=null?m:"",kind:"ordered"};let a=e.match(/^([ \t]*)(.*)$/);return{prefix:t,indent:(g=a==null?void 0:a[1])!=null?g:"",content:(b=a==null?void 0:a[2])!=null?b:"",kind:"none"}},kh=i=>/^[ \t]{0,3}> ?/.test(i);function mE(i,t){let e=TN(i,t);if(!e)return!1;let n=bE(i,e);return e==="indent"||e==="outdent"?!0:n}function TN(i,t){return!(t.metaKey||t.ctrlKey)&&!t.altKey&&t.key==="Tab"?t.shiftKey?"outdent":"indent":null}function gE(i,t){return bE(i,t)}function bE(i,t){return t==="indent"||t==="outdent"?CN(i,t):LN(i,t)}function CN(i,t){var b,v;let e=i.getDoc(),n=i.getSelection();if(!e||!n)return!1;let r=e.split(`
`),o=vE(r,i.getLineRanges()),s=i.getLineBlockKinds(),a=Math.min(n.anchor,n.head),l=Math.max(n.anchor,n.head),c=El(a,o),u=El(l,o);if(c===null||u===null)return!1;let d=o[u];d&&l===d.from&&l>a&&(u=Math.max(c,u-1));let h=(()=>{if(n.anchor!==n.head)return null;let y=El(n.head,o);if(y===null)return null;let E=o[y];return E?{lineIndex:y,offset:n.head-E.from}:null})(),f=[];for(let y=c;y<=u;y+=1)!En(s,y)||yt((b=r[y])!=null?b:"").kind==="none"||f.push(y);if(f.length===0)return!1;let p=[],m=-1;for(let y of f){if(y<=m)continue;let E=vl(r,s,y);E&&(p.push(E),m=E.end)}if(p.length===0)return!1;let g=[];for(let y of p){let E=Mh(y.rootKind),x=pE(y.rootIndentColumns),S=fE(x),w=S;if(t==="indent"){let L=NN(r,s,y.start,y.rootPrefix,E);if(L===null)continue;w=Math.min(S+1,L+1)}else w=Math.max(0,S-1);if(w===S&&t==="indent")continue;let k=w-S,M=t==="outdent"&&S===0;for(let L=y.start;L<=y.end;L+=1){if(!En(s,L))continue;let _=(v=r[L])!=null?v:"",P=yt(_),I=P.prefix,N=P.indent,D=zi(N),R=pE(D),A=fE(R),C=Math.max(0,A+k),O=" ".repeat(C*E),H;if(M&&L===y.start){let K=_.slice(I.length+N.length);H=`${I}${O}${IN(K,y.rootKind)}`}else{let K=_.slice(I.length+N.length);H=`${I}${O}${K}`}if(H!==_){let K=o[L];if(!K)continue;g.push({from:K.from,to:K.to,insert:H})}}}return g.length===0?!1:(yE(i,g,n,h),wh(i,s,p),!0)}function LN(i,t){var m;let e=i.getDoc(),n=i.getSelection();if(!e||!n)return!1;let r=e.split(`
`),o=vE(r,i.getLineRanges()),s=i.getLineBlockKinds(),a=El(n.head,o);if(a===null||!En(s,a)||yt((m=r[a])!=null?m:"").kind==="none")return!1;let c=vl(r,s,a);if(!c)return!1;let u=c.rootIndentColumns,d=c.rootPrefix;if(t==="move-up"){let g=RN(r,s,c.start,u,d);if(g===null)return!1;let b=vl(r,s,g);if(!b)return!1;let v=hE(i,r,o,n,b,c,!0);return v&&wh(i,s,[b,c]),v}let h=AN(r,s,c.end,u,d);if(h===null)return!1;let f=vl(r,s,h);if(!f)return!1;let p=hE(i,r,o,n,c,f,!1);return p&&wh(i,s,[c,f]),p}function vl(i,t,e){var l,c;let n=(l=i[e])!=null?l:"",r=yt(n);if(r.kind==="none")return null;let o=zi(r.indent),s=r.prefix,a=e;for(let u=e+1;u<i.length&&En(t,u);u+=1){let d=(c=i[u])!=null?c:"",h=yt(d);if(h.prefix!==s)break;let f=zi(h.indent),p=d.trim().length===0;if(h.kind!=="none"){if(f<=o)break;a=u;continue}if(p){if(f>o){a=u;continue}break}if(f<=o)break;a=u}return{start:e,end:a,rootKind:r.kind,rootIndentColumns:o,rootPrefix:s}}function RN(i,t,e,n,r){var o;for(let s=e-1;s>=0;s-=1){if(!En(t,s))return null;let a=(o=i[s])!=null?o:"",l=yt(a);if(l.prefix!==r)return null;let c=zi(l.indent);if(a.trim().length!==0){if(l.kind!=="none"){if(c<n)return null;if(c===n)return s;continue}if(c<=n)return null}}return null}function AN(i,t,e,n,r){var o;for(let s=e+1;s<i.length;s+=1){if(!En(t,s))return null;let a=(o=i[s])!=null?o:"",l=yt(a);if(l.prefix!==r)return null;let c=zi(l.indent);if(a.trim().length!==0){if(l.kind!=="none"){if(c<n)return null;if(c===n)return s;continue}if(c<=n)return null}}return null}function hE(i,t,e,n,r,o,s){var k,M,L,_,P,I,N,D;let a=e[r.start],l=e[o.end];if(!a||!l)return!1;let c=t.slice(r.start,r.end+1),u=t.slice(o.start,o.end+1),d=t.slice(r.end+1,o.start),f=[...u,...d,...c].join(`
`);i.updatePendingText("",!0),(k=i.markImmediateRender)==null||k.call(i),i.replaceRange(a.from,l.to,f);let p=(L=(M=e[r.start])==null?void 0:M.from)!=null?L:a.from,m=(()=>{let R=[...u,...d];return R.length===0?0:R.join(`
`).length+1})(),g=s?p:p+m,b=s?o:r,v=(P=(_=e[b.start])==null?void 0:_.from)!=null?P:a.from,y=(N=(I=e[b.end])==null?void 0:I.to)!=null?N:l.to,E=R=>R<v||R>y?R:g+(R-v),x=E(n.anchor),S=E(n.head);return((D=i.setSelectionRaw)!=null?D:i.setSelectionNormalized)(x,S),i.focusInputSurface(!0),!0}function yE(i,t,e,n){var m,g,b;if(t.length===0)return;i.updatePendingText("",!0),(m=i.markImmediateRender)==null||m.call(i);let r=t.slice().sort((v,y)=>v.from-y.from),o=(g=i.getDoc())!=null?g:"",s=r[0].from,a=r[r.length-1].to,l=[],c=s;for(let v of r)v.from>c&&l.push(o.slice(c,v.from)),l.push(v.insert),c=v.to;let u=l.join("");i.replaceRange(s,a,u);let d=e.anchor,h=e.head,f=r.slice().reverse();for(let v of f){let y=v.insert.length-(v.to-v.from),E=x=>{if(x>v.to)return x+y;if(x<v.from)return x;let S=x+y,w=v.from,k=v.from+v.insert.length;return Math.max(w,Math.min(S,k))};d=E(d),h=E(h)}let p=(b=i.setSelectionRaw)!=null?b:i.setSelectionNormalized;if(p(d,h),n){let v=i.getDoc();if(v){let y=v.split(`
`);if(n.lineIndex>=0&&n.lineIndex<y.length){let x=Th(y)[n.lineIndex];if(x){let S=Math.max(x.from,Math.min(x.to,x.from+n.offset));p(S,S)}}}}i.focusInputSurface(!0)}function IN(i,t){return t==="task"?i.replace(/^[-+*][ \t]+\[[ xX]\][ \t]+/,""):t==="ordered"?i.replace(/^\d{1,9}[.)][ \t]+/,""):i.replace(/^[-+*][ \t]+/,"")}function zi(i){let t=0;for(let e of i)e==="	"?t+=4:t+=1;return t}function Mh(i){return 4}function pE(i){if(!Number.isFinite(i)||i<=0)return 0;let t=Mh("bullet");return Math.floor(i/t)*t}function fE(i){let t=Mh("bullet");return Math.max(0,Math.floor(i/t))}function NN(i,t,e,n,r){var o;for(let s=e-1;s>=0;s-=1){if(!En(t,s))return null;let a=(o=i[s])!=null?o:"",l=yt(a);if(l.kind==="none"||l.prefix!==n)return null;let c=zi(l.indent);return Math.max(0,Math.floor(c/r))}return null}function En(i,t){let e=i[t];return e?e==="normal":!0}function vE(i,t){return Th(i)}function Th(i){let t=[],e=0;for(let n of i){let r=e,o=e+n.length;t.push({from:r,to:o}),e=o+1}return t}function El(i,t){if(!Number.isFinite(i)||i<0)return null;for(let e=0;e<t.length;e+=1){let n=t[e];if(n&&i<=n.to)return e}return t.length>0?t.length-1:null}function wh(i,t,e){var d,h,f,p,m;let n=i.getDoc();if(!n)return;let r=n.split(`
`),o=Th(r),s=r.length,a=-1;for(let g of e)s=Math.min(s,g.start),a=Math.max(a,g.end);if(s>a)return;for(;s>0;){let g=s-1;if(!En(t,g)||yt((d=r[g])!=null?d:"").kind==="none")break;s=g}for(;a<r.length-1;){let g=a+1;if(!En(t,g)||yt((h=r[g])!=null?h:"").kind==="none")break;a=g}let l=[],c=new Map;for(let g=s;g<=a;g+=1){if(!En(t,g))continue;let b=(f=r[g])!=null?f:"",v=yt(b);if(v.kind!=="ordered")continue;let y=zi(v.indent);for(let[L]of c)L>y&&c.delete(L);let E=((p=c.get(y))!=null?p:0)+1;c.set(y,E);let S=b.slice(v.prefix.length).match(/^([ \t]*)(\d{1,9})([.)])([ \t]+.*)$/);if(!S||Number.parseInt((m=S[2])!=null?m:"1",10)===E)continue;let k=`${v.prefix}${S[1]}${E}${S[3]}${S[4]}`,M=o[g];M&&l.push({from:M.from,to:M.to,insert:k})}if(l.length===0)return;let u=i.getSelection();u&&yE(i,l,u,null)}var xl=class{constructor(t,e){this.isOpen=!1;this.callbacks=e,this.rootEl=t.createDiv("tategaki-sot-outline-panel"),this.rootEl.style.display="none",this.rootEl.setAttribute("role","dialog"),this.rootEl.setAttribute("aria-label","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3"),this.rootEl.addEventListener("pointerdown",o=>{o.stopPropagation()});let n=this.rootEl.createDiv("tategaki-sot-outline-header"),r=n.createDiv("tategaki-sot-outline-title");r.textContent="\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",this.closeButton=n.createEl("button",{cls:"tategaki-sot-outline-close",text:"\xD7",attr:{type:"button","aria-label":"\u9589\u3058\u308B"}}),this.closeButton.addEventListener("click",()=>this.close()),this.listEl=this.rootEl.createDiv("tategaki-sot-outline-list")}toggle(){if(this.isOpen){this.close();return}this.open()}open(){this.isOpen=!0,this.rootEl.style.display="",this.refresh()}close(){var t,e;this.isOpen&&(this.isOpen=!1,this.rootEl.style.display="none",this.listEl.replaceChildren(),(e=(t=this.callbacks).onClose)==null||e.call(t))}refresh(){if(!this.isOpen)return;let t=this.callbacks.getItems();if(this.listEl.replaceChildren(),t.length===0){let e=this.listEl.createDiv("tategaki-sot-outline-empty");e.textContent="\u898B\u51FA\u3057\u304C\u3042\u308A\u307E\u305B\u3093";return}for(let e of t){let n=this.listEl.createDiv("tategaki-sot-outline-item");n.style.paddingLeft=`${(e.level-1)*12}px`,n.textContent=e.text,n.addEventListener("click",()=>{this.callbacks.onSelect(e)})}}};var xn=i=>{var o,s;let t=(o=i.selectionStart)!=null?o:0,e=(s=i.selectionEnd)!=null?s:t,n=Math.min(t,e),r=Math.max(t,e);return{start:n,end:r,text:i.value.slice(n,r)}},$n=(i,t,e={})=>{var u,d,h,f;let n=xn(i),r=(u=i.value)!=null?u:"",o=r.slice(0,n.start),s=r.slice(n.end);i.value=`${o}${t}${s}`;let a=o.length,l=(d=e.selectionStart)!=null?d:a+t.length,c=(h=e.selectionEnd)!=null?h:l;i.focus({preventScroll:!0});try{i.setSelectionRange(l,c)}catch(p){}(f=e.onResize)==null||f.call(e)},Or=(i,t,e,n)=>{let r=xn(i),o=`${t}${r.text}${e}`,s=r.start+t.length,a=s+r.text.length;if(r.start===r.end){$n(i,o,{selectionStart:s,selectionEnd:s,onResize:n});return}$n(i,o,{selectionStart:s,selectionEnd:a,onResize:n})},PN=i=>{let t=i;t=t.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),t=t.replace(/==([^=\n]+)==/g,"$1"),t=t.replace(/\*\*([^*\n]+)\*\*/g,"$1"),t=t.replace(/\*([^*\n]+)\*/g,"$1"),t=t.replace(/~~([^~\n]+)~~/g,"$1"),t=t.replace(/<u>([\s\S]*?)<\/u>/gi,"$1");let e=jt();return t=t.replace(e,(n,...r)=>{var s,a;let o=r[r.length-1];return(a=(s=o==null?void 0:o.body2)!=null?s:o==null?void 0:o.body1)!=null?a:n}),t},EE=(i,t)=>{let e=xn(i);if(e.start===e.end)return;let n=PN(e.text),r=e.start,o=r+n.length;$n(i,n,{selectionStart:r,selectionEnd:o,onResize:t})},xE=(i,t,e,n)=>{let r=xn(i),o=t||r.text||e;if(!o||!e)return;let s=`[${o}](${e})`,a=r.start+1,l=a+o.length;$n(i,s,{selectionStart:a,selectionEnd:l,onResize:n})},SE=(i,t,e,n,r,o)=>{let s=xn(i),a=t||s.text;if(!a)return;if(!e||e.trim()===""){$n(i,a,{onResize:o});return}let l=r(a,e,!!n),c=s.start+l.length;$n(i,l,{selectionStart:c,selectionEnd:c,onResize:o})};function Dr(i,t,e){let n=i;if(typeof n.caretPositionFromPoint=="function"){let r=n.caretPositionFromPoint(t,e);if(r!=null&&r.offsetNode)return{node:r.offsetNode,offset:r.offset}}if(typeof n.caretRangeFromPoint=="function"){let r=n.caretRangeFromPoint(t,e);if(r)return{node:r.startContainer,offset:r.startOffset}}return null}function kE(i,t,e){let r=i.width>2?Math.max(i.left+1,Math.min(t,i.right-1)):i.left+i.width/2,o=i.height>1*2?Math.max(i.top+1,Math.min(e,i.bottom-1)):i.top+i.height/2;return{x:r,y:o}}function Br(i,t){if(i.length===0)return t;let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let s of i)e=Math.min(e,s.left),n=Math.max(n,s.right),r=Math.min(r,s.top),o=Math.max(o,s.bottom);return!Number.isFinite(e)||!Number.isFinite(n)?t:DOMRect.fromRect({x:e,y:r,width:n-e,height:o-r})}var Sl=class{constructor(t){this.overlayResizeIdleMs=120;this.overlayPositionDirty=!1;this.overlayInputActive=!1;this.overlayInputIdleTimer=null;this.overlayPositionNeedsRefine=!1;this.overlayPositionRefineRaf=null;this.fixedOverlaySize=!0;this.overlayFixedExpandRaf=null;this.host=t}ensureOverlay(){if(this.host.derivedRootEl&&!this.host.plainEditOverlayEl){let t=document.createElement("textarea");t.className="tategaki-plain-overlay",t.spellcheck=!1,t.wrap="soft",t.setAttribute("autocapitalize","off"),t.setAttribute("autocomplete","off"),t.setAttribute("autocorrect","off"),t.addEventListener("mousedown",e=>{e.button===2&&e.preventDefault(),e.stopPropagation()}),t.addEventListener("pointerdown",e=>{e.button===2&&e.preventDefault(),e.stopPropagation()}),t.addEventListener("compositionstart",()=>{this.host.plainEditComposing=!0,this.markOverlayInputActive()}),t.addEventListener("compositionend",()=>{this.host.plainEditComposing=!1,this.markOverlayInputActive()}),t.addEventListener("keydown",e=>{if(e.key==="Escape"){e.preventDefault(),e.stopPropagation(),this.host.toggleSourceMode();return}if(!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.ctrlKey&&!e.isComposing&&!this.host.plainEditComposing&&e.keyCode!==229){if(e.key.startsWith("Arrow")&&this.handleArrowKey(e.key)){e.preventDefault();return}if(e.key==="Enter"&&this.handleEnter()){e.preventDefault();return}if(e.key==="Backspace"&&this.handleBackspace()){e.preventDefault();return}if(e.key==="Delete"&&this.handleDelete()){e.preventDefault();return}}e.stopPropagation()}),t.addEventListener("input",()=>{this.markOverlayInputActive()}),this.host.plainEditOverlayEl=t,this.host.derivedRootEl.appendChild(t)}}destroyOverlay(){this.host.plainEditOverlayEl&&(this.host.plainEditOverlayEl.remove(),this.host.plainEditOverlayEl=null),this.host.plainEditOverlayBaseRect=null,this.resetOverlayInputState(),this.overlayPositionRefineRaf!==null&&(window.cancelAnimationFrame(this.overlayPositionRefineRaf),this.overlayPositionRefineRaf=null)}resetOverlayInputState(){this.overlayInputActive=!1,this.overlayPositionDirty=!1,this.overlayPositionNeedsRefine=!1,this.overlayPositionRefineRaf!==null&&(window.cancelAnimationFrame(this.overlayPositionRefineRaf),this.overlayPositionRefineRaf=null),this.overlayFixedExpandRaf!==null&&(window.cancelAnimationFrame(this.overlayFixedExpandRaf),this.overlayFixedExpandRaf=null),this.overlayInputIdleTimer!==null&&(window.clearTimeout(this.overlayInputIdleTimer),this.overlayInputIdleTimer=null)}markOverlayInputActive(){this.overlayInputActive=!0,this.overlayInputIdleTimer!==null&&window.clearTimeout(this.overlayInputIdleTimer),this.overlayInputIdleTimer=window.setTimeout(()=>{this.overlayInputIdleTimer=null,this.overlayInputActive=!1,this.overlayPositionDirty&&this.host.plainEditRange&&(this.overlayPositionDirty=!1,this.updateOverlayPositionInternal(this.host.plainEditRange,{refine:!1})),this.scheduleFixedOverlayExpand(),this.scheduleOverlayPositionRefine()},this.overlayResizeIdleMs)}scheduleFixedOverlayExpand(){this.fixedOverlaySize&&(!this.host.plainEditOverlayEl||!this.host.plainEditOverlayBaseRect||this.overlayFixedExpandRaf===null&&(this.overlayFixedExpandRaf=window.requestAnimationFrame(()=>{this.overlayFixedExpandRaf=null,this.expandFixedOverlayIfOverflow()})))}expandFixedOverlayIfOverflow(){if(!this.fixedOverlaySize||!this.host.plainEditOverlayEl||!this.host.plainEditOverlayBaseRect)return;let t=this.host.plainEditOverlayEl,e=this.host.plainEditOverlayBaseRect,n=t.style.writingMode||getComputedStyle(t).writingMode,r=getComputedStyle(t),o=Number.parseFloat(r.fontSize)||16,s=Number.parseFloat(r.lineHeight)||Math.max(1,o*1.6);if(n.startsWith("vertical")){if(t.scrollWidth-t.clientWidth<=0)return;let d=Math.max(1,Math.ceil(o)),h=e.width+d;this.host.plainEditOverlayEl.style.width=`${h}px`,this.host.plainEditOverlayBaseRect={left:e.left,top:e.top,width:h,height:e.height};return}if(t.scrollHeight-t.clientHeight<=0)return;let l=Math.max(1,Math.ceil(s)),c=e.height+l;this.host.plainEditOverlayEl.style.height=`${c}px`,this.host.plainEditOverlayBaseRect={left:e.left,top:e.top,width:e.width,height:c}}scheduleOverlayPositionRefine(){!this.overlayPositionNeedsRefine||!this.host.plainEditRange||this.overlayInputActive||this.overlayPositionRefineRaf===null&&(this.overlayPositionRefineRaf=window.requestAnimationFrame(()=>{this.overlayPositionRefineRaf=null,!(!this.overlayPositionNeedsRefine||!this.host.plainEditRange)&&(this.overlayInputActive||(this.overlayPositionNeedsRefine=!1,this.updateOverlayPositionInternal(this.host.plainEditRange,{refine:!0})))}))}adjustOverlaySize(){if(this.fixedOverlaySize||!this.host.plainEditOverlayEl||!this.host.plainEditOverlayBaseRect)return;let t=this.host.plainEditOverlayBaseRect,e=2,n=Math.max(0,Math.ceil(t.width)),r=Math.max(0,Math.ceil(t.height));this.host.plainEditOverlayEl.style.width=`${n}px`,this.host.plainEditOverlayEl.style.height=`${r}px`;let o=Math.ceil(this.host.plainEditOverlayEl.scrollWidth),s=Math.ceil(this.host.plainEditOverlayEl.scrollHeight),a=Math.max(n,o+e),l=Math.max(r,s+e);if(this.host.plainEditOverlayEl.style.width=`${a}px`,this.host.plainEditOverlayEl.style.height=`${l}px`,(this.host.plainEditOverlayEl.style.writingMode||getComputedStyle(this.host.plainEditOverlayEl).writingMode)==="vertical-rl"){let u=t.left+t.width-a;this.host.plainEditOverlayEl.style.left=`${u}px`}else this.host.plainEditOverlayEl.style.left=`${t.left}px`;this.host.plainEditOverlayEl.style.top=`${t.top}px`}getWritingMode(){if(!this.host.plainEditOverlayEl)return"vertical-rl";let t=getComputedStyle(this.host.plainEditOverlayEl).writingMode;return t==="horizontal-tb"?"horizontal-tb":t==="vertical-lr"?"vertical-lr":"vertical-rl"}getArrowMoveDirection(t,e,n,r){return r==="vertical-lr"?n&&t==="ArrowRight"?"next":e&&t==="ArrowLeft"?"prev":null:r==="vertical-rl"?n&&t==="ArrowLeft"?"next":e&&t==="ArrowRight"?"prev":null:n&&t==="ArrowDown"?"next":e&&t==="ArrowUp"?"prev":null}handleArrowKey(t){var f,p,m;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let e=(f=this.host.plainEditOverlayEl.value)!=null?f:"",n=(p=this.host.plainEditOverlayEl.selectionStart)!=null?p:0,r=(m=this.host.plainEditOverlayEl.selectionEnd)!=null?m:n;if(n!==r)return!1;let o=n===0,s=n===e.length;if(!o&&!s)return!1;let a=this.getArrowMoveDirection(t,o,s,this.getWritingMode());if(!a)return!1;let l=this.host.plainEditRange.startLine,c=a==="prev"?l-1:l+1;if(c<0||c>=this.host.lineRanges.length)return!1;let u=this.host.lineRanges[c];if(!u)return!1;let d=a==="prev"?u.to-u.from:0;this.commit(!0,!1);let h=u.from+Math.max(0,d);return this.host.setSelectionNormalized(h,h),this.startFromSelection(),!0}handleEnter(){var u,d,h;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||!this.host.sotEditor||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let t=(u=this.host.plainEditOverlayEl.value)!=null?u:"",e=(d=this.host.plainEditOverlayEl.selectionStart)!=null?d:0,n=(h=this.host.plainEditOverlayEl.selectionEnd)!=null?h:e,r=Math.min(e,n),o=Math.max(e,n),s=t.slice(0,r),a=t.slice(o),l=`${s}
${a}`,c=this.host.plainEditRange.from+s.length+1;return this.applyRangeReplacement(this.host.plainEditRange.from,this.host.plainEditRange.to,l,c),!0}handleBackspace(){var u,d,h;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||!this.host.sotEditor||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let t=(u=this.host.plainEditOverlayEl.selectionStart)!=null?u:0,e=(d=this.host.plainEditOverlayEl.selectionEnd)!=null?d:t;if(t!==e||t!==0)return!1;let n=this.host.plainEditRange.startLine;if(n<=0)return!1;let r=this.host.lineRanges[n-1];if(!r)return!1;let s=this.host.sotEditor.getDoc().slice(r.from,r.to),a=(h=this.host.plainEditOverlayEl.value)!=null?h:"",l=`${s}${a}`,c=r.from+s.length;return this.applyRangeReplacement(r.from,this.host.plainEditRange.to,l,c),!0}handleDelete(){var d,h,f;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||!this.host.sotEditor||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let t=(d=this.host.plainEditOverlayEl.value)!=null?d:"",e=(h=this.host.plainEditOverlayEl.selectionStart)!=null?h:0,n=(f=this.host.plainEditOverlayEl.selectionEnd)!=null?f:e;if(e!==n||e!==t.length)return!1;let o=this.host.plainEditRange.startLine+1;if(o>=this.host.lineRanges.length)return!1;let s=this.host.lineRanges[o];if(!s)return!1;let l=this.host.sotEditor.getDoc().slice(s.from,s.to),c=`${t}${l}`,u=this.host.plainEditRange.from+t.length;return this.applyRangeReplacement(this.host.plainEditRange.from,s.to,c,u),!0}applyRangeReplacement(t,e,n,r){if(this.host.sotEditor){this.host.updatePendingText("",!0),this.host.immediateRender=!0,this.host.plainEditCommitting=!0;try{this.host.sotEditor.replaceRange(t,e,n)}finally{this.host.plainEditCommitting=!1}this.clearTargets(),this.host.plainEditRange=null,this.host.plainEditOverlayEl&&(this.host.plainEditOverlayEl.style.display="none"),this.host.setSelectionNormalized(r,r),this.startFromSelection()}}clearTargets(){if(this.host.plainEditRange)for(let t=this.host.plainEditRange.startLine;t<=this.host.plainEditRange.endLine;t+=1){let e=this.host.getLineElement(t);e&&(e.classList.remove("tategaki-plain-overlay-target"),e.removeAttribute("data-plain-mode"))}}applyTargetClass(t,e){if(!this.host.sourceModeEnabled||!this.host.plainEditRange){t.classList.remove("tategaki-plain-overlay-target"),t.removeAttribute("data-plain-mode");return}if(e!==null){if(e<this.host.plainEditRange.startLine||e>this.host.plainEditRange.endLine){t.classList.remove("tategaki-plain-overlay-target"),t.removeAttribute("data-plain-mode");return}t.classList.add("tategaki-plain-overlay-target"),t.setAttribute("data-plain-mode","true")}}applyTargets(t){for(let e=t.startLine;e<=t.endLine;e+=1){let n=this.host.getLineElement(e);n&&this.applyTargetClass(n,e)}}getRangeFromSelection(){var g,b;if(!this.host.sotEditor)return null;let t=this.host.sotEditor.getSelection(),e=Math.min(t.anchor,t.head),n=Math.max(t.anchor,t.head),r=t.head,o=this.host.findLineIndex(r);if(o===null)return null;let s=this.getBlockLineRange(o),a=(g=s==null?void 0:s.start)!=null?g:o,l=(b=s==null?void 0:s.end)!=null?b:o,c=this.host.lineRanges[a],u=this.host.lineRanges[l];if(!c||!u)return null;let d=c.from,h=u.to,f=Math.max(0,h-d),p=Math.max(0,Math.min(e-d,f)),m=Math.max(0,Math.min(n-d,f));return{startLine:a,endLine:l,from:d,to:h,selectionStart:p,selectionEnd:m}}getBlockLineRange(t){var n,r,o,s;if(t<0||t>=this.host.lineBlockKinds.length)return null;let e=(n=this.host.lineBlockKinds[t])!=null?n:"normal";if(e==="code"||e==="code-fence")return(r=this.host.getCodeBlockRangeForLine(t))!=null?r:{start:t,end:t};if(e==="math"||e==="math-fence"){let a=this.host.lineMathBlockStart[t],l=this.host.lineMathBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="callout"||e==="callout-title"){let a=this.host.lineCalloutBlockStart[t],l=this.host.lineCalloutBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="table-row"||e==="table-sep"){let a=this.host.lineTableBlockStart[t],l=this.host.lineTableBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="deflist"){let a=this.host.lineDeflistBlockStart[t],l=this.host.lineDeflistBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="frontmatter"||e==="frontmatter-fence"){let a=t,l=t;for(;a>0;){let c=(o=this.host.lineBlockKinds[a-1])!=null?o:"normal";if(c!=="frontmatter"&&c!=="frontmatter-fence")break;a-=1}for(;l+1<this.host.lineBlockKinds.length;){let c=(s=this.host.lineBlockKinds[l+1])!=null?s:"normal";if(c!=="frontmatter"&&c!=="frontmatter-fence")break;l+=1}return{start:a,end:l}}return{start:t,end:t}}updateOverlayPosition(t){if(this.overlayInputActive){this.overlayPositionDirty=!0;return}this.updateOverlayPositionInternal(t,{refine:!1})}scheduleInitialRefine(){this.overlayPositionNeedsRefine=!0,this.scheduleOverlayPositionRefine()}updateOverlayPositionInternal(t,e){if(!this.host.derivedRootEl||!this.host.plainEditOverlayEl)return;let n=this.host.derivedRootEl.getBoundingClientRect();if(!e.refine){let u=this.host.getLineElement(t.startLine);if(!u)return;this.host.ensureLineRendered(u);let h=u.getBoundingClientRect(),f=h.left-n.left+this.host.derivedRootEl.scrollLeft,p=h.top-n.top+this.host.derivedRootEl.scrollTop,m=Math.max(1,h.width),g=Math.max(1,h.height);this.host.plainEditOverlayEl.style.left=`${f}px`,this.host.plainEditOverlayEl.style.top=`${p}px`,this.host.plainEditOverlayEl.style.width=`${m}px`,this.host.plainEditOverlayEl.style.height=`${g}px`,this.host.plainEditOverlayBaseRect={left:f,top:p,width:m,height:g},this.scheduleInitialRefine();return}let r=null,o=(u,d)=>{let h=Math.min(u.left,d.left),f=Math.min(u.top,d.top),p=Math.max(u.right,d.right),m=Math.max(u.bottom,d.bottom);return DOMRect.fromRect({x:h,y:f,width:Math.max(1,p-h),height:Math.max(1,m-f)})};for(let u=t.startLine;u<=t.endLine;u+=1){let d=this.host.getLineElement(u);if(!d)continue;this.host.ensureLineRendered(d);let h=this.host.getLineVisualRects(d),f=d.getBoundingClientRect(),p=Br(h,f),m=o(p,f);r=r?o(r,m):m}if(!r)return;let s=r.left-n.left+this.host.derivedRootEl.scrollLeft,a=r.top-n.top+this.host.derivedRootEl.scrollTop,l=Math.max(1,r.width),c=Math.max(1,r.height);this.host.plainEditOverlayEl.style.left=`${s}px`,this.host.plainEditOverlayEl.style.top=`${a}px`,this.host.plainEditOverlayEl.style.width=`${l}px`,this.host.plainEditOverlayEl.style.height=`${c}px`,this.host.plainEditOverlayBaseRect={left:s,top:a,width:l,height:c}}startFromSelection(){var r,o;if(!this.host.sourceModeEnabled||this.host.plainEditCommitting||!this.host.derivedRootEl||!this.host.plainEditOverlayEl)return;let t=this.getRangeFromSelection();if(!t)return;if(this.host.plainEditRange&&this.host.plainEditRange.startLine===t.startLine&&this.host.plainEditRange.endLine===t.endLine&&this.host.plainEditRange.from===t.from&&this.host.plainEditRange.to===t.to){this.host.plainEditComposing||this.host.plainEditOverlayEl.setSelectionRange(t.selectionStart,t.selectionEnd),this.updateOverlayPosition(t);return}this.host.plainEditRange&&this.commit(!0,!1);let n=((o=(r=this.host.sotEditor)==null?void 0:r.getDoc())!=null?o:"").slice(t.from,t.to);this.host.plainEditOverlayEl.value=n,this.host.plainEditOverlayEl.style.display="",this.host.plainEditOverlayEl.focus({preventScroll:!0}),this.host.plainEditComposing||this.host.plainEditOverlayEl.setSelectionRange(t.selectionStart,t.selectionEnd),this.clearTargets(),this.host.plainEditRange={from:t.from,to:t.to,startLine:t.startLine,endLine:t.endLine,originalText:n},this.applyTargets(t),this.overlayPositionNeedsRefine=!0,this.updateOverlayPositionInternal(t,{refine:!1})}commit(t,e){var n,r,o;if(!this.host.plainEditCommitting&&!(!this.host.plainEditRange||!this.host.plainEditOverlayEl||!this.host.sotEditor)){this.host.plainEditCommitting=!0;try{let s=this.host.plainEditRange,a=(n=this.host.plainEditOverlayEl.value)!=null?n:"",l=(r=this.host.plainEditOverlayEl.selectionStart)!=null?r:a.length,c=(o=this.host.plainEditOverlayEl.selectionEnd)!=null?o:l,u=this.host.sotEditor.getSelection(),d=Math.min(u.anchor,u.head),h=Math.max(u.anchor,u.head),f=d>=s.from&&h<=s.to,p=e&&f;if(t&&a!==s.originalText&&this.host.sotEditor.replaceRange(s.from,s.to,a),p){let m=this.host.sotEditor.getDoc().length,g=Math.max(0,Math.min(s.from+l,m)),b=Math.max(0,Math.min(s.from+c,m));this.host.setSelectionNormalized(g,b)}this.clearTargets(),this.host.plainEditRange=null,this.host.plainEditOverlayEl.style.display="none",this.resetOverlayInputState()}finally{this.host.plainEditCommitting=!1}}}registerOutsidePointerHandler(){this.host.plainEditOutsidePointerHandler||(this.host.plainEditOutsidePointerHandler=t=>{var n;if(!this.host.sourceModeEnabled||!this.host.plainEditOverlayEl)return;let e=t.target;e&&(this.host.plainEditOverlayEl.contains(e)||(n=this.host.derivedRootEl)!=null&&n.contains(e)&&this.commit(!0,!1))},document.addEventListener("pointerdown",this.host.plainEditOutsidePointerHandler,!0))}unregisterOutsidePointerHandler(){this.host.plainEditOutsidePointerHandler&&(document.removeEventListener("pointerdown",this.host.plainEditOutsidePointerHandler,!0),this.host.plainEditOutsidePointerHandler=null)}};var Te=require("obsidian");var ui=require("@codemirror/state"),wE=require("@codemirror/view"),wl=require("@codemirror/commands"),kl=class{constructor(t){this.listeners=new Set;this.updateCompartment=new ui.Compartment;var n;let e=(n=t.editor)==null?void 0:n.cm;if(!e){this.view=null;return}this.view=e,this.attachUpdateListener()}getDoc(){return this.view?this.view.state.doc.toString():""}setDoc(t){if(!this.view)return;let e=this.view.state.doc.length,n=Math.max(0,t.length);this.view.dispatch({changes:{from:0,to:e,insert:t},selection:ui.EditorSelection.single(n,n),scrollIntoView:!1})}getSelection(){if(!this.view)return{anchor:0,head:0};let t=this.view.state.selection.main;return{anchor:t.anchor,head:t.head}}setSelection(t){if(!this.view)return;let e=this.view.state.doc.length,n=Math.max(0,Math.min(t.anchor,e)),r=Math.max(0,Math.min(t.head,e));this.view.dispatch({selection:ui.EditorSelection.single(n,r),scrollIntoView:!1})}getEditorView(){return this.view}replaceRange(t,e,n){if(!this.view)return;let r=this.view.state.doc.length,o=Math.max(0,Math.min(t,r)),s=Math.max(o,Math.min(e,r)),a=o+n.length;this.view.dispatch({changes:{from:o,to:s,insert:n},selection:ui.EditorSelection.single(a,a),scrollIntoView:!1})}undo(){this.view&&(0,wl.undo)(this.view)}redo(){this.view&&(0,wl.redo)(this.view)}onUpdate(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}destroy(){this.listeners.clear(),this.view&&this.view.dispatch({effects:this.updateCompartment.reconfigure([])}),this.view=null}attachUpdateListener(){if(!this.view)return;let t=wE.EditorView.updateListener.of(e=>{if(!e.docChanged&&!e.selectionSet)return;let n;e.docChanged&&(n=[],e.changes.iterChanges((o,s,a,l,c)=>{n==null||n.push({from:o,to:s,fromB:a,toB:l,insert:c.toString()})}));let r={docChanged:e.docChanged,selectionChanged:e.selectionSet,changes:n};for(let o of this.listeners)o(r)});this.view.dispatch({effects:ui.StateEffect.appendConfig.of([this.updateCompartment.of(t)])})}};var ME="tategaki-paired-tab-badge",Ch="tategaki-paired-tab-badge-icon",Lh="tategaki-paired-tab-badge-text",TE="\u7E26",CE="Tategaki\u7DE8\u96C6\u4E2D",_N="tategaki-sot-tab-badge",LE="Tategaki SoT",RE=50,Ml=class{constructor(t){this.escapeKeymapHandler=null;this.host=t}async openFile(t){this.host.showLoadingOverlay();let e=await this.ensureMarkdownViewForFile(t);if(!e){new Te.Notice("MarkdownView \u304C\u898B\u3064\u304B\u3089\u306A\u3044\u305F\u3081\u9589\u3058\u307E\u3059\u3002",2500),this.host.closeSelf();return}if(!this.verifyPairedMarkdownViewFile(e,t)){this.host.closeSelf();return}this.host.currentFile=t,this.recordRecentFile(t),this.host.updateToolbar(),this.host.attachSoTEditor(new kl(e)),this.host.scheduleRender(!0)}registerWorkspacePairGuards(){let t=()=>{this.ensurePairedMarkdownView(),this.applySoTTabBadge()};t(),this.host.registerEvent(this.host.app.workspace.on("file-open",e=>{this.recordRecentFile(e),t()})),this.host.registerEvent(this.host.app.workspace.on("active-leaf-change",()=>t())),this.host.registerEvent(this.host.app.workspace.on("layout-change",t))}registerEscapeGuard(){var r,o;let t=(r=this.host.containerEl.ownerDocument)!=null?r:document,e=(o=t.defaultView)!=null?o:window,n=s=>{var u,d;if(s.key!=="Escape"||!this.isLeafActive())return;let a=t.activeElement,l=s.target;if(this.isInModalLayer(a)||this.isInModalLayer(l))return;this.host.plainEditComposing||((d=(u=this.host.overlayTextarea)==null?void 0:u.isImeVisible())!=null?d:!1)||s.isComposing||s.preventDefault(),typeof s.stopImmediatePropagation=="function"&&s.stopImmediatePropagation(),s.stopPropagation(),this.host.focusInputSurface(!0)};e.addEventListener("keydown",n,!0),e.addEventListener("keyup",n,!0),this.host.register(()=>{e.removeEventListener("keydown",n,!0),e.removeEventListener("keyup",n,!0)})}registerEscapeKeymap(){!this.host.scope||this.escapeKeymapHandler||(this.escapeKeymapHandler=this.host.scope.register(null,"Escape",t=>{var s,a,l;if(!this.isLeafActive())return;let n=((s=this.host.containerEl.ownerDocument)!=null?s:document).activeElement,r=t.target;return this.isInModalLayer(n)||this.isInModalLayer(r)?void 0:(this.host.plainEditComposing||((l=(a=this.host.overlayTextarea)==null?void 0:a.isImeVisible())!=null?l:!1)||t.isComposing||t.preventDefault(),typeof t.stopImmediatePropagation=="function"&&t.stopImmediatePropagation(),t.stopPropagation(),this.host.focusInputSurface(!0),!1)}),this.host.register(()=>{this.host.scope&&this.escapeKeymapHandler&&this.host.scope.unregister(this.escapeKeymapHandler),this.escapeKeymapHandler=null}))}isLeafActive(){return this.host.app.workspace.activeLeaf===this.host.leaf}isInModalLayer(t){return t?Boolean(t.closest(".modal, .prompt, .suggestion-container, .menu, .popover")):!1}getValidPairedMarkdownLeaf(){return!this.host.pairedMarkdownLeaf||!this.host.app.workspace.getLeavesOfType("markdown").includes(this.host.pairedMarkdownLeaf)||!(this.host.pairedMarkdownLeaf.view instanceof Te.MarkdownView)?null:this.host.pairedMarkdownLeaf}ensureRecentFilePathsInitialized(){if(this.host.recentFilePathsInitialized)return;this.host.recentFilePathsInitialized=!0;let t=this.host.app.workspace.getLastOpenFiles();for(let e of t){let n=this.host.app.vault.getAbstractFileByPath(e);n instanceof Te.TFile&&n.extension==="md"&&this.pushRecentFilePath(n.path,!1)}}pushRecentFilePath(t,e=!0){let n=t.trim();if(!n)return;let r=this.host.recentFilePaths.indexOf(n);r===0&&e||(r>=0&&this.host.recentFilePaths.splice(r,1),e?this.host.recentFilePaths.unshift(n):this.host.recentFilePaths.push(n),this.host.recentFilePaths.length>RE&&(this.host.recentFilePaths.length=RE))}recordRecentFile(t){t&&t.extension==="md"&&(this.ensureRecentFilePathsInitialized(),this.pushRecentFilePath(t.path,!0))}buildFileSwitchItems(){let t=this.host.app.vault.getMarkdownFiles();if(t.length===0)return[];this.ensureRecentFilePathsInitialized();let e=new Map;for(let o of t)e.set(o.path,o);let n=[],r=new Set;for(let o of this.host.recentFilePaths){let s=e.get(o);s&&(n.push(s),r.add(o))}for(let o of t)r.has(o.path)||n.push(o);return n}openFileSwitcher(){let t=this.buildFileSwitchItems();new Nr(this.host.app,t,n=>{this.switchToFile(n)},n=>{this.openNewNoteModal(n)}).open(),t.length===0&&new Te.Notice("\u5207\u308A\u66FF\u3048\u53EF\u80FD\u306A\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2e3)}openNewNoteModal(t=""){var r,o,s;let e=(s=(o=(r=this.host.currentFile)==null?void 0:r.parent)==null?void 0:o.path)!=null?s:"";new Pr(this.host.app,{defaultFolder:e,initialValue:t},a=>{this.createNewNote(a,e)}).open()}async createNewNote(t,e){let n=t.trim();if(!n){new Te.Notice("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2e3);return}let r=n.replace(/^[\\/]+/,"").replace(/^\.\//,""),s=r.toLowerCase().endsWith(".md")?r:`${r}.md`,a=e?`${e}/${s}`:s,l=(0,Te.normalizePath)(a),c=this.host.app.vault.getAbstractFileByPath(l);if(c instanceof Te.TFile){new Te.Notice("\u65E2\u5B58\u30CE\u30FC\u30C8\u3092\u958B\u304D\u307E\u3059\u3002",2e3),await this.switchToFile(c);return}let u=l.split("/").slice(0,-1).join("/");if(u){let d=this.host.app.vault.getAbstractFileByPath(u);if(d){if(!(d instanceof Te.TFolder)){new Te.Notice("\u30D5\u30A9\u30EB\u30C0\u540D\u304C\u4E0D\u6B63\u3067\u3059\u3002",2500);return}}else try{await this.host.app.vault.createFolder(u)}catch(h){console.error("[Tategaki SoT] Failed to create folder",h),new Te.Notice("\u30D5\u30A9\u30EB\u30C0\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500);return}}try{let d=await this.host.app.vault.create(l,"");await this.switchToFile(d)}catch(d){console.error("[Tategaki SoT] Failed to create note",d),new Te.Notice("\u65B0\u898F\u30CE\u30FC\u30C8\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}async switchToFile(t){var n;if(((n=this.host.currentFile)==null?void 0:n.path)===t.path){new Te.Notice("\u65E2\u306B\u8868\u793A\u4E2D\u306E\u30D5\u30A1\u30A4\u30EB\u3067\u3059\u3002",1500);return}let e=this.getValidPairedMarkdownLeaf();if(!e){new Te.Notice("\u30DA\u30A2\u306EMarkdownView\u304C\u898B\u3064\u304B\u3089\u306A\u3044\u305F\u3081\u5207\u308A\u66FF\u3048\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}this.host.suppressPairCheck=!0;try{await e.openFile(t,{active:!1,state:{mode:"source"}});let r=this.host.leaf;await r.setViewState({type:"empty",active:!1}),await this.host.plugin.modeManager.openSoTWysiwygViewInLeaf(t,r)}catch(r){this.host.suppressPairCheck=!1,console.error("[Tategaki SoT] Failed to switch file",r),new Te.Notice("\u30D5\u30A1\u30A4\u30EB\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}async ensureMarkdownViewForFile(t){var r,o,s;if(this.host.pairedMarkdownView&&((r=this.host.pairedMarkdownView.file)==null?void 0:r.path)===t.path)return this.host.pairedMarkdownLeaf&&this.applyPairedMarkdownBadge(this.host.pairedMarkdownLeaf,this.host.pairedMarkdownView),this.host.pairedMarkdownView;let e=this.findMarkdownLeafForFile(t.path);if(e){let a=e.view;if(a instanceof Te.MarkdownView)return(o=a.editor)!=null&&o.cm?(this.host.pairedMarkdownLeaf=e,this.host.pairedMarkdownView=a,this.applyPairedMarkdownBadge(e,a),a):null}let n=this.host.app.workspace.getLeaf("tab");return await n.openFile(t,{active:!1,state:{mode:"source"}}),n.view instanceof Te.MarkdownView&&(s=n.view.editor)!=null&&s.cm?(this.host.pairedMarkdownLeaf=n,this.host.pairedMarkdownView=n.view,this.applyPairedMarkdownBadge(n,n.view),n.view):null}findMarkdownLeafForFile(t){var n;let e=this.host.app.workspace.getLeavesOfType("markdown");for(let r of e){let o=r.view;if(o instanceof Te.MarkdownView&&((n=o.file)==null?void 0:n.path)===t)return r}return null}ensurePairedMarkdownView(){if(this.host.suppressPairCheck||!this.host.currentFile||!this.host.pairedMarkdownLeaf)return;if(!this.host.app.workspace.getLeavesOfType("markdown").includes(this.host.pairedMarkdownLeaf)){this.clearPairedMarkdownBadge(),this.host.closeSelf();return}let e=this.host.pairedMarkdownLeaf.view;if(!(e instanceof Te.MarkdownView)){this.clearPairedMarkdownBadge(),this.host.closeSelf();return}if(!this.verifyPairedMarkdownViewFile(e,this.host.currentFile)){this.clearPairedMarkdownBadge(),this.host.closeSelf();return}this.host.pairedMarkdownView=e,this.applyPairedMarkdownBadge(this.host.pairedMarkdownLeaf,e)}verifyPairedMarkdownViewFile(t,e){var n;return((n=t.file)==null?void 0:n.path)===e.path?(this.host.pairedMismatchNotified=!1,!0):(this.host.pairedMismatchNotified||(this.host.pairedMismatchNotified=!0,new Te.Notice("\u30DA\u30A2\u306EMarkdownView\u304C\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u3068\u4E00\u81F4\u3057\u306A\u3044\u305F\u3081\u9589\u3058\u307E\u3059\u3002",2500)),!1)}applyPairedMarkdownBadge(t,e){var l,c;let n=this.getLeafTabHeaderEl(t),r=(l=n?this.getTabHeaderTitleHost(n):null)!=null?l:this.getViewHeaderTitleHost(e.containerEl);if(!r||this.host.pairedMarkdownBadgeLeaf===t&&this.host.pairedMarkdownBadgeEl&&this.host.pairedMarkdownBadgeEl.isConnected)return;this.clearPairedMarkdownBadge();let o=r.querySelector(`.${ME}`),s=(c=r.ownerDocument)!=null?c:document,a=o!=null?o:s.createElement("span");if(o||(a.className=ME,r.appendChild(a)),a.setAttribute("aria-label",CE),a.setAttribute("title",CE),!a.querySelector(`.${Ch}`)){let u=s.createElement("span");u.className=Ch,a.appendChild(u),(0,Te.setIcon)(u,"user-round-pen")}if(!a.querySelector(`.${Lh}`)){let u=s.createElement("span");u.className=Lh,u.textContent=TE,a.appendChild(u)}(a.parentElement!==r||r.firstChild!==a)&&r.insertBefore(a,r.firstChild),this.host.pairedMarkdownBadgeLeaf=t,this.host.pairedMarkdownBadgeEl=a}clearPairedMarkdownBadge(){var t;(t=this.host.pairedMarkdownBadgeEl)!=null&&t.isConnected&&this.host.pairedMarkdownBadgeEl.remove(),this.host.pairedMarkdownBadgeLeaf=null,this.host.pairedMarkdownBadgeEl=null}applySoTTabBadge(){var a,l,c;let t=this.getLeafTabHeaderEl(this.host.leaf),e=(a=t?this.getTabHeaderTitleHost(t):null)!=null?a:this.getViewHeaderTitleHost(this.host.containerEl);if(!e||(l=this.host.sotTabBadgeEl)!=null&&l.isConnected)return;this.clearSoTTabBadge();let n=(c=e.ownerDocument)!=null?c:document,r=n.createElement("span");r.className=_N,r.setAttribute("aria-label",LE),r.setAttribute("title",LE);let o=n.createElement("span");o.className=Ch,r.appendChild(o),(0,Te.setIcon)(o,"user-round-pen");let s=n.createElement("span");s.className=Lh,s.textContent=TE,r.appendChild(s),e.insertBefore(r,e.firstChild),this.host.sotTabBadgeEl=r}clearSoTTabBadge(){var t;(t=this.host.sotTabBadgeEl)!=null&&t.isConnected&&this.host.sotTabBadgeEl.remove(),this.host.sotTabBadgeEl=null}getLeafTabHeaderEl(t){var l,c,u,d,h,f;let e=t,n=e==null?void 0:e.tabHeaderEl;if(n instanceof HTMLElement)return n;let r=(l=e==null?void 0:e.tabHeader)==null?void 0:l.el;if(r instanceof HTMLElement)return r;let o=(c=e==null?void 0:e.containerEl)!=null?c:void 0,s=(h=(u=e==null?void 0:e.id)!=null?u:o==null?void 0:o.getAttribute("data-id"))!=null?h:(d=o==null?void 0:o.dataset)==null?void 0:d.id,a=(f=o==null?void 0:o.ownerDocument)!=null?f:document;if(s){let p=a.querySelector(`.workspace-tab-header[data-id="${s}"]`);if(p)return p;let m=a.querySelector(`.workspace-tab-header[data-leaf-id="${s}"]`);if(m)return m}return null}getTabHeaderTitleHost(t){var e,n;return(n=(e=t.querySelector(".workspace-tab-header-inner-title"))!=null?e:t.querySelector(".workspace-tab-header-inner"))!=null?n:t}getViewHeaderTitleHost(t){var n;let e=t.querySelector(".view-header-title");return e?(n=e.parentElement)!=null?n:e:null}};function AE(i){let t=[],e=0;for(let n of i){let r=e,o=e+n.length;t.push({from:r,to:o}),e=o+1}return t}function IE(i){var Ae,$e,ke,ce,We,dt,Ct,vt,ht,Ue,Ze,en,ne,ie,Ie,oe,ye,Qe,pt,Lt,U,B;let{lines:t,normalizeLinkLabel:e}=i,n=new Set(i.collapsedHeadingLines),r=new Array(t.length).fill("normal"),o=new Array(t.length).fill(null),s=new Array(t.length).fill(null),a=new Array(t.length).fill(null),l=new Array(t.length).fill(null),c=new Array(t.length).fill(null),u=new Array(t.length).fill(null),d=new Array(t.length).fill(!1),h=new Array(t.length).fill(null),f=new Array(t.length).fill(null),p=new Array(t.length).fill(!1),m=new Array(t.length).fill(null),g=new Array(t.length).fill(null),b=new Array(t.length).fill(null),v=new Array(t.length).fill(null),y=new Array(t.length).fill(null),E=new Array(t.length).fill(null),x=new Map,S=new Map,w=new Map,k=!1,M=!1,L=!1,_="",P=null;for(let T=0;T<t.length;T+=1){let F=(Ae=t[T])!=null?Ae:"";if(!M&&T===0&&F.trim()==="---"){M=!0,k=!0,r[T]="frontmatter-fence";continue}if(k){F.trim()==="---"?(r[T]="frontmatter-fence",k=!1):r[T]="frontmatter";continue}if(L){_.length>0&&F.startsWith(_)?(r[T]="code-fence",s[T]=P,L=!1,_="",P=null):(r[T]="code",s[T]=P);continue}let V=F.match(/^(```+|~~~+)/);if(V&&V[1]){_=V[1],L=!0,r[T]="code-fence";let j=F.slice(_.length).trim();o[T]=j.length>0?j:null,P=j.length>0&&($e=j.split(/\s+/)[0])!=null?$e:null,s[T]=P;continue}}let I=0;for(let T=0;T<t.length;T+=1){if(r[T]!=="normal")continue;let F=(ke=t[T])!=null?ke:"",V=F.match(/^[ \t]*\[\^([^\]]+)\]:[ \t]*/);if(!V||!V[1])continue;let j=V[1];if(!x.has(j)){I+=1,x.set(j,I);let he=F.slice(V[0].length).trim();he.length>0&&S.set(j,he)}}for(let T=0;T<t.length;T+=1){if(r[T]!=="normal")continue;let V=((ce=t[T])!=null?ce:"").match(/^[ \t]*\[((?:\\.|[^\]])+)\]:[ \t]*([^\s]+)(?:[ \t]+(?:"([^"]+)"|'([^']+)'|\(([^)]+)\)))?[ \t]*$/);if(!V||!V[1]||!V[2])continue;let j=V[1],he=V[2],xe=e(j),Ce=he.trim();Ce.startsWith("<")&&Ce.endsWith(">")&&(Ce=Ce.slice(1,-1)),xe&&Ce&&w.set(xe,Ce)}for(let T=0;T<t.length;T+=1){let F=(We=r[T])!=null?We:"normal";if(F!=="code"&&F!=="code-fence")continue;let V=(dt=r[T-1])!=null?dt:"";if(V==="code"||V==="code-fence")continue;let j=T;for(;j<t.length;){let xe=(Ct=r[j])!=null?Ct:"normal";if(xe!=="code"&&xe!=="code-fence")break;j+=1}let he=j-1;if(!(he<T)){if(he===T)a[T]="single";else{a[T]="start";for(let xe=T+1;xe<he;xe+=1)a[xe]="middle";a[he]="end"}T=he}}let N=[],D=!1,R=-1,A=T=>/^\s*\$\$\s*$/.test(T);for(let T=0;T<t.length;T+=1){if(r[T]!=="normal"){D&&(N.push({start:R,end:T-1}),D=!1,R=-1);continue}let F=(vt=t[T])!=null?vt:"";if(!D){if(A(F)){D=!0,R=T,r[T]="math-fence";continue}F.match(/^\s*\$\$(.+)\$\$\s*$/)&&(r[T]="math",N.push({start:T,end:T}));continue}if(A(F)){r[T]="math-fence",N.push({start:R,end:T}),D=!1,R=-1;continue}r[T]="math"}D&&R>=0&&N.push({start:R,end:t.length-1});for(let T of N)for(let F=T.start;F<=T.end;F+=1)l[F]=T.start,c[F]=T.end;let C=[],O=null,H=null;for(let T=0;T<t.length;T+=1){if(r[T]!=="normal"){O&&H!==null&&C.push({start:H,end:T-1}),O=null,H=null;continue}let F=(ht=t[T])!=null?ht:"",V=F.match(/^[ \t]{0,3}>[ \t]*\[!([A-Za-z0-9_-]+)\](?:[+-])?[ \t]*(.*)$/);if(V&&V[1]){O&&H!==null&&C.push({start:H,end:T-1}),O=V[1].toLowerCase(),H=T,r[T]="callout-title",u[T]=O,d[T]=!0;continue}if(O){if(/^[ \t]{0,3}>/.test(F)){r[T]="callout",u[T]=O;continue}H!==null&&C.push({start:H,end:T-1}),O=null,H=null}}O&&H!==null&&C.push({start:H,end:t.length-1});for(let T of C)for(let F=T.start;F<=T.end;F+=1)h[F]=T.start,f[F]=T.end;let K=T=>{let F=T.trim();return F.includes("|")?/^(\|?\s*:?-{3,}:?\s*)(\|\s*:?-{3,}:?\s*)+\|?$/.test(F):!1},W=T=>{for(let F=0;F<T.length;F+=1){if(T[F]!=="|")continue;let V=0;for(let j=F-1;j>=0&&T[j]==="\\";j-=1)V+=1;if(V%2===0)return!0}return!1};for(let T=0;T<t.length-1;T+=1){if(r[T]!=="normal"||r[T+1]!=="normal")continue;let F=(Ue=t[T])!=null?Ue:"",V=(Ze=t[T+1])!=null?Ze:"";if(!W(F)||!K(V))continue;r[T]="table-row",p[T]=!0,r[T+1]="table-sep";let j=T+2;for(;j<t.length&&r[j]==="normal";j+=1){let he=(en=t[j])!=null?en:"";if(he.trim().length===0||!W(he))break;r[j]="table-row"}T=j-1}for(let T=0;T<t.length;T+=1){let F=(ne=r[T])!=null?ne:"normal";if(F!=="table-row"&&F!=="table-sep")continue;let V=(ie=r[T-1])!=null?ie:"normal";if(V==="table-row"||V==="table-sep")continue;let j=T;for(;j<t.length;){let xe=(Ie=r[j])!=null?Ie:"normal";if(xe!=="table-row"&&xe!=="table-sep")break;j+=1}let he=j-1;if(!(he<T)){for(let xe=T;xe<=he;xe+=1)m[xe]=T,g[xe]=he;T=he}}let te=[],J=T=>/^[ \t]*:[ \t]+/.test(T);for(let T=0;T<t.length-1;T+=1){if(r[T]!=="normal"||r[T+1]!=="normal")continue;let F=(oe=t[T])!=null?oe:"",V=(ye=t[T+1])!=null?ye:"";if(F.trim().length===0||!J(V))continue;let j=T,he=T+1,xe=T+2;for(;xe<t.length&&r[xe]==="normal";xe+=1){let Ce=(Qe=t[xe])!=null?Qe:"";if(Ce.trim().length===0)break;if(J(Ce)){he=xe;continue}let tn=(pt=t[xe+1])!=null?pt:"";if(xe+1<t.length&&J(tn)&&Ce.trim().length>0){he=xe+1,xe+=1;continue}break}te.push({start:j,end:he});for(let Ce=j;Ce<=he;Ce+=1)r[Ce]="deflist";T=he}for(let T of te)for(let F=T.start;F<=T.end;F+=1)b[F]=T.start,v[F]=T.end;let Q=[];for(let T=0;T<t.length;T+=1){if(r[T]!=="normal")continue;let V=((Lt=t[T])!=null?Lt:"").match(/^(#{1,6})([ \t]+)(.*)$/);if(!V)continue;let j=(B=(U=V[1])==null?void 0:U.length)!=null?B:1;Q.push({index:T,level:j})}for(let T=0;T<Q.length;T+=1){let F=Q[T],V=t.length-1;for(let j=T+1;j<Q.length;j+=1){let he=Q[j];if(he.level<=F.level){V=he.index-1;break}}y[F.index]=V}if(n.size>0){let T=new Set;for(let F of Q)n.has(F.index)&&T.add(F.index);n=T}for(let T of Q){if(!n.has(T.index))continue;let F=y[T.index];if(!(F===null||F<=T.index))for(let V=T.index+1;V<=F;V+=1)E[V]===null&&(E[V]=T.index)}return{lineBlockKinds:r,lineCodeFenceInfo:o,lineCodeLang:s,lineCodeBlockPart:a,lineMathBlockStart:l,lineMathBlockEnd:c,lineCalloutType:u,lineCalloutIsTitle:d,lineCalloutBlockStart:h,lineCalloutBlockEnd:f,lineTableIsHeader:p,lineTableBlockStart:m,lineTableBlockEnd:g,lineDeflistBlockStart:b,lineDeflistBlockEnd:v,lineHeadingSectionEnd:y,lineHeadingHiddenBy:E,footnoteDefinitionOrder:x,footnoteDefinitionText:S,linkReferenceMap:w,collapsedHeadingLines:n}}var Wn=require("obsidian"),Tl=class{constructor(t,e){this.buttons=[];this.headingButton=null;this.writingModeButton=null;this.readingModeButton=null;this.horizontalRuleButton=null;this.sourceToggleButton=null;this.rubyToggleButton=null;this.ceImeToggleButton=null;this.container=t,this.adapter=e,this.createToolbar()}destroy(){this.container.empty(),this.buttons=[],this.headingButton=null,this.writingModeButton=null,this.readingModeButton=null,this.horizontalRuleButton=null,this.sourceToggleButton=null,this.rubyToggleButton=null,this.ceImeToggleButton=null}update(){this.updateButtonStates()}createToolbar(){if(this.container.empty(),this.container.addClass("contenteditable-toolbar"),this.buttons=[],Wn.Platform.isMobile||Wn.Platform.isMobileApp){if(this.container.addClass("tiptap-toolbar-mobile"),this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: nowrap;
				flex: 1 1 auto;
				min-width: 0;
				width: 100%;
				max-width: 100%;
				overflow-x: auto;
				overflow-y: hidden;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				touch-action: pan-x;
				overscroll-behavior-x: contain;
			`,!document.getElementById("tiptap-toolbar-mobile-scrollbar-style")){let e=document.createElement("style");e.id="tiptap-toolbar-mobile-scrollbar-style",e.textContent=`
					.tiptap-toolbar-mobile::-webkit-scrollbar {
						display: none;
					}
					.tiptap-toolbar-mobile .contenteditable-toolbar-button,
					.tiptap-toolbar-mobile .contenteditable-toolbar-separator {
						flex: 0 0 auto;
					}
				`,document.head.appendChild(e)}}else this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: wrap;
				flex: 1 1 auto;
				min-width: 0;
			`;this.createWritingModeButton(),this.createSeparator(),this.adapter.openFileSwitcher&&(this.createFileSwitchButton(),this.createSeparator()),this.adapter.toggleReadingMode&&(this.createReadingModeButton(),this.createSeparator()),this.createUndoRedoButtons(),this.createSeparator(),this.createInlineButtons(),this.createSeparator(),this.createHeadingMenuButton(),this.createSeparator(),this.createListButtons(),this.createSeparator(),this.createInsertButtons(),this.createSeparator(),this.createClearFormattingButton(),this.adapter.toggleRuby&&(this.createSeparator(),this.createRubyToggleButton()),this.adapter.togglePlainTextView&&(this.createSeparator(),this.createPlainTextToggleButton()),this.createSeparator(),this.createSourceToggleButton(),this.adapter.toggleCeImeMode&&(this.createSeparator(),this.createCeImeToggleButton()),this.adapter.openSettings&&(this.createSeparator(),this.createSettingsButton()),this.adapter.openOutline&&(this.createSeparator(),this.createOutlineButton()),this.updateButtonStates()}createButton(t,e,n,r,o,s,a,l){let c=this.container.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":n}});(0,Wn.setIcon)(c,e);let u={id:t,button:c,icon:e,title:n,onClick:r,isActive:o,isDisabled:s,getIcon:a,getTitle:l,currentIcon:e};return this.buttons.push(u),c.addEventListener("click",d=>{if(d.preventDefault(),c.disabled)return;let h=r==null?void 0:r();h&&typeof h.then=="function"?h.finally(()=>this.updateButtonStates()):this.updateButtonStates()}),c}createSeparator(){let t=this.container.createEl("div",{cls:"contenteditable-toolbar-separator"});t.style.cssText=`
			width: 1px;
			height: 24px;
			background-color: var(--background-modifier-border);
			margin: 0 4px;
		`}createWritingModeButton(){let t=()=>{var n,r;return((r=(n=this.adapter).getWritingMode)==null?void 0:r.call(n))==="vertical-rl"?"arrow-down-up":"arrow-left-right"},e=()=>{var n,r;return((r=(n=this.adapter).getWritingMode)==null?void 0:r.call(n))==="vertical-rl"?"\u6A2A\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048":"\u7E26\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048"};this.writingModeButton=this.createButton("writingMode",t(),"\u66F8\u5B57\u65B9\u5411\u5207\u308A\u66FF\u3048",this.adapter.toggleWritingMode?()=>{var n,r;(r=(n=this.adapter).toggleWritingMode)==null||r.call(n)}:void 0,void 0,()=>!this.adapter.toggleWritingMode,t,e)}createFileSwitchButton(){this.createButton("fileSwitch","folder-open","\u30D5\u30A1\u30A4\u30EB\u5207\u66FF",this.adapter.openFileSwitcher,void 0,()=>!this.adapter.openFileSwitcher)}createReadingModeButton(){let t=()=>{var r,o,s;return(s=(o=(r=this.adapter).isReadingMode)==null?void 0:o.call(r))!=null?s:!1},e=()=>t()?"book-open":"book",n=()=>t()?"\u66F8\u7C4D\u30E2\u30FC\u30C9\u3092\u7D42\u4E86":"\u66F8\u7C4D\u30E2\u30FC\u30C9\u3078\u79FB\u52D5";this.readingModeButton=this.createButton("readingMode",e(),n(),this.adapter.toggleReadingMode,t,()=>!this.adapter.toggleReadingMode,e,n)}createUndoRedoButtons(){this.createButton("undo","undo","\u5143\u306B\u623B\u3059",this.adapter.undo,void 0,()=>{var t,e;return!this.adapter.undo||((e=(t=this.adapter).canUndo)==null?void 0:e.call(t))===!1}),this.createButton("redo","redo","\u3084\u308A\u76F4\u3059",this.adapter.redo,void 0,()=>{var t,e;return!this.adapter.redo||((e=(t=this.adapter).canRedo)==null?void 0:e.call(t))===!1})}createInlineButtons(){this.createButton("bold","bold","\u592A\u5B57",this.adapter.toggleBold,this.adapter.isBoldActive,()=>{var t,e,n,r,o,s;return!this.adapter.toggleBold||!((n=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&n)||!((s=(o=(r=this.adapter).isInlineSelectionAllowed)==null?void 0:o.call(r))==null||s)}),this.createButton("italic","italic","\u659C\u4F53",this.adapter.toggleItalic,this.adapter.isItalicActive,()=>{var t,e,n,r,o,s;return!this.adapter.toggleItalic||!((n=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&n)||!((s=(o=(r=this.adapter).isInlineSelectionAllowed)==null?void 0:o.call(r))==null||s)}),this.createButton("strikethrough","strikethrough","\u53D6\u308A\u6D88\u3057\u7DDA",this.adapter.toggleStrikethrough,this.adapter.isStrikethroughActive,()=>{var t,e,n,r,o,s;return!this.adapter.toggleStrikethrough||!((n=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&n)||!((s=(o=(r=this.adapter).isInlineSelectionAllowed)==null?void 0:o.call(r))==null||s)}),this.adapter.toggleUnderline&&this.createButton("underline","underline","\u4E0B\u7DDA",this.adapter.toggleUnderline,this.adapter.isUnderlineActive,()=>{var t,e,n,r,o,s;return!this.adapter.toggleUnderline||!((n=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&n)||!((s=(o=(r=this.adapter).isInlineSelectionAllowed)==null?void 0:o.call(r))==null||s)}),this.createButton("highlight","highlighter","\u30CF\u30A4\u30E9\u30A4\u30C8",this.adapter.toggleHighlight,this.adapter.isHighlightActive,()=>{var t,e,n,r,o,s;return!this.adapter.toggleHighlight||!((n=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&n)||!((s=(o=(r=this.adapter).isInlineSelectionAllowed)==null?void 0:o.call(r))==null||s)}),this.createButton("inlineCode","code","\u30A4\u30F3\u30E9\u30A4\u30F3\u30B3\u30FC\u30C9",this.adapter.toggleInlineCode,this.adapter.isInlineCodeActive,()=>{var t,e,n,r,o,s;return!this.adapter.toggleInlineCode||!((n=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&n)||!((s=(o=(r=this.adapter).isInlineSelectionAllowed)==null?void 0:o.call(r))==null||s)})}createHeadingMenuButton(){this.headingButton=this.createButton("heading","heading","\u898B\u51FA\u3057",()=>{var o,s,a;if(!this.headingButton||!this.adapter.setHeading)return;let t=new Wn.Menu,e=(a=(s=(o=this.adapter).getHeadingLevel)==null?void 0:s.call(o))!=null?a:0,n={1:"heading-1",2:"heading-2",3:"heading-3",4:"heading-4",5:"heading-5",6:"heading-6"};for(let l=1;l<=6;l+=1)t.addItem(c=>{c.setTitle(`\u898B\u51FA\u3057${l}`).setIcon(n[l]).onClick(()=>{var u,d;(d=(u=this.adapter).setHeading)==null||d.call(u,l)}),e===l&&c.setChecked(!0)});t.addItem(l=>{l.setTitle("\u898B\u51FA\u3057\u89E3\u9664").setIcon("text").onClick(()=>{var c,u;(u=(c=this.adapter).clearHeading)==null||u.call(c)}),e===0&&l.setChecked(!0)});let r=this.headingButton.getBoundingClientRect();t.showAtPosition({x:r.left,y:r.bottom})},()=>{var t,e,n;return((n=(e=(t=this.adapter).getHeadingLevel)==null?void 0:e.call(t))!=null?n:0)>0},()=>!this.adapter.setHeading)}createListButtons(){this.createButton("bulletList","list","\u7B87\u6761\u66F8\u304D\u30EA\u30B9\u30C8",this.adapter.toggleBulletList,this.adapter.isBulletListActive,()=>!this.adapter.toggleBulletList),this.createButton("orderedList","list-ordered","\u756A\u53F7\u4ED8\u304D\u30EA\u30B9\u30C8",this.adapter.toggleOrderedList,this.adapter.isOrderedListActive,()=>!this.adapter.toggleOrderedList),this.createButton("blockquote","quote","\u5F15\u7528",this.adapter.toggleBlockquote,this.adapter.isBlockquoteActive,()=>!this.adapter.toggleBlockquote),this.createButton("codeBlock","code-2","\u30B3\u30FC\u30C9\u30D6\u30ED\u30C3\u30AF",this.adapter.toggleCodeBlock,this.adapter.isCodeBlockActive,()=>!this.adapter.toggleCodeBlock)}createInsertButtons(){this.createButton("link","link","\u30EA\u30F3\u30AF\u633F\u5165",this.adapter.insertLink,void 0,()=>{var e,n,r;return!this.adapter.insertLink||!((r=(n=(e=this.adapter).isInlineSelectionAllowed)==null?void 0:n.call(e))==null||r)}),this.createButton("ruby","gem","\u30EB\u30D3\u633F\u5165",this.adapter.insertRuby,void 0,()=>{var e,n,r,o,s,a;return!this.adapter.insertRuby||!((r=(n=(e=this.adapter).hasSelection)==null?void 0:n.call(e))!=null&&r)||!((a=(s=(o=this.adapter).isInlineSelectionAllowed)==null?void 0:s.call(o))==null||a)});let t=()=>{var n,r;return((r=(n=this.adapter).getWritingMode)==null?void 0:r.call(n))==="vertical-rl"?"separator-vertical":"separator-horizontal"};this.horizontalRuleButton=this.createButton("horizontalRule",t(),"\u533A\u5207\u308A\u7DDA",this.adapter.insertHorizontalRule,void 0,()=>!this.adapter.insertHorizontalRule,t)}createClearFormattingButton(){this.createButton("clearFormatting","eraser","\u66F8\u5F0F\u30AF\u30EA\u30A2",this.adapter.clearFormatting,void 0,()=>!this.adapter.clearFormatting)}createRubyToggleButton(){this.rubyToggleButton=this.createButton("rubyToggle","eye","\u30EB\u30D3\u8868\u793A\u306E\u30AA\u30F3/\u30AA\u30D5",this.adapter.toggleRuby,()=>{var t,e,n;return(n=(e=(t=this.adapter).isRubyEnabled)==null?void 0:e.call(t))!=null?n:!0},()=>{var t,e,n;return!this.adapter.toggleRuby||((n=(e=(t=this.adapter).isPlainTextView)==null?void 0:e.call(t))!=null?n:!1)},()=>{var t,e;return((e=(t=this.adapter).isRubyEnabled)==null?void 0:e.call(t))===!1?"eye-off":"eye"},()=>{var t,e;return((e=(t=this.adapter).isRubyEnabled)==null?void 0:e.call(t))===!1?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3059\u308B":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3059\u308B"})}createPlainTextToggleButton(){this.createButton("plainTextView","type","\u5168\u6587\u30D7\u30EC\u30FC\u30F3\u8868\u793A",this.adapter.togglePlainTextView,()=>{var t,e,n;return(n=(e=(t=this.adapter).isPlainTextView)==null?void 0:e.call(t))!=null?n:!1},()=>!this.adapter.togglePlainTextView,void 0,()=>{var t,e,n;return(n=(e=(t=this.adapter).isPlainTextView)==null?void 0:e.call(t))!=null&&n?"\u5168\u6587\u30D7\u30EC\u30FC\u30F3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3059\u308B":"\u5168\u6587\u30D7\u30EC\u30FC\u30F3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3059\u308B"})}createSourceToggleButton(){this.sourceToggleButton=this.createButton("sourceMode","file-text","\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6",this.adapter.toggleSourceMode,()=>{var t,e,n;return(n=(e=(t=this.adapter).isSourceMode)==null?void 0:e.call(t))!=null?n:!1},()=>{var t,e,n;return!this.adapter.toggleSourceMode||((n=(e=(t=this.adapter).isPlainTextView)==null?void 0:e.call(t))!=null?n:!1)},()=>{var t,e,n;return(n=(e=(t=this.adapter).isSourceMode)==null?void 0:e.call(t))!=null&&n?"file-code":"file-text"},()=>{var t,e,n;return(n=(e=(t=this.adapter).isSourceMode)==null?void 0:e.call(t))!=null&&n?"\u88C5\u98FE\u8868\u793A\u306B\u623B\u3059":"\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u30E2\u30FC\u30C9"})}createCeImeToggleButton(){this.ceImeToggleButton=this.createButton("ceImeMode","toggle-left","CE\u88DC\u52A9(IME)",this.adapter.toggleCeImeMode,()=>{var t,e,n;return(n=(e=(t=this.adapter).isCeImeMode)==null?void 0:e.call(t))!=null?n:!1},()=>!this.adapter.toggleCeImeMode,()=>{var t,e;return(e=(t=this.adapter).isCeImeMode)!=null&&e.call(t)?"toggle-right":"toggle-left"},()=>{var t,e;return(e=(t=this.adapter).isCeImeMode)!=null&&e.call(t)?"CE\u88DC\u52A9(IME)\u3092\u30AA\u30D5\u306B\u3059\u308B":"CE\u88DC\u52A9(IME)\u3092\u30AA\u30F3\u306B\u3059\u308B"})}createSettingsButton(){this.createButton("settings","settings","\u8868\u793A\u8A2D\u5B9A",this.adapter.openSettings,void 0,()=>!this.adapter.openSettings)}createOutlineButton(){this.createButton("outline","list-tree","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",this.adapter.openOutline,void 0,()=>!this.adapter.openOutline)}updateButtonStates(){var e,n,r,o,s,a,l,c,u,d;let t=(n=(e=this.adapter).getWritingMode)==null?void 0:n.call(e);if(this.writingModeButton){let h=t==="vertical-rl"?"\u6A2A\u66F8\u304D":"\u7E26\u66F8\u304D";this.writingModeButton.setAttr("aria-label",`${h}\u306B\u5207\u308A\u66FF\u3048`)}if(this.horizontalRuleButton){let h=t==="vertical-rl"?"separator-vertical":"separator-horizontal",f=this.buttons.find(p=>p.button===this.horizontalRuleButton);f&&f.currentIcon!==h&&((0,Wn.setIcon)(this.horizontalRuleButton,h),f.currentIcon=h)}for(let h of this.buttons){let f=(o=(r=h.isActive)==null?void 0:r.call(h))!=null?o:!1,p=(a=(s=h.isDisabled)==null?void 0:s.call(h))!=null?a:!1;h.button.disabled=p,h.button.classList.toggle("is-active",f);let m=(c=(l=h.getTitle)==null?void 0:l.call(h))!=null?c:h.title;m&&h.button.setAttr("aria-label",m);let g=(d=(u=h.getIcon)==null?void 0:u.call(h))!=null?d:h.icon;g&&h.currentIcon!==g&&((0,Wn.setIcon)(h.button,g),h.currentIcon=g)}}};var NE=require("obsidian"),Cl=class{constructor(t){this.adapter=t}show(t){t.preventDefault(),t.stopPropagation();let e=new NE.Menu;this.buildMenu(e),e.showAtPosition({x:t.clientX,y:t.clientY})}buildMenu(t){this.addClipboardSection(t),this.addInlineSection(t),this.addHeadingSection(t),this.addBlockSection(t),this.addInsertSection(t),this.addClearSection(t)}addClipboardSection(t){var r,o,s;let e=!1,n=(s=(o=(r=this.adapter).hasSelection)==null?void 0:o.call(r))!=null?s:!1;this.adapter.cut&&(t.addItem(a=>{a.setTitle("\u5207\u308A\u53D6\u308A").setIcon("scissors").setDisabled(!n).onClick(()=>{var l,c;(c=(l=this.adapter).cut)==null||c.call(l)})}),e=!0),this.adapter.copy&&(t.addItem(a=>{a.setTitle("\u30B3\u30D4\u30FC").setIcon("copy").setDisabled(!n).onClick(()=>{var l,c;(c=(l=this.adapter).copy)==null||c.call(l)})}),e=!0),this.adapter.paste&&(t.addItem(a=>{a.setTitle("\u8CBC\u308A\u4ED8\u3051").setIcon("clipboard-paste").onClick(()=>{var l,c;(c=(l=this.adapter).paste)==null||c.call(l)})}),e=!0),this.adapter.selectAll&&(t.addItem(a=>{a.setTitle("\u3059\u3079\u3066\u9078\u629E").setIcon("select-all").onClick(()=>{var l,c;(c=(l=this.adapter).selectAll)==null||c.call(l)})}),e=!0),e&&t.addSeparator()}addInlineSection(t){var s,a,l,c,u,d;let e=(l=(a=(s=this.adapter).hasSelection)==null?void 0:a.call(s))!=null?l:!1,n=(d=(u=(c=this.adapter).isInlineSelectionAllowed)==null?void 0:u.call(c))!=null?d:!0,r=[{title:"\u592A\u5B57",icon:"bold",action:this.adapter.toggleBold,active:this.adapter.isBoldActive},{title:"\u659C\u4F53",icon:"italic",action:this.adapter.toggleItalic,active:this.adapter.isItalicActive},{title:"\u53D6\u308A\u6D88\u3057\u7DDA",icon:"strikethrough",action:this.adapter.toggleStrikethrough,active:this.adapter.isStrikethroughActive},{title:"\u4E0B\u7DDA",icon:"underline",action:this.adapter.toggleUnderline,active:this.adapter.isUnderlineActive},{title:"\u30CF\u30A4\u30E9\u30A4\u30C8",icon:"highlighter",action:this.adapter.toggleHighlight,active:this.adapter.isHighlightActive}],o=!1;for(let h of r)h.action&&(t.addItem(f=>{var p;f.setTitle(h.title).setIcon(h.icon).setDisabled(!e||!n).onClick(()=>{var m;(m=h.action)==null||m.call(h)}),(p=h.active)!=null&&p.call(h)&&f.setChecked(!0)}),o=!0);o&&t.addSeparator()}addHeadingSection(t){var n,r,o;if(!this.adapter.setHeading)return;let e=(o=(r=(n=this.adapter).getHeadingLevel)==null?void 0:r.call(n))!=null?o:0;for(let s=1;s<=6;s+=1)t.addItem(a=>{a.setTitle(`\u898B\u51FA\u3057${s}`).setIcon(`heading-${s}`).onClick(()=>{var l,c;(c=(l=this.adapter).setHeading)==null||c.call(l,s)}),e===s&&a.setChecked(!0)});t.addItem(s=>{s.setTitle("\u898B\u51FA\u3057\u89E3\u9664").setIcon("text").onClick(()=>{var a,l;(l=(a=this.adapter).clearHeading)==null||l.call(a)}),e===0&&s.setChecked(!0)}),t.addSeparator()}addBlockSection(t){let e=[{title:"\u7B87\u6761\u66F8\u304D\u30EA\u30B9\u30C8",icon:"list",action:this.adapter.toggleBulletList,active:this.adapter.isBulletListActive},{title:"\u756A\u53F7\u4ED8\u304D\u30EA\u30B9\u30C8",icon:"list-ordered",action:this.adapter.toggleOrderedList,active:this.adapter.isOrderedListActive}],n=!1;for(let r of e)r.action&&(t.addItem(o=>{var s;o.setTitle(r.title).setIcon(r.icon).onClick(()=>{var a;(a=r.action)==null||a.call(r)}),(s=r.active)!=null&&s.call(r)&&o.setChecked(!0)}),n=!0);n&&t.addSeparator()}addInsertSection(t){var n,r,o,s,a,l;let e=!1;if(this.adapter.insertRuby){let c=(o=(r=(n=this.adapter).hasSelection)==null?void 0:r.call(n))!=null?o:!1,u=(l=(a=(s=this.adapter).isInlineSelectionAllowed)==null?void 0:a.call(s))!=null?l:!0;t.addItem(d=>{d.setTitle("\u30EB\u30D3\u633F\u5165").setIcon("gem").setDisabled(!c||!u).onClick(()=>{var h,f;(f=(h=this.adapter).insertRuby)==null||f.call(h)})}),e=!0}e&&t.addSeparator()}addClearSection(t){this.adapter.clearFormatting&&t.addItem(e=>{e.setTitle("\u66F8\u5F0F\u30AF\u30EA\u30A2").setIcon("eraser").onClick(()=>{var n,r;(r=(n=this.adapter).clearFormatting)==null||r.call(n)})})}};var Gt=require("obsidian");function _E(i,t,e,n){let r=i.getDoc();if(!r||n===null)return;let o=i.lineMathBlockStart[n],s=i.lineMathBlockEnd[n];if(o===null||s===null||o<0||s<o||s>=i.lineRanges.length){let g=document.createElement("div");g.className="tategaki-md-math-widget-loading",g.textContent="\u6570\u5F0F\u30D6\u30ED\u30C3\u30AF\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(g);return}if(n!==o){let g=document.createElement("span");g.className="tategaki-sot-eol",g.dataset.offset=String(e.to),g.textContent="\u200B",t.appendChild(g);return}let a=document.createElement("div");a.className="tategaki-md-math-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-math-widget-loading",l.textContent="\u6570\u5F0F\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-math-widget-content",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=i.lineRanges[o],h=i.lineRanges[s];if(!d||!h){l.textContent="\u6570\u5F0F\u30D6\u30ED\u30C3\u30AF\u7BC4\u56F2\u304C\u4E0D\u6B63\u3067\u3059\u3002";return}let f=r.slice(d.from,h.to),p=i.getSourcePath(),m=new Gt.MarkdownRenderChild(c);i.addChild(m),i.mathRenderChildren.set(o,m),Gt.MarkdownRenderer.render(i.app,f,c,p,m).then(()=>{t.isConnected&&l.remove()}).catch(()=>{t.isConnected&&(l.textContent="\u6570\u5F0F\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function OE(i,t,e,n){var g;let r=i.getDoc();if(!r||n===null)return;let o=i.lineCalloutBlockStart[n],s=i.lineCalloutBlockEnd[n];if(o===null||s===null||o<0||s<o||s>=i.lineRanges.length){let b=document.createElement("div");b.className="tategaki-md-callout-widget-loading",b.textContent="\u30B3\u30FC\u30EB\u30A2\u30A6\u30C8\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(b);return}if(n!==o){let b=document.createElement("span");b.className="tategaki-sot-eol",b.dataset.offset=String(e.to),b.textContent="\u200B",t.appendChild(b);return}let a=document.createElement("div");a.className="tategaki-md-callout-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-callout-widget-loading",l.textContent="\u30B3\u30FC\u30EB\u30A2\u30A6\u30C8\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-callout-widget-content markdown-rendered",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=[];for(let b=o;b<=s;b+=1){let v=i.lineRanges[b];v&&d.push(r.slice(v.from,v.to))}let h=d.join(`
`),f=i.getSourcePath(),p=(g=t.dataset.calloutRange)!=null?g:"",m=new Gt.MarkdownRenderChild(c);i.addChild(m),i.calloutRenderChildren.set(n,m),Gt.MarkdownRenderer.render(i.app,h,c,f,m).then(()=>{var b;t.isConnected&&((b=t.dataset.calloutRange)!=null?b:"")===p&&l.remove()}).catch(()=>{var b;t.isConnected&&((b=t.dataset.calloutRange)!=null?b:"")===p&&(l.textContent="\u30B3\u30FC\u30EB\u30A2\u30A6\u30C8\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function DE(i,t,e,n){var g;let r=i.getDoc();if(!r||n===null)return;let o=i.lineTableBlockStart[n],s=i.lineTableBlockEnd[n];if(o===null||s===null||o<0||s<o||s>=i.lineRanges.length){let b=document.createElement("div");b.className="tategaki-md-table-widget-loading",b.textContent="\u30C6\u30FC\u30D6\u30EB\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(b);return}if(n!==o){let b=document.createElement("span");b.className="tategaki-sot-eol",b.dataset.offset=String(e.to),b.textContent="\u200B",t.appendChild(b);return}let a=document.createElement("div");a.className="tategaki-md-table-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-table-widget-loading",l.textContent="\u30C6\u30FC\u30D6\u30EB\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-table-widget-content markdown-rendered",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=[];for(let b=o;b<=s;b+=1){let v=i.lineRanges[b];v&&d.push(r.slice(v.from,v.to))}let h=d.join(`
`),f=i.getSourcePath(),p=(g=t.dataset.tableRange)!=null?g:"",m=new Gt.MarkdownRenderChild(c);i.addChild(m),i.tableRenderChildren.set(n,m),Gt.MarkdownRenderer.render(i.app,h,c,f,m).then(()=>{var b;t.isConnected&&((b=t.dataset.tableRange)!=null?b:"")===p&&l.remove()}).catch(()=>{var b;t.isConnected&&((b=t.dataset.tableRange)!=null?b:"")===p&&(l.textContent="\u30C6\u30FC\u30D6\u30EB\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function BE(i,t,e,n){var g;let r=i.getDoc();if(!r||n===null)return;let o=i.lineDeflistBlockStart[n],s=i.lineDeflistBlockEnd[n];if(o===null||s===null||o<0||s<o||s>=i.lineRanges.length){let b=document.createElement("div");b.className="tategaki-md-deflist-widget-loading",b.textContent="\u5B9A\u7FA9\u30EA\u30B9\u30C8\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(b);return}if(n!==o){let b=document.createElement("span");b.className="tategaki-sot-eol",b.dataset.offset=String(e.to),b.textContent="\u200B",t.appendChild(b);return}let a=document.createElement("div");a.className="tategaki-md-deflist-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-deflist-widget-loading",l.textContent="\u5B9A\u7FA9\u30EA\u30B9\u30C8\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-deflist-widget-content markdown-rendered",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=[];for(let b=o;b<=s;b+=1){let v=i.lineRanges[b];v&&d.push(r.slice(v.from,v.to))}let h=d.join(`
`),f=i.getSourcePath(),p=(g=t.dataset.deflistRange)!=null?g:"",m=new Gt.MarkdownRenderChild(c);i.addChild(m),i.deflistRenderChildren.set(n,m),Gt.MarkdownRenderer.render(i.app,h,c,f,m).then(()=>{var b;t.isConnected&&((b=t.dataset.deflistRange)!=null?b:"")===p&&l.remove()}).catch(()=>{var b;t.isConnected&&((b=t.dataset.deflistRange)!=null?b:"")===p&&(l.textContent="\u5B9A\u7FA9\u30EA\u30B9\u30C8\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function FE(i,t,e){var u,d,h;let n=((u=t.dataset.imageSrc)!=null?u:"").trim(),r=((d=t.dataset.imageAlt)!=null?d:"").trim(),o=((h=t.dataset.imageWidth)!=null?h:"").trim(),s=document.createElement("span");s.className="tategaki-md-image-widget-inner",t.appendChild(s);let a=document.createElement("img");a.className="tategaki-md-image-widget-img",a.loading="lazy",a.alt=r;let l=DN(i,n);if(l?a.src=l:a.src=n,/^\d+$/.test(o)&&(a.style.maxWidth=`${o}px`,a.style.maxHeight=`${o}px`),s.appendChild(a),r.length>0){let f=document.createElement("span");f.className="tategaki-md-image-widget-caption",f.textContent=r,s.appendChild(f)}let c=document.createElement("span");c.className="tategaki-sot-eol",c.dataset.offset=String(e.to),c.textContent="\u200B",t.appendChild(c)}function HE(i,t,e,n){var m,g,b;let r=((m=t.dataset.embedTarget)!=null?m:"").trim(),o=document.createElement("div");o.className="tategaki-md-embed-widget-inner markdown-embed",t.appendChild(o);let s=document.createElement("div");s.className="tategaki-md-embed-widget-loading",s.textContent="\u57CB\u3081\u8FBC\u307F\u3092\u8AAD\u307F\u8FBC\u307F\u4E2D\u2026",o.appendChild(s);let a=document.createElement("div");a.className="tategaki-md-embed-widget-content",o.appendChild(a);let l=document.createElement("span");if(l.className="tategaki-sot-eol",l.dataset.offset=String(e.to),l.textContent="\u200B",t.appendChild(l),!r){s.textContent="\u57CB\u3081\u8FBC\u307F\u5148\u304C\u7A7A\u3067\u3059\u3002";return}let c=i.getSourcePath(),u=ON(r);if(!u){s.textContent=`\u57CB\u3081\u8FBC\u307F\u306E\u5F62\u5F0F\u304C\u4E0D\u6B63\u3067\u3059: ${r}`;return}let d=i.app.metadataCache.getFirstLinkpathDest(u.linkpath,c);if(!d){s.textContent=`\u57CB\u3081\u8FBC\u307F\u5148\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${u.linkpath}`;return}let h=i.app.metadataCache.getFileCache(d);if(u.heading&&!((g=h==null?void 0:h.headings)!=null?g:[]).some(y=>PE(y.heading)===PE(u.heading))){s.textContent=`\u898B\u51FA\u3057\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${u.heading}`;return}if(u.blockId){let v=(b=h==null?void 0:h.blocks)!=null?b:{};if(!(v[u.blockId]||v[`^${u.blockId}`])){s.textContent=`\u30D6\u30ED\u30C3\u30AF\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${u.blockId}`;return}}let f=`![[${r}]]`,p=new Gt.MarkdownRenderChild(a);i.addChild(p),n!==null&&i.embedRenderChildren.set(n,p),Gt.MarkdownRenderer.render(i.app,f,a,c,p).then(()=>{var v;t.isConnected&&((v=t.dataset.embedTarget)!=null?v:"").trim()===r&&s.remove()}).catch(()=>{var v;t.isConnected&&((v=t.dataset.embedTarget)!=null?v:"").trim()===r&&(s.textContent="\u57CB\u3081\u8FBC\u307F\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function ON(i){var c,u;let t=i.trim();if(!t)return null;let e=(u=(c=t.split("|",1)[0])==null?void 0:c.trim())!=null?u:"";if(!e)return null;let n=null,r=e,o=r.lastIndexOf("^");o>=0&&o+1<r.length&&(n=r.slice(o+1).trim()||null,r=r.slice(0,o));let s=r,a=null,l=r.indexOf("#");return l>=0?(s=r.slice(0,l).trim(),a=r.slice(l+1).trim()||null):s=r.trim(),s?{linkpath:s,heading:a,blockId:n}:null}function PE(i){return i.replace(/\s+/g," ").trim().toLowerCase()}function DN(i,t){let e=t.trim();if(!e)return null;if(/^[a-z][a-z0-9+.-]*:\/\//i.test(e))return e;let n=i.getSourcePath(),r=i.app.metadataCache.getFirstLinkpathDest(e,n);if(!r)return null;try{return i.app.vault.getResourcePath(r)}catch(o){return null}}var Ll=class{constructor(t){this.autoScrollRaf=null;this.autoScrollActive=!1;this.lastPointerEvent=null;this.lastAutoScrollOffset=null;this.autoScrollRemainder=0;this.lastAutoScrollAt=null;this.autoScrollFast=!1;this.context=t}handlePointerDown(t){var d,h,f,p,m,g,b;let e=this.context.getSotEditor(),n=this.context.getDerivedRootEl();if(!e||!n||t.button!==0)return;let r=t.target,o=r==null?void 0:r.closest(".tategaki-md-callout-widget-content .callout-title, .tategaki-md-callout-widget-content .callout-fold");if(o&&!t.metaKey&&!t.ctrlKey){let v=o.closest(".tategaki-md-callout-widget-content .callout");if(v!=null&&v.classList.contains("is-collapsible")){t.preventDefault(),t.stopPropagation(),v.classList.toggle("is-collapsed");return}}let s=r==null?void 0:r.closest(".tategaki-md-heading-toggle");if(s){let v=s.closest(".tategaki-sot-line"),y=Number.parseInt((d=v==null?void 0:v.dataset.line)!=null?d:"",10);if(v&&Number.isFinite(y)){t.preventDefault(),t.stopPropagation(),this.context.toggleHeadingFold(y);return}}let a=r==null?void 0:r.closest(".tategaki-md-embed-widget-content a");if(a&&(t.metaKey||t.ctrlKey)){let y=(((p=(f=(h=a.dataset)==null?void 0:h.href)!=null?f:a.getAttribute("data-href"))!=null?p:"")||a.getAttribute("href")||"").trim();if(y){t.preventDefault(),t.stopPropagation(),this.context.openHref(y);return}}let l=r==null?void 0:r.closest(".tategaki-sot-run[data-href]");if(l&&(t.metaKey||t.ctrlKey)){let v=(m=l.dataset.href)!=null?m:"";if(v){t.preventDefault(),t.stopPropagation(),this.context.openHref(v);return}}let c=r==null?void 0:r.closest(".tategaki-md-task-box");if(c){t.preventDefault(),t.stopPropagation();let v=c.closest(".tategaki-sot-line");v&&(this.context.toggleTaskForLineElement(v),this.context.focusInputSurface(!0));return}if(this.context.isCeImeMode()){if(this.handleCeClickToLineEnd(t)){t.preventDefault(),t.stopPropagation(),this.context.focusInputSurface(!0);return}return}if((b=(g=this.context).isNativeSelectionEnabled)!=null&&b.call(g))return;t.preventDefault(),n.focus({preventScroll:!0});let u=this.getOffsetFromPointerEvent(t);if(u!==null){this.lastAutoScrollOffset=u,this.autoScrollRemainder=0;let v=e.getSelection(),y=t.shiftKey?v.anchor:u;this.context.setPointerState({isPointerSelecting:!0,pointerSelectAnchor:this.context.normalizeOffsetToVisible(y,u>=y),pointerSelectPointerId:t.pointerId});try{n.setPointerCapture(t.pointerId)}catch(E){}this.context.setSelectionNormalized(y,u),this.context.scheduleCaretUpdate(!0)}this.context.focusInputSurface(!0)}handlePointerMove(t){var o,s;if(this.context.isCeImeMode()||(s=(o=this.context).isNativeSelectionEnabled)!=null&&s.call(o)&&!this.autoScrollActive||!this.context.getSotEditor())return;let n=this.context.getPointerState();if(!n.isPointerSelecting||n.pointerSelectPointerId!==null&&t.pointerId!==n.pointerSelectPointerId)return;this.lastPointerEvent=t;let r=this.getOffsetFromPointerEvent(t);r===null||n.pointerSelectAnchor===null||(this.lastAutoScrollOffset=r,this.autoScrollRemainder=0,this.context.setSelectionNormalized(n.pointerSelectAnchor,r),this.context.updateSelectionOverlay(),this.updateAutoScroll())}handlePointerUp(t){var o,s;if(this.context.isCeImeMode()||(s=(o=this.context).isNativeSelectionEnabled)!=null&&s.call(o)&&!this.autoScrollActive)return;let e=this.context.getPointerState();if(!e.isPointerSelecting||e.pointerSelectPointerId!==null&&t.pointerId!==e.pointerSelectPointerId)return;let n=this.getOffsetFromPointerEvent(t);n!==null&&e.pointerSelectAnchor!==null&&(this.lastAutoScrollOffset=n,this.autoScrollRemainder=0,this.context.setSelectionNormalized(e.pointerSelectAnchor,n),this.context.updateSelectionOverlay());let r=this.context.getDerivedRootEl();if(r&&e.pointerSelectPointerId!==null)try{r.releasePointerCapture(e.pointerSelectPointerId)}catch(a){}this.context.setPointerState({isPointerSelecting:!1,pointerSelectAnchor:null,pointerSelectPointerId:null}),this.lastAutoScrollOffset=null,this.autoScrollRemainder=0,this.stopAutoScroll()}updateAutoScroll(){if(this.context.isCeImeMode()){this.stopAutoScroll();return}let t=this.context.getDerivedRootEl(),e=this.context.getPointerState();if(!t||!this.lastPointerEvent||!e.isPointerSelecting){this.stopAutoScroll();return}let{delta:n,axis:r}=this.computeAutoScrollDelta(t,this.lastPointerEvent);if(n===0){this.setAutoScrollFast(!1),this.stopAutoScroll();return}this.updateAutoScrollFast(t,r,this.lastPointerEvent),!this.autoScrollActive&&(this.autoScrollActive=!0,this.lastAutoScrollAt=performance.now(),this.context.setAutoScrollSelecting(!0),this.autoScrollRaf=window.requestAnimationFrame(()=>{this.runAutoScroll()}))}runAutoScroll(){var h;if(!this.autoScrollActive)return;if(this.context.isCeImeMode()){this.stopAutoScroll();return}let t=this.context.getDerivedRootEl(),e=this.context.getPointerState(),n=this.lastPointerEvent;if(!t||!n||!e.isPointerSelecting){this.stopAutoScroll();return}let{delta:r,axis:o}=this.computeAutoScrollDelta(t,n);if(r===0){this.setAutoScrollFast(!1),this.stopAutoScroll();return}this.updateAutoScrollFast(t,o,n);let s=performance.now(),a=(h=this.lastAutoScrollAt)!=null?h:s;this.lastAutoScrollAt=s;let l=Math.max(4,Math.min(s-a,100)),c=Math.max(.5,Math.min(3,l/16.67)),u=r*c;o==="x"?t.scrollLeft+=u:t.scrollTop+=u;let d=this.getOffsetFromPointerEvent(n);if(e.pointerSelectAnchor!==null){let f=d!==null?d:this.getAutoScrollFallbackOffset(t,u,o);f!==null&&(d!==null&&(this.lastAutoScrollOffset=d,this.autoScrollRemainder=0),this.context.setSelectionNormalized(e.pointerSelectAnchor,f),this.context.updateSelectionOverlay())}this.autoScrollRaf=window.requestAnimationFrame(()=>{this.runAutoScroll()})}stopAutoScroll(){this.autoScrollRaf!==null&&(window.cancelAnimationFrame(this.autoScrollRaf),this.autoScrollRaf=null),this.autoScrollActive=!1,this.lastAutoScrollAt=null,this.setAutoScrollFast(!1),this.context.setAutoScrollSelecting(!1)}computeAutoScrollDelta(t,e){let n=t.getBoundingClientRect(),o=window.getComputedStyle(t).writingMode.startsWith("vertical"),s=28;if(o){let c=e.clientX-n.left,u=n.right-e.clientX;return c<s?{delta:-this.computeAutoScrollSpeed(c,s),axis:"x"}:u<s?{delta:this.computeAutoScrollSpeed(u,s),axis:"x"}:{delta:0,axis:"x"}}let a=e.clientY-n.top,l=n.bottom-e.clientY;return a<s?{delta:-this.computeAutoScrollSpeed(a,s),axis:"y"}:l<s?{delta:this.computeAutoScrollSpeed(l,s),axis:"y"}:{delta:0,axis:"y"}}computeAutoScrollSpeed(t,e){let n=Math.max(0,Math.min(t,e)),r=(e-n)/e,o=4;return o+(40-o)*r}updateAutoScrollFast(t,e,n){let r=this.getAutoScrollSpeedFactor(t,e,n),o=this.context.getLineRanges().length,s=this.getAutoScrollFastThreshold(o);this.setAutoScrollFast(r>=s)}setAutoScrollFast(t){var e,n;this.autoScrollFast!==t&&(this.autoScrollFast=t,(n=(e=this.context).setAutoScrollFast)==null||n.call(e,t))}getAutoScrollSpeedFactor(t,e,n){let r=t.getBoundingClientRect(),o=28;if(e==="x"){let u=n.clientX-r.left,d=r.right-n.clientX,h=Math.min(u,d),f=Math.max(0,Math.min(h,o));return(o-f)/o}let s=n.clientY-r.top,a=r.bottom-n.clientY,l=Math.min(s,a),c=Math.max(0,Math.min(l,o));return(o-c)/o}getAutoScrollFastThreshold(t){return t>=2e4?0:t>=8e3?.7:t>=4e3?.75:t>=2e3?.8:.85}getAutoScrollFallbackOffset(t,e,n){if(e===0)return null;let r=this.lastAutoScrollOffset;if(r===null)return null;let o=this.context.getLineRanges();if(o.length===0)return r;let s=this.findLineIndexFromRanges(r,o);if(s===null)return r;let a=this.getLineExtent(t),l=e>0?1:-1;this.autoScrollRemainder+=e;let c=Math.floor(Math.abs(this.autoScrollRemainder)/Math.max(1,a));if(c<=0)return r;this.autoScrollRemainder-=l*c*a;let u=this.isForwardScroll(l,n,t),d=Math.max(0,Math.min(o.length-1,s+(u?c:-c))),h=o[d];if(!h)return r;let f=u?h.to:h.from;return this.lastAutoScrollOffset=f,f}getLineExtent(t){let e=window.getComputedStyle(t),n=Number.parseFloat(e.fontSize)||16,r=Number.parseFloat(e.lineHeight)||Math.max(1,n*1.6);return Math.max(n,r)}isForwardScroll(t,e,n){return e==="y"?t>0:window.getComputedStyle(n).writingMode!=="vertical-lr"?t<0:t>0}findLineIndexFromRanges(t,e){let n=0,r=e.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),s=e[o];if(!s)break;if(t<s.from)r=o-1;else if(t>s.to)n=o+1;else return o}return null}handleCeClickToLineEnd(t){var p,m;let e=this.context.getSotEditor(),n=this.context.getDerivedRootEl();if(!this.context.isCeImeMode()||!e||!n)return!1;let r=this.findLineElementFromPoint(t.clientX,t.clientY);if(r||(r=this.findNearestLineElementFromPoint(t.clientX,t.clientY)),!r)return!1;this.context.ensureLineRendered(r);let o=Number.parseInt((p=r.dataset.from)!=null?p:"0",10),s=Number.parseInt((m=r.dataset.to)!=null?m:"0",10);if(Math.max(0,s-o)===0)return this.context.setSelectionNormalized(s,s),this.context.syncSelectionToCe(),!0;let l=this.context.getLineVisualRects(r);if(l.length===0)return!1;let c=window.getComputedStyle(n).writingMode,u=c.startsWith("vertical"),d=2,h=l[0];if(u){let g=c!=="vertical-lr";for(let v of l)g?v.left<h.left-.5&&(h=v):v.left>h.left+.5&&(h=v);return t.clientX>=h.left-d&&t.clientX<=h.right+d&&t.clientY>h.bottom+d?(this.context.setSelectionNormalized(s,s),this.context.syncSelectionToCe(),!0):!1}for(let g of l)(g.top>h.top+.5||Math.abs(g.top-h.top)<.5&&g.right>h.right)&&(h=g);return t.clientY>=h.top-d&&t.clientY<=h.bottom+d&&t.clientX>h.right+d?(this.context.setSelectionNormalized(s,s),this.context.syncSelectionToCe(),!0):!1}getOffsetFromPointerEvent(t){var h,f,p,m,g,b;let e=this.context.getDerivedRootEl();if(!e)return null;let n=t.target,r=n==null?void 0:n.closest(".tategaki-md-inline-widget"),o=n==null?void 0:n.closest(".tategaki-sot-line");if(o||(o=this.findLineElementFromPoint(t.clientX,t.clientY)),!o)return null;this.context.ensureLineRendered(o);let s=Number.parseInt((h=o.dataset.from)!=null?h:"0",10),a=Number.parseInt((f=o.dataset.to)!=null?f:"0",10);if(r&&o.contains(r)){let v=Number.parseInt((p=r.dataset.from)!=null?p:"",10),y=Number.parseInt((m=r.dataset.to)!=null?m:"",10),E=s+(Number.isFinite(v)?v:0),x=s+(Number.isFinite(y)?y:0),S=Math.max(s,Math.min(E,a)),w=Math.max(s,Math.min(x,a)),k=r.getBoundingClientRect();if(window.getComputedStyle(e).writingMode.startsWith("vertical")){let _=k.top+k.height/2;return this.context.normalizeOffsetToVisible(t.clientY>_?w:S,!0)}let L=k.left+k.width/2;return this.context.normalizeOffsetToVisible(t.clientX>L?w:S,!0)}let l=(g=o.dataset.mdKind)!=null?g:"";if(l==="image-widget"||l==="embed-widget"||l==="math-widget"||l==="math-hidden"||l==="callout-widget"||l==="callout-hidden"||l==="table-widget"||l==="table-hidden"||l==="deflist-widget"||l==="deflist-hidden"||l==="heading-hidden")return this.context.normalizeOffsetToVisible(s,!0);let c=Math.max(0,a-s),u=(b=this.context.getLocalOffsetFromPoint(o,t.clientX,t.clientY,c))!=null?b:0,d=Math.max(0,Math.min(u,c));return this.context.normalizeOffsetToVisible(s+d,!0)}findLineElementFromPoint(t,e){var r;let n=document.elementFromPoint(t,e);return(r=n==null?void 0:n.closest(".tategaki-sot-line"))!=null?r:null}findNearestLineElementFromPoint(t,e){let n=this.context.getDerivedContentEl();if(!n)return null;let r=n.getBoundingClientRect(),o=24;if(t<r.left-o||t>r.right+o||e<r.top-o||e>r.bottom+o)return null;let s=this.context.getDerivedRootEl(),a=window.getComputedStyle(s!=null?s:n),c=a.writingMode.startsWith("vertical"),u=Number.parseFloat(a.fontSize)||18,d=Number.parseFloat(a.lineHeight)||Math.max(1,u*1.6),h=Array.from(n.children),f=null,p=Number.POSITIVE_INFINITY;for(let m of h){if(!m.classList.contains("tategaki-sot-line"))continue;let g=this.context.getLineVisualRects(m),b=g.length>0?Br(g,m.getBoundingClientRect()):m.getBoundingClientRect();if(!Number.isFinite(b.left))continue;let v=b.left,y=b.top,E=Math.max(b.width,u),x=Math.max(b.height,d);c&&(E=Math.max(E,u),x=Math.max(x,d)),E>b.width&&(v-=(E-b.width)/2),x>b.height&&(y-=(x-b.height)/2);let S=v+E,w=y+x,k=t<v?v-t:t>S?t-S:0,M=e<y?y-e:e>w?e-w:0,L=k*k+M*M;L<p&&(p=L,f=m)}return f}};function zE(i,t,e,n,r,o){let s=t.to-t.from,a=Math.max(0,Math.min(e,s)),l=Math.max(0,Math.min(n,s));if(a===l)return[];let c=o.getLineTextNodes(i);if(c.length===0){let b=i.getBoundingClientRect();return b?[b]:[]}let u=c[c.length-1],d=document.createRange(),h=a>=s?{node:u,offset:u.length}:o.findTextNodeAtOffset(i,a),f=l>=s?{node:u,offset:u.length}:o.findTextNodeAtOffset(i,l);if(!h||!f)return[];let p=(b,v)=>Math.max(0,Math.min(v,b.length)),m=p(h.node,h.offset),g=p(f.node,f.offset);try{d.setStart(h.node,m),d.setEnd(f.node,g);let b=Array.from(d.getClientRects());return BN(b,r)}catch(b){let v=i.getBoundingClientRect();return v?[v]:[]}}function BN(i,t){let e=i.filter(o=>o.width>0||o.height>0);if(e.length<=1)return e;let n=t.startsWith("vertical"),r=[];for(let o of e)o.width<=0&&o.height<=0||r.some(a=>Math.abs(a.left-o.left)<.5&&Math.abs(a.right-o.right)<.5&&Math.abs(a.top-o.top)<.5&&Math.abs(a.bottom-o.bottom)<.5)||r.push(o);return r}var Rl=class{constructor(t){this.autoScrollOverlay=null;this.context=t}updateSelectionOverlay(t={}){let e=this.context.getSotEditor();if(!e)return;let n=e.getSelection(),r=Math.min(n.anchor,n.head),o=Math.max(n.anchor,n.head);this.updateSelectionOverlayForRange(r,o,{forceVisibleRange:!1,allowNativeSelection:t.allowNativeSelection,preferApproxVisibleRange:t.preferApproxVisibleRange})}updateSelectionOverlayForRange(t,e,n={}){var l,c;let r=this.context.getDerivedRootEl(),o=this.context.getDerivedContentEl(),s=this.context.getSelectionLayerEl();if(!r||!o||!s)return;if(this.context.isCeImeMode()){s.replaceChildren(),this.autoScrollOverlay=null;return}if((c=(l=this.context).isNativeSelectionEnabled)!=null&&c.call(l)&&!n.allowNativeSelection){s.replaceChildren(),this.autoScrollOverlay=null;return}let a=this.context.getPendingSelectionState();if(a.pendingText.length>0&&a.pendingSelectionFrom!==null){s.replaceChildren(),this.autoScrollOverlay=null;return}if(t===e){s.replaceChildren(),this.autoScrollOverlay=null;return}this.renderOverlayForRange(t,e,r,o,s,n.forceVisibleRange===!0,n.preferApproxVisibleRange===!0)}renderOverlayForRange(t,e,n,r,o,s,a){var w,k;let l=n.getBoundingClientRect();if(this.context.isAutoScrollSelecting()){let M=r.getBoundingClientRect(),L=Math.max(l.left,M.left),_=Math.min(l.right,M.right),P=Math.max(l.top,M.top),I=Math.min(l.bottom,M.bottom),N=Math.max(0,_-L),D=Math.max(0,I-P);if(N>0&&D>0){let R=new DOMRect(L,P,N,D);this.autoScrollOverlay?this.updateSelectionRect(this.autoScrollOverlay,R,l,n):this.autoScrollOverlay=this.createSelectionRect(R,l,n),this.autoScrollOverlay.parentElement!==o&&o.replaceChildren(this.autoScrollOverlay)}else o.replaceChildren(),this.autoScrollOverlay=null;return}this.autoScrollOverlay=null;let c=this.context.findLineIndex(t),u=this.context.findLineIndex(e);if(c===null||u===null){o.replaceChildren();return}let d=this.context.isPointerSelecting(),h=Math.abs(u-c),p=d&&h>=200,g=(s||p?!1:d)?null:a?this.findApproxVisibleLineRange(n):(w=this.findVisibleLineRange(n))!=null?w:this.findApproxVisibleLineRange(n),b=g!==null?Math.max(c,g.start):c,v=g!==null?Math.min(u,g.end):u;if(b>v){o.replaceChildren();return}let y=window.getComputedStyle(n).writingMode,E=document.createDocumentFragment(),x=this.context.getLineRanges(),S={getLineTextNodes:M=>this.context.getLineTextNodes(M),findTextNodeAtOffset:(M,L)=>this.context.findTextNodeAtOffset(M,L)};for(let M=b;M<=v;M+=1){let L=x[M],_=this.context.getLineElement(M);if(!L||!_||!_.isConnected)continue;this.context.ensureLineRendered(_);let P=L.to-L.from,I=0,N=P;if(M===b&&(I=Math.max(0,Math.min(t-L.from,P))),M===v&&(N=Math.max(0,Math.min(e-L.from,P))),P===0){if(t<=L.from&&e>=L.to){let R=_.querySelector(".tategaki-sot-eol"),A=(k=R==null?void 0:R.getBoundingClientRect())!=null?k:_.getBoundingClientRect(),C=this.createSelectionRect(A,l,n);E.appendChild(C)}continue}if(I===N)continue;let D=zE(_,L,I,N,y,S);for(let R of D){let A=this.createSelectionRect(R,l,n);E.appendChild(A)}}o.replaceChildren(E)}findVisibleLineRange(t){var p;let e=this.context.getDerivedContentEl(),n=t.getBoundingClientRect(),r=(p=e==null?void 0:e.getBoundingClientRect())!=null?p:n,o=Math.max(n.left,r.left),s=Math.min(n.right,r.right),a=Math.max(n.top,r.top),l=Math.min(n.bottom,r.bottom);if(s-o<1||l-a<1)return null;let c=new DOMRect(o,a,s-o,l-a),u=[{x:c.left+4,y:c.top+4},{x:c.left+4,y:c.bottom-4},{x:c.right-4,y:c.top+4},{x:c.right-4,y:c.bottom-4},{x:c.left+c.width/2,y:c.top+4},{x:c.left+c.width/2,y:c.bottom-4}],d=(m,g)=>{var x,S,w,k,M,L;let b=typeof document.elementsFromPoint=="function"?document.elementsFromPoint(m,g):[];for(let _ of b){let P=_.closest(".tategaki-sot-line");if(P){let N=Number.parseInt((x=P.dataset.line)!=null?x:"",10);return Number.isFinite(N)?N:null}let I=_.closest(".tategaki-frontmatter");if(I){let N=I.nextElementSibling,D=N!=null&&N.classList.contains("tategaki-sot-line")?N:(S=I.parentElement)==null?void 0:S.querySelector(".tategaki-sot-line");if(D){let R=Number.parseInt((w=D.dataset.line)!=null?w:"",10);return Number.isFinite(R)?R:null}}}let v=document.elementFromPoint(m,g),y=v==null?void 0:v.closest(".tategaki-sot-line");if(y){let _=Number.parseInt((k=y.dataset.line)!=null?k:"",10);return Number.isFinite(_)?_:null}let E=v==null?void 0:v.closest(".tategaki-frontmatter");if(E){let _=E.nextElementSibling,P=_!=null&&_.classList.contains("tategaki-sot-line")?_:(M=E.parentElement)==null?void 0:M.querySelector(".tategaki-sot-line");if(P){let I=Number.parseInt((L=P.dataset.line)!=null?L:"",10);return Number.isFinite(I)?I:null}}return null},h=null,f=null;for(let m of u){let g=d(m.x,m.y);g!==null&&((h===null||g<h)&&(h=g),(f===null||g>f)&&(f=g))}return h===null||f===null?null:{start:h,end:f}}findApproxVisibleLineRange(t){let e=this.context.getLineRanges();if(e.length===0)return null;let n=window.getComputedStyle(t),r=Number.parseFloat(n.fontSize)||16,o=Number.parseFloat(n.lineHeight)||r*1.8,s=Math.max(o,r),a=n.writingMode!=="horizontal-tb",l=a?t.clientWidth:t.clientHeight,c=a?t.scrollLeft:t.scrollTop;a&&c<0&&(c=-c);let u=Math.floor(Math.max(0,c)/s),d=Math.ceil(l/s),h=Math.max(0,Math.min(e.length-1,u)),f=Math.max(h,Math.min(e.length-1,u+d));return{start:h,end:f}}createSelectionRect(t,e,n){let r=document.createElement("div");r.className="tategaki-sot-selection-rect";let o=t.left-e.left+n.scrollLeft,s=t.top-e.top+n.scrollTop,a=Math.max(1,t.width),l=Math.max(1,t.height);return r.style.left=`${o}px`,r.style.top=`${s}px`,r.style.width=`${a}px`,r.style.height=`${l}px`,r}updateSelectionRect(t,e,n,r){let o=e.left-n.left+r.scrollLeft,s=e.top-n.top+r.scrollTop,a=Math.max(1,e.width),l=Math.max(1,e.height);t.style.left=`${o}px`,t.style.top=`${s}px`,t.style.width=`${a}px`,t.style.height=`${l}px`}};function VE(i){var l,c;if(!i.isNativeSelectionEnabled||!i.overlayFocused||i.ceImeMode||i.sourceModeEnabled||!i.derivedRootEl||!i.derivedContentEl||!i.selectionLayerEl||!i.sotEditor)return!1;let t=(l=i.derivedContentEl.ownerDocument.getSelection())!=null?l:null;if(!!t&&i.isSelectionInsideDerivedContent(t)&&!t.isCollapsed)return!1;let n=i.sotEditor.getSelection(),r=Math.min(n.anchor,n.head),o=Math.max(n.anchor,n.head);if(r===o)return i.selectionLayerEl.replaceChildren(),!0;let s=i.sotEditor.getDoc().length,a=s>=2e5||i.totalLines>=2e3;if(r===0&&o===s&&a){i.selectionLayerEl.replaceChildren();let u=i.derivedRootEl.getBoundingClientRect(),d=i.derivedContentEl.getBoundingClientRect(),h=Math.max(u.left,d.left),f=Math.min(u.right,d.right),p=Math.max(u.top,d.top),m=Math.min(u.bottom,d.bottom),g=Math.max(0,f-h),b=Math.max(0,m-p);if(g>0&&b>0){let v=document.createElement("div");v.className="tategaki-sot-selection-rect";let y=h-u.left+i.derivedRootEl.scrollLeft,E=p-u.top+i.derivedRootEl.scrollTop;v.style.left=`${y}px`,v.style.top=`${E}px`,v.style.width=`${g}px`,v.style.height=`${b}px`,i.selectionLayerEl.appendChild(v)}return!0}return(c=i.selectionOverlay)==null||c.updateSelectionOverlayForRange(r,o,{allowNativeSelection:!0}),!0}var Al=class{constructor(){this.active=!1}handlePointerDown(t){if((t.button===0||t.button===1)&&this.clear(),t.button!==2||!t.isNativeSelectionEnabled||t.isCeImeMode||t.isSourceMode||t.isOnScrollbar)return!1;let e=!!t.domSelection&&t.isSelectionInsideDerivedContent(t.domSelection)&&!t.domSelection.isCollapsed,n=!!t.sotSelection&&t.sotSelection.anchor!==t.sotSelection.head;return!e&&!n?!1:(this.active=!0,!0)}shouldSkipNativeCollapse(t){return this.active?!t||t.anchor===t.head?(this.clear(),!1):!0:!1}shouldFocusRootOnContextMenu(){return!this.active}isActiveWithSelection(t){return this.active&&!!t&&t.anchor!==t.head}isActive(){return this.active}clear(){return this.active?(this.active=!1,!0):!1}};var Il=class{constructor(t){this.context=t}syncSelectionFromCe(){var a;if(!this.context.isCeImeMode())return null;let t=this.context.getSotEditor();if(!t)return null;let e=(a=this.context.getDerivedContentEl())==null?void 0:a.ownerDocument.getSelection();if(!e||!this.context.isSelectionInsideDerivedContent(e))return null;let n=this.context.getLineElementForNode(e.anchorNode),r=this.context.getLineElementForNode(e.focusNode);if(!n||!r)return null;let o=this.getSelectionOffsetsFromCe(e);if(!o)return this.context.recordCeMappingFailure("selection"),null;let s=t.getSelection();return(s.anchor!==o.anchor||s.head!==o.head)&&(this.context.setCeImeSelectionSyncing(!0),this.context.setSelectionNormalized(o.anchor,o.head),this.context.setCeImeSelectionSyncing(!1)),o}syncSelectionToCe(){if(!this.context.isCeImeMode())return;let t=this.context.getSotEditor(),e=this.context.getDerivedContentEl();if(!t||!e||!this.context.isLeafActive()||this.context.isCeImeComposing())return;let n=e.ownerDocument.getSelection();if(!n)return;let{anchor:r,head:o}=t.getSelection(),s=this.getDomPositionForOffset(r),a=this.getDomPositionForOffset(o);if(!s||!a){this.context.recordCeMappingFailure("selection");return}this.context.setCeImeSelectionSyncing(!0);let l=n;if(typeof l.setBaseAndExtent=="function")l.setBaseAndExtent(s.node,s.offset,a.node,a.offset);else{let c=e.ownerDocument.createRange();c.setStart(s.node,s.offset),c.setEnd(a.node,a.offset),n.removeAllRanges(),n.addRange(c)}this.context.setCeImeSelectionSyncing(!1)}handleCeSelectionChange(){var e;if(!this.context.isCeImeMode()||this.context.isCeImeSelectionSyncing()||this.context.isCeImeComposing())return;this.syncSelectionFromCe();let t=(e=this.context.getDerivedContentEl())==null?void 0:e.ownerDocument.getSelection();t&&this.context.isSelectionInsideDerivedContent(t)&&(this.context.isUnsafeCeSelectionNode(t.anchorNode)||this.context.isUnsafeCeSelectionNode(t.focusNode))&&this.syncSelectionToCe(),this.context.scheduleCeSafetyCheck()}getSelectionOffsetsFromCe(t){let e=this.getOffsetFromSelectionNode(t.anchorNode,t.anchorOffset),n=this.getOffsetFromSelectionNode(t.focusNode,t.focusOffset);return e===null||n===null?null:{anchor:e,head:n}}getOffsetFromSelectionNode(t,e){var h,f,p,m,g,b,v;let n=this.context.getSotEditor(),r=this.context.getDerivedContentEl();if(!t||!n||!r)return null;if(t===r){let y=Array.from(r.children),E=y.length,x=(k,M)=>{for(let L=k;L>=0&&L<E;L+=M){let _=y[L];if(_!=null&&_.classList.contains("tategaki-sot-line"))return _}return null};if(E===0)return 0;if(e<=0){let k=x(0,1),M=Number.parseInt((h=k==null?void 0:k.dataset.from)!=null?h:"",10);return Number.isFinite(M)?M:0}if(e>=E){let k=x(E-1,-1),M=Number.parseInt((f=k==null?void 0:k.dataset.to)!=null?f:"",10);return Number.isFinite(M)?M:n.getDoc().length}let S=x(e,1);if(S){let k=Number.parseInt((p=S.dataset.from)!=null?p:"",10);if(Number.isFinite(k))return k}let w=x(e-1,-1);if(w){let k=Number.parseInt((m=w.dataset.to)!=null?m:"",10);if(Number.isFinite(k))return k}return null}let o=t instanceof Element?t:(g=t.parentElement)!=null?g:null;if(!o)return null;let s=o.closest(".tategaki-sot-line");if(!s)return null;let a=Number.parseInt((b=s.dataset.from)!=null?b:"0",10),l=Number.parseInt((v=s.dataset.to)!=null?v:"0",10),c=Math.max(0,l-a),u=this.context.resolveOffsetFromCaretPosition(s,{node:t,offset:e},c);if(u===null)return a;let d=n.getDoc().length;return Math.max(0,Math.min(a+u,d))}getDomPositionForOffset(t){let e=this.context.getSotEditor();if(!e)return null;let n=e.getDoc().length,r=Math.max(0,Math.min(t,n)),o=this.context.findLineIndex(r);if(o===null)return null;let a=this.context.getLineRanges()[o],l=this.context.getLineElement(o);if(!a||!l)return null;this.context.ensureLineRendered(l);let c=Math.max(0,a.to-a.from),u=Math.max(0,Math.min(r-a.from,c));if(this.context.isCeImeMode()&&c===0){let p=this.context.ensureCeInputPlaceholderNode(l);if(p)return{node:p,offset:0};let m=l.querySelector(".tategaki-sot-eol"),g=m!=null&&m.firstChild&&m.firstChild.nodeType===Node.TEXT_NODE?m.firstChild:null;if(g)return{node:g,offset:0};let b=l.childNodes.length,v=Math.max(0,b-1);return{node:l,offset:v}}let d=this.context.findTextNodeAtOffset(l,u);if(d)return{node:d.node,offset:d.offset};let h=l.querySelector(".tategaki-sot-eol"),f=h!=null&&h.firstChild&&h.firstChild.nodeType===Node.TEXT_NODE?h.firstChild:null;return f?{node:f,offset:f.length}:{node:l,offset:0}}};var Nl=class{constructor(t){this.selectionActive=!1;this.restoringSelection=!1;this.syncingFromDom=!1;this.syncingToDom=!1;this.lastStableOffsets=null;this.context=t}isSelectionActive(){return this.context.isEnabled()&&this.selectionActive}handleSelectionChange(){var c,u,d,h,f,p,m,g;if(!this.context.isEnabled()){this.selectionActive&&(this.selectionActive=!1,(u=(c=this.context).onSelectionActiveChanged)==null||u.call(c,!1));return}if(this.restoringSelection||this.syncingToDom)return;let t=this.context.getDerivedContentEl(),e=this.context.getSotEditor();if(!t||!e){this.selectionActive&&(this.selectionActive=!1,(h=(d=this.context).onSelectionActiveChanged)==null||h.call(d,!1));return}let n=t.ownerDocument.getSelection(),r=!!n&&this.context.isSelectionInsideDerivedContent(n),o=!!n&&!n.isCollapsed&&r;if(o!==this.selectionActive&&(this.selectionActive=o,(p=(f=this.context).onSelectionActiveChanged)==null||p.call(f,o),o||(this.lastStableOffsets=null)),!n||!r||(o&&this.ensureSelectionEndpointsRendered(n),(g=(m=this.context).isCeImeMode)!=null&&g.call(m)))return;let s=this.getSelectionOffsetsFromDom(!0);if(!s)return;let a=this.isUnstableDomSelection(n,t);if(a&&this.lastStableOffsets)return;a||(this.lastStableOffsets=s);let l=e.getSelection();if(!(l.anchor===s.anchor&&l.head===s.head)&&this.context.setSelectionNormalized){this.syncingFromDom=!0;try{this.context.setSelectionNormalized(s.anchor,s.head)}finally{this.syncingFromDom=!1}}}tryHandleCopyCut(t,e){if(!this.context.isEnabled())return!1;let n=this.context.getDerivedContentEl(),r=this.context.getSotEditor();if(!n||!r)return!1;let o=n.ownerDocument.getSelection();o&&this.context.isSelectionInsideDerivedContent(o)&&!o.isCollapsed&&this.ensureSelectionEndpointsRendered(o);let s=this.getSelectionOffsetsFromDom();if(!s)return!1;let a=Math.min(s.anchor,s.head),l=Math.max(s.anchor,s.head);if(a===l)return!1;let c=r.getDoc().slice(a,l);return t.clipboardData&&(t.clipboardData.setData("text/plain",c),t.clipboardData.setData("text/markdown",c)),t.preventDefault(),t.stopPropagation(),e&&(this.context.applyCutRange?this.context.applyCutRange(a,l):r.replaceRange(a,l,"")),!0}getSelectionOffsetsFromDom(t=!1){let e=this.context.getDerivedContentEl(),n=this.context.getSotEditor();if(!e||!n)return null;let r=e.ownerDocument.getSelection();if(!r||!t&&r.isCollapsed||!this.context.isSelectionInsideDerivedContent(r))return null;let o=n.getDoc().length,s=this.getOffsetFromSelectionNode(r.anchorNode,r.anchorOffset,o),a=this.getOffsetFromSelectionNode(r.focusNode,r.focusOffset,o);return s===null||a===null?null:{anchor:s,head:a}}isUnstableDomSelection(t,e){return!(t.anchorNode!==e&&t.focusNode!==e||this.isFullContentSelection(t,e))}isFullContentSelection(t,e){if(t.anchorNode!==e||t.focusNode!==e)return!1;let n=e.childNodes.length,r=t.anchorOffset,o=t.focusOffset;return r===0&&o===n||o===0&&r===n}getOffsetFromSelectionNode(t,e,n){var u,d;let r=this.context.getDerivedContentEl();if(!t||!r)return null;if(t===r)return e<=0?0:n;let o=this.context.getLineElementForNode(t);if(!o)return null;let s=Number.parseInt((u=o.dataset.from)!=null?u:"0",10),a=Number.parseInt((d=o.dataset.to)!=null?d:"0",10),l=Math.max(0,a-s),c=this.context.resolveOffsetFromCaretPosition(o,{node:t,offset:e},l);return c===null?s:Math.max(0,Math.min(s+c,n))}syncDomSelectionFromSot(t,e){var a,l,c,u,d;if(!this.context.isEnabled()||(l=(a=this.context).isCeImeMode)!=null&&l.call(a)||((u=(c=this.context).shouldAllowDomSelection)==null?void 0:u.call(c))===!1||this.syncingFromDom)return;let n=this.context.getDerivedContentEl(),r=(d=n==null?void 0:n.ownerDocument.getSelection())!=null?d:null;if(!n||!r)return;let o=this.getDomPositionForOffset(t),s=this.getDomPositionForOffset(e);if(!(!o||!s)){this.syncingToDom=!0;try{let h=r;if(typeof h.setBaseAndExtent=="function")h.setBaseAndExtent(o.node,o.offset,s.node,s.offset);else{let f=n.ownerDocument.createRange();f.setStart(o.node,o.offset),f.setEnd(s.node,s.offset),r.removeAllRanges(),r.addRange(f)}}catch(h){}finally{this.syncingToDom=!1}}}getDomPositionForOffset(t){var g,b;let e=this.context.getSotEditor(),n=this.context.getDerivedContentEl(),r=this.context.findLineIndex;if(!e||!n||!r)return null;let o=e.getDoc().length,s=Math.max(0,Math.min(t,o)),a=r(s);if(a===null)return null;let c=this.context.getLineRanges()[a],u=this.context.getLineElement(a);if(!c||!u)return null;this.context.ensureLineRendered(u);let d=Math.max(0,c.to-c.from),h=Math.max(0,Math.min(s-c.from,d)),f=(b=(g=this.context).findTextNodeAtOffset)==null?void 0:b.call(g,u,h);if(f)return{node:f.node,offset:f.offset};let p=u.querySelector(".tategaki-sot-eol"),m=p!=null&&p.firstChild&&p.firstChild.nodeType===Node.TEXT_NODE?p.firstChild:null;return m?{node:m,offset:m.length}:{node:u,offset:0}}ensureSelectionEndpointsRendered(t){let e=this.context.getDerivedContentEl();if(!e)return;let n=this.context.getLineElementForNode(t.anchorNode),r=this.context.getLineElementForNode(t.focusNode),o=!!n&&n.dataset.virtual==="1",s=!!r&&r.dataset.virtual==="1";if(!o&&!s)return;let a=e.ownerDocument,l=this.snapshotSelectionEndpoints(t);this.restoringSelection=!0;try{o&&n&&this.context.ensureLineRendered(n),s&&r&&r!==n&&this.context.ensureLineRendered(r),this.restoreSelectionFromSnapshot(a,t,l)}finally{this.restoringSelection=!1}}snapshotSelectionEndpoints(t){let e=this.getEndpointPoint(t.anchorNode,t.anchorOffset),n=this.getEndpointPoint(t.focusNode,t.focusOffset);return{anchor:{point:e},focus:{point:n}}}getEndpointPoint(t,e){let n=this.context.getDerivedContentEl();if(!n||!t||!n.contains(t))return null;try{let s=n.ownerDocument.createRange();s.setStart(t,e),s.setEnd(t,e);let a=s.getBoundingClientRect();if(a&&a.width+a.height>0)return{x:a.left+a.width/2,y:a.top+a.height/2}}catch(s){}let r=this.context.getLineElementForNode(t);if(!r)return null;let o=r.getBoundingClientRect();return{x:o.left+o.width/2,y:o.top+o.height/2}}restoreSelectionFromSnapshot(t,e,n){let r=n.anchor.point&&Dr(t,n.anchor.point.x,n.anchor.point.y),o=n.focus.point&&Dr(t,n.focus.point.x,n.focus.point.y);if(!r||!o)return;let s=e;if(typeof s.setBaseAndExtent=="function"){s.setBaseAndExtent(r.node,r.offset,o.node,o.offset);return}try{let a=t.createRange();a.setStart(r.node,r.offset),a.setEnd(o.node,o.offset),e.removeAllRanges(),e.addRange(a)}catch(a){}}};function $E(i,t,e={}){var a;if(!i)return{allowDomSelectAll:!1,elapsedMs:null,docLength:null,lineCount:t,reason:"no-editor"};let n=performance.now(),r=i.getDoc().length,o=performance.now()-n;if(e.virtualized)return{allowDomSelectAll:!1,elapsedMs:o,docLength:r,lineCount:t,reason:"virtualized"};if(typeof e.maxDocLength=="number"&&r>=e.maxDocLength)return{allowDomSelectAll:!1,elapsedMs:o,docLength:r,lineCount:t,reason:"doc-length"};if(typeof e.maxLineCount=="number"&&typeof t=="number"&&t>=e.maxLineCount)return{allowDomSelectAll:!1,elapsedMs:o,docLength:r,lineCount:t,reason:"line-count"};let s=(a=e.timeoutMs)!=null?a:50;return o>s?{allowDomSelectAll:!1,elapsedMs:o,docLength:r,lineCount:t,reason:"timeout"}:{allowDomSelectAll:!0,elapsedMs:o,docLength:r,lineCount:t,reason:"ok"}}var Pl=class{constructor(t){this.renderTimer=null;this.renderChunkRaf=null;this.renderGeneration=0;this.virtualObserver=null;this.virtualEnabled=!1;this.virtualInitialEnd=-1;this.virtualQueue=[];this.virtualQueued=new Set;this.virtualQueueRaf=null;this.virtualizeRaf=null;this.virtualizeIndex=0;this.lastVirtualizeAt=0;this.lastSelectionResyncAt=0;this.preciseScanTimer=null;this.preciseScanRaf=null;this.scrollingActive=!1;this.scrollHoldTimer=null;this.resumeAfterScrollRaf=null;this.selectionScrollRaf=null;this.context=t}isVirtualizedRenderEnabled(){return this.virtualEnabled}resumeVirtualUpdates(){this.virtualEnabled&&(this.isSelectionActive()||(this.virtualQueue.length>0&&this.scheduleVirtualQueue(),this.onScrollSettled()))}dispose(){this.cancelScheduledRender(),this.cancelChunkedRender(),this.cancelVirtualQueue(),this.cancelVirtualize(),this.cancelPreciseScan(),this.cancelScrollHold(),this.cancelSelectionScrollRender(),this.disconnectVirtualObserver()}cancelScheduledRender(){this.renderTimer!==null&&(window.clearTimeout(this.renderTimer),this.renderTimer=null)}cancelScrollHold(){this.scrollHoldTimer!==null&&(window.clearTimeout(this.scrollHoldTimer),this.scrollHoldTimer=null),this.resumeAfterScrollRaf!==null&&(window.cancelAnimationFrame(this.resumeAfterScrollRaf),this.resumeAfterScrollRaf=null),this.scrollingActive=!1}cancelSelectionScrollRender(){this.selectionScrollRaf!==null&&(window.cancelAnimationFrame(this.selectionScrollRaf),this.selectionScrollRaf=null)}cancelPreciseScan(){this.preciseScanTimer!==null&&(window.clearTimeout(this.preciseScanTimer),this.preciseScanTimer=null),this.preciseScanRaf!==null&&(window.cancelAnimationFrame(this.preciseScanRaf),this.preciseScanRaf=null)}isSelectionActive(){var t,e,n;return(n=(e=(t=this.context).isSelectionActive)==null?void 0:e.call(t))!=null?n:!1}notifyScrollActivity(t){if(!this.virtualEnabled)return;this.isSelectionActive()&&this.scheduleSelectionScrollRender(),this.cancelPreciseScan();let e=performance.now();e-this.lastVirtualizeAt>120&&(this.lastVirtualizeAt=e,this.scheduleVirtualizeDistantLines(!0)),t&&(this.scrollingActive=!0,this.scrollHoldTimer!==null&&window.clearTimeout(this.scrollHoldTimer),this.scrollHoldTimer=window.setTimeout(()=>{this.scrollHoldTimer=null,this.scrollingActive=!1,this.scheduleResumeAfterScroll()},140))}scheduleSelectionScrollRender(){this.selectionScrollRaf===null&&(this.selectionScrollRaf=window.requestAnimationFrame(()=>{this.selectionScrollRaf=null,this.renderVisibleVirtualLinesImmediate(!0,{maxLines:16,budgetMs:4})}))}scheduleRender(t=!1){let e=this.context.getDerivedRootEl(),n=this.context.getDerivedContentEl(),r=this.context.getSotEditor();if(!(!e||!n||!r)){if(this.renderTimer!==null){if(!t)return;window.clearTimeout(this.renderTimer),this.renderTimer=null}this.renderTimer=window.setTimeout(()=>{this.renderTimer=null,this.renderNow()},0)}}renderNow(){var m;let t=this.context.getDerivedRootEl(),e=this.context.getDerivedContentEl(),n=this.context.getSotEditor();if(!t||!e||!n)return;let r=this.renderGeneration+1;this.renderGeneration=r,this.cancelChunkedRender(),this.cancelVirtualQueue(),this.cancelVirtualize();let o=t.scrollTop,s=t.scrollLeft,a=n.getDoc(),l=a.split(`
`),c=this.context.parseFrontmatter(a);this.context.setFrontmatterDetected(!!c.frontmatter);let u=this.context.computeLineRangesFromLines(l);if(this.context.setLineRanges(u),this.context.recomputeLineBlockKinds(l),this.virtualEnabled=this.shouldUseVirtualizedRender(u.length,a.length),this.resetVirtualQueue(),this.setupVirtualObserver(t),this.virtualInitialEnd=this.virtualEnabled?this.getInitialFullRenderEnd(t,u.length):-1,this.shouldUseChunkedRender(u.length,a.length)){this.renderChunked(r,(m=c.frontmatter)!=null?m:null,o,s);return}let d=document.createDocumentFragment(),h=this.context.getPluginSettings(),f=this.context.getHideFrontmatter(),p=this.context.getWritingMode();if(c.frontmatter&&!f){let g=this.context.renderFrontmatter(c.frontmatter,h);g&&(this.context.applyFrontmatterWritingMode(g,p),d.appendChild(g))}for(let g=0;g<u.length;g+=1){let b=u[g];if(!b)continue;let v=document.createElement("div");v.className="tategaki-sot-line",v.dataset.from=String(b.from),v.dataset.to=String(b.to),v.dataset.line=String(g),this.renderLineWithVirtualization(v,b,g),d.appendChild(v)}e.replaceChildren(d),this.context.resetPendingRenderState(),this.context.finalizeRender(o,s)}shouldUseChunkedRender(t,e){return t>=800||e>=12e4}shouldUseVirtualizedRender(t,e){return t>=1200||e>=16e4}setupVirtualObserver(t){if(!this.virtualEnabled){this.disconnectVirtualObserver();return}this.disconnectVirtualObserver(),this.virtualObserver=new IntersectionObserver(e=>{var n,r,o,s;if(!this.isSelectionActive()&&!this.scrollingActive)for(let a of e){if(!a.isIntersecting)continue;let l=a.target;if(l.dataset.virtual!=="1"){(n=this.virtualObserver)==null||n.unobserve(l);continue}let c=Number.parseInt((r=l.dataset.line)!=null?r:"",10);if(!Number.isFinite(c)){(o=this.virtualObserver)==null||o.unobserve(l);continue}if(!this.context.getLineRanges()[c]){(s=this.virtualObserver)==null||s.unobserve(l);continue}this.enqueueVirtualLine(l)}},{root:t,rootMargin:"200px"})}disconnectVirtualObserver(){this.virtualObserver&&(this.virtualObserver.disconnect(),this.virtualObserver=null)}getInitialFullRenderEnd(t,e){let n=window.getComputedStyle(t),r=Number.parseFloat(n.fontSize)||16,o=Number.parseFloat(n.lineHeight)||r*1.8,a=n.writingMode!=="horizontal-tb"?t.clientWidth:t.clientHeight,l=Math.max(o,r),c=Math.ceil(a/l),u=80,d=Math.min(e-1,c+u);return Math.max(0,d)}renderLineWithVirtualization(t,e,n){if(!this.virtualEnabled||n<=this.virtualInitialEnd){this.context.renderLine(t,e,n);return}this.context.renderLineLight(t,e,n),this.virtualObserver&&this.virtualObserver.observe(t)}enqueueVirtualLine(t){var n;let e=Number.parseInt((n=t.dataset.line)!=null?n:"",10);Number.isFinite(e)&&(this.virtualQueued.has(e)||(this.virtualQueued.add(e),this.virtualQueue.push({index:e,element:t}),this.scheduleVirtualQueue()))}scheduleVirtualQueue(){this.isSelectionActive()||this.virtualQueueRaf===null&&(this.virtualQueueRaf=window.requestAnimationFrame(()=>{this.virtualQueueRaf=null,this.flushVirtualQueue()}))}scheduleVirtualizeDistantLines(t=!1){this.virtualEnabled&&(!t&&this.isSelectionActive()||this.virtualizeRaf===null&&(this.virtualizeRaf=window.requestAnimationFrame(()=>{this.virtualizeRaf=null,this.virtualizeDistantLines(t)})))}virtualizeDistantLines(t=!1){var b,v,y;if(!this.virtualEnabled||!t&&this.isSelectionActive())return;let e=this.context.getDerivedRootEl(),n=this.context.getDerivedContentEl();if(!e||!n)return;let r=this.context.getLineRanges(),o=r.length;if(o===0)return;let s=this.getApproxVisibleLineRange(e,o),a=o>=8e3?120:200,l=Math.max(0,s.start-a),c=Math.min(o-1,s.end+a),u=(y=(v=(b=this.context).getSelectionHintLines)==null?void 0:v.call(b))!=null?y:[],d=o>=8e3?4:8,h=E=>u.some(x=>Number.isFinite(x)&&Math.abs(E-x)<=d),f=this.getLineElementOffset(n),p=n.children,m=performance.now(),g=8;for(this.virtualizeIndex>=o&&(this.virtualizeIndex=0);this.virtualizeIndex<o&&performance.now()-m<g;this.virtualizeIndex+=1){if(this.virtualizeIndex>=l&&this.virtualizeIndex<=c||h(this.virtualizeIndex))continue;let E=p[this.virtualizeIndex+f];if(!E||!E.isConnected||E.dataset.virtual==="1")continue;let x=r[this.virtualizeIndex];x&&(this.context.renderLineLight(E,x,this.virtualizeIndex),this.virtualObserver&&this.virtualObserver.observe(E))}if(this.virtualizeIndex<o){this.scheduleVirtualizeDistantLines(t);return}this.virtualizeIndex=0}getLineElementOffset(t){let e=t.firstElementChild;return e!=null&&e.classList.contains("tategaki-frontmatter")?1:0}schedulePreciseScan(){this.isSelectionActive()||this.preciseScanTimer!==null||this.preciseScanRaf!==null||(this.preciseScanTimer=window.setTimeout(()=>{this.preciseScanTimer=null,this.preciseScanRaf=window.requestAnimationFrame(()=>{this.preciseScanRaf=null,this.runPreciseScan()})},80))}runPreciseScan(){if(this.isSelectionActive()||this.scrollingActive)return;this.renderVisibleVirtualLinesPrecise({maxLines:40,budgetMs:8})&&this.schedulePreciseScan()}renderVisibleVirtualLinesPrecise(t){var h,f,p;let e=this.context.getDerivedRootEl(),n=this.context.getDerivedContentEl();if(!e||!n)return!1;let r=e.getBoundingClientRect(),o=this.context.getLineRanges(),s=n.querySelectorAll('.tategaki-sot-line-virtual[data-virtual="1"]'),a=[];for(let m of Array.from(s)){if(!m.isConnected)continue;let g=m.getBoundingClientRect();g.bottom>=r.top&&g.top<=r.bottom&&g.right>=r.left&&g.left<=r.right&&a.push(m)}let l=(h=t.budgetMs)!=null?h:Number.POSITIVE_INFINITY,c=(f=t.maxLines)!=null?f:Number.POSITIVE_INFINITY,u=performance.now(),d=0;for(let m of a){if(!m.isConnected||m.dataset.virtual!=="1")continue;let g=Number.parseInt((p=m.dataset.line)!=null?p:"",10);if(!Number.isFinite(g))continue;let b=o[g];if(!b)continue;this.virtualQueued.delete(g);let v=this.virtualQueue.findIndex(y=>y.index===g);if(v!==-1&&this.virtualQueue.splice(v,1),this.virtualObserver&&this.virtualObserver.unobserve(m),m.removeAttribute("data-virtual"),m.classList.remove("tategaki-sot-line-virtual"),this.context.renderLine(m,b,g),d+=1,d>=c||performance.now()-u>=l)break}if(d>=c||performance.now()-u>=l)return!0;for(let m of a)if(m.isConnected&&m.dataset.virtual==="1")return!0;return!1}getApproxVisibleLineRange(t,e){let n=window.getComputedStyle(t),r=Number.parseFloat(n.fontSize)||16,o=Number.parseFloat(n.lineHeight)||r*1.8,s=Math.max(o,r),a=n.writingMode!=="horizontal-tb",l=a?t.clientWidth:t.clientHeight,c=a?t.scrollLeft:t.scrollTop;a&&c<0&&(c=-c);let u=Math.floor(Math.max(0,c)/s),d=Math.ceil(l/s),h=Math.max(0,Math.min(e-1,u)),f=Math.max(h,Math.min(e-1,u+d));return{start:h,end:f}}flushVirtualQueue(){if(this.isSelectionActive()||this.scrollingActive)return;let t=performance.now(),e=10,n=this.context.getLineRanges();for(;this.virtualQueue.length>0&&performance.now()-t<e;){let r=this.virtualQueue.shift();this.virtualQueued.delete(r.index);let o=r.element;if(this.virtualObserver&&this.virtualObserver.unobserve(o),!o.isConnected||o.dataset.virtual!=="1")continue;let s=n[r.index];s&&(o.removeAttribute("data-virtual"),o.classList.remove("tategaki-sot-line-virtual"),this.context.renderLine(o,s,r.index))}this.virtualQueue.length>0&&this.scheduleVirtualQueue()}resetVirtualQueue(){this.virtualQueue=[],this.virtualQueued.clear()}cancelVirtualQueue(){this.virtualQueueRaf!==null&&(window.cancelAnimationFrame(this.virtualQueueRaf),this.virtualQueueRaf=null),this.resetVirtualQueue()}cancelVirtualize(){this.virtualizeRaf!==null&&(window.cancelAnimationFrame(this.virtualizeRaf),this.virtualizeRaf=null),this.virtualizeIndex=0}scheduleResumeAfterScroll(t=!1,e={}){!t&&this.isSelectionActive()||this.resumeAfterScrollRaf===null&&(this.resumeAfterScrollRaf=window.requestAnimationFrame(()=>{this.resumeAfterScrollRaf=null;let n=this.renderVisibleVirtualLinesImmediate(t,e);this.scheduleVirtualQueue(),this.scheduleVirtualizeDistantLines(),n&&this.scheduleResumeAfterScroll(t,e)}))}onScrollSettled(){if(this.virtualEnabled&&!this.scrollingActive){if(this.isSelectionActive()){this.scheduleResumeAfterScroll(!0,{maxLines:120,budgetMs:12});return}this.scheduleResumeAfterScroll(),this.schedulePreciseScan()}}renderVisibleVirtualLinesImmediate(t=!1,e={}){var b,v,y,E;if(!t&&this.isSelectionActive())return!1;let n=this.context.getDerivedRootEl(),r=this.context.getDerivedContentEl();if(!n||!r)return!1;let o=this.context.getLineRanges(),s=o.length;if(s===0)return!1;let a=this.getApproxVisibleLineRange(n,s),l=s>=8e3?8:12,c=Math.max(0,a.start-l),u=Math.min(s-1,a.end+l),d=this.getLineElementOffset(r),h=r.children,f=(b=e.budgetMs)!=null?b:Number.POSITIVE_INFINITY,p=(v=e.maxLines)!=null?v:Number.POSITIVE_INFINITY,m=performance.now(),g=0;for(let x=c;x<=u;x+=1){let S=h[x+d];if(!S||!S.isConnected||S.dataset.virtual!=="1")continue;let w=o[x];if(!w)continue;this.virtualQueued.delete(x);let k=this.virtualQueue.findIndex(M=>M.index===x);if(k!==-1&&this.virtualQueue.splice(k,1),this.virtualObserver&&this.virtualObserver.unobserve(S),S.removeAttribute("data-virtual"),S.classList.remove("tategaki-sot-line-virtual"),this.context.renderLine(S,w,x),g+=1,g>=p||performance.now()-m>=f)break}if(t&&this.isSelectionActive()&&g>0){let x=performance.now();x-this.lastSelectionResyncAt>120&&(this.lastSelectionResyncAt=x,(E=(y=this.context).resyncSelection)==null||E.call(y))}if(g>=p||performance.now()-m>=f)return!0;for(let x=c;x<=u;x+=1){let S=h[x+d];if(!(!S||!S.isConnected)&&S.dataset.virtual==="1")return!0}return!1}cancelChunkedRender(){this.renderChunkRaf!==null&&(window.cancelAnimationFrame(this.renderChunkRaf),this.renderChunkRaf=null)}renderChunked(t,e,n,r){let o=this.context.getDerivedRootEl(),s=this.context.getDerivedContentEl();if(!o||!s)return;this.cancelChunkedRender(),s.replaceChildren();let a=this.context.getPluginSettings(),l=this.context.getHideFrontmatter(),c=this.context.getWritingMode();if(e&&!l){let m=this.context.renderFrontmatter(e,a);m&&(this.context.applyFrontmatterWritingMode(m,c),s.appendChild(m))}this.context.resetPendingRenderState();let u=this.context.getLineRanges(),d=u.length,h=0,f=12,p=()=>{if(t!==this.renderGeneration){this.renderChunkRaf=null;return}let m=this.context.getDerivedRootEl(),g=this.context.getDerivedContentEl();if(!m||!g){this.renderChunkRaf=null;return}let b=performance.now(),v=document.createDocumentFragment();for(;h<d&&performance.now()-b<f;){let y=u[h];if(y){let E=document.createElement("div");E.className="tategaki-sot-line",E.dataset.from=String(y.from),E.dataset.to=String(y.to),E.dataset.line=String(h),this.renderLineWithVirtualization(E,y,h),v.appendChild(E)}h+=1}if(g.appendChild(v),h<d){this.renderChunkRaf=window.requestAnimationFrame(p);return}this.renderChunkRaf=null,this.context.finalizeRender(n,r)};this.renderChunkRaf=window.requestAnimationFrame(p)}};var Tt="tategaki-sot-wysiwyg-view",WE="__tategakiInitialFile",Vi=class extends be.ItemView{constructor(e,n){super(e);this.isReady=!1;this.pendingState=null;this.currentFile=null;this.viewRootEl=null;this.commandToolbar=null;this.commandContextMenu=null;this.commandAdapter=null;this.pageContainerEl=null;this.borderWrapperEl=null;this.contentWrapperEl=null;this.derivedRootEl=null;this.derivedContentEl=null;this.selectionLayerEl=null;this.caretEl=null;this.pendingEl=null;this.pendingSpacerEl=null;this.loadingOverlayEl=null;this.overlayTextarea=null;this.outlinePanel=null;this.sotEditor=null;this.detachSoTListener=null;this.renderPipeline=null;this.wheelThrottleTimer=null;this.scrollDebounceTimer=null;this.scrollDebounceRaf=null;this.scrollDebouncePendingTop=0;this.scrollDebouncePendingLeft=0;this.scrollDebounceLastTop=0;this.scrollDebounceLastLeft=0;this.scrollDebounceLastEventAt=0;this.selectionChangeDebounceTimer=null;this.pendingNativeSelectionSync=!1;this.isScrolling=!1;this.lineModelRecomputeDeferred=!1;this.selectionOverlayRaf=null;this.activeTouchPointers=new Map;this.touchScrollStartX=0;this.touchScrollStartY=0;this.touchScrollLastY=0;this.touchScrollActive=!1;this.lineModelRecomputeTimer=null;this.lineModelRecomputeIdle=null;this.lineModelRecomputeStart=null;this.lineModelRecomputeEnd=null;this.outlineJumpToken=0;this.outlineJumpRaf=null;this.boundWheelHandler=null;this.overlayFocused=!1;this.suppressNativeSelectionCollapse=!1;this.overlayImeReplace=null;this.plainEditOverlayEl=null;this.plainEditRange=null;this.plainEditComposing=!1;this.plainEditCommitting=!1;this.plainEditOutsidePointerHandler=null;this.plainEditOverlayBaseRect=null;this.ceImeMode=!1;this.ceImeSuspended=!1;this.ceImeFallbackActive=!1;this.ceImeMappingFailureCount=0;this.ceImeMappingFailureAt=0;this.ceImeApplying=!1;this.ceImeComposeId=0;this.ceImeActiveComposeId=null;this.ceImeAppliedComposeId=0;this.ceImeComposing=!1;this.ceImeSelectionSyncing=!1;this.ceImeSelectionChangeSuppressedUntil=0;this.ceImeAutoTrailingNewline=!1;this.ceImeAutoTrailingNewlineBaseLength=0;this.ceImeAutoTrailingNewlineTail="";this.ceImeLastCompositionText="";this.ceImeLastBeforeInputText="";this.ceImeCompositionSelection=null;this.ceImeIgnoreNextInput=!1;this.ceImeExternalSuppressUntil=0;this.ceEditableStart=null;this.ceEditableEnd=null;this.ceSafetyCheckRaf=null;this.ceSafetyCheckAt=0;this.isPointerSelecting=!1;this.autoScrollSelecting=!1;this.autoScrollFast=!1;this.softSelectionPointerLock=!1;this.scrollbarSelectionHold=!1;this.nativeSelectionAssistActive=!1;this.nativeSelectionAssistByAutoScroll=!1;this.nativeContextMenuHold=new Al;this.softSelectionLargeCharThreshold=5e3;this.softSelectionLargeLineThreshold=200;this.pointerHandler=null;this.lastPaneHeaderTitle="";this.selectionOverlay=null;this.ceSelectionSync=null;this.nativeSelectionSupport=null;this.pendingCaretScroll=!1;this.selectAllActive=!1;this.softSelectionActive=!1;this.softSelectionFrom=0;this.softSelectionTo=0;this.keepSoTActiveOnOutline=!1;this.nativeSelectionPendingFocus=!1;this.nativeSelectionPendingClick=null;this.pointerSelectAnchor=null;this.pointerSelectPointerId=null;this.pendingSelectionFrom=null;this.pendingSelectionTo=null;this.pendingSelectionLineStart=null;this.pendingSelectionLineEnd=null;this.pendingText="";this.pendingHold=!1;this.showPendingOverlay=!1;this.immediateRender=!1;this.loadingOverlayPending=!1;this.lineRanges=[];this.pendingLineIndex=null;this.pendingLocalOffset=null;this.pairedMarkdownLeaf=null;this.pairedMarkdownView=null;this.pairedMarkdownBadgeLeaf=null;this.pairedMarkdownBadgeEl=null;this.sotTabBadgeEl=null;this.pairedMismatchNotified=!1;this.suppressPairCheck=!1;this.recentFilePaths=[];this.recentFilePathsInitialized=!1;this.sourceModeEnabled=!1;this.sourceModeLineStart=null;this.sourceModeLineEnd=null;this.plainTextViewEnabled=!1;this.writingMode="vertical-rl";this.lineBlockKinds=[];this.lineCodeFenceInfo=[];this.lineCodeLang=[];this.lineCodeBlockPart=[];this.lineMathBlockStart=[];this.lineMathBlockEnd=[];this.lineCalloutType=[];this.lineCalloutIsTitle=[];this.lineCalloutBlockStart=[];this.lineCalloutBlockEnd=[];this.lineTableIsHeader=[];this.lineTableBlockStart=[];this.lineTableBlockEnd=[];this.lineDeflistBlockStart=[];this.lineDeflistBlockEnd=[];this.lineHeadingSectionEnd=[];this.lineHeadingHiddenBy=[];this.collapsedHeadingLines=new Set;this.footnoteDefinitionOrder=new Map;this.footnoteDefinitionText=new Map;this.linkReferenceMap=new Map;this.lineDecorationCache=new Map;this.lineSegmentCache=new Map;this.embedRenderChildren=new Map;this.mathRenderChildren=new Map;this.calloutRenderChildren=new Map;this.tableRenderChildren=new Map;this.deflistRenderChildren=new Map;this.finishRenderMathTimer=null;this.hideFrontmatter=!1;this.frontmatterDetected=!1;this.collapsePreviewTooltip=null;this.lineCacheMaxEntries=4e3;this.lineCacheTrimCursor=0;this.nativeSelectionAnchorLine=null;this.nativeSelectionHeadLine=null;this.nativeSelectionAnchorLocked=!1;this.plugin=n,this.scope=new be.Scope(this.app.scope),this.plainEditController=new Sl(this),this.workspaceController=new Ml(this)}isLineInSourceMode(e){return!1}getCollapsedContentPreview(e,n){if(!this.sotEditor)return null;let r=this.lineHeadingSectionEnd[e];if(r===null||r<=e)return null;let o=this.sotEditor.getDoc(),s=[],a=0;for(let c=e+1;c<=r&&a<n;c++){if(this.lineHeadingHiddenBy[c]!==e)continue;let u=this.lineRanges[c];if(!u)continue;let d=o.slice(u.from,u.to).trim();d.length>0&&(s.push(d),a++)}return s.length===0?null:s.map(c=>c.length>50?c.slice(0,50)+"...":c).join(`
`)}showCollapsePreviewTooltip(e,n){this.hideCollapsePreviewTooltip();let r=document.createElement("div");r.className="tategaki-collapse-preview-tooltip",r.textContent=n,document.body.appendChild(r),this.collapsePreviewTooltip=r;let o=e.getBoundingClientRect(),s=r.getBoundingClientRect(),a=o.left+o.width/2-s.width/2,l=o.bottom+8;a<8&&(a=8),a+s.width>window.innerWidth-8&&(a=window.innerWidth-s.width-8),l+s.height>window.innerHeight-8&&(l=o.top-s.height-8),r.style.left=`${a}px`,r.style.top=`${l}px`}hideCollapsePreviewTooltip(){this.collapsePreviewTooltip&&(this.collapsePreviewTooltip.remove(),this.collapsePreviewTooltip=null)}setWritingMode(e){var r;if(this.writingMode=e,!this.derivedRootEl)return;this.derivedRootEl.dataset.writingMode=e,this.derivedRootEl.style.setProperty("--tategaki-writing-mode",e),this.derivedRootEl.scrollTop=0,this.derivedRootEl.scrollLeft=0;let n=(r=this.derivedContentEl)==null?void 0:r.querySelector(".tategaki-frontmatter");n&&this.applyFrontmatterWritingMode(n,e),this.updateWritingModeToggleUi(),this.updateMobileTouchAction(),this.pendingCaretScroll=!0,this.scheduleCaretUpdate(!0)}setLoadingOverlayVisible(e){this.loadingOverlayEl&&(this.loadingOverlayEl.style.display=e?"flex":"none")}cancelOutlineJump(){this.outlineJumpRaf!==null&&(window.cancelAnimationFrame(this.outlineJumpRaf),this.outlineJumpRaf=null)}scrollToOutlineLine(e){var f;if(!this.derivedRootEl)return;let n=this.derivedRootEl,r=++this.outlineJumpToken;this.cancelOutlineJump();let o=window.getComputedStyle(n),s=Number.parseFloat(o.fontSize)||16,a=Number.parseFloat(o.lineHeight)||s*1.8,l=Math.max(a,s),c=Math.max(0,e)*l;if(o.writingMode!=="horizontal-tb"){let p=n.scrollLeft<0?-1:1;n.scrollLeft=c*p}else n.scrollTop=c;(f=this.renderPipeline)==null||f.onScrollSettled();let d=()=>{if(this.outlineJumpToken!==r)return;let p=this.getLineElement(e);p&&(this.ensureLineRendered(p),this.rerenderLineRange(e-8,e+8),p.scrollIntoView({block:"center",inline:"center"}))},h=p=>{if(this.outlineJumpToken!==r)return;let m=this.getLineElement(e);if(!m){p<60&&(this.outlineJumpRaf=window.requestAnimationFrame(()=>h(p+1)));return}this.ensureLineRendered(m),this.rerenderLineRange(e-8,e+8),this.outlineJumpRaf=window.requestAnimationFrame(()=>{d(),window.setTimeout(()=>{var g;(g=this.renderPipeline)==null||g.onScrollSettled(),d()},100)})};h(0)}showLoadingOverlay(){this.loadingOverlayPending=!0,this.setLoadingOverlayVisible(!0)}hideLoadingOverlay(){this.loadingOverlayPending=!1,this.setLoadingOverlayVisible(!1)}cancelLineModelRecomputeTimers(){if(this.lineModelRecomputeTimer!==null&&(window.clearTimeout(this.lineModelRecomputeTimer),this.lineModelRecomputeTimer=null),this.lineModelRecomputeIdle!==null){let e=window.cancelIdleCallback;e==null||e(this.lineModelRecomputeIdle),this.lineModelRecomputeIdle=null}}markScrollActive(){this.isScrolling||(this.isScrolling=!0,this.lineModelRecomputeStart!==null&&(this.lineModelRecomputeDeferred=!0),this.cancelLineModelRecomputeTimers())}finishScrollActivity(){this.isScrolling&&(this.isScrolling=!1,this.lineModelRecomputeDeferred&&(this.lineModelRecomputeDeferred=!1,this.runLineModelRecompute()))}shouldDeferCaretUpdate(e){return!(e||!this.isScrolling||this.ceImeMode||this.isPointerSelecting||this.autoScrollSelecting)}shouldDeferLineModelRecompute(){return!(!this.isScrolling||this.ceImeMode)}getFastScrollScale(e,n){return e>=2e4||n>=8e5?.55:e>=8e3||n>=3e5?.75:e>=4e3||n>=2e5?.9:1.15}getFastScrollThresholds(e){var l,c;let n=this.lineRanges.length,r=(c=(l=this.sotEditor)==null?void 0:l.getDoc().length)!=null?c:0,o=this.getFastScrollScale(n,r),s=Math.max(64,e*.45),a=Math.max(200,e*1.05);return{smallThreshold:s*o,fastThreshold:a*o,idleDelay:120}}scheduleSelectionOverlayUpdate(){this.selectionOverlayRaf===null&&(this.selectionOverlayRaf=window.requestAnimationFrame(()=>{this.selectionOverlayRaf=null,this.updateSelectionOverlay()}))}clearSelectionChangeDebounceTimer(){this.selectionChangeDebounceTimer!==null&&(window.clearTimeout(this.selectionChangeDebounceTimer),this.selectionChangeDebounceTimer=null)}shouldDeferNativeSelectionSync(){return this.isScrolling||this.autoScrollSelecting||this.isPointerSelecting}flushPendingNativeSelectionSync(e=!1){this.pendingNativeSelectionSync&&(!e&&this.shouldDeferNativeSelectionSync()||(this.pendingNativeSelectionSync=!1,this.runCeSelectionChange()))}schedulePendingNativeSelectionSync(){this.pendingNativeSelectionSync=!0,this.clearSelectionChangeDebounceTimer(),this.selectionChangeDebounceTimer=window.setTimeout(()=>{if(this.selectionChangeDebounceTimer=null,this.shouldDeferNativeSelectionSync()){this.schedulePendingNativeSelectionSync();return}this.flushPendingNativeSelectionSync(!0)},100)}updateNativeSelectionLineHints(){var s,a;if(!this.isNativeSelectionEnabled()||!this.derivedContentEl){this.nativeSelectionAnchorLine=null,this.nativeSelectionHeadLine=null,this.nativeSelectionAnchorLocked=!1;return}let e=(s=this.derivedContentEl.ownerDocument.getSelection())!=null?s:null;if(!((a=this.nativeSelectionSupport)!=null&&a.isSelectionActive())){this.nativeSelectionAnchorLine=null,this.nativeSelectionHeadLine=null,this.nativeSelectionAnchorLocked=!1;return}if(!e||e.isCollapsed||!this.isSelectionInsideDerivedContent(e))return;let n=this.getLineElementForNode(e.anchorNode),r=this.getLineElementForNode(e.focusNode),o=l=>{var u;let c=Number.parseInt((u=l==null?void 0:l.dataset.line)!=null?u:"",10);return Number.isFinite(c)?c:null};this.nativeSelectionAnchorLocked||(this.nativeSelectionAnchorLine=o(n)),this.nativeSelectionHeadLine=o(r)}getNativeSelectionHintLines(){let e=[];return this.nativeSelectionAnchorLine!==null&&e.push(this.nativeSelectionAnchorLine),this.nativeSelectionHeadLine!==null&&e.push(this.nativeSelectionHeadLine),Array.from(new Set(e))}shouldSuppressAutoScrollSelectionRenders(){var n,r;return!this.autoScrollSelecting||this.nativeSelectionAssistByAutoScroll?!1:((r=(n=this.sotEditor)==null?void 0:n.getDoc().length)!=null?r:0)>=2e5||this.lineRanges.length>=2e3}isNativeSelectionConfigured(){return this.plugin.settings.wysiwyg.useNativeSelection===!0}syncNativeSelectionDataset(){this.derivedRootEl&&(this.isNativeSelectionEnabled()?this.derivedRootEl.dataset.nativeSelection="1":delete this.derivedRootEl.dataset.nativeSelection)}debugNativeSelectionAssist(e,n={}){Bp("Tategaki SoT native-selection:",e,{active:this.nativeSelectionAssistActive,enabled:this.isNativeSelectionEnabled(),configured:this.isNativeSelectionConfigured(),ceImeMode:this.ceImeMode,sourceModeEnabled:this.sourceModeEnabled,...n})}setNativeSelectionAssistActive(e,n="unknown"){if(this.nativeSelectionAssistActive===e){this.syncNativeSelectionDataset(),this.debugNativeSelectionAssist("assist-state-noop",{reason:n,next:e});return}this.nativeSelectionAssistActive=e,this.syncNativeSelectionDataset(),this.debugNativeSelectionAssist("assist-state-changed",{reason:n,next:e}),this.scheduleSelectionOverlayUpdate()}isNativeSelectionEnabled(){return!this.isNativeSelectionConfigured()||this.ceImeMode||this.sourceModeEnabled?!1:this.nativeSelectionAssistActive}isHugeDocSelection(){var r,o,s,a;let e=(o=(r=this.sotEditor)==null?void 0:r.getDoc().length)!=null?o:0,n=(a=(s=this.renderPipeline)==null?void 0:s.isVirtualizedRenderEnabled())!=null?a:!1;return e>=1e5||this.lineRanges.length>=2e3||n}getSoftSelectionRange(){if(!this.softSelectionActive||!this.sotEditor)return null;let e=this.sotEditor.getDoc().length,n=Math.max(0,Math.min(this.softSelectionFrom,e)),r=Math.max(0,Math.min(this.softSelectionTo,e));return{from:Math.min(n,r),to:Math.max(n,r)}}setSoftSelection(e,n){this.softSelectionActive=!0,this.softSelectionFrom=e,this.softSelectionTo=n}clearSoftSelection(){var e;this.softSelectionActive&&(this.softSelectionActive=!1,this.softSelectionPointerLock=!1,(e=this.selectionLayerEl)==null||e.replaceChildren())}shouldUseSoftSelectionForAutoScroll(){return this.autoScrollSelecting&&this.isHugeDocSelection()}shouldUseSoftSelectionForPointer(e,n){if(!this.isPointerSelecting||!this.isHugeDocSelection())return!1;if(this.softSelectionPointerLock)return!0;let r=Math.min(e,n),o=Math.max(e,n);if(Math.max(0,o-r)>=this.softSelectionLargeCharThreshold)return!0;let a=this.findLineIndex(r),l=this.findLineIndex(o);return a===null||l===null?!1:Math.abs(l-a)>=this.softSelectionLargeLineThreshold}isPointerOnScrollbar(e,n){if(!e)return!1;let r=e.getBoundingClientRect(),o=e.offsetWidth-e.clientWidth,s=e.offsetHeight-e.clientHeight,a=o>0&&n.clientX>=r.right-o,l=s>0&&n.clientY>=r.bottom-s;return a||l}async toggleWritingMode(){let n=this.plugin.settings.common.writingMode==="vertical-rl"?"horizontal-tb":"vertical-rl";this.plugin.settings.common.writingMode=n,await this.plugin.saveSettings(),this.setWritingMode(n)}async togglePlainTextView(){let e=this.plugin.settings.wysiwyg.plainTextView!==!0;this.plugin.settings.wysiwyg.plainTextView=e,await this.plugin.saveSettings(),this.applySettingsToView(this.plugin.settings)}updateWritingModeToggleUi(){var e;(e=this.commandToolbar)==null||e.update()}getEffectiveCommonSettings(e){return typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common}applySettingsToView(e){var p,m,g,b,v,y,E,x;if(!this.derivedRootEl)return;let n=this.getEffectiveCommonSettings(e);this.hideFrontmatter=(p=e.preview.hideFrontmatter)!=null?p:!1,this.invalidateLineCaches(),this.setPlainTextViewEnabled(e.wysiwyg.plainTextView===!0),this.applyPageLayout(e);let r=(m=this.contentWrapperEl)!=null?m:this.derivedRootEl;r.style.setProperty("--tategaki-writing-mode",n.writingMode),r.style.setProperty("--tategaki-font-family",n.fontFamily),r.style.setProperty("--tategaki-font-size",`${n.fontSize}px`),r.style.setProperty("--tategaki-line-height",`${n.lineHeight}`),r.style.setProperty("--tategaki-letter-spacing",`${n.letterSpacing}em`),r.style.setProperty("--tategaki-text-color",n.textColor),r.style.setProperty("--tategaki-background-color",n.backgroundColor),r.style.setProperty("--tategaki-accent-color",n.accentColor);let o=this.resolveCaretColor(e,n);r.style.setProperty("--tategaki-caret-color",o);let s=(g=n.rubyVerticalGap)!=null?g:ae.common.rubyVerticalGap,a=(b=n.rubyHorizontalGap)!=null?b:ae.common.rubyHorizontalGap;r.style.setProperty("--tategaki-ruby-gap-vertical",`${s}em`),r.style.setProperty("--tategaki-ruby-gap-horizontal",`${a}em`);let c=Math.max(.2,Math.min(1,(v=n.rubySize)!=null?v:.5)).toString();r.style.setProperty("--tategaki-ruby-size",c),r.style.setProperty("--ruby-size",c),r.classList.add("text-justify-enabled"),r.style.textAlign="justify",r.style.textAlignLast="auto",r.style.setProperty("text-justify","inter-ideograph");let u=n.headingFontFamily||n.fontFamily,d=n.headingTextColor||n.textColor;r.style.setProperty("--tategaki-heading-font-family",u),r.style.setProperty("--tategaki-heading-text-color",d),this.writingMode!==n.writingMode?this.setWritingMode(n.writingMode):(this.derivedRootEl.dataset.writingMode=n.writingMode,this.derivedRootEl.style.setProperty("--tategaki-writing-mode",n.writingMode)),this.syncNativeSelectionDataset();let h=(y=e.wysiwyg.sotPaddingTop)!=null?y:32,f=(E=e.wysiwyg.sotPaddingBottom)!=null?E:16;this.derivedRootEl.style.paddingTop=`${h}px`,this.derivedRootEl.style.paddingBottom=`${f}px`,(x=this.commandToolbar)==null||x.update(),this.scheduleCaretUpdate(!0)}setPlainTextViewEnabled(e){var n;this.plainTextViewEnabled!==e&&(this.plainTextViewEnabled=e,e&&this.sourceModeEnabled&&this.disablePlainEditMode(),this.derivedRootEl&&(e?this.derivedRootEl.dataset.plainTextView="1":delete this.derivedRootEl.dataset.plainTextView),this.invalidateLineCaches(),this.scheduleRender(!0),(n=this.commandToolbar)==null||n.update())}shouldAllowDomSelectAll(){var r,o;let e=(o=(r=this.renderPipeline)==null?void 0:r.isVirtualizedRenderEnabled())!=null?o:!1;return $E(this.sotEditor,this.lineRanges.length,{timeoutMs:50,maxDocLength:1e5,maxLineCount:2e3,virtualized:e}).allowDomSelectAll}resolveCaretColor(e,n){var o,s;let r=(o=e.wysiwyg.caretColorMode)!=null?o:"accent";if(r==="text")return n.textColor;if(r==="custom"){let a=(s=e.wysiwyg.caretCustomColor)==null?void 0:s.trim();if(a)return a}return n.accentColor}applyPageLayout(e){var a;let n=this.getEffectiveCommonSettings(e),r=Number((a=n.pageScale)!=null?a:1),o=r>1,s=o?1:Math.max(.7,Math.min(1,r));this.borderWrapperEl&&(this.borderWrapperEl.style.transformOrigin="center center",this.borderWrapperEl.style.transform=`scale(${o?1:s})`,this.borderWrapperEl.style.boxShadow=o?"none":"0 6px 12px rgba(0,0,0,0.4)",this.borderWrapperEl.style.setProperty("background",n.backgroundColor,"important"),this.borderWrapperEl.style.setProperty("border","none","important"),this.borderWrapperEl.style.setProperty("outline","none","important")),this.pageContainerEl&&(this.pageContainerEl.style.alignItems=o?"stretch":"center",this.pageContainerEl.style.justifyContent=o?"stretch":"center",this.pageContainerEl.style.padding=o?"0":"40px 32px 22px 32px",this.pageContainerEl.style.background="transparent"),this.viewRootEl&&(this.viewRootEl.style.background=o?n.backgroundColor:n.pageBackgroundColor),this.contentWrapperEl&&(this.contentWrapperEl.style.background=n.backgroundColor,this.contentWrapperEl.style.color=n.textColor,this.contentWrapperEl.style.letterSpacing=`${n.letterSpacing}em`)}parseFrontmatter(e){let n=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=e.match(n);if(!r)return{frontmatter:null,contentWithoutFrontmatter:e};let o=r[1],s=e.slice(r[0].length),a={},l=o.split(`
`),c="",u=[],d=!1;for(let h of l){let f=h.trim();if(!f||f.startsWith("#"))continue;if(f.startsWith("- ")){d&&u.push(f.slice(2).trim());continue}d&&!f.startsWith("- ")&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u),d=!1,u=[]);let p=f.indexOf(":");if(p!==-1){let m=f.slice(0,p).trim(),g=f.slice(p+1).trim();switch(m){case"title":a.title=g;break;case"subtitle":a.subtitle=g;break;case"original_title":a.original_title=g;break;case"author":a.author=g;break;case"translator":a.translator=g;break;case"co_authors":case"co_translators":if(g){let b=g.split(",").map(v=>v.trim()).filter(v=>v.length>0);m==="co_authors"?a.co_authors=b:a.co_translators=b}else c=m,d=!0,u=[];break;default:break}}}return d&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u)),{frontmatter:Object.keys(a).length>0?a:null,contentWithoutFrontmatter:s}}renderFrontmatter(e,n){let r=document.createElement("div");r.className="tategaki-frontmatter";let o=!1,s=r.createDiv("tategaki-frontmatter-top");if(e.title&&n.preview.showFrontmatterTitle){let l=s.createEl("h1",{cls:"tategaki-frontmatter-title"});l.textContent=e.title,o=!0}if(e.subtitle&&n.preview.showFrontmatterSubtitle){let l=s.createEl("h2",{cls:"tategaki-frontmatter-subtitle"});l.textContent=e.subtitle,o=!0}if(e.original_title&&n.preview.showFrontmatterOriginalTitle){let l=s.createEl("h2",{cls:"tategaki-frontmatter-original-title"});l.textContent=e.original_title,o=!0}let a=r.createDiv("tategaki-frontmatter-bottom");if(e.author&&n.preview.showFrontmatterAuthor){let l=a.createEl("h4",{cls:"tategaki-frontmatter-author"});l.textContent=e.author,this.applyFrontmatterInlineEndAlignment(l),o=!0}if(e.co_authors&&n.preview.showFrontmatterCoAuthors)for(let l of e.co_authors){let c=a.createEl("h4",{cls:"tategaki-frontmatter-co-author"});c.textContent=l,this.applyFrontmatterInlineEndAlignment(c),o=!0}if(e.translator&&n.preview.showFrontmatterTranslator){let l=a.createEl("h5",{cls:"tategaki-frontmatter-translator"});l.textContent=e.translator,this.applyFrontmatterInlineEndAlignment(l),o=!0}if(e.co_translators&&n.preview.showFrontmatterCoTranslators)for(let l of e.co_translators){let c=a.createEl("h5",{cls:"tategaki-frontmatter-co-translator"});c.textContent=l,this.applyFrontmatterInlineEndAlignment(c),o=!0}return o?r:null}applyFrontmatterInlineEndAlignment(e){e.style.display="block",e.style.setProperty("text-align","end","important"),e.style.setProperty("text-align-last","end","important"),e.style.marginInlineStart="auto",e.style.marginInlineEnd="0",e.style.marginLeft="auto",e.style.marginRight="0",e.style.justifySelf="end"}applyFrontmatterWritingMode(e,n){e.style.writingMode=n,e.style.textOrientation="mixed"}computeLineRangesFromLines(e){return AE(e)}shouldUseLineCache(){var n,r;return!(be.Platform.isMobile||be.Platform.isMobileApp||((r=(n=this.sotEditor)==null?void 0:n.getDoc().length)!=null?r:0)>=3e5||this.lineRanges.length>=4e3)}invalidateLineCaches(){this.lineDecorationCache.clear(),this.lineSegmentCache.clear()}trimLineCachesIfNeeded(){let e=this.lineCacheMaxEntries;if(e<=0)return;let n=Math.max(this.lineDecorationCache.size-e,this.lineSegmentCache.size-e)||0;if(n<=0)return;let r=this.lineRanges.length;if(r<=0)return;let o=Math.max(1,Math.floor(r/(n*2))),s=0,a=this.lineCacheTrimCursor%r;for(let l=0;l<r&&s<n;l+=1){let c=a;a=(a+o)%r,this.lineDecorationCache.delete(c)&&(s+=1),this.lineSegmentCache.delete(c)&&(s+=1)}this.lineCacheTrimCursor=a}getCachedBlockLineDecoration(e,n,r,o){if(!this.shouldUseLineCache()||e===null)return this.computeBlockLineDecoration(n,r,o,e);if(e!==null){let a=this.lineDecorationCache.get(e);if(a&&a.from===n&&a.to===r&&a.text===o)return a.decoration}let s=this.computeBlockLineDecoration(n,r,o,e);return e!==null&&(this.trimLineCachesIfNeeded(),this.lineDecorationCache.set(e,{from:n,to:r,text:o,decoration:s})),s}recomputeLineBlockKinds(e){this.invalidateLineCaches();let n=IE({lines:e,collapsedHeadingLines:this.collapsedHeadingLines,normalizeLinkLabel:r=>this.normalizeLinkLabel(r)});this.lineBlockKinds=n.lineBlockKinds,this.lineCodeFenceInfo=n.lineCodeFenceInfo,this.lineCodeLang=n.lineCodeLang,this.lineCodeBlockPart=n.lineCodeBlockPart,this.lineMathBlockStart=n.lineMathBlockStart,this.lineMathBlockEnd=n.lineMathBlockEnd,this.lineCalloutType=n.lineCalloutType,this.lineCalloutIsTitle=n.lineCalloutIsTitle,this.lineCalloutBlockStart=n.lineCalloutBlockStart,this.lineCalloutBlockEnd=n.lineCalloutBlockEnd,this.lineTableIsHeader=n.lineTableIsHeader,this.lineTableBlockStart=n.lineTableBlockStart,this.lineTableBlockEnd=n.lineTableBlockEnd,this.lineDeflistBlockStart=n.lineDeflistBlockStart,this.lineDeflistBlockEnd=n.lineDeflistBlockEnd,this.lineHeadingSectionEnd=n.lineHeadingSectionEnd,this.lineHeadingHiddenBy=n.lineHeadingHiddenBy,this.footnoteDefinitionOrder=n.footnoteDefinitionOrder,this.footnoteDefinitionText=n.footnoteDefinitionText,this.linkReferenceMap=n.linkReferenceMap,this.collapsedHeadingLines=n.collapsedHeadingLines}createLinePrefixElement(e){var s,a;let n=(s=e.dataset.mdKind)!=null?s:"";if(n==="heading"){let l=Number.parseInt((a=e.dataset.line)!=null?a:"",10);if(!Number.isFinite(l))return null;let c=this.lineHeadingSectionEnd[l];if(c===null||c<=l)return null;let u=document.createElement("span");u.className="tategaki-md-heading-toggle",u.dataset.headingToggle="1";let d=e.dataset.headingCollapsed==="1";u.setAttribute("role","button"),u.setAttribute("aria-expanded",d?"false":"true"),u.setAttribute("aria-label",d?"\u898B\u51FA\u3057\u3092\u5C55\u958B":"\u898B\u51FA\u3057\u3092\u6298\u308A\u305F\u305F\u3080");let h=this.writingMode,f;return h==="horizontal-tb"?f=d?"circle-chevron-right":"circle-chevron-down":f=d?"circle-chevron-down":"circle-chevron-left",(0,be.setIcon)(u,f),u}if(n!=="task")return null;let r=document.createElement("span");r.className="tategaki-md-task-box",r.dataset.taskToggle="1",r.setAttribute("role","checkbox");let o=e.dataset.taskChecked==="1";return r.setAttribute("aria-checked",o?"true":"false"),r.setAttribute("aria-label",o?"\u5B8C\u4E86":"\u672A\u5B8C\u4E86"),r}toggleTaskForLineElement(e){var g,b,v,y;if(!this.sotEditor)return;let n=Number.parseInt((g=e.dataset.from)!=null?g:"0",10),r=Number.parseInt((b=e.dataset.to)!=null?b:"0",10),o=this.sotEditor.getDoc(),s=Math.max(0,Math.min(n,o.length)),a=Math.max(s,Math.min(r,o.length)),l=o.slice(s,a),c=l.match(/^[ \t]*([-+*])[ \t]+\[([ xX])\]/);if(!c)return;let u=l.indexOf("[",(v=c.index)!=null?v:0);if(u<0||u+2>=l.length)return;let d=u+1,f=((y=l[d])!=null?y:" ").toLowerCase()==="x"?" ":"x",p=s+d,m=this.sotEditor.getSelection();this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(p,p+1,f),this.sotEditor.setSelection(m)}toggleHeadingFold(e){if(!this.sotEditor||e<0||e>=this.lineRanges.length)return;let n=this.lineHeadingSectionEnd[e];if(n===null||n<=e)return;this.collapsedHeadingLines.has(e)?this.collapsedHeadingLines.delete(e):this.collapsedHeadingLines.add(e);let o=this.sotEditor.getDoc().split(`
`);this.recomputeLineBlockKinds(o);let s=this.lineRanges[e];if(s)this.setSelectionNormalized(s.from,s.from);else{let a=this.sotEditor.getSelection();this.setSelectionNormalized(a.anchor,a.head)}this.scheduleRender(!0),this.scrollToOutlineLine(e)}collectHiddenRangesForLine(e,n,r,o){if(this.plainTextViewEnabled)return[];if(o!==null&&this.isLineInSourceMode(o))return[];let s=[],a=this.getCachedBlockLineDecoration(o,e,n,r);s.push(...a.hidden);let l=[],c=[];this.collectLinkRangesForLine(e,n,r,s,l,c),this.collectInlineMathRangesForLine(e,n,r,s);let u=this.getEditorViewForSyntax();if(u)try{(0,_l.syntaxTree)(u.state).iterate({from:e,to:n,enter:d=>{var f,p;let h=d.type.name;if(this.isMarkdownSyntaxMarkerNode(h)){s.push({from:d.from,to:d.to});return}this.isInlineStyleNode(h)&&this.pushHiddenMarkersForStyleNode((p=(f=this.sotEditor)==null?void 0:f.getDoc())!=null?p:"",h,d.from,d.to,s)}})}catch(d){}return this.mergeRanges(s.map(d=>({from:Math.max(e,Math.min(d.from,n)),to:Math.max(e,Math.min(d.to,n))})).filter(d=>d.to>d.from))}getEditorViewForSyntax(){var n,r,o;let e=(o=(r=(n=this.sotEditor)==null?void 0:n.getEditorView)==null?void 0:r.call(n))!=null?o:null;return e!=null?e:null}normalizeOffsetToVisible(e,n){if(!this.sotEditor)return e;let r=this.sotEditor.getDoc().length,o=Math.max(0,Math.min(e,r));if(this.plainTextViewEnabled)return o;let s=this.findLineIndex(o);if(s===null)return o;let a=this.lineMathBlockStart[s],l=this.lineMathBlockEnd[s];if(a!==null&&l!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[a];if(E)return E.from}let c=this.lineCalloutBlockStart[s],u=this.lineCalloutBlockEnd[s];if(c!==null&&u!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[c];if(E)return E.from}let d=this.lineTableBlockStart[s],h=this.lineTableBlockEnd[s];if(d!==null&&h!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[d];if(E)return E.from}let f=this.lineDeflistBlockStart[s],p=this.lineDeflistBlockEnd[s];if(f!==null&&p!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[f];if(E)return E.from}let m=this.lineHeadingHiddenBy[s];if(m!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[m];if(E)return E.from}if(this.isLineInSourceMode(s))return o;let g=this.lineRanges[s];if(!g)return o;let b=this.buildSegmentsForLine(g.from,g.to);if(b.length===0)return g.from;let v=b[0],y=b[b.length-1];if(o<=v.from)return v.from;if(o>=y.to)return y.to;for(let E=0;E<b.length;E+=1){let x=b[E];if(o>=x.from&&o<=x.to)return Math.max(x.from,Math.min(o,x.to));let S=b[E+1];if(S&&o>x.to&&o<S.from)return n?S.from:x.to}return o}setSelectionNormalized(e,n,r={}){var c;if(!this.sotEditor)return;let o=n>=e,s=this.normalizeOffsetToVisible(e,o),a=this.normalizeOffsetToVisible(n,o);if(this.shouldUseSoftSelectionForAutoScroll()){this.isPointerSelecting&&(this.softSelectionPointerLock=!0),this.setSoftSelection(s,a),this.scheduleSelectionOverlayUpdate();return}if(this.shouldUseSoftSelectionForPointer(s,a)){this.softSelectionPointerLock=!0,this.setSoftSelection(s,a),this.scheduleSelectionOverlayUpdate();return}if(this.softSelectionActive){let u=this.getSoftSelectionRange();(!u||u.from!==Math.min(s,a)||u.to!==Math.max(s,a))&&this.clearSoftSelection()}this.sotEditor.setSelection({anchor:s,head:a}),r.syncDom!==!1&&((c=this.nativeSelectionSupport)==null||c.syncDomSelectionFromSot(s,a))}isInlineStyleNode(e){switch(e){case"StrongEmphasis":return"tategaki-md-strong";case"Emphasis":return"tategaki-md-em";case"CodeText":case"InlineCode":return"tategaki-md-code";case"Strikethrough":return"tategaki-md-strike";case"Highlight":return"tategaki-md-highlight";case"Link":case"LinkText":case"URL":return"tategaki-md-link";default:return null}}isMarkdownSyntaxMarkerNode(e){return e==="EmphasisMark"||e==="CodeMark"||e==="StrikethroughMark"||e==="HighlightMark"||/(Emphasis|Code|Strikethrough|Highlight)Mark$/.test(e)}pushHiddenMarkerPairIfMatched(e,n,r,o,s,a){r-n<o.length+s.length||e.slice(n,n+o.length)===o&&e.slice(r-s.length,r)===s&&(a.push({from:n,to:n+o.length}),a.push({from:r-s.length,to:r}))}pushHiddenMarkersForStyleNode(e,n,r,o,s){switch(n){case"StrongEmphasis":{this.pushHiddenMarkerPairIfMatched(e,r,o,"***","***",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"___","___",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"**","**",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"__","__",s);break}case"Emphasis":{this.pushHiddenMarkerPairIfMatched(e,r,o,"*","*",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"_","_",s);break}case"Strikethrough":{this.pushHiddenMarkerPairIfMatched(e,r,o,"~~","~~",s);break}case"Highlight":{this.pushHiddenMarkerPairIfMatched(e,r,o,"==","==",s);break}case"CodeText":case"InlineCode":{let a=0;for(;r+a<o&&e[r+a]==="`";)a+=1;if(a<=0)break;let l="`".repeat(a);this.pushHiddenMarkerPairIfMatched(e,r,o,l,l,s);break}default:break}}normalizeLinkLabel(e){return e.replace(/\\(.)/g,"$1").trim().replace(/\s+/g," ").toLowerCase()}mergeRanges(e){if(e.length<=1)return e;let n=e.slice().sort((o,s)=>o.from-s.from||o.to-s.to),r=[];for(let o of n){let s=r[r.length-1];if(!s||o.from>s.to){r.push({from:o.from,to:o.to});continue}s.to=Math.max(s.to,o.to)}return r}collectLinkRangesForLine(e,n,r,o,s,a){let l=g=>Math.max(0,Math.min(g,r.length)),c=(g,b)=>{let v=e+l(g),y=e+l(b);y<=v||o.push({from:v,to:y})},u=(g,b,v,y)=>{let E=e+l(g),x=e+l(b);x<=E||(s.push({from:E,to:x,className:v}),y&&a.push({from:E,to:x,href:y}))},d=g=>{let b=0;for(let v=g-1;v>=0&&r[v]==="\\";v-=1)b+=1;return b%2===1},h=g=>{var y;let b=g.trim();if(b.length===0)return"";if(b.startsWith("<")){let E=b.indexOf(">");if(E>1)return b.slice(1,E)}let v=/^[^\s]+/.exec(b);return(y=v==null?void 0:v[0])!=null?y:b},f=null,p=r.length;for(let g=0;g<p;g+=1){let b=r[g];if(b==="`"&&!d(g)){let v=1;for(;g+v<p&&r[g+v]==="`";)v+=1;f===null?f=v:f===v&&(f=null),g+=v-1;continue}if(f===null){if(b==="<"){let v=r.indexOf(">",g+1);if(v>g+1){let y=r.slice(g+1,v);if(!/\s/.test(y)){let E=/^[a-z][a-z0-9+.-]*:\/\//i.test(y),x=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y);if(E||x){let S=x?`mailto:${y}`:y;c(g,g+1),c(v,v+1),u(g+1,v,"tategaki-md-link",S),g=v;continue}}}}if(b==="!"&&!d(g)&&g+1<p&&r[g+1]==="["){let v=1,y=-1;for(let P=g+2;P<p;P+=1){let I=r[P];if(I==="\\"&&P+1<p){P+=1;continue}if(I==="["&&!d(P)&&(v+=1),I==="]"&&!d(P)&&(v-=1,v===0)){y=P;break}}if(y===-1)continue;let E=y+1;for(;E<p&&/\s/.test(r[E]);)E+=1;if(E>=p||r[E]!=="(")continue;let x=E,S=1,w=-1;for(let P=x+1;P<p;P+=1){let I=r[P];if(I==="\\"&&P+1<p){P+=1;continue}if(I==="("&&!d(P)&&(S+=1),I===")"&&!d(P)&&(S-=1,S===0)){w=P;break}}if(w===-1)continue;let k=g+2,M=y,L=r.slice(x+1,w),_=h(L);if(c(g,g+2),c(y,w+1),M>k)u(k,M,"tategaki-md-image",_||void 0);else if(_){let P=x+1;u(P,w,"tategaki-md-image",_),c(y,x+1),c(w,w+1)}g=w;continue}if(b==="!"&&!d(g)&&g+2<p&&r.slice(g+1,g+3)==="[["){let v=g+1,y=r.indexOf("]]",v+2);if(y===-1)continue;let E=r.slice(v+2,y),x=E.indexOf("|"),S=x>=0?E.slice(0,x):E,w=x>=0?E.slice(x+1):null,k=S.trim(),M=w!==null&&w.length>0?w:S,L=w!==null?v+2+x+1:v+2,_=L+M.length;if(c(g,g+1),c(v,v+2),c(y,y+2),x>=0&&c(v+2,v+2+x+1),k.length>0){let P=/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(k);u(L,_,P?"tategaki-md-image":"tategaki-md-embed",k)}g=y+1;continue}if(b==="["&&!d(g)&&g+1<p&&r[g+1]==="["){let v=g,y=r.indexOf("]]",v+2);if(y===-1)continue;let E=r.slice(v+2,y),x=E.indexOf("|"),S=x>=0?E.slice(0,x):E,w=x>=0?E.slice(x+1):null,k=S.trim(),M=w!==null&&w.length>0?w:S,L=w!==null?v+2+x+1:v+2,_=L+M.length;c(v,v+2),c(y,y+2),x>=0&&c(v+2,v+2+x+1),k.length>0&&u(L,_,"tategaki-md-link",k),g=y+1;continue}if(b==="["&&!d(g)&&g+2<p&&r[g+1]==="^"){let v=r.indexOf("]",g+2);if(v===-1||r.slice(g+2,v).length===0)continue;c(g,g+2),c(v,v+1),u(g+2,v,"tategaki-md-footnote-ref"),g=v;continue}if(b==="["&&!d(g)){if(g>0&&r[g-1]==="!"&&!d(g-1))continue;let v=1,y=-1;for(let k=g+1;k<p;k+=1){let M=r[k];if(M==="\\"&&k+1<p){k+=1;continue}if(M==="["&&!d(k)&&(v+=1),M==="]"&&!d(k)&&(v-=1,v===0)){y=k;break}}if(y===-1)continue;let E=y+1;for(;E<p&&/\s/.test(r[E]);)E+=1;let x=g+1,S=y,w=!1;if(E<p&&r[E]==="("){let k=E,M=1,L=-1;for(let _=k+1;_<p;_+=1){let P=r[_];if(P==="\\"&&_+1<p){_+=1;continue}if(P==="("&&!d(_)&&(M+=1),P===")"&&!d(_)&&(M-=1,M===0)){L=_;break}}if(L!==-1){let _=r.slice(k+1,L),P=h(_);c(g,g+1),c(y,L+1),P.length>0&&u(x,S,"tategaki-md-link",P),g=L,w=!0}}else if(E<p&&r[E]==="["){let k=E,M=r.indexOf("]",k+1);if(M!==-1){let L=r.slice(k+1,M),_=L.length>0?L:r.slice(x,S),P=this.linkReferenceMap.get(this.normalizeLinkLabel(_));P&&(c(g,g+1),c(y,y+1),c(k,M+1),u(x,S,"tategaki-md-link",P),g=M,w=!0)}}else{let k=r.slice(x,S),M=this.linkReferenceMap.get(this.normalizeLinkLabel(k));M&&(c(g,g+1),c(y,y+1),u(x,S,"tategaki-md-link",M),g=y,w=!0)}if(w)continue}if(b==="^"&&!d(g)&&g+1<p&&r[g+1]==="["){let v=-1;for(let y=g+2;y<p;y+=1)if(r[y]==="]"&&!d(y)){v=y;break}if(v===-1)continue;if(v<=g+2){g=v;continue}c(g,g+2),c(v,v+1),u(g+2,v,"tategaki-md-footnote-inline"),g=v;continue}}}let m=[];for(let g of o){let b=Math.max(e,Math.min(g.from,n)),v=Math.max(e,Math.min(g.to,n));v>b&&m.push({from:b,to:v})}o.splice(0,o.length,...m)}collectClearableLinkSpansForLine(e,n){let r=[],o=h=>Math.max(0,Math.min(h,n.length)),s=h=>e+o(h),a=(h,f,p)=>{let m=s(h),g=s(f);if(g<=m)return;let b=p.map(v=>({from:s(v.from),to:s(v.to)})).filter(v=>v.to>v.from);b.length!==0&&r.push({from:m,to:g,markers:b})},l=h=>{let f=0;for(let p=h-1;p>=0&&n[p]==="\\";p-=1)f+=1;return f%2===1},c=h=>{var m;let f=h.trim();if(f.length===0)return"";if(f.startsWith("<")){let g=f.indexOf(">");if(g>1)return f.slice(1,g)}let p=/^[^\s]+/.exec(f);return(m=p==null?void 0:p[0])!=null?m:f},u=null,d=n.length;for(let h=0;h<d;h+=1){let f=n[h];if(f==="`"&&!l(h)){let p=1;for(;h+p<d&&n[h+p]==="`";)p+=1;u===null?u=p:u===p&&(u=null),h+=p-1;continue}if(u===null){if(f==="<"){let p=n.indexOf(">",h+1);if(p>h+1){let m=n.slice(h+1,p);if(!/\s/.test(m)){let g=/^[a-z][a-z0-9+.-]*:\/\//i.test(m),b=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m);if(g||b){a(h+1,p,[{from:h,to:h+1},{from:p,to:p+1}]),h=p;continue}}}}if(f==="!"&&!l(h)&&h+2<d&&n[h+1]==="["&&n[h+2]==="["){let p=h,m=n.indexOf("]]",p+3);if(m===-1)continue;let g=n.slice(p+3,m),b=g.indexOf("|"),v=b>=0?g.slice(0,b):g,y=b>=0?g.slice(b+1):null,E=y!==null&&y.length>0?y:v,x=b>=0?p+3+b+1:p+3,S=x+E.length,w=[{from:p,to:p+3},{from:m,to:m+2}];b>=0&&w.push({from:p+3,to:p+3+b+1}),a(x,S,w),h=m+1;continue}if(f==="["&&!l(h)&&h+1<d&&n[h+1]==="["){let p=h,m=n.indexOf("]]",p+2);if(m===-1)continue;let g=n.slice(p+2,m),b=g.indexOf("|"),v=b>=0?g.slice(0,b):g,y=b>=0?g.slice(b+1):null,E=y!==null&&y.length>0?y:v,x=b>=0?p+2+b+1:p+2,S=x+E.length,w=[{from:p,to:p+2},{from:m,to:m+2}];b>=0&&w.push({from:p+2,to:p+2+b+1}),a(x,S,w),h=m+1;continue}if(f==="["&&!l(h)&&h+2<d&&n[h+1]==="^"){let p=n.indexOf("]",h+2);if(p===-1||n.slice(h+2,p).length===0)continue;a(h+2,p,[{from:h,to:h+2},{from:p,to:p+1}]),h=p;continue}if(f==="["&&!l(h)){if(h>0&&n[h-1]==="!"&&!l(h-1))continue;let p=1,m=-1;for(let E=h+1;E<d;E+=1){let x=n[E];if(x==="\\"&&E+1<d){E+=1;continue}if(x==="["&&!l(E)&&(p+=1),x==="]"&&!l(E)&&(p-=1,p===0)){m=E;break}}if(m===-1)continue;let g=m+1;for(;g<d&&/\s/.test(n[g]);)g+=1;let b=h+1,v=m,y=!1;if(g<d&&n[g]==="("){let E=g,x=1,S=-1;for(let w=E+1;w<d;w+=1){let k=n[w];if(k==="\\"&&w+1<d){w+=1;continue}if(k==="("&&!l(w)&&(x+=1),k===")"&&!l(w)&&(x-=1,x===0)){S=w;break}}if(S!==-1){let w=n.slice(E+1,S);c(w).length>0&&(a(b,v,[{from:h,to:h+1},{from:m,to:S+1}]),h=S,y=!0)}}else if(g<d&&n[g]==="["){let E=g,x=n.indexOf("]",E+1);if(x!==-1){let S=n.slice(E+1,x),w=S.length>0?S:n.slice(b,v);this.linkReferenceMap.get(this.normalizeLinkLabel(w))&&(a(b,v,[{from:h,to:h+1},{from:m,to:m+1},{from:E,to:x+1}]),h=x,y=!0)}}else{let E=n.slice(b,v);this.linkReferenceMap.get(this.normalizeLinkLabel(E))&&(a(b,v,[{from:h,to:h+1},{from:m,to:m+1}]),h=m,y=!0)}if(y)continue}if(f==="!"&&!l(h)&&h+1<d&&n[h+1]==="["){let p=1,m=-1;for(let k=h+2;k<d;k+=1){let M=n[k];if(M==="\\"&&k+1<d){k+=1;continue}if(M==="["&&!l(k)&&(p+=1),M==="]"&&!l(k)&&(p-=1,p===0)){m=k;break}}if(m===-1)continue;let g=m+1;for(;g<d&&/\s/.test(n[g]);)g+=1;if(g>=d||n[g]!=="(")continue;let b=g,v=1,y=-1;for(let k=b+1;k<d;k+=1){let M=n[k];if(M==="\\"&&k+1<d){k+=1;continue}if(M==="("&&!l(k)&&(v+=1),M===")"&&!l(k)&&(v-=1,v===0)){y=k;break}}if(y===-1)continue;let E=h+2,x=m,S=n.slice(b+1,y);if(c(S).length===0)continue;a(E,x,[{from:h,to:h+2},{from:m,to:y+1}]),h=y;continue}if(f==="^"&&!l(h)&&h+1<d&&n[h+1]==="["){let p=-1;for(let m=h+2;m<d;m+=1)if(n[m]==="]"&&!l(m)){p=m;break}if(p===-1)continue;if(p<=h+2){h=p;continue}a(h+2,p,[{from:h,to:h+2},{from:p,to:p+1}]),h=p;continue}}}return r}parseInlineMathSpansForLine(e){let n=[],r=s=>{let a=0;for(let l=s-1;l>=0&&e[l]==="\\";l-=1)a+=1;return a%2===1},o=null;for(let s=0;s<e.length;s+=1){let a=e[s];if(a==="`"&&!r(s)){let u=1;for(;s+u<e.length&&e[s+u]==="`";)u+=1;o===null?o=u:o===u&&(o=null),s+=u-1;continue}if(o!==null||a!=="$"||r(s)||e[s+1]==="$")continue;let l=-1;for(let u=s+1;u<e.length;u+=1)if(e[u]==="$"&&!r(u)&&e[u+1]!=="$"){l=u;break}if(l===-1)continue;let c=e.slice(s+1,l);if(c.trim().length===0){s=l;continue}n.push({open:s,close:l,source:c}),s=l}return n}collectInlineMathMarkerRangesForLine(e,n){let r=this.parseInlineMathSpansForLine(n),o=a=>Math.max(0,Math.min(a,n.length)),s=[];for(let a of r){let l=o(a.open),c=o(a.close),u=e+Math.min(l+1,n.length),d=e+Math.min(c,n.length),h=[{from:e+l,to:e+l+1},{from:e+c,to:e+c+1}];s.push({from:u,to:d,markers:h})}return s}collectInlineMathRangesForLine(e,n,r,o){let s=u=>Math.max(0,Math.min(u,r.length)),a=this.parseInlineMathSpansForLine(r),l=[];for(let u of a){let d=s(u.open),h=s(u.close),f=e+d,p=e+s(h+1);p<=f||(o.push({from:f,to:p}),l.push({kind:"math-inline",from:f,to:p,source:u.source}))}let c=[];for(let u of o){let d=Math.max(e,Math.min(u.from,n)),h=Math.max(e,Math.min(u.to,n));h>d&&c.push({from:d,to:h})}return o.splice(0,o.length,...c),l}getInlineWidgetsForLineRange(e){if(this.plainTextViewEnabled)return[];if(!this.sotEditor)return[];let r=this.sotEditor.getDoc().slice(e.from,e.to);return this.collectInlineMathRangesForLine(e.from,e.to,r,[])}computeBlockLineDecoration(e,n,r,o){var h,f,p,m,g,b,v,y,E,x,S,w,k,M,L,_,P;let s=[],a=[],l={},c={};if(o!==null){if(this.lineHeadingHiddenBy[o]!==null&&!this.isLineInSourceMode(o))return s.push("tategaki-md-heading-hidden"),l.mdKind="heading-hidden",a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c};let I=(h=this.lineBlockKinds[o])!=null?h:"normal";if(I==="math"||I==="math-fence"){let N=this.lineMathBlockStart[o],D=this.lineMathBlockEnd[o];return s.push("tategaki-md-math"),N!==null&&D!==null&&o===N?(s.push("tategaki-md-math-widget"),l.mdKind="math-widget",l.mathRange=`${N}-${D}`):(s.push("tategaki-md-math-hidden"),l.mdKind="math-hidden",N!==null&&D!==null&&(l.mathRange=`${N}-${D}`)),a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c}}if(I==="callout-title"||I==="callout"){let N=this.lineCalloutBlockStart[o],D=this.lineCalloutBlockEnd[o];if(N!==null&&D!==null&&!this.isLineInSourceMode(o)){let R=(f=this.lineCalloutType[o])!=null?f:"note";return s.push("tategaki-md-callout"),l.calloutType=R,l.calloutRange=`${N}-${D}`,a.push({from:e,to:n}),o===N?(s.push("tategaki-md-callout-widget"),l.mdKind="callout-widget"):(s.push("tategaki-md-callout-hidden"),l.mdKind="callout-hidden"),{classes:s,hidden:a,dataset:l,styleVars:c}}}if(I==="table-row"||I==="table-sep"){let N=this.lineTableBlockStart[o],D=this.lineTableBlockEnd[o];if(N!==null&&D!==null&&!this.isLineInSourceMode(o))return s.push("tategaki-md-table"),l.tableRange=`${N}-${D}`,a.push({from:e,to:n}),o===N?(s.push("tategaki-md-table-widget"),l.mdKind="table-widget"):(s.push("tategaki-md-table-hidden"),l.mdKind="table-hidden"),{classes:s,hidden:a,dataset:l,styleVars:c}}if(I==="deflist"){let N=this.lineDeflistBlockStart[o],D=this.lineDeflistBlockEnd[o];if(N!==null&&D!==null&&!this.isLineInSourceMode(o))return s.push("tategaki-md-deflist"),l.deflistRange=`${N}-${D}`,a.push({from:e,to:n}),o===N?(s.push("tategaki-md-deflist-widget"),l.mdKind="deflist-widget"):(s.push("tategaki-md-deflist-hidden"),l.mdKind="deflist-hidden"),{classes:s,hidden:a,dataset:l,styleVars:c}}if(I==="code-fence"){s.push("tategaki-md-codeblock"),s.push("tategaki-md-codeblock-fence"),l.mdKind="code-fence";let N=this.lineCodeFenceInfo[o];N&&(l.codeInfo=N);let D=this.lineCodeBlockPart[o];return D&&s.push(`tategaki-md-codeblock-part-${D}`),a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c}}if(I==="code"){s.push("tategaki-md-codeblock"),s.push("hljs"),l.mdKind="code";let N=this.lineCodeBlockPart[o];return N&&s.push(`tategaki-md-codeblock-part-${N}`),{classes:s,hidden:a,dataset:l,styleVars:c}}if(I==="frontmatter-fence")return s.push("tategaki-md-frontmatter"),s.push("tategaki-md-frontmatter-fence"),l.mdKind="frontmatter-fence",a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c};if(I==="frontmatter")return s.push("tategaki-md-frontmatter"),l.mdKind="frontmatter",{classes:s,hidden:a,dataset:l,styleVars:c}}if(r.length===0)return{classes:s,hidden:a,dataset:l,styleVars:c};{let I=r.match(/^[ \t]*!\[([^\]]*)\]\(([^)]+)\)[ \t]*$/);if(I&&I[0]&&I[2]){let D=(p=I[1])!=null?p:"",R=((m=I[2])!=null?m:"").trim(),A=R.startsWith("<")&&R.endsWith(">")?R.slice(1,-1):R,C=D,O=null;if(D.includes("|")){let[H,K]=D.split("|",2);C=H!=null?H:"";let W=(g=K==null?void 0:K.trim())!=null?g:"";/^\d+$/.test(W)&&(O=W)}return s.push("tategaki-md-image-widget"),l.mdKind="image-widget",l.imageSrc=A,l.imageAlt=C,O&&(l.imageWidth=O),a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c}}let N=r.match(/^[ \t]*!\[\[([^\]]+)\]\][ \t]*$/);if(N&&N[0]&&N[1]){let D=N[1].trim(),R=D.indexOf("|"),A=R>=0?D.slice(0,R).trim():D,C=R>=0?D.slice(R+1).trim():"";if(/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(A))return s.push("tategaki-md-image-widget"),l.mdKind="image-widget",l.imageSrc=A,l.imageAlt="",/^\d+$/.test(C)&&(l.imageWidth=C),a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c}}}{let I=r.match(/^[ \t]*!\[\[([^\]]+)\]\][ \t]*$/);if(I&&I[0]&&I[1]){let N=I[1].trim(),D=N.indexOf("|"),R=D>=0?N.slice(0,D).trim():N;if(!/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(R))return s.push("tategaki-md-embed-widget"),l.mdKind="embed-widget",l.embedTarget=N,a.push({from:e,to:n}),{classes:s,hidden:a,dataset:l,styleVars:c}}}let u=I=>{let N=0;for(let D of I)D==="	"?N+=4:N+=1;return N>=2&&N<4?1:Math.max(0,Math.floor(N/4))},d=I=>{l.listDepth=String(I),c["--tategaki-sot-list-depth"]=String(I)};{let I=r.match(/^(#{1,6})([ \t]+)(.*)$/);if(I){let N=(v=(b=I[1])==null?void 0:b.length)!=null?v:1,D=((E=(y=I[1])==null?void 0:y.length)!=null?E:0)+((S=(x=I[2])==null?void 0:x.length)!=null?S:0);D>0&&a.push({from:e,to:e+D});let R=r.match(/[ \t]+#+[ \t]*$/);if(R&&R.index!==void 0){let A=e+R.index,C=e+r.length;C>A&&a.push({from:A,to:C})}if(s.push("tategaki-md-heading"),s.push(`tategaki-md-heading-${Math.max(1,Math.min(N,6))}`),l.mdKind="heading",l.mdLevel=String(N),o!==null){let A=this.lineHeadingSectionEnd[o];A!==null&&A>o&&(l.headingFoldable="1"),this.collapsedHeadingLines.has(o)&&(l.headingCollapsed="1")}}}if(s.length===0){let I=r.match(/^[ \t]{0,3}((?:> ?)+)(.*)$/);if(I&&I[1]){let N=I[1],D=((w=N.match(/>/g))!=null?w:[]).length,R=r.indexOf(N),A=R+N.length;A>R&&a.push({from:e+R,to:e+A}),s.push("tategaki-md-blockquote"),s.push(`tategaki-md-blockquote-depth-${Math.max(1,D)}`),l.mdKind="blockquote",l.mdDepth=String(D),c["--tategaki-sot-blockquote-depth"]=String(Math.max(0,D-1))}}if(s.length===0){let I=r.match(/^[ \t]*\[\^([^\]]+)\]:[ \t]*/);if(I&&I[0]){let N=I[0].length,D=(k=I[1])!=null?k:"";N>0&&a.push({from:e,to:e+N}),s.push("tategaki-md-footnote-def"),l.mdKind="footnote-def",l.footnoteId=D;let R=this.footnoteDefinitionOrder.get(D);R!==void 0?l.footnoteNumber=String(R):delete l.footnoteNumber}}if(s.length===0){let I=r.match(/^([ \t]*)([-+*])[ \t]+\[([ xX])\][ \t]+/);if(I&&I[0]){let N=I[0].length;a.push({from:e,to:e+N}),s.push("tategaki-md-list"),s.push("tategaki-md-task"),l.mdKind="task";let D=((M=I[3])!=null?M:" ").toLowerCase()==="x";l.taskChecked=D?"1":"0",l.listMarker="",d(u((L=I[1])!=null?L:""))}else{let N=r.match(/^([ \t]*)([-+*])[ \t]+/);if(N&&N[0]&&N[2]){let D=N[0].length;a.push({from:e,to:e+D}),s.push("tategaki-md-list"),l.mdKind="list",l.listMarker="";let R=u((_=N[1])!=null?_:"");d(R),l.listBullet=String(R%2)}else{let D=r.match(/^([ \t]*)(\d{1,9})([.)])[ \t]+/);if(D&&D[0]&&D[1]&&D[2]&&D[3]){let R=D[0].length;a.push({from:e,to:e+R}),s.push("tategaki-md-list"),l.mdKind="olist",l.listMarker=`${D[2]}${D[3]}`,d(u((P=D[1])!=null?P:""))}}}}return s.length===0&&r.match(/^[ \t]*([-*_])(?:[ \t]*\1){2,}[ \t]*$/)&&(a.push({from:e,to:n}),s.push("tategaki-md-hr"),l.mdKind="hr"),{classes:s,hidden:a,dataset:l,styleVars:c}}applyHiddenRangesToSegments(e,n){if(e.length===0||n.length===0)return e;let r=this.mergeRanges(n),o=[],s=0;for(let a of e){let l=a.from;for(;s<r.length&&r[s].to<=l;)s+=1;let c=s;for(;c<r.length;){let u=r[c];if(u.from>=a.to)break;let d=Math.min(a.to,u.from);if(d>l){let h=l-a.from,f=d-a.from,p=a.text.slice(h,f);p.length>0&&o.push({from:l,to:d,text:p,classNames:a.classNames,href:a.href,ruby:a.ruby})}if(l=Math.max(l,u.to),l>=a.to)break;c+=1}if(l<a.to){let u=l-a.from,d=a.text.slice(u);d.length>0&&o.push({from:l,to:a.to,text:d,classNames:a.classNames,href:a.href,ruby:a.ruby})}}return o}rangeOverlapsAny(e,n,r){for(let o of r)if(!(n<=o.from)&&!(e>=o.to))return!0;return!1}collectRubyRangesForLine(e,n,r,o,s,a){var d,h,f;if(!(((d=this.plugin.settings.wysiwyg)==null?void 0:d.enableRuby)!==!1)||!r.includes("\u300A"))return;let c=s.filter(p=>p.className==="tategaki-md-code").map(p=>({from:p.from,to:p.to})),u=jt();for(let p of r.matchAll(u)){let m=(h=p[0])!=null?h:"",g=(f=p.index)!=null?f:-1;if(g<0)continue;let b=m.indexOf("\u300A"),v=m.indexOf("\u300B",b+1);if(b<0||v<0)continue;let y=m.startsWith("|")||m.startsWith("\uFF5C"),E=y?1:0,x=b,S=m.slice(E,x),w=m.slice(b+1,v);if(!S||!w)continue;let k=e+g+E,M=e+g+x;k>=M||k<e||M>n||this.rangeOverlapsAny(k,M,c)||this.rangeOverlapsAny(k,M,o)||this.rangeOverlapsAny(k,M,a)||(y&&o.push({from:e+g,to:e+g+1}),o.push({from:e+g+b,to:e+g+v+1}),a.push({from:k,to:M,ruby:w}))}}applyRubyRangesToSegments(e,n){if(e.length===0||n.length===0)return e;let r=[];for(let s of n)r.push(s.from,s.to);return this.splitSegmentsAtOffsets(e,r).map(s=>{let a=n.find(c=>s.from>=c.from&&s.to<=c.to);if(!a)return s;let l=s.classNames.includes("tategaki-aozora-ruby")?s.classNames:[...s.classNames,"tategaki-aozora-ruby"];return{...s,classNames:l,ruby:a.ruby}})}applyLinkRangesToSegments(e,n){if(e.length===0||n.length===0)return e;let r=[];for(let s of n)r.push(s.from,s.to);return this.splitSegmentsAtOffsets(e,r).map(s=>{let a=n.find(d=>s.from>=d.from&&s.to<=d.to);if(!a)return s;let l=s.classNames.includes("tategaki-md-link"),c=s.classNames.includes("tategaki-md-image")||s.classNames.includes("tategaki-md-embed"),u=l||c?s.classNames:[...s.classNames,"tategaki-md-link"];return{...s,classNames:u,href:a.href}})}buildSegmentsForLine(e,n){var D,R,A;if(!this.sotEditor)return[];let r=this.sotEditor.getDoc(),o=Math.max(0,Math.min(e,r.length)),s=Math.max(o,Math.min(n,r.length));if(o===s)return[];let a=this.findLineIndex(o),l=r.slice(o,s);if(this.plainTextViewEnabled)return l.length===0?[]:[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}];let c=a!==null&&this.isLineInSourceMode(a),u=a!==null&&(D=this.lineBlockKinds[a])!=null?D:"normal",d=a!==null&&(R=this.lineCodeLang[a])!=null?R:null,h=((A=this.plugin.settings.wysiwyg)==null?void 0:A.enableRuby)!==!1,f=this.shouldUseLineCache()&&a!==null;if(f&&a!==null){let C=this.lineSegmentCache.get(a);if(C&&C.from===o&&C.to===s&&C.text===l&&C.kind===u&&C.codeLang===d&&C.isSource===c&&C.rubyEnabled===h)return C.segments}let p=C=>(f&&a!==null&&(this.trimLineCachesIfNeeded(),this.lineSegmentCache.set(a,{from:o,to:s,text:l,kind:u,codeLang:d,isSource:c,rubyEnabled:h,segments:C})),C);if(c)return p([{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}]);let m=this.getCachedBlockLineDecoration(a,o,s,l);if(a!==null){if(u==="code"){let C=d,O=this.buildCodeLineSegments(o,s,l,C);return p(this.applyHiddenRangesToSegments(O,m.hidden))}if(u==="code-fence"||u==="frontmatter"||u==="frontmatter-fence"){let C=[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}];return p(this.applyHiddenRangesToSegments(C,m.hidden))}}let g=this.getEditorViewForSyntax();if(!g){let C=this.buildInlineSegmentsFallback(o,s,l),O=C!=null?C:[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}];return p(this.applyHiddenRangesToSegments(O,m.hidden))}let b=[],v=[],y=[],E=[];for(let C of m.hidden)b.push(C);this.collectLinkRangesForLine(o,s,l,b,v,y),this.collectInlineMathRangesForLine(o,s,l,b);try{(0,_l.syntaxTree)(g.state).iterate({from:o,to:s,enter:C=>{let O=C.type.name;if(this.isMarkdownSyntaxMarkerNode(O)){b.push({from:C.from,to:C.to});return}let H=this.isInlineStyleNode(O);if(H&&(v.push({from:C.from,to:C.to,className:H}),this.pushHiddenMarkersForStyleNode(r,O,C.from,C.to,b),O==="StrongEmphasis")){let K=r.slice(C.from,C.from+3),W=r.slice(C.to-3,C.to);(K==="***"&&W==="***"||K==="___"&&W==="___")&&v.push({from:C.from,to:C.to,className:"tategaki-md-em"})}}})}catch(C){this.collectRubyRangesForLine(o,s,l,b,v,E);let O=this.buildInlineSegmentsFallback(o,s,l),H=O!=null?O:[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}],K=this.applyHiddenRangesToSegments(H,b),W=this.applyLinkRangesToSegments(K,y);return p(this.applyRubyRangesToSegments(W,E))}this.collectRubyRangesForLine(o,s,l,b,v,E);let x=this.buildInlineSegmentsFallback(o,s,l);if(!v.some(C=>C.className!=="tategaki-md-link")&&x){let C=this.applyHiddenRangesToSegments(x,b),O=this.applyLinkRangesToSegments(C,y);return p(this.applyRubyRangesToSegments(O,E))}if(b.length===0&&v.length===0&&E.length===0){let C=[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}];return p(this.applyHiddenRangesToSegments(C,b))}let w=this.mergeRanges(b.map(C=>({from:Math.max(o,Math.min(C.from,s)),to:Math.max(o,Math.min(C.to,s))})).filter(C=>C.to>C.from)),k=new Set([o,s]);for(let C of w)k.add(C.from),k.add(C.to);for(let C of v){let O=Math.max(o,Math.min(C.from,s)),H=Math.max(o,Math.min(C.to,s));H<=O||(k.add(O),k.add(H))}for(let C of E){let O=Math.max(o,Math.min(C.from,s)),H=Math.max(o,Math.min(C.to,s));H<=O||(k.add(O),k.add(H))}let M=Array.from(k).sort((C,O)=>C-O),L=[],_=(C,O)=>{for(let H of w){if(C>=H.from&&O<=H.to)return!0;if(O<=H.from)break}return!1},P=(C,O)=>{let H=["tategaki-sot-run"];for(let K of v)C>=K.from&&O<=K.to&&(H.includes(K.className)||H.push(K.className));return H},I=(C,O)=>{for(let H of y)if(C>=H.from&&O<=H.to)return H.href},N=(C,O)=>{for(let H of E)if(C>=H.from&&O<=H.to)return H.ruby};for(let C=0;C<M.length-1;C+=1){let O=M[C],H=M[C+1];if(H<=O||_(O,H))continue;let K=r.slice(O,H);if(K.length===0)continue;let W=P(O,H),te=N(O,H);te&&!W.includes("tategaki-aozora-ruby")&&W.push("tategaki-aozora-ruby");let J=I(O,H),Q=L[L.length-1];Q&&Q.to===O&&Q.classNames.join("|")===W.join("|")&&Q.href===J&&Q.ruby===te?(Q.to=H,Q.text+=K):L.push({from:O,to:H,text:K,classNames:W,href:J,ruby:te})}return p(L)}buildCodeLineSegments(e,n,r,o){var f;if(r.length===0)return[];let s=[{from:e,to:n,text:r,classNames:["tategaki-sot-run"]}],a=o!=null&&o.trim()?o.trim():null,l;try{a&&le.registered(a)?l=le.highlight(a,r):a?l=le.highlightAuto(r):l=le.highlightAuto(r)}catch(p){return s}let c=[],u=e,d=(p,m)=>{if(p.length===0)return;let g=u,b=Math.min(n,g+p.length);if(b<=g)return;let v=p.slice(0,b-g),y=["tategaki-sot-run",...m];c.push({from:g,to:b,text:v,classNames:y}),u=b},h=(p,m)=>{var b,v,y,E;if(!p)return;let g=p.type;if(g==="text"){d(String((b=p.value)!=null?b:""),m);return}if(g==="element"){let x=(v=p.properties)==null?void 0:v.className,S=Array.isArray(x)?x.map(k=>String(k)):typeof x=="string"?x.split(/\s+/).filter(k=>k.length>0):[],w=m.concat(S);for(let k of(y=p.children)!=null?y:[])h(k,w);return}for(let x of(E=p.children)!=null?E:[])h(x,m)};for(let p of(f=l==null?void 0:l.children)!=null?f:[])h(p,[]);return u!==e+r.length?s:c.length>0?c:s}buildInlineSegmentsFallback(e,n,r){var x;if(!/(\*\*\*|___|\*\*|__|~~|==|`|\*|_)/.test(r))return null;let s=[],a=!1,l=!1,c=!1,u=!1,d=null,h=()=>{let S=["tategaki-sot-run"];return d!==null?(S.push("tategaki-md-code"),S):(a&&S.push("tategaki-md-strong"),l&&S.push("tategaki-md-em"),c&&S.push("tategaki-md-strike"),u&&S.push("tategaki-md-highlight"),S)},f=null,p=[],m=S=>{if(f===null)return;if(S<=f){f=null;return}let w=r.slice(f,S);if(w.length===0){f=null;return}s.push({from:e+f,to:e+S,text:w,classNames:p}),f=null},g=S=>{f===null&&(f=S,p=h())},b=(S,w)=>{let k=0;for(;S+k<r.length&&r[S+k]===w;)k+=1;return k},v=(S,w)=>r.indexOf(S,w)!==-1,y=(S,w,k)=>{for(let M of[3,2,1]){if(k<M)continue;let L=w.repeat(M);if(v(L,S+M))return M}return null},E=0;for(;E<r.length;){let S=(x=r[E])!=null?x:"";if(d===null){if(S==="`"){let w=b(E,"`"),k="`".repeat(w);if(v(k,E+w)){m(E),d=w,E+=w;continue}}else if(S==="~"&&r.slice(E,E+2)==="~~"){if(c||v("~~",E+2)){m(E),c=!c,E+=2;continue}}else if(S==="="&&r.slice(E,E+2)==="=="){if(u||v("==",E+2)){m(E),u=!u,E+=2;continue}}else if(S==="*"||S==="_"){let w=b(E,S),k=null;if(a&&l?w>=3?k=3:w>=2?k=2:k=1:a?w>=2?k=2:v(S,E+1)&&(k=1):l?w>=2&&v(S.repeat(2),E+2)?k=2:k=1:k=y(E,S,w),k!==null&&k>0){m(E),k===3?(a=!a,l=!l):k===2?a=!a:l=!l,E+=k;continue}}}else if(S==="`"){let w=b(E,"`");if(w===d){m(E),d=null,E+=w;continue}}g(E),E+=1}return m(r.length),s.length===0?null:s.filter(S=>S.to>S.from)}getViewType(){return Tt}getDisplayText(){var n,r;let e=this.getFrontmatterTitle(this.currentFile);return e||((r=(n=this.currentFile)==null?void 0:n.basename)!=null?r:"Tategaki")}getFrontmatterTitle(e){var s;if(!e)return null;let n=this.app.metadataCache.getFileCache(e),r=(s=n==null?void 0:n.frontmatter)==null?void 0:s.title;if(r==null)return null;let o=String(r).trim();return o.length>0?o:null}updatePaneHeaderTitle(e=!1){let n=this.getDisplayText();if(!e&&n===this.lastPaneHeaderTitle)return;this.lastPaneHeaderTitle=n;let r=this.containerEl.querySelector(".view-header-title");r&&(r.textContent=n),typeof this.leaf.updateHeader=="function"&&this.leaf.updateHeader()}getCurrentFilePath(){var e,n;return(n=(e=this.currentFile)==null?void 0:e.path)!=null?n:null}getState(){var e,n;return{filePath:(n=(e=this.currentFile)==null?void 0:e.path)!=null?n:void 0,writingMode:this.writingMode}}async setState(e,n){var a;if(!this.isReady){this.pendingState=e;return}let r=this.getEffectiveCommonSettings(this.plugin.settings).writingMode;e!=null&&e.writingMode&&(e.writingMode===r?this.setWritingMode(e.writingMode):this.setWritingMode(r));let o=(a=e==null?void 0:e.filePath)!=null?a:null;if(!o)return;let s=this.app.vault.getAbstractFileByPath(o);s instanceof be.TFile&&await this.openFile(s)}async onOpen(){var h,f;let e=this.leaf[WE];if(!e){window.setTimeout(()=>{try{this.leaf.detach()}catch(p){}},0);return}delete this.leaf[WE];let n=this.containerEl.children[1];this.viewRootEl=n,n.empty(),n.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			min-height: 0;
			overflow: hidden;
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		`;let r=xh,o=()=>{let p=this.containerEl.querySelector(".view-header"),m=p?Math.ceil(p.getBoundingClientRect().height):0;n.style.setProperty("--tategaki-view-header-height",`${m}px`);let g=window.matchMedia(r).matches;n.style.paddingTop=g?"calc(var(--tategaki-safe-area-top, 0px) + var(--tategaki-view-header-height, 0px))":"0px";let b=!1,v=n.ownerDocument.activeElement;v&&n.contains(v)&&(b=v.isContentEditable||v.tagName==="TEXTAREA"||v.tagName==="INPUT"),n.style.paddingBottom=g&&!b?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};o(),window.setTimeout(o,0),this.registerDomEvent(window,"resize",o),this.registerDomEvent(n.ownerDocument,"focusin",o),this.registerDomEvent(n.ownerDocument,"focusout",o),this.registerEscapeGuard(),this.registerEscapeKeymap();let s=this.containerEl.querySelector(".view-header");if(s&&"ResizeObserver"in window){let p=new ResizeObserver(()=>{o()});p.observe(s),this.register(()=>p.disconnect())}let a=n.createDiv("tategaki-sot-toolbar-row");a.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			flex: 0 0 auto;
			padding: 0;
			background: var(--background-secondary);
			border-bottom: 1px solid var(--background-modifier-border);
		`;let l=a.createDiv();l.style.cssText=`
			display: flex;
			align-items: center;
			flex: 1;
			min-width: 0;
		`,this.commandAdapter=this.createCommandAdapter(),this.commandToolbar=new Tl(l,this.commandAdapter),this.register(()=>{var p;(p=this.commandToolbar)==null||p.destroy(),this.commandToolbar=null,this.commandAdapter=null});let c=n.createDiv("tategaki-sot-content");c.style.cssText=`
			position: relative;
			flex: 1 1 auto;
			min-height: 0;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		`,this.pageContainerEl=c.createDiv("tategaki-sot-page-container"),this.pageContainerEl.style.cssText=`
			flex: 1 1 auto;
			min-width: 0;
			min-height: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			box-sizing: border-box;
			overflow: visible;
			padding: 40px 32px 22px 32px;
			background: transparent;
		`,this.borderWrapperEl=this.pageContainerEl.createDiv("tategaki-sot-border-wrapper"),this.borderWrapperEl.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
			min-width: 0;
			min-height: 0;
			border: none !important;
			outline: none !important;
			border-radius: 0;
			background: ${this.plugin.settings.common.backgroundColor} !important;
			box-shadow: 0 6px 12px rgba(0,0,0,0.4);
			box-sizing: border-box;
			overflow: hidden;
			transform-origin: center center;
			transform: scale(1);
		`,this.contentWrapperEl=this.borderWrapperEl.createDiv("tategaki-sot-content-wrapper"),this.contentWrapperEl.style.cssText=`
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: ${this.plugin.settings.common.backgroundColor};
			color: var(--text-normal);
			display: flex;
			flex-direction: column;
			overflow: hidden;
			border: none !important;
			outline: none !important;
		`,this.loadingOverlayEl=this.contentWrapperEl.createDiv("tategaki-sot-loading-overlay");let u=this.loadingOverlayEl.createDiv("tategaki-sot-loading-message");u.textContent="\u8AAD\u307F\u8FBC\u307F\u4E2D\u2026",this.derivedRootEl=this.contentWrapperEl.createDiv("tategaki-sot-derived-root"),this.derivedRootEl.tabIndex=0,this.updateMobileTouchAction(),this.derivedContentEl=this.derivedRootEl.createDiv("tategaki-sot-derived-content"),this.selectionLayerEl=this.derivedRootEl.createDiv("tategaki-sot-selection-layer"),this.caretEl=this.derivedRootEl.createDiv("tategaki-sot-caret"),this.pendingEl=this.derivedRootEl.createDiv("tategaki-sot-pending"),this.overlayImeReplace=new bl({isActive:()=>!this.ceImeMode&&!this.sourceModeEnabled&&this.isNativeSelectionEnabled()&&!!this.sotEditor,getSotSelection:()=>{var p,m;return(m=(p=this.sotEditor)==null?void 0:p.getSelection())!=null?m:{anchor:0,head:0}},getDomSelectionOffsets:()=>{var p,m;return(m=(p=this.nativeSelectionSupport)==null?void 0:p.getSelectionOffsetsFromDom())!=null?m:null}}),this.overlayTextarea=new gl(this.derivedRootEl,{replaceSelection:p=>this.replaceSelection(p),backspace:()=>this.backspace(),del:()=>this.del(),undo:()=>{var p;return(p=this.sotEditor)==null?void 0:p.undo()},redo:()=>{var p;return(p=this.sotEditor)==null?void 0:p.redo()},selectAll:()=>this.selectAllText(),navigate:p=>this.handleNavigate(p),onPendingText:p=>this.updatePendingText(p),cancelSelection:()=>{var p;(p=this.overlayImeReplace)==null||p.cancel(),this.collapseSelectionAfterNativeCancel("overlay-escape")},listOutliner:p=>this.handleListOutlinerKeydown(p),shouldHandleOutlinerKey:p=>this.ceImeMode||this.sourceModeEnabled||p.altKey||p.metaKey||p.ctrlKey?!1:p.key==="Tab",compositionStart:()=>{var p;return(p=this.overlayImeReplace)==null?void 0:p.onCompositionStart()},compositionEnd:()=>{var p;return(p=this.overlayImeReplace)==null?void 0:p.onCompositionEnd()}},{onFocus:()=>{this.overlayFocused=!0,this.suppressNativeSelectionCollapse||this.collapseSelectionAfterNativeCancel("overlay-focus"),this.scheduleSelectionOverlayUpdate()},onBlur:()=>{this.overlayFocused=!1,this.scheduleSelectionOverlayUpdate()}}),this.derivedContentEl&&(this.registerDomEvent(this.derivedContentEl,"beforeinput",p=>this.handleCeBeforeInput(p)),this.registerDomEvent(this.derivedContentEl,"compositionstart",p=>this.handleCeCompositionStart(p)),this.registerDomEvent(this.derivedContentEl,"compositionupdate",p=>this.handleCeCompositionUpdate(p)),this.registerDomEvent(this.derivedContentEl,"compositionend",p=>this.handleCeCompositionEnd(p)),this.registerDomEvent(this.derivedContentEl,"keydown",p=>this.handleCeKeydown(p))),(h=this.derivedContentEl)!=null&&h.ownerDocument&&this.registerDomEvent(this.derivedContentEl.ownerDocument,"selectionchange",()=>this.handleCeSelectionChange()),this.applySettingsToView(this.plugin.settings),this.registerWorkspacePairGuards(),this.applySoTTabBadge(),this.outlinePanel=new xl(c,{getItems:()=>this.getOutlineItems(),onSelect:p=>{this.setSelectionNormalized(p.offset,p.offset),this.scrollToOutlineLine(p.line),this.scheduleCaretUpdate(!0),this.focusInputSurface(!0)},onClose:()=>{this.focusInputSurface(!0)}}),this.selectionOverlay=new Rl({getDerivedRootEl:()=>this.derivedRootEl,getDerivedContentEl:()=>this.derivedContentEl,getSelectionLayerEl:()=>this.selectionLayerEl,getSotEditor:()=>this.sotEditor,isCeImeMode:()=>this.ceImeMode,isNativeSelectionEnabled:()=>this.isNativeSelectionEnabled(),ensureLineRendered:p=>this.ensureLineRendered(p),getPendingSelectionState:()=>({pendingText:this.pendingText,pendingSelectionFrom:this.pendingSelectionFrom}),getLineRanges:()=>this.lineRanges,findLineIndex:p=>this.findLineIndex(p),getLineElement:p=>this.getLineElement(p),getLineTextNodes:p=>this.getLineTextNodes(p),findTextNodeAtOffset:(p,m)=>this.findTextNodeAtOffset(p,m),isPointerSelecting:()=>this.isPointerSelecting,isAutoScrollSelecting:()=>this.autoScrollSelecting}),this.nativeSelectionSupport=new Nl({isEnabled:()=>this.isNativeSelectionEnabled(),isCeImeMode:()=>this.ceImeMode,shouldAllowDomSelection:()=>this.shouldAllowDomSelectAll(),getDerivedContentEl:()=>this.derivedContentEl,getSotEditor:()=>this.sotEditor,getLineRanges:()=>this.lineRanges,findLineIndex:p=>this.findLineIndex(p),getLineElement:p=>this.getLineElement(p),getLineElementForNode:p=>this.getLineElementForNode(p),isSelectionInsideDerivedContent:p=>this.isSelectionInsideDerivedContent(p),ensureLineRendered:p=>this.ensureLineRendered(p),findTextNodeAtOffset:(p,m)=>this.findTextNodeAtOffset(p,m),resolveOffsetFromCaretPosition:(p,m,g)=>this.resolveOffsetFromCaretPosition(p,m,g),setSelectionNormalized:(p,m)=>this.setSelectionNormalized(p,m),applyCutRange:(p,m)=>{var g;this.updatePendingText("",!0),this.immediateRender=!0,(g=this.sotEditor)==null||g.replaceRange(p,m,"")},onSelectionActiveChanged:p=>{var m,g;(m=this.selectionLayerEl)==null||m.replaceChildren(),p?this.updateNativeSelectionLineHints():(this.nativeSelectionAnchorLine=null,this.nativeSelectionHeadLine=null,this.nativeSelectionAnchorLocked=!1,(g=this.renderPipeline)==null||g.resumeVirtualUpdates())}}),this.renderPipeline=new Pl({getDerivedRootEl:()=>this.derivedRootEl,getDerivedContentEl:()=>this.derivedContentEl,getSotEditor:()=>this.sotEditor,getPluginSettings:()=>this.plugin.settings,getHideFrontmatter:()=>this.hideFrontmatter,getWritingMode:()=>this.writingMode,isSelectionActive:()=>{var p,m;return(m=(p=this.nativeSelectionSupport)==null?void 0:p.isSelectionActive())!=null?m:!1},getSelectionHintLines:()=>this.getNativeSelectionHintLines(),resyncSelection:()=>this.resyncNativeSelectionFromSot(),parseFrontmatter:p=>this.parseFrontmatter(p),setFrontmatterDetected:p=>{this.frontmatterDetected=p},computeLineRangesFromLines:p=>this.computeLineRangesFromLines(p),setLineRanges:p=>{this.lineRanges=p},getLineRanges:()=>this.lineRanges,recomputeLineBlockKinds:p=>this.recomputeLineBlockKinds(p),renderFrontmatter:(p,m)=>this.renderFrontmatter(p,m),applyFrontmatterWritingMode:(p,m)=>this.applyFrontmatterWritingMode(p,m),renderLine:(p,m,g)=>this.renderLine(p,m,g),renderLineLight:(p,m,g)=>this.renderLineLight(p,m,g),resetPendingRenderState:()=>this.resetPendingRenderState(),finalizeRender:(p,m)=>this.finalizeRender(p,m)}),this.ceSelectionSync=new Il({isCeImeMode:()=>this.ceImeMode,isCeImeComposing:()=>this.ceImeComposing,isCeImeSelectionSyncing:()=>this.ceImeSelectionSyncing,setCeImeSelectionSyncing:p=>{this.ceImeSelectionSyncing=p},isLeafActive:()=>this.isLeafActive(),getDerivedContentEl:()=>this.derivedContentEl,getSotEditor:()=>this.sotEditor,getLineRanges:()=>this.lineRanges,findLineIndex:p=>this.findLineIndex(p),getLineElement:p=>this.getLineElement(p),ensureLineRendered:p=>this.ensureLineRendered(p),resolveOffsetFromCaretPosition:(p,m,g)=>this.resolveOffsetFromCaretPosition(p,m,g),ensureCeInputPlaceholderNode:p=>this.ensureCeInputPlaceholderNode(p),findTextNodeAtOffset:(p,m)=>this.findTextNodeAtOffset(p,m),setSelectionNormalized:(p,m)=>this.setSelectionNormalized(p,m),recordCeMappingFailure:(p,m)=>this.recordCeMappingFailure(p,m),isSelectionInsideDerivedContent:p=>this.isSelectionInsideDerivedContent(p),getLineElementForNode:p=>this.getLineElementForNode(p),isUnsafeCeSelectionNode:p=>this.isUnsafeCeSelectionNode(p),scheduleCeSafetyCheck:()=>this.scheduleCeSafetyCheck()}),this.pointerHandler=new Ll({getSotEditor:()=>this.sotEditor,getDerivedRootEl:()=>this.derivedRootEl,getDerivedContentEl:()=>this.derivedContentEl,isCeImeMode:()=>this.ceImeMode,isNativeSelectionEnabled:()=>this.isNativeSelectionEnabled(),ensureLineRendered:p=>this.ensureLineRendered(p),getLineVisualRects:p=>this.getLineVisualRects(p),getLineRanges:()=>this.lineRanges,getLocalOffsetFromPoint:(p,m,g,b)=>this.getLocalOffsetFromPoint(p,m,g,b),normalizeOffsetToVisible:(p,m)=>this.normalizeOffsetToVisible(p,m),setSelectionNormalized:(p,m)=>this.setSelectionNormalized(p,m),scheduleCaretUpdate:p=>this.scheduleCaretUpdate(p),updateSelectionOverlay:()=>this.updateSelectionOverlay(),setAutoScrollSelecting:p=>{var m,g;p?this.isNativeSelectionConfigured()&&!this.ceImeMode&&!this.sourceModeEnabled&&this.isPointerSelecting&&!this.scrollbarSelectionHold&&(this.nativeSelectionAssistByAutoScroll=!0,this.autoScrollFast=!1,(m=this.derivedRootEl)==null||m.classList.remove("tategaki-fast-scroll"),this.setNativeSelectionAssistActive(!0,"autoscroll-start")):this.nativeSelectionAssistByAutoScroll&&(this.nativeSelectionAssistByAutoScroll=!1,this.setNativeSelectionAssistActive(!1,"autoscroll-stop")),this.autoScrollSelecting=p,this.shouldSuppressAutoScrollSelectionRenders()?(g=this.selectionLayerEl)==null||g.replaceChildren():this.updateSelectionOverlay()},setAutoScrollFast:p=>{var m;if(this.nativeSelectionAssistByAutoScroll){this.autoScrollFast=!1,(m=this.derivedRootEl)==null||m.classList.remove("tategaki-fast-scroll");return}this.autoScrollFast=p,this.derivedRootEl&&this.derivedRootEl.classList.toggle("tategaki-fast-scroll",p),p&&this.updateFastScrollPlaceholders()},focusInputSurface:p=>this.focusInputSurface(p),syncSelectionToCe:()=>this.syncSelectionToCe(),toggleHeadingFold:p=>this.toggleHeadingFold(p),toggleTaskForLineElement:p=>this.toggleTaskForLineElement(p),openHref:p=>this.openHref(p),getPointerState:()=>({isPointerSelecting:this.isPointerSelecting,pointerSelectAnchor:this.pointerSelectAnchor,pointerSelectPointerId:this.pointerSelectPointerId}),setPointerState:p=>{p.isPointerSelecting!==void 0&&(this.isPointerSelecting=p.isPointerSelecting,p.isPointerSelecting||(this.softSelectionPointerLock=!1)),p.pointerSelectAnchor!==void 0&&(this.pointerSelectAnchor=p.pointerSelectAnchor),p.pointerSelectPointerId!==void 0&&(this.pointerSelectPointerId=p.pointerSelectPointerId)}}),this.registerDomEvent(this.derivedRootEl,"pointerdown",p=>{var y,E,x,S,w,k,M;let m=p,g=this.isPointerOnScrollbar(this.derivedRootEl,m);if(m.button===0&&(this.isNativeSelectionConfigured()&&!this.ceImeMode&&!this.sourceModeEnabled||this.debugNativeSelectionAssist("pointerdown-skipped",{button:m.button,onScrollbar:g,hugeDoc:this.isHugeDocSelection(),reason:this.isNativeSelectionConfigured()?this.ceImeMode?"ce-ime-mode":"source-mode":"not-configured"})),m.button===0&&this.isNativeSelectionConfigured()&&!this.ceImeMode&&!this.sourceModeEnabled){let L=g;this.debugNativeSelectionAssist("pointerdown-evaluated",{button:m.button,onScrollbar:g,hugeDoc:this.isHugeDocSelection(),useNativeAssist:L}),this.setNativeSelectionAssistActive(L,g?"pointerdown-scrollbar":"pointerdown-content")}let b=(E=(y=this.derivedContentEl)==null?void 0:y.ownerDocument.getSelection())!=null?E:null;if(this.nativeContextMenuHold.handlePointerDown({button:m.button,isNativeSelectionEnabled:this.isNativeSelectionEnabled(),isCeImeMode:this.ceImeMode,isSourceMode:this.sourceModeEnabled,isOnScrollbar:g,domSelection:b,isSelectionInsideDerivedContent:L=>this.isSelectionInsideDerivedContent(L),sotSelection:(S=(x=this.sotEditor)==null?void 0:x.getSelection())!=null?S:null})&&(this.suppressNativeSelectionCollapse=!0,this.scheduleSelectionOverlayUpdate()),g?(this.scrollbarSelectionHold=!0,this.suppressNativeSelectionCollapse=!0,this.scheduleSelectionOverlayUpdate()):this.scrollbarSelectionHold=!1,this.softSelectionActive&&m.button===0&&!g&&(this.clearSoftSelection(),this.selectAllActive=!1),!(this.sourceModeEnabled&&this.plainEditOverlayEl&&p.target instanceof Node&&this.plainEditOverlayEl.contains(p.target))){if(this.isNativeSelectionEnabled()&&m.button===0&&!g){let L=(w=m.target)==null?void 0:w.closest(".tategaki-sot-line");if(L){let _=Number.parseInt((k=L.dataset.line)!=null?k:"",10);Number.isFinite(_)&&(this.nativeSelectionAnchorLine=_,this.nativeSelectionHeadLine=_,this.nativeSelectionAnchorLocked=!0)}this.nativeSelectionPendingFocus=!0,L?this.nativeSelectionPendingClick={lineEl:L,clientX:m.clientX,clientY:m.clientY,pointerId:m.pointerId}:this.nativeSelectionPendingClick=null}else this.nativeSelectionPendingFocus=!1,this.nativeSelectionPendingClick=null;this.handleTouchScrollPointerDown(m),(M=this.pointerHandler)==null||M.handlePointerDown(m)}}),this.commandAdapter&&(this.commandContextMenu=new Cl(this.commandAdapter)),this.registerDomEvent(this.derivedRootEl,"contextmenu",p=>{var m;if(!(!this.commandContextMenu||!this.derivedRootEl)){if(fl((m=this.derivedRootEl.ownerDocument.defaultView)!=null?m:window)){p.preventDefault(),p.stopPropagation();return}this.nativeContextMenuHold.shouldFocusRootOnContextMenu()&&this.derivedRootEl.focus({preventScroll:!0}),this.commandContextMenu.show(p)}}),this.registerClipboardHandlers(),this.registerDomEvent(window,"pointermove",p=>{var m;this.handleTouchScrollPointerMove(p),!(this.touchScrollActive&&p.pointerType==="touch")&&((m=this.pointerHandler)==null||m.handlePointerMove(p))}),this.registerDomEvent(window,"pointerup",p=>{var g;this.scrollbarSelectionHold&&this.scheduleSelectionOverlayUpdate(),p.button===0&&this.nativeContextMenuHold.clear()&&this.scheduleSelectionOverlayUpdate();let m=this.touchScrollActive&&p.pointerType==="touch";this.handleTouchScrollPointerUp(p),!m&&((g=this.pointerHandler)==null||g.handlePointerUp(p),this.maybeHandleNativeSelectionWhitespaceClick(p),this.maybeFocusOverlayAfterNativeSelectionPointerUp(),this.flushPendingNativeSelectionSync(!0),p.button===0&&(this.nativeSelectionAssistByAutoScroll=!1,this.setNativeSelectionAssistActive(!1,"pointerup")))}),this.registerDomEvent(window,"pointercancel",p=>{var g;this.scrollbarSelectionHold&&this.scheduleSelectionOverlayUpdate(),p.button===0&&this.nativeContextMenuHold.clear()&&this.scheduleSelectionOverlayUpdate();let m=this.touchScrollActive&&p.pointerType==="touch";this.handleTouchScrollPointerUp(p),!m&&((g=this.pointerHandler)==null||g.handlePointerUp(p),this.maybeHandleNativeSelectionWhitespaceClick(p),this.maybeFocusOverlayAfterNativeSelectionPointerUp(),this.flushPendingNativeSelectionSync(!0),p.button===0&&(this.nativeSelectionAssistByAutoScroll=!1,this.setNativeSelectionAssistActive(!1,"pointercancel")))}),this.registerDomEvent(this.derivedRootEl,"keydown",p=>{var g,b,v,y,E,x,S,w,k,M;let m=p.key;if(!(m==="Meta"||m==="Control"||m==="Shift"||m==="Alt")){if(m==="Escape"){p.preventDefault(),p.stopPropagation(),this.nativeContextMenuHold.clear(),this.pendingNativeSelectionSync=!1,this.clearSelectionChangeDebounceTimer(),this.nativeSelectionAssistByAutoScroll=!1,this.setNativeSelectionAssistActive(!1,"escape"),(g=this.overlayImeReplace)==null||g.cancel(),this.collapseSelectionAfterNativeCancel("escape"),this.focusInputSurface(!0);return}if(this.ceImeMode){this.focusInputSurface(!0);return}if((m==="Backspace"||m==="Delete")&&!((b=this.overlayTextarea)!=null&&b.isFocused())&&this.isNativeSelectionEnabled()&&!this.sourceModeEnabled){let L=(y=(v=this.derivedContentEl)==null?void 0:v.ownerDocument.getSelection())!=null?y:null,_=L&&this.isSelectionInsideDerivedContent(L)&&!L.isCollapsed,P=(E=this.sotEditor)==null?void 0:E.getSelection(),I=!!P&&P.anchor!==P.head;if(_||I){p.preventDefault(),p.stopPropagation(),m==="Backspace"?this.backspace():this.del(),window.requestAnimationFrame(()=>{this.focusInputSurface(!0)});return}}if(this.isNativeSelectionEnabled()&&!((x=this.overlayTextarea)!=null&&x.isFocused())&&!p.metaKey&&!p.ctrlKey&&!p.altKey&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(m)){p.preventDefault(),this.handleNavigate(p),p.shiftKey?this.focusOverlayAfterSelection("shift-arrow"):window.requestAnimationFrame(()=>{this.focusInputSurface(!0)});return}if(!((S=this.overlayTextarea)!=null&&S.isFocused())){if(this.isNativeSelectionEnabled()&&!this.sourceModeEnabled){let L=(k=(w=this.derivedContentEl)==null?void 0:w.ownerDocument.getSelection())!=null?k:null,_=L&&this.isSelectionInsideDerivedContent(L)&&!L.isCollapsed;_&&this.shouldPrepareImeReplaceRange(p)&&((M=this.overlayImeReplace)==null||M.prepareReplaceRange()),_&&(this.suppressNativeSelectionCollapse=!0)}this.focusInputSurface(!0)}}}),this.registerDomEvent(this.derivedRootEl,"scroll",()=>{this.handleRootScroll()}),this.setupWheelScroll(),this.registerEvent(this.app.workspace.on("active-leaf-change",p=>{if(p===this.leaf){this.ceImeSuspended&&(this.ceImeSuspended=!1,this.setCeImeMode(!0)),window.setTimeout(()=>{this.focusInputSurface(!0)},0);return}this.ceImeMode&&this.setCeImeMode(!1,{suspend:!0})})),this.isReady=!0,await this.openFile(e);let d=be.Platform.isMobile||be.Platform.isMobileApp;if(this.setCeImeMode(d),this.focusInputSurface(!0),this.pendingState){let p=this.pendingState;this.pendingState=null;let m=this.getEffectiveCommonSettings(this.plugin.settings).writingMode;p!=null&&p.writingMode&&(p.writingMode===m?this.setWritingMode(p.writingMode):this.setWritingMode(m));let g=(f=p==null?void 0:p.filePath)!=null?f:null;if(g){let b=this.app.vault.getAbstractFileByPath(g);b instanceof be.TFile&&await this.openFile(b)}}}async updateSettings(e){var r;let n=this.hideFrontmatter;this.applySettingsToView(e),(r=this.commandToolbar)==null||r.update(),n!==this.hideFrontmatter?this.scheduleRender(!0):this.scheduleRender()}async onClose(){var e,n,r,o,s;if(this.clearPairedMarkdownBadge(),this.clearSoTTabBadge(),(e=this.renderPipeline)==null||e.dispose(),this.renderPipeline=null,this.resetTouchScrollState(),this.cancelOutlineJump(),this.selectionOverlayRaf!==null&&(window.cancelAnimationFrame(this.selectionOverlayRaf),this.selectionOverlayRaf=null),this.wheelThrottleTimer!==null&&(window.clearTimeout(this.wheelThrottleTimer),this.wheelThrottleTimer=null),this.scrollDebounceTimer!==null&&(window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.scrollDebounceRaf!==null&&(window.cancelAnimationFrame(this.scrollDebounceRaf),this.scrollDebounceRaf=null),this.clearSelectionChangeDebounceTimer(),this.lineModelRecomputeTimer!==null&&(window.clearTimeout(this.lineModelRecomputeTimer),this.lineModelRecomputeTimer=null),this.lineModelRecomputeIdle!==null){let a=window.cancelIdleCallback;a==null||a(this.lineModelRecomputeIdle),this.lineModelRecomputeIdle=null}this.finishRenderMathTimer!==null&&(window.clearTimeout(this.finishRenderMathTimer),this.finishRenderMathTimer=null),this.commitPlainEdit(!0,!1),this.unregisterPlainEditOutsidePointerHandler(),this.destroyPlainEditOverlay(),this.plainEditRange&&(this.clearPlainEditTargets(),this.plainEditRange=null);for(let a of this.embedRenderChildren.values())try{a.unload()}catch(l){}this.embedRenderChildren.clear();for(let a of this.mathRenderChildren.values())try{a.unload()}catch(l){}this.mathRenderChildren.clear();for(let a of this.calloutRenderChildren.values())try{a.unload()}catch(l){}this.calloutRenderChildren.clear();for(let a of this.tableRenderChildren.values())try{a.unload()}catch(l){}this.tableRenderChildren.clear();for(let a of this.deflistRenderChildren.values())try{a.unload()}catch(l){}this.deflistRenderChildren.clear(),(n=this.detachSoTListener)==null||n.call(this),this.detachSoTListener=null,(r=this.overlayTextarea)==null||r.destroy(),this.overlayTextarea=null,this.outlinePanel=null,(o=this.sotEditor)==null||o.destroy(),this.sotEditor=null,(s=this.commandToolbar)==null||s.destroy(),this.commandToolbar=null,this.commandContextMenu=null,this.commandAdapter=null,this.pageContainerEl=null,this.borderWrapperEl=null,this.contentWrapperEl=null,this.derivedContentEl=null,this.selectionLayerEl=null,this.pendingEl=null,this.pendingSpacerEl=null,this.loadingOverlayEl=null,this.currentFile=null,this.pairedMarkdownLeaf=null,this.pairedMarkdownView=null,this.pairedMarkdownBadgeLeaf=null,this.pairedMarkdownBadgeEl=null,this.sotTabBadgeEl=null,this.pairedMismatchNotified=!1,this.suppressPairCheck=!1,this.recentFilePaths=[],this.recentFilePathsInitialized=!1,this.sourceModeEnabled=!1,this.sourceModeLineStart=null,this.sourceModeLineEnd=null,this.plainTextViewEnabled=!1,this.writingMode="vertical-rl",this.isReady=!1}async openFile(e){await this.workspaceController.openFile(e),this.updatePaneHeaderTitle(!0)}registerWorkspacePairGuards(){this.workspaceController.registerWorkspacePairGuards()}updateToolbar(){this.updateWritingModeToggleUi()}registerEscapeGuard(){this.workspaceController.registerEscapeGuard()}isLeafActive(){return this.app.workspace.activeLeaf===this.leaf}isPairedMarkdownLeafActive(){let e=this.getValidPairedMarkdownLeaf();return e?this.app.workspace.activeLeaf===e:!1}registerEscapeKeymap(){this.workspaceController.registerEscapeKeymap()}getValidPairedMarkdownLeaf(){return this.workspaceController.getValidPairedMarkdownLeaf()}runCommand(e,n){let r=()=>{var s;(s=this.commandToolbar)==null||s.update(),this.scheduleCaretUpdate(!0),n!=null&&n.skipFinalizeFocus||this.focusInputSurface(!0)},o;if(this.ceImeMode?this.runCeMutation(()=>{o=e()}):o=e(),o&&typeof o.then=="function")return o.finally(()=>r());r()}wrapCommand(e,n){return()=>this.runCommand(e,n)}createCommandAdapter(){let e=n=>this.wrapCommand(n);return{app:this.app,isReadOnly:()=>!this.sotEditor,hasSelection:()=>this.hasSelection(),isInlineSelectionAllowed:()=>this.isInlineSelectionAllowed(),getWritingMode:()=>this.writingMode,toggleWritingMode:e(()=>this.toggleWritingMode()),toggleBold:e(()=>this.toggleInlineStyle("bold")),isBoldActive:()=>this.isInlineStyleActive("tategaki-md-strong"),toggleItalic:e(()=>this.toggleInlineStyle("italic")),isItalicActive:()=>this.isInlineStyleActive("tategaki-md-em"),toggleStrikethrough:e(()=>this.toggleInlineStyle("strike")),isStrikethroughActive:()=>this.isInlineStyleActive("tategaki-md-strike"),toggleHighlight:e(()=>this.toggleInlineStyle("highlight")),isHighlightActive:()=>this.isInlineStyleActive("tategaki-md-highlight"),toggleInlineCode:e(()=>this.toggleInlineStyle("code")),isInlineCodeActive:()=>this.isInlineStyleActive("tategaki-md-code"),setHeading:n=>this.runCommand(()=>this.setHeading(n)),clearHeading:e(()=>this.clearHeading()),getHeadingLevel:()=>this.getHeadingLevel(),toggleBulletList:e(()=>this.toggleList("bullet")),isBulletListActive:()=>this.isBulletListActive(),toggleOrderedList:e(()=>this.toggleList("ordered")),isOrderedListActive:()=>this.isOrderedListActive(),toggleBlockquote:e(()=>this.toggleBlockquote()),isBlockquoteActive:()=>this.isBlockquoteActive(),toggleCodeBlock:e(()=>this.toggleCodeBlock()),isCodeBlockActive:()=>this.isCodeBlockActive(),insertLink:e(()=>this.insertLink()),insertRuby:e(()=>this.insertRuby()),insertHorizontalRule:e(()=>this.insertHorizontalRule()),openSettings:e(()=>this.openSettingsPanel()),openOutline:()=>this.openOutline(),clearFormatting:e(()=>this.clearFormatting()),toggleRuby:e(()=>this.toggleRubyVisibility()),isRubyEnabled:()=>{var n;return!this.plainTextViewEnabled&&((n=this.plugin.settings.wysiwyg)==null?void 0:n.enableRuby)!==!1},openFileSwitcher:e(()=>this.openFileSwitcher()),toggleReadingMode:e(()=>this.toggleReadingMode()),isReadingMode:()=>!1,undo:e(()=>{var n;return(n=this.sotEditor)==null?void 0:n.undo()}),redo:e(()=>{var n;return(n=this.sotEditor)==null?void 0:n.redo()}),canUndo:()=>!!this.sotEditor,canRedo:()=>!!this.sotEditor,toggleSourceMode:e(()=>this.toggleSourceMode()),isSourceMode:()=>this.sourceModeEnabled,toggleCeImeMode:e(()=>this.toggleCeImeMode()),isCeImeMode:()=>this.ceImeMode,cut:e(()=>this.cutSelection()),copy:e(()=>this.copySelection()),paste:e(()=>this.pasteFromClipboard()),selectAll:this.wrapCommand(()=>this.selectAllText(),{skipFinalizeFocus:!0}),isPlainTextView:()=>this.plainTextViewEnabled,togglePlainTextView:e(()=>this.togglePlainTextView())}}hasSelection(){var n,r,o,s;if(this.softSelectionActive)return!0;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let a=(n=this.plainEditOverlayEl.selectionStart)!=null?n:0,l=(r=this.plainEditOverlayEl.selectionEnd)!=null?r:a;return a!==l}if(this.isNativeSelectionEnabled()&&this.derivedContentEl){let a=this.derivedContentEl.ownerDocument.getSelection();if(!!a&&this.isSelectionInsideDerivedContent(a)&&a&&!a.isCollapsed)return!0;if((this.overlayFocused||this.scrollbarSelectionHold||this.nativeContextMenuHold.isActiveWithSelection((s=(o=this.sotEditor)==null?void 0:o.getSelection())!=null?s:null))&&this.sotEditor){let c=this.sotEditor.getSelection();return c.anchor!==c.head}return!1}if(!this.sotEditor)return!1;let e=this.sotEditor.getSelection();return e.anchor!==e.head}isInlineSelectionAllowed(){var a;if(this.softSelectionActive&&this.sotEditor){let l=this.getSoftSelectionRange();if(!l)return!0;let c=this.findLineIndex(l.from),u=this.findLineIndex(l.to);return c!==null&&u!==null&&c===u}if(this.sourceModeEnabled&&this.plainEditOverlayEl){let l=xn(this.plainEditOverlayEl);return!l||l.start===l.end?!0:!((a=l.text)!=null?a:"").includes(`
`)}if(!this.sotEditor)return!0;let e=this.sotEditor.getSelection();if(e.anchor===e.head)return!0;let n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(n),s=this.findLineIndex(r);return o!==null&&s!==null&&o===s}getSelectionText(){var o;if(this.softSelectionActive&&this.sotEditor){let s=this.getSoftSelectionRange();if(s)return this.sotEditor.getDoc().slice(s.from,s.to)}if(this.sourceModeEnabled&&this.plainEditOverlayEl){let s=xn(this.plainEditOverlayEl);return(o=s==null?void 0:s.text)!=null?o:""}if(!this.sotEditor)return"";let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);return n===r?"":this.sotEditor.getDoc().slice(n,r)}selectAllText(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){this.plainEditOverlayEl.focus({preventScroll:!0}),this.plainEditOverlayEl.select();return}if(this.ceImeMode&&this.derivedContentEl){this.focusInputSurface(!0),document.execCommand("selectAll"),this.selectAllActive=!1,this.clearSoftSelection(),this.scheduleCaretUpdate();return}if(this.isNativeSelectionEnabled()&&this.derivedContentEl&&this.shouldAllowDomSelectAll()){let r=this.derivedContentEl.ownerDocument.getSelection();if(r){let o=this.derivedContentEl.ownerDocument.createRange();o.selectNodeContents(this.derivedContentEl),r.removeAllRanges(),r.addRange(o)}this.selectAllActive=!1,this.clearSoftSelection(),this.scheduleCaretUpdate();return}if(!this.sotEditor)return;let e=this.sotEditor.getDoc().length,n=this.isHugeDocSelection();if(this.selectAllActive=e>=2e5||n,n){this.setSoftSelection(0,e),this.scheduleSelectionOverlayUpdate();return}this.clearSoftSelection(),this.setSelectionNormalized(0,e),this.scheduleCaretUpdate()}async copySelection(){if(this.isNativeSelectionEnabled()){this.ceImeMode&&this.focusInputSurface(!0),document.execCommand("copy");return}let e=this.getSelectionText();if(!e)return;await this.writeTextToClipboard(e)||document.execCommand("copy")}async cutSelection(){if(this.isNativeSelectionEnabled()){this.ceImeMode&&this.focusInputSurface(!0),document.execCommand("cut");return}if(this.sourceModeEnabled&&this.plainEditOverlayEl){let r=this.getSelectionText();if(!r)return;await this.writeTextToClipboard(r)||document.execCommand("copy"),$n(this.plainEditOverlayEl,"",{onResize:()=>this.adjustPlainEditOverlaySize()});return}let e=this.getSelectionText();if(!e)return;await this.writeTextToClipboard(e)||document.execCommand("copy"),this.replaceSelection("")}async pasteFromClipboard(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){let r=await this.readTextFromClipboard();if(!r){this.plainEditOverlayEl.focus({preventScroll:!0}),document.execCommand("paste");return}let o=r.replace(/\r\n/g,`
`).replace(/\r/g,`
`);$n(this.plainEditOverlayEl,o,{onResize:()=>this.adjustPlainEditOverlaySize()});return}if(!this.sotEditor)return;let e=await this.readTextFromClipboard();if(!e){if(this.ceImeMode)return;document.execCommand("paste");return}let n=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(this.ceImeMode){let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);this.applyCeReplaceRange(o,s,n);return}this.updatePendingText("",!0),this.replaceSelection(n)}async writeTextToClipboard(e){var n;if(!e)return!1;if((n=navigator.clipboard)!=null&&n.writeText)try{return await navigator.clipboard.writeText(e),!0}catch(r){console.warn("Tategaki SoT: clipboard write failed",r)}return this.fallbackCopyText(e)}async readTextFromClipboard(){var e;if((e=navigator.clipboard)!=null&&e.readText)try{return await navigator.clipboard.readText()}catch(n){console.warn("Tategaki SoT: clipboard read failed",n)}return""}fallbackCopyText(e){let n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();let r=!1;try{r=document.execCommand("copy")}catch(o){r=!1}return n.remove(),r}toggleInlineStyle(e){if(this.sourceModeEnabled&&this.plainEditOverlayEl)switch(e){case"bold":Or(this.plainEditOverlayEl,"**","**",()=>this.adjustPlainEditOverlaySize());return;case"italic":Or(this.plainEditOverlayEl,"*","*",()=>this.adjustPlainEditOverlaySize());return;case"strike":Or(this.plainEditOverlayEl,"~~","~~",()=>this.adjustPlainEditOverlaySize());return;case"highlight":Or(this.plainEditOverlayEl,"==","==",()=>this.adjustPlainEditOverlaySize());return;case"code":Or(this.plainEditOverlayEl,"`","`",()=>this.adjustPlainEditOverlaySize());return}if(this.sotEditor)switch(e){case"bold":this.toggleInlineMarkup("**","**",[{open:"**",close:"**"},{open:"__",close:"__"}],"tategaki-md-strong");return;case"italic":this.toggleInlineMarkup("*","*",[{open:"*",close:"*"},{open:"_",close:"_"}],"tategaki-md-em",!1);return;case"strike":this.toggleInlineMarkup("~~","~~",[],"tategaki-md-strike");return;case"highlight":this.toggleInlineMarkup("==","==",[],"tategaki-md-highlight");return;case"code":this.toggleInlineMarkup("`","`",[],"tategaki-md-code");return}}clearFormatting(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){EE(this.plainEditOverlayEl,()=>this.adjustPlainEditOverlaySize());return}if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(n===r)return;this.updatePendingText("",!0),this.immediateRender=!0;let o=this.getEditorViewForSyntax(),s=6,a=0,l=!1;for(;a<s;){let c=this.sotEditor.getDoc(),u=this.collectClearFormattingRemovals(n,r,c,o);if(u.length===0)break;l=!0;let d=this.mergeRanges(u).sort((p,m)=>m.from-p.from),h=n,f=r;for(let p of d){let m=p.to-p.from;m<=0||(this.sotEditor.replaceRange(p.from,p.to,""),p.to<=h?(h-=m,f-=m):p.to<=f&&(f-=m))}if(n=h,r=f,a+=1,n===r)break}l&&(this.setSelectionNormalized(n,r),this.focusInputSurface(!0))}collectClearFormattingRemovals(e,n,r,o){let s=this.findLineIndex(e),a=this.findLineIndex(n);if(s===null||a===null)return[];let l=[];for(let c=s;c<=a;c+=1){let u=this.lineRanges[c];if(!u)continue;let d=u.from,h=u.to;if(h<e||d>n)continue;let f=r.slice(d,h),p=this.getCachedBlockLineDecoration(c,d,h,f);for(let b of p.hidden)l.push(b);if(o)try{(0,_l.syntaxTree)(o.state).iterate({from:d,to:h,enter:b=>{let v=b.type.name;if(!(b.to<=e||b.from>=n||b.to<=b.from)){if(this.isMarkdownSyntaxMarkerNode(v)){l.push({from:b.from,to:b.to});return}this.isInlineStyleNode(v)&&this.pushHiddenMarkersForStyleNode(r,v,b.from,b.to,l)}}})}catch(b){}let m=this.collectClearableLinkSpansForLine(d,f);for(let b of m)b.to<=e||b.from>=n||l.push(...b.markers);let g=this.collectInlineMathMarkerRangesForLine(d,f);for(let b of g)b.to<=e||b.from>=n||l.push(...b.markers)}return this.collectInlineStyleRemovalsForRange(e,n,"tategaki-md-strong",[{open:"**",close:"**"},{open:"__",close:"__"}],r,l),this.collectInlineStyleRemovalsForRange(e,n,"tategaki-md-em",[{open:"_",close:"_"},{open:"*",close:"*"}],r,l),this.collectInlineStyleRemovalsForRange(e,n,"tategaki-md-strike",[{open:"~~",close:"~~"}],r,l),this.collectInlineStyleRemovalsForRange(e,n,"tategaki-md-highlight",[{open:"==",close:"=="}],r,l),this.collectInlineStyleRemovalsForRange(e,n,"tategaki-md-code",[{open:"`",close:"`"}],r,l),l}toggleInlineMarkup(e,n,r=[],o,s=!0){var _;if(!this.sotEditor)return;let a=this.sotEditor.getSelection(),l=Math.min(a.anchor,a.head),c=Math.max(a.anchor,a.head),u=a.head>=a.anchor,d=r.length>0?r:[{open:e,close:n}];if(this.updatePendingText("",!0),this.immediateRender=!0,l===c)return;let h=o?this.isInlineStyleActive(o):!1,f=!h&&o?this.hasInlineClassBefore(l,o):!1,p=!h&&o?this.hasInlineClassAfter(c,o):!1,m=l,g=c;if(h&&o){let P=this.stripInlineStyleInSelection(m,g,o,d);if(m=P.from,g=P.to,P.removedOnly){this.setSelectionNormalized(m,g),this.focusInputSurface(!0);return}}let b=this.sotEditor.getDoc();for(let P of d){let I=P.open.length,N=P.close.length;if(!(m<I||g+N>b.length)&&b.slice(m-I,m)===P.open&&b.slice(g,g+N)===P.close){let D=b.slice(m,g);this.sotEditor.replaceRange(m-I,g+N,D);let R=m-I,A=g-I;u?this.setSelectionNormalized(R,A):this.setSelectionNormalized(A,R),this.focusInputSurface(!0);return}}let v=s?(_=this.resolveInlineMarkerPair(b,m,g,d))!=null?_:{open:e,close:n}:{open:e,close:n},y=v.open,E=v.close,x=y.length>0&&y.split("").every(P=>P===y[0])?y[0]:"",S=m,w=g;if(x){let P=this.getMarkerRunLimit(x),I=b,N=this.countMarkerRun(I,S-1,-1,x),D=this.countMarkerRun(I,w,1,x);if(f){let R=y.length;N>=R&&S-R>=0?(this.sotEditor.replaceRange(S-R,S,""),S-=R,w-=R,I=this.sotEditor.getDoc(),D=this.countMarkerRun(I,w,1,x),N=Math.max(0,N-R)):f=!1,f&&(y="")}if(!f&&N+y.length>P)return;if(p){let R=E.length;D>=R&&w+R<=I.length?(this.sotEditor.replaceRange(w,w+R,""),I=this.sotEditor.getDoc(),D=Math.max(0,D-R)):p=!1,p&&(E="")}if(!p&&D+E.length>P)return;b=I}let k=b.slice(S,w);this.sotEditor.replaceRange(S,w,`${y}${k}${E}`);let M=S+y.length,L=M+k.length;u?this.setSelectionNormalized(M,L):this.setSelectionNormalized(L,M),this.focusInputSurface(!0)}applyTextChangesWithSelection(e,n,r){if(!this.sotEditor)return{anchor:n,head:r};let o=e.slice().sort((l,c)=>c.from-l.from),s=n,a=r;for(let l of o){let c=l.insert.length-(l.to-l.from);this.sotEditor.replaceRange(l.from,l.to,l.insert);let u=d=>d>l.to?d+c:d>=l.from?l.from+l.insert.length:d;s=u(s),a=u(a)}return{anchor:s,head:a}}getOutlineItems(){var s,a,l;if(!this.sotEditor)return[];let n=this.sotEditor.getDoc().split(`
`),r=this.lineRanges.length===n.length?this.lineRanges:this.computeLineRangesFromLines(n),o=[];for(let c=0;c<n.length;c+=1){if(this.lineBlockKinds[c]!=="normal")continue;let u=yl((s=n[c])!=null?s:"");if(!u.hasHeading)continue;let d=u.content.length>0?u.content:"\uFF08\u7121\u984C\uFF09",h=(l=(a=r[c])==null?void 0:a.from)!=null?l:0;o.push({line:c,level:u.level,text:d,offset:h})}return o}getHeadingLevel(){if(!this.sotEditor)return 0;let e=this.sotEditor.getSelection(),n=this.findLineIndex(e.head);if(n===null||this.lineBlockKinds[n]!=="normal")return 0;let r=this.lineRanges[n];if(!r)return 0;let o=this.sotEditor.getDoc().slice(r.from,r.to);return yl(o).level}clearHeading(){this.setHeading(0)}getListKindAtSelection(){if(!this.sotEditor)return"none";let e=this.sotEditor.getSelection(),n=this.findLineIndex(e.head);if(n===null||this.isLineInSourceMode(n)||this.lineBlockKinds[n]!=="normal")return"none";let r=this.lineRanges[n];if(!r)return"none";let o=this.sotEditor.getDoc().slice(r.from,r.to);return yt(o).kind}isBlockquoteActive(){if(!this.sotEditor)return!1;let e=this.sotEditor.getSelection(),n=this.findLineIndex(e.head);if(n===null||this.isLineInSourceMode(n)||this.lineBlockKinds[n]!=="normal")return!1;let r=this.lineRanges[n];if(!r)return!1;let o=this.sotEditor.getDoc().slice(r.from,r.to);return kh(o)}isCodeBlockActive(){var o;if(!this.sotEditor)return!1;let e=this.sotEditor.getSelection(),n=this.findLineIndex(e.head);if(n===null)return!1;let r=(o=this.lineBlockKinds[n])!=null?o:"normal";return r==="code"||r==="code-fence"}isBulletListActive(){let e=this.getListKindAtSelection();return e==="bullet"||e==="task"}isOrderedListActive(){return this.getListKindAtSelection()==="ordered"}setHeading(e){if(!this.sotEditor)return;let n=Math.max(0,Math.min(e,6)),r=this.sotEditor.getSelection(),o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head),a=this.findLineIndex(o),l=this.findLineIndex(s);if(a===null||l===null)return;let c=this.lineRanges[l];c&&s===c.from&&s>o&&(l=Math.max(a,l-1));let u=this.sotEditor.getDoc(),d=[];for(let m=a;m<=l;m+=1){if(this.lineBlockKinds[m]!=="normal")continue;let g=this.lineRanges[m];if(!g)continue;let b=u.slice(g.from,g.to),v=yl(b);d.push({index:m,range:g,lineText:b,info:v})}if(d.length===0)return;let h=n===0||d.every(m=>m.info.hasHeading&&m.info.level===n),f=[];for(let m of d){let{range:g,lineText:b,info:v}=m,y=b;if(h)if(v.hasHeading)y=`${v.prefix}${v.content}`;else continue;else{let E=v.content.replace(/^[ \t]+/,"");y=`${v.prefix}${"#".repeat(n)} ${E}`}y!==b&&f.push({from:g.from,to:g.to,insert:y})}if(f.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let p=this.applyTextChangesWithSelection(f,r.anchor,r.head);this.setSelectionNormalized(p.anchor,p.head),this.focusInputSurface(!0)}toggleList(e){if(!this.sotEditor)return;let n=this.sotEditor.getSelection(),r=Math.min(n.anchor,n.head),o=Math.max(n.anchor,n.head),s=this.findLineIndex(r),a=this.findLineIndex(o);if(s===null||a===null)return;let l=this.lineRanges[a];l&&o===l.from&&o>r&&(a=Math.max(s,a-1));let c=this.sotEditor.getDoc(),u=[];for(let m=s;m<=a;m+=1){if(this.lineBlockKinds[m]!=="normal"||this.isLineInSourceMode(m))continue;let g=this.lineRanges[m];if(!g)continue;let b=c.slice(g.from,g.to),v=yt(b);u.push({range:g,lineText:b,info:v})}if(u.length===0)return;let d=m=>e==="bullet"?m.kind==="bullet"||m.kind==="task":m.kind==="ordered",h=u.every(m=>d(m.info)),f=[];for(let m of u){let{range:g,lineText:b,info:v}=m,y=b;if(h){if(!d(v))continue;y=`${v.prefix}${v.indent}${v.content}`}else{let E=e==="bullet"?"- ":"1. ";y=`${v.prefix}${v.indent}${E}${v.content}`}y!==b&&f.push({from:g.from,to:g.to,insert:y})}if(f.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let p=this.applyTextChangesWithSelection(f,n.anchor,n.head);this.setSelectionNormalized(p.anchor,p.head),this.focusInputSurface(!0)}toggleBlockquote(){var f,p,m,g;if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(n),s=this.findLineIndex(r);if(o===null||s===null)return;let a=this.lineRanges[s];a&&r===a.from&&r>n&&(s=Math.max(o,s-1));let l=this.sotEditor.getDoc(),c=[];for(let b=o;b<=s;b+=1){if(this.lineBlockKinds[b]!=="normal"||this.isLineInSourceMode(b))continue;let v=this.lineRanges[b];if(!v)continue;let y=l.slice(v.from,v.to);c.push({range:v,lineText:y})}if(c.length===0)return;let u=c.every(b=>kh(b.lineText)),d=[];for(let b of c){let{range:v,lineText:y}=b,E=y;if(u){let x=y.match(/^([ \t]{0,3})(> ?)(.*)$/);if(!x)continue;E=`${(f=x[1])!=null?f:""}${(p=x[3])!=null?p:""}`}else{let x=y.match(/^([ \t]{0,3})(.*)$/),S=(m=x==null?void 0:x[1])!=null?m:"",w=(g=x==null?void 0:x[2])!=null?g:"";E=`${S}> ${w}`}E!==y&&d.push({from:v.from,to:v.to,insert:E})}if(d.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let h=this.applyTextChangesWithSelection(d,e.anchor,e.head);this.setSelectionNormalized(h.anchor,h.head),this.focusInputSurface(!0)}getCodeBlockRangeForLine(e){var s,a,l;if(e<0||e>=this.lineBlockKinds.length)return null;let n=(s=this.lineBlockKinds[e])!=null?s:"normal";if(n!=="code"&&n!=="code-fence")return null;let r=e;for(;r>0;){let c=(a=this.lineBlockKinds[r-1])!=null?a:"normal";if(c!=="code"&&c!=="code-fence")break;r-=1}let o=e;for(;o+1<this.lineBlockKinds.length;){let c=(l=this.lineBlockKinds[o+1])!=null?l:"normal";if(c!=="code"&&c!=="code-fence")break;o+=1}return{start:r,end:o}}getLineRemovalRange(e,n){let r=this.lineRanges[e];if(!r)return null;let o=r.from,s=r.to;return s<n.length&&n[s]===`
`?s+=1:o>0&&n[o-1]===`
`&&(o-=1),s<=o?null:{from:o,to:s}}toggleCodeBlock(){var h,f,p;if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(n),s=this.findLineIndex(r);if(o===null||s===null)return;let a=this.lineRanges[s];a&&r===a.from&&r>n&&(s=Math.max(o,s-1));let l=this.sotEditor.getDoc(),c=!0;for(let m=o;m<=s;m+=1){let g=(h=this.lineBlockKinds[m])!=null?h:"normal";if(g!=="code"&&g!=="code-fence"){c=!1;break}}let u=[];if(c){let m=o;for(;m<=s;){let g=this.getCodeBlockRangeForLine(m);if(!g){m+=1;continue}if(g.end<o){m=g.end+1;continue}let b=(f=this.lineBlockKinds[g.start])!=null?f:"normal",v=(p=this.lineBlockKinds[g.end])!=null?p:"normal";if(b==="code-fence"){let y=this.getLineRemovalRange(g.start,l);y&&u.push({...y,insert:""})}if(g.end!==g.start&&v==="code-fence"){let y=this.getLineRemovalRange(g.end,l);y&&u.push({...y,insert:""})}m=g.end+1}}else{let m=this.lineRanges[o],g=this.lineRanges[s];if(!m||!g)return;u.push({from:m.from,to:m.from,insert:"```\n"}),u.push({from:g.to,to:g.to,insert:"\n```"})}if(u.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let d=this.applyTextChangesWithSelection(u,e.anchor,e.head);this.setSelectionNormalized(d.anchor,d.head),this.focusInputSurface(!0)}insertLink(){var a;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let c=(a=xn(this.plainEditOverlayEl).text)!=null?a:"";new Yt(this.app,c,u=>{if(u.cancelled||!u.url)return;let d=u.text&&u.text.trim().length>0?u.text:c||u.url;d&&xE(this.plainEditOverlayEl,d,u.url,()=>this.adjustPlainEditOverlaySize())}).open();return}if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=e.head>=e.anchor,s=this.sotEditor.getDoc().slice(n,r);new Yt(this.app,s,l=>{if(l.cancelled||!l.url)return;let c=l.text&&l.text.trim().length>0?l.text:s||l.url;if(!c)return;this.updatePendingText("",!0),this.immediateRender=!0;let u=`[${c}](${l.url})`;this.runCeMutation(()=>{var f;(f=this.sotEditor)==null||f.replaceRange(n,r,u)});let d=n+1,h=d+c.length;o?this.setSelectionNormalized(d,h):this.setSelectionNormalized(h,d),this.focusInputSurface(!0)}).open()}findRubyMatchForSelection(e,n,r,o,s){var l,c;let a=jt();for(let u of s.matchAll(a)){let d=(l=u[0])!=null?l:"",h=(c=u.index)!=null?c:-1;if(!d||h<0)continue;let f=d.indexOf("\u300A"),p=d.lastIndexOf("\u300B");if(f<0||p<=f)continue;let g=d.startsWith("|")||d.startsWith("\uFF5C")?1:0,b=f,v=d.slice(g,b);if(!v)continue;let y=e+h+g,E=e+h+b;if(y>=E||y<e||E>n||!(o>y&&r<E))continue;let S=e+h,w=e+h+d.length;return{rangeFrom:S,rangeTo:w,baseText:v}}return null}buildAozoraRubyText(e,n,r){return r?Array.from(e).map(o=>`\uFF5C${o}\u300A\u30FB\u300B`).join(""):`\uFF5C${e}\u300A${n}\u300B`}insertRuby(){var p;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let g=(p=xn(this.plainEditOverlayEl).text)!=null?p:"";if(!g||g.trim()==="")return;if(g.includes(`
`)){new be.Notice("\u30EB\u30D3\u306F1\u884C\u5185\u306E\u9078\u629E\u306E\u307F\u5BFE\u5FDC\u3057\u3066\u3044\u307E\u3059\u3002",2e3);return}new Xt(this.app,g,b=>{var v;b.cancelled||SE(this.plainEditOverlayEl,g,(v=b.ruby)!=null?v:"",b.isDot,(y,E,x)=>this.buildAozoraRubyText(y,E,x),()=>this.adjustPlainEditOverlaySize())}).open();return}if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(n===r)return;let o=this.sotEditor.getDoc(),s=o.slice(n,r);if(!s||s.trim()==="")return;if(s.includes(`
`)){new be.Notice("\u30EB\u30D3\u306F1\u884C\u5185\u306E\u9078\u629E\u306E\u307F\u5BFE\u5FDC\u3057\u3066\u3044\u307E\u3059\u3002",2e3);return}let a=n,l=r,c=!1,u="",d=this.findLineIndex(n),h=this.findLineIndex(r);if(d!==null&&h===d){let m=this.lineRanges[d];if(m){let g=o.slice(m.from,m.to),b=this.findRubyMatchForSelection(m.from,m.to,n,r,g);b&&(c=!0,a=b.rangeFrom,l=b.rangeTo,u=b.baseText)}}let f=c?u:s;new Xt(this.app,f,m=>{if(m.cancelled)return;if(!m.ruby||m.ruby.trim()===""){if(!c)return;this.updatePendingText("",!0),this.immediateRender=!0;let v=c?u:s;this.runCeMutation(()=>{var E;(E=this.sotEditor)==null||E.replaceRange(a,l,v)});let y=a+v.length;this.setSelectionNormalized(y,y),this.focusInputSurface(!0);return}let g=this.buildAozoraRubyText(f,m.ruby,m.isDot);this.updatePendingText("",!0),this.immediateRender=!0,this.runCeMutation(()=>{var v;(v=this.sotEditor)==null||v.replaceRange(a,l,g)});let b=a+g.length;this.setSelectionNormalized(b,b),this.focusInputSurface(!0)}).open()}insertHorizontalRule(){if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=e.head>=e.anchor,s=n===r?`
---
`:"---";this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(n,r,s);let a=n+s.length;o?this.setSelectionNormalized(a,a):this.setSelectionNormalized(a,a),this.focusInputSurface(!0)}async toggleRubyVisibility(){var r;let n=!(((r=this.plugin.settings.wysiwyg)==null?void 0:r.enableRuby)!==!1);try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableRuby:n}}),new be.Notice(n?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3057\u307E\u3057\u305F\u3002":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3057\u307E\u3057\u305F\u3002",1800)}catch(o){console.error("[Tategaki SoT] Failed to toggle ruby",o),new be.Notice("\u30EB\u30D3\u8868\u793A\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}ensureRecentFilePathsInitialized(){this.workspaceController.ensureRecentFilePathsInitialized()}pushRecentFilePath(e,n=!0){this.workspaceController.pushRecentFilePath(e,n)}recordRecentFile(e){this.workspaceController.recordRecentFile(e)}buildFileSwitchItems(){return this.workspaceController.buildFileSwitchItems()}openFileSwitcher(){this.workspaceController.openFileSwitcher()}openNewNoteModal(e=""){this.workspaceController.openNewNoteModal(e)}async createNewNote(e,n){await this.workspaceController.createNewNote(e,n)}async toggleReadingMode(){let e=this.currentFile;if(!e){new be.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}let n=await this.plugin.modeManager.toggleReadingView(e,{targetLeaf:this.leaf,returnViewMode:"sot"});new be.Notice(n?"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u958B\u304D\u307E\u3057\u305F\u3002":"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u9589\u3058\u307E\u3057\u305F\u3002",2e3)}async switchToFile(e){await this.workspaceController.switchToFile(e)}openSettingsPanel(){new Tn(this.app,this.plugin,async n=>{await this.plugin.updateSettings(n)}).open()}async activateMarkdownLeafForCommand(){var n;if(!this.currentFile)return new be.Notice("\u5BFE\u8C61\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500),null;let e=await this.ensureMarkdownViewForFile(this.currentFile);return!e||!this.pairedMarkdownLeaf?(new be.Notice("MarkdownView \u304C\u898B\u3064\u304B\u3089\u306A\u3044\u305F\u3081\u5B9F\u884C\u3067\u304D\u307E\u305B\u3093\u3002",2500),null):(this.app.workspace.setActiveLeaf(this.pairedMarkdownLeaf,{focus:!0}),(n=e.editor)==null||n.focus(),e)}async openOutline(){if(!this.outlinePanel){new be.Notice("\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3\u3092\u958B\u3051\u307E\u305B\u3093\u3067\u3057\u305F\u3002",2e3);return}this.outlinePanel.toggle()}isInlineStyleActive(e){if(!this.sotEditor)return!1;let n=this.sotEditor.getSelection(),r=Math.min(n.anchor,n.head),o=Math.max(n.anchor,n.head),s=this.sotEditor.getDoc().length,a=Math.max(0,Math.min(r,s)),l=Math.max(0,Math.min(o,s));if(a===l){let d=this.findLineIndex(a);if(d===null)return!1;let h=this.lineRanges[d];if(!h)return!1;let f=this.buildSegmentsForLine(h.from,h.to);for(let p of f)if(a>=p.from&&a<=p.to&&p.classNames.includes(e))return!0;return!1}let c=this.findLineIndex(a),u=this.findLineIndex(l);if(c===null||u===null)return!1;for(let d=c;d<=u;d+=1){let h=this.lineRanges[d];if(!h)continue;let f=Math.max(h.from,a),p=Math.min(h.to,l),m=this.buildSegmentsForLine(h.from,h.to);for(let g of m)if(g.classNames.includes(e)&&!(g.to<=f||g.from>=p))return!0}return!1}stripInlineStyleInSelection(e,n,r,o){if(!this.sotEditor)return{from:e,to:n,removedOnly:!1};let s=this.sotEditor.getDoc(),a=this.findLineIndex(e),l=this.findLineIndex(n);if(a===null||l===null)return{from:e,to:n,removedOnly:!1};let c=o.some(y=>{let E=y.open.length,x=y.close.length;return e<E||n+x>s.length?!1:s.slice(e-E,e)===y.open&&s.slice(n,n+x)===y.close}),u=[],d=!1,h=!1,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY;for(let y=a;y<=l;y+=1){let E=this.lineRanges[y];if(!E)continue;let x=this.buildSegmentsForLine(E.from,E.to),S=null;for(let w of x){let k=Math.max(w.from,e),M=Math.min(w.to,n);M<=k||(w.classNames.includes(r)?(d=!0,f=Math.min(f,k),p=Math.max(p,M),S&&w.from<=S.to?S.to=Math.max(S.to,w.to):(S&&S.to>e&&S.from<n&&this.collectInlineStyleRemoval(s,S,o,u,r),S={from:w.from,to:w.to})):h=!0)}S&&S.to>e&&S.from<n&&this.collectInlineStyleRemoval(s,S,o,u,r)}if(u.length===0)return{from:e,to:n,removedOnly:!1};let m=this.mergeRanges(u).sort((y,E)=>E.from-y.from),g=e,b=n;for(let y of m){let E=y.to-y.from;this.sotEditor.replaceRange(y.from,y.to,""),y.to<=g?(g-=E,b-=E):y.to<=b&&(b-=E)}return{from:g,to:b,removedOnly:c||d&&!h&&f===e&&p===n}}collectInlineStyleRemovalsForRange(e,n,r,o,s,a){let l=this.findLineIndex(e),c=this.findLineIndex(n);if(!(l===null||c===null))for(let u=l;u<=c;u+=1){let d=this.lineRanges[u];if(!d)continue;let h=this.buildSegmentsForLine(d.from,d.to),f=null;for(let p of h){let m=Math.max(p.from,e);Math.min(p.to,n)<=m||p.classNames.includes(r)&&(f&&p.from<=f.to?f.to=Math.max(f.to,p.to):(f&&f.to>e&&f.from<n&&this.collectInlineStyleRemoval(s,f,o,a,r),f={from:p.from,to:p.to}))}f&&f.to>e&&f.from<n&&this.collectInlineStyleRemoval(s,f,o,a,r)}}collectInlineStyleRemoval(e,n,r,o,s){for(let a of r){let l=a.open.length,c=a.close.length;if(!(n.from<l||n.to+c>e.length)&&e.slice(n.from-l,n.from)===a.open&&e.slice(n.to,n.to+c)===a.close){o.push({from:n.from-l,to:n.from}),o.push({from:n.to,to:n.to+c});return}}if(s==="tategaki-md-code"){let a=this.countMarkerRun(e,n.from-1,-1,"`"),l=this.countMarkerRun(e,n.to,1,"`"),c=Math.min(a,l);c>0&&(o.push({from:n.from-c,to:n.from}),o.push({from:n.to,to:n.to+c}))}}resolveInlineMarkerPair(e,n,r,o){for(let s of o){let a=s.open.length;if(n>=a&&e.slice(n-a,n)===s.open)return s}for(let s of o){let a=s.close.length;if(r+a<=e.length&&e.slice(r,r+a)===s.close)return s}return null}hasInlineClassBefore(e,n){var o;let r=this.findSegmentBefore(e);return(o=r==null?void 0:r.classNames.includes(n))!=null?o:!1}hasInlineClassAfter(e,n){var o;let r=this.findSegmentAfter(e);return(o=r==null?void 0:r.classNames.includes(n))!=null?o:!1}findSegmentBefore(e){var s;if(!this.sotEditor||this.lineRanges.length===0)return null;let n=this.sotEditor.getDoc().length,r=Math.max(0,Math.min(e,n)),o=this.findLineIndex(r);o===null&&(o=this.lineRanges.length-1);for(let a=o;a>=0;a-=1){let l=this.lineRanges[a];if(!l)continue;let c=this.buildSegmentsForLine(l.from,l.to);if(c.length!==0)if(a===o)for(let u=c.length-1;u>=0;u-=1){let d=c[u];if(d.to<=r)return d}else return(s=c[c.length-1])!=null?s:null}return null}findSegmentAfter(e){var s;if(!this.sotEditor||this.lineRanges.length===0)return null;let n=this.sotEditor.getDoc().length,r=Math.max(0,Math.min(e,n)),o=this.findLineIndex(r);o===null&&(o=0);for(let a=o;a<this.lineRanges.length;a+=1){let l=this.lineRanges[a];if(!l)continue;let c=this.buildSegmentsForLine(l.from,l.to);if(c.length!==0)if(a===o){for(let u of c)if(u.to>r)return u}else return(s=c[0])!=null?s:null}return null}getMarkerRunLimit(e){switch(e){case"*":case"_":return 3;case"=":return 2;case"`":return 1;case"~":return 2;default:return e.length}}countMarkerRun(e,n,r,o){if(!o)return 0;let s=0,a=n;for(;a>=0&&a<e.length&&e[a]===o;)s+=1,a+=r;return s}toggleSourceMode(){if(this.plainTextViewEnabled){new be.Notice("\u5168\u6587\u30D7\u30EC\u30FC\u30F3\u8868\u793A\u4E2D\u306F\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u3092\u4F7F\u3048\u307E\u305B\u3093\u3002",2500);return}if(this.sourceModeEnabled){this.disablePlainEditMode();return}this.enablePlainEditMode()}updateSourceToggleUi(){var e;(e=this.commandToolbar)==null||e.update()}enablePlainEditMode(){var e,n;this.sourceModeEnabled||(this.sourceModeEnabled=!0,this.syncNativeSelectionDataset(),this.sourceModeLineStart=null,this.sourceModeLineEnd=null,this.ceImeMode&&this.setCeImeMode(!1),(e=this.overlayTextarea)==null||e.setActive(!1),this.updatePendingText("",!0),(n=this.selectionLayerEl)==null||n.replaceChildren(),this.caretEl&&(this.caretEl.style.display="none"),this.ensurePlainEditOverlay(),this.registerPlainEditOutsidePointerHandler(),this.startPlainEditFromSelection(),this.updateSourceToggleUi())}disablePlainEditMode(){var e;this.sourceModeEnabled&&(this.sourceModeEnabled=!1,this.syncNativeSelectionDataset(),this.commitPlainEdit(!0,!0),this.unregisterPlainEditOutsidePointerHandler(),this.plainEditOverlayEl&&(this.plainEditOverlayEl.style.display="none"),(e=this.overlayTextarea)==null||e.setActive(!0),this.caretEl&&(this.caretEl.style.display=""),this.updateSourceToggleUi(),this.scheduleCaretUpdate(!0))}ensurePlainEditOverlay(){this.plainEditController.ensureOverlay()}destroyPlainEditOverlay(){this.plainEditController.destroyOverlay()}adjustPlainEditOverlaySize(){this.plainEditController.adjustOverlaySize()}handlePlainEditArrowKey(e){return this.plainEditController.handleArrowKey(e)}handlePlainEditEnter(){return this.plainEditController.handleEnter()}handlePlainEditBackspace(){return this.plainEditController.handleBackspace()}handlePlainEditDelete(){return this.plainEditController.handleDelete()}applyPlainEditRangeReplacement(e,n,r,o){this.plainEditController.applyRangeReplacement(e,n,r,o)}clearPlainEditTargets(){this.plainEditController.clearTargets()}applyPlainEditTargetClass(e,n){this.plainEditController.applyTargetClass(e,n)}applyPlainEditTargets(e){this.plainEditController.applyTargets(e)}getPlainEditRangeFromSelection(){return this.plainEditController.getRangeFromSelection()}getPlainEditBlockLineRange(e){return this.plainEditController.getBlockLineRange(e)}updatePlainEditOverlayPosition(e){this.plainEditController.updateOverlayPosition(e)}startPlainEditFromSelection(){this.plainEditController.startFromSelection()}commitPlainEdit(e,n){this.plainEditController.commit(e,n)}registerPlainEditOutsidePointerHandler(){this.plainEditController.registerOutsidePointerHandler()}unregisterPlainEditOutsidePointerHandler(){this.plainEditController.unregisterOutsidePointerHandler()}toggleCeImeMode(){this.setCeImeMode(!this.ceImeMode)}setCeImeMode(e,n={}){var o,s,a,l;if(this.ceImeMode===e)return;if(e&&this.sourceModeEnabled&&this.disablePlainEditMode(),n.suspend?e||(this.ceImeSuspended=!0):this.ceImeSuspended=!1,this.ceImeMode=e,e?this.ensureCeTrailingNewline():n.suspend||this.cleanupCeTrailingNewline(),e){if(this.lineModelRecomputeTimer!==null&&(window.clearTimeout(this.lineModelRecomputeTimer),this.lineModelRecomputeTimer=null),this.lineModelRecomputeIdle!==null){let c=window.cancelIdleCallback;c==null||c(this.lineModelRecomputeIdle),this.lineModelRecomputeIdle=null}}else this.lineModelRecomputeStart!==null&&this.lineModelRecomputeEnd!==null&&this.scheduleLineModelRecompute(this.lineModelRecomputeStart,this.lineModelRecomputeEnd);this.derivedRootEl&&(e?this.derivedRootEl.setAttribute("data-ce-ime","1"):this.derivedRootEl.removeAttribute("data-ce-ime")),e&&(this.ceImeFallbackActive=!1,this.ceImeMappingFailureCount=0,this.ceImeMappingFailureAt=0),this.ceImeComposing=!1,this.ceImeSelectionSyncing=!1,this.ceImeLastCompositionText="",this.ceImeLastBeforeInputText="",this.ceImeCompositionSelection=null,this.ceImeIgnoreNextInput=!1,this.ceImeActiveComposeId=null,this.ceImeAppliedComposeId=0,this.isPointerSelecting=!1,this.pointerSelectAnchor=null,this.pointerSelectPointerId=null,this.autoScrollSelecting=!1,this.autoScrollFast=!1,this.softSelectionPointerLock=!1,this.nativeSelectionAssistByAutoScroll=!1,this.setNativeSelectionAssistActive(!1,"setCeImeMode"),this.derivedRootEl&&this.derivedRootEl.classList.remove("tategaki-fast-scroll"),this.updateSelectionOverlay(),this.derivedContentEl&&(this.derivedContentEl.contentEditable=e?"true":"false",this.derivedContentEl.spellcheck=!1,this.derivedContentEl.setAttribute("autocapitalize","off"),this.derivedContentEl.setAttribute("autocomplete","off"),this.derivedContentEl.setAttribute("autocorrect","off"),e||this.derivedContentEl.style.removeProperty("caret-color"),e&&(this.derivedContentEl.tabIndex=0),e?(this.applyCeEditableDefaults(),this.updateCeEditableRangeFromSelection()):this.applyCeEditableDefaults());let r=!n.suspend&&this.isLeafActive();e?((o=this.overlayTextarea)==null||o.setActive(!1),this.overlayFocused=!1,this.updatePendingText("",!0),(s=this.selectionLayerEl)==null||s.replaceChildren(),this.caretEl&&(this.caretEl.style.display="none"),this.syncSelectionToCe(),this.derivedContentEl&&this.derivedContentEl.querySelectorAll(".tategaki-sot-line").forEach(c=>this.applyCeNonEditableMarkers(c)),r&&this.focusInputSurface(!0)):((a=this.overlayTextarea)==null||a.setActive(!0),r&&this.focusInputSurface(!0)),(l=this.commandToolbar)==null||l.update(),this.scheduleCaretUpdate(!0)}focusInputSurface(e=!0){var n;if(this.sourceModeEnabled&&this.plainEditOverlayEl){try{this.plainEditOverlayEl.focus({preventScroll:e})}catch(r){this.plainEditOverlayEl.focus()}return}if(this.ceImeMode){if(!this.derivedContentEl||!this.isLeafActive())return;try{this.derivedContentEl.focus({preventScroll:e})}catch(r){this.derivedContentEl.focus()}return}(n=this.overlayTextarea)==null||n.focus(e)}focusOverlayAfterSelection(e){var n;this.isNativeSelectionEnabled()&&(this.ceImeMode||this.sourceModeEnabled||(n=this.overlayTextarea)!=null&&n.isFocused()||this.sotEditor&&(this.suppressNativeSelectionCollapse=!0,this.focusInputSurface(!0)))}maybeFocusOverlayAfterNativeSelectionPointerUp(){var n;if(!this.nativeSelectionPendingFocus||(this.nativeSelectionPendingFocus=!1,!this.isNativeSelectionEnabled())||this.ceImeMode||this.sourceModeEnabled||!this.derivedContentEl||!this.isLeafActive())return;let e=(n=this.derivedContentEl.ownerDocument.getSelection())!=null?n:null;if(this.isSelectionInsideDerivedContent(e)){if(e&&!e.isCollapsed){this.focusOverlayAfterSelection("pointerup-selection");return}this.collapseSelectionAfterNativeCancel("pointerup"),window.requestAnimationFrame(()=>{this.focusInputSurface(!0)})}}maybeHandleNativeSelectionWhitespaceClick(e){var d,h;if(!this.isNativeSelectionEnabled()||this.ceImeMode||this.sourceModeEnabled||!this.nativeSelectionPendingClick)return;let n=this.nativeSelectionPendingClick;if(this.nativeSelectionPendingClick=null,n.pointerId!==e.pointerId||!n.lineEl.isConnected)return;let r=this.derivedContentEl;if(!r)return;let o=r.ownerDocument.getSelection();if(!o||!this.isSelectionInsideDerivedContent(o)||!o.isCollapsed)return;let s=Number.parseInt((d=n.lineEl.dataset.from)!=null?d:"0",10),a=Number.parseInt((h=n.lineEl.dataset.to)!=null?h:"0",10);if(!Number.isFinite(s)||!Number.isFinite(a))return;let l=Math.max(0,a-s),c=this.getLocalOffsetFromPoint(n.lineEl,n.clientX,n.clientY,l);if(c===null||c!==l)return;let u=s+c;this.setSelectionNormalized(u,u),this.pendingCaretScroll=!0,this.scheduleCaretUpdate(!0)}runCeMutation(e){if(!this.ceImeMode){e();return}this.ceImeApplying=!0,this.markCeExternalSuppress();try{e()}finally{this.ceImeApplying=!1}}markCeExternalSuppress(e=250){let n=Date.now()+e;n>this.ceImeExternalSuppressUntil&&(this.ceImeExternalSuppressUntil=n)}recordCeMappingFailure(e,n=!1){if(!this.ceImeMode||this.ceImeFallbackActive)return;let r=Date.now();if(r-this.ceImeMappingFailureAt>1200&&(this.ceImeMappingFailureCount=0),this.ceImeMappingFailureAt=r,this.ceImeMappingFailureCount+=1,n||this.ceImeMappingFailureCount>=3){this.ceImeFallbackActive=!0,this.setCeImeMode(!1);let o=e;e==="selection"?o="\u9078\u629E\u306E\u5FA9\u5143\u306B\u5931\u6557":e==="external"?o="\u5916\u90E8\u66F4\u65B0\u3092\u691C\u77E5":e==="verification"&&(o="\u30AD\u30E3\u30EC\u30C3\u30C8\u6574\u5408\u6027\u30C1\u30A7\u30C3\u30AF"),new be.Notice(`CE\u88DC\u52A9\u30E2\u30FC\u30C9\u3092\u4E00\u6642\u505C\u6B62\u3057\u307E\u3057\u305F (${o})`,2500)}}isSelectionInsideDerivedContent(e){if(!e||!this.derivedContentEl)return!1;let n=e.anchorNode,r=e.focusNode;if(!n||!r)return!1;let o=n instanceof Element?n:n.parentElement,s=r instanceof Element?r:r.parentElement;return!o||!s?!1:this.derivedContentEl.contains(o)&&this.derivedContentEl.contains(s)}getLineElementForNode(e){var r;if(!e||!this.derivedContentEl)return null;let n=e instanceof Element?e:(r=e.parentElement)!=null?r:null;return!n||!this.derivedContentEl.contains(n)?null:n.closest(".tategaki-sot-line")}syncSelectionFromCe(){var e,n;return this.ceImeMode&&this.selectAllActive&&this.sotEditor?{anchor:0,head:this.sotEditor.getDoc().length}:(n=(e=this.ceSelectionSync)==null?void 0:e.syncSelectionFromCe())!=null?n:null}syncSelectionToCe(){var e;(e=this.ceSelectionSync)==null||e.syncSelectionToCe()}applyCeEditableDefaults(){if(!this.derivedContentEl)return;let e=Array.from(this.derivedContentEl.children);for(let n of e)n.classList.contains("tategaki-sot-line")&&n.setAttribute("contenteditable","false");this.ceEditableStart=null,this.ceEditableEnd=null}setCeEditableRange(e,n){if(!this.ceImeMode||!this.derivedContentEl)return;let r=Math.max(0,Math.min(e,n)),o=Math.max(e,n);if(this.ceEditableStart===r&&this.ceEditableEnd===o){let s=this.getLineElement(r);s&&this.ensureLineRendered(s);let a=o!==r?this.getLineElement(o):null;a&&this.ensureLineRendered(a);return}if(this.ceEditableStart!==null&&this.ceEditableEnd!==null){let s=Math.max(0,Math.min(this.ceEditableStart,this.ceEditableEnd)),a=Math.max(this.ceEditableStart,this.ceEditableEnd);for(let l=s;l<=a;l+=1){let c=this.getLineElement(l);c&&c.setAttribute("contenteditable","false")}}for(let s=r;s<=o;s+=1){let a=this.getLineElement(s);a&&(this.ensureLineRendered(a),a.setAttribute("contenteditable","true"),this.applyCeNonEditableMarkers(a))}this.ceEditableStart=r,this.ceEditableEnd=o}updateCeEditableRangeFromSelection(){if(!this.ceImeMode||!this.sotEditor)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(n),s=this.findLineIndex(r);if(o===null||s===null)return;let a=Math.max(0,r-n),l=Math.abs(s-o);if(!(a>=2e5||l>=2e3)){if(o===s){let c=this.getParagraphLineRangeForOffsets(n,r);if(c){this.setCeEditableRange(c.start,c.end);return}}this.setCeEditableRange(o,s)}}ensureCeTrailingNewline(){if(!this.sotEditor)return;let e=this.sotEditor.getDoc();if(e.endsWith(`
`))return;let n=e.length,r=Math.max(0,n-64);this.ceImeAutoTrailingNewline=!0,this.ceImeAutoTrailingNewlineBaseLength=n,this.ceImeAutoTrailingNewlineTail=e.slice(r),this.runCeMutation(()=>{var o;(o=this.sotEditor)==null||o.replaceRange(n,n,`
`)})}cleanupCeTrailingNewline(){if(!this.sotEditor||!this.ceImeAutoTrailingNewline)return;this.ceImeAutoTrailingNewline=!1;let e=this.sotEditor.getDoc(),n=this.ceImeAutoTrailingNewlineBaseLength,r=n+1;if(e.length!==r||!e.endsWith(`
`))return;let o=Math.max(0,n-64);e.slice(o,n)===this.ceImeAutoTrailingNewlineTail&&this.sotEditor.replaceRange(e.length-1,e.length,"")}getParagraphLineRangeForOffsets(e,n){let r=this.findLineIndex(e),o=this.findLineIndex(n);if(r===null||o===null)return null;let s=Math.min(r,o),a=Math.max(r,o);for(;s>0;){let l=this.lineRanges[s-1];if(!l||l.to-l.from===0)break;s-=1}for(;a<this.lineRanges.length-1;){let l=this.lineRanges[a+1];if(!l||l.to-l.from===0)break;a+=1}return{start:s,end:a}}scheduleCeParagraphRerender(e,n,r=null){if(!this.ceImeMode)return;let o=this.getParagraphLineRangeForOffsets(e,n);o&&(this.ceImeSelectionChangeSuppressedUntil=Date.now()+120,window.requestAnimationFrame(()=>{this.ceImeMode&&(this.ceImeSelectionChangeSuppressedUntil=Date.now()+120,this.rerenderLineRange(o.start,o.end),r!==null&&this.setSelectionRawClamped(r,r),this.syncSelectionToCe())}))}setSelectionRawClamped(e,n){if(!this.sotEditor)return;let r=this.sotEditor.getDoc().length,o=Math.max(0,Math.min(e,r)),s=Math.max(0,Math.min(n,r));this.sotEditor.setSelection({anchor:o,head:s})}applyCeReplaceRange(e,n,r){if(!this.sotEditor)return;let o=Math.min(e,n),s=Math.max(e,n);this.updatePendingText("",!0),this.immediateRender=!0,this.runCeMutation(()=>{var a;(a=this.sotEditor)==null||a.replaceRange(o,s,r)}),this.scheduleCeParagraphRerender(o,s,o+r.length)}applyCeNonEditableMarkers(e){if(!this.ceImeMode)return;let n=e.querySelectorAll(".tategaki-sot-eol, .tategaki-sot-pending-spacer");for(let o of Array.from(n)){let s=o;s.setAttribute("contenteditable","false"),s.setAttribute("aria-hidden","true"),s.tabIndex=-1}let r=e.querySelectorAll(".tategaki-md-inline-widget");for(let o of Array.from(r))o.setAttribute("contenteditable","false")}applyCeEditableState(e,n){if(!this.ceImeMode){e.setAttribute("contenteditable","false");return}if(n===null||this.ceEditableStart===null||this.ceEditableEnd===null){e.setAttribute("contenteditable","false");return}let r=Math.min(this.ceEditableStart,this.ceEditableEnd),o=Math.max(this.ceEditableStart,this.ceEditableEnd),s=n>=r&&n<=o;e.setAttribute("contenteditable",s?"true":"false")}handleCeBeforeInput(e){var n;if(!(!this.ceImeMode||!this.sotEditor)&&this.derivedContentEl&&!(e.target&&!this.derivedContentEl.contains(e.target))){if(this.ceImeIgnoreNextInput&&e.inputType==="insertText"){e.preventDefault(),e.stopPropagation(),this.ceImeIgnoreNextInput=!1;return}if(this.ceImeComposing||e.isComposing){e.inputType==="insertCompositionText"&&typeof e.data=="string"&&(this.ceImeLastBeforeInputText=e.data);return}if(e.inputType==="insertCompositionText"||e.inputType==="deleteCompositionText"){e.preventDefault(),e.stopPropagation();return}switch(e.inputType){case"insertText":case"insertReplacementText":{e.preventDefault(),e.stopPropagation();let r=(n=e.data)!=null?n:"";if(r.length===0)return;let o=this.syncSelectionFromCe();if(!o)return;let s=Math.min(o.anchor,o.head),a=Math.max(o.anchor,o.head);this.applyCeReplaceRange(s,a,r);return}case"insertLineBreak":case"insertParagraph":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);this.runCeMutation(()=>this.replaceSelection(`
`)),this.scheduleCeParagraphRerender(o,s,o+1);return}case"deleteContentBackward":case"deleteWordBackward":case"deleteSoftLineBackward":case"deleteHardLineBackward":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);if(o!==s){this.applyCeReplaceRange(o,s,"");return}if(o<=0)return;this.applyCeReplaceRange(o-1,o,"");return}case"deleteContentForward":case"deleteWordForward":case"deleteSoftLineForward":case"deleteHardLineForward":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);if(o!==s){this.applyCeReplaceRange(o,s,"");return}let a=this.sotEditor.getDoc().length;if(o>=a)return;this.applyCeReplaceRange(o,o+1,"");return}case"deleteByCut":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);this.applyCeReplaceRange(o,s,"");return}case"insertFromPaste":case"insertFromDrop":{e.preventDefault(),e.stopPropagation();return}case"historyUndo":{e.preventDefault(),e.stopPropagation(),this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.undo()});return}case"historyRedo":{e.preventDefault(),e.stopPropagation(),this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.redo()});return}default:return}}}handleCeCompositionStart(e){var r;if(!this.ceImeMode)return;this.ceImeComposing=!0,this.ceImeComposeId+=1,this.ceImeActiveComposeId=this.ceImeComposeId,this.ceImeLastCompositionText=(r=e.data)!=null?r:"",this.ceImeLastBeforeInputText="";let n=this.syncSelectionFromCe();if(n){let o=Math.min(n.anchor,n.head),s=Math.max(n.anchor,n.head);this.ceImeCompositionSelection={from:o,to:s}}else this.ceImeCompositionSelection=null;this.scheduleCaretUpdate(!0)}handleCeCompositionUpdate(e){var n;this.ceImeMode&&(this.ceImeLastCompositionText=(n=e.data)!=null?n:"")}handleCeCompositionEnd(e){if(!this.ceImeMode)return;if(this.ceImeComposing=!1,this.ceImeActiveComposeId!==null&&this.ceImeAppliedComposeId===this.ceImeActiveComposeId){this.ceImeActiveComposeId=null;return}let n=(()=>e.data!==null&&e.data!==void 0?e.data:this.ceImeLastBeforeInputText.length>0?this.ceImeLastBeforeInputText:this.ceImeLastCompositionText.length>0?this.ceImeLastCompositionText:"")();this.ceImeLastCompositionText="",this.ceImeLastBeforeInputText="",this.ceImeIgnoreNextInput=!0,window.setTimeout(()=>{this.ceImeIgnoreNextInput=!1},0);let r=this.ceImeCompositionSelection;if(!r){let o=this.syncSelectionFromCe();o&&(r={from:Math.min(o.anchor,o.head),to:Math.max(o.anchor,o.head)})}this.ceImeCompositionSelection=null,r&&(this.ceImeActiveComposeId!==null&&(this.ceImeAppliedComposeId=this.ceImeActiveComposeId,this.ceImeActiveComposeId=null),this.applyCeReplaceRange(r.from,r.to,n),this.scheduleCaretUpdate(!0))}handleCeKeydown(e){if(!this.ceImeMode)return;if(!(e.metaKey||e.ctrlKey)){if(e.altKey||e.isComposing||this.ceImeComposing)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"){e.preventDefault(),e.stopPropagation(),this.handleNavigate(e),this.ceImeMode&&this.syncSelectionToCe();return}return}if(e.key==="z"||e.key==="Z"){e.preventDefault(),e.stopPropagation(),e.shiftKey?this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.redo()}):this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.undo()});return}(e.key==="y"||e.key==="Y")&&(e.preventDefault(),e.stopPropagation(),this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.redo()}))}handleListOutlinerKeydown(e){if(this.ceImeMode||this.sourceModeEnabled)return!1;let n=this.getListOutlinerHost();return n?mE(n,e):!1}runListOutlinerAction(e){if(this.ceImeMode||this.sourceModeEnabled)return!1;let n=this.getListOutlinerHost();return n?gE(n,e):!1}getListOutlinerHost(){let e=this.sotEditor;return e?{getDoc:()=>e.getDoc(),getSelection:()=>e.getSelection(),getLineRanges:()=>this.lineRanges,getLineBlockKinds:()=>this.lineBlockKinds,replaceRange:(n,r,o)=>{e.replaceRange(n,r,o)},updatePendingText:(n,r)=>this.updatePendingText(n,r),setSelectionNormalized:(n,r)=>this.setSelectionNormalized(n,r),setSelectionRaw:(n,r)=>{e.setSelection({anchor:n,head:r})},focusInputSurface:n=>this.focusInputSurface(!!n),getWritingMode:()=>this.derivedRootEl?window.getComputedStyle(this.derivedRootEl).writingMode:this.writingMode,markImmediateRender:()=>{this.immediateRender=!0}}:null}handleCeSelectionChange(){var r,o,s,a,l,c;if(this.ceImeMode&&Date.now()<this.ceImeSelectionChangeSuppressedUntil)return;let e=this.isNativeSelectionEnabled();if(!this.ceImeMode&&!e)return;let n=(o=(r=this.derivedContentEl)==null?void 0:r.ownerDocument.getSelection())!=null?o:null;if(!this.ceImeMode&&e&&(n!=null&&n.isCollapsed)){if(this.nativeContextMenuHold.shouldSkipNativeCollapse((a=(s=this.sotEditor)==null?void 0:s.getSelection())!=null?a:null))return;if(this.suppressNativeSelectionCollapse){this.suppressNativeSelectionCollapse=!1;return}this.collapseSelectionAfterNativeCancel("selectionchange")}if(!this.ceImeMode&&e){let u=(c=(l=this.derivedContentEl)==null?void 0:l.ownerDocument.getSelection())!=null?c:null;if(!!u&&!u.isCollapsed){this.schedulePendingNativeSelectionSync();return}this.pendingNativeSelectionSync=!1,this.clearSelectionChangeDebounceTimer()}this.runCeSelectionChange()}runCeSelectionChange(){var e,n;(e=this.nativeSelectionSupport)==null||e.handleSelectionChange(),this.updateNativeSelectionLineHints(),this.ceImeMode&&this.selectAllActive&&!this.ceImeSelectionSyncing&&(this.selectAllActive=!1),(n=this.ceSelectionSync)==null||n.handleCeSelectionChange(),this.updateCeEditableRangeFromSelection()}resyncNativeSelectionFromSot(){var n;if(!this.isNativeSelectionEnabled()||!((n=this.nativeSelectionSupport)!=null&&n.isSelectionActive())||!this.sotEditor)return;let e=this.sotEditor.getSelection();this.nativeSelectionSupport.syncDomSelectionFromSot(e.anchor,e.head)}attachSoTEditor(e){var n,r;(n=this.detachSoTListener)==null||n.call(this),this.detachSoTListener=null,(r=this.sotEditor)==null||r.destroy(),this.sotEditor=e,this.detachSoTListener=this.sotEditor.onUpdate(o=>{var s,a,l,c;if(o.docChanged){let u=Date.now(),d=this.ceImeMode&&u<=this.ceImeExternalSuppressUntil;this.ceImeMode&&!this.ceImeComposing&&!this.ceImeApplying&&!d&&this.recordCeMappingFailure("external",!0),d&&(this.ceImeExternalSuppressUntil=0),this.applyChanges((s=o.changes)!=null?s:[])?this.immediateRender=!1:this.immediateRender?(this.immediateRender=!1,(a=this.renderPipeline)==null||a.cancelScheduledRender(),this.renderNow()):this.scheduleRender(),(l=this.commandToolbar)==null||l.update()}else o.selectionChanged&&(this.updateSourceModeLineRange(),this.pendingCaretScroll=this.pendingCaretScroll||!this.ceImeMode&&!this.overlayFocused,this.ceImeMode&&!this.ceImeSelectionSyncing&&this.syncSelectionToCe(),this.ceImeMode&&this.updateCeEditableRangeFromSelection(),this.scheduleCaretUpdate(),(c=this.commandToolbar)==null||c.update())}),this.updateSourceToggleUi(),this.updateSourceModeLineRange(!0)}updateSourceModeLineRange(e=!1){this.sourceModeEnabled&&(!this.sotEditor||!this.derivedContentEl||this.startPlainEditFromSelection())}rerenderLineRange(e,n){if(!this.sotEditor||!this.derivedContentEl||e===null||n===null||this.pendingText.length>0)return;let r=Math.max(0,Math.min(e,n)),o=Math.max(0,Math.max(e,n));this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null;for(let s=r;s<=o;s+=1){let a=this.lineRanges[s],l=this.getLineElement(s);!a||!l||(l.replaceChildren(),this.renderLine(l,a,s))}this.scheduleCaretUpdate(!0)}computeSourceModeLineRange(){var d;if(!this.sourceModeEnabled||!this.sotEditor||this.lineRanges.length===0)return null;let e=this.sotEditor.getDoc().length,n=this.sotEditor.getSelection(),r=Math.max(0,Math.min(Math.min(n.anchor,n.head),e)),o=Math.max(0,Math.min(Math.max(n.anchor,n.head),e)),s=this.findLineIndex(r),a=this.findLineIndex(o);if(s===null||a===null)return null;let l=this.findLineIndex(n.head);if(l!==null){let h=this.lineMathBlockStart[l],f=this.lineMathBlockEnd[l];if(h!==null&&f!==null)return{start:h,end:f};let p=this.lineCalloutBlockStart[l],m=this.lineCalloutBlockEnd[l];if(p!==null&&m!==null)return{start:p,end:m};let g=this.lineTableBlockStart[l],b=this.lineTableBlockEnd[l];if(g!==null&&b!==null)return{start:g,end:b};let v=this.lineDeflistBlockStart[l],y=this.lineDeflistBlockEnd[l];if(v!==null&&y!==null)return{start:v,end:y};let E=(d=this.lineBlockKinds[l])!=null?d:"normal";if(E==="code"||E==="code-fence"){let x=this.getCodeBlockLineRange(l);if(x)return x}}if(s===a)return{start:s,end:a};let c=s;for(;c>0;){let h=this.lineRanges[c-1];if(!h||h.to-h.from===0)break;c-=1}let u=a;for(;u<this.lineRanges.length-1;){let h=this.lineRanges[u+1];if(!h||h.to-h.from===0)break;u+=1}return{start:c,end:u}}getCodeBlockLineRange(e){var s,a,l;if(e<0||e>=this.lineRanges.length)return null;let n=(s=this.lineBlockKinds[e])!=null?s:"normal";if(n!=="code"&&n!=="code-fence")return null;let r=e;for(;r>0;){let c=(a=this.lineBlockKinds[r-1])!=null?a:"normal";if(c!=="code"&&c!=="code-fence")break;r-=1}let o=e;for(;o+1<this.lineRanges.length;){let c=(l=this.lineBlockKinds[o+1])!=null?l:"normal";if(c!=="code"&&c!=="code-fence")break;o+=1}return{start:r,end:o}}async ensureMarkdownViewForFile(e){return await this.workspaceController.ensureMarkdownViewForFile(e)}findMarkdownLeafForFile(e){return this.workspaceController.findMarkdownLeafForFile(e)}ensurePairedMarkdownView(){this.workspaceController.ensurePairedMarkdownView()}verifyPairedMarkdownViewFile(e,n){return this.workspaceController.verifyPairedMarkdownViewFile(e,n)}applyPairedMarkdownBadge(e,n){this.workspaceController.applyPairedMarkdownBadge(e,n)}clearPairedMarkdownBadge(){this.workspaceController.clearPairedMarkdownBadge()}applySoTTabBadge(){this.workspaceController.applySoTTabBadge()}clearSoTTabBadge(){this.workspaceController.clearSoTTabBadge()}getLeafTabHeaderEl(e){return this.workspaceController.getLeafTabHeaderEl(e)}getTabHeaderTitleHost(e){return this.workspaceController.getTabHeaderTitleHost(e)}getViewHeaderTitleHost(e){return this.workspaceController.getViewHeaderTitleHost(e)}closeSelf(){window.setTimeout(()=>{try{this.leaf.detach()}catch(e){}},0)}registerClipboardHandlers(){if(!this.derivedRootEl)return;let e=o=>{this.handleCopyCut(o,!1)},n=o=>{this.handleCopyCut(o,!0)},r=o=>{this.handlePaste(o)};this.derivedRootEl.addEventListener("copy",e,!0),this.derivedRootEl.addEventListener("cut",n,!0),this.derivedRootEl.addEventListener("paste",r,!0),this.register(()=>{var o,s,a;(o=this.derivedRootEl)==null||o.removeEventListener("copy",e,!0),(s=this.derivedRootEl)==null||s.removeEventListener("cut",n,!0),(a=this.derivedRootEl)==null||a.removeEventListener("paste",r,!0)})}setupWheelScroll(){if(!this.derivedRootEl)return;this.boundWheelHandler&&(this.derivedRootEl.removeEventListener("wheel",this.boundWheelHandler),this.boundWheelHandler=null);let e=n=>this.handleWheel(n);this.boundWheelHandler=e,this.derivedRootEl.addEventListener("wheel",e,{passive:!1}),this.register(()=>{var n;(n=this.derivedRootEl)==null||n.removeEventListener("wheel",e),this.boundWheelHandler===e&&(this.boundWheelHandler=null)})}updateMobileTouchAction(){if(!this.derivedRootEl)return;let e=be.Platform.isMobile||be.Platform.isMobileApp,n=this.writingMode.startsWith("vertical");e&&n?this.derivedRootEl.style.touchAction="none":this.derivedRootEl.style.removeProperty("touch-action")}shouldHandleTouchScroll(e){var r;if(!this.derivedRootEl||!(be.Platform.isMobile||be.Platform.isMobileApp)||!this.writingMode.startsWith("vertical")||e.pointerType!=="touch"||this.sourceModeEnabled)return!1;let n=e.target;return!((r=n==null?void 0:n.closest("textarea, input, .tategaki-plain-overlay"))!=null&&r)}resetTouchScrollState(){this.activeTouchPointers.clear(),this.touchScrollActive=!1,this.touchScrollStartX=0,this.touchScrollStartY=0,this.touchScrollLastY=0}handleTouchScrollPointerDown(e){this.shouldHandleTouchScroll(e)&&(this.activeTouchPointers.set(e.pointerId,{x:e.clientX,y:e.clientY,startX:e.clientX,startY:e.clientY}),this.activeTouchPointers.size>=2&&(this.touchScrollStartX=e.clientX,this.touchScrollStartY=e.clientY,this.touchScrollLastY=e.clientY,this.touchScrollActive=!1))}handleTouchScrollPointerMove(e){if(!this.derivedRootEl||!this.shouldHandleTouchScroll(e))return;let n=this.activeTouchPointers.get(e.pointerId);if(!n)return;let r=e.clientX-n.startX,o=e.clientY-n.startY,s=e.clientY-n.y;if(n.x=e.clientX,n.y=e.clientY,this.activeTouchPointers.set(e.pointerId,n),!(this.activeTouchPointers.size<2)){if(!this.touchScrollActive){if(Math.abs(o)<6||Math.abs(o)<Math.abs(r))return;this.touchScrollActive=!0,this.isPointerSelecting=!1,this.pointerSelectAnchor=null,this.pointerSelectPointerId=null}this.touchScrollActive&&s!==0&&(this.touchScrollLastY=e.clientY,this.derivedRootEl.scrollLeft-=s,e.preventDefault(),e.stopPropagation())}}handleTouchScrollPointerUp(e){this.shouldHandleTouchScroll(e)&&this.activeTouchPointers.has(e.pointerId)&&(this.activeTouchPointers.delete(e.pointerId),this.activeTouchPointers.size<2&&(this.touchScrollActive=!1),this.activeTouchPointers.size===0&&this.resetTouchScrollState())}handleWheel(e){if(!this.derivedRootEl)return;let{deltaX:n,deltaY:r,shiftKey:o}=e,a=window.getComputedStyle(this.derivedRootEl).writingMode.startsWith("vertical"),l=this.derivedRootEl;if(!a){if(!o)return;e.preventDefault(),this.throttledWheelScroll(()=>{l.scrollLeft-=r});return}o||(e.preventDefault(),this.throttledWheelScroll(()=>{let c=-r*.8+n;l.scrollLeft+=c}))}throttledWheelScroll(e){this.wheelThrottleTimer===null&&(e(),this.wheelThrottleTimer=window.setTimeout(()=>{this.wheelThrottleTimer=null},16))}handleRootScroll(){var g;if(!this.derivedRootEl)return;this.markScrollActive();let e=this.derivedRootEl,n=e.scrollTop,r=e.scrollLeft;this.scrollDebouncePendingTop=n,this.scrollDebouncePendingLeft=r;let s=window.getComputedStyle(e).writingMode!=="horizontal-tb",a=s?e.clientWidth:e.clientHeight,l=this.getFastScrollThresholds(a),c=Math.abs(s?r-this.scrollDebounceLastLeft:n-this.scrollDebounceLastTop);this.scrollDebounceLastTop=n,this.scrollDebounceLastLeft=r;let u=performance.now(),d=u-this.scrollDebounceLastEventAt,h=c<=l.smallThreshold&&d>l.idleDelay;this.scrollDebounceLastEventAt=u;let f=c>=l.fastThreshold,p=d<=l.idleDelay,m=this.autoScrollFast||f||!h&&p&&c>=l.smallThreshold;if((g=this.renderPipeline)==null||g.notifyScrollActivity(m),this.autoScrollFast&&this.updateFastScrollPlaceholders(),h){this.scrollDebounceTimer!==null&&(window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.scheduleScrollDebouncedUpdate();return}this.scrollDebounceRaf!==null&&(window.cancelAnimationFrame(this.scrollDebounceRaf),this.scrollDebounceRaf=null),this.scrollDebounceTimer!==null&&window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=window.setTimeout(()=>{this.scrollDebounceTimer=null,this.scheduleScrollDebouncedUpdate()},l.idleDelay)}scheduleScrollDebouncedUpdate(){this.scrollDebounceRaf===null&&(this.scrollDebounceRaf=window.requestAnimationFrame(()=>{var e;this.scrollDebounceRaf=null,this.finishScrollActivity(),this.flushPendingNativeSelectionSync(),this.scheduleCaretUpdate(),this.purgeLineCachesAroundScroll(),(e=this.renderPipeline)==null||e.onScrollSettled(),this.autoScrollFast&&this.updateFastScrollPlaceholders()}))}updateFastScrollPlaceholders(){var d,h;if(!this.derivedRootEl||!this.derivedContentEl)return;let e=this.derivedRootEl,n=this.derivedContentEl,r=this.lineRanges.length;if(r<=0)return;let o=this.getApproxVisibleLineRange(e,r),s=r>=8e3?6:10,a=Math.max(0,o.start-s),l=Math.min(r-1,o.end+s),c=this.getLineElementOffset(),u=n.children;for(let f=a;f<=l;f+=1){let p=u[f+c];if(!p||!p.isConnected)continue;let m=Number.parseInt((d=p.dataset.from)!=null?d:"",10),g=Number.parseInt((h=p.dataset.to)!=null?h:"",10);if(!Number.isFinite(m)||!Number.isFinite(g))continue;let b=Math.max(4,g-m);p.style.setProperty("--placeholder-chars",String(Math.min(80,b)))}}getApproxVisibleLineRange(e,n){let r=window.getComputedStyle(e),o=Number.parseFloat(r.fontSize)||16,s=Number.parseFloat(r.lineHeight)||o*1.8,a=Math.max(s,o),l=r.writingMode!=="horizontal-tb",c=l?e.clientWidth:e.clientHeight,u=l?e.scrollLeft:e.scrollTop;l&&u<0&&(u=-u);let d=Math.floor(Math.max(0,u)/a),h=Math.ceil(c/a),f=Math.max(0,Math.min(n-1,d)),p=Math.max(f,Math.min(n-1,d+h));return{start:f,end:p}}purgeLineCachesAroundScroll(){if(!this.shouldUseLineCache()||!this.derivedRootEl)return;let e=this.lineRanges.length;if(e<=0)return;let n=this.derivedRootEl,r=window.getComputedStyle(n),o=Number.parseFloat(r.fontSize)||16,s=Number.parseFloat(r.lineHeight)||o*1.8,a=r.writingMode!=="horizontal-tb",l=Math.max(s,o),c=a?n.clientWidth:n.clientHeight,u=a?this.scrollDebouncePendingLeft:this.scrollDebouncePendingTop;a&&u<0&&(u=-u);let d=Math.floor(Math.max(0,u)/l),h=Math.ceil(c/l),f=Math.max(120,h*2),p=Math.max(0,d-f),m=Math.min(e-1,d+h+f);this.purgeLineCaches(p,m)}purgeLineCaches(e,n){if(!this.shouldUseLineCache())return;let r=this.lineRanges.length;if(r<=0)return;let o=64,s=Math.max(0,e-o),a=Math.min(r-1,n+o),l=u=>u>=s&&u<=a,c=u=>{for(let d of Array.from(u.keys()))l(d)||u.delete(d)};c(this.lineDecorationCache),c(this.lineSegmentCache)}resetPendingRenderState(){this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null,this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null}finalizeRender(e,n){var r;this.pendingHold&&(this.pendingHold=!1,this.updatePendingText("",!0)),this.updateSourceModeLineRange(!0),this.derivedRootEl&&(this.derivedRootEl.scrollTop=e,this.derivedRootEl.scrollLeft=n,this.syncNativeSelectionDataset()),(r=this.outlinePanel)==null||r.refresh(),this.scheduleCaretUpdate(!0),this.updatePaneHeaderTitle(),this.loadingOverlayPending&&this.hideLoadingOverlay()}scheduleRender(e=!1){var n;(n=this.renderPipeline)==null||n.scheduleRender(e)}renderNow(){var e;(e=this.renderPipeline)==null||e.renderNow()}applyChanges(e){var p,m;if(!this.derivedContentEl||!this.sotEditor||this.lineRanges.length===0||e.length===0)return!1;if(this.canApplyChangesFast(e)&&this.applyChangesFast(e))return!0;let r=this.sotEditor.getDoc().split(`
`),o=this.computeLineRangesFromLines(r);this.recomputeLineBlockKinds(r);let s=Number.POSITIVE_INFINITY,a=-1,l=Number.POSITIVE_INFINITY,c=-1;for(let g of e){let b=this.findLineIndexInRanges(this.lineRanges,g.from),v=this.findLineIndexInRanges(this.lineRanges,g.to),y=this.findLineIndexInRanges(o,g.fromB),E=this.findLineIndexInRanges(o,g.toB);if(b===null||v===null||y===null||E===null)return!1;s=Math.min(s,b),a=Math.max(a,v),l=Math.min(l,y),c=Math.max(c,E)}if(!Number.isFinite(s)||!Number.isFinite(l))return!1;let u=document.createDocumentFragment();for(let g=l;g<=c;g++){let b=o[g];if(!b)continue;let v=document.createElement("div");v.className="tategaki-sot-line",v.dataset.from=String(b.from),v.dataset.to=String(b.to),v.dataset.line=String(g),this.renderLine(v,b,g),u.appendChild(v)}let d=a>=s?a-s+1:0,h=this.getLineElementOffset(),f=(p=this.derivedContentEl.children[a+h+1])!=null?p:null;for(let g=0;g<d;g++){let b=this.derivedContentEl.children[s+h];b&&b.remove()}return f?this.derivedContentEl.insertBefore(u,f):this.derivedContentEl.appendChild(u),this.lineRanges=o,this.syncLineDatasets(Math.min(s,l)),this.updateSourceModeLineRange(!0),this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null,this.pendingHold&&(this.pendingHold=!1,this.updatePendingText("",!0)),(m=this.outlinePanel)==null||m.refresh(),this.scheduleCaretUpdate(!0),this.loadingOverlayPending&&this.hideLoadingOverlay(),!0}canApplyChangesFast(e){if(!this.sotEditor||this.lineRanges.length===0)return!1;for(let n of e){if(n.insert.includes(`
`))return!1;let r=this.findLineIndexInRanges(this.lineRanges,n.from),o=this.findLineIndexInRanges(this.lineRanges,n.to);if(r===null||o===null||r!==o)return!1}return!0}applyChangesFast(e){var l;if(!this.derivedContentEl||!this.sotEditor||this.lineRanges.length===0)return!1;let n=this.lineRanges.slice(),r=this.lineRanges.map(c=>({from:c.from,to:c.to})),o=e.slice().sort((c,u)=>c.from-u.from||c.to-u.to),s=Number.POSITIVE_INFINITY,a=-1;for(let c of o){let u=this.findLineIndexInRanges(n,c.from),d=this.findLineIndexInRanges(n,c.to);if(u===null||d===null||u!==d)return!1;s=Math.min(s,u),a=Math.max(a,u);let h=c.insert.length-(c.to-c.from);if(h===0)continue;let f=r[u];if(!f)return!1;f.to+=h;for(let p=u+1;p<r.length;p+=1){let m=r[p];m&&(m.from+=h,m.to+=h)}}if(!Number.isFinite(s))return!1;this.lineRanges=r;for(let c=s;c<=a;c+=1){let u=this.lineRanges[c],d=this.getLineElement(c);!u||!d||(d.replaceChildren(),this.renderLine(d,u,c))}return this.syncLineDatasets(s),this.updateSourceModeLineRange(!0),this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null,this.pendingHold&&(this.pendingHold=!1,this.updatePendingText("",!0)),(l=this.outlinePanel)==null||l.refresh(),this.scheduleCaretUpdate(!0),this.loadingOverlayPending&&this.hideLoadingOverlay(),this.scheduleLineModelRecompute(s,a),!0}scheduleLineModelRecompute(e,n){var l;if(!this.sotEditor)return;let r=Math.max(0,Math.min(e,n)),o=Math.max(e,n);if(this.lineModelRecomputeStart===null?(this.lineModelRecomputeStart=r,this.lineModelRecomputeEnd=o):(this.lineModelRecomputeStart=Math.min(this.lineModelRecomputeStart,r),this.lineModelRecomputeEnd=Math.max((l=this.lineModelRecomputeEnd)!=null?l:o,o)),this.ceImeMode||this.shouldDeferLineModelRecompute()){this.lineModelRecomputeDeferred=!0;return}if(this.lineModelRecomputeTimer!==null||this.lineModelRecomputeIdle!==null)return;let s=()=>this.runLineModelRecompute(),a=window.requestIdleCallback;if(a){this.lineModelRecomputeIdle=a(s,{timeout:800});return}this.lineModelRecomputeTimer=window.setTimeout(s,180)}runLineModelRecompute(){var s;if(this.lineModelRecomputeTimer=null,this.lineModelRecomputeIdle=null,!this.sotEditor)return;let n=this.sotEditor.getDoc().split(`
`);this.lineRanges.length!==n.length&&(this.lineRanges=this.computeLineRangesFromLines(n)),this.recomputeLineBlockKinds(n),(s=this.outlinePanel)==null||s.refresh();let r=this.lineModelRecomputeStart,o=this.lineModelRecomputeEnd;this.lineModelRecomputeStart=null,this.lineModelRecomputeEnd=null,!(r===null||o===null)&&(this.pendingText.length>0||this.rerenderLineRange(r,o))}syncLineDatasets(e){if(!this.derivedContentEl)return;let n=Math.max(0,e),r=Math.min(this.lineRanges.length,this.derivedContentEl.children.length),o=this.getLineElementOffset();for(let s=n;s<r;s+=1){let a=this.derivedContentEl.children[s+o],l=this.lineRanges[s];!a||!l||(a.dataset.from=String(l.from),a.dataset.to=String(l.to),a.dataset.line=String(s))}}scheduleCaretUpdate(e=!1){if(this.shouldDeferCaretUpdate(e)){this.scheduleSelectionOverlayUpdate();return}if(!e){window.requestAnimationFrame(()=>{this.updateSelectionOverlay(),this.updateCaretPosition()});return}this.updateSelectionOverlay(),this.updateCaretPosition()}updateCaretPosition(){var Lt,U,B,T,F,V,j,he,xe;if(!this.derivedRootEl||!this.derivedContentEl||!this.caretEl||!this.sotEditor)return;let e=this.isPairedMarkdownLeafActive();if(this.sourceModeEnabled){this.caretEl.style.display="none";return}let n=(Lt=this.plugin.settings.wysiwyg.caretWidthPx)!=null?Lt:3,r=this.getEffectiveCommonSettings(this.plugin.settings),o=this.resolveCaretColor(this.plugin.settings,r),s=(U=this.plugin.settings.wysiwyg.ceUseNativeCaret)!=null?U:!0,a=this.ceImeMode&&(s||this.ceImeComposing);if(this.derivedRootEl&&this.ceImeMode&&(this.derivedRootEl.dataset.ceImeNativeCaret=a?"1":"0"),this.ceImeMode&&((B=this.overlayTextarea)==null||B.setCaretVisible(!1),this.derivedContentEl.style.caretColor=a?o:"transparent",a)){this.caretEl.style.display="none",(this.pendingCaretScroll||e)&&(this.pendingCaretScroll=!1,this.scrollCaretIntoView());return}let l=this.sotEditor.getSelection(),c=Math.min(l.anchor,l.head),u=Math.max(l.anchor,l.head),d=this.pendingText.length>0&&c!==u?c:l.head,h=this.findLineIndex(d);if(h===null){this.caretEl.style.display="none";return}let f=this.lineRanges[h];if(!f){this.caretEl.style.display="none";return}let p=this.getLineElement(h);if(!p){this.caretEl.style.display="none";return}this.ensureLineRendered(p);let m=window.getComputedStyle(this.derivedRootEl),g=m.writingMode,b=f.to-f.from,v=Math.max(0,Math.min(d-f.from,b));this.updatePendingSpacer(h,v);let y=this.getCaretRectInLine(p,v,f,g);if(!y){this.caretEl.style.display="none";return}let E=this.derivedRootEl.getBoundingClientRect(),x=y.left-E.left+this.derivedRootEl.scrollLeft,S=y.top-E.top+this.derivedRootEl.scrollTop,w=this.getPendingSpacerStartRect(p,h,g);w&&(x=w.left-E.left+this.derivedRootEl.scrollLeft,S=w.top-E.top+this.derivedRootEl.scrollTop);let k=this.getCaretRectInLine(p,0,f,g),M=x,L=S;b===0&&w||k&&(M=k.left-E.left+this.derivedRootEl.scrollLeft,L=k.top-E.top+this.derivedRootEl.scrollTop),!!w&&this.pendingText.length>0&&this.pendingLineIndex===h&&this.pendingLocalOffset===0&&(M=w.left-E.left+this.derivedRootEl.scrollLeft,L=w.top-E.top+this.derivedRootEl.scrollTop);let P=g.startsWith("vertical"),I=parseFloat(m.fontSize)||18,N=Number.parseFloat(m.lineHeight)||Math.max(1,I*1.8),D=null;(T=this.overlayTextarea)!=null&&T.isFocused()&&(D=this.overlayTextarea.getSelectionStart());let R=this.getPendingCaretRect(g,D),A=x,C=S;R&&(A=R.left-E.left+this.derivedRootEl.scrollLeft,C=R.top-E.top+this.derivedRootEl.scrollTop);let O=R!=null?R:y,H=P?I*.3:0,K=!this.ceImeMode&&(((V=(F=this.overlayTextarea)==null?void 0:F.isImeVisible())!=null?V:!1)||this.overlayFocused&&this.pendingText.length>0);if((j=this.overlayTextarea)==null||j.setCaretVisible(K),this.caretEl.style.display=K?"none":"",this.caretEl.style.left=`${A}px`,P)this.caretEl.style.top=`${C}px`,this.caretEl.style.width=`${Math.max(8,O.width)}px`,this.caretEl.style.height=`${Math.max(1,n)}px`;else{let Ce=Math.max(8,I),tn=Math.max(0,O.height),di=C;tn>0&&tn!==Ce&&(di=C+(tn-Ce)/2),this.caretEl.style.top=`${di}px`,this.caretEl.style.width=`${Math.max(1,n)}px`,this.caretEl.style.height=`${Ce}px`}let W=0;if(!P){let Ce=Math.max(0,O.height);if(Ce>0&&Number.isFinite(N)){W=(Ce-N)/2,W-=I*.2;let tn=I*.35;W=Math.max(-tn,Math.min(tn,W))}}let te=this.pendingText.length>0&&this.pendingLineIndex===h&&this.pendingLocalOffset===0,J=P?Math.max(0,S-L):Math.max(0,x-M);te&&(J=0);let Q=(he=this.plugin.settings.wysiwyg.imeOffsetHorizontalEm)!=null?he:.1,Ae=(xe=this.plugin.settings.wysiwyg.imeOffsetVerticalEm)!=null?xe:.5,$e=P?0:I*Q,ke=P?I*Ae:0,ce=b===0&&this.pendingText.length>0,We=ce?x+ke:x,dt=ce?S-$e:S,Ct=ce?M+ke:M,vt=ce?L-$e:L,ht=ce?0:ke,Ue=ce?0:$e,Ze=this.derivedRootEl.scrollTop,en=this.derivedRootEl.scrollLeft,ne=this.derivedRootEl.clientHeight,ie=this.derivedRootEl.clientWidth,Ie=vt-Ze,oe=Ct-en,ye=Math.max(0,Math.min(Ie,ne)),Qe=Math.max(0,Math.min(oe,ie));if(this.overlayTextarea){let Ce=Number.parseFloat(m.paddingBottom)||0,tn=Number.parseFloat(m.paddingRight)||0,di=Math.max(I*1.8,32),Rh=Math.max(I*.5,0);if(this.overlayTextarea.setTextIndent(J),P){let Bl=ne-Ce-ye-W;this.overlayTextarea.setConstraints(!0,Math.max(Bl+Rh,di),di);let GE=Math.max(8,y.width);this.overlayTextarea.setAnchorPositionVertical(We+GE+ht,vt+W)}else{let Bl=ie-tn-Qe;this.overlayTextarea.setConstraints(!1,Math.max(Bl+Rh,di),di),this.overlayTextarea.setAnchorPosition(Ct,dt+W-Ue)}}this.updatePendingPosition(x-H,S+W),(this.pendingCaretScroll||e)&&(this.pendingCaretScroll=!1,this.scrollCaretIntoView())}scrollCaretIntoView(){var r;if(!this.derivedRootEl)return;if(this.ceImeMode){if(!this.sotEditor)return;let s=this.sotEditor.getSelection().head,a=this.findLineIndex(s);if(a===null)return;let l=this.lineRanges[a],c=this.getLineElement(a);if(!l||!c)return;this.ensureLineRendered(c);let u=l.to-l.from,d=Math.max(0,Math.min(s-l.from,u)),h=window.getComputedStyle(this.derivedRootEl).writingMode,f=(r=this.getCaretRectInLine(c,d,l,h))!=null?r:c.getBoundingClientRect();this.scrollRectIntoView(f);return}if(!this.caretEl||this.caretEl.style.display==="none")return;let e=this.derivedRootEl.getBoundingClientRect(),n=this.caretEl.getBoundingClientRect();this.scrollRectIntoView(n,e)}scrollRectIntoView(e,n){if(!this.derivedRootEl)return;let r=n!=null?n:this.derivedRootEl.getBoundingClientRect(),o=24,s=0,a=0;e.left<r.left+o?s=e.left-(r.left+o):e.right>r.right-o&&(s=e.right-(r.right-o)),e.top<r.top+o?a=e.top-(r.top+o):e.bottom>r.bottom-o&&(a=e.bottom-(r.bottom-o)),s!==0&&(this.derivedRootEl.scrollLeft+=s),a!==0&&(this.derivedRootEl.scrollTop+=a)}openHref(e){var s,a;let n=e.trim();if(!n)return;if(/^[a-z][a-z0-9+.-]*:\/\//i.test(n)||/^mailto:/i.test(n)||/^tel:/i.test(n)){window.open(n);return}let o=(a=(s=this.currentFile)==null?void 0:s.path)!=null?a:"";this.app.workspace.openLinkText(n,o,!1)}replaceSelection(e){var c,u;if(!this.sotEditor)return;let n=this.getSoftSelectionRange(),r=this.sotEditor.getSelection(),o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);n&&(o=n.from,s=n.to,this.clearSoftSelection(),this.selectAllActive=!1,(c=this.overlayImeReplace)==null||c.cancel());let a=n?null:(u=this.overlayImeReplace)==null?void 0:u.consumeReplaceRange();if(a&&(o=a.from,s=a.to,this.selectAllActive=!1),e===`
`&&o===s){let d=this.findLineIndex(o);if(d!==null){let h=this.lineRanges[d];if(h){let f=this.buildSegmentsForLine(h.from,h.to),p=f.length>0?f[f.length-1].to:h.from;p<h.to&&o>=p&&(o=h.to,s=h.to)}}}this.pendingText.length>0&&(this.pendingHold=!0),this.immediateRender=!0,this.sotEditor.replaceRange(o,s,e),e.includes(`
`)&&(this.pendingCaretScroll=!0)}backspace(){var s;if(!this.sotEditor)return;(s=this.overlayImeReplace)==null||s.cancel();let e=this.getSoftSelectionRange();if(e){this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(e.from,e.to,""),this.clearSoftSelection(),this.selectAllActive=!1;return}let n=this.sotEditor.getSelection(),r=Math.min(n.anchor,n.head),o=Math.max(n.anchor,n.head);if(r!==o){this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(r,o,"");return}r<=0||(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(r-1,r,""))}del(){var a;if(!this.sotEditor)return;(a=this.overlayImeReplace)==null||a.cancel();let e=this.getSoftSelectionRange();if(e){this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(e.from,e.to,""),this.clearSoftSelection(),this.selectAllActive=!1;return}let n=this.sotEditor.getSelection(),r=Math.min(n.anchor,n.head),o=Math.max(n.anchor,n.head);if(r!==o){this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(r,o,"");return}let s=this.sotEditor.getDoc().length;r>=s||(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(r,r+1,""))}handleNavigate(e){var f;if(!this.sotEditor||!this.derivedRootEl)return;let n=this.sotEditor.getDoc(),r=this.sotEditor.getSelection(),o=r.head;this.updatePendingText("",!0);let s=window.getComputedStyle(this.derivedRootEl).writingMode,a=this.getVisualMoveInfo(e.key,s),l=(f=a==null?void 0:a.offset)!=null?f:null;l===null&&(l=this.getNextOffset(n,o,e.key,s)),a!=null&&a.atBoundary&&(l=this.adjustCrossParagraphOffset(o,l));let c=l>=o,u=this.normalizeOffsetToVisible(l,c);u===o&&l!==o?l=this.findNextVisibleOffset(o,c):l=u;let d=e.shiftKey?r.anchor:l,h=this.isNativeSelectionEnabled()&&!e.shiftKey;this.setSelectionNormalized(d,l,{syncDom:!h}),this.pendingCaretScroll=!0,this.scheduleCaretUpdate(!0)}shouldPrepareImeReplaceRange(e){if(e.metaKey||e.ctrlKey||e.altKey)return!1;let n=e.key;return n==="Escape"||n==="Backspace"||n==="Delete"||n==="Tab"||["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(n)?!1:n==="Enter"||n==="Process"||n==="Unidentified"||n==="Dead"?!0:n.length===1}collapseSelectionAfterNativeCancel(e){var s,a,l;if(this.ceImeMode||this.sourceModeEnabled||!this.isNativeSelectionEnabled()||!this.sotEditor)return;this.softSelectionActive&&(this.clearSoftSelection(),this.selectAllActive=!1);let n=(a=(s=this.derivedContentEl)==null?void 0:s.ownerDocument.getSelection())!=null?a:null,r=n&&this.isSelectionInsideDerivedContent(n);if(n&&r&&!n.isCollapsed)return;let o=this.sotEditor.getSelection();o.anchor!==o.head&&(this.setSelectionNormalized(o.head,o.head,{syncDom:!1}),(l=this.selectionLayerEl)==null||l.replaceChildren())}findNextVisibleOffset(e,n){if(!this.sotEditor)return e;let r=this.sotEditor.getDoc().length,o=Math.max(0,Math.min(e,r)),s=this.findLineIndex(o);if(s===null)return o;let a=n?1:-1;for(let l=s;l>=0&&l<this.lineRanges.length;l+=a){let c=this.lineRanges[l];if(!c)break;let u=this.buildSegmentsForLine(c.from,c.to);if(u.length===0){if(l!==s)return n?c.from:c.to;continue}if(l===s)if(n)for(let d of u){if(o<d.from)return d.from;if(o>=d.from&&o<d.to)return Math.min(d.to,o+1)}else for(let d=u.length-1;d>=0;d-=1){let h=u[d];if(o>h.to)return h.to;if(o>h.from&&o<=h.to)return Math.max(h.from,o-1)}else return n?u[0].from:u[u.length-1].to}return o}updatePendingText(e,n=!1){var o;if(this.ceImeMode){this.pendingText="",this.pendingHold=!1,this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null,this.pendingEl&&(this.pendingEl.style.display="none");return}if(!n&&e.length===0&&this.pendingHold||(this.pendingText=e,e.length===0&&!this.pendingHold?this.restorePendingSelectionLines():e.length>0&&this.capturePendingSelection(),!this.pendingEl))return;let r=e.length>0?e:"";this.pendingEl.textContent=r,this.showPendingOverlay?(o=this.overlayTextarea)!=null&&o.isImeVisible()?this.pendingEl.style.display="none":this.pendingEl.style.display=r.length>0?"":"none":this.pendingEl.style.display="none",this.scheduleCaretUpdate()}updatePendingPosition(e,n){this.pendingEl&&(this.pendingEl.style.left=`${e}px`,this.pendingEl.style.top=`${n}px`)}handleCopyCut(e,n){var l;if(!this.sotEditor)return;if(this.softSelectionActive){let c=this.getSoftSelectionRange();if(!c)return;let u=this.sotEditor.getDoc().slice(c.from,c.to);e.clipboardData&&(e.clipboardData.setData("text/plain",u),e.clipboardData.setData("text/markdown",u)),e.preventDefault(),e.stopPropagation(),n&&(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(c.from,c.to,""),this.clearSoftSelection(),this.selectAllActive=!1);return}if((l=this.nativeSelectionSupport)!=null&&l.tryHandleCopyCut(e,n))return;this.ceImeMode&&this.syncSelectionFromCe();let r=this.sotEditor.getSelection(),o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);if(o===s)return;let a=this.sotEditor.getDoc().slice(o,s);e.clipboardData&&(e.clipboardData.setData("text/plain",a),e.clipboardData.setData("text/markdown",a)),e.preventDefault(),e.stopPropagation(),n&&(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(o,s,""))}handlePaste(e){var l,c,u,d;if(!this.sotEditor)return;if(this.ceImeMode){e.preventDefault(),e.stopPropagation();let h=this.syncSelectionFromCe();if(!h)return;let f=Math.min(h.anchor,h.head),p=Math.max(h.anchor,h.head),m=(c=(l=e.clipboardData)==null?void 0:l.getData("text/plain"))!=null?c:"";if(m.length>0){let g=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`);this.applyCeReplaceRange(f,p,g);return}this.readTextFromClipboard().then(g=>{if(!g)return;let b=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`);this.applyCeReplaceRange(f,p,b)});return}let n=(d=(u=e.clipboardData)==null?void 0:u.getData("text/plain"))!=null?d:"";if(n.length===0)return;e.preventDefault(),e.stopPropagation();let r=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`);this.updatePendingText("",!0);let o=this.sotEditor.getSelection(),s=Math.min(o.anchor,o.head),a=Math.max(o.anchor,o.head);this.immediateRender=!0,this.sotEditor.replaceRange(s,a,r)}updateSelectionOverlay(){var r,o,s,a,l,c,u,d;if(this.shouldSuppressAutoScrollSelectionRenders()){(r=this.selectionLayerEl)==null||r.replaceChildren();return}if(this.sourceModeEnabled){(o=this.selectionLayerEl)==null||o.replaceChildren();return}let e=this.getSoftSelectionRange();if(e&&this.sotEditor&&this.selectionLayerEl&&this.derivedRootEl&&this.derivedContentEl){let h=this.sotEditor.getDoc().length;if(e.from===0&&e.to===h&&this.isHugeDocSelection()){this.selectionLayerEl.replaceChildren();let f=this.derivedRootEl.getBoundingClientRect(),p=this.derivedContentEl.getBoundingClientRect(),m=Math.max(f.left,p.left),g=Math.min(f.right,p.right),b=Math.max(f.top,p.top),v=Math.min(f.bottom,p.bottom),y=Math.max(0,g-m),E=Math.max(0,v-b);if(y>0&&E>0){let x=document.createElement("div");x.className="tategaki-sot-selection-rect";let S=m-f.left+this.derivedRootEl.scrollLeft,w=b-f.top+this.derivedRootEl.scrollTop;x.style.left=`${S}px`,x.style.top=`${w}px`,x.style.width=`${y}px`,x.style.height=`${E}px`,this.selectionLayerEl.appendChild(x)}return}(s=this.selectionOverlay)==null||s.updateSelectionOverlayForRange(e.from,e.to,{forceVisibleRange:!0,allowNativeSelection:!0,preferApproxVisibleRange:this.isScrolling});return}if(this.ceImeMode){if(!this.selectAllActive){(a=this.selectionLayerEl)==null||a.replaceChildren();return}if(this.sotEditor&&this.selectionLayerEl&&this.derivedRootEl&&this.derivedContentEl){let h=this.sotEditor.getDoc().length,f=this.lineRanges.length,p=h>=2e5||f>=2e3,m=this.sotEditor.getSelection(),g=Math.min(m.anchor,m.head),b=Math.max(m.anchor,m.head);if(g===0&&b===h&&p){this.selectionLayerEl.replaceChildren();let v=this.derivedRootEl.getBoundingClientRect(),y=this.derivedContentEl.getBoundingClientRect(),E=Math.max(v.left,y.left),x=Math.min(v.right,y.right),S=Math.max(v.top,y.top),w=Math.min(v.bottom,y.bottom),k=Math.max(0,x-E),M=Math.max(0,w-S);if(k>0&&M>0){let L=document.createElement("div");L.className="tategaki-sot-selection-rect";let _=E-v.left+this.derivedRootEl.scrollLeft,P=S-v.top+this.derivedRootEl.scrollTop;L.style.left=`${_}px`,L.style.top=`${P}px`,L.style.width=`${k}px`,L.style.height=`${M}px`,this.selectionLayerEl.appendChild(L)}return}}this.selectAllActive=!1,(l=this.selectionLayerEl)==null||l.replaceChildren();return}if(VE({isNativeSelectionEnabled:this.isNativeSelectionEnabled(),overlayFocused:this.overlayFocused||this.scrollbarSelectionHold||this.nativeContextMenuHold.isActiveWithSelection((u=(c=this.sotEditor)==null?void 0:c.getSelection())!=null?u:null),ceImeMode:this.ceImeMode,sourceModeEnabled:this.sourceModeEnabled,derivedRootEl:this.derivedRootEl,derivedContentEl:this.derivedContentEl,selectionLayerEl:this.selectionLayerEl,sotEditor:this.sotEditor,totalLines:this.lineRanges.length,selectionOverlay:this.selectionOverlay,isSelectionInsideDerivedContent:h=>this.isSelectionInsideDerivedContent(h)}))return;if(this.selectAllActive&&this.sotEditor&&this.selectionLayerEl&&this.derivedRootEl&&this.derivedContentEl){let h=this.sotEditor.getDoc().length,f=this.sotEditor.getSelection(),p=Math.min(f.anchor,f.head),m=Math.max(f.anchor,f.head);if(p===0&&m===h&&h>=2e5){this.selectionLayerEl.replaceChildren();let g=this.derivedRootEl.getBoundingClientRect(),b=this.derivedContentEl.getBoundingClientRect(),v=Math.max(g.left,b.left),y=Math.min(g.right,b.right),E=Math.max(g.top,b.top),x=Math.min(g.bottom,b.bottom),S=Math.max(0,y-v),w=Math.max(0,x-E);if(S>0&&w>0){let k=document.createElement("div");k.className="tategaki-sot-selection-rect";let M=v-g.left+this.derivedRootEl.scrollLeft,L=E-g.top+this.derivedRootEl.scrollTop;k.style.left=`${M}px`,k.style.top=`${L}px`,k.style.width=`${S}px`,k.style.height=`${w}px`,this.selectionLayerEl.appendChild(k)}return}this.selectAllActive=!1}let n=this.nativeSelectionAssistByAutoScroll&&this.isHugeDocSelection();(d=this.selectionOverlay)==null||d.updateSelectionOverlay({allowNativeSelection:n,preferApproxVisibleRange:this.isScrolling})}getPendingCaretRect(e,n){if(!this.pendingSpacerEl||this.pendingText.length===0)return null;let r=this.pendingSpacerEl.firstChild;if(!r||r.nodeType!==Node.TEXT_NODE)return null;let o=r,s=o.length,a=n==null?s:Math.max(0,Math.min(n,s)),l=document.createRange();return l.setStart(o,a),l.setEnd(o,a),this.pickCaretRectFromRange(l,e)}getPendingSpacerStartRect(e,n,r){if(!this.pendingSpacerEl||this.pendingLineIndex===null||this.pendingLineIndex!==n||!e.contains(this.pendingSpacerEl))return null;let o=this.pendingSpacerEl.firstChild;if(o&&o.nodeType===Node.TEXT_NODE){let s=document.createRange();return s.setStart(o,0),s.setEnd(o,0),this.pickCaretRectFromRange(s,r)}return this.pendingSpacerEl.getBoundingClientRect()}updatePendingSpacer(e,n){if(!this.derivedContentEl)return;if(this.pendingText.length===0){this.restorePendingSelectionLines(),this.restorePendingLine();return}if(this.applyPendingSelectionReplace())return;let r=this.lineRanges[e],o=this.getLineElement(e);if(!r||!o){this.restorePendingSelectionLines(),this.restorePendingLine();return}let s=this.normalizeOffsetToVisible(r.from+n,!0),a=Math.max(0,Math.min(s-r.from,r.to-r.from));if(this.pendingLineIndex===e&&this.pendingLocalOffset===a&&this.pendingSpacerEl){this.pendingSpacerEl.textContent=this.pendingText;return}this.restorePendingLine();let l=this.buildSegmentsForLine(r.from,r.to),c=this.getInlineWidgetsForLineRange(r);this.renderLineFromSegments(o,r,l,{insertOffset:s,pendingText:this.pendingText},c),this.pendingLineIndex=e,this.pendingLocalOffset=a}restorePendingLine(){if(this.pendingLineIndex===null||!this.derivedContentEl){this.pendingSpacerEl=null,this.pendingLocalOffset=null,this.pendingLineIndex=null;return}let e=this.lineRanges[this.pendingLineIndex],n=this.getLineElement(this.pendingLineIndex);if(!e||!n){this.pendingSpacerEl=null,this.pendingLocalOffset=null,this.pendingLineIndex=null;return}n.replaceChildren(),this.renderLine(n,e),this.pendingSpacerEl=null,this.pendingLocalOffset=null,this.pendingLineIndex=null}capturePendingSelection(){if(!this.sotEditor||this.pendingSelectionFrom!==null)return;let e=this.sotEditor.getSelection(),n=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(n===r)return;let o=this.normalizeOffsetToVisible(n,!0),s=this.normalizeOffsetToVisible(r,!1),a=this.findLineIndex(o),l=this.findLineIndex(s);a===null||l===null||(this.pendingSelectionFrom=o,this.pendingSelectionTo=s,this.pendingSelectionLineStart=a,this.pendingSelectionLineEnd=l)}applyPendingSelectionReplace(){if(this.pendingSelectionFrom===null||this.pendingSelectionTo===null||this.pendingSelectionLineStart===null||this.pendingSelectionLineEnd===null||!this.derivedContentEl)return!1;let e=this.pendingSelectionLineStart,n=this.pendingSelectionLineEnd,r=this.pendingSelectionFrom,o=this.pendingSelectionTo;if(e>n)return!1;let s=this.lineRanges[e],a=s?s.to-s.from:0,l=s?Math.max(0,Math.min(r-s.from,a)):0;if(this.pendingLineIndex===e&&this.pendingLocalOffset===l&&this.pendingSpacerEl)return this.pendingSpacerEl.textContent=this.pendingText,!0;this.restorePendingLine();for(let c=e;c<=n;c+=1){let u=this.lineRanges[c],d=this.getLineElement(c);if(!u||!d)continue;let h=c===e?r:u.from,f=c===n?o:u.to,p=this.buildSegmentsForLine(u.from,u.to),m=this.getInlineWidgetsForLineRange(u),g=this.removeRangeFromSegments(p,h,f),b=this.removeRangeFromInlineWidgets(m,h,f);c===e?(this.renderLineFromSegments(d,u,g,{insertOffset:r,pendingText:this.pendingText},b),this.pendingLineIndex=e,this.pendingLocalOffset=l):this.renderLineFromSegments(d,u,g,void 0,b)}return!0}restorePendingSelectionLines(){if(this.pendingSelectionLineStart===null||this.pendingSelectionLineEnd===null){this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null;return}let e=this.pendingSelectionLineStart,n=this.pendingSelectionLineEnd;for(let r=e;r<=n;r+=1){let o=this.lineRanges[r],s=this.getLineElement(r);!o||!s||(s.replaceChildren(),this.renderLine(s,o))}this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null,this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null}renderLine(e,n,r){var c;if(!this.sotEditor)return;let o=r!=null?r:Number.parseInt((c=e.dataset.line)!=null?c:"",10),s=Number.isFinite(o)&&this.isLineInSourceMode(o);if(Number.isFinite(o)){let u=this.embedRenderChildren.get(o);if(u){try{u.unload()}catch(m){}this.embedRenderChildren.delete(o)}let d=this.mathRenderChildren.get(o);if(d){try{d.unload()}catch(m){}this.mathRenderChildren.delete(o)}let h=this.calloutRenderChildren.get(o);if(h){try{h.unload()}catch(m){}this.calloutRenderChildren.delete(o)}let f=this.tableRenderChildren.get(o);if(f){try{f.unload()}catch(m){}this.tableRenderChildren.delete(o)}let p=this.deflistRenderChildren.get(o);if(p){try{p.unload()}catch(m){}this.deflistRenderChildren.delete(o)}}if(e.removeAttribute("data-virtual"),delete e.dataset.mdKind,delete e.dataset.mdLevel,delete e.dataset.mdDepth,delete e.dataset.headingCollapsed,delete e.dataset.headingFoldable,delete e.dataset.listMarker,delete e.dataset.taskChecked,delete e.dataset.listDepth,delete e.dataset.listBullet,delete e.dataset.codeInfo,delete e.dataset.calloutType,delete e.dataset.calloutRange,delete e.dataset.footnoteId,delete e.dataset.tableHeader,delete e.dataset.tableRange,delete e.dataset.deflistRange,delete e.dataset.imageSrc,delete e.dataset.imageAlt,delete e.dataset.imageWidth,delete e.dataset.embedTarget,delete e.dataset.mathRange,e.style.removeProperty("--tategaki-sot-list-depth"),e.style.removeProperty("--tategaki-sot-blockquote-depth"),this.applyCeEditableState(e,Number.isFinite(o)?o:null),this.plainTextViewEnabled){e.className="tategaki-sot-line";let d=this.sotEditor.getDoc().slice(n.from,n.to),h=d.length>0?[{from:n.from,to:n.to,text:d,classNames:["tategaki-sot-run"]}]:[];this.renderLineFromSegments(e,n,h),this.applyCeNonEditableMarkers(e),this.applyPlainEditTargetClass(e,Number.isFinite(o)?o:null);return}if(s){e.className="tategaki-sot-line";let u=this.sotEditor.getDoc(),d=n.to>n.from?[{from:n.from,to:n.to,text:u.slice(n.from,n.to),classNames:["tategaki-sot-run"]}]:[];this.renderLineFromSegments(e,n,d),this.applyCeNonEditableMarkers(e),this.applyPlainEditTargetClass(e,Number.isFinite(o)?o:null);return}{let u=this.sotEditor.getDoc(),d=Number.isFinite(o)?o:null,h=u.slice(n.from,n.to),f=this.getCachedBlockLineDecoration(d,n.from,n.to,h);e.className=["tategaki-sot-line",...f.classes].join(" ");for(let[p,m]of Object.entries(f.dataset))e.dataset[p]=m;for(let[p,m]of Object.entries(f.styleVars))e.style.setProperty(p,m)}if(this.frontmatterDetected&&(e.dataset.mdKind==="frontmatter"||e.dataset.mdKind==="frontmatter-fence")){e.classList.add("tategaki-md-frontmatter-hidden"),this.renderLineFromSegments(e,n,[]),this.applyCeNonEditableMarkers(e),this.applyPlainEditTargetClass(e,Number.isFinite(o)?o:null);return}if(e.dataset.mdKind==="heading-hidden"){this.renderLineFromSegments(e,n,[]),this.applyCeNonEditableMarkers(e),this.applyPlainEditTargetClass(e,Number.isFinite(o)?o:null);return}let a=this.buildSegmentsForLine(n.from,n.to),l=this.getInlineWidgetsForLineRange(n);this.renderLineFromSegments(e,n,a,void 0,l),this.applyCeNonEditableMarkers(e),this.applyPlainEditTargetClass(e,Number.isFinite(o)?o:null)}ensureLineRendered(e){var o;if(e.dataset.virtual!=="1")return;let n=Number.parseInt((o=e.dataset.line)!=null?o:"",10);if(!Number.isFinite(n))return;let r=this.lineRanges[n];r&&this.renderLine(e,r,n)}renderLineLight(e,n,r){if(Number.isFinite(r)){let a=r,l=c=>{let u=c.get(a);if(u){try{u.unload()}catch(d){}c.delete(a)}};l(this.embedRenderChildren),l(this.mathRenderChildren),l(this.calloutRenderChildren),l(this.tableRenderChildren),l(this.deflistRenderChildren)}e.replaceChildren(),e.className="tategaki-sot-line tategaki-sot-line-virtual",e.dataset.virtual="1",this.applyCeEditableState(e,r),this.applyPlainEditTargetClass(e,r);let o=document.createElement("span");o.className="tategaki-sot-virtual-placeholder";let s=Math.max(4,n.to-n.from);o.style.setProperty("--placeholder-chars",String(Math.min(80,s))),e.appendChild(o)}removeRangeFromSegments(e,n,r){let o=Math.min(n,r),s=Math.max(n,r);if(o===s)return e;let a=[];for(let l of e){if(l.to<=o||l.from>=s){a.push(l);continue}if(l.from<o){let c=Math.min(l.to,o),u=c-l.from;u>0&&a.push({from:l.from,to:c,text:l.text.slice(0,u),classNames:l.classNames,href:l.href,ruby:l.ruby})}if(l.to>s){let c=Math.max(l.from,s),u=c-l.from;u<l.text.length&&a.push({from:c,to:l.to,text:l.text.slice(u),classNames:l.classNames,href:l.href,ruby:l.ruby})}}return a}removeRangeFromInlineWidgets(e,n,r){let o=Math.min(n,r),s=Math.max(n,r);return o===s?e:e.filter(a=>a.to<=o||a.from>=s)}splitSegmentsAtOffset(e,n){let r=[],o=[];for(let s of e){if(s.to<=n){r.push(s);continue}if(s.from>=n){o.push(s);continue}let a=Math.max(0,Math.min(n-s.from,s.text.length)),l=s.text.slice(0,a),c=s.text.slice(a);l.length>0&&r.push({from:s.from,to:s.from+l.length,text:l,classNames:s.classNames,href:s.href,ruby:s.ruby}),c.length>0&&o.push({from:s.from+l.length,to:s.to,text:c,classNames:s.classNames,href:s.href,ruby:s.ruby})}return{before:r,after:o}}renderInlineSegmentsWithWidgets(e,n,r,o,s){var b,v;let a=(o!=null?o:[]).filter(y=>y.from>=n.from&&y.from<=n.to&&y.to>=n.from&&y.to<=n.to).slice().sort((y,E)=>y.from-E.from||y.to-E.to),l=y=>{let E=document.createElement("span");if(E.className=y.classNames.join(" "),E.dataset.from=String(y.from-n.from),E.dataset.to=String(y.to-n.from),y.classNames.includes("tategaki-md-footnote-ref")){let x=y.text,S=this.footnoteDefinitionOrder.get(x);E.dataset.footnoteId=x,S!==void 0?E.dataset.footnoteNumber=String(S):delete E.dataset.footnoteNumber;let w=this.footnoteDefinitionText.get(x);w?(E.setAttribute("aria-label",w),E.setAttribute("data-tooltip-position","top")):(E.removeAttribute("aria-label"),E.removeAttribute("data-tooltip-position"))}y.href?E.dataset.href=y.href:delete E.dataset.href,y.ruby?(E.dataset.ruby=y.ruby,E.dataset.aozoraRuby="1"):(delete E.dataset.ruby,delete E.dataset.aozoraRuby),E.textContent=y.text,e.appendChild(E)},c=y=>{if(y.kind!=="math-inline")return;let E=document.createElement("span");E.className="tategaki-md-inline-widget tategaki-md-math-inline-widget",E.dataset.from=String(y.from-n.from),E.dataset.to=String(y.to-n.from),E.dataset.widgetKind=y.kind;try{let x=(0,be.renderMath)(y.source,!1);E.appendChild(x),this.scheduleFinishRenderMath()}catch(x){E.textContent=`$${y.source}$`,E.classList.add("is-fallback")}e.appendChild(E)},u=s?Math.max(n.from,Math.min(s.insertOffset,n.to)):null,d=a.map(y=>y.from);u!==null&&d.push(u);let h=this.splitSegmentsAtOffsets(r,Array.from(new Set(d))),f=0,p=0,m=u===null,g=()=>{let y=h[f],E=a[p],x=y?y.from:null,S=E?E.from:null,w=m?null:u,k=null;for(let M of[x,S,w])M!==null&&(k===null||M<k)&&(k=M);return k};for(;;){let y=g();if(y===null)break;if(!m&&u!==null&&y===u){let S=document.createElement("span");S.className="tategaki-sot-pending-spacer",S.textContent=(b=s==null?void 0:s.pendingText)!=null?b:"",e.appendChild(S),this.pendingSpacerEl=S,m=!0;continue}let E=a[p];if(E&&E.from===y){c(E),p+=1;continue}let x=h[f];if(x&&x.from===y){l(x),f+=1;continue}break}for(;p<a.length;p+=1)c(a[p]);for(;f<h.length;f+=1)l(h[f]);if(!m&&u!==null){let y=document.createElement("span");y.className="tategaki-sot-pending-spacer",y.textContent=(v=s==null?void 0:s.pendingText)!=null?v:"",e.appendChild(y),this.pendingSpacerEl=y}}getWidgetRenderContext(){return{app:this.app,getDoc:()=>{var e,n;return(n=(e=this.sotEditor)==null?void 0:e.getDoc())!=null?n:null},getSourcePath:()=>{var e,n;return(n=(e=this.currentFile)==null?void 0:e.path)!=null?n:""},lineRanges:this.lineRanges,lineMathBlockStart:this.lineMathBlockStart,lineMathBlockEnd:this.lineMathBlockEnd,lineCalloutBlockStart:this.lineCalloutBlockStart,lineCalloutBlockEnd:this.lineCalloutBlockEnd,lineTableBlockStart:this.lineTableBlockStart,lineTableBlockEnd:this.lineTableBlockEnd,lineDeflistBlockStart:this.lineDeflistBlockStart,lineDeflistBlockEnd:this.lineDeflistBlockEnd,addChild:e=>this.addChild(e),mathRenderChildren:this.mathRenderChildren,calloutRenderChildren:this.calloutRenderChildren,tableRenderChildren:this.tableRenderChildren,deflistRenderChildren:this.deflistRenderChildren,embedRenderChildren:this.embedRenderChildren}}renderLineFromSegments(e,n,r,o,s){var h,f,p,m,g,b,v;e.replaceChildren();let a=(h=e.dataset.mdKind)!=null?h:"",l=this.getWidgetRenderContext();if(a==="image-widget"){FE(l,e,n);return}if(a==="math-widget"){let y=Number.parseInt((f=e.dataset.line)!=null?f:"",10);_E(l,e,n,Number.isFinite(y)?y:null);return}if(a==="math-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(n.to),y.textContent="\u200B",e.appendChild(y);return}if(a==="callout-widget"){let y=Number.parseInt((p=e.dataset.line)!=null?p:"",10);OE(l,e,n,Number.isFinite(y)?y:null);return}if(a==="callout-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(n.to),y.textContent="\u200B",e.appendChild(y);return}if(a==="table-widget"){let y=Number.parseInt((m=e.dataset.line)!=null?m:"",10);DE(l,e,n,Number.isFinite(y)?y:null);return}if(a==="table-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(n.to),y.textContent="\u200B",e.appendChild(y);return}if(a==="deflist-widget"){let y=Number.parseInt((g=e.dataset.line)!=null?g:"",10);BE(l,e,n,Number.isFinite(y)?y:null);return}if(a==="deflist-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(n.to),y.textContent="\u200B",e.appendChild(y);return}if(a==="heading-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(n.to),y.textContent="\u200B",e.appendChild(y);return}if(a==="embed-widget"){let y=Number.parseInt((b=e.dataset.line)!=null?b:"",10);HE(l,e,n,Number.isFinite(y)?y:null);return}if(a==="table-row"){this.renderTableRowLine(e,n,r,s!=null?s:[],o);return}if(a==="table-sep"){let y=document.createElement("span");y.className="tategaki-md-table-sep-line",y.textContent="\u200B",e.appendChild(y);let E=document.createElement("span");E.className="tategaki-sot-eol",E.dataset.offset=String(n.to),E.textContent="\u200B",e.appendChild(E);return}let c=this.createLinePrefixElement(e);c&&e.appendChild(c),this.renderInlineSegmentsWithWidgets(e,n,r,s!=null?s:[],o);let u=n.from===n.to;if(this.ceImeMode&&u){let y=document.createElement("span");y.className="tategaki-sot-ce-input-placeholder",y.textContent="\u200B",e.appendChild(y)}if(a==="heading"&&e.dataset.headingCollapsed==="1"){let y=document.createElement("span");y.className="tategaki-md-heading-ellipsis",(0,be.setIcon)(y,"message-circle-more");let E=Number.parseInt((v=e.dataset.line)!=null?v:"",10);if(Number.isFinite(E)){let x=this.getCollapsedContentPreview(E,3);x&&(y.setAttribute("data-preview",x),y.addEventListener("mouseenter",S=>{this.showCollapsePreviewTooltip(S.target,x)}),y.addEventListener("mouseleave",()=>{this.hideCollapsePreviewTooltip()}))}e.appendChild(y)}let d=document.createElement("span");d.className="tategaki-sot-eol",d.dataset.offset=String(n.to),d.textContent="\u200B",e.appendChild(d)}scheduleFinishRenderMath(){this.finishRenderMathTimer===null&&(this.finishRenderMathTimer=window.setTimeout(()=>{this.finishRenderMathTimer=null,(0,be.finishRenderMath)().catch(()=>{})},0))}renderTableRowLine(e,n,r,o,s){let a=this.getLineText(n),c=this.getTablePipeOffsets(a).filter(b=>b>0&&b<Math.max(0,a.length-1)).map(b=>n.from+b+1),u=[n.from,...c,n.to].filter((b,v,y)=>y.indexOf(b)===v).sort((b,v)=>b-v),d=u.slice(1,-1).filter(b=>b>n.from&&b<n.to),h=this.splitSegmentsAtOffsets(r,d),f=this.createLinePrefixElement(e);f&&e.appendChild(f);let p=document.createElement("span");p.className="tategaki-md-table-row-container",e.appendChild(p);let m=0;for(let b=0;b<u.length-1;b+=1){let v=u[b],y=u[b+1];if(y<=v)continue;let E=document.createElement("span");E.className="tategaki-md-table-cell",p.appendChild(E);let x=[];for(;m<h.length;){let k=h[m];if(k.from<v){m+=1;continue}if(k.from>=y)break;x.push(k),m+=1}let S=(o!=null?o:[]).filter(k=>k.from>=v&&k.from<y),w;if(s){let k=Math.max(n.from,Math.min(s.insertOffset,n.to));k>=v&&k<=y&&(w={insertOffset:k,pendingText:s.pendingText})}this.renderInlineSegmentsWithWidgets(E,n,x,S,w)}let g=document.createElement("span");g.className="tategaki-sot-eol",g.dataset.offset=String(n.to),g.textContent="\u200B",e.appendChild(g)}splitSegmentsAtOffsets(e,n){if(n.length===0)return e;let r=Array.from(new Set(n)).sort((a,l)=>a-l),o=e,s=[];for(let a of r){let l=this.splitSegmentsAtOffset(o,a);s.push(...l.before),o=l.after}return s.push(...o),s}getTablePipeOffsets(e){let n=[],r=s=>{let a=0;for(let l=s-1;l>=0&&e[l]==="\\";l-=1)a+=1;return a%2===1},o=null;for(let s=0;s<e.length;s+=1){let a=e[s];if(a==="`"&&!r(s)){let l=1;for(;s+l<e.length&&e[s+l]==="`";)l+=1;o===null?o=l:o===l&&(o=null),s+=l-1;continue}o===null&&a==="|"&&(r(s)||n.push(s))}return n}getLineElement(e){var o;let n=this.getLineElementOffset(),r=(o=this.derivedContentEl)==null?void 0:o.children[e+n];return r!=null?r:null}getLineElementOffset(){if(!this.derivedContentEl)return 0;let e=this.derivedContentEl.firstElementChild;return e!=null&&e.classList.contains("tategaki-frontmatter")?1:0}getLineText(e){var n,r;return(r=(n=this.sotEditor)==null?void 0:n.getDoc().slice(e.from,e.to))!=null?r:""}findLineIndex(e){return this.findLineIndexInRanges(this.lineRanges,e)}findLineIndexInRanges(e,n){if(e.length===0)return null;let r=0,o=e.length-1;for(;r<=o;){let s=Math.floor((r+o)/2),a=e[s];if(!a)return null;if(n<a.from)o=s-1;else if(n>a.to)r=s+1;else return s}return null}getCaretRectInLine(e,n,r,o=""){var d,h,f,p;let s=(d=e.dataset.mdKind)!=null?d:"";if(s==="image-widget"||s==="embed-widget"||s==="math-widget"||s==="math-hidden"||s==="callout-widget"||s==="callout-hidden"||s==="table-widget"||s==="table-hidden"||s==="deflist-widget"||s==="deflist-hidden"){let m=e.querySelector(".tategaki-sot-eol");return(h=m==null?void 0:m.getBoundingClientRect())!=null?h:e.getBoundingClientRect()}let a=r.to-r.from;if(a===0){let m=this.ceImeMode?this.ensureCeInputPlaceholderNode(e):null,g=e.querySelector(".tategaki-sot-eol"),b=m!=null?m:g!=null&&g.firstChild&&g.firstChild.nodeType===Node.TEXT_NODE?g.firstChild:null;if(b){let y=document.createRange();y.setStart(b,0),y.setEnd(b,0);let E=this.pickCaretRectFromRange(y,o);if(E)return E}let v=e.getBoundingClientRect();return DOMRect.fromRect({x:v.left,y:v.top,width:0,height:v.height})}if(n>=a){let m=this.getLineTextNodes(e),g=m[m.length-1];if(g){let v=document.createRange();v.setStart(g,g.length),v.setEnd(g,g.length);let y=this.pickCaretRectFromRange(v,o);if(y)return y}let b=e.querySelector(".tategaki-sot-eol");return(f=b==null?void 0:b.getBoundingClientRect())!=null?f:e.getBoundingClientRect()}let l=m=>{var y;if(m<0||m>=a)return null;let g=this.findTextNodeAtOffset(e,m),b=this.findTextNodeAtOffset(e,m+1);if(!g||!b)return null;let v=document.createRange();return v.setStart(g.node,g.offset),v.setEnd(b.node,b.offset),(y=this.pickCaretRectFromRange(v,o))!=null?y:v.getBoundingClientRect()};if(n>0&&n<a){let m=l(n-1),g=l(n);if(m&&g){let b=o.startsWith("vertical"),v=Math.abs(b?m.left-g.left:m.top-g.top),y=b?Math.max(1,m.width*.5):Math.max(1,m.height*.5);if(v>y)return g}}let c=this.findTextNodeAtOffset(e,n);if(!c)return e.getBoundingClientRect();let u=document.createRange();return u.setStart(c.node,c.offset),u.setEnd(c.node,c.offset),(p=this.pickCaretRectFromRange(u,o))!=null?p:e.getBoundingClientRect()}pickCaretRectFromRange(e,n){var a;let r=e.getClientRects();if(r.length===0)return e.getBoundingClientRect();if(r.length===1)return(a=r[0])!=null?a:null;if(n.startsWith("vertical")){let l=n!=="vertical-lr",c=r[0];for(let u of Array.from(r))l?u.left>c.left&&(c=u):u.left<c.left&&(c=u);return c}let s=r[0];for(let l of Array.from(r))l.top<s.top&&(s=l);return s}findTextNodeAtOffset(e,n){var h,f;let r=Number.parseInt((h=e.dataset.from)!=null?h:"0",10),o=Number.parseInt((f=e.dataset.to)!=null?f:"0",10),s=Math.max(0,o-r),a=Math.max(0,Math.min(n,s)),l=Array.from(e.querySelectorAll(".tategaki-sot-run"));if(l.length===0){let p=this.getLineTextNodes(e),m=a;for(let b of p){if(m<=b.length)return{node:b,offset:Math.max(0,m)};m-=b.length}let g=p[p.length-1];return g?{node:g,offset:g.length}:null}let c=l.map(p=>{var v,y;let m=Number.parseInt((v=p.dataset.from)!=null?v:"",10),g=Number.parseInt((y=p.dataset.to)!=null?y:"",10),b=p.firstChild&&p.firstChild.nodeType===Node.TEXT_NODE?p.firstChild:null;return{el:p,from:m,to:g,textNode:b}}).filter(p=>Number.isFinite(p.from)&&Number.isFinite(p.to)&&p.to>=p.from&&!!p.textNode).sort((p,m)=>p.from-m.from||p.to-m.to),u=c[0],d=c[c.length-1];if(!u||!d)return null;if(a<=u.from)return{node:u.textNode,offset:0};if(a>=d.to){let p=d.to-d.from;return{node:d.textNode,offset:Math.max(0,Math.min(p,d.textNode.length))}}for(let p=0;p<c.length;p+=1){let m=c[p];if(a>=m.from&&a<=m.to){let b=Math.max(0,a-m.from),v=Math.min(b,m.textNode.length);return{node:m.textNode,offset:v}}let g=c[p+1];if(g&&a>m.to&&a<g.from)return{node:g.textNode,offset:0}}return{node:d.textNode,offset:Math.max(0,Math.min(d.to-d.from,d.textNode.length))}}getLineTextNodes(e){let n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),o=r.nextNode();for(;o;)!this.isPendingTextNode(o)&&!this.isEolTextNode(o)&&!this.isCeInputPlaceholderTextNode(o)&&!this.isInlineWidgetTextNode(o)&&n.push(o),o=r.nextNode();return n}isPendingTextNode(e){let n=e.parentElement;return!!(n!=null&&n.classList.contains("tategaki-sot-pending-spacer"))}isEolTextNode(e){let n=e.parentElement;return!!(n!=null&&n.classList.contains("tategaki-sot-eol"))}isCeInputPlaceholderTextNode(e){let n=e.parentElement;return!!(n!=null&&n.classList.contains("tategaki-sot-ce-input-placeholder"))}ensureCeInputPlaceholderNode(e){if(!this.ceImeMode)return null;let n=e.querySelector(".tategaki-sot-ce-input-placeholder");if(!n){n=document.createElement("span"),n.className="tategaki-sot-ce-input-placeholder",n.textContent="\u200B";let o=e.querySelector(".tategaki-sot-eol");o?e.insertBefore(n,o):e.appendChild(n)}let r=n.firstChild;return(r==null?void 0:r.nodeType)===Node.TEXT_NODE?r:null}isInlineWidgetTextNode(e){let n=e.parentElement;return!!(n!=null&&n.closest(".tategaki-md-inline-widget"))}isUnsafeCeSelectionNode(e){var r;if(!e)return!1;if(this.isPendingTextNode(e)||this.isEolTextNode(e))return!0;let n=e instanceof Element?e:(r=e.parentElement)!=null?r:null;return n?!!(n.classList.contains("tategaki-sot-line")||n.closest(".tategaki-sot-eol")||n.closest(".tategaki-sot-pending-spacer")):!1}scheduleCeSafetyCheck(){be.Platform.isMobile||be.Platform.isMobileApp||!this.ceImeMode||this.ceImeComposing||this.ceImeSelectionSyncing||this.ceImeFallbackActive||Date.now()-this.ceSafetyCheckAt<80||this.ceSafetyCheckRaf===null&&(this.ceSafetyCheckRaf=window.requestAnimationFrame(()=>{this.ceSafetyCheckRaf=null,this.ceSafetyCheckAt=Date.now(),this.verifyCeSelectionContext()}))}verifyCeSelectionContext(){var y,E;if(!this.ceImeMode||this.ceImeComposing||this.ceImeSelectionSyncing||!this.sotEditor||!this.derivedContentEl)return;let e=this.derivedContentEl.ownerDocument.getSelection();if(!e||!e.isCollapsed||!this.isSelectionInsideDerivedContent(e))return;let n=e.anchorNode;if(!n)return;let r=this.getLineElementForNode(n);if(!r||this.shouldSkipCeSafetyCheckLine(r))return;let o=Number.parseInt((y=r.dataset.from)!=null?y:"0",10),s=Number.parseInt((E=r.dataset.to)!=null?E:"0",10),a=Math.max(0,s-o);if(a===0)return;if(n.nodeType!==Node.TEXT_NODE){this.isUnsafeCeSelectionNode(n)&&this.recordCeMappingFailure("verification",!0);return}if(this.isPendingTextNode(n)||this.isEolTextNode(n)||this.isCeInputPlaceholderTextNode(n)){this.recordCeMappingFailure("verification",!0);return}let l=this.resolveOffsetFromCaretPosition(r,{node:n,offset:e.anchorOffset},a);if(l===null){this.recordCeMappingFailure("verification",!0);return}let c=o+l,u=this.buildSegmentsForLine(o,s);if(u.length===0)return;let d=u.reduce((x,S)=>x+S.text.length,0);if(d===0||d>2e3)return;let h=this.getVisibleOffsetFromSegments(u,c),f=this.getVisibleOffsetFromDomPosition(r,n,e.anchorOffset);if(f===null){this.recordCeMappingFailure("verification",!0);return}if(Math.abs(f-h)>1){this.recordCeMappingFailure("verification",!0);return}let p=16,m=Math.max(0,h-p),g=Math.min(d,h+p),b=this.getSegmentsTextRange(u,m,g),v=this.getDomTextRange(r,m,g);b!==v&&this.recordCeMappingFailure("verification",!0)}shouldSkipCeSafetyCheckLine(e){var r;let n=(r=e.dataset.mdKind)!=null?r:"";return n.endsWith("-widget")||n.endsWith("-hidden")||n==="table-row"||n==="table-sep"?!0:e.querySelector(".tategaki-md-inline-widget")!==null}getVisibleOffsetFromSegments(e,n){let r=0;for(let o of e){if(n<=o.from)return r;if(n<o.to)return r+Math.max(0,n-o.from);r+=o.to-o.from}return r}getVisibleOffsetFromDomPosition(e,n,r){let o=this.getLineTextNodes(e),s=0;for(let a of o){if(a===n)return s+Math.max(0,Math.min(r,a.length));s+=a.length}return null}getSegmentsTextRange(e,n,r){if(r<=n)return"";let o=0,s=[];for(let a of e){let l=a.text.length,c=o,u=o+l;if(u<=n){o=u;continue}if(c>=r)break;let d=Math.max(0,n-c),h=Math.min(l,r-c);h>d&&s.push(a.text.slice(d,h)),o=u}return s.join("")}getDomTextRange(e,n,r){if(r<=n)return"";let o=this.getLineTextNodes(e),s=0,a=[];for(let l of o){let c=l.length,u=s,d=s+c;if(d<=n){s=d;continue}if(u>=r)break;let h=Math.max(0,n-u),f=Math.min(c,r-u);f>h&&a.push(l.data.slice(h,f)),s=d}return a.join("")}resolveOffsetFromCaretPosition(e,n,r){var a;if(!n)return null;let{node:o,offset:s}=n;if(!e.contains(o))return null;if(o instanceof Element&&o.classList.contains("tategaki-sot-line"))return this.resolveOffsetFromLineElementSelection(e,s,r);if(this.isPendingTextNode(o))return(a=this.pendingLocalOffset)!=null?a:0;if(this.isEolTextNode(o))return r;if(this.isCeInputPlaceholderTextNode(o))return 0;if(o.nodeType===Node.TEXT_NODE)return this.calculateOffsetWithinLine(e,o,s);if(o instanceof Element){if(o.classList.contains("tategaki-sot-run")){let c=o.firstChild;if((c==null?void 0:c.nodeType)===Node.TEXT_NODE){let u=c,d=s>0?u.length:0;return this.calculateOffsetWithinLine(e,u,d)}}if(o.classList.contains("tategaki-sot-eol"))return r;if(o.classList.contains("tategaki-sot-ce-input-placeholder"))return 0;let l=o.firstChild;if((l==null?void 0:l.nodeType)===Node.TEXT_NODE){let c=l,u=s>0?c.length:0;return this.calculateOffsetWithinLine(e,c,u)}}return null}resolveOffsetFromLineElementSelection(e,n,r){var c,u;let o=e.childNodes.length;if(o===0||n<=0)return 0;if(n>=o)return r;let s=(d,h)=>{var f,p,m;if(this.isPendingTextNode(d))return(f=this.pendingLocalOffset)!=null?f:0;if(this.isEolTextNode(d))return r;if(this.isCeInputPlaceholderTextNode(d))return 0;if(d.nodeType===Node.TEXT_NODE){let g=d,b=h?g.length:0;return this.calculateOffsetWithinLine(e,g,b)}if(d instanceof Element){if(d.classList.contains("tategaki-sot-eol"))return r;if(d.classList.contains("tategaki-sot-ce-input-placeholder"))return 0;if(d.classList.contains("tategaki-sot-run")||d.classList.contains("tategaki-md-inline-widget")){let b=d,v=Number.parseInt((p=b.dataset.from)!=null?p:"",10),y=Number.parseInt((m=b.dataset.to)!=null?m:"",10);if(Number.isFinite(v)&&Number.isFinite(y))return h?y:v}let g=d.firstChild;if((g==null?void 0:g.nodeType)===Node.TEXT_NODE){let b=g,v=h?b.length:0;return this.calculateOffsetWithinLine(e,b,v)}}return null},a=(c=e.childNodes[n-1])!=null?c:null,l=(u=e.childNodes[n])!=null?u:null;if(a){let d=s(a,!0);if(d!==null)return d}if(l){let d=s(l,!1);if(d!==null)return d}return r}getEdgeOffsetFromPoint(e,n,r,o,s){var c;if(s<=0)return 0;let a=Br(o,e.getBoundingClientRect()),l=window.getComputedStyle((c=this.derivedRootEl)!=null?c:e).writingMode;return l.startsWith("vertical")?l!=="vertical-lr"?n<a.left?s:0:n>a.right?s:0:n<=a.left||r<=a.top?0:n>=a.right||r>=a.bottom?s:0}getLocalOffsetFromPoint(e,n,r,o){if(o<=0)return 0;let s=e.ownerDocument;if(!s)return null;let a=this.resolveOffsetFromCaretPosition(e,Dr(s,n,r),o);if(a!==null)return Math.max(0,Math.min(a,o));let l=this.getLineVisualRects(e),c=l.length>0?l[this.findClosestRectIndex(l,n,r)]:e.getBoundingClientRect(),u=kE(c,n,r),d=this.resolveOffsetFromCaretPosition(e,Dr(s,u.x,u.y),o);return d!==null?Math.max(0,Math.min(d,o)):this.getEdgeOffsetFromPoint(e,n,r,l,o)}calculateOffsetWithinLine(e,n,r){var d,h,f,p,m,g;let o=Number.parseInt((d=e.dataset.from)!=null?d:"0",10),s=Number.parseInt((h=e.dataset.to)!=null?h:"0",10),a=Math.max(0,s-o),l=(f=n.parentElement)==null?void 0:f.closest(".tategaki-sot-run");if(l){let b=Number.parseInt((p=l.dataset.from)!=null?p:"",10),v=Number.parseInt((m=l.dataset.to)!=null?m:"",10);if(Number.isFinite(b)&&Number.isFinite(v)){let y=Math.max(0,v-b),E=Math.max(0,Math.min(r,y));if(E>=y){let S=l.nextElementSibling;for(;S;){if(S.classList.contains("tategaki-sot-run")){let w=Number.parseInt((g=S.dataset.from)!=null?g:"",10);if(Number.isFinite(w)&&w>v)return Math.max(0,Math.min(w,a));break}S=S.nextElementSibling}}let x=b+E;return Math.max(0,Math.min(x,a))}}let c=this.getLineTextNodes(e),u=0;for(let b of c){if(b===n)return u+Math.min(r,b.length);u+=b.length}return Math.max(0,Math.min(u,a))}getVisualMoveInfo(e,n){var C,O,H,K;if(!this.derivedRootEl||!this.sotEditor)return null;let r=n.startsWith("vertical"),o=!r;if(r&&!(e==="ArrowLeft"||e==="ArrowRight")||o&&!(e==="ArrowUp"||e==="ArrowDown"))return null;let c=this.sotEditor.getSelection().head,u=this.findLineIndex(c);if(u===null)return null;let d=this.lineRanges[u],h=this.getLineElement(u);if(!d||!h)return null;let f=d.to-d.from;if(f<=0)return{offset:null,atBoundary:!1};let p=Math.max(0,Math.min(c-d.from,f)),m=this.getCaretRectInLine(h,p,d,n);if(!m)return null;let g=this.getLineVisualRects(h);if(g.length<=1)return{offset:null,atBoundary:!1};let b=g.slice().sort((W,te)=>r?W.left-te.left||W.top-te.top:W.top-te.top||W.left-te.left),v=m.left+(m.width||0)/2,y=m.top+(m.height||0)/2,S=this.findClosestRectIndex(b,v,y)+(r&&e==="ArrowLeft"?-1:r&&e==="ArrowRight"?1:o&&e==="ArrowUp"?-1:1);if(S<0||S>=b.length){let W=r?n==="vertical-lr"?e==="ArrowRight"?1:-1:e==="ArrowLeft"?1:-1:e==="ArrowDown"?1:-1,te=r?m.left:m.top,J=r?e==="ArrowRight"?1:-1:e==="ArrowDown"?1:-1,Q=this.findNextVisualLineOffsetInLine(h,d,c,n,W>0,te,J);if(Q!==null)return{offset:Q,atBoundary:!1};let Ae=this.sotEditor.getDoc(),$e=this.getNextOffset(Ae,c,e,n),ke=this.findLineIndex($e);if(ke===null||ke===u)return{offset:c,atBoundary:!1};let ce=this.getLineElement(ke),We=this.lineRanges[ke];if(!ce||!We)return{offset:c,atBoundary:!1};let dt=Math.max(0,We.to-We.from);if(dt<=0)return{offset:We.from,atBoundary:!1};let Ct=v,vt=y,ht=this.getLocalOffsetFromPoint(ce,Ct,vt,dt);if(ht===null)return{offset:We.from,atBoundary:!1};let Ue=Math.max(0,Math.min(ht,dt));return{offset:We.from+Ue,atBoundary:!1}}let w=b[S],k=v,M=y;if(r){if(k=w.left+w.width/2,w.height>2){let W=w.top+1,te=w.bottom-1;M=Math.max(W,Math.min(y,te))}}else if(M=w.top+w.height/2,w.width>2){let W=w.left+1,te=w.right-1;k=Math.max(W,Math.min(v,te))}let L=this.getLocalOffsetFromPoint(h,k,M,f);if(L===null)return{offset:null,atBoundary:!0};let _=Math.max(0,Math.min(L,f)),P=d.from+_,I=this.getCaretRectInLine(h,_,d,n),N=1,D=((C=I==null?void 0:I.left)!=null?C:0)+((O=I==null?void 0:I.width)!=null?O:0)/2,R=((H=I==null?void 0:I.top)!=null?H:0)+((K=I==null?void 0:I.height)!=null?K:0)/2;if(!(!!I&&D>=w.left-N&&D<=w.right+N&&R>=w.top-N&&R<=w.bottom+N)||P===c){let W=r?n==="vertical-lr"?e==="ArrowRight"?1:-1:e==="ArrowLeft"?1:-1:e==="ArrowDown"?1:-1,te=r?m.left:m.top,J=r?e==="ArrowRight"?1:-1:e==="ArrowDown"?1:-1,Q=this.findNextVisualLineOffsetInLine(h,d,c,n,W>0,te,J);return Q!==null&&Q!==c?(P=Q,{offset:P,atBoundary:!1}):{offset:null,atBoundary:!0}}return{offset:P,atBoundary:!1}}findNextVisibleOffsetInLine(e,n,r){let o=Math.max(e.from,Math.min(n,e.to)),s=this.buildSegmentsForLine(e.from,e.to);if(s.length===0)return null;if(r){for(let a of s){if(o<a.from)return a.from;if(o>=a.from&&o<a.to)return Math.min(a.to,o+1)}return null}for(let a=s.length-1;a>=0;a-=1){let l=s[a];if(o>l.to)return l.to;if(o>l.from&&o<=l.to)return Math.max(l.from,o-1)}return null}findNextVisualLineOffsetInLine(e,n,r,o,s,a,l){let u=r;for(let d=0;d<2e3;d+=1){let h=this.findNextVisibleOffsetInLine(n,u,s);if(h===null||h===u)return null;let f=Math.max(0,Math.min(h-n.from,n.to-n.from)),p=this.getCaretRectInLine(e,f,n,o);if(!p)return null;let m=o.startsWith("vertical")?p.left:p.top;if(l>0?m>a+.5:m<a-.5)return h;u=h}return null}adjustCrossParagraphOffset(e,n){let r=this.findLineIndex(e),o=this.findLineIndex(n);if(r===null||o===null||o>=r)return n;let s=this.lineRanges[o];return s?s.to:n}getLineVisualRects(e){var l;let n=this.getLineTextNodes(e);if(n.length===0){let c=e.querySelector(".tategaki-sot-eol");return[(l=c==null?void 0:c.getBoundingClientRect())!=null?l:e.getBoundingClientRect()]}let r=document.createRange();r.setStart(n[0],0);let o=n[n.length-1];r.setEnd(o,o.length);let s=Array.from(r.getClientRects());if(s.length===0)return[e.getBoundingClientRect()];let a=[];for(let c of s){if(c.width<=0&&c.height<=0)continue;a.some(d=>Math.abs(d.left-c.left)<.5&&Math.abs(d.right-c.right)<.5&&Math.abs(d.top-c.top)<.5&&Math.abs(d.bottom-c.bottom)<.5)||a.push(c)}return this.mergeVisualLineRects(a)}mergeVisualLineRects(e){var s;if(e.length<=1)return e;let n=this.writingMode.startsWith("vertical"),r=Math.max(8,((s=this.getEffectiveFontSize())!=null?s:18)*.5),o=[];for(let a of e){let l=!1;for(let c of o){let u=c[0];if(!u)continue;if(n?Math.abs(a.left-u.left)<r||Math.abs(a.right-u.right)<r:Math.abs(a.top-u.top)<r||Math.abs(a.bottom-u.bottom)<r){c.push(a),l=!0;break}}l||o.push([a])}return o.map(a=>{let l=a[0];if(a.length===1&&l)return l;let c=1/0,u=1/0,d=-1/0,h=-1/0;for(let f of a)c=Math.min(c,f.left),u=Math.min(u,f.top),d=Math.max(d,f.right),h=Math.max(h,f.bottom);return new DOMRect(c,u,d-c,h-u)})}getEffectiveFontSize(){if(!this.derivedRootEl)return null;let e=window.getComputedStyle(this.derivedRootEl);return parseFloat(e.fontSize)||null}findClosestRectIndex(e,n,r){let o=0,s=Number.POSITIVE_INFINITY;for(let a=0;a<e.length;a+=1){let l=e[a];if(!l)continue;let c=n<l.left?l.left-n:n>l.right?n-l.right:0,u=r<l.top?l.top-r:r>l.bottom?r-l.bottom:0,d=c*c+u*u;d<s&&(s=d,o=a)}return o}getNextOffset(e,n,r,o){let s=Math.max(0,Math.min(n,e.length)),a=this.getLineInfo(e,s),l=o.startsWith("vertical"),c=o!=="vertical-lr";return l?r==="ArrowUp"?a.column<=0?a.lineStart>0?a.lineStart-1:s:Math.max(a.lineStart,s-1):r==="ArrowDown"?s>=a.lineEnd?a.lineEnd<e.length?a.lineEnd+1:s:Math.min(a.lineEnd,s+1):r==="ArrowLeft"?c?s>=a.lineEnd?this.getNextLineStart(e,a):this.moveToNextLine(e,a):s<=a.lineStart?this.getPrevLineEnd(e,a):this.moveToPrevLine(e,a):r==="ArrowRight"?c?s<=a.lineStart?this.getPrevLineEnd(e,a):this.moveToPrevLine(e,a):s>=a.lineEnd?this.getNextLineStart(e,a):this.moveToNextLine(e,a):s:r==="ArrowLeft"?Math.max(0,s-1):r==="ArrowRight"?Math.min(e.length,s+1):r==="ArrowUp"?this.moveToPrevLine(e,a):r==="ArrowDown"?this.moveToNextLine(e,a):s}getLineInfo(e,n){let r=e.lastIndexOf(`
`,Math.max(0,n-1))+1,o=e.indexOf(`
`,n),s=o===-1?e.length:o,a=Math.max(0,Math.min(n-r,s-r));return{lineStart:r,lineEnd:s,column:a}}moveToPrevLine(e,n){if(n.lineStart===0)return n.lineStart+n.column;let r=n.lineStart-1,o=e.lastIndexOf(`
`,Math.max(0,r-1))+1,s=r-o;return o+Math.min(n.column,s)}moveToNextLine(e,n){if(n.lineEnd>=e.length)return n.lineEnd;let r=n.lineEnd+1,o=e.indexOf(`
`,r),a=(o===-1?e.length:o)-r;return r+Math.min(n.column,a)}getNextLineStart(e,n){return n.lineEnd>=e.length?n.lineEnd:n.lineEnd+1}getPrevLineEnd(e,n){return n.lineStart<=0?0:Math.min(e.length,n.lineStart-1)}};var UE=require("obsidian"),Ol=class extends UE.Modal{constructor(e,n={}){var s,a;super(e);this.resolveResult=null;this.cancelled=!1;this.showCompat=!1;let r=(s=n.placement)!=null?s:n.openInNewWindow?"window":n.openOnRightSide===!1?"tab":"right";this.result={mode:null,openInNewWindow:r==="window",openOnRightSide:r==="right",placement:r},this.showCompat=(a=n.showCompat)!=null?a:!1;let o=n.defaultMode==="preview"?"edit":n.defaultMode;if(o==="compat"&&!this.showCompat){this.result.mode="edit";return}(o==="edit"||o==="compat")&&(this.result.mode=o)}openAndWait(){return new Promise(e=>{this.resolveResult=e,this.open()})}onOpen(){this.titleEl.setText("Tategaki\u30A8\u30C7\u30A3\u30BF\u3092\u958B\u304F"),this.contentEl.createEl("p",{text:"\u8868\u793A\u30E2\u30FC\u30C9\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"});let e=this.contentEl.createDiv();e.style.cssText=`
			display: flex;
			flex-direction: column;
			gap: 12px;
			margin: 12px 0;
		`,this.createModeButton(e,"edit","\u57F7\u7B46\u30FB\u53C2\u7167\u30E2\u30FC\u30C9","SoT\u30D3\u30E5\u30FC\u3067\u7DE8\u96C6\u30FB\u53C2\u7167\u3092\u884C\u3044\u307E\u3059\u3002"),this.createModeButton(e,"reading","\u66F8\u7C4D\u30E2\u30FC\u30C9","\u7E26\u66F8\u304D\u8AAD\u66F8\u30E2\u30FC\u30C9\u3067\u3001\u30DA\u30FC\u30B8\u3081\u304F\u308A\u30B9\u30BF\u30A4\u30EB\u3067\u95B2\u89A7\u3057\u307E\u3059\u3002"),this.showCompat&&this.createModeButton(e,"compat","\u4E92\u63DB\u30E2\u30FC\u30C9\uFF08\u65E7TipTap\uFF09","\u65E7TipTap\u30D9\u30FC\u30B9\u306E\u4E92\u63DB\u30D3\u30E5\u30FC\u3067\u7DE8\u96C6\u3057\u307E\u3059\u3002");let n=this.contentEl.createDiv();n.style.cssText=`
			display: flex;
			align-items: center;
			gap: 12px;
			margin-top: 8px;
			flex-wrap: wrap;
		`;let r=p=>{this.result.placement=p,this.result.openOnRightSide=p==="right",this.result.openInNewWindow=p==="window"},o=this.result.placement,s=n.createEl("label");s.style.cssText="display: inline-flex; gap: 6px; align-items: center;";let a=s.createEl("input",{type:"radio"});a.name="tategaki-open-placement",a.checked=o==="right",a.addEventListener("change",()=>{a.checked&&r("right")}),s.appendText("\u53F3\u5074\u306B\u958B\u304F");let l=n.createEl("label");l.style.cssText="display: inline-flex; gap: 6px; align-items: center;";let c=l.createEl("input",{type:"radio"});c.name="tategaki-open-placement",c.checked=o==="tab",c.addEventListener("change",()=>{c.checked&&r("tab")}),l.appendText("\u96A3\u306E\u30BF\u30D6\u306B\u958B\u304F");let u=n.createEl("label");u.style.cssText="display: inline-flex; gap: 6px; align-items: center;";let d=u.createEl("input",{type:"radio"});d.name="tategaki-open-placement",d.checked=o==="window",d.addEventListener("change",()=>{d.checked&&r("window")}),u.appendText("\u65B0\u898F\u30A6\u30A3\u30F3\u30C9\u30A6\u3067\u958B\u304F");let h=this.contentEl.createDiv();h.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
		`,h.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB"}).addEventListener("click",()=>{this.cancelled=!0,this.close()});let f=h.createEl("button",{text:"\u958B\u304F",cls:"mod-cta"});f.disabled=this.result.mode==null,f.addEventListener("click",()=>{this.result.mode!=null&&this.close()}),this.contentEl.addEventListener("change",()=>{f.disabled=this.result.mode==null})}onClose(){this.contentEl.empty();let e=this.resolveResult;this.resolveResult=null,this.cancelled?e==null||e({mode:null,openInNewWindow:!1,openOnRightSide:!1,placement:"right"}):e==null||e({...this.result})}createModeButton(e,n,r,o){let s=e.createDiv();s.style.cssText=`
			border: 1px solid var(--background-modifier-border);
			border-radius: 8px;
			padding: 10px 12px;
			background: var(--background-primary);
		`;let a=s.createDiv();a.style.cssText=`
			display: flex;
			align-items: center;
			gap: 10px;
		`;let l=a.createEl("input",{type:"radio"});l.name="tategaki-view-mode",l.checked=this.result.mode===n,l.addEventListener("change",()=>{this.result.mode=n});let c=a.createEl("div");c.style.cssText="font-weight: 700;",c.setText(r);let u=s.createEl("div");u.style.cssText="margin-top: 6px; color: var(--text-muted);",u.setText(o),s.addEventListener("click",()=>{this.result.mode=n,l.checked=!0,l.dispatchEvent(new Event("change"))})}};var KE=require("obsidian"),Uo=class extends KE.Modal{constructor(t){super(t)}onOpen(){this.titleEl.setText("Tategaki\u30D3\u30E5\u30FC\u304C\u65E2\u306B\u958B\u304B\u308C\u3066\u3044\u307E\u3059"),this.contentEl.createEl("p",{text:"\u65E2\u306BTategaki\u30D3\u30E5\u30FC\uFF08\u57F7\u7B46\u30E2\u30FC\u30C9\u3001\u53C2\u7167\u30E2\u30FC\u30C9\u3001\u307E\u305F\u306F\u66F8\u7C4D\u30E2\u30FC\u30C9\uFF09\u304C\u958B\u304B\u308C\u3066\u3044\u307E\u3059\u3002\u65B0\u3057\u3044\u30D3\u30E5\u30FC\u3092\u958B\u304F\u306B\u306F\u3001\u65E2\u5B58\u306E\u30D3\u30E5\u30FC\u3092\u9589\u3058\u3066\u304F\u3060\u3055\u3044\u3002"});let t=this.contentEl.createDiv();t.style.cssText=`
			display: flex;
			justify-content: flex-end;
			margin-top: 16px;
		`,t.createEl("button",{text:"OK",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var Hr=class{constructor(t,e,n){this.openInNewWindow=!1;this.openOnRightSide=!0;this.managedLeaves=new Set;this.workspaceGuards=[];this.primaryLeaf=null;this.enforceTimer=null;this.nextViewMode=null;this.app=t,this.settings=e,this.plugin=n}async registerViews(){var e,n,r,o,s,a,l,c,u;try{let d=[...this.app.workspace.getLeavesOfType(st),...this.app.workspace.getLeavesOfType(qt)];if(d.length>0){for(let h of d){let f=h.view;try{(r=(n=(e=f==null?void 0:f.syncManager)==null?void 0:e.getState)==null?void 0:n.call(e))!=null&&r.dirty?await((s=(o=f.syncManager).flush)==null?void 0:s.call(o)):typeof(f==null?void 0:f.handleAppQuit)=="function"&&await f.handleAppQuit("save")}catch(p){Ee("Tategaki: failed to flush view before detach",p)}}d.forEach(h=>h.detach()),await new Promise(h=>setTimeout(h,100))}}catch(d){Ee("Tategaki: Error checking existing views",d)}let t=this.app.viewRegistry;(a=t==null?void 0:t.viewByType)!=null&&a[st]||this.plugin.registerView(st,d=>new _r(d,this.plugin,st)),(l=t==null?void 0:t.viewByType)!=null&&l[qt]||this.plugin.registerView(qt,d=>new _r(d,this.plugin,qt)),(c=t==null?void 0:t.viewByType)!=null&&c[_t]||this.plugin.registerView(_t,d=>new ml(d,this.plugin)),(u=t==null?void 0:t.viewByType)!=null&&u[Tt]||this.plugin.registerView(Tt,d=>new Vi(d,this.plugin)),this.setupWorkspaceGuards(),this.applySingleViewConstraints()}async openView(t){var o,s,a,l;let e=this.getAllEditorLeaves(),n=this.getAllReadingLeaves();if(e.length>0||n.length>0){new Uo(this.app).open();return}let r=(o=this.settings.lastViewOpenPlacement)!=null?o:"right";if(this.settings.showModeDialog){let u=await new Ol(this.app,{defaultMode:(s=this.settings.lastViewMode)!=null?s:"edit",placement:r,showCompat:(a=this.settings.enableLegacyTiptap)!=null?a:!0}).openAndWait();if(!u.mode)return;this.openInNewWindow=u.openInNewWindow,this.openOnRightSide=u.openOnRightSide,this.nextViewMode=u.mode,u.mode!=="reading"?await this.plugin.updateSettings({lastViewMode:u.mode,lastViewOpenPlacement:u.placement}):await this.plugin.updateSettings({lastViewOpenPlacement:u.placement})}else{this.openInNewWindow=r==="window",this.openOnRightSide=r==="right";let c=this.settings.lastViewMode==="preview"?"edit":(l=this.settings.lastViewMode)!=null?l:"edit";this.nextViewMode=c==="compat"&&!this.settings.enableLegacyTiptap?"edit":c}try{if(this.nextViewMode==="reading"){let c=this.app.workspace.getActiveFile();c&&await this.toggleReadingView(c,{openInNewWindow:this.openInNewWindow,openOnRightSide:this.openOnRightSide})}else if(this.nextViewMode==="compat"){if(!this.settings.enableLegacyTiptap){new Dl.Notice("\u4E92\u63DB\u30E2\u30FC\u30C9\u304C\u7121\u52B9\u3067\u3059\u3002\u8A2D\u5B9A\u3067\u6709\u52B9\u5316\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2500);return}await this.openTipTapView()}else{let c=this.resolveRetainedFile();if(!c)return;await this.openSoTWysiwygView(c,{openInNewWindow:this.openInNewWindow,openOnRightSide:this.openOnRightSide})}}finally{this.nextViewMode=null}}async onSettingsChanged(t){var r,o;this.settings=t;let e=this.getAllEditorLeaves();for(let s of e){let a=s.view;await((r=a.updateSettings)==null?void 0:r.call(a,t))}let n=this.getAllReadingLeaves();for(let s of n){let a=s.view;await((o=a.updateSettings)==null?void 0:o.call(a,t))}}cleanup(){for(let t of this.managedLeaves)try{t.__tategakiManaged&&(t.detach(),delete t.__tategakiManaged)}catch(e){Ee("Tategaki: failed to detach managed leaf",e)}this.managedLeaves.clear(),this.primaryLeaf=null,this.openInNewWindow=!1,this.clearEnforcementTimer(),this.disposeWorkspaceGuards(),this.unregisterViews()}unregisterViews(){try{this.getAllEditorLeaves().forEach(n=>n.detach()),this.getAllReadingLeaves().forEach(n=>n.detach())}catch(t){Ee("Tategaki: failed to close views",t)}}async toggleReadingView(t,e){var s,a,l,c,u;if(!t)return!1;if(this.getAllEditorLeaves().length>0&&!(e!=null&&e.targetLeaf))return new Uo(this.app).open(),!1;let r=(s=e==null?void 0:e.targetLeaf)!=null?s:null;if(r){if(((l=(a=r.view)==null?void 0:a.getViewType)==null?void 0:l.call(a))===_t){let h=(c=e==null?void 0:e.returnViewMode)!=null?c:"sot";return h==="sot"?await this.openSoTWysiwygViewInLeaf(t,r):await this.openTipTapViewInLeaf(t,r,h),!1}return await this.openReadingViewInLeaf(t,r,(u=e==null?void 0:e.returnViewMode)!=null?u:"sot"),!0}let o=this.findReadingLeafForFile(t.path);if(o){try{o.detach()}catch(d){Ee("Tategaki: failed to close reading view",d)}return!1}return await this.openReadingView(t,e),!0}isReadingViewOpenForFile(t){return t?Boolean(this.findReadingLeafForFile(t)):!1}async openReadingViewInLeaf(t,e,n="sot"){await e.setViewState({type:_t,state:{filePath:t.path,returnViewMode:n},active:!0}),this.app.workspace.setActiveLeaf(e)}async openTipTapViewInLeaf(t,e,n="edit"){this.prepareLeafInitialFile(e,t),this.prepareLeafInitialViewMode(e,n),await e.setViewState({type:st,active:!0}),this.app.workspace.setActiveLeaf(e),this.trackManagedLeaf(e)}async openSoTWysiwygViewInLeaf(t,e){this.prepareLeafInitialFile(e,t),await e.setViewState({type:Tt,active:!0}),this.app.workspace.setActiveLeaf(e),this.trackManagedLeaf(e),this.applySingleViewConstraints()}async openSoTWysiwygView(t,e){var n,r;this.openInNewWindow=(n=e==null?void 0:e.openInNewWindow)!=null?n:!1,this.openOnRightSide=(r=e==null?void 0:e.openOnRightSide)!=null?r:!0,this.openInNewWindow?await this.openInPopout(Tt,t,"edit"):await this.openInPane(Tt,t,"edit"),this.openInNewWindow=!1,this.openOnRightSide=!0,this.applySingleViewConstraints()}async openReadingView(t,e){var s,a,l;let n=(s=e==null?void 0:e.openInNewWindow)!=null?s:!1,r=(a=e==null?void 0:e.openOnRightSide)!=null?a:!0,o;if(n)o=this.app.workspace.getLeaf("window");else if(r){let c=this.app.workspace.getLeaf(!1);o=this.app.workspace.createLeafBySplit(c,"vertical",!1)}else o=this.app.workspace.getLeaf("tab");await this.openReadingViewInLeaf(t,o,(l=e==null?void 0:e.returnViewMode)!=null?l:"sot")}async openTipTapView(){let t=this.resolveRetainedFile(),e="edit",n=this.openInNewWindow||this.isPopoutLeaf(this.primaryLeaf),r=null;if(this.isLeafAvailable(this.primaryLeaf)){let o=this.isPopoutLeaf(this.primaryLeaf);n===o&&(r=this.primaryLeaf)}r?(this.prepareLeafInitialFile(r,t),this.prepareLeafInitialViewMode(r,e),await r.setViewState({type:st,active:!0}),this.app.workspace.setActiveLeaf(r),this.trackManagedLeaf(r)):r=n?await this.openInPopout(st,t,e):await this.openInPane(st,t,e),this.openInNewWindow=!1,this.openOnRightSide=!0,this.applySingleViewConstraints()}async openInPane(t,e=null,n="edit"){var o;let r;if(this.openOnRightSide){let s=this.app.workspace.getLeaf(!1);r=this.app.workspace.createLeafBySplit(s,"vertical",!1)}else r=(o=this.getReusableLeaf())!=null?o:this.app.workspace.getLeaf("tab");return this.prepareLeafInitialFile(r,e),this.prepareLeafInitialViewMode(r,n),await r.setViewState({type:t,active:!0}),this.app.workspace.setActiveLeaf(r),r.__tategakiPopout=!1,this.trackManagedLeaf(r),r}async openInPopout(t,e=null,n="edit"){var r;try{let o=(r=this.getReusableLeaf(!0))!=null?r:this.app.workspace.getLeaf("window");return this.prepareLeafInitialFile(o,e),this.prepareLeafInitialViewMode(o,n),await o.setViewState({type:t,active:!0}),this.app.workspace.setActiveLeaf(o),o.__tategakiPopout=!0,this.trackManagedLeaf(o),o}catch(o){return Ee("Tategaki: popout failed, falling back to pane",o),await this.openInPane(t,e,n)}}trackManagedLeaf(t){t.__tategakiManaged||(t.__tategakiManaged=!0),this.managedLeaves.add(t),this.primaryLeaf=t}resolveRetainedFile(){var e;let t=this.getCurrentManagedFilePath();if(t){let n=this.app.vault.getAbstractFileByPath(t);if(n instanceof Dl.TFile)return n}return(e=this.app.workspace.getActiveFile())!=null?e:null}getCurrentManagedFilePath(){let t=this.app.workspace.activeLeaf,e=this.extractFilePathFromLeaf(t);if(e)return e;if(this.primaryLeaf&&this.primaryLeaf!==t){let n=this.extractFilePathFromLeaf(this.primaryLeaf);if(n)return n}return null}extractFilePathFromLeaf(t){if(!t)return null;let e=t.view;if(e&&typeof e.getCurrentFilePath=="function")try{let n=e.getCurrentFilePath();return typeof n=="string"?n:null}catch(n){Ee("Tategaki: failed to read current file path from view",n)}return null}findReadingLeafForFile(t){var n,r;let e=this.getAllReadingLeaves();for(let o of e){let s=o.view;if(((r=(n=s.getCurrentFilePath)==null?void 0:n.call(s))!=null?r:null)===t)return o}return null}prepareLeafInitialFile(t,e){t&&(e?t[Hr.INITIAL_FILE_PROP]=e:delete t[Hr.INITIAL_FILE_PROP])}prepareLeafInitialViewMode(t,e){t&&(e==="edit"?t[Hr.INITIAL_VIEW_MODE_PROP]=e:delete t[Hr.INITIAL_VIEW_MODE_PROP])}getAllEditorLeaves(){return[...this.app.workspace.getLeavesOfType(st),...this.app.workspace.getLeavesOfType(qt),...this.app.workspace.getLeavesOfType(Tt)]}getAllReadingLeaves(){return this.app.workspace.getLeavesOfType(_t)}setupWorkspaceGuards(){this.disposeWorkspaceGuards();let t=()=>this.scheduleEnforceSingleView();this.workspaceGuards.push(this.app.workspace.on("layout-change",t)),this.workspaceGuards.push(this.app.workspace.on("leaf-open",t)),this.workspaceGuards.push(this.app.workspace.on("leaf-detach",t))}disposeWorkspaceGuards(){for(;this.workspaceGuards.length>0;){let t=this.workspaceGuards.pop();t&&this.app.workspace.offref(t)}}scheduleEnforceSingleView(){this.enforceTimer===null&&(this.enforceTimer=setTimeout(()=>{this.enforceTimer=null,this.applySingleViewConstraints()},16))}clearEnforcementTimer(){this.enforceTimer!==null&&(clearTimeout(this.enforceTimer),this.enforceTimer=null)}applySingleViewConstraints(){let t=this.getAllEditorLeaves().filter(r=>this.isLeafAvailable(r));if(t.length===0){this.primaryLeaf=null;return}let e=this.app.workspace.activeLeaf,n=null;if(e&&t.includes(e)?n=e:this.isLeafAvailable(this.primaryLeaf)&&this.primaryLeaf?n=this.primaryLeaf:n=t[0],!!n){this.trackManagedLeaf(n);for(let r of t)if(r!==n){this.managedLeaves.delete(r),delete r.__tategakiManaged,delete r.__tategakiPopout;try{r.detach()}catch(o){Ee("Tategaki: failed to close extra leaf",o)}}this.app.workspace.activeLeaf!==n&&this.app.workspace.setActiveLeaf(n)}}getReusableLeaf(t=!1){if(this.isLeafAvailable(this.primaryLeaf)){let n=this.isPopoutLeaf(this.primaryLeaf);if(!t&&!n||t&&n)return this.primaryLeaf}let e=this.getAllEditorLeaves();for(let n of e){if(!this.isLeafAvailable(n))continue;let r=this.isPopoutLeaf(n);if(!(t&&!r)&&!(!t&&r))return n}return null}isLeafAvailable(t){if(!t)return!1;let e=t==null?void 0:t.containerEl;return!!(e!=null&&e.isConnected)}isPopoutLeaf(t){return Boolean(t&&t.__tategakiPopout)}},Fr=Hr;Fr.INITIAL_FILE_PROP="__tategakiInitialFile",Fr.INITIAL_VIEW_MODE_PROP="__tategakiInitialViewMode";var Ko=class extends Qt.Plugin{async onload(){var e,n,r,o,s;try{let a=this.app.workspace.getLeavesOfType("tategaki-preview-view"),l=this.app.workspace.getLeavesOfType("tategaki-wysiwyg-view"),c=[...this.app.workspace.getLeavesOfType(st),...this.app.workspace.getLeavesOfType(qt)],u=this.app.workspace.getLeavesOfType(_t),d=this.app.workspace.getLeavesOfType(Tt);if(a.length>0||l.length>0||c.length>0||u.length>0||d.length>0){let h=[...a,...l,...c,...u,...d];for(let p of h){let m=p.view;try{typeof(m==null?void 0:m.handleAppQuit)=="function"?await m.handleAppQuit("save"):(r=(n=(e=m==null?void 0:m.syncManager)==null?void 0:e.getState)==null?void 0:n.call(e))!=null&&r.dirty&&await((s=(o=m.syncManager).flush)==null?void 0:s.call(o))}catch(g){Ee("Tategaki: failed to flush view before cleanup",g)}}a.forEach(p=>p.detach()),l.forEach(p=>p.detach()),c.forEach(p=>p.detach()),u.forEach(p=>p.detach()),d.forEach(p=>p.detach());let f=this.app.viewRegistry;f!=null&&f.viewByType&&(delete f.viewByType["tategaki-preview-view"],delete f.viewByType["tategaki-wysiwyg-view"],delete f.viewByType[st],delete f.viewByType[qt],delete f.viewByType[_t],delete f.viewByType[Tt]),await new Promise(p=>setTimeout(p,200))}}catch(a){Ee("Tategaki: Error during pre-load cleanup",a)}await this.loadSettings(),this.modeManager=new Fr(this.app,this.settings,this),this.addSettingTab(new Xo(this.app,this)),await this.modeManager.registerViews(),this.addCommands(),this.registerQuitHandler(),this.addRibbonIcon("tally-4","\u7E26\u66F8\u304D\u30D3\u30E5\u30FC\u3092\u958B\u304F",()=>{this.modeManager.openView()})}async onunload(){this.modeManager&&this.modeManager.cleanup();try{let e=this.app.workspace.getLeavesOfType("tategaki-preview-view"),n=this.app.workspace.getLeavesOfType("tategaki-wysiwyg-view"),r=[...this.app.workspace.getLeavesOfType(st),...this.app.workspace.getLeavesOfType(qt)],o=this.app.workspace.getLeavesOfType(_t),s=this.app.workspace.getLeavesOfType(Tt);e.forEach(l=>l.detach()),n.forEach(l=>l.detach()),r.forEach(l=>l.detach()),o.forEach(l=>l.detach()),s.forEach(l=>l.detach());let a=this.app.viewRegistry;a!=null&&a.viewByType&&(delete a.viewByType["tategaki-preview-view"],delete a.viewByType["tategaki-wysiwyg-view"],delete a.viewByType[st],delete a.viewByType[qt],delete a.viewByType[_t],delete a.viewByType[Tt])}catch(e){Ee("Tategaki: Error during unload cleanup",e)}}addCommands(){this.addCommand({id:"open-tategaki-view",name:"\u7E26\u66F8\u304D\u30D3\u30E5\u30FC\u3092\u958B\u304F",callback:async()=>{await this.modeManager.openView({openOnRightSide:!0})}}),this.addCommand({id:"tategaki-sot-list-move-up",name:"SoT: \u30EA\u30B9\u30C8\u9805\u76EE\u3092\u4E0A\u3078\u79FB\u52D5",callback:()=>this.runSoTListOutlinerAction("move-up")}),this.addCommand({id:"tategaki-sot-list-move-down",name:"SoT: \u30EA\u30B9\u30C8\u9805\u76EE\u3092\u4E0B\u3078\u79FB\u52D5",callback:()=>this.runSoTListOutlinerAction("move-down")})}getActiveSoTView(){let e=this.app.workspace.getActiveViewOfType(Vi);if(e)return e;let n=this.app.workspace.getLeavesOfType(Tt);for(let r of n){let o=r.view;if(o instanceof Vi)return o}return null}runSoTListOutlinerAction(e){let n=this.getActiveSoTView();n&&n.runListOutlinerAction(e)}async moveSyncBackupsToTrash(){if(confirm(`\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3059\u304B\uFF1F

\u79FB\u52D5\u3059\u308B\u3068\u3001\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304B\u3089\u306E\u5FA9\u5143\u306F\u3067\u304D\u306A\u304F\u306A\u308A\u307E\u3059\u3002`))try{let n=await of(this.app);if(n==="none"){new Qt.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",2500);return}n==="system"?new Qt.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3057\u305F\u3002",3e3):new Qt.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092 .trash \u306B\u79FB\u52D5\u3057\u307E\u3057\u305F\u3002",3500)}catch(n){console.error("Tategaki: failed to move sync backups to trash",n),new Qt.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306E\u79FB\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3500)}}async openSyncBackupFolder(){let e=this.app.vault.adapter,n=typeof e.getBasePath=="function"?e.getBasePath():null;if(!n){new Qt.Notice("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u304F\u306B\u306F\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u7248\u304C\u5FC5\u8981\u3067\u3059\u3002",3e3);return}let r=qE.join(n,rf),o=(()=>{var l;try{return(l=window.require)==null?void 0:l.call(window,"fs")}catch(c){return null}})();if(o!=null&&o.existsSync&&!o.existsSync(r)){new Qt.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",3e3);return}let s=(()=>{var l,c;try{return(c=(l=window.require)==null?void 0:l.call(window,"electron"))==null?void 0:c.shell}catch(u){return null}})();if(s!=null&&s.openPath){let l=await s.openPath(r);if(!l)return;if(/(enoent|no such file|not found)/i.test(l)){new Qt.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",3e3);return}}if(s!=null&&s.showItemInFolder){s.showItemInFolder(r);return}let a=this.app;if(typeof a.openWithDefaultApp=="function")try{await a.openWithDefaultApp(r);return}catch(l){}new Qt.Notice("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u3051\u307E\u305B\u3093\u3067\u3057\u305F\u3002",3e3)}registerQuitHandler(){this.registerEvent(this.app.workspace.on("quit",e=>{var o;let n=(o=this.settings.wysiwyg.appCloseAction)!=null?o:"save",r=this.collectSyncLeaves();if(n==="save"&&this.hasDirtyLeaves(r)){e.add(async()=>{await this.handleAppQuit(n,{awaitSaves:!0,leaves:r})});return}this.handleAppQuit(n,{awaitSaves:!1,leaves:r})}))}collectSyncLeaves(){return[...this.app.workspace.getLeavesOfType(st),...this.app.workspace.getLeavesOfType(qt)]}hasDirtyLeaves(e){var n,r;for(let o of e){let s=o.view,a=(r=(n=s==null?void 0:s.syncManager)==null?void 0:n.getState)==null?void 0:r.call(n);if(a!=null&&a.dirty)return!0}return!1}async handleAppQuit(e,n={}){var s,a,l;let r=n.awaitSaves!==!1,o=(s=n.leaves)!=null?s:this.collectSyncLeaves();for(let c of o){let u=c.view;if(typeof(u==null?void 0:u.handleAppQuit)=="function"){let d=u.handleAppQuit(e);r&&await d;continue}if(e==="save"&&u!=null&&u.syncManager){let d=(l=(a=u.syncManager).getState)==null?void 0:l.call(a);if(d!=null&&d.dirty){let h=u.syncManager.flush();r&&await h}}}for(let c of o)c.detach()}async loadSettings(){var n;let e=(n=await this.loadData())!=null?n:{};this.settings=Hh(e),rc(!!this.settings.common.debugLogging)}async saveSettings(){await this.saveData(this.settings)}async updateSettings(e){let n={...e},r=n.common!==void 0,o=this.settings.preview,s=this.settings.common,a=n.preview,l=a&&Object.prototype.hasOwnProperty.call(a,"pageModeEnabled");r&&o.pageModeEnabled&&!l&&(n.preview={...o,...a,pageModeEnabled:!1}),this.settings=Object.assign(this.settings,n),n.preview&&(this.settings.preview=Object.assign({},o,n.preview)),n.common&&(this.settings.common=Object.assign({},s,n.common)),await this.saveSettings(),rc(!!this.settings.common.debugLogging),await this.modeManager.onSettingsChanged(this.settings)}async saveTheme(e){let n=this.settings.themes.findIndex(r=>r.id===e.id);n>=0?this.settings.themes[n]=e:this.settings.themes.push(e),await this.saveSettings()}rgbToHex(e){let n=e.match(/\d+/g);if(!n||n.length<3)return e;let r=parseInt(n[0]),o=parseInt(n[1]),s=parseInt(n[2]),a=l=>{let c=l.toString(16);return c.length===1?"0"+c:c};return`#${a(r)}${a(o)}${a(s)}`}getCssVariableColor(e){if(!e.startsWith("var("))return e;let n=e.slice(4,-1).trim(),r=document.createElement("div");r.style.color=`var(${n})`,document.body.appendChild(r);let o=getComputedStyle(r).color;return document.body.removeChild(r),o&&o.startsWith("rgb")?this.rgbToHex(o)||e:o||e}getCssVariableFont(e){if(!e.startsWith("var("))return e;let n=e.slice(4,-1).trim(),r=document.createElement("div");r.style.fontFamily=`var(${n})`,document.body.appendChild(r);let o=getComputedStyle(r).fontFamily;return document.body.removeChild(r),o||e}getHeadingStyleFromObsidian(){let e=document.querySelector(".markdown-source-view")||document.querySelector(".markdown-preview-view")||document.body,n=document.createElement("h1");n.textContent="Test",n.style.cssText="position: absolute; visibility: hidden; pointer-events: none;",e.appendChild(n);let r=getComputedStyle(n),o=r.color,s=r.fontFamily;e.removeChild(n);let a="";return o&&o.startsWith("rgb")?a=this.rgbToHex(o)||"":o&&(a=o),{color:a,fontFamily:s||""}}async loadTheme(e){var r,o,s,a,l;if(e==="obsidian-base"){this.settings.activeTheme="obsidian-base",this.settings.temporaryOverrides={};let c=this.getCssVariableFont("var(--font-text)")||"inherit",u=this.getCssVariableColor("var(--text-normal)")||"#2e2e2e",d=this.getCssVariableColor("var(--background-primary)")||"#ffffff",h=this.getCssVariableColor("var(--background-secondary)")||"#f5f5f5",f=this.getCssVariableColor("var(--text-accent)")||"#1e90ff",p=this.getHeadingStyleFromObsidian(),m=p.color===u?"":p.color,g=p.fontFamily===c?"":p.fontFamily;await this.updateSettings({activeTheme:"obsidian-base",common:{...this.settings.common,fontFamily:c,fontSize:16,lineHeight:1.6,textColor:u,backgroundColor:d,pageBackgroundColor:h,accentColor:f,headingFontFamily:g,headingTextColor:m},temporaryOverrides:{}});return}let n=this.settings.themes.find(c=>c.id===e);if(!n){console.error(`\u30C6\u30FC\u30DE\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${e}`);return}await this.updateSettings({activeTheme:e,common:{...this.settings.common,fontFamily:n.settings.fontFamily,fontSize:n.settings.fontSize,lineHeight:n.settings.lineHeight,letterSpacing:(r=n.settings.letterSpacing)!=null?r:this.settings.common.letterSpacing,rubySize:(o=n.settings.rubySize)!=null?o:this.settings.common.rubySize,headingFontFamily:(s=n.settings.headingFontFamily)!=null?s:"",textColor:n.settings.colors.text,backgroundColor:n.settings.colors.background,pageBackgroundColor:n.settings.colors.pageBackground,accentColor:n.settings.colors.accent,headingTextColor:(l=(a=n.settings.colors)==null?void 0:a.headingText)!=null?l:"",headingSpacing:n.settings.spacing.headingSpacing},temporaryOverrides:{}})}getThemes(){return this.settings.themes}getActiveThemeId(){return this.settings.activeTheme}async deleteTheme(e){if(e==="obsidian-base"){console.error("Obsidian\u30D9\u30FC\u30B9\u30C6\u30FC\u30DE\u306F\u524A\u9664\u3067\u304D\u307E\u305B\u3093");return}this.settings.themes=this.settings.themes.filter(n=>n.id!==e),this.settings.activeTheme===e?await this.loadTheme("obsidian-base"):await this.saveSettings()}async createThemeFromCurrentSettings(e,n="\u30E6\u30FC\u30B6\u30FC\u4F5C\u6210\u30C6\u30FC\u30DE"){let r=`theme-${Date.now()}`,o=this.getEffectiveCommonSettings(),s={id:r,name:e,description:n,mode:"custom",settings:{fontFamily:o.fontFamily,fontSize:o.fontSize,lineHeight:o.lineHeight,letterSpacing:o.letterSpacing,rubySize:o.rubySize,headingFontFamily:o.headingFontFamily,colors:{text:o.textColor,background:o.backgroundColor,pageBackground:o.pageBackgroundColor,accent:o.accentColor,headingText:o.headingTextColor},spacing:{paragraphSpacing:1.5,headingSpacing:o.headingSpacing}}};return await this.saveTheme(s),await this.loadTheme(r),s}getEffectiveCommonSettings(){let e=this.settings.common,n=this.settings.temporaryOverrides;return{...e,...n.fontFamily!==void 0&&{fontFamily:n.fontFamily},...n.fontSize!==void 0&&{fontSize:n.fontSize},...n.lineHeight!==void 0&&{lineHeight:n.lineHeight},...n.letterSpacing!==void 0&&{letterSpacing:n.letterSpacing},...n.textColor!==void 0&&{textColor:n.textColor},...n.backgroundColor!==void 0&&{backgroundColor:n.backgroundColor},...n.pageBackgroundColor!==void 0&&{pageBackgroundColor:n.pageBackgroundColor},...n.accentColor!==void 0&&{accentColor:n.accentColor},...n.rubySize!==void 0&&{rubySize:n.rubySize},...n.headingSpacing!==void 0&&{headingSpacing:n.headingSpacing},...n.rubyVerticalGap!==void 0&&{rubyVerticalGap:n.rubyVerticalGap},...n.rubyHorizontalGap!==void 0&&{rubyHorizontalGap:n.rubyHorizontalGap},...n.headingFontFamily!==void 0&&{headingFontFamily:n.headingFontFamily},...n.headingTextColor!==void 0&&{headingTextColor:n.headingTextColor}}}async updateTemporaryOverride(e,n){this.settings.temporaryOverrides[e]=n,await this.saveSettings(),await this.modeManager.onSettingsChanged(this.settings)}async clearTemporaryOverrides(){this.settings.temporaryOverrides={},await this.saveSettings(),await this.modeManager.onSettingsChanged(this.settings)}};var HN=Ko;
