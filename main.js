/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _x=Object.create;var No=Object.defineProperty;var Ox=Object.getOwnPropertyDescriptor;var Dx=Object.getOwnPropertyNames;var Bx=Object.getPrototypeOf,Fx=Object.prototype.hasOwnProperty;var Qe=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Hx=(n,t)=>{for(var e in t)No(n,e,{get:t[e],enumerable:!0})},Hh=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Dx(t))!Fx.call(n,r)&&r!==e&&No(n,r,{get:()=>t[r],enumerable:!(i=Ox(t,r))||i.enumerable});return n};var Po=(n,t,e)=>(e=n!=null?_x(Bx(n)):{},Hh(t||!n||!n.__esModule?No(e,"default",{value:n,enumerable:!0}):e,n)),zx=n=>Hh(No({},"__esModule",{value:!0}),n);var nf=Qe((YN,tf)=>{"use strict";function Nk(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i])}return n}function mc(n,t){return Array(t+1).join(n)}function Pk(n){return n.replace(/^\n*/,"")}function _k(n){for(var t=n.length;t>0&&n[t-1]===`
`;)t--;return n.substring(0,t)}var Ok=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function gc(n){return bc(n,Ok)}var jp=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function Yp(n){return bc(n,jp)}function Dk(n){return Jp(n,jp)}var Xp=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Bk(n){return bc(n,Xp)}function Fk(n){return Jp(n,Xp)}function bc(n,t){return t.indexOf(n.nodeName)>=0}function Jp(n,t){return n.getElementsByTagName&&t.some(function(e){return n.getElementsByTagName(e).length})}var at={};at.paragraph={filter:"p",replacement:function(n){return`

`+n+`

`}};at.lineBreak={filter:"br",replacement:function(n,t,e){return e.br+`
`}};at.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(n,t,e){var i=Number(t.nodeName.charAt(1));if(e.headingStyle==="setext"&&i<3){var r=mc(i===1?"=":"-",n.length);return`

`+n+`
`+r+`

`}else return`

`+mc("#",i)+" "+n+`

`}};at.blockquote={filter:"blockquote",replacement:function(n){return n=n.replace(/^\n+|\n+$/g,""),n=n.replace(/^/gm,"> "),`

`+n+`

`}};at.list={filter:["ul","ol"],replacement:function(n,t){var e=t.parentNode;return e.nodeName==="LI"&&e.lastElementChild===t?`
`+n:`

`+n+`

`}};at.listItem={filter:"li",replacement:function(n,t,e){var i=e.bulletListMarker+"   ",r=t.parentNode;if(r.nodeName==="OL"){var o=r.getAttribute("start"),s=Array.prototype.indexOf.call(r.children,t);i=(o?Number(o)+s:s+1)+".  "}return n=n.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
`+" ".repeat(i.length)),i+n+(t.nextSibling&&!/\n$/.test(n)?`
`:"")}};at.indentedCodeBlock={filter:function(n,t){return t.codeBlockStyle==="indented"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,t,e){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};at.fencedCodeBlock={filter:function(n,t){return t.codeBlockStyle==="fenced"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,t,e){for(var i=t.firstChild.getAttribute("class")||"",r=(i.match(/language-(\S+)/)||[null,""])[1],o=t.firstChild.textContent,s=e.fence.charAt(0),a=3,l=new RegExp("^"+s+"{3,}","gm"),c;c=l.exec(o);)c[0].length>=a&&(a=c[0].length+1);var u=mc(s,a);return`

`+u+r+`
`+o.replace(/\n$/,"")+`
`+u+`

`}};at.horizontalRule={filter:"hr",replacement:function(n,t,e){return`

`+e.hr+`

`}};at.inlineLink={filter:function(n,t){return t.linkStyle==="inlined"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,t){var e=t.getAttribute("href");e&&(e=e.replace(/([()])/g,"\\$1"));var i=Zo(t.getAttribute("title"));return i&&(i=' "'+i.replace(/"/g,'\\"')+'"'),"["+n+"]("+e+i+")"}};at.referenceLink={filter:function(n,t){return t.linkStyle==="referenced"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,t,e){var i=t.getAttribute("href"),r=Zo(t.getAttribute("title"));r&&(r=' "'+r+'"');var o,s;switch(e.linkReferenceStyle){case"collapsed":o="["+n+"][]",s="["+n+"]: "+i+r;break;case"shortcut":o="["+n+"]",s="["+n+"]: "+i+r;break;default:var a=this.references.length+1;o="["+n+"]["+a+"]",s="["+a+"]: "+i+r}return this.references.push(s),o},references:[],append:function(n){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};at.emphasis={filter:["em","i"],replacement:function(n,t,e){return n.trim()?e.emDelimiter+n+e.emDelimiter:""}};at.strong={filter:["strong","b"],replacement:function(n,t,e){return n.trim()?e.strongDelimiter+n+e.strongDelimiter:""}};at.code={filter:function(n){var t=n.previousSibling||n.nextSibling,e=n.parentNode.nodeName==="PRE"&&!t;return n.nodeName==="CODE"&&!e},replacement:function(n){if(!n)return"";n=n.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(n)?" ":"",e="`",i=n.match(/`+/gm)||[];i.indexOf(e)!==-1;)e=e+"`";return e+t+n+t+e}};at.image={filter:"img",replacement:function(n,t){var e=Zo(t.getAttribute("alt")),i=t.getAttribute("src")||"",r=Zo(t.getAttribute("title")),o=r?' "'+r+'"':"";return i?"!["+e+"]("+i+o+")":""}};function Zo(n){return n?n.replace(/(\n+\s*)+/g,`
`):""}function Zp(n){this.options=n,this._keep=[],this._remove=[],this.blankRule={replacement:n.blankReplacement},this.keepReplacement=n.keepReplacement,this.defaultRule={replacement:n.defaultReplacement},this.array=[];for(var t in n.rules)this.array.push(n.rules[t])}Zp.prototype={add:function(n,t){this.array.unshift(t)},keep:function(n){this._keep.unshift({filter:n,replacement:this.keepReplacement})},remove:function(n){this._remove.unshift({filter:n,replacement:function(){return""}})},forNode:function(n){if(n.isBlank)return this.blankRule;var t;return(t=hc(this.array,n,this.options))||(t=hc(this._keep,n,this.options))||(t=hc(this._remove,n,this.options))?t:this.defaultRule},forEach:function(n){for(var t=0;t<this.array.length;t++)n(this.array[t],t)}};function hc(n,t,e){for(var i=0;i<n.length;i++){var r=n[i];if(Hk(r,t,e))return r}}function Hk(n,t,e){var i=n.filter;if(typeof i=="string"){if(i===t.nodeName.toLowerCase())return!0}else if(Array.isArray(i)){if(i.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof i=="function"){if(i.call(n,t,e))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function zk(n){var t=n.element,e=n.isBlock,i=n.isVoid,r=n.isPre||function(d){return d.nodeName==="PRE"};if(!(!t.firstChild||r(t))){for(var o=null,s=!1,a=null,l=qp(a,t,r);l!==t;){if(l.nodeType===3||l.nodeType===4){var c=l.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!s&&c[0]===" "&&(c=c.substr(1)),!c){l=pc(l);continue}l.data=c,o=l}else if(l.nodeType===1)e(l)||l.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,s=!1):i(l)||r(l)?(o=null,s=!0):o&&(s=!1);else{l=pc(l);continue}var u=qp(a,l,r);a=l,l=u}o&&(o.data=o.data.replace(/ $/,""),o.data||pc(o))}}function pc(n){var t=n.nextSibling||n.parentNode;return n.parentNode.removeChild(n),t}function qp(n,t,e){return n&&n.parentNode===t||e(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var yc=typeof window!="undefined"?window:{};function Vk(){var n=yc.DOMParser,t=!1;try{new n().parseFromString("","text/html")&&(t=!0)}catch(e){}return t}function $k(){var n=function(){};return Wk()?n.prototype.parseFromString=function(t){var e=new window.ActiveXObject("htmlfile");return e.designMode="on",e.open(),e.write(t),e.close(),e}:n.prototype.parseFromString=function(t){var e=document.implementation.createHTMLDocument("");return e.open(),e.write(t),e.close(),e},n}function Wk(){var n=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){yc.ActiveXObject&&(n=!0)}return n}var Uk=Vk()?yc.DOMParser:$k();function Kk(n,t){var e;if(typeof n=="string"){var i=qk().parseFromString('<x-turndown id="turndown-root">'+n+"</x-turndown>","text/html");e=i.getElementById("turndown-root")}else e=n.cloneNode(!0);return zk({element:e,isBlock:gc,isVoid:Yp,isPre:t.preformattedCode?Gk:null}),e}var fc;function qk(){return fc=fc||new Uk,fc}function Gk(n){return n.nodeName==="PRE"||n.nodeName==="CODE"}function jk(n,t){return n.isBlock=gc(n),n.isCode=n.nodeName==="CODE"||n.parentNode.isCode,n.isBlank=Yk(n),n.flankingWhitespace=Xk(n,t),n}function Yk(n){return!Yp(n)&&!Bk(n)&&/^\s*$/i.test(n.textContent)&&!Dk(n)&&!Fk(n)}function Xk(n,t){if(n.isBlock||t.preformattedCode&&n.isCode)return{leading:"",trailing:""};var e=Jk(n.textContent);return e.leadingAscii&&Gp("left",n,t)&&(e.leading=e.leadingNonAscii),e.trailingAscii&&Gp("right",n,t)&&(e.trailing=e.trailingNonAscii),{leading:e.leading,trailing:e.trailing}}function Jk(n){var t=n.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function Gp(n,t,e){var i,r,o;return n==="left"?(i=t.previousSibling,r=/ $/):(i=t.nextSibling,r=/^ /),i&&(i.nodeType===3?o=r.test(i.nodeValue):e.preformattedCode&&i.nodeName==="CODE"?o=!1:i.nodeType===1&&!gc(i)&&(o=r.test(i.textContent))),o}var Zk=Array.prototype.reduce,Qk=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Qo(n){if(!(this instanceof Qo))return new Qo(n);var t={rules:at,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,i){return i.isBlock?`

`:""},keepReplacement:function(e,i){return i.isBlock?`

`+i.outerHTML+`

`:i.outerHTML},defaultReplacement:function(e,i){return i.isBlock?`

`+e+`

`:e}};this.options=Nk({},t,n),this.rules=new Zp(this.options)}Qo.prototype={turndown:function(n){if(!nw(n))throw new TypeError(n+" is not a string, or an element/document/fragment node.");if(n==="")return"";var t=Qp.call(this,new Kk(n,this.options));return ew.call(this,t)},use:function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)this.use(n[t]);else if(typeof n=="function")n(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(n,t){return this.rules.add(n,t),this},keep:function(n){return this.rules.keep(n),this},remove:function(n){return this.rules.remove(n),this},escape:function(n){return Qk.reduce(function(t,e){return t.replace(e[0],e[1])},n)}};function Qp(n){var t=this;return Zk.call(n.childNodes,function(e,i){i=new jk(i,t.options);var r="";return i.nodeType===3?r=i.isCode?i.nodeValue:t.escape(i.nodeValue):i.nodeType===1&&(r=tw.call(t,i)),ef(e,r)},"")}function ew(n){var t=this;return this.rules.forEach(function(e){typeof e.append=="function"&&(n=ef(n,e.append(t.options)))}),n.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function tw(n){var t=this.rules.forNode(n),e=Qp.call(this,n),i=n.flankingWhitespace;return(i.leading||i.trailing)&&(e=e.trim()),i.leading+t.replacement(e,n,this.options)+i.trailing}function ef(n,t){var e=_k(n),i=Pk(t),r=Math.max(n.length-e.length,t.length-i.length),o=`

`.substring(0,r);return e+o+i}function nw(n){return n!=null&&(typeof n=="string"||n.nodeType&&(n.nodeType===1||n.nodeType===9||n.nodeType===11))}tf.exports=Qo});var tb=Qe((S3,eb)=>{function $0(n){return n instanceof Map?n.clear=n.delete=n.set=function(){throw new Error("map is read-only")}:n instanceof Set&&(n.add=n.clear=n.delete=function(){throw new Error("set is read-only")}),Object.freeze(n),Object.getOwnPropertyNames(n).forEach(t=>{let e=n[t],i=typeof e;(i==="object"||i==="function")&&!Object.isFrozen(e)&&$0(e)}),n}var Ca=class{constructor(t){t.data===void 0&&(t.data={}),this.data=t.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function W0(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function Gn(n,...t){let e=Object.create(null);for(let i in n)e[i]=n[i];return t.forEach(function(i){for(let r in i)e[r]=i[r]}),e}var yC="</span>",D0=n=>!!n.scope,vC=(n,{prefix:t})=>{if(n.startsWith("language:"))return n.replace("language:","language-");if(n.includes(".")){let e=n.split(".");return[`${t}${e.shift()}`,...e.map((i,r)=>`${i}${"_".repeat(r+1)}`)].join(" ")}return`${t}${n}`},Ad=class{constructor(t,e){this.buffer="",this.classPrefix=e.classPrefix,t.walk(this)}addText(t){this.buffer+=W0(t)}openNode(t){if(!D0(t))return;let e=vC(t.scope,{prefix:this.classPrefix});this.span(e)}closeNode(t){D0(t)&&(this.buffer+=yC)}value(){return this.buffer}span(t){this.buffer+=`<span class="${t}">`}},B0=(n={})=>{let t={children:[]};return Object.assign(t,n),t},Id=class n{constructor(){this.rootNode=B0(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(t){this.top.children.push(t)}openNode(t){let e=B0({scope:t});this.add(e),this.stack.push(e)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(t){return this.constructor._walk(t,this.rootNode)}static _walk(t,e){return typeof e=="string"?t.addText(e):e.children&&(t.openNode(e),e.children.forEach(i=>this._walk(t,i)),t.closeNode(e)),t}static _collapse(t){typeof t!="string"&&t.children&&(t.children.every(e=>typeof e=="string")?t.children=[t.children.join("")]:t.children.forEach(e=>{n._collapse(e)}))}},Nd=class extends Id{constructor(t){super(),this.options=t}addText(t){t!==""&&this.add(t)}startScope(t){this.openNode(t)}endScope(){this.closeNode()}__addSublanguage(t,e){let i=t.root;e&&(i.scope=`language:${e}`),this.add(i)}toHTML(){return new Ad(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function so(n){return n?typeof n=="string"?n:n.source:null}function U0(n){return Ti("(?=",n,")")}function EC(n){return Ti("(?:",n,")*")}function xC(n){return Ti("(?:",n,")?")}function Ti(...n){return n.map(e=>so(e)).join("")}function kC(n){let t=n[n.length-1];return typeof t=="object"&&t.constructor===Object?(n.splice(n.length-1,1),t):{}}function _d(...n){return"("+(kC(n).capture?"":"?:")+n.map(i=>so(i)).join("|")+")"}function K0(n){return new RegExp(n.toString()+"|").exec("").length-1}function wC(n,t){let e=n&&n.exec(t);return e&&e.index===0}var SC=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Od(n,{joinWith:t}){let e=0;return n.map(i=>{e+=1;let r=e,o=so(i),s="";for(;o.length>0;){let a=SC.exec(o);if(!a){s+=o;break}s+=o.substring(0,a.index),o=o.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?s+="\\"+String(Number(a[1])+r):(s+=a[0],a[0]==="("&&e++)}return s}).map(i=>`(${i})`).join(t)}var MC=/\b\B/,q0="[a-zA-Z]\\w*",Dd="[a-zA-Z_]\\w*",G0="\\b\\d+(\\.\\d+)?",j0="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Y0="\\b(0b[01]+)",TC="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",CC=(n={})=>{let t=/^#![ ]*\//;return n.binary&&(n.begin=Ti(t,/.*\b/,n.binary,/\b.*/)),Gn({scope:"meta",begin:t,end:/$/,relevance:0,"on:begin":(e,i)=>{e.index!==0&&i.ignoreMatch()}},n)},ao={begin:"\\\\[\\s\\S]",relevance:0},LC={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[ao]},RC={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[ao]},AC={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},Ra=function(n,t,e={}){let i=Gn({scope:"comment",begin:n,end:t,contains:[]},e);i.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});let r=_d("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return i.contains.push({begin:Ti(/[ ]+/,"(",r,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),i},IC=Ra("//","$"),NC=Ra("/\\*","\\*/"),PC=Ra("#","$"),_C={scope:"number",begin:G0,relevance:0},OC={scope:"number",begin:j0,relevance:0},DC={scope:"number",begin:Y0,relevance:0},BC={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[ao,{begin:/\[/,end:/\]/,relevance:0,contains:[ao]}]},FC={scope:"title",begin:q0,relevance:0},HC={scope:"title",begin:Dd,relevance:0},zC={begin:"\\.\\s*"+Dd,relevance:0},VC=function(n){return Object.assign(n,{"on:begin":(t,e)=>{e.data._beginMatch=t[1]},"on:end":(t,e)=>{e.data._beginMatch!==t[1]&&e.ignoreMatch()}})},Ta=Object.freeze({__proto__:null,APOS_STRING_MODE:LC,BACKSLASH_ESCAPE:ao,BINARY_NUMBER_MODE:DC,BINARY_NUMBER_RE:Y0,COMMENT:Ra,C_BLOCK_COMMENT_MODE:NC,C_LINE_COMMENT_MODE:IC,C_NUMBER_MODE:OC,C_NUMBER_RE:j0,END_SAME_AS_BEGIN:VC,HASH_COMMENT_MODE:PC,IDENT_RE:q0,MATCH_NOTHING_RE:MC,METHOD_GUARD:zC,NUMBER_MODE:_C,NUMBER_RE:G0,PHRASAL_WORDS_MODE:AC,QUOTE_STRING_MODE:RC,REGEXP_MODE:BC,RE_STARTERS_RE:TC,SHEBANG:CC,TITLE_MODE:FC,UNDERSCORE_IDENT_RE:Dd,UNDERSCORE_TITLE_MODE:HC});function $C(n,t){n.input[n.index-1]==="."&&t.ignoreMatch()}function WC(n,t){n.className!==void 0&&(n.scope=n.className,delete n.className)}function UC(n,t){t&&n.beginKeywords&&(n.begin="\\b("+n.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",n.__beforeBegin=$C,n.keywords=n.keywords||n.beginKeywords,delete n.beginKeywords,n.relevance===void 0&&(n.relevance=0))}function KC(n,t){Array.isArray(n.illegal)&&(n.illegal=_d(...n.illegal))}function qC(n,t){if(n.match){if(n.begin||n.end)throw new Error("begin & end are not supported with match");n.begin=n.match,delete n.match}}function GC(n,t){n.relevance===void 0&&(n.relevance=1)}var jC=(n,t)=>{if(!n.beforeMatch)return;if(n.starts)throw new Error("beforeMatch cannot be used with starts");let e=Object.assign({},n);Object.keys(n).forEach(i=>{delete n[i]}),n.keywords=e.keywords,n.begin=Ti(e.beforeMatch,U0(e.begin)),n.starts={relevance:0,contains:[Object.assign(e,{endsParent:!0})]},n.relevance=0,delete e.beforeMatch},YC=["of","and","for","in","not","or","if","then","parent","list","value"],XC="keyword";function X0(n,t,e=XC){let i=Object.create(null);return typeof n=="string"?r(e,n.split(" ")):Array.isArray(n)?r(e,n):Object.keys(n).forEach(function(o){Object.assign(i,X0(n[o],t,o))}),i;function r(o,s){t&&(s=s.map(a=>a.toLowerCase())),s.forEach(function(a){let l=a.split("|");i[l[0]]=[o,JC(l[0],l[1])]})}}function JC(n,t){return t?Number(t):ZC(n)?0:1}function ZC(n){return YC.includes(n.toLowerCase())}var F0={},Mi=n=>{console.error(n)},H0=(n,...t)=>{console.log(`WARN: ${n}`,...t)},ar=(n,t)=>{F0[`${n}/${t}`]||(console.log(`Deprecated as of ${n}. ${t}`),F0[`${n}/${t}`]=!0)},La=new Error;function J0(n,t,{key:e}){let i=0,r=n[e],o={},s={};for(let a=1;a<=t.length;a++)s[a+i]=r[a],o[a+i]=!0,i+=K0(t[a-1]);n[e]=s,n[e]._emit=o,n[e]._multi=!0}function QC(n){if(Array.isArray(n.begin)){if(n.skip||n.excludeBegin||n.returnBegin)throw Mi("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),La;if(typeof n.beginScope!="object"||n.beginScope===null)throw Mi("beginScope must be object"),La;J0(n,n.begin,{key:"beginScope"}),n.begin=Od(n.begin,{joinWith:""})}}function eL(n){if(Array.isArray(n.end)){if(n.skip||n.excludeEnd||n.returnEnd)throw Mi("skip, excludeEnd, returnEnd not compatible with endScope: {}"),La;if(typeof n.endScope!="object"||n.endScope===null)throw Mi("endScope must be object"),La;J0(n,n.end,{key:"endScope"}),n.end=Od(n.end,{joinWith:""})}}function tL(n){n.scope&&typeof n.scope=="object"&&n.scope!==null&&(n.beginScope=n.scope,delete n.scope)}function nL(n){tL(n),typeof n.beginScope=="string"&&(n.beginScope={_wrap:n.beginScope}),typeof n.endScope=="string"&&(n.endScope={_wrap:n.endScope}),QC(n),eL(n)}function iL(n){function t(s,a){return new RegExp(so(s),"m"+(n.case_insensitive?"i":"")+(n.unicodeRegex?"u":"")+(a?"g":""))}class e{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=K0(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);let a=this.regexes.map(l=>l[1]);this.matcherRe=t(Od(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;let l=this.matcherRe.exec(a);if(!l)return null;let c=l.findIndex((d,h)=>h>0&&d!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class i{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];let l=new e;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){let l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){let u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function r(s){let a=new i;return s.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),s.terminatorEnd&&a.addRule(s.terminatorEnd,{type:"end"}),s.illegal&&a.addRule(s.illegal,{type:"illegal"}),a}function o(s,a){let l=s;if(s.isCompiled)return l;[WC,qC,nL,jC].forEach(u=>u(s,a)),n.compilerExtensions.forEach(u=>u(s,a)),s.__beforeBegin=null,[UC,KC,GC].forEach(u=>u(s,a)),s.isCompiled=!0;let c=null;return typeof s.keywords=="object"&&s.keywords.$pattern&&(s.keywords=Object.assign({},s.keywords),c=s.keywords.$pattern,delete s.keywords.$pattern),c=c||/\w+/,s.keywords&&(s.keywords=X0(s.keywords,n.case_insensitive)),l.keywordPatternRe=t(c,!0),a&&(s.begin||(s.begin=/\B|\b/),l.beginRe=t(l.begin),!s.end&&!s.endsWithParent&&(s.end=/\B|\b/),s.end&&(l.endRe=t(l.end)),l.terminatorEnd=so(l.end)||"",s.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(s.end?"|":"")+a.terminatorEnd)),s.illegal&&(l.illegalRe=t(s.illegal)),s.contains||(s.contains=[]),s.contains=[].concat(...s.contains.map(function(u){return rL(u==="self"?s:u)})),s.contains.forEach(function(u){o(u,l)}),s.starts&&o(s.starts,a),l.matcher=r(l),l}if(n.compilerExtensions||(n.compilerExtensions=[]),n.contains&&n.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return n.classNameAliases=Gn(n.classNameAliases||{}),o(n)}function Z0(n){return n?n.endsWithParent||Z0(n.starts):!1}function rL(n){return n.variants&&!n.cachedVariants&&(n.cachedVariants=n.variants.map(function(t){return Gn(n,{variants:null},t)})),n.cachedVariants?n.cachedVariants:Z0(n)?Gn(n,{starts:n.starts?Gn(n.starts):null}):Object.isFrozen(n)?Gn(n):n}var oL="11.11.1",Pd=class extends Error{constructor(t,e){super(t),this.name="HTMLInjectionError",this.html=e}},Rd=W0,z0=Gn,V0=Symbol("nomatch"),sL=7,Q0=function(n){let t=Object.create(null),e=Object.create(null),i=[],r=!0,o="Could not find the language '{}', did you forget to load/include a language module?",s={disableAutodetect:!0,name:"Plain text",contains:[]},a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:Nd};function l(L){return a.noHighlightRe.test(L)}function c(L){let R=L.className+" ";R+=L.parentNode?L.parentNode.className:"";let T=a.languageDetectRe.exec(R);if(T){let A=w(T[1]);return A||(H0(o.replace("{}",T[1])),H0("Falling back to no-highlight mode for this block.",L)),A?T[1]:"no-highlight"}return R.split(/\s+/).find(A=>l(A)||w(A))}function u(L,R,T){let A="",B="";typeof R=="object"?(A=L,T=R.ignoreIllegals,B=R.language):(ar("10.7.0","highlight(lang, code, ...args) has been deprecated."),ar("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),B=L,A=R),T===void 0&&(T=!0);let W={code:A,language:B};_("before:highlight",W);let K=W.result?W.result:d(W.language,W.code,T);return K.code=W.code,_("after:highlight",K),K}function d(L,R,T,A){let B=Object.create(null);function W(U,O){return U.keywords[O]}function K(){if(!ne.keywords){Le.addText(oe);return}let U=0;ne.keywordPatternRe.lastIndex=0;let O=ne.keywordPatternRe.exec(oe),M="";for(;O;){M+=oe.substring(U,O.index);let D=He.case_insensitive?O[0].toLowerCase():O[0],V=W(ne,D);if(V){let[G,de]=V;if(Le.addText(M),M="",B[D]=(B[D]||0)+1,B[D]<=sL&&(be+=de),G.startsWith("_"))M+=O[0];else{let ve=He.classNameAliases[G]||G;ee(O[0],ve)}}else M+=O[0];U=ne.keywordPatternRe.lastIndex,O=ne.keywordPatternRe.exec(oe)}M+=oe.substring(U),Le.addText(M)}function J(){if(oe==="")return;let U=null;if(typeof ne.subLanguage=="string"){if(!t[ne.subLanguage]){Le.addText(oe);return}U=d(ne.subLanguage,oe,!0,re[ne.subLanguage]),re[ne.subLanguage]=U._top}else U=p(oe,ne.subLanguage.length?ne.subLanguage:null);ne.relevance>0&&(be+=U.relevance),Le.__addSublanguage(U._emitter,U.language)}function Z(){ne.subLanguage!=null?J():K(),oe=""}function ee(U,O){U!==""&&(Le.startScope(O),Le.addText(U),Le.endScope())}function Me(U,O){let M=1,D=O.length-1;for(;M<=D;){if(!U._emit[M]){M++;continue}let V=He.classNameAliases[U[M]]||U[M],G=O[M];V?ee(G,V):(oe=G,K(),oe=""),M++}}function Be(U,O){return U.scope&&typeof U.scope=="string"&&Le.openNode(He.classNameAliases[U.scope]||U.scope),U.beginScope&&(U.beginScope._wrap?(ee(oe,He.classNameAliases[U.beginScope._wrap]||U.beginScope._wrap),oe=""):U.beginScope._multi&&(Me(U.beginScope,O),oe="")),ne=Object.create(U,{parent:{value:ne}}),ne}function ye(U,O,M){let D=wC(U.endRe,M);if(D){if(U["on:end"]){let V=new Ca(U);U["on:end"](O,V),V.isMatchIgnored&&(D=!1)}if(D){for(;U.endsParent&&U.parent;)U=U.parent;return U}}if(U.endsWithParent)return ye(U.parent,O,M)}function pe(U){return ne.matcher.regexIndex===0?(oe+=U[0],1):(Ct=!0,0)}function Fe(U){let O=U[0],M=U.rule,D=new Ca(M),V=[M.__beforeBegin,M["on:begin"]];for(let G of V)if(G&&(G(U,D),D.isMatchIgnored))return pe(O);return M.skip?oe+=O:(M.excludeBegin&&(oe+=O),Z(),!M.returnBegin&&!M.excludeBegin&&(oe=O)),Be(M,U),M.returnBegin?0:O.length}function rt(U){let O=U[0],M=R.substring(U.index),D=ye(ne,U,M);if(!D)return V0;let V=ne;ne.endScope&&ne.endScope._wrap?(Z(),ee(O,ne.endScope._wrap)):ne.endScope&&ne.endScope._multi?(Z(),Me(ne.endScope,U)):V.skip?oe+=O:(V.returnEnd||V.excludeEnd||(oe+=O),Z(),V.excludeEnd&&(oe=O));do ne.scope&&Le.closeNode(),!ne.skip&&!ne.subLanguage&&(be+=ne.relevance),ne=ne.parent;while(ne!==D.parent);return D.starts&&Be(D.starts,U),V.returnEnd?0:O.length}function Mt(){let U=[];for(let O=ne;O!==He;O=O.parent)O.scope&&U.unshift(O.scope);U.forEach(O=>Le.openNode(O))}let Tt={};function dt(U,O){let M=O&&O[0];if(oe+=U,M==null)return Z(),0;if(Tt.type==="begin"&&O.type==="end"&&Tt.index===O.index&&M===""){if(oe+=R.slice(O.index,O.index+1),!r){let D=new Error(`0 width match regex (${L})`);throw D.languageName=L,D.badRule=Tt.rule,D}return 1}if(Tt=O,O.type==="begin")return Fe(O);if(O.type==="illegal"&&!T){let D=new Error('Illegal lexeme "'+M+'" for mode "'+(ne.scope||"<unnamed>")+'"');throw D.mode=ne,D}else if(O.type==="end"){let D=rt(O);if(D!==V0)return D}if(O.type==="illegal"&&M==="")return oe+=`
`,1;if(Ze>1e5&&Ze>O.index*3)throw new Error("potential infinite loop, way more iterations than matches");return oe+=M,M.length}let He=w(L);if(!He)throw Mi(o.replace("{}",L)),new Error('Unknown language: "'+L+'"');let Je=iL(He),Kt="",ne=A||Je,re={},Le=new a.__emitter(a);Mt();let oe="",be=0,qe=0,Ze=0,Ct=!1;try{if(He.__emitTokens)He.__emitTokens(R,Le);else{for(ne.matcher.considerAll();;){Ze++,Ct?Ct=!1:ne.matcher.considerAll(),ne.matcher.lastIndex=qe;let U=ne.matcher.exec(R);if(!U)break;let O=R.substring(qe,U.index),M=dt(O,U);qe=U.index+M}dt(R.substring(qe))}return Le.finalize(),Kt=Le.toHTML(),{language:L,value:Kt,relevance:be,illegal:!1,_emitter:Le,_top:ne}}catch(U){if(U.message&&U.message.includes("Illegal"))return{language:L,value:Rd(R),illegal:!0,relevance:0,_illegalBy:{message:U.message,index:qe,context:R.slice(qe-100,qe+100),mode:U.mode,resultSoFar:Kt},_emitter:Le};if(r)return{language:L,value:Rd(R),illegal:!1,relevance:0,errorRaised:U,_emitter:Le,_top:ne};throw U}}function h(L){let R={value:Rd(L),illegal:!1,relevance:0,_top:s,_emitter:new a.__emitter(a)};return R._emitter.addText(L),R}function p(L,R){R=R||a.languages||Object.keys(t);let T=h(L),A=R.filter(w).filter(I).map(Z=>d(Z,L,!1));A.unshift(T);let B=A.sort((Z,ee)=>{if(Z.relevance!==ee.relevance)return ee.relevance-Z.relevance;if(Z.language&&ee.language){if(w(Z.language).supersetOf===ee.language)return 1;if(w(ee.language).supersetOf===Z.language)return-1}return 0}),[W,K]=B,J=W;return J.secondBest=K,J}function f(L,R,T){let A=R&&e[R]||T;L.classList.add("hljs"),L.classList.add(`language-${A}`)}function g(L){let R=null,T=c(L);if(l(T))return;if(_("before:highlightElement",{el:L,language:T}),L.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",L);return}if(L.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(L)),a.throwUnescapedHTML))throw new Pd("One of your code blocks includes unescaped HTML.",L.innerHTML);R=L;let A=R.textContent,B=T?u(A,{language:T,ignoreIllegals:!0}):p(A);L.innerHTML=B.value,L.dataset.highlighted="yes",f(L,T,B.language),L.result={language:B.language,re:B.relevance,relevance:B.relevance},B.secondBest&&(L.secondBest={language:B.secondBest.language,relevance:B.secondBest.relevance}),_("after:highlightElement",{el:L,result:B,text:A})}function m(L){a=z0(a,L)}let b=()=>{E(),ar("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function y(){E(),ar("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let v=!1;function E(){function L(){E()}if(document.readyState==="loading"){v||window.addEventListener("DOMContentLoaded",L,!1),v=!0;return}document.querySelectorAll(a.cssSelector).forEach(g)}function x(L,R){let T=null;try{T=R(n)}catch(A){if(Mi("Language definition for '{}' could not be registered.".replace("{}",L)),r)Mi(A);else throw A;T=s}T.name||(T.name=L),t[L]=T,T.rawDefinition=R.bind(null,n),T.aliases&&C(T.aliases,{languageName:L})}function k(L){delete t[L];for(let R of Object.keys(e))e[R]===L&&delete e[R]}function S(){return Object.keys(t)}function w(L){return L=(L||"").toLowerCase(),t[L]||t[e[L]]}function C(L,{languageName:R}){typeof L=="string"&&(L=[L]),L.forEach(T=>{e[T.toLowerCase()]=R})}function I(L){let R=w(L);return R&&!R.disableAutodetect}function F(L){L["before:highlightBlock"]&&!L["before:highlightElement"]&&(L["before:highlightElement"]=R=>{L["before:highlightBlock"](Object.assign({block:R.el},R))}),L["after:highlightBlock"]&&!L["after:highlightElement"]&&(L["after:highlightElement"]=R=>{L["after:highlightBlock"](Object.assign({block:R.el},R))})}function N(L){F(L),i.push(L)}function H(L){let R=i.indexOf(L);R!==-1&&i.splice(R,1)}function _(L,R){let T=L;i.forEach(function(A){A[T]&&A[T](R)})}function P(L){return ar("10.7.0","highlightBlock will be removed entirely in v12.0"),ar("10.7.0","Please use highlightElement now."),g(L)}Object.assign(n,{highlight:u,highlightAuto:p,highlightAll:E,highlightElement:g,highlightBlock:P,configure:m,initHighlighting:b,initHighlightingOnLoad:y,registerLanguage:x,unregisterLanguage:k,listLanguages:S,getLanguage:w,registerAliases:C,autoDetection:I,inherit:z0,addPlugin:N,removePlugin:H}),n.debugMode=function(){r=!1},n.safeMode=function(){r=!0},n.versionString=oL,n.regex={concat:Ti,lookahead:U0,either:_d,optional:xC,anyNumberOfTimes:EC};for(let L in Ta)typeof Ta[L]=="object"&&$0(Ta[L]);return Object.assign(n,Ta),n},lr=Q0({});lr.newInstance=()=>Q0({});eb.exports=lr;lr.HighlightJS=lr;lr.default=lr});var Ny=Qe((mH,Iy)=>{function vy(n){return n instanceof Map?n.clear=n.delete=n.set=function(){throw new Error("map is read-only")}:n instanceof Set&&(n.add=n.clear=n.delete=function(){throw new Error("set is read-only")}),Object.freeze(n),Object.getOwnPropertyNames(n).forEach(t=>{let e=n[t],i=typeof e;(i==="object"||i==="function")&&!Object.isFrozen(e)&&vy(e)}),n}var Fa=class{constructor(t){t.data===void 0&&(t.data={}),this.data=t.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function Ey(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function jn(n,...t){let e=Object.create(null);for(let i in n)e[i]=n[i];return t.forEach(function(i){for(let r in i)e[r]=i[r]}),e}var $L="</span>",py=n=>!!n.scope,WL=(n,{prefix:t})=>{if(n.startsWith("language:"))return n.replace("language:","language-");if(n.includes(".")){let e=n.split(".");return[`${t}${e.shift()}`,...e.map((i,r)=>`${i}${"_".repeat(r+1)}`)].join(" ")}return`${t}${n}`},$d=class{constructor(t,e){this.buffer="",this.classPrefix=e.classPrefix,t.walk(this)}addText(t){this.buffer+=Ey(t)}openNode(t){if(!py(t))return;let e=WL(t.scope,{prefix:this.classPrefix});this.span(e)}closeNode(t){py(t)&&(this.buffer+=$L)}value(){return this.buffer}span(t){this.buffer+=`<span class="${t}">`}},fy=(n={})=>{let t={children:[]};return Object.assign(t,n),t},Wd=class n{constructor(){this.rootNode=fy(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(t){this.top.children.push(t)}openNode(t){let e=fy({scope:t});this.add(e),this.stack.push(e)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(t){return this.constructor._walk(t,this.rootNode)}static _walk(t,e){return typeof e=="string"?t.addText(e):e.children&&(t.openNode(e),e.children.forEach(i=>this._walk(t,i)),t.closeNode(e)),t}static _collapse(t){typeof t!="string"&&t.children&&(t.children.every(e=>typeof e=="string")?t.children=[t.children.join("")]:t.children.forEach(e=>{n._collapse(e)}))}},Ud=class extends Wd{constructor(t){super(),this.options=t}addText(t){t!==""&&this.add(t)}startScope(t){this.openNode(t)}endScope(){this.closeNode()}__addSublanguage(t,e){let i=t.root;e&&(i.scope=`language:${e}`),this.add(i)}toHTML(){return new $d(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function lo(n){return n?typeof n=="string"?n:n.source:null}function xy(n){return Li("(?=",n,")")}function UL(n){return Li("(?:",n,")*")}function KL(n){return Li("(?:",n,")?")}function Li(...n){return n.map(e=>lo(e)).join("")}function qL(n){let t=n[n.length-1];return typeof t=="object"&&t.constructor===Object?(n.splice(n.length-1,1),t):{}}function qd(...n){return"("+(qL(n).capture?"":"?:")+n.map(i=>lo(i)).join("|")+")"}function ky(n){return new RegExp(n.toString()+"|").exec("").length-1}function GL(n,t){let e=n&&n.exec(t);return e&&e.index===0}var jL=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Gd(n,{joinWith:t}){let e=0;return n.map(i=>{e+=1;let r=e,o=lo(i),s="";for(;o.length>0;){let a=jL.exec(o);if(!a){s+=o;break}s+=o.substring(0,a.index),o=o.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?s+="\\"+String(Number(a[1])+r):(s+=a[0],a[0]==="("&&e++)}return s}).map(i=>`(${i})`).join(t)}var YL=/\b\B/,wy="[a-zA-Z]\\w*",jd="[a-zA-Z_]\\w*",Sy="\\b\\d+(\\.\\d+)?",My="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Ty="\\b(0b[01]+)",XL="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",JL=(n={})=>{let t=/^#![ ]*\//;return n.binary&&(n.begin=Li(t,/.*\b/,n.binary,/\b.*/)),jn({scope:"meta",begin:t,end:/$/,relevance:0,"on:begin":(e,i)=>{e.index!==0&&i.ignoreMatch()}},n)},co={begin:"\\\\[\\s\\S]",relevance:0},ZL={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[co]},QL={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[co]},eR={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},za=function(n,t,e={}){let i=jn({scope:"comment",begin:n,end:t,contains:[]},e);i.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});let r=qd("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return i.contains.push({begin:Li(/[ ]+/,"(",r,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),i},tR=za("//","$"),nR=za("/\\*","\\*/"),iR=za("#","$"),rR={scope:"number",begin:Sy,relevance:0},oR={scope:"number",begin:My,relevance:0},sR={scope:"number",begin:Ty,relevance:0},aR={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[co,{begin:/\[/,end:/\]/,relevance:0,contains:[co]}]}]},lR={scope:"title",begin:wy,relevance:0},cR={scope:"title",begin:jd,relevance:0},uR={begin:"\\.\\s*"+jd,relevance:0},dR=function(n){return Object.assign(n,{"on:begin":(t,e)=>{e.data._beginMatch=t[1]},"on:end":(t,e)=>{e.data._beginMatch!==t[1]&&e.ignoreMatch()}})},Ba=Object.freeze({__proto__:null,MATCH_NOTHING_RE:YL,IDENT_RE:wy,UNDERSCORE_IDENT_RE:jd,NUMBER_RE:Sy,C_NUMBER_RE:My,BINARY_NUMBER_RE:Ty,RE_STARTERS_RE:XL,SHEBANG:JL,BACKSLASH_ESCAPE:co,APOS_STRING_MODE:ZL,QUOTE_STRING_MODE:QL,PHRASAL_WORDS_MODE:eR,COMMENT:za,C_LINE_COMMENT_MODE:tR,C_BLOCK_COMMENT_MODE:nR,HASH_COMMENT_MODE:iR,NUMBER_MODE:rR,C_NUMBER_MODE:oR,BINARY_NUMBER_MODE:sR,REGEXP_MODE:aR,TITLE_MODE:lR,UNDERSCORE_TITLE_MODE:cR,METHOD_GUARD:uR,END_SAME_AS_BEGIN:dR});function hR(n,t){n.input[n.index-1]==="."&&t.ignoreMatch()}function pR(n,t){n.className!==void 0&&(n.scope=n.className,delete n.className)}function fR(n,t){t&&n.beginKeywords&&(n.begin="\\b("+n.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",n.__beforeBegin=hR,n.keywords=n.keywords||n.beginKeywords,delete n.beginKeywords,n.relevance===void 0&&(n.relevance=0))}function mR(n,t){Array.isArray(n.illegal)&&(n.illegal=qd(...n.illegal))}function gR(n,t){if(n.match){if(n.begin||n.end)throw new Error("begin & end are not supported with match");n.begin=n.match,delete n.match}}function bR(n,t){n.relevance===void 0&&(n.relevance=1)}var yR=(n,t)=>{if(!n.beforeMatch)return;if(n.starts)throw new Error("beforeMatch cannot be used with starts");let e=Object.assign({},n);Object.keys(n).forEach(i=>{delete n[i]}),n.keywords=e.keywords,n.begin=Li(e.beforeMatch,xy(e.begin)),n.starts={relevance:0,contains:[Object.assign(e,{endsParent:!0})]},n.relevance=0,delete e.beforeMatch},vR=["of","and","for","in","not","or","if","then","parent","list","value"],ER="keyword";function Cy(n,t,e=ER){let i=Object.create(null);return typeof n=="string"?r(e,n.split(" ")):Array.isArray(n)?r(e,n):Object.keys(n).forEach(function(o){Object.assign(i,Cy(n[o],t,o))}),i;function r(o,s){t&&(s=s.map(a=>a.toLowerCase())),s.forEach(function(a){let l=a.split("|");i[l[0]]=[o,xR(l[0],l[1])]})}}function xR(n,t){return t?Number(t):kR(n)?0:1}function kR(n){return vR.includes(n.toLowerCase())}var my={},Ci=n=>{console.error(n)},gy=(n,...t)=>{console.log(`WARN: ${n}`,...t)},dr=(n,t)=>{my[`${n}/${t}`]||(console.log(`Deprecated as of ${n}. ${t}`),my[`${n}/${t}`]=!0)},Ha=new Error;function Ly(n,t,{key:e}){let i=0,r=n[e],o={},s={};for(let a=1;a<=t.length;a++)s[a+i]=r[a],o[a+i]=!0,i+=ky(t[a-1]);n[e]=s,n[e]._emit=o,n[e]._multi=!0}function wR(n){if(Array.isArray(n.begin)){if(n.skip||n.excludeBegin||n.returnBegin)throw Ci("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Ha;if(typeof n.beginScope!="object"||n.beginScope===null)throw Ci("beginScope must be object"),Ha;Ly(n,n.begin,{key:"beginScope"}),n.begin=Gd(n.begin,{joinWith:""})}}function SR(n){if(Array.isArray(n.end)){if(n.skip||n.excludeEnd||n.returnEnd)throw Ci("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Ha;if(typeof n.endScope!="object"||n.endScope===null)throw Ci("endScope must be object"),Ha;Ly(n,n.end,{key:"endScope"}),n.end=Gd(n.end,{joinWith:""})}}function MR(n){n.scope&&typeof n.scope=="object"&&n.scope!==null&&(n.beginScope=n.scope,delete n.scope)}function TR(n){MR(n),typeof n.beginScope=="string"&&(n.beginScope={_wrap:n.beginScope}),typeof n.endScope=="string"&&(n.endScope={_wrap:n.endScope}),wR(n),SR(n)}function CR(n){function t(s,a){return new RegExp(lo(s),"m"+(n.case_insensitive?"i":"")+(n.unicodeRegex?"u":"")+(a?"g":""))}class e{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=ky(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);let a=this.regexes.map(l=>l[1]);this.matcherRe=t(Gd(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;let l=this.matcherRe.exec(a);if(!l)return null;let c=l.findIndex((d,h)=>h>0&&d!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class i{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];let l=new e;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){let l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){let u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function r(s){let a=new i;return s.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),s.terminatorEnd&&a.addRule(s.terminatorEnd,{type:"end"}),s.illegal&&a.addRule(s.illegal,{type:"illegal"}),a}function o(s,a){let l=s;if(s.isCompiled)return l;[pR,gR,TR,yR].forEach(u=>u(s,a)),n.compilerExtensions.forEach(u=>u(s,a)),s.__beforeBegin=null,[fR,mR,bR].forEach(u=>u(s,a)),s.isCompiled=!0;let c=null;return typeof s.keywords=="object"&&s.keywords.$pattern&&(s.keywords=Object.assign({},s.keywords),c=s.keywords.$pattern,delete s.keywords.$pattern),c=c||/\w+/,s.keywords&&(s.keywords=Cy(s.keywords,n.case_insensitive)),l.keywordPatternRe=t(c,!0),a&&(s.begin||(s.begin=/\B|\b/),l.beginRe=t(l.begin),!s.end&&!s.endsWithParent&&(s.end=/\B|\b/),s.end&&(l.endRe=t(l.end)),l.terminatorEnd=lo(l.end)||"",s.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(s.end?"|":"")+a.terminatorEnd)),s.illegal&&(l.illegalRe=t(s.illegal)),s.contains||(s.contains=[]),s.contains=[].concat(...s.contains.map(function(u){return LR(u==="self"?s:u)})),s.contains.forEach(function(u){o(u,l)}),s.starts&&o(s.starts,a),l.matcher=r(l),l}if(n.compilerExtensions||(n.compilerExtensions=[]),n.contains&&n.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return n.classNameAliases=jn(n.classNameAliases||{}),o(n)}function Ry(n){return n?n.endsWithParent||Ry(n.starts):!1}function LR(n){return n.variants&&!n.cachedVariants&&(n.cachedVariants=n.variants.map(function(t){return jn(n,{variants:null},t)})),n.cachedVariants?n.cachedVariants:Ry(n)?jn(n,{starts:n.starts?jn(n.starts):null}):Object.isFrozen(n)?jn(n):n}var RR="11.8.0",Kd=class extends Error{constructor(t,e){super(t),this.name="HTMLInjectionError",this.html=e}},Vd=Ey,by=jn,yy=Symbol("nomatch"),AR=7,Ay=function(n){let t=Object.create(null),e=Object.create(null),i=[],r=!0,o="Could not find the language '{}', did you forget to load/include a language module?",s={disableAutodetect:!0,name:"Plain text",contains:[]},a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:Ud};function l(R){return a.noHighlightRe.test(R)}function c(R){let T=R.className+" ";T+=R.parentNode?R.parentNode.className:"";let A=a.languageDetectRe.exec(T);if(A){let B=C(A[1]);return B||(gy(o.replace("{}",A[1])),gy("Falling back to no-highlight mode for this block.",R)),B?A[1]:"no-highlight"}return T.split(/\s+/).find(B=>l(B)||C(B))}function u(R,T,A){let B="",W="";typeof T=="object"?(B=R,A=T.ignoreIllegals,W=T.language):(dr("10.7.0","highlight(lang, code, ...args) has been deprecated."),dr("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),W=R,B=T),A===void 0&&(A=!0);let K={code:B,language:W};P("before:highlight",K);let J=K.result?K.result:d(K.language,K.code,A);return J.code=K.code,P("after:highlight",J),J}function d(R,T,A,B){let W=Object.create(null);function K(O,M){return O.keywords[M]}function J(){if(!re.keywords){oe.addText(be);return}let O=0;re.keywordPatternRe.lastIndex=0;let M=re.keywordPatternRe.exec(be),D="";for(;M;){D+=be.substring(O,M.index);let V=Je.case_insensitive?M[0].toLowerCase():M[0],G=K(re,V);if(G){let[de,ve]=G;if(oe.addText(D),D="",W[V]=(W[V]||0)+1,W[V]<=AR&&(qe+=ve),de.startsWith("_"))D+=M[0];else{let We=Je.classNameAliases[de]||de;Me(M[0],We)}}else D+=M[0];O=re.keywordPatternRe.lastIndex,M=re.keywordPatternRe.exec(be)}D+=be.substring(O),oe.addText(D)}function Z(){if(be==="")return;let O=null;if(typeof re.subLanguage=="string"){if(!t[re.subLanguage]){oe.addText(be);return}O=d(re.subLanguage,be,!0,Le[re.subLanguage]),Le[re.subLanguage]=O._top}else O=p(be,re.subLanguage.length?re.subLanguage:null);re.relevance>0&&(qe+=O.relevance),oe.__addSublanguage(O._emitter,O.language)}function ee(){re.subLanguage!=null?Z():J(),be=""}function Me(O,M){O!==""&&(oe.startScope(M),oe.addText(O),oe.endScope())}function Be(O,M){let D=1,V=M.length-1;for(;D<=V;){if(!O._emit[D]){D++;continue}let G=Je.classNameAliases[O[D]]||O[D],de=M[D];G?Me(de,G):(be=de,J(),be=""),D++}}function ye(O,M){return O.scope&&typeof O.scope=="string"&&oe.openNode(Je.classNameAliases[O.scope]||O.scope),O.beginScope&&(O.beginScope._wrap?(Me(be,Je.classNameAliases[O.beginScope._wrap]||O.beginScope._wrap),be=""):O.beginScope._multi&&(Be(O.beginScope,M),be="")),re=Object.create(O,{parent:{value:re}}),re}function pe(O,M,D){let V=GL(O.endRe,D);if(V){if(O["on:end"]){let G=new Fa(O);O["on:end"](M,G),G.isMatchIgnored&&(V=!1)}if(V){for(;O.endsParent&&O.parent;)O=O.parent;return O}}if(O.endsWithParent)return pe(O.parent,M,D)}function Fe(O){return re.matcher.regexIndex===0?(be+=O[0],1):(U=!0,0)}function rt(O){let M=O[0],D=O.rule,V=new Fa(D),G=[D.__beforeBegin,D["on:begin"]];for(let de of G)if(de&&(de(O,V),V.isMatchIgnored))return Fe(M);return D.skip?be+=M:(D.excludeBegin&&(be+=M),ee(),!D.returnBegin&&!D.excludeBegin&&(be=M)),ye(D,O),D.returnBegin?0:M.length}function Mt(O){let M=O[0],D=T.substring(O.index),V=pe(re,O,D);if(!V)return yy;let G=re;re.endScope&&re.endScope._wrap?(ee(),Me(M,re.endScope._wrap)):re.endScope&&re.endScope._multi?(ee(),Be(re.endScope,O)):G.skip?be+=M:(G.returnEnd||G.excludeEnd||(be+=M),ee(),G.excludeEnd&&(be=M));do re.scope&&oe.closeNode(),!re.skip&&!re.subLanguage&&(qe+=re.relevance),re=re.parent;while(re!==V.parent);return V.starts&&ye(V.starts,O),G.returnEnd?0:M.length}function Tt(){let O=[];for(let M=re;M!==Je;M=M.parent)M.scope&&O.unshift(M.scope);O.forEach(M=>oe.openNode(M))}let dt={};function He(O,M){let D=M&&M[0];if(be+=O,D==null)return ee(),0;if(dt.type==="begin"&&M.type==="end"&&dt.index===M.index&&D===""){if(be+=T.slice(M.index,M.index+1),!r){let V=new Error(`0 width match regex (${R})`);throw V.languageName=R,V.badRule=dt.rule,V}return 1}if(dt=M,M.type==="begin")return rt(M);if(M.type==="illegal"&&!A){let V=new Error('Illegal lexeme "'+D+'" for mode "'+(re.scope||"<unnamed>")+'"');throw V.mode=re,V}else if(M.type==="end"){let V=Mt(M);if(V!==yy)return V}if(M.type==="illegal"&&D==="")return 1;if(Ct>1e5&&Ct>M.index*3)throw new Error("potential infinite loop, way more iterations than matches");return be+=D,D.length}let Je=C(R);if(!Je)throw Ci(o.replace("{}",R)),new Error('Unknown language: "'+R+'"');let Kt=CR(Je),ne="",re=B||Kt,Le={},oe=new a.__emitter(a);Tt();let be="",qe=0,Ze=0,Ct=0,U=!1;try{if(Je.__emitTokens)Je.__emitTokens(T,oe);else{for(re.matcher.considerAll();;){Ct++,U?U=!1:re.matcher.considerAll(),re.matcher.lastIndex=Ze;let O=re.matcher.exec(T);if(!O)break;let M=T.substring(Ze,O.index),D=He(M,O);Ze=O.index+D}He(T.substring(Ze))}return oe.finalize(),ne=oe.toHTML(),{language:R,value:ne,relevance:qe,illegal:!1,_emitter:oe,_top:re}}catch(O){if(O.message&&O.message.includes("Illegal"))return{language:R,value:Vd(T),illegal:!0,relevance:0,_illegalBy:{message:O.message,index:Ze,context:T.slice(Ze-100,Ze+100),mode:O.mode,resultSoFar:ne},_emitter:oe};if(r)return{language:R,value:Vd(T),illegal:!1,relevance:0,errorRaised:O,_emitter:oe,_top:re};throw O}}function h(R){let T={value:Vd(R),illegal:!1,relevance:0,_top:s,_emitter:new a.__emitter(a)};return T._emitter.addText(R),T}function p(R,T){T=T||a.languages||Object.keys(t);let A=h(R),B=T.filter(C).filter(F).map(ee=>d(ee,R,!1));B.unshift(A);let W=B.sort((ee,Me)=>{if(ee.relevance!==Me.relevance)return Me.relevance-ee.relevance;if(ee.language&&Me.language){if(C(ee.language).supersetOf===Me.language)return 1;if(C(Me.language).supersetOf===ee.language)return-1}return 0}),[K,J]=W,Z=K;return Z.secondBest=J,Z}function f(R,T,A){let B=T&&e[T]||A;R.classList.add("hljs"),R.classList.add(`language-${B}`)}function g(R){let T=null,A=c(R);if(l(A))return;if(P("before:highlightElement",{el:R,language:A}),R.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(R)),a.throwUnescapedHTML))throw new Kd("One of your code blocks includes unescaped HTML.",R.innerHTML);T=R;let B=T.textContent,W=A?u(B,{language:A,ignoreIllegals:!0}):p(B);R.innerHTML=W.value,f(R,A,W.language),R.result={language:W.language,re:W.relevance,relevance:W.relevance},W.secondBest&&(R.secondBest={language:W.secondBest.language,relevance:W.secondBest.relevance}),P("after:highlightElement",{el:R,result:W,text:B})}function m(R){a=by(a,R)}let b=()=>{E(),dr("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function y(){E(),dr("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let v=!1;function E(){if(document.readyState==="loading"){v=!0;return}document.querySelectorAll(a.cssSelector).forEach(g)}function x(){v&&E()}typeof window!="undefined"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",x,!1);function k(R,T){let A=null;try{A=T(n)}catch(B){if(Ci("Language definition for '{}' could not be registered.".replace("{}",R)),r)Ci(B);else throw B;A=s}A.name||(A.name=R),t[R]=A,A.rawDefinition=T.bind(null,n),A.aliases&&I(A.aliases,{languageName:R})}function S(R){delete t[R];for(let T of Object.keys(e))e[T]===R&&delete e[T]}function w(){return Object.keys(t)}function C(R){return R=(R||"").toLowerCase(),t[R]||t[e[R]]}function I(R,{languageName:T}){typeof R=="string"&&(R=[R]),R.forEach(A=>{e[A.toLowerCase()]=T})}function F(R){let T=C(R);return T&&!T.disableAutodetect}function N(R){R["before:highlightBlock"]&&!R["before:highlightElement"]&&(R["before:highlightElement"]=T=>{R["before:highlightBlock"](Object.assign({block:T.el},T))}),R["after:highlightBlock"]&&!R["after:highlightElement"]&&(R["after:highlightElement"]=T=>{R["after:highlightBlock"](Object.assign({block:T.el},T))})}function H(R){N(R),i.push(R)}function _(R){let T=i.indexOf(R);T!==-1&&i.splice(T,1)}function P(R,T){let A=R;i.forEach(function(B){B[A]&&B[A](T)})}function L(R){return dr("10.7.0","highlightBlock will be removed entirely in v12.0"),dr("10.7.0","Please use highlightElement now."),g(R)}Object.assign(n,{highlight:u,highlightAuto:p,highlightAll:E,highlightElement:g,highlightBlock:L,configure:m,initHighlighting:b,initHighlightingOnLoad:y,registerLanguage:k,unregisterLanguage:S,listLanguages:w,getLanguage:C,registerAliases:I,autoDetection:F,inherit:by,addPlugin:H,removePlugin:_}),n.debugMode=function(){r=!1},n.safeMode=function(){r=!0},n.versionString=RR,n.regex={concat:Li,lookahead:xy,either:qd,optional:KL,anyNumberOfTimes:UL};for(let R in Ba)typeof Ba[R]=="object"&&vy(Ba[R]);return Object.assign(n,Ba),n},hr=Ay({});hr.newInstance=()=>Ay({});Iy.exports=hr;hr.HighlightJS=hr;hr.default=hr});var _y=Qe((bH,Yd)=>{(function(){var n;typeof Yd!="undefined"?n=Yd.exports=i:n=(function(){return this||(0,eval)("this")})(),n.format=i,n.vsprintf=e,typeof console!="undefined"&&typeof console.log=="function"&&(n.printf=t);function t(){console.log(i.apply(null,arguments))}function e(r,o){return i.apply(null,[r].concat(o))}function i(r){for(var o=1,s=[].slice.call(arguments),a=0,l=r.length,c="",u,d=!1,h,p,f=!1,g,m=function(){return s[o++]},b=function(){for(var y="";/\d/.test(r[a]);)y+=r[a++],u=r[a];return y.length>0?parseInt(y):null};a<l;++a)if(u=r[a],d)switch(d=!1,u=="."?(f=!1,u=r[++a]):u=="0"&&r[a+1]=="."?(f=!0,a+=2,u=r[a]):f=!0,g=b(),u){case"b":c+=parseInt(m(),10).toString(2);break;case"c":h=m(),typeof h=="string"||h instanceof String?c+=h:c+=String.fromCharCode(parseInt(h,10));break;case"d":c+=parseInt(m(),10);break;case"f":p=String(parseFloat(m()).toFixed(g||6)),c+=f?p:p.replace(/^0/,"");break;case"j":c+=JSON.stringify(m());break;case"o":c+="0"+parseInt(m(),10).toString(8);break;case"s":c+=m();break;case"x":c+="0x"+parseInt(m(),10).toString(16);break;case"X":c+="0x"+parseInt(m(),10).toString(16).toUpperCase();break;default:c+=u;break}else u==="%"?d=!0:c+=u;return c}})()});var sv=Qe(fo=>{"use strict";var Qy={};function KR(n){let t=Qy[n];if(t)return t;t=Qy[n]=[];for(let e=0;e<128;e++){let i=String.fromCharCode(e);t.push(i)}for(let e=0;e<n.length;e++){let i=n.charCodeAt(e);t[i]="%"+("0"+i.toString(16).toUpperCase()).slice(-2)}return t}function qa(n,t){typeof t!="string"&&(t=qa.defaultChars);let e=KR(t);return n.replace(/(%[a-f0-9]{2})+/gi,function(i){let r="";for(let o=0,s=i.length;o<s;o+=3){let a=parseInt(i.slice(o+1,o+3),16);if(a<128){r+=e[a];continue}if((a&224)===192&&o+3<s){let l=parseInt(i.slice(o+4,o+6),16);if((l&192)===128){let c=a<<6&1984|l&63;c<128?r+="\uFFFD\uFFFD":r+=String.fromCharCode(c),o+=3;continue}}if((a&240)===224&&o+6<s){let l=parseInt(i.slice(o+4,o+6),16),c=parseInt(i.slice(o+7,o+9),16);if((l&192)===128&&(c&192)===128){let u=a<<12&61440|l<<6&4032|c&63;u<2048||u>=55296&&u<=57343?r+="\uFFFD\uFFFD\uFFFD":r+=String.fromCharCode(u),o+=6;continue}}if((a&248)===240&&o+9<s){let l=parseInt(i.slice(o+4,o+6),16),c=parseInt(i.slice(o+7,o+9),16),u=parseInt(i.slice(o+10,o+12),16);if((l&192)===128&&(c&192)===128&&(u&192)===128){let d=a<<18&1835008|l<<12&258048|c<<6&4032|u&63;d<65536||d>1114111?r+="\uFFFD\uFFFD\uFFFD\uFFFD":(d-=65536,r+=String.fromCharCode(55296+(d>>10),56320+(d&1023))),o+=9;continue}}r+="\uFFFD"}return r})}qa.defaultChars=";/?:@&=+$,#";qa.componentChars="";var ev={};function qR(n){let t=ev[n];if(t)return t;t=ev[n]=[];for(let e=0;e<128;e++){let i=String.fromCharCode(e);/^[0-9a-z]$/i.test(i)?t.push(i):t.push("%"+("0"+e.toString(16).toUpperCase()).slice(-2))}for(let e=0;e<n.length;e++)t[n.charCodeAt(e)]=n[e];return t}function Ga(n,t,e){typeof t!="string"&&(e=t,t=Ga.defaultChars),typeof e=="undefined"&&(e=!0);let i=qR(t),r="";for(let o=0,s=n.length;o<s;o++){let a=n.charCodeAt(o);if(e&&a===37&&o+2<s&&/^[0-9a-f]{2}$/i.test(n.slice(o+1,o+3))){r+=n.slice(o,o+3),o+=2;continue}if(a<128){r+=i[a];continue}if(a>=55296&&a<=57343){if(a>=55296&&a<=56319&&o+1<s){let l=n.charCodeAt(o+1);if(l>=56320&&l<=57343){r+=encodeURIComponent(n[o]+n[o+1]),o++;continue}}r+="%EF%BF%BD";continue}r+=encodeURIComponent(n[o])}return r}Ga.defaultChars=";/?:@&=+$,-_.!~*'()#";Ga.componentChars="-_.!~*'()";function GR(n){let t="";return t+=n.protocol||"",t+=n.slashes?"//":"",t+=n.auth?n.auth+"@":"",n.hostname&&n.hostname.indexOf(":")!==-1?t+="["+n.hostname+"]":t+=n.hostname||"",t+=n.port?":"+n.port:"",t+=n.pathname||"",t+=n.search||"",t+=n.hash||"",t}function Ka(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}var jR=/^([a-z0-9.+-]+:)/i,YR=/:[0-9]*$/,XR=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,JR=["<",">",'"',"`"," ","\r",`
`,"	"],ZR=["{","}","|","\\","^","`"].concat(JR),QR=["'"].concat(ZR),tv=["%","/","?",";","#"].concat(QR),nv=["/","?","#"],eA=255,iv=/^[+a-z0-9A-Z_-]{0,63}$/,tA=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,rv={javascript:!0,"javascript:":!0},ov={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function nA(n,t){if(n&&n instanceof Ka)return n;let e=new Ka;return e.parse(n,t),e}Ka.prototype.parse=function(n,t){let e,i,r,o=n;if(o=o.trim(),!t&&n.split("#").length===1){let c=XR.exec(o);if(c)return this.pathname=c[1],c[2]&&(this.search=c[2]),this}let s=jR.exec(o);if(s&&(s=s[0],e=s.toLowerCase(),this.protocol=s,o=o.substr(s.length)),(t||s||o.match(/^\/\/[^@\/]+@[^@\/]+/))&&(r=o.substr(0,2)==="//",r&&!(s&&rv[s])&&(o=o.substr(2),this.slashes=!0)),!rv[s]&&(r||s&&!ov[s])){let c=-1;for(let f=0;f<nv.length;f++)i=o.indexOf(nv[f]),i!==-1&&(c===-1||i<c)&&(c=i);let u,d;c===-1?d=o.lastIndexOf("@"):d=o.lastIndexOf("@",c),d!==-1&&(u=o.slice(0,d),o=o.slice(d+1),this.auth=u),c=-1;for(let f=0;f<tv.length;f++)i=o.indexOf(tv[f]),i!==-1&&(c===-1||i<c)&&(c=i);c===-1&&(c=o.length),o[c-1]===":"&&c--;let h=o.slice(0,c);o=o.slice(c),this.parseHost(h),this.hostname=this.hostname||"";let p=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!p){let f=this.hostname.split(/\./);for(let g=0,m=f.length;g<m;g++){let b=f[g];if(b&&!b.match(iv)){let y="";for(let v=0,E=b.length;v<E;v++)b.charCodeAt(v)>127?y+="x":y+=b[v];if(!y.match(iv)){let v=f.slice(0,g),E=f.slice(g+1),x=b.match(tA);x&&(v.push(x[1]),E.unshift(x[2])),E.length&&(o=E.join(".")+o),this.hostname=v.join(".");break}}}}this.hostname.length>eA&&(this.hostname=""),p&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}let a=o.indexOf("#");a!==-1&&(this.hash=o.substr(a),o=o.slice(0,a));let l=o.indexOf("?");return l!==-1&&(this.search=o.substr(l),o=o.slice(0,l)),o&&(this.pathname=o),ov[e]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Ka.prototype.parseHost=function(n){let t=YR.exec(n);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),n=n.substr(0,n.length-t.length)),n&&(this.hostname=n)};fo.decode=qa;fo.encode=Ga;fo.format=GR;fo.parse=nA});var Qd=Qe(Ai=>{"use strict";var iA=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,rA=/[\0-\x1F\x7F-\x9F]/,oA=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,sA=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,aA=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,lA=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;Ai.Any=iA;Ai.Cc=rA;Ai.Cf=oA;Ai.P=sA;Ai.S=aA;Ai.Z=lA});var av=Qe(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0});eh.default=new Uint16Array('\u1D41<\xD5\u0131\u028A\u049D\u057B\u05D0\u0675\u06DE\u07A2\u07D6\u080F\u0A4A\u0A91\u0DA1\u0E6D\u0F09\u0F26\u10CA\u1228\u12E1\u1415\u149D\u14C3\u14DF\u1525\0\0\0\0\0\0\u156B\u16CD\u198D\u1C12\u1DDD\u1F7E\u2060\u21B0\u228D\u23C0\u23FB\u2442\u2824\u2912\u2D08\u2E48\u2FCE\u3016\u32BA\u3639\u37AC\u38FE\u3A28\u3A71\u3AE0\u3B2E\u0800EMabcfglmnoprstu\\bfms\x7F\x84\x8B\x90\x95\x98\xA6\xB3\xB9\xC8\xCFlig\u803B\xC6\u40C6P\u803B&\u4026cute\u803B\xC1\u40C1reve;\u4102\u0100iyx}rc\u803B\xC2\u40C2;\u4410r;\uC000\u{1D504}rave\u803B\xC0\u40C0pha;\u4391acr;\u4100d;\u6A53\u0100gp\x9D\xA1on;\u4104f;\uC000\u{1D538}plyFunction;\u6061ing\u803B\xC5\u40C5\u0100cs\xBE\xC3r;\uC000\u{1D49C}ign;\u6254ilde\u803B\xC3\u40C3ml\u803B\xC4\u40C4\u0400aceforsu\xE5\xFB\xFE\u0117\u011C\u0122\u0127\u012A\u0100cr\xEA\xF2kslash;\u6216\u0176\xF6\xF8;\u6AE7ed;\u6306y;\u4411\u0180crt\u0105\u010B\u0114ause;\u6235noullis;\u612Ca;\u4392r;\uC000\u{1D505}pf;\uC000\u{1D539}eve;\u42D8c\xF2\u0113mpeq;\u624E\u0700HOacdefhilorsu\u014D\u0151\u0156\u0180\u019E\u01A2\u01B5\u01B7\u01BA\u01DC\u0215\u0273\u0278\u027Ecy;\u4427PY\u803B\xA9\u40A9\u0180cpy\u015D\u0162\u017Aute;\u4106\u0100;i\u0167\u0168\u62D2talDifferentialD;\u6145leys;\u612D\u0200aeio\u0189\u018E\u0194\u0198ron;\u410Cdil\u803B\xC7\u40C7rc;\u4108nint;\u6230ot;\u410A\u0100dn\u01A7\u01ADilla;\u40B8terDot;\u40B7\xF2\u017Fi;\u43A7rcle\u0200DMPT\u01C7\u01CB\u01D1\u01D6ot;\u6299inus;\u6296lus;\u6295imes;\u6297o\u0100cs\u01E2\u01F8kwiseContourIntegral;\u6232eCurly\u0100DQ\u0203\u020FoubleQuote;\u601Duote;\u6019\u0200lnpu\u021E\u0228\u0247\u0255on\u0100;e\u0225\u0226\u6237;\u6A74\u0180git\u022F\u0236\u023Aruent;\u6261nt;\u622FourIntegral;\u622E\u0100fr\u024C\u024E;\u6102oduct;\u6210nterClockwiseContourIntegral;\u6233oss;\u6A2Fcr;\uC000\u{1D49E}p\u0100;C\u0284\u0285\u62D3ap;\u624D\u0580DJSZacefios\u02A0\u02AC\u02B0\u02B4\u02B8\u02CB\u02D7\u02E1\u02E6\u0333\u048D\u0100;o\u0179\u02A5trahd;\u6911cy;\u4402cy;\u4405cy;\u440F\u0180grs\u02BF\u02C4\u02C7ger;\u6021r;\u61A1hv;\u6AE4\u0100ay\u02D0\u02D5ron;\u410E;\u4414l\u0100;t\u02DD\u02DE\u6207a;\u4394r;\uC000\u{1D507}\u0100af\u02EB\u0327\u0100cm\u02F0\u0322ritical\u0200ADGT\u0300\u0306\u0316\u031Ccute;\u40B4o\u0174\u030B\u030D;\u42D9bleAcute;\u42DDrave;\u4060ilde;\u42DCond;\u62C4ferentialD;\u6146\u0470\u033D\0\0\0\u0342\u0354\0\u0405f;\uC000\u{1D53B}\u0180;DE\u0348\u0349\u034D\u40A8ot;\u60DCqual;\u6250ble\u0300CDLRUV\u0363\u0372\u0382\u03CF\u03E2\u03F8ontourIntegra\xEC\u0239o\u0274\u0379\0\0\u037B\xBB\u0349nArrow;\u61D3\u0100eo\u0387\u03A4ft\u0180ART\u0390\u0396\u03A1rrow;\u61D0ightArrow;\u61D4e\xE5\u02CAng\u0100LR\u03AB\u03C4eft\u0100AR\u03B3\u03B9rrow;\u67F8ightArrow;\u67FAightArrow;\u67F9ight\u0100AT\u03D8\u03DErrow;\u61D2ee;\u62A8p\u0241\u03E9\0\0\u03EFrrow;\u61D1ownArrow;\u61D5erticalBar;\u6225n\u0300ABLRTa\u0412\u042A\u0430\u045E\u047F\u037Crrow\u0180;BU\u041D\u041E\u0422\u6193ar;\u6913pArrow;\u61F5reve;\u4311eft\u02D2\u043A\0\u0446\0\u0450ightVector;\u6950eeVector;\u695Eector\u0100;B\u0459\u045A\u61BDar;\u6956ight\u01D4\u0467\0\u0471eeVector;\u695Fector\u0100;B\u047A\u047B\u61C1ar;\u6957ee\u0100;A\u0486\u0487\u62A4rrow;\u61A7\u0100ct\u0492\u0497r;\uC000\u{1D49F}rok;\u4110\u0800NTacdfglmopqstux\u04BD\u04C0\u04C4\u04CB\u04DE\u04E2\u04E7\u04EE\u04F5\u0521\u052F\u0536\u0552\u055D\u0560\u0565G;\u414AH\u803B\xD0\u40D0cute\u803B\xC9\u40C9\u0180aiy\u04D2\u04D7\u04DCron;\u411Arc\u803B\xCA\u40CA;\u442Dot;\u4116r;\uC000\u{1D508}rave\u803B\xC8\u40C8ement;\u6208\u0100ap\u04FA\u04FEcr;\u4112ty\u0253\u0506\0\0\u0512mallSquare;\u65FBerySmallSquare;\u65AB\u0100gp\u0526\u052Aon;\u4118f;\uC000\u{1D53C}silon;\u4395u\u0100ai\u053C\u0549l\u0100;T\u0542\u0543\u6A75ilde;\u6242librium;\u61CC\u0100ci\u0557\u055Ar;\u6130m;\u6A73a;\u4397ml\u803B\xCB\u40CB\u0100ip\u056A\u056Fsts;\u6203onentialE;\u6147\u0280cfios\u0585\u0588\u058D\u05B2\u05CCy;\u4424r;\uC000\u{1D509}lled\u0253\u0597\0\0\u05A3mallSquare;\u65FCerySmallSquare;\u65AA\u0370\u05BA\0\u05BF\0\0\u05C4f;\uC000\u{1D53D}All;\u6200riertrf;\u6131c\xF2\u05CB\u0600JTabcdfgorst\u05E8\u05EC\u05EF\u05FA\u0600\u0612\u0616\u061B\u061D\u0623\u066C\u0672cy;\u4403\u803B>\u403Emma\u0100;d\u05F7\u05F8\u4393;\u43DCreve;\u411E\u0180eiy\u0607\u060C\u0610dil;\u4122rc;\u411C;\u4413ot;\u4120r;\uC000\u{1D50A};\u62D9pf;\uC000\u{1D53E}eater\u0300EFGLST\u0635\u0644\u064E\u0656\u065B\u0666qual\u0100;L\u063E\u063F\u6265ess;\u62DBullEqual;\u6267reater;\u6AA2ess;\u6277lantEqual;\u6A7Eilde;\u6273cr;\uC000\u{1D4A2};\u626B\u0400Aacfiosu\u0685\u068B\u0696\u069B\u069E\u06AA\u06BE\u06CARDcy;\u442A\u0100ct\u0690\u0694ek;\u42C7;\u405Eirc;\u4124r;\u610ClbertSpace;\u610B\u01F0\u06AF\0\u06B2f;\u610DizontalLine;\u6500\u0100ct\u06C3\u06C5\xF2\u06A9rok;\u4126mp\u0144\u06D0\u06D8ownHum\xF0\u012Fqual;\u624F\u0700EJOacdfgmnostu\u06FA\u06FE\u0703\u0707\u070E\u071A\u071E\u0721\u0728\u0744\u0778\u078B\u078F\u0795cy;\u4415lig;\u4132cy;\u4401cute\u803B\xCD\u40CD\u0100iy\u0713\u0718rc\u803B\xCE\u40CE;\u4418ot;\u4130r;\u6111rave\u803B\xCC\u40CC\u0180;ap\u0720\u072F\u073F\u0100cg\u0734\u0737r;\u412AinaryI;\u6148lie\xF3\u03DD\u01F4\u0749\0\u0762\u0100;e\u074D\u074E\u622C\u0100gr\u0753\u0758ral;\u622Bsection;\u62C2isible\u0100CT\u076C\u0772omma;\u6063imes;\u6062\u0180gpt\u077F\u0783\u0788on;\u412Ef;\uC000\u{1D540}a;\u4399cr;\u6110ilde;\u4128\u01EB\u079A\0\u079Ecy;\u4406l\u803B\xCF\u40CF\u0280cfosu\u07AC\u07B7\u07BC\u07C2\u07D0\u0100iy\u07B1\u07B5rc;\u4134;\u4419r;\uC000\u{1D50D}pf;\uC000\u{1D541}\u01E3\u07C7\0\u07CCr;\uC000\u{1D4A5}rcy;\u4408kcy;\u4404\u0380HJacfos\u07E4\u07E8\u07EC\u07F1\u07FD\u0802\u0808cy;\u4425cy;\u440Cppa;\u439A\u0100ey\u07F6\u07FBdil;\u4136;\u441Ar;\uC000\u{1D50E}pf;\uC000\u{1D542}cr;\uC000\u{1D4A6}\u0580JTaceflmost\u0825\u0829\u082C\u0850\u0863\u09B3\u09B8\u09C7\u09CD\u0A37\u0A47cy;\u4409\u803B<\u403C\u0280cmnpr\u0837\u083C\u0841\u0844\u084Dute;\u4139bda;\u439Bg;\u67EAlacetrf;\u6112r;\u619E\u0180aey\u0857\u085C\u0861ron;\u413Ddil;\u413B;\u441B\u0100fs\u0868\u0970t\u0500ACDFRTUVar\u087E\u08A9\u08B1\u08E0\u08E6\u08FC\u092F\u095B\u0390\u096A\u0100nr\u0883\u088FgleBracket;\u67E8row\u0180;BR\u0899\u089A\u089E\u6190ar;\u61E4ightArrow;\u61C6eiling;\u6308o\u01F5\u08B7\0\u08C3bleBracket;\u67E6n\u01D4\u08C8\0\u08D2eeVector;\u6961ector\u0100;B\u08DB\u08DC\u61C3ar;\u6959loor;\u630Aight\u0100AV\u08EF\u08F5rrow;\u6194ector;\u694E\u0100er\u0901\u0917e\u0180;AV\u0909\u090A\u0910\u62A3rrow;\u61A4ector;\u695Aiangle\u0180;BE\u0924\u0925\u0929\u62B2ar;\u69CFqual;\u62B4p\u0180DTV\u0937\u0942\u094CownVector;\u6951eeVector;\u6960ector\u0100;B\u0956\u0957\u61BFar;\u6958ector\u0100;B\u0965\u0966\u61BCar;\u6952ight\xE1\u039Cs\u0300EFGLST\u097E\u098B\u0995\u099D\u09A2\u09ADqualGreater;\u62DAullEqual;\u6266reater;\u6276ess;\u6AA1lantEqual;\u6A7Dilde;\u6272r;\uC000\u{1D50F}\u0100;e\u09BD\u09BE\u62D8ftarrow;\u61DAidot;\u413F\u0180npw\u09D4\u0A16\u0A1Bg\u0200LRlr\u09DE\u09F7\u0A02\u0A10eft\u0100AR\u09E6\u09ECrrow;\u67F5ightArrow;\u67F7ightArrow;\u67F6eft\u0100ar\u03B3\u0A0Aight\xE1\u03BFight\xE1\u03CAf;\uC000\u{1D543}er\u0100LR\u0A22\u0A2CeftArrow;\u6199ightArrow;\u6198\u0180cht\u0A3E\u0A40\u0A42\xF2\u084C;\u61B0rok;\u4141;\u626A\u0400acefiosu\u0A5A\u0A5D\u0A60\u0A77\u0A7C\u0A85\u0A8B\u0A8Ep;\u6905y;\u441C\u0100dl\u0A65\u0A6FiumSpace;\u605Flintrf;\u6133r;\uC000\u{1D510}nusPlus;\u6213pf;\uC000\u{1D544}c\xF2\u0A76;\u439C\u0480Jacefostu\u0AA3\u0AA7\u0AAD\u0AC0\u0B14\u0B19\u0D91\u0D97\u0D9Ecy;\u440Acute;\u4143\u0180aey\u0AB4\u0AB9\u0ABEron;\u4147dil;\u4145;\u441D\u0180gsw\u0AC7\u0AF0\u0B0Eative\u0180MTV\u0AD3\u0ADF\u0AE8ediumSpace;\u600Bhi\u0100cn\u0AE6\u0AD8\xEB\u0AD9eryThi\xEE\u0AD9ted\u0100GL\u0AF8\u0B06reaterGreate\xF2\u0673essLes\xF3\u0A48Line;\u400Ar;\uC000\u{1D511}\u0200Bnpt\u0B22\u0B28\u0B37\u0B3Areak;\u6060BreakingSpace;\u40A0f;\u6115\u0680;CDEGHLNPRSTV\u0B55\u0B56\u0B6A\u0B7C\u0BA1\u0BEB\u0C04\u0C5E\u0C84\u0CA6\u0CD8\u0D61\u0D85\u6AEC\u0100ou\u0B5B\u0B64ngruent;\u6262pCap;\u626DoubleVerticalBar;\u6226\u0180lqx\u0B83\u0B8A\u0B9Bement;\u6209ual\u0100;T\u0B92\u0B93\u6260ilde;\uC000\u2242\u0338ists;\u6204reater\u0380;EFGLST\u0BB6\u0BB7\u0BBD\u0BC9\u0BD3\u0BD8\u0BE5\u626Fqual;\u6271ullEqual;\uC000\u2267\u0338reater;\uC000\u226B\u0338ess;\u6279lantEqual;\uC000\u2A7E\u0338ilde;\u6275ump\u0144\u0BF2\u0BFDownHump;\uC000\u224E\u0338qual;\uC000\u224F\u0338e\u0100fs\u0C0A\u0C27tTriangle\u0180;BE\u0C1A\u0C1B\u0C21\u62EAar;\uC000\u29CF\u0338qual;\u62ECs\u0300;EGLST\u0C35\u0C36\u0C3C\u0C44\u0C4B\u0C58\u626Equal;\u6270reater;\u6278ess;\uC000\u226A\u0338lantEqual;\uC000\u2A7D\u0338ilde;\u6274ested\u0100GL\u0C68\u0C79reaterGreater;\uC000\u2AA2\u0338essLess;\uC000\u2AA1\u0338recedes\u0180;ES\u0C92\u0C93\u0C9B\u6280qual;\uC000\u2AAF\u0338lantEqual;\u62E0\u0100ei\u0CAB\u0CB9verseElement;\u620CghtTriangle\u0180;BE\u0CCB\u0CCC\u0CD2\u62EBar;\uC000\u29D0\u0338qual;\u62ED\u0100qu\u0CDD\u0D0CuareSu\u0100bp\u0CE8\u0CF9set\u0100;E\u0CF0\u0CF3\uC000\u228F\u0338qual;\u62E2erset\u0100;E\u0D03\u0D06\uC000\u2290\u0338qual;\u62E3\u0180bcp\u0D13\u0D24\u0D4Eset\u0100;E\u0D1B\u0D1E\uC000\u2282\u20D2qual;\u6288ceeds\u0200;EST\u0D32\u0D33\u0D3B\u0D46\u6281qual;\uC000\u2AB0\u0338lantEqual;\u62E1ilde;\uC000\u227F\u0338erset\u0100;E\u0D58\u0D5B\uC000\u2283\u20D2qual;\u6289ilde\u0200;EFT\u0D6E\u0D6F\u0D75\u0D7F\u6241qual;\u6244ullEqual;\u6247ilde;\u6249erticalBar;\u6224cr;\uC000\u{1D4A9}ilde\u803B\xD1\u40D1;\u439D\u0700Eacdfgmoprstuv\u0DBD\u0DC2\u0DC9\u0DD5\u0DDB\u0DE0\u0DE7\u0DFC\u0E02\u0E20\u0E22\u0E32\u0E3F\u0E44lig;\u4152cute\u803B\xD3\u40D3\u0100iy\u0DCE\u0DD3rc\u803B\xD4\u40D4;\u441Eblac;\u4150r;\uC000\u{1D512}rave\u803B\xD2\u40D2\u0180aei\u0DEE\u0DF2\u0DF6cr;\u414Cga;\u43A9cron;\u439Fpf;\uC000\u{1D546}enCurly\u0100DQ\u0E0E\u0E1AoubleQuote;\u601Cuote;\u6018;\u6A54\u0100cl\u0E27\u0E2Cr;\uC000\u{1D4AA}ash\u803B\xD8\u40D8i\u016C\u0E37\u0E3Cde\u803B\xD5\u40D5es;\u6A37ml\u803B\xD6\u40D6er\u0100BP\u0E4B\u0E60\u0100ar\u0E50\u0E53r;\u603Eac\u0100ek\u0E5A\u0E5C;\u63DEet;\u63B4arenthesis;\u63DC\u0480acfhilors\u0E7F\u0E87\u0E8A\u0E8F\u0E92\u0E94\u0E9D\u0EB0\u0EFCrtialD;\u6202y;\u441Fr;\uC000\u{1D513}i;\u43A6;\u43A0usMinus;\u40B1\u0100ip\u0EA2\u0EADncareplan\xE5\u069Df;\u6119\u0200;eio\u0EB9\u0EBA\u0EE0\u0EE4\u6ABBcedes\u0200;EST\u0EC8\u0EC9\u0ECF\u0EDA\u627Aqual;\u6AAFlantEqual;\u627Cilde;\u627Eme;\u6033\u0100dp\u0EE9\u0EEEuct;\u620Fortion\u0100;a\u0225\u0EF9l;\u621D\u0100ci\u0F01\u0F06r;\uC000\u{1D4AB};\u43A8\u0200Ufos\u0F11\u0F16\u0F1B\u0F1FOT\u803B"\u4022r;\uC000\u{1D514}pf;\u611Acr;\uC000\u{1D4AC}\u0600BEacefhiorsu\u0F3E\u0F43\u0F47\u0F60\u0F73\u0FA7\u0FAA\u0FAD\u1096\u10A9\u10B4\u10BEarr;\u6910G\u803B\xAE\u40AE\u0180cnr\u0F4E\u0F53\u0F56ute;\u4154g;\u67EBr\u0100;t\u0F5C\u0F5D\u61A0l;\u6916\u0180aey\u0F67\u0F6C\u0F71ron;\u4158dil;\u4156;\u4420\u0100;v\u0F78\u0F79\u611Cerse\u0100EU\u0F82\u0F99\u0100lq\u0F87\u0F8Eement;\u620Builibrium;\u61CBpEquilibrium;\u696Fr\xBB\u0F79o;\u43A1ght\u0400ACDFTUVa\u0FC1\u0FEB\u0FF3\u1022\u1028\u105B\u1087\u03D8\u0100nr\u0FC6\u0FD2gleBracket;\u67E9row\u0180;BL\u0FDC\u0FDD\u0FE1\u6192ar;\u61E5eftArrow;\u61C4eiling;\u6309o\u01F5\u0FF9\0\u1005bleBracket;\u67E7n\u01D4\u100A\0\u1014eeVector;\u695Dector\u0100;B\u101D\u101E\u61C2ar;\u6955loor;\u630B\u0100er\u102D\u1043e\u0180;AV\u1035\u1036\u103C\u62A2rrow;\u61A6ector;\u695Biangle\u0180;BE\u1050\u1051\u1055\u62B3ar;\u69D0qual;\u62B5p\u0180DTV\u1063\u106E\u1078ownVector;\u694FeeVector;\u695Cector\u0100;B\u1082\u1083\u61BEar;\u6954ector\u0100;B\u1091\u1092\u61C0ar;\u6953\u0100pu\u109B\u109Ef;\u611DndImplies;\u6970ightarrow;\u61DB\u0100ch\u10B9\u10BCr;\u611B;\u61B1leDelayed;\u69F4\u0680HOacfhimoqstu\u10E4\u10F1\u10F7\u10FD\u1119\u111E\u1151\u1156\u1161\u1167\u11B5\u11BB\u11BF\u0100Cc\u10E9\u10EEHcy;\u4429y;\u4428FTcy;\u442Ccute;\u415A\u0280;aeiy\u1108\u1109\u110E\u1113\u1117\u6ABCron;\u4160dil;\u415Erc;\u415C;\u4421r;\uC000\u{1D516}ort\u0200DLRU\u112A\u1134\u113E\u1149ownArrow\xBB\u041EeftArrow\xBB\u089AightArrow\xBB\u0FDDpArrow;\u6191gma;\u43A3allCircle;\u6218pf;\uC000\u{1D54A}\u0272\u116D\0\0\u1170t;\u621Aare\u0200;ISU\u117B\u117C\u1189\u11AF\u65A1ntersection;\u6293u\u0100bp\u118F\u119Eset\u0100;E\u1197\u1198\u628Fqual;\u6291erset\u0100;E\u11A8\u11A9\u6290qual;\u6292nion;\u6294cr;\uC000\u{1D4AE}ar;\u62C6\u0200bcmp\u11C8\u11DB\u1209\u120B\u0100;s\u11CD\u11CE\u62D0et\u0100;E\u11CD\u11D5qual;\u6286\u0100ch\u11E0\u1205eeds\u0200;EST\u11ED\u11EE\u11F4\u11FF\u627Bqual;\u6AB0lantEqual;\u627Dilde;\u627FTh\xE1\u0F8C;\u6211\u0180;es\u1212\u1213\u1223\u62D1rset\u0100;E\u121C\u121D\u6283qual;\u6287et\xBB\u1213\u0580HRSacfhiors\u123E\u1244\u1249\u1255\u125E\u1271\u1276\u129F\u12C2\u12C8\u12D1ORN\u803B\xDE\u40DEADE;\u6122\u0100Hc\u124E\u1252cy;\u440By;\u4426\u0100bu\u125A\u125C;\u4009;\u43A4\u0180aey\u1265\u126A\u126Fron;\u4164dil;\u4162;\u4422r;\uC000\u{1D517}\u0100ei\u127B\u1289\u01F2\u1280\0\u1287efore;\u6234a;\u4398\u0100cn\u128E\u1298kSpace;\uC000\u205F\u200ASpace;\u6009lde\u0200;EFT\u12AB\u12AC\u12B2\u12BC\u623Cqual;\u6243ullEqual;\u6245ilde;\u6248pf;\uC000\u{1D54B}ipleDot;\u60DB\u0100ct\u12D6\u12DBr;\uC000\u{1D4AF}rok;\u4166\u0AE1\u12F7\u130E\u131A\u1326\0\u132C\u1331\0\0\0\0\0\u1338\u133D\u1377\u1385\0\u13FF\u1404\u140A\u1410\u0100cr\u12FB\u1301ute\u803B\xDA\u40DAr\u0100;o\u1307\u1308\u619Fcir;\u6949r\u01E3\u1313\0\u1316y;\u440Eve;\u416C\u0100iy\u131E\u1323rc\u803B\xDB\u40DB;\u4423blac;\u4170r;\uC000\u{1D518}rave\u803B\xD9\u40D9acr;\u416A\u0100di\u1341\u1369er\u0100BP\u1348\u135D\u0100ar\u134D\u1350r;\u405Fac\u0100ek\u1357\u1359;\u63DFet;\u63B5arenthesis;\u63DDon\u0100;P\u1370\u1371\u62C3lus;\u628E\u0100gp\u137B\u137Fon;\u4172f;\uC000\u{1D54C}\u0400ADETadps\u1395\u13AE\u13B8\u13C4\u03E8\u13D2\u13D7\u13F3rrow\u0180;BD\u1150\u13A0\u13A4ar;\u6912ownArrow;\u61C5ownArrow;\u6195quilibrium;\u696Eee\u0100;A\u13CB\u13CC\u62A5rrow;\u61A5own\xE1\u03F3er\u0100LR\u13DE\u13E8eftArrow;\u6196ightArrow;\u6197i\u0100;l\u13F9\u13FA\u43D2on;\u43A5ing;\u416Ecr;\uC000\u{1D4B0}ilde;\u4168ml\u803B\xDC\u40DC\u0480Dbcdefosv\u1427\u142C\u1430\u1433\u143E\u1485\u148A\u1490\u1496ash;\u62ABar;\u6AEBy;\u4412ash\u0100;l\u143B\u143C\u62A9;\u6AE6\u0100er\u1443\u1445;\u62C1\u0180bty\u144C\u1450\u147Aar;\u6016\u0100;i\u144F\u1455cal\u0200BLST\u1461\u1465\u146A\u1474ar;\u6223ine;\u407Ceparator;\u6758ilde;\u6240ThinSpace;\u600Ar;\uC000\u{1D519}pf;\uC000\u{1D54D}cr;\uC000\u{1D4B1}dash;\u62AA\u0280cefos\u14A7\u14AC\u14B1\u14B6\u14BCirc;\u4174dge;\u62C0r;\uC000\u{1D51A}pf;\uC000\u{1D54E}cr;\uC000\u{1D4B2}\u0200fios\u14CB\u14D0\u14D2\u14D8r;\uC000\u{1D51B};\u439Epf;\uC000\u{1D54F}cr;\uC000\u{1D4B3}\u0480AIUacfosu\u14F1\u14F5\u14F9\u14FD\u1504\u150F\u1514\u151A\u1520cy;\u442Fcy;\u4407cy;\u442Ecute\u803B\xDD\u40DD\u0100iy\u1509\u150Drc;\u4176;\u442Br;\uC000\u{1D51C}pf;\uC000\u{1D550}cr;\uC000\u{1D4B4}ml;\u4178\u0400Hacdefos\u1535\u1539\u153F\u154B\u154F\u155D\u1560\u1564cy;\u4416cute;\u4179\u0100ay\u1544\u1549ron;\u417D;\u4417ot;\u417B\u01F2\u1554\0\u155BoWidt\xE8\u0AD9a;\u4396r;\u6128pf;\u6124cr;\uC000\u{1D4B5}\u0BE1\u1583\u158A\u1590\0\u15B0\u15B6\u15BF\0\0\0\0\u15C6\u15DB\u15EB\u165F\u166D\0\u1695\u169B\u16B2\u16B9\0\u16BEcute\u803B\xE1\u40E1reve;\u4103\u0300;Ediuy\u159C\u159D\u15A1\u15A3\u15A8\u15AD\u623E;\uC000\u223E\u0333;\u623Frc\u803B\xE2\u40E2te\u80BB\xB4\u0306;\u4430lig\u803B\xE6\u40E6\u0100;r\xB2\u15BA;\uC000\u{1D51E}rave\u803B\xE0\u40E0\u0100ep\u15CA\u15D6\u0100fp\u15CF\u15D4sym;\u6135\xE8\u15D3ha;\u43B1\u0100ap\u15DFc\u0100cl\u15E4\u15E7r;\u4101g;\u6A3F\u0264\u15F0\0\0\u160A\u0280;adsv\u15FA\u15FB\u15FF\u1601\u1607\u6227nd;\u6A55;\u6A5Clope;\u6A58;\u6A5A\u0380;elmrsz\u1618\u1619\u161B\u161E\u163F\u164F\u1659\u6220;\u69A4e\xBB\u1619sd\u0100;a\u1625\u1626\u6221\u0461\u1630\u1632\u1634\u1636\u1638\u163A\u163C\u163E;\u69A8;\u69A9;\u69AA;\u69AB;\u69AC;\u69AD;\u69AE;\u69AFt\u0100;v\u1645\u1646\u621Fb\u0100;d\u164C\u164D\u62BE;\u699D\u0100pt\u1654\u1657h;\u6222\xBB\xB9arr;\u637C\u0100gp\u1663\u1667on;\u4105f;\uC000\u{1D552}\u0380;Eaeiop\u12C1\u167B\u167D\u1682\u1684\u1687\u168A;\u6A70cir;\u6A6F;\u624Ad;\u624Bs;\u4027rox\u0100;e\u12C1\u1692\xF1\u1683ing\u803B\xE5\u40E5\u0180cty\u16A1\u16A6\u16A8r;\uC000\u{1D4B6};\u402Amp\u0100;e\u12C1\u16AF\xF1\u0288ilde\u803B\xE3\u40E3ml\u803B\xE4\u40E4\u0100ci\u16C2\u16C8onin\xF4\u0272nt;\u6A11\u0800Nabcdefiklnoprsu\u16ED\u16F1\u1730\u173C\u1743\u1748\u1778\u177D\u17E0\u17E6\u1839\u1850\u170D\u193D\u1948\u1970ot;\u6AED\u0100cr\u16F6\u171Ek\u0200ceps\u1700\u1705\u170D\u1713ong;\u624Cpsilon;\u43F6rime;\u6035im\u0100;e\u171A\u171B\u623Dq;\u62CD\u0176\u1722\u1726ee;\u62BDed\u0100;g\u172C\u172D\u6305e\xBB\u172Drk\u0100;t\u135C\u1737brk;\u63B6\u0100oy\u1701\u1741;\u4431quo;\u601E\u0280cmprt\u1753\u175B\u1761\u1764\u1768aus\u0100;e\u010A\u0109ptyv;\u69B0s\xE9\u170Cno\xF5\u0113\u0180ahw\u176F\u1771\u1773;\u43B2;\u6136een;\u626Cr;\uC000\u{1D51F}g\u0380costuvw\u178D\u179D\u17B3\u17C1\u17D5\u17DB\u17DE\u0180aiu\u1794\u1796\u179A\xF0\u0760rc;\u65EFp\xBB\u1371\u0180dpt\u17A4\u17A8\u17ADot;\u6A00lus;\u6A01imes;\u6A02\u0271\u17B9\0\0\u17BEcup;\u6A06ar;\u6605riangle\u0100du\u17CD\u17D2own;\u65BDp;\u65B3plus;\u6A04e\xE5\u1444\xE5\u14ADarow;\u690D\u0180ako\u17ED\u1826\u1835\u0100cn\u17F2\u1823k\u0180lst\u17FA\u05AB\u1802ozenge;\u69EBriangle\u0200;dlr\u1812\u1813\u1818\u181D\u65B4own;\u65BEeft;\u65C2ight;\u65B8k;\u6423\u01B1\u182B\0\u1833\u01B2\u182F\0\u1831;\u6592;\u65914;\u6593ck;\u6588\u0100eo\u183E\u184D\u0100;q\u1843\u1846\uC000=\u20E5uiv;\uC000\u2261\u20E5t;\u6310\u0200ptwx\u1859\u185E\u1867\u186Cf;\uC000\u{1D553}\u0100;t\u13CB\u1863om\xBB\u13CCtie;\u62C8\u0600DHUVbdhmptuv\u1885\u1896\u18AA\u18BB\u18D7\u18DB\u18EC\u18FF\u1905\u190A\u1910\u1921\u0200LRlr\u188E\u1890\u1892\u1894;\u6557;\u6554;\u6556;\u6553\u0280;DUdu\u18A1\u18A2\u18A4\u18A6\u18A8\u6550;\u6566;\u6569;\u6564;\u6567\u0200LRlr\u18B3\u18B5\u18B7\u18B9;\u655D;\u655A;\u655C;\u6559\u0380;HLRhlr\u18CA\u18CB\u18CD\u18CF\u18D1\u18D3\u18D5\u6551;\u656C;\u6563;\u6560;\u656B;\u6562;\u655Fox;\u69C9\u0200LRlr\u18E4\u18E6\u18E8\u18EA;\u6555;\u6552;\u6510;\u650C\u0280;DUdu\u06BD\u18F7\u18F9\u18FB\u18FD;\u6565;\u6568;\u652C;\u6534inus;\u629Flus;\u629Eimes;\u62A0\u0200LRlr\u1919\u191B\u191D\u191F;\u655B;\u6558;\u6518;\u6514\u0380;HLRhlr\u1930\u1931\u1933\u1935\u1937\u1939\u193B\u6502;\u656A;\u6561;\u655E;\u653C;\u6524;\u651C\u0100ev\u0123\u1942bar\u803B\xA6\u40A6\u0200ceio\u1951\u1956\u195A\u1960r;\uC000\u{1D4B7}mi;\u604Fm\u0100;e\u171A\u171Cl\u0180;bh\u1968\u1969\u196B\u405C;\u69C5sub;\u67C8\u016C\u1974\u197El\u0100;e\u1979\u197A\u6022t\xBB\u197Ap\u0180;Ee\u012F\u1985\u1987;\u6AAE\u0100;q\u06DC\u06DB\u0CE1\u19A7\0\u19E8\u1A11\u1A15\u1A32\0\u1A37\u1A50\0\0\u1AB4\0\0\u1AC1\0\0\u1B21\u1B2E\u1B4D\u1B52\0\u1BFD\0\u1C0C\u0180cpr\u19AD\u19B2\u19DDute;\u4107\u0300;abcds\u19BF\u19C0\u19C4\u19CA\u19D5\u19D9\u6229nd;\u6A44rcup;\u6A49\u0100au\u19CF\u19D2p;\u6A4Bp;\u6A47ot;\u6A40;\uC000\u2229\uFE00\u0100eo\u19E2\u19E5t;\u6041\xEE\u0693\u0200aeiu\u19F0\u19FB\u1A01\u1A05\u01F0\u19F5\0\u19F8s;\u6A4Don;\u410Ddil\u803B\xE7\u40E7rc;\u4109ps\u0100;s\u1A0C\u1A0D\u6A4Cm;\u6A50ot;\u410B\u0180dmn\u1A1B\u1A20\u1A26il\u80BB\xB8\u01ADptyv;\u69B2t\u8100\xA2;e\u1A2D\u1A2E\u40A2r\xE4\u01B2r;\uC000\u{1D520}\u0180cei\u1A3D\u1A40\u1A4Dy;\u4447ck\u0100;m\u1A47\u1A48\u6713ark\xBB\u1A48;\u43C7r\u0380;Ecefms\u1A5F\u1A60\u1A62\u1A6B\u1AA4\u1AAA\u1AAE\u65CB;\u69C3\u0180;el\u1A69\u1A6A\u1A6D\u42C6q;\u6257e\u0261\u1A74\0\0\u1A88rrow\u0100lr\u1A7C\u1A81eft;\u61BAight;\u61BB\u0280RSacd\u1A92\u1A94\u1A96\u1A9A\u1A9F\xBB\u0F47;\u64C8st;\u629Birc;\u629Aash;\u629Dnint;\u6A10id;\u6AEFcir;\u69C2ubs\u0100;u\u1ABB\u1ABC\u6663it\xBB\u1ABC\u02EC\u1AC7\u1AD4\u1AFA\0\u1B0Aon\u0100;e\u1ACD\u1ACE\u403A\u0100;q\xC7\xC6\u026D\u1AD9\0\0\u1AE2a\u0100;t\u1ADE\u1ADF\u402C;\u4040\u0180;fl\u1AE8\u1AE9\u1AEB\u6201\xEE\u1160e\u0100mx\u1AF1\u1AF6ent\xBB\u1AE9e\xF3\u024D\u01E7\u1AFE\0\u1B07\u0100;d\u12BB\u1B02ot;\u6A6Dn\xF4\u0246\u0180fry\u1B10\u1B14\u1B17;\uC000\u{1D554}o\xE4\u0254\u8100\xA9;s\u0155\u1B1Dr;\u6117\u0100ao\u1B25\u1B29rr;\u61B5ss;\u6717\u0100cu\u1B32\u1B37r;\uC000\u{1D4B8}\u0100bp\u1B3C\u1B44\u0100;e\u1B41\u1B42\u6ACF;\u6AD1\u0100;e\u1B49\u1B4A\u6AD0;\u6AD2dot;\u62EF\u0380delprvw\u1B60\u1B6C\u1B77\u1B82\u1BAC\u1BD4\u1BF9arr\u0100lr\u1B68\u1B6A;\u6938;\u6935\u0270\u1B72\0\0\u1B75r;\u62DEc;\u62DFarr\u0100;p\u1B7F\u1B80\u61B6;\u693D\u0300;bcdos\u1B8F\u1B90\u1B96\u1BA1\u1BA5\u1BA8\u622Arcap;\u6A48\u0100au\u1B9B\u1B9Ep;\u6A46p;\u6A4Aot;\u628Dr;\u6A45;\uC000\u222A\uFE00\u0200alrv\u1BB5\u1BBF\u1BDE\u1BE3rr\u0100;m\u1BBC\u1BBD\u61B7;\u693Cy\u0180evw\u1BC7\u1BD4\u1BD8q\u0270\u1BCE\0\0\u1BD2re\xE3\u1B73u\xE3\u1B75ee;\u62CEedge;\u62CFen\u803B\xA4\u40A4earrow\u0100lr\u1BEE\u1BF3eft\xBB\u1B80ight\xBB\u1BBDe\xE4\u1BDD\u0100ci\u1C01\u1C07onin\xF4\u01F7nt;\u6231lcty;\u632D\u0980AHabcdefhijlorstuwz\u1C38\u1C3B\u1C3F\u1C5D\u1C69\u1C75\u1C8A\u1C9E\u1CAC\u1CB7\u1CFB\u1CFF\u1D0D\u1D7B\u1D91\u1DAB\u1DBB\u1DC6\u1DCDr\xF2\u0381ar;\u6965\u0200glrs\u1C48\u1C4D\u1C52\u1C54ger;\u6020eth;\u6138\xF2\u1133h\u0100;v\u1C5A\u1C5B\u6010\xBB\u090A\u016B\u1C61\u1C67arow;\u690Fa\xE3\u0315\u0100ay\u1C6E\u1C73ron;\u410F;\u4434\u0180;ao\u0332\u1C7C\u1C84\u0100gr\u02BF\u1C81r;\u61CAtseq;\u6A77\u0180glm\u1C91\u1C94\u1C98\u803B\xB0\u40B0ta;\u43B4ptyv;\u69B1\u0100ir\u1CA3\u1CA8sht;\u697F;\uC000\u{1D521}ar\u0100lr\u1CB3\u1CB5\xBB\u08DC\xBB\u101E\u0280aegsv\u1CC2\u0378\u1CD6\u1CDC\u1CE0m\u0180;os\u0326\u1CCA\u1CD4nd\u0100;s\u0326\u1CD1uit;\u6666amma;\u43DDin;\u62F2\u0180;io\u1CE7\u1CE8\u1CF8\u40F7de\u8100\xF7;o\u1CE7\u1CF0ntimes;\u62C7n\xF8\u1CF7cy;\u4452c\u026F\u1D06\0\0\u1D0Arn;\u631Eop;\u630D\u0280lptuw\u1D18\u1D1D\u1D22\u1D49\u1D55lar;\u4024f;\uC000\u{1D555}\u0280;emps\u030B\u1D2D\u1D37\u1D3D\u1D42q\u0100;d\u0352\u1D33ot;\u6251inus;\u6238lus;\u6214quare;\u62A1blebarwedg\xE5\xFAn\u0180adh\u112E\u1D5D\u1D67ownarrow\xF3\u1C83arpoon\u0100lr\u1D72\u1D76ef\xF4\u1CB4igh\xF4\u1CB6\u0162\u1D7F\u1D85karo\xF7\u0F42\u026F\u1D8A\0\0\u1D8Ern;\u631Fop;\u630C\u0180cot\u1D98\u1DA3\u1DA6\u0100ry\u1D9D\u1DA1;\uC000\u{1D4B9};\u4455l;\u69F6rok;\u4111\u0100dr\u1DB0\u1DB4ot;\u62F1i\u0100;f\u1DBA\u1816\u65BF\u0100ah\u1DC0\u1DC3r\xF2\u0429a\xF2\u0FA6angle;\u69A6\u0100ci\u1DD2\u1DD5y;\u445Fgrarr;\u67FF\u0900Dacdefglmnopqrstux\u1E01\u1E09\u1E19\u1E38\u0578\u1E3C\u1E49\u1E61\u1E7E\u1EA5\u1EAF\u1EBD\u1EE1\u1F2A\u1F37\u1F44\u1F4E\u1F5A\u0100Do\u1E06\u1D34o\xF4\u1C89\u0100cs\u1E0E\u1E14ute\u803B\xE9\u40E9ter;\u6A6E\u0200aioy\u1E22\u1E27\u1E31\u1E36ron;\u411Br\u0100;c\u1E2D\u1E2E\u6256\u803B\xEA\u40EAlon;\u6255;\u444Dot;\u4117\u0100Dr\u1E41\u1E45ot;\u6252;\uC000\u{1D522}\u0180;rs\u1E50\u1E51\u1E57\u6A9Aave\u803B\xE8\u40E8\u0100;d\u1E5C\u1E5D\u6A96ot;\u6A98\u0200;ils\u1E6A\u1E6B\u1E72\u1E74\u6A99nters;\u63E7;\u6113\u0100;d\u1E79\u1E7A\u6A95ot;\u6A97\u0180aps\u1E85\u1E89\u1E97cr;\u4113ty\u0180;sv\u1E92\u1E93\u1E95\u6205et\xBB\u1E93p\u01001;\u1E9D\u1EA4\u0133\u1EA1\u1EA3;\u6004;\u6005\u6003\u0100gs\u1EAA\u1EAC;\u414Bp;\u6002\u0100gp\u1EB4\u1EB8on;\u4119f;\uC000\u{1D556}\u0180als\u1EC4\u1ECE\u1ED2r\u0100;s\u1ECA\u1ECB\u62D5l;\u69E3us;\u6A71i\u0180;lv\u1EDA\u1EDB\u1EDF\u43B5on\xBB\u1EDB;\u43F5\u0200csuv\u1EEA\u1EF3\u1F0B\u1F23\u0100io\u1EEF\u1E31rc\xBB\u1E2E\u0269\u1EF9\0\0\u1EFB\xED\u0548ant\u0100gl\u1F02\u1F06tr\xBB\u1E5Dess\xBB\u1E7A\u0180aei\u1F12\u1F16\u1F1Als;\u403Dst;\u625Fv\u0100;D\u0235\u1F20D;\u6A78parsl;\u69E5\u0100Da\u1F2F\u1F33ot;\u6253rr;\u6971\u0180cdi\u1F3E\u1F41\u1EF8r;\u612Fo\xF4\u0352\u0100ah\u1F49\u1F4B;\u43B7\u803B\xF0\u40F0\u0100mr\u1F53\u1F57l\u803B\xEB\u40EBo;\u60AC\u0180cip\u1F61\u1F64\u1F67l;\u4021s\xF4\u056E\u0100eo\u1F6C\u1F74ctatio\xEE\u0559nential\xE5\u0579\u09E1\u1F92\0\u1F9E\0\u1FA1\u1FA7\0\0\u1FC6\u1FCC\0\u1FD3\0\u1FE6\u1FEA\u2000\0\u2008\u205Allingdotse\xF1\u1E44y;\u4444male;\u6640\u0180ilr\u1FAD\u1FB3\u1FC1lig;\u8000\uFB03\u0269\u1FB9\0\0\u1FBDg;\u8000\uFB00ig;\u8000\uFB04;\uC000\u{1D523}lig;\u8000\uFB01lig;\uC000fj\u0180alt\u1FD9\u1FDC\u1FE1t;\u666Dig;\u8000\uFB02ns;\u65B1of;\u4192\u01F0\u1FEE\0\u1FF3f;\uC000\u{1D557}\u0100ak\u05BF\u1FF7\u0100;v\u1FFC\u1FFD\u62D4;\u6AD9artint;\u6A0D\u0100ao\u200C\u2055\u0100cs\u2011\u2052\u03B1\u201A\u2030\u2038\u2045\u2048\0\u2050\u03B2\u2022\u2025\u2027\u202A\u202C\0\u202E\u803B\xBD\u40BD;\u6153\u803B\xBC\u40BC;\u6155;\u6159;\u615B\u01B3\u2034\0\u2036;\u6154;\u6156\u02B4\u203E\u2041\0\0\u2043\u803B\xBE\u40BE;\u6157;\u615C5;\u6158\u01B6\u204C\0\u204E;\u615A;\u615D8;\u615El;\u6044wn;\u6322cr;\uC000\u{1D4BB}\u0880Eabcdefgijlnorstv\u2082\u2089\u209F\u20A5\u20B0\u20B4\u20F0\u20F5\u20FA\u20FF\u2103\u2112\u2138\u0317\u213E\u2152\u219E\u0100;l\u064D\u2087;\u6A8C\u0180cmp\u2090\u2095\u209Dute;\u41F5ma\u0100;d\u209C\u1CDA\u43B3;\u6A86reve;\u411F\u0100iy\u20AA\u20AErc;\u411D;\u4433ot;\u4121\u0200;lqs\u063E\u0642\u20BD\u20C9\u0180;qs\u063E\u064C\u20C4lan\xF4\u0665\u0200;cdl\u0665\u20D2\u20D5\u20E5c;\u6AA9ot\u0100;o\u20DC\u20DD\u6A80\u0100;l\u20E2\u20E3\u6A82;\u6A84\u0100;e\u20EA\u20ED\uC000\u22DB\uFE00s;\u6A94r;\uC000\u{1D524}\u0100;g\u0673\u061Bmel;\u6137cy;\u4453\u0200;Eaj\u065A\u210C\u210E\u2110;\u6A92;\u6AA5;\u6AA4\u0200Eaes\u211B\u211D\u2129\u2134;\u6269p\u0100;p\u2123\u2124\u6A8Arox\xBB\u2124\u0100;q\u212E\u212F\u6A88\u0100;q\u212E\u211Bim;\u62E7pf;\uC000\u{1D558}\u0100ci\u2143\u2146r;\u610Am\u0180;el\u066B\u214E\u2150;\u6A8E;\u6A90\u8300>;cdlqr\u05EE\u2160\u216A\u216E\u2173\u2179\u0100ci\u2165\u2167;\u6AA7r;\u6A7Aot;\u62D7Par;\u6995uest;\u6A7C\u0280adels\u2184\u216A\u2190\u0656\u219B\u01F0\u2189\0\u218Epro\xF8\u209Er;\u6978q\u0100lq\u063F\u2196les\xF3\u2088i\xED\u066B\u0100en\u21A3\u21ADrtneqq;\uC000\u2269\uFE00\xC5\u21AA\u0500Aabcefkosy\u21C4\u21C7\u21F1\u21F5\u21FA\u2218\u221D\u222F\u2268\u227Dr\xF2\u03A0\u0200ilmr\u21D0\u21D4\u21D7\u21DBrs\xF0\u1484f\xBB\u2024il\xF4\u06A9\u0100dr\u21E0\u21E4cy;\u444A\u0180;cw\u08F4\u21EB\u21EFir;\u6948;\u61ADar;\u610Firc;\u4125\u0180alr\u2201\u220E\u2213rts\u0100;u\u2209\u220A\u6665it\xBB\u220Alip;\u6026con;\u62B9r;\uC000\u{1D525}s\u0100ew\u2223\u2229arow;\u6925arow;\u6926\u0280amopr\u223A\u223E\u2243\u225E\u2263rr;\u61FFtht;\u623Bk\u0100lr\u2249\u2253eftarrow;\u61A9ightarrow;\u61AAf;\uC000\u{1D559}bar;\u6015\u0180clt\u226F\u2274\u2278r;\uC000\u{1D4BD}as\xE8\u21F4rok;\u4127\u0100bp\u2282\u2287ull;\u6043hen\xBB\u1C5B\u0AE1\u22A3\0\u22AA\0\u22B8\u22C5\u22CE\0\u22D5\u22F3\0\0\u22F8\u2322\u2367\u2362\u237F\0\u2386\u23AA\u23B4cute\u803B\xED\u40ED\u0180;iy\u0771\u22B0\u22B5rc\u803B\xEE\u40EE;\u4438\u0100cx\u22BC\u22BFy;\u4435cl\u803B\xA1\u40A1\u0100fr\u039F\u22C9;\uC000\u{1D526}rave\u803B\xEC\u40EC\u0200;ino\u073E\u22DD\u22E9\u22EE\u0100in\u22E2\u22E6nt;\u6A0Ct;\u622Dfin;\u69DCta;\u6129lig;\u4133\u0180aop\u22FE\u231A\u231D\u0180cgt\u2305\u2308\u2317r;\u412B\u0180elp\u071F\u230F\u2313in\xE5\u078Ear\xF4\u0720h;\u4131f;\u62B7ed;\u41B5\u0280;cfot\u04F4\u232C\u2331\u233D\u2341are;\u6105in\u0100;t\u2338\u2339\u621Eie;\u69DDdo\xF4\u2319\u0280;celp\u0757\u234C\u2350\u235B\u2361al;\u62BA\u0100gr\u2355\u2359er\xF3\u1563\xE3\u234Darhk;\u6A17rod;\u6A3C\u0200cgpt\u236F\u2372\u2376\u237By;\u4451on;\u412Ff;\uC000\u{1D55A}a;\u43B9uest\u803B\xBF\u40BF\u0100ci\u238A\u238Fr;\uC000\u{1D4BE}n\u0280;Edsv\u04F4\u239B\u239D\u23A1\u04F3;\u62F9ot;\u62F5\u0100;v\u23A6\u23A7\u62F4;\u62F3\u0100;i\u0777\u23AElde;\u4129\u01EB\u23B8\0\u23BCcy;\u4456l\u803B\xEF\u40EF\u0300cfmosu\u23CC\u23D7\u23DC\u23E1\u23E7\u23F5\u0100iy\u23D1\u23D5rc;\u4135;\u4439r;\uC000\u{1D527}ath;\u4237pf;\uC000\u{1D55B}\u01E3\u23EC\0\u23F1r;\uC000\u{1D4BF}rcy;\u4458kcy;\u4454\u0400acfghjos\u240B\u2416\u2422\u2427\u242D\u2431\u2435\u243Bppa\u0100;v\u2413\u2414\u43BA;\u43F0\u0100ey\u241B\u2420dil;\u4137;\u443Ar;\uC000\u{1D528}reen;\u4138cy;\u4445cy;\u445Cpf;\uC000\u{1D55C}cr;\uC000\u{1D4C0}\u0B80ABEHabcdefghjlmnoprstuv\u2470\u2481\u2486\u248D\u2491\u250E\u253D\u255A\u2580\u264E\u265E\u2665\u2679\u267D\u269A\u26B2\u26D8\u275D\u2768\u278B\u27C0\u2801\u2812\u0180art\u2477\u247A\u247Cr\xF2\u09C6\xF2\u0395ail;\u691Barr;\u690E\u0100;g\u0994\u248B;\u6A8Bar;\u6962\u0963\u24A5\0\u24AA\0\u24B1\0\0\0\0\0\u24B5\u24BA\0\u24C6\u24C8\u24CD\0\u24F9ute;\u413Amptyv;\u69B4ra\xEE\u084Cbda;\u43BBg\u0180;dl\u088E\u24C1\u24C3;\u6991\xE5\u088E;\u6A85uo\u803B\xAB\u40ABr\u0400;bfhlpst\u0899\u24DE\u24E6\u24E9\u24EB\u24EE\u24F1\u24F5\u0100;f\u089D\u24E3s;\u691Fs;\u691D\xEB\u2252p;\u61ABl;\u6939im;\u6973l;\u61A2\u0180;ae\u24FF\u2500\u2504\u6AABil;\u6919\u0100;s\u2509\u250A\u6AAD;\uC000\u2AAD\uFE00\u0180abr\u2515\u2519\u251Drr;\u690Crk;\u6772\u0100ak\u2522\u252Cc\u0100ek\u2528\u252A;\u407B;\u405B\u0100es\u2531\u2533;\u698Bl\u0100du\u2539\u253B;\u698F;\u698D\u0200aeuy\u2546\u254B\u2556\u2558ron;\u413E\u0100di\u2550\u2554il;\u413C\xEC\u08B0\xE2\u2529;\u443B\u0200cqrs\u2563\u2566\u256D\u257Da;\u6936uo\u0100;r\u0E19\u1746\u0100du\u2572\u2577har;\u6967shar;\u694Bh;\u61B2\u0280;fgqs\u258B\u258C\u0989\u25F3\u25FF\u6264t\u0280ahlrt\u2598\u25A4\u25B7\u25C2\u25E8rrow\u0100;t\u0899\u25A1a\xE9\u24F6arpoon\u0100du\u25AF\u25B4own\xBB\u045Ap\xBB\u0966eftarrows;\u61C7ight\u0180ahs\u25CD\u25D6\u25DErrow\u0100;s\u08F4\u08A7arpoon\xF3\u0F98quigarro\xF7\u21F0hreetimes;\u62CB\u0180;qs\u258B\u0993\u25FAlan\xF4\u09AC\u0280;cdgs\u09AC\u260A\u260D\u261D\u2628c;\u6AA8ot\u0100;o\u2614\u2615\u6A7F\u0100;r\u261A\u261B\u6A81;\u6A83\u0100;e\u2622\u2625\uC000\u22DA\uFE00s;\u6A93\u0280adegs\u2633\u2639\u263D\u2649\u264Bppro\xF8\u24C6ot;\u62D6q\u0100gq\u2643\u2645\xF4\u0989gt\xF2\u248C\xF4\u099Bi\xED\u09B2\u0180ilr\u2655\u08E1\u265Asht;\u697C;\uC000\u{1D529}\u0100;E\u099C\u2663;\u6A91\u0161\u2669\u2676r\u0100du\u25B2\u266E\u0100;l\u0965\u2673;\u696Alk;\u6584cy;\u4459\u0280;acht\u0A48\u2688\u268B\u2691\u2696r\xF2\u25C1orne\xF2\u1D08ard;\u696Bri;\u65FA\u0100io\u269F\u26A4dot;\u4140ust\u0100;a\u26AC\u26AD\u63B0che\xBB\u26AD\u0200Eaes\u26BB\u26BD\u26C9\u26D4;\u6268p\u0100;p\u26C3\u26C4\u6A89rox\xBB\u26C4\u0100;q\u26CE\u26CF\u6A87\u0100;q\u26CE\u26BBim;\u62E6\u0400abnoptwz\u26E9\u26F4\u26F7\u271A\u272F\u2741\u2747\u2750\u0100nr\u26EE\u26F1g;\u67ECr;\u61FDr\xEB\u08C1g\u0180lmr\u26FF\u270D\u2714eft\u0100ar\u09E6\u2707ight\xE1\u09F2apsto;\u67FCight\xE1\u09FDparrow\u0100lr\u2725\u2729ef\xF4\u24EDight;\u61AC\u0180afl\u2736\u2739\u273Dr;\u6985;\uC000\u{1D55D}us;\u6A2Dimes;\u6A34\u0161\u274B\u274Fst;\u6217\xE1\u134E\u0180;ef\u2757\u2758\u1800\u65CAnge\xBB\u2758ar\u0100;l\u2764\u2765\u4028t;\u6993\u0280achmt\u2773\u2776\u277C\u2785\u2787r\xF2\u08A8orne\xF2\u1D8Car\u0100;d\u0F98\u2783;\u696D;\u600Eri;\u62BF\u0300achiqt\u2798\u279D\u0A40\u27A2\u27AE\u27BBquo;\u6039r;\uC000\u{1D4C1}m\u0180;eg\u09B2\u27AA\u27AC;\u6A8D;\u6A8F\u0100bu\u252A\u27B3o\u0100;r\u0E1F\u27B9;\u601Arok;\u4142\u8400<;cdhilqr\u082B\u27D2\u2639\u27DC\u27E0\u27E5\u27EA\u27F0\u0100ci\u27D7\u27D9;\u6AA6r;\u6A79re\xE5\u25F2mes;\u62C9arr;\u6976uest;\u6A7B\u0100Pi\u27F5\u27F9ar;\u6996\u0180;ef\u2800\u092D\u181B\u65C3r\u0100du\u2807\u280Dshar;\u694Ahar;\u6966\u0100en\u2817\u2821rtneqq;\uC000\u2268\uFE00\xC5\u281E\u0700Dacdefhilnopsu\u2840\u2845\u2882\u288E\u2893\u28A0\u28A5\u28A8\u28DA\u28E2\u28E4\u0A83\u28F3\u2902Dot;\u623A\u0200clpr\u284E\u2852\u2863\u287Dr\u803B\xAF\u40AF\u0100et\u2857\u2859;\u6642\u0100;e\u285E\u285F\u6720se\xBB\u285F\u0100;s\u103B\u2868to\u0200;dlu\u103B\u2873\u2877\u287Bow\xEE\u048Cef\xF4\u090F\xF0\u13D1ker;\u65AE\u0100oy\u2887\u288Cmma;\u6A29;\u443Cash;\u6014asuredangle\xBB\u1626r;\uC000\u{1D52A}o;\u6127\u0180cdn\u28AF\u28B4\u28C9ro\u803B\xB5\u40B5\u0200;acd\u1464\u28BD\u28C0\u28C4s\xF4\u16A7ir;\u6AF0ot\u80BB\xB7\u01B5us\u0180;bd\u28D2\u1903\u28D3\u6212\u0100;u\u1D3C\u28D8;\u6A2A\u0163\u28DE\u28E1p;\u6ADB\xF2\u2212\xF0\u0A81\u0100dp\u28E9\u28EEels;\u62A7f;\uC000\u{1D55E}\u0100ct\u28F8\u28FDr;\uC000\u{1D4C2}pos\xBB\u159D\u0180;lm\u2909\u290A\u290D\u43BCtimap;\u62B8\u0C00GLRVabcdefghijlmoprstuvw\u2942\u2953\u297E\u2989\u2998\u29DA\u29E9\u2A15\u2A1A\u2A58\u2A5D\u2A83\u2A95\u2AA4\u2AA8\u2B04\u2B07\u2B44\u2B7F\u2BAE\u2C34\u2C67\u2C7C\u2CE9\u0100gt\u2947\u294B;\uC000\u22D9\u0338\u0100;v\u2950\u0BCF\uC000\u226B\u20D2\u0180elt\u295A\u2972\u2976ft\u0100ar\u2961\u2967rrow;\u61CDightarrow;\u61CE;\uC000\u22D8\u0338\u0100;v\u297B\u0C47\uC000\u226A\u20D2ightarrow;\u61CF\u0100Dd\u298E\u2993ash;\u62AFash;\u62AE\u0280bcnpt\u29A3\u29A7\u29AC\u29B1\u29CCla\xBB\u02DEute;\u4144g;\uC000\u2220\u20D2\u0280;Eiop\u0D84\u29BC\u29C0\u29C5\u29C8;\uC000\u2A70\u0338d;\uC000\u224B\u0338s;\u4149ro\xF8\u0D84ur\u0100;a\u29D3\u29D4\u666El\u0100;s\u29D3\u0B38\u01F3\u29DF\0\u29E3p\u80BB\xA0\u0B37mp\u0100;e\u0BF9\u0C00\u0280aeouy\u29F4\u29FE\u2A03\u2A10\u2A13\u01F0\u29F9\0\u29FB;\u6A43on;\u4148dil;\u4146ng\u0100;d\u0D7E\u2A0Aot;\uC000\u2A6D\u0338p;\u6A42;\u443Dash;\u6013\u0380;Aadqsx\u0B92\u2A29\u2A2D\u2A3B\u2A41\u2A45\u2A50rr;\u61D7r\u0100hr\u2A33\u2A36k;\u6924\u0100;o\u13F2\u13F0ot;\uC000\u2250\u0338ui\xF6\u0B63\u0100ei\u2A4A\u2A4Ear;\u6928\xED\u0B98ist\u0100;s\u0BA0\u0B9Fr;\uC000\u{1D52B}\u0200Eest\u0BC5\u2A66\u2A79\u2A7C\u0180;qs\u0BBC\u2A6D\u0BE1\u0180;qs\u0BBC\u0BC5\u2A74lan\xF4\u0BE2i\xED\u0BEA\u0100;r\u0BB6\u2A81\xBB\u0BB7\u0180Aap\u2A8A\u2A8D\u2A91r\xF2\u2971rr;\u61AEar;\u6AF2\u0180;sv\u0F8D\u2A9C\u0F8C\u0100;d\u2AA1\u2AA2\u62FC;\u62FAcy;\u445A\u0380AEadest\u2AB7\u2ABA\u2ABE\u2AC2\u2AC5\u2AF6\u2AF9r\xF2\u2966;\uC000\u2266\u0338rr;\u619Ar;\u6025\u0200;fqs\u0C3B\u2ACE\u2AE3\u2AEFt\u0100ar\u2AD4\u2AD9rro\xF7\u2AC1ightarro\xF7\u2A90\u0180;qs\u0C3B\u2ABA\u2AEAlan\xF4\u0C55\u0100;s\u0C55\u2AF4\xBB\u0C36i\xED\u0C5D\u0100;r\u0C35\u2AFEi\u0100;e\u0C1A\u0C25i\xE4\u0D90\u0100pt\u2B0C\u2B11f;\uC000\u{1D55F}\u8180\xAC;in\u2B19\u2B1A\u2B36\u40ACn\u0200;Edv\u0B89\u2B24\u2B28\u2B2E;\uC000\u22F9\u0338ot;\uC000\u22F5\u0338\u01E1\u0B89\u2B33\u2B35;\u62F7;\u62F6i\u0100;v\u0CB8\u2B3C\u01E1\u0CB8\u2B41\u2B43;\u62FE;\u62FD\u0180aor\u2B4B\u2B63\u2B69r\u0200;ast\u0B7B\u2B55\u2B5A\u2B5Flle\xEC\u0B7Bl;\uC000\u2AFD\u20E5;\uC000\u2202\u0338lint;\u6A14\u0180;ce\u0C92\u2B70\u2B73u\xE5\u0CA5\u0100;c\u0C98\u2B78\u0100;e\u0C92\u2B7D\xF1\u0C98\u0200Aait\u2B88\u2B8B\u2B9D\u2BA7r\xF2\u2988rr\u0180;cw\u2B94\u2B95\u2B99\u619B;\uC000\u2933\u0338;\uC000\u219D\u0338ghtarrow\xBB\u2B95ri\u0100;e\u0CCB\u0CD6\u0380chimpqu\u2BBD\u2BCD\u2BD9\u2B04\u0B78\u2BE4\u2BEF\u0200;cer\u0D32\u2BC6\u0D37\u2BC9u\xE5\u0D45;\uC000\u{1D4C3}ort\u026D\u2B05\0\0\u2BD6ar\xE1\u2B56m\u0100;e\u0D6E\u2BDF\u0100;q\u0D74\u0D73su\u0100bp\u2BEB\u2BED\xE5\u0CF8\xE5\u0D0B\u0180bcp\u2BF6\u2C11\u2C19\u0200;Ees\u2BFF\u2C00\u0D22\u2C04\u6284;\uC000\u2AC5\u0338et\u0100;e\u0D1B\u2C0Bq\u0100;q\u0D23\u2C00c\u0100;e\u0D32\u2C17\xF1\u0D38\u0200;Ees\u2C22\u2C23\u0D5F\u2C27\u6285;\uC000\u2AC6\u0338et\u0100;e\u0D58\u2C2Eq\u0100;q\u0D60\u2C23\u0200gilr\u2C3D\u2C3F\u2C45\u2C47\xEC\u0BD7lde\u803B\xF1\u40F1\xE7\u0C43iangle\u0100lr\u2C52\u2C5Ceft\u0100;e\u0C1A\u2C5A\xF1\u0C26ight\u0100;e\u0CCB\u2C65\xF1\u0CD7\u0100;m\u2C6C\u2C6D\u43BD\u0180;es\u2C74\u2C75\u2C79\u4023ro;\u6116p;\u6007\u0480DHadgilrs\u2C8F\u2C94\u2C99\u2C9E\u2CA3\u2CB0\u2CB6\u2CD3\u2CE3ash;\u62ADarr;\u6904p;\uC000\u224D\u20D2ash;\u62AC\u0100et\u2CA8\u2CAC;\uC000\u2265\u20D2;\uC000>\u20D2nfin;\u69DE\u0180Aet\u2CBD\u2CC1\u2CC5rr;\u6902;\uC000\u2264\u20D2\u0100;r\u2CCA\u2CCD\uC000<\u20D2ie;\uC000\u22B4\u20D2\u0100At\u2CD8\u2CDCrr;\u6903rie;\uC000\u22B5\u20D2im;\uC000\u223C\u20D2\u0180Aan\u2CF0\u2CF4\u2D02rr;\u61D6r\u0100hr\u2CFA\u2CFDk;\u6923\u0100;o\u13E7\u13E5ear;\u6927\u1253\u1A95\0\0\0\0\0\0\0\0\0\0\0\0\0\u2D2D\0\u2D38\u2D48\u2D60\u2D65\u2D72\u2D84\u1B07\0\0\u2D8D\u2DAB\0\u2DC8\u2DCE\0\u2DDC\u2E19\u2E2B\u2E3E\u2E43\u0100cs\u2D31\u1A97ute\u803B\xF3\u40F3\u0100iy\u2D3C\u2D45r\u0100;c\u1A9E\u2D42\u803B\xF4\u40F4;\u443E\u0280abios\u1AA0\u2D52\u2D57\u01C8\u2D5Alac;\u4151v;\u6A38old;\u69BClig;\u4153\u0100cr\u2D69\u2D6Dir;\u69BF;\uC000\u{1D52C}\u036F\u2D79\0\0\u2D7C\0\u2D82n;\u42DBave\u803B\xF2\u40F2;\u69C1\u0100bm\u2D88\u0DF4ar;\u69B5\u0200acit\u2D95\u2D98\u2DA5\u2DA8r\xF2\u1A80\u0100ir\u2D9D\u2DA0r;\u69BEoss;\u69BBn\xE5\u0E52;\u69C0\u0180aei\u2DB1\u2DB5\u2DB9cr;\u414Dga;\u43C9\u0180cdn\u2DC0\u2DC5\u01CDron;\u43BF;\u69B6pf;\uC000\u{1D560}\u0180ael\u2DD4\u2DD7\u01D2r;\u69B7rp;\u69B9\u0380;adiosv\u2DEA\u2DEB\u2DEE\u2E08\u2E0D\u2E10\u2E16\u6228r\xF2\u1A86\u0200;efm\u2DF7\u2DF8\u2E02\u2E05\u6A5Dr\u0100;o\u2DFE\u2DFF\u6134f\xBB\u2DFF\u803B\xAA\u40AA\u803B\xBA\u40BAgof;\u62B6r;\u6A56lope;\u6A57;\u6A5B\u0180clo\u2E1F\u2E21\u2E27\xF2\u2E01ash\u803B\xF8\u40F8l;\u6298i\u016C\u2E2F\u2E34de\u803B\xF5\u40F5es\u0100;a\u01DB\u2E3As;\u6A36ml\u803B\xF6\u40F6bar;\u633D\u0AE1\u2E5E\0\u2E7D\0\u2E80\u2E9D\0\u2EA2\u2EB9\0\0\u2ECB\u0E9C\0\u2F13\0\0\u2F2B\u2FBC\0\u2FC8r\u0200;ast\u0403\u2E67\u2E72\u0E85\u8100\xB6;l\u2E6D\u2E6E\u40B6le\xEC\u0403\u0269\u2E78\0\0\u2E7Bm;\u6AF3;\u6AFDy;\u443Fr\u0280cimpt\u2E8B\u2E8F\u2E93\u1865\u2E97nt;\u4025od;\u402Eil;\u6030enk;\u6031r;\uC000\u{1D52D}\u0180imo\u2EA8\u2EB0\u2EB4\u0100;v\u2EAD\u2EAE\u43C6;\u43D5ma\xF4\u0A76ne;\u660E\u0180;tv\u2EBF\u2EC0\u2EC8\u43C0chfork\xBB\u1FFD;\u43D6\u0100au\u2ECF\u2EDFn\u0100ck\u2ED5\u2EDDk\u0100;h\u21F4\u2EDB;\u610E\xF6\u21F4s\u0480;abcdemst\u2EF3\u2EF4\u1908\u2EF9\u2EFD\u2F04\u2F06\u2F0A\u2F0E\u402Bcir;\u6A23ir;\u6A22\u0100ou\u1D40\u2F02;\u6A25;\u6A72n\u80BB\xB1\u0E9Dim;\u6A26wo;\u6A27\u0180ipu\u2F19\u2F20\u2F25ntint;\u6A15f;\uC000\u{1D561}nd\u803B\xA3\u40A3\u0500;Eaceinosu\u0EC8\u2F3F\u2F41\u2F44\u2F47\u2F81\u2F89\u2F92\u2F7E\u2FB6;\u6AB3p;\u6AB7u\xE5\u0ED9\u0100;c\u0ECE\u2F4C\u0300;acens\u0EC8\u2F59\u2F5F\u2F66\u2F68\u2F7Eppro\xF8\u2F43urlye\xF1\u0ED9\xF1\u0ECE\u0180aes\u2F6F\u2F76\u2F7Approx;\u6AB9qq;\u6AB5im;\u62E8i\xED\u0EDFme\u0100;s\u2F88\u0EAE\u6032\u0180Eas\u2F78\u2F90\u2F7A\xF0\u2F75\u0180dfp\u0EEC\u2F99\u2FAF\u0180als\u2FA0\u2FA5\u2FAAlar;\u632Eine;\u6312urf;\u6313\u0100;t\u0EFB\u2FB4\xEF\u0EFBrel;\u62B0\u0100ci\u2FC0\u2FC5r;\uC000\u{1D4C5};\u43C8ncsp;\u6008\u0300fiopsu\u2FDA\u22E2\u2FDF\u2FE5\u2FEB\u2FF1r;\uC000\u{1D52E}pf;\uC000\u{1D562}rime;\u6057cr;\uC000\u{1D4C6}\u0180aeo\u2FF8\u3009\u3013t\u0100ei\u2FFE\u3005rnion\xF3\u06B0nt;\u6A16st\u0100;e\u3010\u3011\u403F\xF1\u1F19\xF4\u0F14\u0A80ABHabcdefhilmnoprstux\u3040\u3051\u3055\u3059\u30E0\u310E\u312B\u3147\u3162\u3172\u318E\u3206\u3215\u3224\u3229\u3258\u326E\u3272\u3290\u32B0\u32B7\u0180art\u3047\u304A\u304Cr\xF2\u10B3\xF2\u03DDail;\u691Car\xF2\u1C65ar;\u6964\u0380cdenqrt\u3068\u3075\u3078\u307F\u308F\u3094\u30CC\u0100eu\u306D\u3071;\uC000\u223D\u0331te;\u4155i\xE3\u116Emptyv;\u69B3g\u0200;del\u0FD1\u3089\u308B\u308D;\u6992;\u69A5\xE5\u0FD1uo\u803B\xBB\u40BBr\u0580;abcfhlpstw\u0FDC\u30AC\u30AF\u30B7\u30B9\u30BC\u30BE\u30C0\u30C3\u30C7\u30CAp;\u6975\u0100;f\u0FE0\u30B4s;\u6920;\u6933s;\u691E\xEB\u225D\xF0\u272El;\u6945im;\u6974l;\u61A3;\u619D\u0100ai\u30D1\u30D5il;\u691Ao\u0100;n\u30DB\u30DC\u6236al\xF3\u0F1E\u0180abr\u30E7\u30EA\u30EEr\xF2\u17E5rk;\u6773\u0100ak\u30F3\u30FDc\u0100ek\u30F9\u30FB;\u407D;\u405D\u0100es\u3102\u3104;\u698Cl\u0100du\u310A\u310C;\u698E;\u6990\u0200aeuy\u3117\u311C\u3127\u3129ron;\u4159\u0100di\u3121\u3125il;\u4157\xEC\u0FF2\xE2\u30FA;\u4440\u0200clqs\u3134\u3137\u313D\u3144a;\u6937dhar;\u6969uo\u0100;r\u020E\u020Dh;\u61B3\u0180acg\u314E\u315F\u0F44l\u0200;ips\u0F78\u3158\u315B\u109Cn\xE5\u10BBar\xF4\u0FA9t;\u65AD\u0180ilr\u3169\u1023\u316Esht;\u697D;\uC000\u{1D52F}\u0100ao\u3177\u3186r\u0100du\u317D\u317F\xBB\u047B\u0100;l\u1091\u3184;\u696C\u0100;v\u318B\u318C\u43C1;\u43F1\u0180gns\u3195\u31F9\u31FCht\u0300ahlrst\u31A4\u31B0\u31C2\u31D8\u31E4\u31EErrow\u0100;t\u0FDC\u31ADa\xE9\u30C8arpoon\u0100du\u31BB\u31BFow\xEE\u317Ep\xBB\u1092eft\u0100ah\u31CA\u31D0rrow\xF3\u0FEAarpoon\xF3\u0551ightarrows;\u61C9quigarro\xF7\u30CBhreetimes;\u62CCg;\u42DAingdotse\xF1\u1F32\u0180ahm\u320D\u3210\u3213r\xF2\u0FEAa\xF2\u0551;\u600Foust\u0100;a\u321E\u321F\u63B1che\xBB\u321Fmid;\u6AEE\u0200abpt\u3232\u323D\u3240\u3252\u0100nr\u3237\u323Ag;\u67EDr;\u61FEr\xEB\u1003\u0180afl\u3247\u324A\u324Er;\u6986;\uC000\u{1D563}us;\u6A2Eimes;\u6A35\u0100ap\u325D\u3267r\u0100;g\u3263\u3264\u4029t;\u6994olint;\u6A12ar\xF2\u31E3\u0200achq\u327B\u3280\u10BC\u3285quo;\u603Ar;\uC000\u{1D4C7}\u0100bu\u30FB\u328Ao\u0100;r\u0214\u0213\u0180hir\u3297\u329B\u32A0re\xE5\u31F8mes;\u62CAi\u0200;efl\u32AA\u1059\u1821\u32AB\u65B9tri;\u69CEluhar;\u6968;\u611E\u0D61\u32D5\u32DB\u32DF\u332C\u3338\u3371\0\u337A\u33A4\0\0\u33EC\u33F0\0\u3428\u3448\u345A\u34AD\u34B1\u34CA\u34F1\0\u3616\0\0\u3633cute;\u415Bqu\xEF\u27BA\u0500;Eaceinpsy\u11ED\u32F3\u32F5\u32FF\u3302\u330B\u330F\u331F\u3326\u3329;\u6AB4\u01F0\u32FA\0\u32FC;\u6AB8on;\u4161u\xE5\u11FE\u0100;d\u11F3\u3307il;\u415Frc;\u415D\u0180Eas\u3316\u3318\u331B;\u6AB6p;\u6ABAim;\u62E9olint;\u6A13i\xED\u1204;\u4441ot\u0180;be\u3334\u1D47\u3335\u62C5;\u6A66\u0380Aacmstx\u3346\u334A\u3357\u335B\u335E\u3363\u336Drr;\u61D8r\u0100hr\u3350\u3352\xEB\u2228\u0100;o\u0A36\u0A34t\u803B\xA7\u40A7i;\u403Bwar;\u6929m\u0100in\u3369\xF0nu\xF3\xF1t;\u6736r\u0100;o\u3376\u2055\uC000\u{1D530}\u0200acoy\u3382\u3386\u3391\u33A0rp;\u666F\u0100hy\u338B\u338Fcy;\u4449;\u4448rt\u026D\u3399\0\0\u339Ci\xE4\u1464ara\xEC\u2E6F\u803B\xAD\u40AD\u0100gm\u33A8\u33B4ma\u0180;fv\u33B1\u33B2\u33B2\u43C3;\u43C2\u0400;deglnpr\u12AB\u33C5\u33C9\u33CE\u33D6\u33DE\u33E1\u33E6ot;\u6A6A\u0100;q\u12B1\u12B0\u0100;E\u33D3\u33D4\u6A9E;\u6AA0\u0100;E\u33DB\u33DC\u6A9D;\u6A9Fe;\u6246lus;\u6A24arr;\u6972ar\xF2\u113D\u0200aeit\u33F8\u3408\u340F\u3417\u0100ls\u33FD\u3404lsetm\xE9\u336Ahp;\u6A33parsl;\u69E4\u0100dl\u1463\u3414e;\u6323\u0100;e\u341C\u341D\u6AAA\u0100;s\u3422\u3423\u6AAC;\uC000\u2AAC\uFE00\u0180flp\u342E\u3433\u3442tcy;\u444C\u0100;b\u3438\u3439\u402F\u0100;a\u343E\u343F\u69C4r;\u633Ff;\uC000\u{1D564}a\u0100dr\u344D\u0402es\u0100;u\u3454\u3455\u6660it\xBB\u3455\u0180csu\u3460\u3479\u349F\u0100au\u3465\u346Fp\u0100;s\u1188\u346B;\uC000\u2293\uFE00p\u0100;s\u11B4\u3475;\uC000\u2294\uFE00u\u0100bp\u347F\u348F\u0180;es\u1197\u119C\u3486et\u0100;e\u1197\u348D\xF1\u119D\u0180;es\u11A8\u11AD\u3496et\u0100;e\u11A8\u349D\xF1\u11AE\u0180;af\u117B\u34A6\u05B0r\u0165\u34AB\u05B1\xBB\u117Car\xF2\u1148\u0200cemt\u34B9\u34BE\u34C2\u34C5r;\uC000\u{1D4C8}tm\xEE\xF1i\xEC\u3415ar\xE6\u11BE\u0100ar\u34CE\u34D5r\u0100;f\u34D4\u17BF\u6606\u0100an\u34DA\u34EDight\u0100ep\u34E3\u34EApsilo\xEE\u1EE0h\xE9\u2EAFs\xBB\u2852\u0280bcmnp\u34FB\u355E\u1209\u358B\u358E\u0480;Edemnprs\u350E\u350F\u3511\u3515\u351E\u3523\u352C\u3531\u3536\u6282;\u6AC5ot;\u6ABD\u0100;d\u11DA\u351Aot;\u6AC3ult;\u6AC1\u0100Ee\u3528\u352A;\u6ACB;\u628Alus;\u6ABFarr;\u6979\u0180eiu\u353D\u3552\u3555t\u0180;en\u350E\u3545\u354Bq\u0100;q\u11DA\u350Feq\u0100;q\u352B\u3528m;\u6AC7\u0100bp\u355A\u355C;\u6AD5;\u6AD3c\u0300;acens\u11ED\u356C\u3572\u3579\u357B\u3326ppro\xF8\u32FAurlye\xF1\u11FE\xF1\u11F3\u0180aes\u3582\u3588\u331Bppro\xF8\u331Aq\xF1\u3317g;\u666A\u0680123;Edehlmnps\u35A9\u35AC\u35AF\u121C\u35B2\u35B4\u35C0\u35C9\u35D5\u35DA\u35DF\u35E8\u35ED\u803B\xB9\u40B9\u803B\xB2\u40B2\u803B\xB3\u40B3;\u6AC6\u0100os\u35B9\u35BCt;\u6ABEub;\u6AD8\u0100;d\u1222\u35C5ot;\u6AC4s\u0100ou\u35CF\u35D2l;\u67C9b;\u6AD7arr;\u697Bult;\u6AC2\u0100Ee\u35E4\u35E6;\u6ACC;\u628Blus;\u6AC0\u0180eiu\u35F4\u3609\u360Ct\u0180;en\u121C\u35FC\u3602q\u0100;q\u1222\u35B2eq\u0100;q\u35E7\u35E4m;\u6AC8\u0100bp\u3611\u3613;\u6AD4;\u6AD6\u0180Aan\u361C\u3620\u362Drr;\u61D9r\u0100hr\u3626\u3628\xEB\u222E\u0100;o\u0A2B\u0A29war;\u692Alig\u803B\xDF\u40DF\u0BE1\u3651\u365D\u3660\u12CE\u3673\u3679\0\u367E\u36C2\0\0\0\0\0\u36DB\u3703\0\u3709\u376C\0\0\0\u3787\u0272\u3656\0\0\u365Bget;\u6316;\u43C4r\xEB\u0E5F\u0180aey\u3666\u366B\u3670ron;\u4165dil;\u4163;\u4442lrec;\u6315r;\uC000\u{1D531}\u0200eiko\u3686\u369D\u36B5\u36BC\u01F2\u368B\0\u3691e\u01004f\u1284\u1281a\u0180;sv\u3698\u3699\u369B\u43B8ym;\u43D1\u0100cn\u36A2\u36B2k\u0100as\u36A8\u36AEppro\xF8\u12C1im\xBB\u12ACs\xF0\u129E\u0100as\u36BA\u36AE\xF0\u12C1rn\u803B\xFE\u40FE\u01EC\u031F\u36C6\u22E7es\u8180\xD7;bd\u36CF\u36D0\u36D8\u40D7\u0100;a\u190F\u36D5r;\u6A31;\u6A30\u0180eps\u36E1\u36E3\u3700\xE1\u2A4D\u0200;bcf\u0486\u36EC\u36F0\u36F4ot;\u6336ir;\u6AF1\u0100;o\u36F9\u36FC\uC000\u{1D565}rk;\u6ADA\xE1\u3362rime;\u6034\u0180aip\u370F\u3712\u3764d\xE5\u1248\u0380adempst\u3721\u374D\u3740\u3751\u3757\u375C\u375Fngle\u0280;dlqr\u3730\u3731\u3736\u3740\u3742\u65B5own\xBB\u1DBBeft\u0100;e\u2800\u373E\xF1\u092E;\u625Cight\u0100;e\u32AA\u374B\xF1\u105Aot;\u65ECinus;\u6A3Alus;\u6A39b;\u69CDime;\u6A3Bezium;\u63E2\u0180cht\u3772\u377D\u3781\u0100ry\u3777\u377B;\uC000\u{1D4C9};\u4446cy;\u445Brok;\u4167\u0100io\u378B\u378Ex\xF4\u1777head\u0100lr\u3797\u37A0eftarro\xF7\u084Fightarrow\xBB\u0F5D\u0900AHabcdfghlmoprstuw\u37D0\u37D3\u37D7\u37E4\u37F0\u37FC\u380E\u381C\u3823\u3834\u3851\u385D\u386B\u38A9\u38CC\u38D2\u38EA\u38F6r\xF2\u03EDar;\u6963\u0100cr\u37DC\u37E2ute\u803B\xFA\u40FA\xF2\u1150r\u01E3\u37EA\0\u37EDy;\u445Eve;\u416D\u0100iy\u37F5\u37FArc\u803B\xFB\u40FB;\u4443\u0180abh\u3803\u3806\u380Br\xF2\u13ADlac;\u4171a\xF2\u13C3\u0100ir\u3813\u3818sht;\u697E;\uC000\u{1D532}rave\u803B\xF9\u40F9\u0161\u3827\u3831r\u0100lr\u382C\u382E\xBB\u0957\xBB\u1083lk;\u6580\u0100ct\u3839\u384D\u026F\u383F\0\0\u384Arn\u0100;e\u3845\u3846\u631Cr\xBB\u3846op;\u630Fri;\u65F8\u0100al\u3856\u385Acr;\u416B\u80BB\xA8\u0349\u0100gp\u3862\u3866on;\u4173f;\uC000\u{1D566}\u0300adhlsu\u114B\u3878\u387D\u1372\u3891\u38A0own\xE1\u13B3arpoon\u0100lr\u3888\u388Cef\xF4\u382Digh\xF4\u382Fi\u0180;hl\u3899\u389A\u389C\u43C5\xBB\u13FAon\xBB\u389Aparrows;\u61C8\u0180cit\u38B0\u38C4\u38C8\u026F\u38B6\0\0\u38C1rn\u0100;e\u38BC\u38BD\u631Dr\xBB\u38BDop;\u630Eng;\u416Fri;\u65F9cr;\uC000\u{1D4CA}\u0180dir\u38D9\u38DD\u38E2ot;\u62F0lde;\u4169i\u0100;f\u3730\u38E8\xBB\u1813\u0100am\u38EF\u38F2r\xF2\u38A8l\u803B\xFC\u40FCangle;\u69A7\u0780ABDacdeflnoprsz\u391C\u391F\u3929\u392D\u39B5\u39B8\u39BD\u39DF\u39E4\u39E8\u39F3\u39F9\u39FD\u3A01\u3A20r\xF2\u03F7ar\u0100;v\u3926\u3927\u6AE8;\u6AE9as\xE8\u03E1\u0100nr\u3932\u3937grt;\u699C\u0380eknprst\u34E3\u3946\u394B\u3952\u395D\u3964\u3996app\xE1\u2415othin\xE7\u1E96\u0180hir\u34EB\u2EC8\u3959op\xF4\u2FB5\u0100;h\u13B7\u3962\xEF\u318D\u0100iu\u3969\u396Dgm\xE1\u33B3\u0100bp\u3972\u3984setneq\u0100;q\u397D\u3980\uC000\u228A\uFE00;\uC000\u2ACB\uFE00setneq\u0100;q\u398F\u3992\uC000\u228B\uFE00;\uC000\u2ACC\uFE00\u0100hr\u399B\u399Fet\xE1\u369Ciangle\u0100lr\u39AA\u39AFeft\xBB\u0925ight\xBB\u1051y;\u4432ash\xBB\u1036\u0180elr\u39C4\u39D2\u39D7\u0180;be\u2DEA\u39CB\u39CFar;\u62BBq;\u625Alip;\u62EE\u0100bt\u39DC\u1468a\xF2\u1469r;\uC000\u{1D533}tr\xE9\u39AEsu\u0100bp\u39EF\u39F1\xBB\u0D1C\xBB\u0D59pf;\uC000\u{1D567}ro\xF0\u0EFBtr\xE9\u39B4\u0100cu\u3A06\u3A0Br;\uC000\u{1D4CB}\u0100bp\u3A10\u3A18n\u0100Ee\u3980\u3A16\xBB\u397En\u0100Ee\u3992\u3A1E\xBB\u3990igzag;\u699A\u0380cefoprs\u3A36\u3A3B\u3A56\u3A5B\u3A54\u3A61\u3A6Airc;\u4175\u0100di\u3A40\u3A51\u0100bg\u3A45\u3A49ar;\u6A5Fe\u0100;q\u15FA\u3A4F;\u6259erp;\u6118r;\uC000\u{1D534}pf;\uC000\u{1D568}\u0100;e\u1479\u3A66at\xE8\u1479cr;\uC000\u{1D4CC}\u0AE3\u178E\u3A87\0\u3A8B\0\u3A90\u3A9B\0\0\u3A9D\u3AA8\u3AAB\u3AAF\0\0\u3AC3\u3ACE\0\u3AD8\u17DC\u17DFtr\xE9\u17D1r;\uC000\u{1D535}\u0100Aa\u3A94\u3A97r\xF2\u03C3r\xF2\u09F6;\u43BE\u0100Aa\u3AA1\u3AA4r\xF2\u03B8r\xF2\u09EBa\xF0\u2713is;\u62FB\u0180dpt\u17A4\u3AB5\u3ABE\u0100fl\u3ABA\u17A9;\uC000\u{1D569}im\xE5\u17B2\u0100Aa\u3AC7\u3ACAr\xF2\u03CEr\xF2\u0A01\u0100cq\u3AD2\u17B8r;\uC000\u{1D4CD}\u0100pt\u17D6\u3ADCr\xE9\u17D4\u0400acefiosu\u3AF0\u3AFD\u3B08\u3B0C\u3B11\u3B15\u3B1B\u3B21c\u0100uy\u3AF6\u3AFBte\u803B\xFD\u40FD;\u444F\u0100iy\u3B02\u3B06rc;\u4177;\u444Bn\u803B\xA5\u40A5r;\uC000\u{1D536}cy;\u4457pf;\uC000\u{1D56A}cr;\uC000\u{1D4CE}\u0100cm\u3B26\u3B29y;\u444El\u803B\xFF\u40FF\u0500acdefhiosw\u3B42\u3B48\u3B54\u3B58\u3B64\u3B69\u3B6D\u3B74\u3B7A\u3B80cute;\u417A\u0100ay\u3B4D\u3B52ron;\u417E;\u4437ot;\u417C\u0100et\u3B5D\u3B61tr\xE6\u155Fa;\u43B6r;\uC000\u{1D537}cy;\u4436grarr;\u61DDpf;\uC000\u{1D56B}cr;\uC000\u{1D4CF}\u0100jn\u3B85\u3B87;\u600Dj;\u600C'.split("").map(function(n){return n.charCodeAt(0)}))});var lv=Qe(th=>{"use strict";Object.defineProperty(th,"__esModule",{value:!0});th.default=new Uint16Array("\u0200aglq	\x1B\u026D\0\0p;\u4026os;\u4027t;\u403Et;\u403Cuot;\u4022".split("").map(function(n){return n.charCodeAt(0)}))});var ih=Qe(Xn=>{"use strict";var nh;Object.defineProperty(Xn,"__esModule",{value:!0});Xn.replaceCodePoint=Xn.fromCodePoint=void 0;var cA=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);Xn.fromCodePoint=(nh=String.fromCodePoint)!==null&&nh!==void 0?nh:function(n){var t="";return n>65535&&(n-=65536,t+=String.fromCharCode(n>>>10&1023|55296),n=56320|n&1023),t+=String.fromCharCode(n),t};function cv(n){var t;return n>=55296&&n<=57343||n>1114111?65533:(t=cA.get(n))!==null&&t!==void 0?t:n}Xn.replaceCodePoint=cv;function uA(n){return(0,Xn.fromCodePoint)(cv(n))}Xn.default=uA});var ah=Qe(ge=>{"use strict";var dA=ge&&ge.__createBinding||(Object.create?(function(n,t,e,i){i===void 0&&(i=e);var r=Object.getOwnPropertyDescriptor(t,e);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,i,r)}):(function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]})),hA=ge&&ge.__setModuleDefault||(Object.create?(function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}):function(n,t){n.default=t}),pA=ge&&ge.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&dA(t,n,e);return hA(t,n),t},uv=ge&&ge.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ge,"__esModule",{value:!0});ge.decodeXML=ge.decodeHTMLStrict=ge.decodeHTMLAttribute=ge.decodeHTML=ge.determineBranch=ge.EntityDecoder=ge.DecodingMode=ge.BinTrieFlags=ge.fromCodePoint=ge.replaceCodePoint=ge.decodeCodePoint=ge.xmlDecodeTree=ge.htmlDecodeTree=void 0;var dv=uv(av());ge.htmlDecodeTree=dv.default;var hv=uv(lv());ge.xmlDecodeTree=hv.default;var oh=pA(ih());ge.decodeCodePoint=oh.default;var pv=ih();Object.defineProperty(ge,"replaceCodePoint",{enumerable:!0,get:function(){return pv.replaceCodePoint}});Object.defineProperty(ge,"fromCodePoint",{enumerable:!0,get:function(){return pv.fromCodePoint}});var Ye;(function(n){n[n.NUM=35]="NUM",n[n.SEMI=59]="SEMI",n[n.EQUALS=61]="EQUALS",n[n.ZERO=48]="ZERO",n[n.NINE=57]="NINE",n[n.LOWER_A=97]="LOWER_A",n[n.LOWER_F=102]="LOWER_F",n[n.LOWER_X=120]="LOWER_X",n[n.LOWER_Z=122]="LOWER_Z",n[n.UPPER_A=65]="UPPER_A",n[n.UPPER_F=70]="UPPER_F",n[n.UPPER_Z=90]="UPPER_Z"})(Ye||(Ye={}));var fA=32,Ii;(function(n){n[n.VALUE_LENGTH=49152]="VALUE_LENGTH",n[n.BRANCH_LENGTH=16256]="BRANCH_LENGTH",n[n.JUMP_TABLE=127]="JUMP_TABLE"})(Ii=ge.BinTrieFlags||(ge.BinTrieFlags={}));function rh(n){return n>=Ye.ZERO&&n<=Ye.NINE}function mA(n){return n>=Ye.UPPER_A&&n<=Ye.UPPER_F||n>=Ye.LOWER_A&&n<=Ye.LOWER_F}function gA(n){return n>=Ye.UPPER_A&&n<=Ye.UPPER_Z||n>=Ye.LOWER_A&&n<=Ye.LOWER_Z||rh(n)}function bA(n){return n===Ye.EQUALS||gA(n)}var je;(function(n){n[n.EntityStart=0]="EntityStart",n[n.NumericStart=1]="NumericStart",n[n.NumericDecimal=2]="NumericDecimal",n[n.NumericHex=3]="NumericHex",n[n.NamedEntity=4]="NamedEntity"})(je||(je={}));var ln;(function(n){n[n.Legacy=0]="Legacy",n[n.Strict=1]="Strict",n[n.Attribute=2]="Attribute"})(ln=ge.DecodingMode||(ge.DecodingMode={}));var fv=(function(){function n(t,e,i){this.decodeTree=t,this.emitCodePoint=e,this.errors=i,this.state=je.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=ln.Strict}return n.prototype.startEntity=function(t){this.decodeMode=t,this.state=je.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},n.prototype.write=function(t,e){switch(this.state){case je.EntityStart:return t.charCodeAt(e)===Ye.NUM?(this.state=je.NumericStart,this.consumed+=1,this.stateNumericStart(t,e+1)):(this.state=je.NamedEntity,this.stateNamedEntity(t,e));case je.NumericStart:return this.stateNumericStart(t,e);case je.NumericDecimal:return this.stateNumericDecimal(t,e);case je.NumericHex:return this.stateNumericHex(t,e);case je.NamedEntity:return this.stateNamedEntity(t,e)}},n.prototype.stateNumericStart=function(t,e){return e>=t.length?-1:(t.charCodeAt(e)|fA)===Ye.LOWER_X?(this.state=je.NumericHex,this.consumed+=1,this.stateNumericHex(t,e+1)):(this.state=je.NumericDecimal,this.stateNumericDecimal(t,e))},n.prototype.addToNumericResult=function(t,e,i,r){if(e!==i){var o=i-e;this.result=this.result*Math.pow(r,o)+parseInt(t.substr(e,o),r),this.consumed+=o}},n.prototype.stateNumericHex=function(t,e){for(var i=e;e<t.length;){var r=t.charCodeAt(e);if(rh(r)||mA(r))e+=1;else return this.addToNumericResult(t,i,e,16),this.emitNumericEntity(r,3)}return this.addToNumericResult(t,i,e,16),-1},n.prototype.stateNumericDecimal=function(t,e){for(var i=e;e<t.length;){var r=t.charCodeAt(e);if(rh(r))e+=1;else return this.addToNumericResult(t,i,e,10),this.emitNumericEntity(r,2)}return this.addToNumericResult(t,i,e,10),-1},n.prototype.emitNumericEntity=function(t,e){var i;if(this.consumed<=e)return(i=this.errors)===null||i===void 0||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===Ye.SEMI)this.consumed+=1;else if(this.decodeMode===ln.Strict)return 0;return this.emitCodePoint((0,oh.replaceCodePoint)(this.result),this.consumed),this.errors&&(t!==Ye.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},n.prototype.stateNamedEntity=function(t,e){for(var i=this.decodeTree,r=i[this.treeIndex],o=(r&Ii.VALUE_LENGTH)>>14;e<t.length;e++,this.excess++){var s=t.charCodeAt(e);if(this.treeIndex=gv(i,r,this.treeIndex+Math.max(1,o),s),this.treeIndex<0)return this.result===0||this.decodeMode===ln.Attribute&&(o===0||bA(s))?0:this.emitNotTerminatedNamedEntity();if(r=i[this.treeIndex],o=(r&Ii.VALUE_LENGTH)>>14,o!==0){if(s===Ye.SEMI)return this.emitNamedEntityData(this.treeIndex,o,this.consumed+this.excess);this.decodeMode!==ln.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},n.prototype.emitNotTerminatedNamedEntity=function(){var t,e=this,i=e.result,r=e.decodeTree,o=(r[i]&Ii.VALUE_LENGTH)>>14;return this.emitNamedEntityData(i,o,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed},n.prototype.emitNamedEntityData=function(t,e,i){var r=this.decodeTree;return this.emitCodePoint(e===1?r[t]&~Ii.VALUE_LENGTH:r[t+1],i),e===3&&this.emitCodePoint(r[t+2],i),i},n.prototype.end=function(){var t;switch(this.state){case je.NamedEntity:return this.result!==0&&(this.decodeMode!==ln.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case je.NumericDecimal:return this.emitNumericEntity(0,2);case je.NumericHex:return this.emitNumericEntity(0,3);case je.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case je.EntityStart:return 0}},n})();ge.EntityDecoder=fv;function mv(n){var t="",e=new fv(n,function(i){return t+=(0,oh.fromCodePoint)(i)});return function(r,o){for(var s=0,a=0;(a=r.indexOf("&",a))>=0;){t+=r.slice(s,a),e.startEntity(o);var l=e.write(r,a+1);if(l<0){s=a+e.end();break}s=a+l,a=l===0?s+1:s}var c=t+r.slice(s);return t="",c}}function gv(n,t,e,i){var r=(t&Ii.BRANCH_LENGTH)>>7,o=t&Ii.JUMP_TABLE;if(r===0)return o!==0&&i===o?e:-1;if(o){var s=i-o;return s<0||s>=r?-1:n[e+s]-1}for(var a=e,l=a+r-1;a<=l;){var c=a+l>>>1,u=n[c];if(u<i)a=c+1;else if(u>i)l=c-1;else return n[c+r]}return-1}ge.determineBranch=gv;var sh=mv(dv.default),yA=mv(hv.default);function vA(n,t){return t===void 0&&(t=ln.Legacy),sh(n,t)}ge.decodeHTML=vA;function EA(n){return sh(n,ln.Attribute)}ge.decodeHTMLAttribute=EA;function xA(n){return sh(n,ln.Strict)}ge.decodeHTMLStrict=xA;function kA(n){return yA(n,ln.Strict)}ge.decodeXML=kA});var bv=Qe(lh=>{"use strict";Object.defineProperty(lh,"__esModule",{value:!0});function ja(n){for(var t=1;t<n.length;t++)n[t][0]+=n[t-1][0]+1;return n}lh.default=new Map(ja([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(ja([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(ja([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(ja([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]))});var Ya=Qe(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.escapeText=Ke.escapeAttribute=Ke.escapeUTF8=Ke.escape=Ke.encodeXML=Ke.getCodePoint=Ke.xmlReplacer=void 0;Ke.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var yv=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);Ke.getCodePoint=String.prototype.codePointAt!=null?function(n,t){return n.codePointAt(t)}:function(n,t){return(n.charCodeAt(t)&64512)===55296?(n.charCodeAt(t)-55296)*1024+n.charCodeAt(t+1)-56320+65536:n.charCodeAt(t)};function vv(n){for(var t="",e=0,i;(i=Ke.xmlReplacer.exec(n))!==null;){var r=i.index,o=n.charCodeAt(r),s=yv.get(o);s!==void 0?(t+=n.substring(e,r)+s,e=r+1):(t+="".concat(n.substring(e,r),"&#x").concat((0,Ke.getCodePoint)(n,r).toString(16),";"),e=Ke.xmlReplacer.lastIndex+=+((o&64512)===55296))}return t+n.substr(e)}Ke.encodeXML=vv;Ke.escape=vv;function ch(n,t){return function(i){for(var r,o=0,s="";r=n.exec(i);)o!==r.index&&(s+=i.substring(o,r.index)),s+=t.get(r[0].charCodeAt(0)),o=r.index+1;return s+i.substring(o)}}Ke.escapeUTF8=ch(/[&<>'"]/g,yv);Ke.escapeAttribute=ch(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]]));Ke.escapeText=ch(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))});var uh=Qe(Jn=>{"use strict";var wA=Jn&&Jn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Jn,"__esModule",{value:!0});Jn.encodeNonAsciiHTML=Jn.encodeHTML=void 0;var SA=wA(bv()),Ev=Ya(),MA=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function TA(n){return xv(MA,n)}Jn.encodeHTML=TA;function CA(n){return xv(Ev.xmlReplacer,n)}Jn.encodeNonAsciiHTML=CA;function xv(n,t){for(var e="",i=0,r;(r=n.exec(t))!==null;){var o=r.index;e+=t.substring(i,o);var s=t.charCodeAt(o),a=SA.default.get(s);if(typeof a=="object"){if(o+1<t.length){var l=t.charCodeAt(o+1),c=typeof a.n=="number"?a.n===l?a.o:void 0:a.n.get(l);if(c!==void 0){e+=c,i=n.lastIndex+=1;continue}}a=a.v}if(a!==void 0)e+=a,i=o+1;else{var u=(0,Ev.getCodePoint)(t,o);e+="&#x".concat(u.toString(16),";"),i=n.lastIndex+=+(u!==s)}}return e+t.substr(i)}});var Sv=Qe(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.decodeXMLStrict=te.decodeHTML5Strict=te.decodeHTML4Strict=te.decodeHTML5=te.decodeHTML4=te.decodeHTMLAttribute=te.decodeHTMLStrict=te.decodeHTML=te.decodeXML=te.DecodingMode=te.EntityDecoder=te.encodeHTML5=te.encodeHTML4=te.encodeNonAsciiHTML=te.encodeHTML=te.escapeText=te.escapeAttribute=te.escapeUTF8=te.escape=te.encodeXML=te.encode=te.decodeStrict=te.decode=te.EncodingMode=te.EntityLevel=void 0;var dh=ah(),kv=uh(),Xa=Ya(),pr;(function(n){n[n.XML=0]="XML",n[n.HTML=1]="HTML"})(pr=te.EntityLevel||(te.EntityLevel={}));var mo;(function(n){n[n.UTF8=0]="UTF8",n[n.ASCII=1]="ASCII",n[n.Extensive=2]="Extensive",n[n.Attribute=3]="Attribute",n[n.Text=4]="Text"})(mo=te.EncodingMode||(te.EncodingMode={}));function wv(n,t){t===void 0&&(t=pr.XML);var e=typeof t=="number"?t:t.level;if(e===pr.HTML){var i=typeof t=="object"?t.mode:void 0;return(0,dh.decodeHTML)(n,i)}return(0,dh.decodeXML)(n)}te.decode=wv;function LA(n,t){var e;t===void 0&&(t=pr.XML);var i=typeof t=="number"?{level:t}:t;return(e=i.mode)!==null&&e!==void 0||(i.mode=dh.DecodingMode.Strict),wv(n,i)}te.decodeStrict=LA;function RA(n,t){t===void 0&&(t=pr.XML);var e=typeof t=="number"?{level:t}:t;return e.mode===mo.UTF8?(0,Xa.escapeUTF8)(n):e.mode===mo.Attribute?(0,Xa.escapeAttribute)(n):e.mode===mo.Text?(0,Xa.escapeText)(n):e.level===pr.HTML?e.mode===mo.ASCII?(0,kv.encodeNonAsciiHTML)(n):(0,kv.encodeHTML)(n):(0,Xa.encodeXML)(n)}te.encode=RA;var go=Ya();Object.defineProperty(te,"encodeXML",{enumerable:!0,get:function(){return go.encodeXML}});Object.defineProperty(te,"escape",{enumerable:!0,get:function(){return go.escape}});Object.defineProperty(te,"escapeUTF8",{enumerable:!0,get:function(){return go.escapeUTF8}});Object.defineProperty(te,"escapeAttribute",{enumerable:!0,get:function(){return go.escapeAttribute}});Object.defineProperty(te,"escapeText",{enumerable:!0,get:function(){return go.escapeText}});var Ja=uh();Object.defineProperty(te,"encodeHTML",{enumerable:!0,get:function(){return Ja.encodeHTML}});Object.defineProperty(te,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Ja.encodeNonAsciiHTML}});Object.defineProperty(te,"encodeHTML4",{enumerable:!0,get:function(){return Ja.encodeHTML}});Object.defineProperty(te,"encodeHTML5",{enumerable:!0,get:function(){return Ja.encodeHTML}});var Xt=ah();Object.defineProperty(te,"EntityDecoder",{enumerable:!0,get:function(){return Xt.EntityDecoder}});Object.defineProperty(te,"DecodingMode",{enumerable:!0,get:function(){return Xt.DecodingMode}});Object.defineProperty(te,"decodeXML",{enumerable:!0,get:function(){return Xt.decodeXML}});Object.defineProperty(te,"decodeHTML",{enumerable:!0,get:function(){return Xt.decodeHTML}});Object.defineProperty(te,"decodeHTMLStrict",{enumerable:!0,get:function(){return Xt.decodeHTMLStrict}});Object.defineProperty(te,"decodeHTMLAttribute",{enumerable:!0,get:function(){return Xt.decodeHTMLAttribute}});Object.defineProperty(te,"decodeHTML4",{enumerable:!0,get:function(){return Xt.decodeHTML}});Object.defineProperty(te,"decodeHTML5",{enumerable:!0,get:function(){return Xt.decodeHTML}});Object.defineProperty(te,"decodeHTML4Strict",{enumerable:!0,get:function(){return Xt.decodeHTMLStrict}});Object.defineProperty(te,"decodeHTML5Strict",{enumerable:!0,get:function(){return Xt.decodeHTMLStrict}});Object.defineProperty(te,"decodeXMLStrict",{enumerable:!0,get:function(){return Xt.decodeXML}})});var Rv=Qe((rz,Lv)=>{"use strict";var Za=Qd();function AA(n){let t={};n=n||{},t.src_Any=Za.Any.source,t.src_Cc=Za.Cc.source,t.src_Z=Za.Z.source,t.src_P=Za.P.source,t.src_ZPCc=[t.src_Z,t.src_P,t.src_Cc].join("|"),t.src_ZCc=[t.src_Z,t.src_Cc].join("|");let e="[><\uFF5C]";return t.src_pseudo_letter="(?:(?!"+e+"|"+t.src_ZPCc+")"+t.src_Any+")",t.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",t.src_auth="(?:(?:(?!"+t.src_ZCc+"|[@/\\[\\]()]).)+@)?",t.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",t.src_host_terminator="(?=$|"+e+"|"+t.src_ZPCc+")(?!"+(n["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+t.src_ZPCc+"))",t.src_path="(?:[/?#](?:(?!"+t.src_ZCc+"|"+e+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+t.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+t.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+t.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+t.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+t.src_ZCc+"|[']).)+\\'|\\'(?="+t.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+t.src_ZCc+"|[.]|$)|"+(n["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+t.src_ZCc+"|$)|;(?!"+t.src_ZCc+"|$)|\\!+(?!"+t.src_ZCc+"|[!]|$)|\\?(?!"+t.src_ZCc+"|[?]|$))+|\\/)?",t.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',t.src_xn="xn--[a-z0-9\\-]{1,59}",t.src_domain_root="(?:"+t.src_xn+"|"+t.src_pseudo_letter+"{1,63})",t.src_domain="(?:"+t.src_xn+"|(?:"+t.src_pseudo_letter+")|(?:"+t.src_pseudo_letter+"(?:-|"+t.src_pseudo_letter+"){0,61}"+t.src_pseudo_letter+"))",t.src_host="(?:(?:(?:(?:"+t.src_domain+")\\.)*"+t.src_domain+"))",t.tpl_host_fuzzy="(?:"+t.src_ip4+"|(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%)))",t.tpl_host_no_ip_fuzzy="(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))",t.src_host_strict=t.src_host+t.src_host_terminator,t.tpl_host_fuzzy_strict=t.tpl_host_fuzzy+t.src_host_terminator,t.src_host_port_strict=t.src_host+t.src_port+t.src_host_terminator,t.tpl_host_port_fuzzy_strict=t.tpl_host_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_port_no_ip_fuzzy_strict=t.tpl_host_no_ip_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+t.src_ZPCc+"|>|$))",t.tpl_email_fuzzy="(^|"+e+'|"|\\(|'+t.src_ZCc+")("+t.src_email_name+"@"+t.tpl_host_fuzzy_strict+")",t.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+t.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+t.tpl_host_port_fuzzy_strict+t.src_path+")",t.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+t.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+t.tpl_host_port_no_ip_fuzzy_strict+t.src_path+")",t}function hh(n){return Array.prototype.slice.call(arguments,1).forEach(function(e){e&&Object.keys(e).forEach(function(i){n[i]=e[i]})}),n}function el(n){return Object.prototype.toString.call(n)}function IA(n){return el(n)==="[object String]"}function NA(n){return el(n)==="[object Object]"}function PA(n){return el(n)==="[object RegExp]"}function Mv(n){return el(n)==="[object Function]"}function _A(n){return n.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var Cv={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function OA(n){return Object.keys(n||{}).reduce(function(t,e){return t||Cv.hasOwnProperty(e)},!1)}var DA={"http:":{validate:function(n,t,e){let i=n.slice(t);return e.re.http||(e.re.http=new RegExp("^\\/\\/"+e.re.src_auth+e.re.src_host_port_strict+e.re.src_path,"i")),e.re.http.test(i)?i.match(e.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(n,t,e){let i=n.slice(t);return e.re.no_http||(e.re.no_http=new RegExp("^"+e.re.src_auth+"(?:localhost|(?:(?:"+e.re.src_domain+")\\.)+"+e.re.src_domain_root+")"+e.re.src_port+e.re.src_host_terminator+e.re.src_path,"i")),e.re.no_http.test(i)?t>=3&&n[t-3]===":"||t>=3&&n[t-3]==="/"?0:i.match(e.re.no_http)[0].length:0}},"mailto:":{validate:function(n,t,e){let i=n.slice(t);return e.re.mailto||(e.re.mailto=new RegExp("^"+e.re.src_email_name+"@"+e.re.src_host_strict,"i")),e.re.mailto.test(i)?i.match(e.re.mailto)[0].length:0}}},BA="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",FA="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|\u0440\u0444".split("|");function HA(n){n.__index__=-1,n.__text_cache__=""}function zA(n){return function(t,e){let i=t.slice(e);return n.test(i)?i.match(n)[0].length:0}}function Tv(){return function(n,t){t.normalize(n)}}function Qa(n){let t=n.re=AA(n.__opts__),e=n.__tlds__.slice();n.onCompile(),n.__tlds_replaced__||e.push(BA),e.push(t.src_xn),t.src_tlds=e.join("|");function i(a){return a.replace("%TLDS%",t.src_tlds)}t.email_fuzzy=RegExp(i(t.tpl_email_fuzzy),"i"),t.link_fuzzy=RegExp(i(t.tpl_link_fuzzy),"i"),t.link_no_ip_fuzzy=RegExp(i(t.tpl_link_no_ip_fuzzy),"i"),t.host_fuzzy_test=RegExp(i(t.tpl_host_fuzzy_test),"i");let r=[];n.__compiled__={};function o(a,l){throw new Error('(LinkifyIt) Invalid schema "'+a+'": '+l)}Object.keys(n.__schemas__).forEach(function(a){let l=n.__schemas__[a];if(l===null)return;let c={validate:null,link:null};if(n.__compiled__[a]=c,NA(l)){PA(l.validate)?c.validate=zA(l.validate):Mv(l.validate)?c.validate=l.validate:o(a,l),Mv(l.normalize)?c.normalize=l.normalize:l.normalize?o(a,l):c.normalize=Tv();return}if(IA(l)){r.push(a);return}o(a,l)}),r.forEach(function(a){n.__compiled__[n.__schemas__[a]]&&(n.__compiled__[a].validate=n.__compiled__[n.__schemas__[a]].validate,n.__compiled__[a].normalize=n.__compiled__[n.__schemas__[a]].normalize)}),n.__compiled__[""]={validate:null,normalize:Tv()};let s=Object.keys(n.__compiled__).filter(function(a){return a.length>0&&n.__compiled__[a]}).map(_A).join("|");n.re.schema_test=RegExp("(^|(?!_)(?:[><\uFF5C]|"+t.src_ZPCc+"))("+s+")","i"),n.re.schema_search=RegExp("(^|(?!_)(?:[><\uFF5C]|"+t.src_ZPCc+"))("+s+")","ig"),n.re.schema_at_start=RegExp("^"+n.re.schema_search.source,"i"),n.re.pretest=RegExp("("+n.re.schema_test.source+")|("+n.re.host_fuzzy_test.source+")|@","i"),HA(n)}function VA(n,t){let e=n.__index__,i=n.__last_index__,r=n.__text_cache__.slice(e,i);this.schema=n.__schema__.toLowerCase(),this.index=e+t,this.lastIndex=i+t,this.raw=r,this.text=r,this.url=r}function ph(n,t){let e=new VA(n,t);return n.__compiled__[e.schema].normalize(e,n),e}function Rt(n,t){if(!(this instanceof Rt))return new Rt(n,t);t||OA(n)&&(t=n,n={}),this.__opts__=hh({},Cv,t),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=hh({},DA,n),this.__compiled__={},this.__tlds__=FA,this.__tlds_replaced__=!1,this.re={},Qa(this)}Rt.prototype.add=function(t,e){return this.__schemas__[t]=e,Qa(this),this};Rt.prototype.set=function(t){return this.__opts__=hh(this.__opts__,t),this};Rt.prototype.test=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return!1;let e,i,r,o,s,a,l,c,u;if(this.re.schema_test.test(t)){for(l=this.re.schema_search,l.lastIndex=0;(e=l.exec(t))!==null;)if(o=this.testSchemaAt(t,e[2],l.lastIndex),o){this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+o;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(c=t.search(this.re.host_fuzzy_test),c>=0&&(this.__index__<0||c<this.__index__)&&(i=t.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(s=i.index+i[1].length,(this.__index__<0||s<this.__index__)&&(this.__schema__="",this.__index__=s,this.__last_index__=i.index+i[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(u=t.indexOf("@"),u>=0&&(r=t.match(this.re.email_fuzzy))!==null&&(s=r.index+r[1].length,a=r.index+r[0].length,(this.__index__<0||s<this.__index__||s===this.__index__&&a>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=s,this.__last_index__=a))),this.__index__>=0};Rt.prototype.pretest=function(t){return this.re.pretest.test(t)};Rt.prototype.testSchemaAt=function(t,e,i){return this.__compiled__[e.toLowerCase()]?this.__compiled__[e.toLowerCase()].validate(t,i,this):0};Rt.prototype.match=function(t){let e=[],i=0;this.__index__>=0&&this.__text_cache__===t&&(e.push(ph(this,i)),i=this.__last_index__);let r=i?t.slice(i):t;for(;this.test(r);)e.push(ph(this,i)),r=r.slice(this.__last_index__),i+=this.__last_index__;return e.length?e:null};Rt.prototype.matchAtStart=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return null;let e=this.re.schema_at_start.exec(t);if(!e)return null;let i=this.testSchemaAt(t,e[2],e[0].length);return i?(this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+i,ph(this,0)):null};Rt.prototype.tlds=function(t,e){return t=Array.isArray(t)?t:[t],e?(this.__tlds__=this.__tlds__.concat(t).sort().filter(function(i,r,o){return i!==o[r-1]}).reverse(),Qa(this),this):(this.__tlds__=t.slice(),this.__tlds_replaced__=!0,Qa(this),this)};Rt.prototype.normalize=function(t){t.schema||(t.url="http://"+t.url),t.schema==="mailto:"&&!/^mailto:/i.test(t.url)&&(t.url="mailto:"+t.url)};Rt.prototype.onCompile=function(){};Lv.exports=Rt});var Bv=Qe((oz,Dv)=>{"use strict";var $A=/^xn--/,WA=/[^\0-\x7F]/,UA=/[\x2E\u3002\uFF0E\uFF61]/g,KA={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},fh=35,cn=Math.floor,mh=String.fromCharCode;function Zn(n){throw new RangeError(KA[n])}function qA(n,t){let e=[],i=n.length;for(;i--;)e[i]=t(n[i]);return e}function Iv(n,t){let e=n.split("@"),i="";e.length>1&&(i=e[0]+"@",n=e[1]),n=n.replace(UA,".");let r=n.split("."),o=qA(r,t).join(".");return i+o}function Nv(n){let t=[],e=0,i=n.length;for(;e<i;){let r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<i){let o=n.charCodeAt(e++);(o&64512)==56320?t.push(((r&1023)<<10)+(o&1023)+65536):(t.push(r),e--)}else t.push(r)}return t}var GA=n=>String.fromCodePoint(...n),jA=function(n){return n>=48&&n<58?26+(n-48):n>=65&&n<91?n-65:n>=97&&n<123?n-97:36},Av=function(n,t){return n+22+75*(n<26)-((t!=0)<<5)},Pv=function(n,t,e){let i=0;for(n=e?cn(n/700):n>>1,n+=cn(n/t);n>fh*26>>1;i+=36)n=cn(n/fh);return cn(i+(fh+1)*n/(n+38))},_v=function(n){let t=[],e=n.length,i=0,r=128,o=72,s=n.lastIndexOf("-");s<0&&(s=0);for(let a=0;a<s;++a)n.charCodeAt(a)>=128&&Zn("not-basic"),t.push(n.charCodeAt(a));for(let a=s>0?s+1:0;a<e;){let l=i;for(let u=1,d=36;;d+=36){a>=e&&Zn("invalid-input");let h=jA(n.charCodeAt(a++));h>=36&&Zn("invalid-input"),h>cn((2147483647-i)/u)&&Zn("overflow"),i+=h*u;let p=d<=o?1:d>=o+26?26:d-o;if(h<p)break;let f=36-p;u>cn(2147483647/f)&&Zn("overflow"),u*=f}let c=t.length+1;o=Pv(i-l,c,l==0),cn(i/c)>2147483647-r&&Zn("overflow"),r+=cn(i/c),i%=c,t.splice(i++,0,r)}return String.fromCodePoint(...t)},Ov=function(n){let t=[];n=Nv(n);let e=n.length,i=128,r=0,o=72;for(let l of n)l<128&&t.push(mh(l));let s=t.length,a=s;for(s&&t.push("-");a<e;){let l=2147483647;for(let u of n)u>=i&&u<l&&(l=u);let c=a+1;l-i>cn((2147483647-r)/c)&&Zn("overflow"),r+=(l-i)*c,i=l;for(let u of n)if(u<i&&++r>2147483647&&Zn("overflow"),u===i){let d=r;for(let h=36;;h+=36){let p=h<=o?1:h>=o+26?26:h-o;if(d<p)break;let f=d-p,g=36-p;t.push(mh(Av(p+f%g,0))),d=cn(f/g)}t.push(mh(Av(d,0))),o=Pv(r,c,a===s),r=0,++a}++r,++i}return t.join("")},YA=function(n){return Iv(n,function(t){return $A.test(t)?_v(t.slice(4).toLowerCase()):t})},XA=function(n){return Iv(n,function(t){return WA.test(t)?"xn--"+Ov(t):t})},JA={version:"2.3.1",ucs2:{decode:Nv,encode:GA},decode:_v,encode:Ov,toASCII:XA,toUnicode:YA};Dv.exports=JA});var oE=Qe((sz,rE)=>{"use strict";var ZA=sv(),QA=Qd(),qv=Sv(),e2=Rv(),Gv=Bv();function jv(n){var t=Object.create(null);return n&&Object.keys(n).forEach(function(e){if(e!=="default"){var i=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,i.get?i:{enumerable:!0,get:function(){return n[e]}})}}),t.default=n,Object.freeze(t)}var Qn=jv(ZA),Eh=jv(QA);function t2(n){return Object.prototype.toString.call(n)}function xh(n){return t2(n)==="[object String]"}var n2=Object.prototype.hasOwnProperty;function i2(n,t){return n2.call(n,t)}function rl(n){return Array.prototype.slice.call(arguments,1).forEach(function(e){if(e){if(typeof e!="object")throw new TypeError(e+"must be object");Object.keys(e).forEach(function(i){n[i]=e[i]})}}),n}function Yv(n,t,e){return[].concat(n.slice(0,t),e,n.slice(t+1))}function kh(n){return!(n>=55296&&n<=57343||n>=64976&&n<=65007||(n&65535)===65535||(n&65535)===65534||n>=0&&n<=8||n===11||n>=14&&n<=31||n>=127&&n<=159||n>1114111)}function il(n){if(n>65535){n-=65536;let t=55296+(n>>10),e=56320+(n&1023);return String.fromCharCode(t,e)}return String.fromCharCode(n)}var Xv=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,r2=/&([a-z#][a-z0-9]{1,31});/gi,o2=new RegExp(Xv.source+"|"+r2.source,"gi"),s2=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function a2(n,t){if(t.charCodeAt(0)===35&&s2.test(t)){let i=t[1].toLowerCase()==="x"?parseInt(t.slice(2),16):parseInt(t.slice(1),10);return kh(i)?il(i):n}let e=qv.decodeHTML(n);return e!==n?e:n}function l2(n){return n.indexOf("\\")<0?n:n.replace(Xv,"$1")}function mr(n){return n.indexOf("\\")<0&&n.indexOf("&")<0?n:n.replace(o2,function(t,e,i){return e||a2(t,i)})}var c2=/[&<>"]/,u2=/[&<>"]/g,d2={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function h2(n){return d2[n]}function ei(n){return c2.test(n)?n.replace(u2,h2):n}var p2=/[.?*+^$[\]\\(){}|-]/g;function f2(n){return n.replace(p2,"\\$&")}function Ce(n){switch(n){case 9:case 32:return!0}return!1}function bo(n){if(n>=8192&&n<=8202)return!0;switch(n){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function yo(n){return Eh.P.test(n)||Eh.S.test(n)}function vo(n){switch(n){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function ol(n){return n=n.trim().replace(/\s+/g," "),"\u1E9E".toLowerCase()==="\u1E7E"&&(n=n.replace(//g,"\xDF")),n.toLowerCase().toUpperCase()}var m2={mdurl:Qn,ucmicro:Eh},g2=Object.freeze({__proto__:null,arrayReplaceAt:Yv,assign:rl,escapeHtml:ei,escapeRE:f2,fromCodePoint:il,has:i2,isMdAsciiPunct:vo,isPunctChar:yo,isSpace:Ce,isString:xh,isValidEntityCode:kh,isWhiteSpace:bo,lib:m2,normalizeReference:ol,unescapeAll:mr,unescapeMd:l2});function b2(n,t,e){let i,r,o,s,a=n.posMax,l=n.pos;for(n.pos=t+1,i=1;n.pos<a;){if(o=n.src.charCodeAt(n.pos),o===93&&(i--,i===0)){r=!0;break}if(s=n.pos,n.md.inline.skipToken(n),o===91){if(s===n.pos-1)i++;else if(e)return n.pos=l,-1}}let c=-1;return r&&(c=n.pos),n.pos=l,c}function y2(n,t,e){let i,r=t,o={ok:!1,pos:0,str:""};if(n.charCodeAt(r)===60){for(r++;r<e;){if(i=n.charCodeAt(r),i===10||i===60)return o;if(i===62)return o.pos=r+1,o.str=mr(n.slice(t+1,r)),o.ok=!0,o;if(i===92&&r+1<e){r+=2;continue}r++}return o}let s=0;for(;r<e&&(i=n.charCodeAt(r),!(i===32||i<32||i===127));){if(i===92&&r+1<e){if(n.charCodeAt(r+1)===32)break;r+=2;continue}if(i===40&&(s++,s>32))return o;if(i===41){if(s===0)break;s--}r++}return t===r||s!==0||(o.str=mr(n.slice(t,r)),o.pos=r,o.ok=!0),o}function v2(n,t,e,i){let r,o=t,s={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(i)s.str=i.str,s.marker=i.marker;else{if(o>=e)return s;let a=n.charCodeAt(o);if(a!==34&&a!==39&&a!==40)return s;t++,o++,a===40&&(a=41),s.marker=a}for(;o<e;){if(r=n.charCodeAt(o),r===s.marker)return s.pos=o+1,s.str+=mr(n.slice(t,o)),s.ok=!0,s;if(r===40&&s.marker===41)return s;r===92&&o+1<e&&o++,o++}return s.can_continue=!0,s.str+=mr(n.slice(t,o)),s}var E2=Object.freeze({__proto__:null,parseLinkDestination:y2,parseLinkLabel:b2,parseLinkTitle:v2}),un={};un.code_inline=function(n,t,e,i,r){let o=n[t];return"<code"+r.renderAttrs(o)+">"+ei(o.content)+"</code>"};un.code_block=function(n,t,e,i,r){let o=n[t];return"<pre"+r.renderAttrs(o)+"><code>"+ei(n[t].content)+`</code></pre>
`};un.fence=function(n,t,e,i,r){let o=n[t],s=o.info?mr(o.info).trim():"",a="",l="";if(s){let u=s.split(/(\s+)/g);a=u[0],l=u.slice(2).join("")}let c;if(e.highlight?c=e.highlight(o.content,a,l)||ei(o.content):c=ei(o.content),c.indexOf("<pre")===0)return c+`
`;if(s){let u=o.attrIndex("class"),d=o.attrs?o.attrs.slice():[];u<0?d.push(["class",e.langPrefix+a]):(d[u]=d[u].slice(),d[u][1]+=" "+e.langPrefix+a);let h={attrs:d};return`<pre><code${r.renderAttrs(h)}>${c}</code></pre>
`}return`<pre><code${r.renderAttrs(o)}>${c}</code></pre>
`};un.image=function(n,t,e,i,r){let o=n[t];return o.attrs[o.attrIndex("alt")][1]=r.renderInlineAsText(o.children,e,i),r.renderToken(n,t,e)};un.hardbreak=function(n,t,e){return e.xhtmlOut?`<br />
`:`<br>
`};un.softbreak=function(n,t,e){return e.breaks?e.xhtmlOut?`<br />
`:`<br>
`:`
`};un.text=function(n,t){return ei(n[t].content)};un.html_block=function(n,t){return n[t].content};un.html_inline=function(n,t){return n[t].content};function gr(){this.rules=rl({},un)}gr.prototype.renderAttrs=function(t){let e,i,r;if(!t.attrs)return"";for(r="",e=0,i=t.attrs.length;e<i;e++)r+=" "+ei(t.attrs[e][0])+'="'+ei(t.attrs[e][1])+'"';return r};gr.prototype.renderToken=function(t,e,i){let r=t[e],o="";if(r.hidden)return"";r.block&&r.nesting!==-1&&e&&t[e-1].hidden&&(o+=`
`),o+=(r.nesting===-1?"</":"<")+r.tag,o+=this.renderAttrs(r),r.nesting===0&&i.xhtmlOut&&(o+=" /");let s=!1;if(r.block&&(s=!0,r.nesting===1&&e+1<t.length)){let a=t[e+1];(a.type==="inline"||a.hidden||a.nesting===-1&&a.tag===r.tag)&&(s=!1)}return o+=s?`>
`:">",o};gr.prototype.renderInline=function(n,t,e){let i="",r=this.rules;for(let o=0,s=n.length;o<s;o++){let a=n[o].type;typeof r[a]!="undefined"?i+=r[a](n,o,t,e,this):i+=this.renderToken(n,o,t)}return i};gr.prototype.renderInlineAsText=function(n,t,e){let i="";for(let r=0,o=n.length;r<o;r++)switch(n[r].type){case"text":i+=n[r].content;break;case"image":i+=this.renderInlineAsText(n[r].children,t,e);break;case"html_inline":case"html_block":i+=n[r].content;break;case"softbreak":case"hardbreak":i+=`
`;break}return i};gr.prototype.render=function(n,t,e){let i="",r=this.rules;for(let o=0,s=n.length;o<s;o++){let a=n[o].type;a==="inline"?i+=this.renderInline(n[o].children,t,e):typeof r[a]!="undefined"?i+=r[a](n,o,t,e,this):i+=this.renderToken(n,o,t,e)}return i};function St(){this.__rules__=[],this.__cache__=null}St.prototype.__find__=function(n){for(let t=0;t<this.__rules__.length;t++)if(this.__rules__[t].name===n)return t;return-1};St.prototype.__compile__=function(){let n=this,t=[""];n.__rules__.forEach(function(e){e.enabled&&e.alt.forEach(function(i){t.indexOf(i)<0&&t.push(i)})}),n.__cache__={},t.forEach(function(e){n.__cache__[e]=[],n.__rules__.forEach(function(i){i.enabled&&(e&&i.alt.indexOf(e)<0||n.__cache__[e].push(i.fn))})})};St.prototype.at=function(n,t,e){let i=this.__find__(n),r=e||{};if(i===-1)throw new Error("Parser rule not found: "+n);this.__rules__[i].fn=t,this.__rules__[i].alt=r.alt||[],this.__cache__=null};St.prototype.before=function(n,t,e,i){let r=this.__find__(n),o=i||{};if(r===-1)throw new Error("Parser rule not found: "+n);this.__rules__.splice(r,0,{name:t,enabled:!0,fn:e,alt:o.alt||[]}),this.__cache__=null};St.prototype.after=function(n,t,e,i){let r=this.__find__(n),o=i||{};if(r===-1)throw new Error("Parser rule not found: "+n);this.__rules__.splice(r+1,0,{name:t,enabled:!0,fn:e,alt:o.alt||[]}),this.__cache__=null};St.prototype.push=function(n,t,e){let i=e||{};this.__rules__.push({name:n,enabled:!0,fn:t,alt:i.alt||[]}),this.__cache__=null};St.prototype.enable=function(n,t){Array.isArray(n)||(n=[n]);let e=[];return n.forEach(function(i){let r=this.__find__(i);if(r<0){if(t)return;throw new Error("Rules manager: invalid rule name "+i)}this.__rules__[r].enabled=!0,e.push(i)},this),this.__cache__=null,e};St.prototype.enableOnly=function(n,t){Array.isArray(n)||(n=[n]),this.__rules__.forEach(function(e){e.enabled=!1}),this.enable(n,t)};St.prototype.disable=function(n,t){Array.isArray(n)||(n=[n]);let e=[];return n.forEach(function(i){let r=this.__find__(i);if(r<0){if(t)return;throw new Error("Rules manager: invalid rule name "+i)}this.__rules__[r].enabled=!1,e.push(i)},this),this.__cache__=null,e};St.prototype.getRules=function(n){return this.__cache__===null&&this.__compile__(),this.__cache__[n]||[]};function Jt(n,t,e){this.type=n,this.tag=t,this.attrs=null,this.map=null,this.nesting=e,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Jt.prototype.attrIndex=function(t){if(!this.attrs)return-1;let e=this.attrs;for(let i=0,r=e.length;i<r;i++)if(e[i][0]===t)return i;return-1};Jt.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]};Jt.prototype.attrSet=function(t,e){let i=this.attrIndex(t),r=[t,e];i<0?this.attrPush(r):this.attrs[i]=r};Jt.prototype.attrGet=function(t){let e=this.attrIndex(t),i=null;return e>=0&&(i=this.attrs[e][1]),i};Jt.prototype.attrJoin=function(t,e){let i=this.attrIndex(t);i<0?this.attrPush([t,e]):this.attrs[i][1]=this.attrs[i][1]+" "+e};function Jv(n,t,e){this.src=n,this.env=e,this.tokens=[],this.inlineMode=!1,this.md=t}Jv.prototype.Token=Jt;var x2=/\r\n?|\n/g,k2=/\0/g;function w2(n){let t;t=n.src.replace(x2,`
`),t=t.replace(k2,"\uFFFD"),n.src=t}function S2(n){let t;n.inlineMode?(t=new n.Token("inline","",0),t.content=n.src,t.map=[0,1],t.children=[],n.tokens.push(t)):n.md.block.parse(n.src,n.md,n.env,n.tokens)}function M2(n){let t=n.tokens;for(let e=0,i=t.length;e<i;e++){let r=t[e];r.type==="inline"&&n.md.inline.parse(r.content,n.md,n.env,r.children)}}function T2(n){return/^<a[>\s]/i.test(n)}function C2(n){return/^<\/a\s*>/i.test(n)}function L2(n){let t=n.tokens;if(n.md.options.linkify)for(let e=0,i=t.length;e<i;e++){if(t[e].type!=="inline"||!n.md.linkify.pretest(t[e].content))continue;let r=t[e].children,o=0;for(let s=r.length-1;s>=0;s--){let a=r[s];if(a.type==="link_close"){for(s--;r[s].level!==a.level&&r[s].type!=="link_open";)s--;continue}if(a.type==="html_inline"&&(T2(a.content)&&o>0&&o--,C2(a.content)&&o++),!(o>0)&&a.type==="text"&&n.md.linkify.test(a.content)){let l=a.content,c=n.md.linkify.match(l),u=[],d=a.level,h=0;c.length>0&&c[0].index===0&&s>0&&r[s-1].type==="text_special"&&(c=c.slice(1));for(let p=0;p<c.length;p++){let f=c[p].url,g=n.md.normalizeLink(f);if(!n.md.validateLink(g))continue;let m=c[p].text;c[p].schema?c[p].schema==="mailto:"&&!/^mailto:/i.test(m)?m=n.md.normalizeLinkText("mailto:"+m).replace(/^mailto:/,""):m=n.md.normalizeLinkText(m):m=n.md.normalizeLinkText("http://"+m).replace(/^http:\/\//,"");let b=c[p].index;if(b>h){let x=new n.Token("text","",0);x.content=l.slice(h,b),x.level=d,u.push(x)}let y=new n.Token("link_open","a",1);y.attrs=[["href",g]],y.level=d++,y.markup="linkify",y.info="auto",u.push(y);let v=new n.Token("text","",0);v.content=m,v.level=d,u.push(v);let E=new n.Token("link_close","a",-1);E.level=--d,E.markup="linkify",E.info="auto",u.push(E),h=c[p].lastIndex}if(h<l.length){let p=new n.Token("text","",0);p.content=l.slice(h),p.level=d,u.push(p)}t[e].children=r=Yv(r,s,u)}}}}var Zv=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,R2=/\((c|tm|r)\)/i,A2=/\((c|tm|r)\)/ig,I2={c:"\xA9",r:"\xAE",tm:"\u2122"};function N2(n,t){return I2[t.toLowerCase()]}function P2(n){let t=0;for(let e=n.length-1;e>=0;e--){let i=n[e];i.type==="text"&&!t&&(i.content=i.content.replace(A2,N2)),i.type==="link_open"&&i.info==="auto"&&t--,i.type==="link_close"&&i.info==="auto"&&t++}}function _2(n){let t=0;for(let e=n.length-1;e>=0;e--){let i=n[e];i.type==="text"&&!t&&Zv.test(i.content)&&(i.content=i.content.replace(/\+-/g,"\xB1").replace(/\.{2,}/g,"\u2026").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1\u2014").replace(/(^|\s)--(?=\s|$)/mg,"$1\u2013").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1\u2013")),i.type==="link_open"&&i.info==="auto"&&t--,i.type==="link_close"&&i.info==="auto"&&t++}}function O2(n){let t;if(n.md.options.typographer)for(t=n.tokens.length-1;t>=0;t--)n.tokens[t].type==="inline"&&(R2.test(n.tokens[t].content)&&P2(n.tokens[t].children),Zv.test(n.tokens[t].content)&&_2(n.tokens[t].children))}var D2=/['"]/,Fv=/['"]/g,Hv="\u2019";function tl(n,t,e){return n.slice(0,t)+e+n.slice(t+1)}function B2(n,t){let e,i=[];for(let r=0;r<n.length;r++){let o=n[r],s=n[r].level;for(e=i.length-1;e>=0&&!(i[e].level<=s);e--);if(i.length=e+1,o.type!=="text")continue;let a=o.content,l=0,c=a.length;e:for(;l<c;){Fv.lastIndex=l;let u=Fv.exec(a);if(!u)break;let d=!0,h=!0;l=u.index+1;let p=u[0]==="'",f=32;if(u.index-1>=0)f=a.charCodeAt(u.index-1);else for(e=r-1;e>=0&&!(n[e].type==="softbreak"||n[e].type==="hardbreak");e--)if(n[e].content){f=n[e].content.charCodeAt(n[e].content.length-1);break}let g=32;if(l<c)g=a.charCodeAt(l);else for(e=r+1;e<n.length&&!(n[e].type==="softbreak"||n[e].type==="hardbreak");e++)if(n[e].content){g=n[e].content.charCodeAt(0);break}let m=vo(f)||yo(String.fromCharCode(f)),b=vo(g)||yo(String.fromCharCode(g)),y=bo(f),v=bo(g);if(v?d=!1:b&&(y||m||(d=!1)),y?h=!1:m&&(v||b||(h=!1)),g===34&&u[0]==='"'&&f>=48&&f<=57&&(h=d=!1),d&&h&&(d=m,h=b),!d&&!h){p&&(o.content=tl(o.content,u.index,Hv));continue}if(h)for(e=i.length-1;e>=0;e--){let E=i[e];if(i[e].level<s)break;if(E.single===p&&i[e].level===s){E=i[e];let x,k;p?(x=t.md.options.quotes[2],k=t.md.options.quotes[3]):(x=t.md.options.quotes[0],k=t.md.options.quotes[1]),o.content=tl(o.content,u.index,k),n[E.token].content=tl(n[E.token].content,E.pos,x),l+=k.length-1,E.token===r&&(l+=x.length-1),a=o.content,c=a.length,i.length=e;continue e}}d?i.push({token:r,pos:u.index,single:p,level:s}):h&&p&&(o.content=tl(o.content,u.index,Hv))}}}function F2(n){if(n.md.options.typographer)for(let t=n.tokens.length-1;t>=0;t--)n.tokens[t].type!=="inline"||!D2.test(n.tokens[t].content)||B2(n.tokens[t].children,n)}function H2(n){let t,e,i=n.tokens,r=i.length;for(let o=0;o<r;o++){if(i[o].type!=="inline")continue;let s=i[o].children,a=s.length;for(t=0;t<a;t++)s[t].type==="text_special"&&(s[t].type="text");for(t=e=0;t<a;t++)s[t].type==="text"&&t+1<a&&s[t+1].type==="text"?s[t+1].content=s[t].content+s[t+1].content:(t!==e&&(s[e]=s[t]),e++);t!==e&&(s.length=e)}}var gh=[["normalize",w2],["block",S2],["inline",M2],["linkify",L2],["replacements",O2],["smartquotes",F2],["text_join",H2]];function wh(){this.ruler=new St;for(let n=0;n<gh.length;n++)this.ruler.push(gh[n][0],gh[n][1])}wh.prototype.process=function(n){let t=this.ruler.getRules("");for(let e=0,i=t.length;e<i;e++)t[e](n)};wh.prototype.State=Jv;function dn(n,t,e,i){this.src=n,this.md=t,this.env=e,this.tokens=i,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;let r=this.src;for(let o=0,s=0,a=0,l=0,c=r.length,u=!1;s<c;s++){let d=r.charCodeAt(s);if(!u)if(Ce(d)){a++,d===9?l+=4-l%4:l++;continue}else u=!0;(d===10||s===c-1)&&(d!==10&&s++,this.bMarks.push(o),this.eMarks.push(s),this.tShift.push(a),this.sCount.push(l),this.bsCount.push(0),u=!1,a=0,l=0,o=s+1)}this.bMarks.push(r.length),this.eMarks.push(r.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}dn.prototype.push=function(n,t,e){let i=new Jt(n,t,e);return i.block=!0,e<0&&this.level--,i.level=this.level,e>0&&this.level++,this.tokens.push(i),i};dn.prototype.isEmpty=function(t){return this.bMarks[t]+this.tShift[t]>=this.eMarks[t]};dn.prototype.skipEmptyLines=function(t){for(let e=this.lineMax;t<e&&!(this.bMarks[t]+this.tShift[t]<this.eMarks[t]);t++);return t};dn.prototype.skipSpaces=function(t){for(let e=this.src.length;t<e;t++){let i=this.src.charCodeAt(t);if(!Ce(i))break}return t};dn.prototype.skipSpacesBack=function(t,e){if(t<=e)return t;for(;t>e;)if(!Ce(this.src.charCodeAt(--t)))return t+1;return t};dn.prototype.skipChars=function(t,e){for(let i=this.src.length;t<i&&this.src.charCodeAt(t)===e;t++);return t};dn.prototype.skipCharsBack=function(t,e,i){if(t<=i)return t;for(;t>i;)if(e!==this.src.charCodeAt(--t))return t+1;return t};dn.prototype.getLines=function(t,e,i,r){if(t>=e)return"";let o=new Array(e-t);for(let s=0,a=t;a<e;a++,s++){let l=0,c=this.bMarks[a],u=c,d;for(a+1<e||r?d=this.eMarks[a]+1:d=this.eMarks[a];u<d&&l<i;){let h=this.src.charCodeAt(u);if(Ce(h))h===9?l+=4-(l+this.bsCount[a])%4:l++;else if(u-c<this.tShift[a])l++;else break;u++}l>i?o[s]=new Array(l-i+1).join(" ")+this.src.slice(u,d):o[s]=this.src.slice(u,d)}return o.join("")};dn.prototype.Token=Jt;var z2=65536;function bh(n,t){let e=n.bMarks[t]+n.tShift[t],i=n.eMarks[t];return n.src.slice(e,i)}function zv(n){let t=[],e=n.length,i=0,r=n.charCodeAt(i),o=!1,s=0,a="";for(;i<e;)r===124&&(o?(a+=n.substring(s,i-1),s=i):(t.push(a+n.substring(s,i)),a="",s=i+1)),o=r===92,i++,r=n.charCodeAt(i);return t.push(a+n.substring(s)),t}function V2(n,t,e,i){if(t+2>e)return!1;let r=t+1;if(n.sCount[r]<n.blkIndent||n.sCount[r]-n.blkIndent>=4)return!1;let o=n.bMarks[r]+n.tShift[r];if(o>=n.eMarks[r])return!1;let s=n.src.charCodeAt(o++);if(s!==124&&s!==45&&s!==58||o>=n.eMarks[r])return!1;let a=n.src.charCodeAt(o++);if(a!==124&&a!==45&&a!==58&&!Ce(a)||s===45&&Ce(a))return!1;for(;o<n.eMarks[r];){let E=n.src.charCodeAt(o);if(E!==124&&E!==45&&E!==58&&!Ce(E))return!1;o++}let l=bh(n,t+1),c=l.split("|"),u=[];for(let E=0;E<c.length;E++){let x=c[E].trim();if(!x){if(E===0||E===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(x))return!1;x.charCodeAt(x.length-1)===58?u.push(x.charCodeAt(0)===58?"center":"right"):x.charCodeAt(0)===58?u.push("left"):u.push("")}if(l=bh(n,t).trim(),l.indexOf("|")===-1||n.sCount[t]-n.blkIndent>=4)return!1;c=zv(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop();let d=c.length;if(d===0||d!==u.length)return!1;if(i)return!0;let h=n.parentType;n.parentType="table";let p=n.md.block.ruler.getRules("blockquote"),f=n.push("table_open","table",1),g=[t,0];f.map=g;let m=n.push("thead_open","thead",1);m.map=[t,t+1];let b=n.push("tr_open","tr",1);b.map=[t,t+1];for(let E=0;E<c.length;E++){let x=n.push("th_open","th",1);u[E]&&(x.attrs=[["style","text-align:"+u[E]]]);let k=n.push("inline","",0);k.content=c[E].trim(),k.children=[],n.push("th_close","th",-1)}n.push("tr_close","tr",-1),n.push("thead_close","thead",-1);let y,v=0;for(r=t+2;r<e&&!(n.sCount[r]<n.blkIndent);r++){let E=!1;for(let k=0,S=p.length;k<S;k++)if(p[k](n,r,e,!0)){E=!0;break}if(E||(l=bh(n,r).trim(),!l)||n.sCount[r]-n.blkIndent>=4||(c=zv(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop(),v+=d-c.length,v>z2))break;if(r===t+2){let k=n.push("tbody_open","tbody",1);k.map=y=[t+2,0]}let x=n.push("tr_open","tr",1);x.map=[r,r+1];for(let k=0;k<d;k++){let S=n.push("td_open","td",1);u[k]&&(S.attrs=[["style","text-align:"+u[k]]]);let w=n.push("inline","",0);w.content=c[k]?c[k].trim():"",w.children=[],n.push("td_close","td",-1)}n.push("tr_close","tr",-1)}return y&&(n.push("tbody_close","tbody",-1),y[1]=r),n.push("table_close","table",-1),g[1]=r,n.parentType=h,n.line=r,!0}function $2(n,t,e){if(n.sCount[t]-n.blkIndent<4)return!1;let i=t+1,r=i;for(;i<e;){if(n.isEmpty(i)){i++;continue}if(n.sCount[i]-n.blkIndent>=4){i++,r=i;continue}break}n.line=r;let o=n.push("code_block","code",0);return o.content=n.getLines(t,r,4+n.blkIndent,!1)+`
`,o.map=[t,n.line],!0}function W2(n,t,e,i){let r=n.bMarks[t]+n.tShift[t],o=n.eMarks[t];if(n.sCount[t]-n.blkIndent>=4||r+3>o)return!1;let s=n.src.charCodeAt(r);if(s!==126&&s!==96)return!1;let a=r;r=n.skipChars(r,s);let l=r-a;if(l<3)return!1;let c=n.src.slice(a,r),u=n.src.slice(r,o);if(s===96&&u.indexOf(String.fromCharCode(s))>=0)return!1;if(i)return!0;let d=t,h=!1;for(;d++,!(d>=e||(r=a=n.bMarks[d]+n.tShift[d],o=n.eMarks[d],r<o&&n.sCount[d]<n.blkIndent));)if(n.src.charCodeAt(r)===s&&!(n.sCount[d]-n.blkIndent>=4)&&(r=n.skipChars(r,s),!(r-a<l)&&(r=n.skipSpaces(r),!(r<o)))){h=!0;break}l=n.sCount[t],n.line=d+(h?1:0);let p=n.push("fence","code",0);return p.info=u,p.content=n.getLines(t+1,d,l,!0),p.markup=c,p.map=[t,n.line],!0}function U2(n,t,e,i){let r=n.bMarks[t]+n.tShift[t],o=n.eMarks[t],s=n.lineMax;if(n.sCount[t]-n.blkIndent>=4||n.src.charCodeAt(r)!==62)return!1;if(i)return!0;let a=[],l=[],c=[],u=[],d=n.md.block.ruler.getRules("blockquote"),h=n.parentType;n.parentType="blockquote";let p=!1,f;for(f=t;f<e;f++){let v=n.sCount[f]<n.blkIndent;if(r=n.bMarks[f]+n.tShift[f],o=n.eMarks[f],r>=o)break;if(n.src.charCodeAt(r++)===62&&!v){let x=n.sCount[f]+1,k,S;n.src.charCodeAt(r)===32?(r++,x++,S=!1,k=!0):n.src.charCodeAt(r)===9?(k=!0,(n.bsCount[f]+x)%4===3?(r++,x++,S=!1):S=!0):k=!1;let w=x;for(a.push(n.bMarks[f]),n.bMarks[f]=r;r<o;){let C=n.src.charCodeAt(r);if(Ce(C))C===9?w+=4-(w+n.bsCount[f]+(S?1:0))%4:w++;else break;r++}p=r>=o,l.push(n.bsCount[f]),n.bsCount[f]=n.sCount[f]+1+(k?1:0),c.push(n.sCount[f]),n.sCount[f]=w-x,u.push(n.tShift[f]),n.tShift[f]=r-n.bMarks[f];continue}if(p)break;let E=!1;for(let x=0,k=d.length;x<k;x++)if(d[x](n,f,e,!0)){E=!0;break}if(E){n.lineMax=f,n.blkIndent!==0&&(a.push(n.bMarks[f]),l.push(n.bsCount[f]),u.push(n.tShift[f]),c.push(n.sCount[f]),n.sCount[f]-=n.blkIndent);break}a.push(n.bMarks[f]),l.push(n.bsCount[f]),u.push(n.tShift[f]),c.push(n.sCount[f]),n.sCount[f]=-1}let g=n.blkIndent;n.blkIndent=0;let m=n.push("blockquote_open","blockquote",1);m.markup=">";let b=[t,0];m.map=b,n.md.block.tokenize(n,t,f);let y=n.push("blockquote_close","blockquote",-1);y.markup=">",n.lineMax=s,n.parentType=h,b[1]=n.line;for(let v=0;v<u.length;v++)n.bMarks[v+t]=a[v],n.tShift[v+t]=u[v],n.sCount[v+t]=c[v],n.bsCount[v+t]=l[v];return n.blkIndent=g,!0}function K2(n,t,e,i){let r=n.eMarks[t];if(n.sCount[t]-n.blkIndent>=4)return!1;let o=n.bMarks[t]+n.tShift[t],s=n.src.charCodeAt(o++);if(s!==42&&s!==45&&s!==95)return!1;let a=1;for(;o<r;){let c=n.src.charCodeAt(o++);if(c!==s&&!Ce(c))return!1;c===s&&a++}if(a<3)return!1;if(i)return!0;n.line=t+1;let l=n.push("hr","hr",0);return l.map=[t,n.line],l.markup=Array(a+1).join(String.fromCharCode(s)),!0}function Vv(n,t){let e=n.eMarks[t],i=n.bMarks[t]+n.tShift[t],r=n.src.charCodeAt(i++);if(r!==42&&r!==45&&r!==43)return-1;if(i<e){let o=n.src.charCodeAt(i);if(!Ce(o))return-1}return i}function $v(n,t){let e=n.bMarks[t]+n.tShift[t],i=n.eMarks[t],r=e;if(r+1>=i)return-1;let o=n.src.charCodeAt(r++);if(o<48||o>57)return-1;for(;;){if(r>=i)return-1;if(o=n.src.charCodeAt(r++),o>=48&&o<=57){if(r-e>=10)return-1;continue}if(o===41||o===46)break;return-1}return r<i&&(o=n.src.charCodeAt(r),!Ce(o))?-1:r}function q2(n,t){let e=n.level+2;for(let i=t+2,r=n.tokens.length-2;i<r;i++)n.tokens[i].level===e&&n.tokens[i].type==="paragraph_open"&&(n.tokens[i+2].hidden=!0,n.tokens[i].hidden=!0,i+=2)}function G2(n,t,e,i){let r,o,s,a,l=t,c=!0;if(n.sCount[l]-n.blkIndent>=4||n.listIndent>=0&&n.sCount[l]-n.listIndent>=4&&n.sCount[l]<n.blkIndent)return!1;let u=!1;i&&n.parentType==="paragraph"&&n.sCount[l]>=n.blkIndent&&(u=!0);let d,h,p;if((p=$v(n,l))>=0){if(d=!0,s=n.bMarks[l]+n.tShift[l],h=Number(n.src.slice(s,p-1)),u&&h!==1)return!1}else if((p=Vv(n,l))>=0)d=!1;else return!1;if(u&&n.skipSpaces(p)>=n.eMarks[l])return!1;if(i)return!0;let f=n.src.charCodeAt(p-1),g=n.tokens.length;d?(a=n.push("ordered_list_open","ol",1),h!==1&&(a.attrs=[["start",h]])):a=n.push("bullet_list_open","ul",1);let m=[l,0];a.map=m,a.markup=String.fromCharCode(f);let b=!1,y=n.md.block.ruler.getRules("list"),v=n.parentType;for(n.parentType="list";l<e;){o=p,r=n.eMarks[l];let E=n.sCount[l]+p-(n.bMarks[l]+n.tShift[l]),x=E;for(;o<r;){let P=n.src.charCodeAt(o);if(P===9)x+=4-(x+n.bsCount[l])%4;else if(P===32)x++;else break;o++}let k=o,S;k>=r?S=1:S=x-E,S>4&&(S=1);let w=E+S;a=n.push("list_item_open","li",1),a.markup=String.fromCharCode(f);let C=[l,0];a.map=C,d&&(a.info=n.src.slice(s,p-1));let I=n.tight,F=n.tShift[l],N=n.sCount[l],H=n.listIndent;if(n.listIndent=n.blkIndent,n.blkIndent=w,n.tight=!0,n.tShift[l]=k-n.bMarks[l],n.sCount[l]=x,k>=r&&n.isEmpty(l+1)?n.line=Math.min(n.line+2,e):n.md.block.tokenize(n,l,e,!0),(!n.tight||b)&&(c=!1),b=n.line-l>1&&n.isEmpty(n.line-1),n.blkIndent=n.listIndent,n.listIndent=H,n.tShift[l]=F,n.sCount[l]=N,n.tight=I,a=n.push("list_item_close","li",-1),a.markup=String.fromCharCode(f),l=n.line,C[1]=l,l>=e||n.sCount[l]<n.blkIndent||n.sCount[l]-n.blkIndent>=4)break;let _=!1;for(let P=0,L=y.length;P<L;P++)if(y[P](n,l,e,!0)){_=!0;break}if(_)break;if(d){if(p=$v(n,l),p<0)break;s=n.bMarks[l]+n.tShift[l]}else if(p=Vv(n,l),p<0)break;if(f!==n.src.charCodeAt(p-1))break}return d?a=n.push("ordered_list_close","ol",-1):a=n.push("bullet_list_close","ul",-1),a.markup=String.fromCharCode(f),m[1]=l,n.line=l,n.parentType=v,c&&q2(n,g),!0}function j2(n,t,e,i){let r=n.bMarks[t]+n.tShift[t],o=n.eMarks[t],s=t+1;if(n.sCount[t]-n.blkIndent>=4||n.src.charCodeAt(r)!==91)return!1;function a(y){let v=n.lineMax;if(y>=v||n.isEmpty(y))return null;let E=!1;if(n.sCount[y]-n.blkIndent>3&&(E=!0),n.sCount[y]<0&&(E=!0),!E){let S=n.md.block.ruler.getRules("reference"),w=n.parentType;n.parentType="reference";let C=!1;for(let I=0,F=S.length;I<F;I++)if(S[I](n,y,v,!0)){C=!0;break}if(n.parentType=w,C)return null}let x=n.bMarks[y]+n.tShift[y],k=n.eMarks[y];return n.src.slice(x,k+1)}let l=n.src.slice(r,o+1);o=l.length;let c=-1;for(r=1;r<o;r++){let y=l.charCodeAt(r);if(y===91)return!1;if(y===93){c=r;break}else if(y===10){let v=a(s);v!==null&&(l+=v,o=l.length,s++)}else if(y===92&&(r++,r<o&&l.charCodeAt(r)===10)){let v=a(s);v!==null&&(l+=v,o=l.length,s++)}}if(c<0||l.charCodeAt(c+1)!==58)return!1;for(r=c+2;r<o;r++){let y=l.charCodeAt(r);if(y===10){let v=a(s);v!==null&&(l+=v,o=l.length,s++)}else if(!Ce(y))break}let u=n.md.helpers.parseLinkDestination(l,r,o);if(!u.ok)return!1;let d=n.md.normalizeLink(u.str);if(!n.md.validateLink(d))return!1;r=u.pos;let h=r,p=s,f=r;for(;r<o;r++){let y=l.charCodeAt(r);if(y===10){let v=a(s);v!==null&&(l+=v,o=l.length,s++)}else if(!Ce(y))break}let g=n.md.helpers.parseLinkTitle(l,r,o);for(;g.can_continue;){let y=a(s);if(y===null)break;l+=y,r=o,o=l.length,s++,g=n.md.helpers.parseLinkTitle(l,r,o,g)}let m;for(r<o&&f!==r&&g.ok?(m=g.str,r=g.pos):(m="",r=h,s=p);r<o;){let y=l.charCodeAt(r);if(!Ce(y))break;r++}if(r<o&&l.charCodeAt(r)!==10&&m)for(m="",r=h,s=p;r<o;){let y=l.charCodeAt(r);if(!Ce(y))break;r++}if(r<o&&l.charCodeAt(r)!==10)return!1;let b=ol(l.slice(1,c));return b?(i||(typeof n.env.references=="undefined"&&(n.env.references={}),typeof n.env.references[b]=="undefined"&&(n.env.references[b]={title:m,href:d}),n.line=s),!0):!1}var Y2=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],X2="[a-zA-Z_:][a-zA-Z0-9:._-]*",J2="[^\"'=<>`\\x00-\\x20]+",Z2="'[^']*'",Q2='"[^"]*"',eI="(?:"+J2+"|"+Z2+"|"+Q2+")",tI="(?:\\s+"+X2+"(?:\\s*=\\s*"+eI+")?)",Qv="<[A-Za-z][A-Za-z0-9\\-]*"+tI+"*\\s*\\/?>",eE="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",nI="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",iI="<[?][\\s\\S]*?[?]>",rI="<![A-Za-z][^>]*>",oI="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",sI=new RegExp("^(?:"+Qv+"|"+eE+"|"+nI+"|"+iI+"|"+rI+"|"+oI+")"),aI=new RegExp("^(?:"+Qv+"|"+eE+")"),fr=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+Y2.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(aI.source+"\\s*$"),/^$/,!1]];function lI(n,t,e,i){let r=n.bMarks[t]+n.tShift[t],o=n.eMarks[t];if(n.sCount[t]-n.blkIndent>=4||!n.md.options.html||n.src.charCodeAt(r)!==60)return!1;let s=n.src.slice(r,o),a=0;for(;a<fr.length&&!fr[a][0].test(s);a++);if(a===fr.length)return!1;if(i)return fr[a][2];let l=t+1;if(!fr[a][1].test(s)){for(;l<e&&!(n.sCount[l]<n.blkIndent);l++)if(r=n.bMarks[l]+n.tShift[l],o=n.eMarks[l],s=n.src.slice(r,o),fr[a][1].test(s)){s.length!==0&&l++;break}}n.line=l;let c=n.push("html_block","",0);return c.map=[t,l],c.content=n.getLines(t,l,n.blkIndent,!0),!0}function cI(n,t,e,i){let r=n.bMarks[t]+n.tShift[t],o=n.eMarks[t];if(n.sCount[t]-n.blkIndent>=4)return!1;let s=n.src.charCodeAt(r);if(s!==35||r>=o)return!1;let a=1;for(s=n.src.charCodeAt(++r);s===35&&r<o&&a<=6;)a++,s=n.src.charCodeAt(++r);if(a>6||r<o&&!Ce(s))return!1;if(i)return!0;o=n.skipSpacesBack(o,r);let l=n.skipCharsBack(o,35,r);l>r&&Ce(n.src.charCodeAt(l-1))&&(o=l),n.line=t+1;let c=n.push("heading_open","h"+String(a),1);c.markup="########".slice(0,a),c.map=[t,n.line];let u=n.push("inline","",0);u.content=n.src.slice(r,o).trim(),u.map=[t,n.line],u.children=[];let d=n.push("heading_close","h"+String(a),-1);return d.markup="########".slice(0,a),!0}function uI(n,t,e){let i=n.md.block.ruler.getRules("paragraph");if(n.sCount[t]-n.blkIndent>=4)return!1;let r=n.parentType;n.parentType="paragraph";let o=0,s,a=t+1;for(;a<e&&!n.isEmpty(a);a++){if(n.sCount[a]-n.blkIndent>3)continue;if(n.sCount[a]>=n.blkIndent){let p=n.bMarks[a]+n.tShift[a],f=n.eMarks[a];if(p<f&&(s=n.src.charCodeAt(p),(s===45||s===61)&&(p=n.skipChars(p,s),p=n.skipSpaces(p),p>=f))){o=s===61?1:2;break}}if(n.sCount[a]<0)continue;let h=!1;for(let p=0,f=i.length;p<f;p++)if(i[p](n,a,e,!0)){h=!0;break}if(h)break}if(!o)return!1;let l=n.getLines(t,a,n.blkIndent,!1).trim();n.line=a+1;let c=n.push("heading_open","h"+String(o),1);c.markup=String.fromCharCode(s),c.map=[t,n.line];let u=n.push("inline","",0);u.content=l,u.map=[t,n.line-1],u.children=[];let d=n.push("heading_close","h"+String(o),-1);return d.markup=String.fromCharCode(s),n.parentType=r,!0}function dI(n,t,e){let i=n.md.block.ruler.getRules("paragraph"),r=n.parentType,o=t+1;for(n.parentType="paragraph";o<e&&!n.isEmpty(o);o++){if(n.sCount[o]-n.blkIndent>3||n.sCount[o]<0)continue;let c=!1;for(let u=0,d=i.length;u<d;u++)if(i[u](n,o,e,!0)){c=!0;break}if(c)break}let s=n.getLines(t,o,n.blkIndent,!1).trim();n.line=o;let a=n.push("paragraph_open","p",1);a.map=[t,n.line];let l=n.push("inline","",0);return l.content=s,l.map=[t,n.line],l.children=[],n.push("paragraph_close","p",-1),n.parentType=r,!0}var nl=[["table",V2,["paragraph","reference"]],["code",$2],["fence",W2,["paragraph","reference","blockquote","list"]],["blockquote",U2,["paragraph","reference","blockquote","list"]],["hr",K2,["paragraph","reference","blockquote","list"]],["list",G2,["paragraph","reference","blockquote"]],["reference",j2],["html_block",lI,["paragraph","reference","blockquote"]],["heading",cI,["paragraph","reference","blockquote"]],["lheading",uI],["paragraph",dI]];function sl(){this.ruler=new St;for(let n=0;n<nl.length;n++)this.ruler.push(nl[n][0],nl[n][1],{alt:(nl[n][2]||[]).slice()})}sl.prototype.tokenize=function(n,t,e){let i=this.ruler.getRules(""),r=i.length,o=n.md.options.maxNesting,s=t,a=!1;for(;s<e&&(n.line=s=n.skipEmptyLines(s),!(s>=e||n.sCount[s]<n.blkIndent));){if(n.level>=o){n.line=e;break}let l=n.line,c=!1;for(let u=0;u<r;u++)if(c=i[u](n,s,e,!1),c){if(l>=n.line)throw new Error("block rule didn't increment state.line");break}if(!c)throw new Error("none of the block rules matched");n.tight=!a,n.isEmpty(n.line-1)&&(a=!0),s=n.line,s<e&&n.isEmpty(s)&&(a=!0,s++,n.line=s)}};sl.prototype.parse=function(n,t,e,i){if(!n)return;let r=new this.State(n,t,e,i);this.tokenize(r,r.line,r.lineMax)};sl.prototype.State=dn;function Eo(n,t,e,i){this.src=n,this.env=e,this.md=t,this.tokens=i,this.tokens_meta=Array(i.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}Eo.prototype.pushPending=function(){let n=new Jt("text","",0);return n.content=this.pending,n.level=this.pendingLevel,this.tokens.push(n),this.pending="",n};Eo.prototype.push=function(n,t,e){this.pending&&this.pushPending();let i=new Jt(n,t,e),r=null;return e<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),i.level=this.level,e>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],r={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(i),this.tokens_meta.push(r),i};Eo.prototype.scanDelims=function(n,t){let e=this.posMax,i=this.src.charCodeAt(n),r=n>0?this.src.charCodeAt(n-1):32,o=n;for(;o<e&&this.src.charCodeAt(o)===i;)o++;let s=o-n,a=o<e?this.src.charCodeAt(o):32,l=vo(r)||yo(String.fromCharCode(r)),c=vo(a)||yo(String.fromCharCode(a)),u=bo(r),d=bo(a),h=!d&&(!c||u||l),p=!u&&(!l||d||c);return{can_open:h&&(t||!p||l),can_close:p&&(t||!h||c),length:s}};Eo.prototype.Token=Jt;function hI(n){switch(n){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function pI(n,t){let e=n.pos;for(;e<n.posMax&&!hI(n.src.charCodeAt(e));)e++;return e===n.pos?!1:(t||(n.pending+=n.src.slice(n.pos,e)),n.pos=e,!0)}var fI=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function mI(n,t){if(!n.md.options.linkify||n.linkLevel>0)return!1;let e=n.pos,i=n.posMax;if(e+3>i||n.src.charCodeAt(e)!==58||n.src.charCodeAt(e+1)!==47||n.src.charCodeAt(e+2)!==47)return!1;let r=n.pending.match(fI);if(!r)return!1;let o=r[1],s=n.md.linkify.matchAtStart(n.src.slice(e-o.length));if(!s)return!1;let a=s.url;if(a.length<=o.length)return!1;a=a.replace(/\*+$/,"");let l=n.md.normalizeLink(a);if(!n.md.validateLink(l))return!1;if(!t){n.pending=n.pending.slice(0,-o.length);let c=n.push("link_open","a",1);c.attrs=[["href",l]],c.markup="linkify",c.info="auto";let u=n.push("text","",0);u.content=n.md.normalizeLinkText(a);let d=n.push("link_close","a",-1);d.markup="linkify",d.info="auto"}return n.pos+=a.length-o.length,!0}function gI(n,t){let e=n.pos;if(n.src.charCodeAt(e)!==10)return!1;let i=n.pending.length-1,r=n.posMax;if(!t)if(i>=0&&n.pending.charCodeAt(i)===32)if(i>=1&&n.pending.charCodeAt(i-1)===32){let o=i-1;for(;o>=1&&n.pending.charCodeAt(o-1)===32;)o--;n.pending=n.pending.slice(0,o),n.push("hardbreak","br",0)}else n.pending=n.pending.slice(0,-1),n.push("softbreak","br",0);else n.push("softbreak","br",0);for(e++;e<r&&Ce(n.src.charCodeAt(e));)e++;return n.pos=e,!0}var Sh=[];for(let n=0;n<256;n++)Sh.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(n){Sh[n.charCodeAt(0)]=1});function bI(n,t){let e=n.pos,i=n.posMax;if(n.src.charCodeAt(e)!==92||(e++,e>=i))return!1;let r=n.src.charCodeAt(e);if(r===10){for(t||n.push("hardbreak","br",0),e++;e<i&&(r=n.src.charCodeAt(e),!!Ce(r));)e++;return n.pos=e,!0}let o=n.src[e];if(r>=55296&&r<=56319&&e+1<i){let a=n.src.charCodeAt(e+1);a>=56320&&a<=57343&&(o+=n.src[e+1],e++)}let s="\\"+o;if(!t){let a=n.push("text_special","",0);r<256&&Sh[r]!==0?a.content=o:a.content=s,a.markup=s,a.info="escape"}return n.pos=e+1,!0}function yI(n,t){let e=n.pos;if(n.src.charCodeAt(e)!==96)return!1;let r=e;e++;let o=n.posMax;for(;e<o&&n.src.charCodeAt(e)===96;)e++;let s=n.src.slice(r,e),a=s.length;if(n.backticksScanned&&(n.backticks[a]||0)<=r)return t||(n.pending+=s),n.pos+=a,!0;let l=e,c;for(;(c=n.src.indexOf("`",l))!==-1;){for(l=c+1;l<o&&n.src.charCodeAt(l)===96;)l++;let u=l-c;if(u===a){if(!t){let d=n.push("code_inline","code",0);d.markup=s,d.content=n.src.slice(e,c).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return n.pos=l,!0}n.backticks[u]=c}return n.backticksScanned=!0,t||(n.pending+=s),n.pos+=a,!0}function vI(n,t){let e=n.pos,i=n.src.charCodeAt(e);if(t||i!==126)return!1;let r=n.scanDelims(n.pos,!0),o=r.length,s=String.fromCharCode(i);if(o<2)return!1;let a;o%2&&(a=n.push("text","",0),a.content=s,o--);for(let l=0;l<o;l+=2)a=n.push("text","",0),a.content=s+s,n.delimiters.push({marker:i,length:0,token:n.tokens.length-1,end:-1,open:r.can_open,close:r.can_close});return n.pos+=r.length,!0}function Wv(n,t){let e,i=[],r=t.length;for(let o=0;o<r;o++){let s=t[o];if(s.marker!==126||s.end===-1)continue;let a=t[s.end];e=n.tokens[s.token],e.type="s_open",e.tag="s",e.nesting=1,e.markup="~~",e.content="",e=n.tokens[a.token],e.type="s_close",e.tag="s",e.nesting=-1,e.markup="~~",e.content="",n.tokens[a.token-1].type==="text"&&n.tokens[a.token-1].content==="~"&&i.push(a.token-1)}for(;i.length;){let o=i.pop(),s=o+1;for(;s<n.tokens.length&&n.tokens[s].type==="s_close";)s++;s--,o!==s&&(e=n.tokens[s],n.tokens[s]=n.tokens[o],n.tokens[o]=e)}}function EI(n){let t=n.tokens_meta,e=n.tokens_meta.length;Wv(n,n.delimiters);for(let i=0;i<e;i++)t[i]&&t[i].delimiters&&Wv(n,t[i].delimiters)}var tE={tokenize:vI,postProcess:EI};function xI(n,t){let e=n.pos,i=n.src.charCodeAt(e);if(t||i!==95&&i!==42)return!1;let r=n.scanDelims(n.pos,i===42);for(let o=0;o<r.length;o++){let s=n.push("text","",0);s.content=String.fromCharCode(i),n.delimiters.push({marker:i,length:r.length,token:n.tokens.length-1,end:-1,open:r.can_open,close:r.can_close})}return n.pos+=r.length,!0}function Uv(n,t){let e=t.length;for(let i=e-1;i>=0;i--){let r=t[i];if(r.marker!==95&&r.marker!==42||r.end===-1)continue;let o=t[r.end],s=i>0&&t[i-1].end===r.end+1&&t[i-1].marker===r.marker&&t[i-1].token===r.token-1&&t[r.end+1].token===o.token+1,a=String.fromCharCode(r.marker),l=n.tokens[r.token];l.type=s?"strong_open":"em_open",l.tag=s?"strong":"em",l.nesting=1,l.markup=s?a+a:a,l.content="";let c=n.tokens[o.token];c.type=s?"strong_close":"em_close",c.tag=s?"strong":"em",c.nesting=-1,c.markup=s?a+a:a,c.content="",s&&(n.tokens[t[i-1].token].content="",n.tokens[t[r.end+1].token].content="",i--)}}function kI(n){let t=n.tokens_meta,e=n.tokens_meta.length;Uv(n,n.delimiters);for(let i=0;i<e;i++)t[i]&&t[i].delimiters&&Uv(n,t[i].delimiters)}var nE={tokenize:xI,postProcess:kI};function wI(n,t){let e,i,r,o,s="",a="",l=n.pos,c=!0;if(n.src.charCodeAt(n.pos)!==91)return!1;let u=n.pos,d=n.posMax,h=n.pos+1,p=n.md.helpers.parseLinkLabel(n,n.pos,!0);if(p<0)return!1;let f=p+1;if(f<d&&n.src.charCodeAt(f)===40){for(c=!1,f++;f<d&&(e=n.src.charCodeAt(f),!(!Ce(e)&&e!==10));f++);if(f>=d)return!1;if(l=f,r=n.md.helpers.parseLinkDestination(n.src,f,n.posMax),r.ok){for(s=n.md.normalizeLink(r.str),n.md.validateLink(s)?f=r.pos:s="",l=f;f<d&&(e=n.src.charCodeAt(f),!(!Ce(e)&&e!==10));f++);if(r=n.md.helpers.parseLinkTitle(n.src,f,n.posMax),f<d&&l!==f&&r.ok)for(a=r.str,f=r.pos;f<d&&(e=n.src.charCodeAt(f),!(!Ce(e)&&e!==10));f++);}(f>=d||n.src.charCodeAt(f)!==41)&&(c=!0),f++}if(c){if(typeof n.env.references=="undefined")return!1;if(f<d&&n.src.charCodeAt(f)===91?(l=f+1,f=n.md.helpers.parseLinkLabel(n,f),f>=0?i=n.src.slice(l,f++):f=p+1):f=p+1,i||(i=n.src.slice(h,p)),o=n.env.references[ol(i)],!o)return n.pos=u,!1;s=o.href,a=o.title}if(!t){n.pos=h,n.posMax=p;let g=n.push("link_open","a",1),m=[["href",s]];g.attrs=m,a&&m.push(["title",a]),n.linkLevel++,n.md.inline.tokenize(n),n.linkLevel--,n.push("link_close","a",-1)}return n.pos=f,n.posMax=d,!0}function SI(n,t){let e,i,r,o,s,a,l,c,u="",d=n.pos,h=n.posMax;if(n.src.charCodeAt(n.pos)!==33||n.src.charCodeAt(n.pos+1)!==91)return!1;let p=n.pos+2,f=n.md.helpers.parseLinkLabel(n,n.pos+1,!1);if(f<0)return!1;if(o=f+1,o<h&&n.src.charCodeAt(o)===40){for(o++;o<h&&(e=n.src.charCodeAt(o),!(!Ce(e)&&e!==10));o++);if(o>=h)return!1;for(c=o,a=n.md.helpers.parseLinkDestination(n.src,o,n.posMax),a.ok&&(u=n.md.normalizeLink(a.str),n.md.validateLink(u)?o=a.pos:u=""),c=o;o<h&&(e=n.src.charCodeAt(o),!(!Ce(e)&&e!==10));o++);if(a=n.md.helpers.parseLinkTitle(n.src,o,n.posMax),o<h&&c!==o&&a.ok)for(l=a.str,o=a.pos;o<h&&(e=n.src.charCodeAt(o),!(!Ce(e)&&e!==10));o++);else l="";if(o>=h||n.src.charCodeAt(o)!==41)return n.pos=d,!1;o++}else{if(typeof n.env.references=="undefined")return!1;if(o<h&&n.src.charCodeAt(o)===91?(c=o+1,o=n.md.helpers.parseLinkLabel(n,o),o>=0?r=n.src.slice(c,o++):o=f+1):o=f+1,r||(r=n.src.slice(p,f)),s=n.env.references[ol(r)],!s)return n.pos=d,!1;u=s.href,l=s.title}if(!t){i=n.src.slice(p,f);let g=[];n.md.inline.parse(i,n.md,n.env,g);let m=n.push("image","img",0),b=[["src",u],["alt",""]];m.attrs=b,m.children=g,m.content=i,l&&b.push(["title",l])}return n.pos=o,n.posMax=h,!0}var MI=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,TI=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function CI(n,t){let e=n.pos;if(n.src.charCodeAt(e)!==60)return!1;let i=n.pos,r=n.posMax;for(;;){if(++e>=r)return!1;let s=n.src.charCodeAt(e);if(s===60)return!1;if(s===62)break}let o=n.src.slice(i+1,e);if(TI.test(o)){let s=n.md.normalizeLink(o);if(!n.md.validateLink(s))return!1;if(!t){let a=n.push("link_open","a",1);a.attrs=[["href",s]],a.markup="autolink",a.info="auto";let l=n.push("text","",0);l.content=n.md.normalizeLinkText(o);let c=n.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return n.pos+=o.length+2,!0}if(MI.test(o)){let s=n.md.normalizeLink("mailto:"+o);if(!n.md.validateLink(s))return!1;if(!t){let a=n.push("link_open","a",1);a.attrs=[["href",s]],a.markup="autolink",a.info="auto";let l=n.push("text","",0);l.content=n.md.normalizeLinkText(o);let c=n.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return n.pos+=o.length+2,!0}return!1}function LI(n){return/^<a[>\s]/i.test(n)}function RI(n){return/^<\/a\s*>/i.test(n)}function AI(n){let t=n|32;return t>=97&&t<=122}function II(n,t){if(!n.md.options.html)return!1;let e=n.posMax,i=n.pos;if(n.src.charCodeAt(i)!==60||i+2>=e)return!1;let r=n.src.charCodeAt(i+1);if(r!==33&&r!==63&&r!==47&&!AI(r))return!1;let o=n.src.slice(i).match(sI);if(!o)return!1;if(!t){let s=n.push("html_inline","",0);s.content=o[0],LI(s.content)&&n.linkLevel++,RI(s.content)&&n.linkLevel--}return n.pos+=o[0].length,!0}var NI=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,PI=/^&([a-z][a-z0-9]{1,31});/i;function _I(n,t){let e=n.pos,i=n.posMax;if(n.src.charCodeAt(e)!==38||e+1>=i)return!1;if(n.src.charCodeAt(e+1)===35){let o=n.src.slice(e).match(NI);if(o){if(!t){let s=o[1][0].toLowerCase()==="x"?parseInt(o[1].slice(1),16):parseInt(o[1],10),a=n.push("text_special","",0);a.content=kh(s)?il(s):il(65533),a.markup=o[0],a.info="entity"}return n.pos+=o[0].length,!0}}else{let o=n.src.slice(e).match(PI);if(o){let s=qv.decodeHTML(o[0]);if(s!==o[0]){if(!t){let a=n.push("text_special","",0);a.content=s,a.markup=o[0],a.info="entity"}return n.pos+=o[0].length,!0}}}return!1}function Kv(n){let t={},e=n.length;if(!e)return;let i=0,r=-2,o=[];for(let s=0;s<e;s++){let a=n[s];if(o.push(0),(n[i].marker!==a.marker||r!==a.token-1)&&(i=s),r=a.token,a.length=a.length||0,!a.close)continue;t.hasOwnProperty(a.marker)||(t[a.marker]=[-1,-1,-1,-1,-1,-1]);let l=t[a.marker][(a.open?3:0)+a.length%3],c=i-o[i]-1,u=c;for(;c>l;c-=o[c]+1){let d=n[c];if(d.marker===a.marker&&d.open&&d.end<0){let h=!1;if((d.close||a.open)&&(d.length+a.length)%3===0&&(d.length%3!==0||a.length%3!==0)&&(h=!0),!h){let p=c>0&&!n[c-1].open?o[c-1]+1:0;o[s]=s-c+p,o[c]=p,a.open=!1,d.end=s,d.close=!1,u=-1,r=-2;break}}}u!==-1&&(t[a.marker][(a.open?3:0)+(a.length||0)%3]=u)}}function OI(n){let t=n.tokens_meta,e=n.tokens_meta.length;Kv(n.delimiters);for(let i=0;i<e;i++)t[i]&&t[i].delimiters&&Kv(t[i].delimiters)}function DI(n){let t,e,i=0,r=n.tokens,o=n.tokens.length;for(t=e=0;t<o;t++)r[t].nesting<0&&i--,r[t].level=i,r[t].nesting>0&&i++,r[t].type==="text"&&t+1<o&&r[t+1].type==="text"?r[t+1].content=r[t].content+r[t+1].content:(t!==e&&(r[e]=r[t]),e++);t!==e&&(r.length=e)}var yh=[["text",pI],["linkify",mI],["newline",gI],["escape",bI],["backticks",yI],["strikethrough",tE.tokenize],["emphasis",nE.tokenize],["link",wI],["image",SI],["autolink",CI],["html_inline",II],["entity",_I]],vh=[["balance_pairs",OI],["strikethrough",tE.postProcess],["emphasis",nE.postProcess],["fragments_join",DI]];function xo(){this.ruler=new St;for(let n=0;n<yh.length;n++)this.ruler.push(yh[n][0],yh[n][1]);this.ruler2=new St;for(let n=0;n<vh.length;n++)this.ruler2.push(vh[n][0],vh[n][1])}xo.prototype.skipToken=function(n){let t=n.pos,e=this.ruler.getRules(""),i=e.length,r=n.md.options.maxNesting,o=n.cache;if(typeof o[t]!="undefined"){n.pos=o[t];return}let s=!1;if(n.level<r){for(let a=0;a<i;a++)if(n.level++,s=e[a](n,!0),n.level--,s){if(t>=n.pos)throw new Error("inline rule didn't increment state.pos");break}}else n.pos=n.posMax;s||n.pos++,o[t]=n.pos};xo.prototype.tokenize=function(n){let t=this.ruler.getRules(""),e=t.length,i=n.posMax,r=n.md.options.maxNesting;for(;n.pos<i;){let o=n.pos,s=!1;if(n.level<r){for(let a=0;a<e;a++)if(s=t[a](n,!1),s){if(o>=n.pos)throw new Error("inline rule didn't increment state.pos");break}}if(s){if(n.pos>=i)break;continue}n.pending+=n.src[n.pos++]}n.pending&&n.pushPending()};xo.prototype.parse=function(n,t,e,i){let r=new this.State(n,t,e,i);this.tokenize(r);let o=this.ruler2.getRules(""),s=o.length;for(let a=0;a<s;a++)o[a](r)};xo.prototype.State=Eo;var BI={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},FI={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},HI={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},zI={default:BI,zero:FI,commonmark:HI},VI=/^(vbscript|javascript|file|data):/,$I=/^data:image\/(gif|png|jpeg|webp);/;function WI(n){let t=n.trim().toLowerCase();return VI.test(t)?$I.test(t):!0}var iE=["http:","https:","mailto:"];function UI(n){let t=Qn.parse(n,!0);if(t.hostname&&(!t.protocol||iE.indexOf(t.protocol)>=0))try{t.hostname=Gv.toASCII(t.hostname)}catch(e){}return Qn.encode(Qn.format(t))}function KI(n){let t=Qn.parse(n,!0);if(t.hostname&&(!t.protocol||iE.indexOf(t.protocol)>=0))try{t.hostname=Gv.toUnicode(t.hostname)}catch(e){}return Qn.decode(Qn.format(t),Qn.decode.defaultChars+"%")}function $t(n,t){if(!(this instanceof $t))return new $t(n,t);t||xh(n)||(t=n||{},n="default"),this.inline=new xo,this.block=new sl,this.core=new wh,this.renderer=new gr,this.linkify=new e2,this.validateLink=WI,this.normalizeLink=UI,this.normalizeLinkText=KI,this.utils=g2,this.helpers=rl({},E2),this.options={},this.configure(n),t&&this.set(t)}$t.prototype.set=function(n){return rl(this.options,n),this};$t.prototype.configure=function(n){let t=this;if(xh(n)){let e=n;if(n=zI[e],!n)throw new Error('Wrong `markdown-it` preset "'+e+'", check name')}if(!n)throw new Error("Wrong `markdown-it` preset, can't be empty");return n.options&&t.set(n.options),n.components&&Object.keys(n.components).forEach(function(e){n.components[e].rules&&t[e].ruler.enableOnly(n.components[e].rules),n.components[e].rules2&&t[e].ruler2.enableOnly(n.components[e].rules2)}),this};$t.prototype.enable=function(n,t){let e=[];Array.isArray(n)||(n=[n]),["core","block","inline"].forEach(function(r){e=e.concat(this[r].ruler.enable(n,!0))},this),e=e.concat(this.inline.ruler2.enable(n,!0));let i=n.filter(function(r){return e.indexOf(r)<0});if(i.length&&!t)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+i);return this};$t.prototype.disable=function(n,t){let e=[];Array.isArray(n)||(n=[n]),["core","block","inline"].forEach(function(r){e=e.concat(this[r].ruler.disable(n,!0))},this),e=e.concat(this.inline.ruler2.disable(n,!0));let i=n.filter(function(r){return e.indexOf(r)<0});if(i.length&&!t)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+i);return this};$t.prototype.use=function(n){let t=[this].concat(Array.prototype.slice.call(arguments,1));return n.apply(n,t),this};$t.prototype.parse=function(n,t){if(typeof n!="string")throw new Error("Input data should be a String");let e=new this.core.State(n,this,t);return this.core.process(e),e.tokens};$t.prototype.render=function(n,t){return t=t||{},this.renderer.render(this.parse(n,t),this.options,t)};$t.prototype.parseInline=function(n,t){let e=new this.core.State(n,this,t);return e.inlineMode=!0,this.core.process(e),e.tokens};$t.prototype.renderInline=function(n,t){return t=t||{},this.renderer.render(this.parseInline(n,t),this.options,t)};rE.exports=$t});var TN={};Hx(TN,{default:()=>MN});module.exports=zx(TN);var Ut=require("obsidian"),Nx=Po(require("path"));var Oo=["default","ashberry-light","ashberry-dark","dusty-navy","dark","paper-like"],me={settingsVersion:2,defaultMode:"tiptap",showModeDialog:!0,lastViewMode:"edit",lastViewOpenPlacement:"right",enableLegacyTiptap:!0,common:{writingMode:"vertical-rl",fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:18,lineHeight:1.8,letterSpacing:0,pageScale:1,textColor:"#2e2e2e",backgroundColor:"#ffffff",pageBackgroundColor:"#f5f5f5",accentColor:"#1e90ff",lineEndProcessing:"allow-end",rubySize:.5,headingSpacing:2,rubyVerticalGap:0,rubyHorizontalGap:0,headingFontFamily:"",headingTextColor:"",debugLogging:!1},preview:{syncCursor:!0,updateInterval:300,showCaret:!0,pageModeEnabled:!1,outlineOpen:!1,hideFrontmatter:!0,showFrontmatterTitle:!0,showFrontmatterSubtitle:!0,showFrontmatterOriginalTitle:!0,showFrontmatterAuthor:!0,showFrontmatterCoAuthors:!0,showFrontmatterTranslator:!0,showFrontmatterCoTranslators:!0,followActiveFile:!1,headerContent:"none",headerAlign:"center",footerContent:"pageNumber",footerAlign:"center",pageNumberFormat:"currentTotal",pageTransitionEffect:"fade"},wysiwyg:{autoSave:!0,syncMode:"auto",syncCursor:!0,enableRuby:!0,enableTcy:!0,enableAssistantInput:!1,enableSyncBackup:!0,appCloseAction:"save",imeOffsetHorizontalEm:.1,imeOffsetVerticalEm:.5,caretColorMode:"accent",caretCustomColor:"#1e90ff",caretWidthPx:3,ceUseNativeCaret:!0,sotPaddingTop:32,sotPaddingBottom:16},themes:[{id:"default",name:"\u30C7\u30D5\u30A9\u30EB\u30C8",description:"\u6A19\u6E96\u7684\u306A\u7E26\u66F8\u304D\u30C6\u30FC\u30DE",mode:"custom",settings:{fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:18,lineHeight:1.8,headingFontFamily:"",colors:{text:"#2e2e2e",background:"#ffffff",pageBackground:"#f5f5f5",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1,headingSpacing:2}}},{id:"ashberry-light",name:"\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\uFF08\u30E9\u30A4\u30C8\uFF09",description:"\u6DE1\u3044\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\u8ABF\u306E\u660E\u308B\u3044\u30C6\u30FC\u30DE\uFF08\u4E38\u30B4\u30B7\u30C3\u30AF\uFF09",mode:"custom",settings:{fontFamily:"\u7B51\u7D2BA\u4E38\u30B4\u30B7\u30C3\u30AF, Hiragino Maru Gothic ProN, Hiragino Sans, Noto Sans JP, Yu Gothic, Meiryo, sans-serif",fontSize:20,lineHeight:1.9,letterSpacing:.06,rubySize:.5,headingFontFamily:"",colors:{text:"#3f3d43",background:"#f0eaed",pageBackground:"#dfd4da",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},{id:"ashberry-dark",name:"\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\uFF08\u30C0\u30FC\u30AF\uFF09",description:"\u30A2\u30C3\u30B7\u30E5\u30D9\u30EA\u30FC\u8ABF\u306E\u843D\u3061\u7740\u3044\u305F\u30C0\u30FC\u30AF\u30C6\u30FC\u30DE\uFF08\u4E38\u30B4\u30B7\u30C3\u30AF\uFF09",mode:"custom",settings:{fontFamily:"\u7B51\u7D2BA\u4E38\u30B4\u30B7\u30C3\u30AF, Hiragino Maru Gothic ProN, Hiragino Sans, Noto Sans JP, Yu Gothic, Meiryo, sans-serif",fontSize:20,lineHeight:1.9,letterSpacing:.06,rubySize:.5,headingFontFamily:"",colors:{text:"#f0eaed",background:"#956a7f",pageBackground:"#b495a4",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},{id:"dusty-navy",name:"\u30C0\u30B9\u30C6\u30A3\u30CD\u30A4\u30D3\u30FC",description:"\u304F\u3059\u3093\u3060\u30C0\u30FC\u30AF\u30D6\u30EB\u30FC\u306E\u843D\u3061\u7740\u3044\u305F\u30C6\u30FC\u30DE\uFF08\u660E\u671D\uFF09",mode:"custom",settings:{fontFamily:'"Yu Mincho", "Hiragino Mincho ProN", "Noto Serif JP", "Noto Serif CJK JP", "Source Han Serif", Georgia, "Times New Roman", serif',fontSize:20,lineHeight:1.9,letterSpacing:.06,rubySize:.5,headingFontFamily:"",colors:{text:"#d5d9e1",background:"#30354a",pageBackground:"#3b415a",accent:"#1e90ff",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},{id:"dark",name:"\u30C0\u30FC\u30AF",description:"\u30C0\u30FC\u30AF\u30E2\u30FC\u30C9\u7E26\u66F8\u304D\u30C6\u30FC\u30DE",mode:"custom",settings:{fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:18,lineHeight:1.8,headingFontFamily:"",colors:{text:"#e0e0e0",background:"#1a1a1a",pageBackground:"#0f0f0f",accent:"#4a9eff",headingText:""},spacing:{paragraphSpacing:1,headingSpacing:2}}},{id:"paper-like",name:"\u7D19\u98A8",description:"\u7D19\u306E\u3088\u3046\u306A\u6E29\u304B\u307F\u306E\u3042\u308B\u30C6\u30FC\u30DE",mode:"custom",settings:{fontFamily:"Yu Mincho, Hiragino Mincho ProN, serif",fontSize:17,lineHeight:1.9,headingFontFamily:"",colors:{text:"#3a3330",background:"#f9f7f3",pageBackground:"#e8e4df",accent:"#b8860b",headingText:""},spacing:{paragraphSpacing:1.3,headingSpacing:2.2}}}],activeTheme:"obsidian-base",customFonts:[],temporaryOverrides:{},controlPanel:{enabled:!0,position:"top",autoHide:!1}};function jh(n){var e,i,r,o,s,a,l;let t={...me};if(n&&typeof n=="object"){let u=(typeof n.settingsVersion=="number"?n.settingsVersion:0)<2;if(t.defaultMode="tiptap",(n.lastViewMode==="edit"||n.lastViewMode==="preview"||n.lastViewMode==="compat")&&(t.lastViewMode=n.lastViewMode),typeof n.enableLegacyTiptap=="boolean"&&(t.enableLegacyTiptap=n.enableLegacyTiptap),(n.lastViewOpenPlacement==="right"||n.lastViewOpenPlacement==="tab"||n.lastViewOpenPlacement==="window")&&(t.lastViewOpenPlacement=n.lastViewOpenPlacement),typeof n.showModeDialog=="boolean"&&!u&&(t.showModeDialog=n.showModeDialog),t.settingsVersion=2,n.common&&typeof n.common=="object"){let d={...t.common,...n.common};d.rubySize=Wl((e=n.common.rubySize)!=null?e:d.rubySize),d.rubyVerticalGap=Pi((i=n.common.rubyVerticalGap)!=null?i:d.rubyVerticalGap,me.common.rubyVerticalGap),d.rubyHorizontalGap=Pi((r=n.common.rubyHorizontalGap)!=null?r:d.rubyHorizontalGap,me.common.rubyHorizontalGap),typeof d.debugLogging!="boolean"&&(d.debugLogging=me.common.debugLogging),t.common=d}else t.common={...t.common,rubySize:Wl(t.common.rubySize),rubyVerticalGap:Pi(t.common.rubyVerticalGap,me.common.rubyVerticalGap),rubyHorizontalGap:Pi(t.common.rubyHorizontalGap,me.common.rubyHorizontalGap)};if(n.preview&&typeof n.preview=="object"&&(t.preview={...t.preview,...n.preview}),n.wysiwyg&&typeof n.wysiwyg=="object"){t.wysiwyg={...t.wysiwyg,...n.wysiwyg},typeof t.wysiwyg.enableSyncBackup!="boolean"&&(t.wysiwyg.enableSyncBackup=me.wysiwyg.enableSyncBackup);let d=t.wysiwyg.appCloseAction;d!=="save"&&d!=="discard"&&(t.wysiwyg.appCloseAction=me.wysiwyg.appCloseAction),t.wysiwyg.imeOffsetHorizontalEm=_o(t.wysiwyg.imeOffsetHorizontalEm,(o=me.wysiwyg.imeOffsetHorizontalEm)!=null?o:.1),t.wysiwyg.imeOffsetVerticalEm=_o(t.wysiwyg.imeOffsetVerticalEm,(s=me.wysiwyg.imeOffsetVerticalEm)!=null?s:.5);let h=t.wysiwyg.caretColorMode;h!=="text"&&h!=="accent"&&h!=="custom"&&(t.wysiwyg.caretColorMode=me.wysiwyg.caretColorMode);let p=Number(t.wysiwyg.caretWidthPx);Number.isFinite(p)?t.wysiwyg.caretWidthPx=Math.max(qh,Math.min(Gh,p)):t.wysiwyg.caretWidthPx=me.wysiwyg.caretWidthPx,typeof t.wysiwyg.caretCustomColor!="string"&&(t.wysiwyg.caretCustomColor=me.wysiwyg.caretCustomColor),typeof t.wysiwyg.ceUseNativeCaret!="boolean"&&(t.wysiwyg.ceUseNativeCaret=me.wysiwyg.ceUseNativeCaret);let f=Number(t.wysiwyg.sotPaddingTop);t.wysiwyg.sotPaddingTop=Number.isFinite(f)?Math.max(0,Math.min(200,f)):me.wysiwyg.sotPaddingTop;let g=Number(t.wysiwyg.sotPaddingBottom);t.wysiwyg.sotPaddingBottom=Number.isFinite(g)?Math.max(0,Math.min(200,g)):me.wysiwyg.sotPaddingBottom}if(!n.wysiwyg){t.wysiwyg.imeOffsetHorizontalEm=_o(t.wysiwyg.imeOffsetHorizontalEm,(a=me.wysiwyg.imeOffsetHorizontalEm)!=null?a:.1),t.wysiwyg.imeOffsetVerticalEm=_o(t.wysiwyg.imeOffsetVerticalEm,(l=me.wysiwyg.imeOffsetVerticalEm)!=null?l:.5);let d=Number(t.wysiwyg.caretWidthPx);t.wysiwyg.caretWidthPx=Number.isFinite(d)?Math.max(qh,Math.min(Gh,d)):me.wysiwyg.caretWidthPx}if(n.controlPanel&&typeof n.controlPanel=="object"&&(t.controlPanel={...t.controlPanel,...n.controlPanel}),Array.isArray(n.themes)){let d=new Map;for(let h of t.themes)d.set(h.id,h);for(let h of n.themes)h&&typeof h.id=="string"&&(h.mode||(h.mode="custom"),d.set(h.id,h));t.themes=Array.from(d.values())}if(typeof n.activeTheme=="string"&&(t.activeTheme=n.activeTheme),Array.isArray(n.customFonts)){let h=n.customFonts.filter(g=>typeof g=="string").map(g=>g.trim()).filter(g=>g.length>0),p=[...me.customFonts,...h],f=new Set;t.customFonts=p.filter(g=>{let m=g.toLowerCase();return f.has(m)?!1:(f.add(m),!0)})}else t.customFonts=[...me.customFonts];n.temporaryOverrides&&typeof n.temporaryOverrides=="object"?t.temporaryOverrides={...n.temporaryOverrides}:t.temporaryOverrides={}}return t.common.rubySize=Wl(t.common.rubySize),t.common.rubyVerticalGap=Pi(t.common.rubyVerticalGap,me.common.rubyVerticalGap),t.common.rubyHorizontalGap=Pi(t.common.rubyHorizontalGap,me.common.rubyHorizontalGap),t.customFonts=Array.isArray(t.customFonts)?[...t.customFonts]:[...me.customFonts],t}var zh=.2,Vh=1,$h=-5,Wh=5,Uh=-1,Kh=1,qh=1,Gh=8;function Wl(n){let t=Number(n);return Number.isFinite(t)?t<zh?zh:t>Vh?Vh:t:me.common.rubySize}function Pi(n,t){let e=Number(n);return Number.isFinite(e)?e<$h?$h:e>Wh?Wh:e:t}function _o(n,t){let e=Number(n);return Number.isFinite(e)?e<Uh?Uh:e>Kh?Kh:e:t}var Re=require("obsidian");function Vx(n){return/^(0|[1-9]\d*)$/.test(n)?Number(n):n}function Yh(n){var d,h,p,f;let t=String(n!=null?n:"").trim();if(!t)return null;let e=t.startsWith("v")?t.slice(1):t,i=(d=e.split("+")[0])!=null?d:e,[r,o]=i.split("-",2);if(!r)return null;let s=r.split(".").map(g=>g.trim());if(s.length<1||s.length>3)return null;let a=Number((h=s[0])!=null?h:"NaN"),l=Number((p=s[1])!=null?p:"0"),c=Number((f=s[2])!=null?f:"0");if(![a,l,c].every(g=>Number.isInteger(g)&&g>=0))return null;let u=o?o.split(".").map(g=>g.trim()).filter(g=>g.length>0).map(Vx):[];return{major:a,minor:l,patch:c,preRelease:u}}function Xh(n,t){let e=Yh(n),i=Yh(t);if(!e||!i)return null;if(e.major!==i.major)return e.major>i.major?1:-1;if(e.minor!==i.minor)return e.minor>i.minor?1:-1;if(e.patch!==i.patch)return e.patch>i.patch?1:-1;let r=e.preRelease,o=i.preRelease,s=r.length>0,a=o.length>0;if(s!==a)return s?-1:1;if(!s&&!a)return 0;let l=Math.max(r.length,o.length);for(let c=0;c<l;c++){let u=r[c],d=o[c];if(u===void 0)return-1;if(d===void 0)return 1;if(u===d)continue;let h=typeof u=="number",p=typeof d=="number";if(h&&p)return u>d?1:-1;if(h!==p)return h?-1:1;let f=String(u),g=String(d);return f>g?1:-1}return 0}var $x="https://raw.githubusercontent.com/cat-left-paw/tategaki-plugin-release/main/latest.json",Jh="https://github.com/cat-left-paw/tategaki-plugin-release/releases",Zh="https://www.buymeacoffee.com/hidarite",Do=class extends Re.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){var i;let{containerEl:t}=this;t.empty(),t.createEl("h1",{text:"Tategaki Plugin\u8A2D\u5B9A"}),this.addTiptapSettings(this.plugin.settings);let e=(i=this.plugin.settings.enableLegacyTiptap)!=null?i:!0;this.addUpdateAndSupportSection(e),this.addThemeSettings(this.plugin.settings),this.addDonationSection()}bindDeferredSlider(t,e,i){var f;let r=e,o=e,s=null,a=!1,l=1e-4,c=(f=i.debounce)!=null?f:200,u=()=>{s!==null&&(window.clearTimeout(s),s=null)},d=async()=>{if(a||(u(),Math.abs(r-o)<l))return;a=!0;let g=r;try{await i.onCommit(g),o=g}finally{a=!1}},h=()=>{if(u(),c<=0){d();return}s=window.setTimeout(()=>{d()},c)};t.onChange(g=>{let m=i.transform?i.transform(g):g;Math.abs(m-r)<l||(r=m,h())});let p=()=>{d()};t.sliderEl.addEventListener("change",p),t.sliderEl.addEventListener("blur",p),t.sliderEl.addEventListener("pointerup",p)}addTiptapSettings(t){var r;let{containerEl:e}=this,i=(r=t.enableLegacyTiptap)!=null?r:!0;new Re.Setting(e).setName("\u4E92\u63DB\u30E2\u30FC\u30C9\uFF08TipTap\u30D9\u30FC\u30B9\u306E\u30A8\u30C7\u30A3\u30BF\uFF09").setDesc("TipTap\u30D9\u30FC\u30B9\u306E\u4E92\u63DB\u30D3\u30E5\u30FC\u3068\u540C\u671F\u6A5F\u80FD\u3092\u6709\u52B9\u5316\u3057\u307E\u3059\u3002\u30AA\u30D5\u306B\u3059\u308B\u3068\u4E92\u63DB\u7528\u306E\u540C\u671F/\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u8A2D\u5B9A\u3092\u975E\u8868\u793A\u306B\u3057\u307E\u3059").addToggle(o=>{o.setValue(i).onChange(async s=>{await this.plugin.updateSettings({enableLegacyTiptap:s}),this.display()})}),new Re.Setting(e).setName("\u30D3\u30E5\u30FC\u8D77\u52D5\u6642\u306B\u30E2\u30FC\u30C9\u9078\u629E\u3092\u8868\u793A").setDesc("\u7E26\u66F8\u304D\u30D3\u30E5\u30FC\u3092\u958B\u304F\u3068\u304D\u306B\u3001\u57F7\u7B46\u30E2\u30FC\u30C9/\u53C2\u7167\u30E2\u30FC\u30C9\u3092\u9078\u629E\u3059\u308B\u30C0\u30A4\u30A2\u30ED\u30B0\u3092\u8868\u793A\u3057\u307E\u3059").addToggle(o=>{o.setValue(!!t.showModeDialog).onChange(async s=>{await this.plugin.updateSettings({showModeDialog:s})})}),i&&(e.createEl("h3",{text:"\u540C\u671F\u3068\u66F4\u65B0(\u4E92\u63DB\u30E2\u30FC\u30C9\u5C02\u7528)"}),new Re.Setting(e).setName("\u5916\u90E8\u540C\u671F\u306E\u66F4\u65B0\u9593\u9694(ms)").setDesc("\u30AB\u30FC\u30BD\u30EB\u540C\u671F\u3084\u8FFD\u5F93\u6642\u306E\u30DD\u30FC\u30EA\u30F3\u30B0\u9593\u9694\u3067\u3059\u30020=\u30EA\u30A2\u30EB\u30BF\u30A4\u30E0\uFF08\u9AD8\u8CA0\u8377\u306E\u53EF\u80FD\u6027\uFF09\u3002\u5024\u3092\u5927\u304D\u304F\u3059\u308B\u307B\u3069\u8CA0\u8377\u306F\u8EFD\u304F\u306A\u308A\u307E\u3059").addSlider(o=>{o.setLimits(0,1e3,50).setDynamicTooltip().setValue(t.preview.updateInterval),this.bindDeferredSlider(o,t.preview.updateInterval,{debounce:200,onCommit:async s=>{s!==this.plugin.settings.preview.updateInterval&&await this.plugin.updateSettings({preview:{...this.plugin.settings.preview,updateInterval:s}})}})}),new Re.Setting(e).setName("\u540C\u671F\u30E2\u30FC\u30C9").setDesc("\u81EA\u52D5: \u7DE8\u96C6\u6642\u306B\u81EA\u52D5\u4FDD\u5B58\u3001\u624B\u52D5: \u624B\u52D5\u3067\u540C\u671F\u30DC\u30BF\u30F3\u3092\u62BC\u3059\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\uFF08Tategaki\u30A8\u30C7\u30A3\u30BF\uFF09").addDropdown(o=>{o.addOption("auto","\u81EA\u52D5\u540C\u671F").addOption("manual","\u624B\u52D5\u540C\u671F").setValue(t.wysiwyg.syncMode).onChange(async s=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,syncMode:s}})})}),new Re.Setting(e).setName("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210").setDesc("\u4E92\u63DB\u30E2\u30FC\u30C9\u306E\u540C\u671F\u6642\u306B\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002OFF\u306B\u3059\u308B\u3068\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u4F5C\u6210\u3055\u308C\u307E\u305B\u3093\uFF08\u4E8B\u6545\u6642\u306FObsidian\u306E\u300COpen version history\u300D\u3092\u5229\u7528\u3057\u3066\u304F\u3060\u3055\u3044\uFF09\u3002").addToggle(o=>{o.setValue(!!this.plugin.settings.wysiwyg.enableSyncBackup).onChange(async s=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableSyncBackup:s}})})}),new Re.Setting(e).setName("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u304F").setDesc("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u4FDD\u5B58\u5148\uFF08.obsidian/tategaki-sync-backups\uFF09\u3092\u958B\u304D\u307E\u3059\u3002").addButton(o=>{o.setButtonText("\u958B\u304F").onClick(async()=>{await this.plugin.openSyncBackupFolder()})}),new Re.Setting(e).setName("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5").setDesc("\u540C\u671F\u306E\u5B89\u5168\u7B56\u3068\u3057\u3066\u4F5C\u6210\u3055\u308C\u305F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3059\uFF08\u5FA9\u5143\u3067\u304D\u306A\u304F\u306A\u308B\u306E\u3067\u6CE8\u610F\uFF09").addButton(o=>{o.setButtonText("\u79FB\u52D5").setWarning().onClick(async()=>{await this.plugin.moveSyncBackupsToTrash()})}),new Re.Setting(e).setName("\u30A2\u30D7\u30EA\u7D42\u4E86\u6642\u306E\u672A\u4FDD\u5B58\u5909\u66F4").setDesc("\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308B\u5834\u5408\u306B\u3001\u7D42\u4E86\u6642\u306B\u4FDD\u5B58\u3059\u308B\u304B\u7834\u68C4\u3059\u308B\u304B\u3092\u9078\u3073\u307E\u3059").addDropdown(o=>{var s;o.addOption("save","\u4FDD\u5B58\u3057\u3066\u7D42\u4E86").addOption("discard","\u7834\u68C4\u3057\u3066\u7D42\u4E86").setValue((s=t.wysiwyg.appCloseAction)!=null?s:"save").onChange(async a=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,appCloseAction:a}})})}),new Re.Setting(e).setName("\u30AB\u30FC\u30BD\u30EB\u540C\u671F").setDesc("Obsidian\u6A19\u6E96\u30A8\u30C7\u30A3\u30BF\u3067\u30A2\u30AF\u30C6\u30A3\u30D6\u306A\u30AB\u30FC\u30BD\u30EB\u4F4D\u7F6E\u3092Tategaki\u30A8\u30C7\u30A3\u30BF\u306B\u3082\u53CD\u6620\u3057\u307E\u3059").addToggle(o=>{o.setValue(!!t.wysiwyg.syncCursor).onChange(async s=>{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,syncCursor:s}})})}))}addUpdateAndSupportSection(t){let{containerEl:e}=this;e.createEl("h2",{text:"\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8"}),new Re.Setting(e).setName("\u624B\u52D5\u3067\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8\u3092\u78BA\u8A8D").setDesc("\u30DC\u30BF\u30F3\u3092\u62BC\u3057\u305F\u3068\u304D\u3060\u3051\u901A\u4FE1\u3057\u3066\u3001\u516C\u958BURL\u4E0A\u306E\u6700\u65B0\u7248\u60C5\u5831\u3092\u78BA\u8A8D\u3057\u307E\u3059").addButton(o=>{o.setButtonText("\u66F4\u65B0\u306E\u78BA\u8A8D").onClick(async()=>{var a,l,c;let s=this.plugin.manifest.version;try{let d=(a=(await(0,Re.requestUrl)({url:$x})).json)!=null?a:{},h=String((l=d.version)!=null?l:"").trim(),p=String((c=d.url)!=null?c:"").trim();if(!h){new Re.Notice("\u66F4\u65B0\u60C5\u5831\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\uFF08latest.json\u306E\u5F62\u5F0F\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\uFF09\u3002",3e3);return}if(h===s){new Re.Notice(`Tategaki\u30A8\u30C7\u30A3\u30BF\u306F\u6700\u65B0\u3067\u3059\uFF08\u73FE\u5728: ${s}\uFF09\u3002`,2500);return}let f=Xh(h,s);if(f===null){let m=p?`\u66F4\u65B0\u60C5\u5831\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\uFF08\u516C\u958B: ${h} / \u73FE\u5728: ${s}\uFF09\u3002\u30D0\u30FC\u30B8\u30E7\u30F3\u6BD4\u8F03\u304C\u3067\u304D\u306A\u3044\u305F\u3081\u3001Releases \u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044: ${p}`:`\u66F4\u65B0\u60C5\u5831\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\uFF08\u516C\u958B: ${h} / \u73FE\u5728: ${s}\uFF09\u3002\u30D0\u30FC\u30B8\u30E7\u30F3\u6BD4\u8F03\u304C\u3067\u304D\u306A\u3044\u305F\u3081\u3001Releases \u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002`;new Re.Notice(m,6e3);return}if(f<0){new Re.Notice(`\u73FE\u5728\u306E\u307B\u3046\u304C\u65B0\u3057\u3044\u30D0\u30FC\u30B8\u30E7\u30F3\u3067\u3059\uFF08\u73FE\u5728: ${s} / \u516C\u958B: ${h}\uFF09\u3002`,4e3);return}let g=p?`\u65B0\u3057\u3044\u30D0\u30FC\u30B8\u30E7\u30F3 ${h} \u304C\u5229\u7528\u53EF\u80FD\u3067\u3059\uFF08\u73FE\u5728: ${s}\uFF09\u3002\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9: ${p}`:`\u65B0\u3057\u3044\u30D0\u30FC\u30B8\u30E7\u30F3 ${h} \u304C\u5229\u7528\u53EF\u80FD\u3067\u3059\uFF08\u73FE\u5728: ${s}\uFF09\u3002`;new Re.Notice(g,5e3)}catch(u){console.error("Update check failed",u),new Re.Notice("\u66F4\u65B0\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u901A\u4FE1\u72B6\u6CC1\u3068\u66F4\u65B0URL\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",3500)}})}).controlEl.createEl("a",{text:"\u30EA\u30EA\u30FC\u30B9\u30DA\u30FC\u30B8",attr:{href:Jh,target:"_blank",rel:"noopener noreferrer",style:"margin-left: 8px; font-size: 12px;"}}).addEventListener("click",o=>{o.preventDefault(),window.open(Jh,"_blank","noopener,noreferrer")})}addDonationSection(){let{containerEl:t}=this;t.createEl("h2",{text:"\u30B5\u30DD\u30FC\u30C8"});let i=new Re.Setting(t).setName("\u30B5\u30DD\u30FC\u30C8\uFF08\u5BC4\u4ED8\uFF09").setDesc("\u3053\u306E\u30D7\u30E9\u30B0\u30A4\u30F3\u3092\u6C17\u306B\u5165\u3063\u3066\u3044\u305F\u3060\u3051\u305F\u3089\u30B5\u30DD\u30FC\u30C8\u3092\u3057\u3066\u3044\u305F\u3060\u304F\u3068\u5E78\u3044\u3067\u3059\uFF08\u4EFB\u610F\uFF09").controlEl.createEl("a",{attr:{href:Zh,target:"_blank",rel:"noopener noreferrer","aria-label":"Buy Me a Coffee",style:"display: inline-flex;"}});i.createEl("img",{attr:{src:"https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png",alt:"Buy Me A Coffee",style:"height: 60px !important;width: 217px !important;"}}),i.addEventListener("click",r=>{r.preventDefault();try{window.open(Zh,"_blank","noopener,noreferrer")}catch(o){console.error("Failed to open donation link",o),new Re.Notice("\u30EA\u30F3\u30AF\u3092\u958B\u3051\u307E\u305B\u3093\u3067\u3057\u305F\u3002",2500)}})}addThemeSettings(t){let{containerEl:e}=this;e.createEl("h2",{text:"\u30C6\u30FC\u30DE\u7BA1\u7406"});let i=t.activeTheme==="obsidian-base"?null:t.themes.find(l=>l.id===t.activeTheme),r=t.activeTheme==="obsidian-base"?"Obsidian \u30D9\u30FC\u30B9\u30C6\u30FC\u30DE":i?i.name:"\u672A\u77E5\u306E\u30C6\u30FC\u30DE";e.createEl("p",{text:`\u73FE\u5728\u306E\u30C6\u30FC\u30DE: ${r}`,cls:"setting-item-description"});let o=e.createDiv("theme-list-container");o.style.cssText=`
			border: 1px solid var(--background-modifier-border);
			border-radius: 6px;
			padding: 16px;
			margin: 16px 0;
			background: var(--background-secondary);
		`;let s=o.createEl("h3",{text:"\u4FDD\u5B58\u3055\u308C\u3066\u3044\u308B\u30C6\u30FC\u30DE"});s.style.cssText="margin: 0 0 12px 0;",(()=>{let l=o.querySelector(".theme-items");l&&l.remove();let c=o.createDiv("theme-items");c.style.cssText=`
				max-height: min(360px, 50vh);
				overflow-y: auto;
				padding-right: 6px;
			`,[{id:"obsidian-base",name:"Obsidian \u30D9\u30FC\u30B9\u30C6\u30FC\u30DE",description:"Obsidian\u3067\u9069\u7528\u3055\u308C\u3066\u3044\u308B\u30C6\u30FC\u30DE\u3092\u30D9\u30FC\u30B9\u3068\u3057\u305F\u30C6\u30FC\u30DE\u3067\u3059",mode:"obsidian-base",settings:{fontFamily:"",fontSize:16,lineHeight:1.5,headingFontFamily:"",colors:{text:"",background:"",pageBackground:"",accent:"",headingText:""},spacing:{paragraphSpacing:1.5,headingSpacing:2}}},...t.themes].forEach((h,p)=>{var E;let f=c.createDiv("theme-item");f.style.cssText=`
					display: flex;
					align-items: center;
					justify-content: space-between;
					padding: 12px;
					margin: 8px 0;
					border: 1px solid var(--background-modifier-border);
					border-radius: 4px;
					background: var(--background-primary);
				`,h.id===t.activeTheme&&(f.style.borderColor="var(--interactive-accent)",f.style.backgroundColor="var(--background-secondary-alt)");let g=f.createDiv("theme-info");g.style.cssText="flex: 1;";let m=g.createEl("div",{text:h.name});m.style.cssText="font-weight: 500; margin-bottom: 4px;";let b=g.createEl("div",{text:h.description});if(b.style.cssText="font-size: 12px; color: var(--text-muted);",h.id!=="obsidian-base"){let x=g.createEl("div");x.style.cssText="font-size: 11px; color: var(--text-muted); margin-top: 4px;";let k=h.settings.headingFontFamily?h.settings.headingFontFamily.split(",")[0].trim():"\u672C\u6587\u3068\u540C\u3058",S=(E=h.settings.colors)!=null&&E.headingText?h.settings.colors.headingText:"\u672C\u6587\u3068\u540C\u3058";x.innerHTML=`
						<div>${h.settings.fontFamily} | ${h.settings.fontSize}px | \u884C\u9593${h.settings.lineHeight}</div>
						<div style="margin-top: 2px;">\u898B\u51FA\u3057: ${k} | ${S}</div>
					`}let y=f.createDiv("theme-buttons");if(y.style.cssText=`
					display: flex;
					gap: 8px;
					align-items: center;
				`,h.id!==t.activeTheme){let x=y.createEl("button",{text:"\u9069\u7528"});x.style.cssText="padding: 4px 8px; font-size: 11px;",x.addEventListener("click",async()=>{await this.plugin.loadTheme(h.id),this.display()})}else{let x=y.createEl("span",{text:"\u4F7F\u7528\u4E2D"});x.style.cssText="font-size: 11px; color: var(--interactive-accent); font-weight: 500;"}if(!(h.id==="obsidian-base"||Oo.includes(h.id))){let x=y.createEl("button",{text:"\u524A\u9664"});x.style.cssText="padding: 4px 8px; font-size: 11px; color: var(--text-error);",x.addEventListener("click",async()=>{confirm(`\u30C6\u30FC\u30DE\u300C${h.name}\u300D\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F\u3053\u306E\u64CD\u4F5C\u306F\u5143\u306B\u623B\u305B\u307E\u305B\u3093\u3002`)&&(await this.plugin.deleteTheme(h.id),this.display())})}})})(),new Re.Setting(e).setName("\u30C6\u30FC\u30DE\u306E\u4F7F\u7528\u65B9\u6CD5").setDesc("\u8A2D\u5B9A\u30D1\u30CD\u30EB\u3067\u898B\u305F\u76EE\u3092\u8ABF\u6574\u3057\u305F\u5F8C\u3001\u300C\u73FE\u5728\u306E\u8A2D\u5B9A\u3092\u30C6\u30FC\u30DE\u3068\u3057\u3066\u4FDD\u5B58\u300D\u30DC\u30BF\u30F3\u304B\u3089\u65B0\u3057\u3044\u30C6\u30FC\u30DE\u3068\u3057\u3066\u4FDD\u5B58\u3067\u304D\u307E\u3059\u3002\u4FDD\u5B58\u3055\u308C\u305F\u30C6\u30FC\u30DE\u306F\u3053\u3053\u3067\u7BA1\u7406\u3067\u304D\u307E\u3059\u3002")}};var Vl=require("obsidian");var ue=require("obsidian");function ot(n){this.content=n}ot.prototype={constructor:ot,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return t==-1?void 0:this.content[t+1]},update:function(n,t,e){var i=e&&e!=n?this.remove(e):this,r=i.find(n),o=i.content.slice();return r==-1?o.push(e||n,t):(o[r+1]=t,e&&(o[r]=e)),new ot(o)},remove:function(n){var t=this.find(n);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new ot(e)},addToStart:function(n,t){return new ot([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new ot(e)},addBefore:function(n,t,e){var i=this.remove(t),r=i.content.slice(),o=i.find(n);return r.splice(o==-1?r.length:o,0,t,e),new ot(r)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return n=ot.from(n),n.size?new ot(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=ot.from(n),n.size?new ot(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=ot.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},toObject:function(){var n={};return this.forEach(function(t,e){n[t]=e}),n},get size(){return this.content.length>>1}};ot.from=function(n){if(n instanceof ot)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new ot(t)};var Ul=ot;function lp(n,t,e){for(let i=0;;i++){if(i==n.childCount||i==t.childCount)return n.childCount==t.childCount?null:e;let r=n.child(i),o=t.child(i);if(r==o){e+=r.nodeSize;continue}if(!r.sameMarkup(o))return e;if(r.isText&&r.text!=o.text){for(let s=0;r.text[s]==o.text[s];s++)e++;return e}if(r.content.size||o.content.size){let s=lp(r.content,o.content,e+1);if(s!=null)return s}e+=r.nodeSize}}function cp(n,t,e,i){for(let r=n.childCount,o=t.childCount;;){if(r==0||o==0)return r==o?null:{a:e,b:i};let s=n.child(--r),a=t.child(--o),l=s.nodeSize;if(s==a){e-=l,i-=l;continue}if(!s.sameMarkup(a))return{a:e,b:i};if(s.isText&&s.text!=a.text){let c=0,u=Math.min(s.text.length,a.text.length);for(;c<u&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,e--,i--;return{a:e,b:i}}if(s.content.size||a.content.size){let c=cp(s.content,a.content,e-1,i-1);if(c)return c}e-=l,i-=l}}var z=class n{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let i=0;i<t.length;i++)this.size+=t[i].nodeSize}nodesBetween(t,e,i,r=0,o){for(let s=0,a=0;a<e;s++){let l=this.content[s],c=a+l.nodeSize;if(c>t&&i(l,r+a,o||null,s)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,t-u),Math.min(l.content.size,e-u),i,r+u)}a=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,i,r){let o="",s=!0;return this.nodesBetween(t,e,(a,l)=>{let c=a.isText?a.text.slice(Math.max(t,l)-l,e-l):a.isLeaf?r?typeof r=="function"?r(a):r:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&i&&(s?s=!1:o+=i),o+=c},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,i=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(i)&&(r[r.length-1]=e.withText(e.text+i.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new n(r,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let i=[],r=0;if(e>t)for(let o=0,s=0;s<e;o++){let a=this.content[o],l=s+a.nodeSize;l>t&&((s<t||l>e)&&(a.isText?a=a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a=a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),i.push(a),r+=a.nodeSize),s=l}return new n(i,r)}cutByIndex(t,e){return t==e?n.empty:t==0&&e==this.content.length?this:new n(this.content.slice(t,e))}replaceChild(t,e){let i=this.content[t];if(i==e)return this;let r=this.content.slice(),o=this.size+e.nodeSize-i.nodeSize;return r[t]=e,new n(r,o)}addToStart(t){return new n([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new n(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,i=0;e<this.content.length;e++){let r=this.content[e];t(r,i,e),i+=r.nodeSize}}findDiffStart(t,e=0){return lp(this,t,e)}findDiffEnd(t,e=this.size,i=t.size){return cp(this,t,e,i)}findIndex(t){if(t==0)return Bo(0,t);if(t==this.size)return Bo(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,i=0;;e++){let r=this.child(e),o=i+r.nodeSize;if(o>=t)return o==t?Bo(e+1,o):Bo(e,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return n.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new n(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return n.empty;let e,i=0;for(let r=0;r<t.length;r++){let o=t[r];i+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new n(e||t,i)}static from(t){if(!t)return n.empty;if(t instanceof n)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new n([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};z.empty=new z([],0);var Kl={index:0,offset:0};function Bo(n,t){return Kl.index=n,Kl.offset=t,Kl}function Ho(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(let i=0;i<n.length;i++)if(!Ho(n[i],t[i]))return!1}else{for(let i in n)if(!(i in t)||!Ho(n[i],t[i]))return!1;for(let i in t)if(!(i in n))return!1}return!0}var Ee=class n{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,i=!1;for(let r=0;r<t.length;r++){let o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!i&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),i=!0),e&&e.push(o)}}return e||(e=t.slice()),i||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&Ho(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let i=t.marks[e.type];if(!i)throw new RangeError(`There is no mark type ${e.type} in this schema`);let r=i.create(e.attrs);return i.checkAttrs(r.attrs),r}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].eq(e[i]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return n.none;if(t instanceof n)return[t];let e=t.slice();return e.sort((i,r)=>i.type.rank-r.type.rank),e}};Ee.none=[];var si=class extends Error{},q=class n{constructor(t,e,i){this.content=t,this.openStart=e,this.openEnd=i}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let i=dp(this.content,t+this.openStart,e);return i&&new n(i,this.openStart,this.openEnd)}removeBetween(t,e){return new n(up(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return n.empty;let i=e.openStart||0,r=e.openEnd||0;if(typeof i!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new n(z.fromJSON(t,e.content),i,r)}static maxOpen(t,e=!0){let i=0,r=0;for(let o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)i++;for(let o=t.lastChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.lastChild)r++;return new n(t,i,r)}};q.empty=new q(z.empty,0,0);function up(n,t,e){let{index:i,offset:r}=n.findIndex(t),o=n.maybeChild(i),{index:s,offset:a}=n.findIndex(e);if(r==t||o.isText){if(a!=e&&!n.child(s).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(i!=s)throw new RangeError("Removing non-flat range");return n.replaceChild(i,o.copy(up(o.content,t-r-1,e-r-1)))}function dp(n,t,e,i){let{index:r,offset:o}=n.findIndex(t),s=n.maybeChild(r);if(o==t||s.isText)return i&&!i.canReplace(r,r,e)?null:n.cut(0,t).append(e).append(n.cut(t));let a=dp(s.content,t-o-1,e,s);return a&&n.replaceChild(r,s.copy(a))}function Wx(n,t,e){if(e.openStart>n.depth)throw new si("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new si("Inconsistent open depths");return hp(n,t,e,0)}function hp(n,t,e,i){let r=n.index(i),o=n.node(i);if(r==t.index(i)&&i<n.depth-e.openStart){let s=hp(n,t,e,i+1);return o.copy(o.content.replaceChild(r,s))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&n.depth==i&&t.depth==i){let s=n.parent,a=s.content;return oi(s,a.cut(0,n.parentOffset).append(e.content).append(a.cut(t.parentOffset)))}else{let{start:s,end:a}=Ux(e,n);return oi(o,fp(n,s,a,t,i))}else return oi(o,zo(n,t,i))}function pp(n,t){if(!t.type.compatibleContent(n.type))throw new si("Cannot join "+t.type.name+" onto "+n.type.name)}function Gl(n,t,e){let i=n.node(e);return pp(i,t.node(e)),i}function ri(n,t){let e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function Mr(n,t,e,i){let r=(t||n).node(e),o=0,s=t?t.index(e):r.childCount;n&&(o=n.index(e),n.depth>e?o++:n.textOffset&&(ri(n.nodeAfter,i),o++));for(let a=o;a<s;a++)ri(r.child(a),i);t&&t.depth==e&&t.textOffset&&ri(t.nodeBefore,i)}function oi(n,t){return n.type.checkContent(t),n.copy(t)}function fp(n,t,e,i,r){let o=n.depth>r&&Gl(n,t,r+1),s=i.depth>r&&Gl(e,i,r+1),a=[];return Mr(null,n,r,a),o&&s&&t.index(r)==e.index(r)?(pp(o,s),ri(oi(o,fp(n,t,e,i,r+1)),a)):(o&&ri(oi(o,zo(n,t,r+1)),a),Mr(t,e,r,a),s&&ri(oi(s,zo(e,i,r+1)),a)),Mr(i,null,r,a),new z(a)}function zo(n,t,e){let i=[];if(Mr(null,n,e,i),n.depth>e){let r=Gl(n,t,e+1);ri(oi(r,zo(n,t,e+1)),i)}return Mr(t,null,e,i),new z(i)}function Ux(n,t){let e=t.depth-n.openStart,r=t.node(e).copy(n.content);for(let o=e-1;o>=0;o--)r=t.node(o).copy(z.from(r));return{start:r.resolveNoCache(n.openStart+e),end:r.resolveNoCache(r.content.size-n.openEnd-e)}}var Vo=class n{constructor(t,e,i){this.pos=t,this.path=e,this.parentOffset=i,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let i=this.pos-this.path[this.path.length-1],r=t.child(e);return i?t.child(e).cut(i):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let i=this.path[e*3],r=e==0?0:this.path[e*3-1]+1;for(let o=0;o<t;o++)r+=i.child(o).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return Ee.none;if(this.textOffset)return t.child(e).marks;let i=t.maybeChild(e-1),r=t.maybeChild(e);if(!i){let a=i;i=r,r=a}let o=i.marks;for(var s=0;s<o.length;s++)o[s].type.spec.inclusive===!1&&(!r||!o[s].isInSet(r.marks))&&(o=o[s--].removeFromSet(o));return o}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let i=e.marks,r=t.parent.maybeChild(t.index());for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!r||!i[o].isInSet(r.marks))&&(i=i[o--].removeFromSet(i));return i}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let i=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);i>=0;i--)if(t.pos<=this.end(i)&&(!e||e(this.node(i))))return new ai(this,t,i);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let i=[],r=0,o=e;for(let s=t;;){let{index:a,offset:l}=s.content.findIndex(o),c=o-l;if(i.push(s,a,r+l),!c||(s=s.child(a),s.isText))break;o=c-1,r+=l+1}return new n(e,i,o)}static resolveCached(t,e){let i=Qh.get(t);if(i)for(let o=0;o<i.elts.length;o++){let s=i.elts[o];if(s.pos==e)return s}else Qh.set(t,i=new jl);let r=i.elts[i.i]=n.resolve(t,e);return i.i=(i.i+1)%Kx,r}},jl=class{constructor(){this.elts=[],this.i=0}},Kx=12,Qh=new WeakMap,ai=class{constructor(t,e,i){this.$from=t,this.$to=e,this.depth=i}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},qx=Object.create(null),yt=class n{constructor(t,e,i,r=Ee.none){this.type=t,this.attrs=e,this.marks=r,this.content=i||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,i,r=0){this.content.nodesBetween(t,e,i,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,i,r){return this.content.textBetween(t,e,i,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,i){return this.type==t&&Ho(this.attrs,e||t.defaultAttrs||qx)&&Ee.sameSet(this.marks,i||Ee.none)}copy(t=null){return t==this.content?this:new n(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new n(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,i=!1){if(t==e)return q.empty;let r=this.resolve(t),o=this.resolve(e),s=i?0:r.sharedDepth(e),a=r.start(s),c=r.node(s).content.cut(r.pos-a,o.pos-a);return new q(c,r.depth-s,o.depth-s)}replace(t,e,i){return Wx(this.resolve(t),this.resolve(e),i)}nodeAt(t){for(let e=this;;){let{index:i,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(i),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:i}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:i}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:i}=this.content.findIndex(t);if(i<t)return{node:this.content.child(e),index:e,offset:i};let r=this.content.child(e-1);return{node:r,index:e-1,offset:i-r.nodeSize}}resolve(t){return Vo.resolveCached(this,t)}resolveNoCache(t){return Vo.resolve(this,t)}rangeHasMark(t,e,i){let r=!1;return e>t&&this.nodesBetween(t,e,o=>(i.isInSet(o.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),mp(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,i=z.empty,r=0,o=i.childCount){let s=this.contentMatchAt(t).matchFragment(i,r,o),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(let l=r;l<o;l++)if(!this.type.allowsMarks(i.child(l).marks))return!1;return!0}canReplaceWith(t,e,i,r){if(r&&!this.type.allowsMarks(r))return!1;let o=this.contentMatchAt(t).matchType(i),s=o&&o.matchFragment(this.content,e);return s?s.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=Ee.none;for(let e=0;e<this.marks.length;e++){let i=this.marks[e];i.type.checkAttrs(i.attrs),t=i.addToSet(t)}if(!Ee.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let i;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");i=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,i)}let r=z.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,r,i);return o.type.checkAttrs(o.attrs),o}};yt.prototype.text=void 0;var Yl=class n extends yt{constructor(t,e,i,r){if(super(t,e,null,r),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):mp(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new n(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new n(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}};function mp(n,t){for(let e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}var li=class n{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let i=new Xl(t,e);if(i.next==null)return n.empty;let r=gp(i);i.next&&i.err("Unexpected trailing text");let o=Qx(Zx(r));return ek(o,i),o}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,i=t.childCount){let r=this;for(let o=e;r&&o<i;o++)r=r.matchType(t.child(o).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let i=0;i<t.next.length;i++)if(this.next[e].type==t.next[i].type)return!0;return!1}fillBefore(t,e=!1,i=0){let r=[this];function o(s,a){let l=s.matchFragment(t,i);if(l&&(!e||l.validEnd))return z.from(a.map(c=>c.createAndFill()));for(let c=0;c<s.next.length;c++){let{type:u,next:d}=s.next[c];if(!(u.isText||u.hasRequiredAttrs())&&r.indexOf(d)==-1){r.push(d);let h=o(d,a.concat(u));if(h)return h}}return null}return o(this,[])}findWrapping(t){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==t)return this.wrapCache[i+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),i=[{match:this,type:null,via:null}];for(;i.length;){let r=i.shift(),o=r.match;if(o.matchType(t)){let s=[];for(let a=r;a.type;a=a.via)s.push(a.type);return s.reverse()}for(let s=0;s<o.next.length;s++){let{type:a,next:l}=o.next[s];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in e)&&(!r.type||l.validEnd)&&(i.push({match:a.contentMatch,type:a,via:r}),e[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(i){t.push(i);for(let r=0;r<i.next.length;r++)t.indexOf(i.next[r].next)==-1&&e(i.next[r].next)}return e(this),t.map((i,r)=>{let o=r+(i.validEnd?"*":" ")+" ";for(let s=0;s<i.next.length;s++)o+=(s?", ":"")+i.next[s].type.name+"->"+t.indexOf(i.next[s].next);return o}).join(`
`)}};li.empty=new li(!0);var Xl=class{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}};function gp(n){let t=[];do t.push(Gx(n));while(n.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function Gx(n){let t=[];do t.push(jx(n));while(n.next&&n.next!=")"&&n.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function jx(n){let t=Jx(n);for(;;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else if(n.eat("{"))t=Yx(n,t);else break;return t}function ep(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let t=Number(n.next);return n.pos++,t}function Yx(n,t){let e=ep(n),i=e;return n.eat(",")&&(n.next!="}"?i=ep(n):i=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:i,expr:t}}function Xx(n,t){let e=n.nodeTypes,i=e[t];if(i)return[i];let r=[];for(let o in e){let s=e[o];s.isInGroup(t)&&r.push(s)}return r.length==0&&n.err("No node type or group '"+t+"' found"),r}function Jx(n){if(n.eat("(")){let t=gp(n);return n.eat(")")||n.err("Missing closing paren"),t}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let t=Xx(n,n.next).map(e=>(n.inline==null?n.inline=e.isInline:n.inline!=e.isInline&&n.err("Mixing inline and block content"),{type:"name",value:e}));return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function Zx(n){let t=[[]];return r(o(n,0),e()),t;function e(){return t.push([])-1}function i(s,a,l){let c={term:l,to:a};return t[s].push(c),c}function r(s,a){s.forEach(l=>l.to=a)}function o(s,a){if(s.type=="choice")return s.exprs.reduce((l,c)=>l.concat(o(c,a)),[]);if(s.type=="seq")for(let l=0;;l++){let c=o(s.exprs[l],a);if(l==s.exprs.length-1)return c;r(c,a=e())}else if(s.type=="star"){let l=e();return i(a,l),r(o(s.expr,l),l),[i(l)]}else if(s.type=="plus"){let l=e();return r(o(s.expr,a),l),r(o(s.expr,l),l),[i(l)]}else{if(s.type=="opt")return[i(a)].concat(o(s.expr,a));if(s.type=="range"){let l=a;for(let c=0;c<s.min;c++){let u=e();r(o(s.expr,l),u),l=u}if(s.max==-1)r(o(s.expr,l),l);else for(let c=s.min;c<s.max;c++){let u=e();i(l,u),r(o(s.expr,l),u),l=u}return[i(l)]}else{if(s.type=="name")return[i(a,void 0,s.value)];throw new Error("Unknown expr type")}}}}function bp(n,t){return t-n}function tp(n,t){let e=[];return i(t),e.sort(bp);function i(r){let o=n[r];if(o.length==1&&!o[0].term)return i(o[0].to);e.push(r);for(let s=0;s<o.length;s++){let{term:a,to:l}=o[s];!a&&e.indexOf(l)==-1&&i(l)}}}function Qx(n){let t=Object.create(null);return e(tp(n,0));function e(i){let r=[];i.forEach(s=>{n[s].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<r.length;u++)r[u][0]==a&&(c=r[u][1]);tp(n,l).forEach(u=>{c||r.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let o=t[i.join(",")]=new li(i.indexOf(n.length-1)>-1);for(let s=0;s<r.length;s++){let a=r[s][1].sort(bp);o.next.push({type:r[s][0],next:t[a.join(",")]||e(a)})}return o}}function ek(n,t){for(let e=0,i=[n];e<i.length;e++){let r=i[e],o=!r.validEnd,s=[];for(let a=0;a<r.next.length;a++){let{type:l,next:c}=r.next[a];s.push(l.name),o&&!(l.isText||l.hasRequiredAttrs())&&(o=!1),i.indexOf(c)==-1&&i.push(c)}o&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function yp(n){let t=Object.create(null);for(let e in n){let i=n[e];if(!i.hasDefault)return null;t[e]=i.default}return t}function vp(n,t){let e=Object.create(null);for(let i in n){let r=t&&t[i];if(r===void 0){let o=n[i];if(o.hasDefault)r=o.default;else throw new RangeError("No value supplied for attribute "+i)}e[i]=r}return e}function Ep(n,t,e,i){for(let r in t)if(!(r in n))throw new RangeError(`Unsupported attribute ${r} for ${e} of type ${r}`);for(let r in n){let o=n[r];o.validate&&o.validate(t[r])}}function xp(n,t){let e=Object.create(null);if(t)for(let i in t)e[i]=new Jl(n,i,t[i]);return e}var $o=class n{constructor(t,e,i){this.name=t,this.schema=e,this.spec=i,this.markSet=null,this.groups=i.group?i.group.split(" "):[],this.attrs=xp(t,i.attrs),this.defaultAttrs=yp(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(i.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==li.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:vp(this.attrs,t)}create(t=null,e,i){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new yt(this,this.computeAttrs(t),z.from(e),Ee.setFrom(i))}createChecked(t=null,e,i){return e=z.from(e),this.checkContent(e),new yt(this,this.computeAttrs(t),e,Ee.setFrom(i))}createAndFill(t=null,e,i){if(t=this.computeAttrs(t),e=z.from(e),e.size){let s=this.contentMatch.fillBefore(e);if(!s)return null;e=s.append(e)}let r=this.contentMatch.matchFragment(e),o=r&&r.fillBefore(z.empty,!0);return o?new yt(this,t,e.append(o),Ee.setFrom(i)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let i=0;i<t.childCount;i++)if(!this.allowsMarks(t.child(i).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){Ep(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let i=0;i<t.length;i++)this.allowsMarkType(t[i].type)?e&&e.push(t[i]):e||(e=t.slice(0,i));return e?e.length?e:Ee.none:t}static compile(t,e){let i=Object.create(null);t.forEach((o,s)=>i[o]=new n(o,e,s));let r=e.spec.topNode||"doc";if(!i[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!i.text)throw new RangeError("Every schema needs a 'text' type");for(let o in i.text.attrs)throw new RangeError("The text node type should not have attributes");return i}};function tk(n,t,e){let i=e.split("|");return r=>{let o=r===null?"null":typeof r;if(i.indexOf(o)<0)throw new RangeError(`Expected value of type ${i} for attribute ${t} on type ${n}, got ${o}`)}}var Jl=class{constructor(t,e,i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default,this.validate=typeof i.validate=="string"?tk(t,e,i.validate):i.validate}get isRequired(){return!this.hasDefault}},Cr=class n{constructor(t,e,i,r){this.name=t,this.rank=e,this.schema=i,this.spec=r,this.attrs=xp(t,r.attrs),this.excluded=null;let o=yp(this.attrs);this.instance=o?new Ee(this,o):null}create(t=null){return!t&&this.instance?this.instance:new Ee(this,vp(this.attrs,t))}static compile(t,e){let i=Object.create(null),r=0;return t.forEach((o,s)=>i[o]=new n(o,r++,e,s)),i}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){Ep(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}},Oi=class{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let r in t)e[r]=t[r];e.nodes=Ul.from(t.nodes),e.marks=Ul.from(t.marks||{}),this.nodes=$o.compile(this.spec.nodes,this),this.marks=Cr.compile(this.spec.marks,this);let i=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let o=this.nodes[r],s=o.spec.content||"",a=o.spec.marks;if(o.contentMatch=i[s]||(i[s]=li.parse(s,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=a=="_"?null:a?np(this,a.split(" ")):a==""||!o.inlineContent?[]:null}for(let r in this.marks){let o=this.marks[r],s=o.spec.excludes;o.excluded=s==null?[o]:s==""?[]:np(this,s.split(" "))}this.nodeFromJSON=r=>yt.fromJSON(this,r),this.markFromJSON=r=>Ee.fromJSON(this,r),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,i,r){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof $o){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,i,r)}text(t,e){let i=this.nodes.text;return new Yl(i,i.defaultAttrs,t,Ee.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}};function np(n,t){let e=[];for(let i=0;i<t.length;i++){let r=t[i],o=n.marks[r],s=o;if(o)e.push(o);else for(let a in n.marks){let l=n.marks[a];(r=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(r)>-1)&&e.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return e}function nk(n){return n.tag!=null}function ik(n){return n.style!=null}var vt=class n{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let i=this.matchedStyles=[];e.forEach(r=>{if(nk(r))this.tags.push(r);else if(ik(r)){let o=/[^=]*/.exec(r.style)[0];i.indexOf(o)<0&&i.push(o),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let o=t.nodes[r.node];return o.contentMatch.matchType(o)})}parse(t,e={}){let i=new Wo(this,e,!1);return i.addAll(t,Ee.none,e.from,e.to),i.finish()}parseSlice(t,e={}){let i=new Wo(this,e,!0);return i.addAll(t,Ee.none,e.from,e.to),q.maxOpen(i.finish())}matchTag(t,e,i){for(let r=i?this.tags.indexOf(i)+1:0;r<this.tags.length;r++){let o=this.tags[r];if(sk(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){let s=o.getAttrs(t);if(s===!1)continue;o.attrs=s||void 0}return o}}}matchStyle(t,e,i,r){for(let o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){let s=this.styles[o],a=s.style;if(!(a.indexOf(t)!=0||s.context&&!i.matchesContext(s.context)||a.length>t.length&&(a.charCodeAt(t.length)!=61||a.slice(t.length+1)!=e))){if(s.getAttrs){let l=s.getAttrs(e);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(t){let e=[];function i(r){let o=r.priority==null?50:r.priority,s=0;for(;s<e.length;s++){let a=e[s];if((a.priority==null?50:a.priority)<o)break}e.splice(s,0,r)}for(let r in t.marks){let o=t.marks[r].spec.parseDOM;o&&o.forEach(s=>{i(s=rp(s)),s.mark||s.ignore||s.clearMark||(s.mark=r)})}for(let r in t.nodes){let o=t.nodes[r].spec.parseDOM;o&&o.forEach(s=>{i(s=rp(s)),s.node||s.ignore||s.mark||(s.node=r)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new n(t,n.schemaRules(t)))}},kp={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},rk={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},wp={ol:!0,ul:!0},Lr=1,Zl=2,Tr=4;function ip(n,t,e){return t!=null?(t?Lr:0)|(t==="full"?Zl:0):n&&n.whitespace=="pre"?Lr|Zl:e&~Tr}var _i=class{constructor(t,e,i,r,o,s){this.type=t,this.attrs=e,this.marks=i,this.solid=r,this.options=s,this.content=[],this.activeMarks=Ee.none,this.match=o||(s&Tr?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(z.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let i=this.type.contentMatch,r;return(r=i.findWrapping(t.type))?(this.match=i,r):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Lr)){let i=this.content[this.content.length-1],r;if(i&&i.isText&&(r=/[ \t\r\n\u000c]+$/.exec(i.text))){let o=i;i.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-r[0].length))}}let e=z.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!kp.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}},Wo=class{constructor(t,e,i){this.parser=t,this.options=e,this.isOpen=i,this.open=0,this.localPreserveWS=!1;let r=e.topNode,o,s=ip(null,e.preserveWhitespace,0)|(i?Tr:0);r?o=new _i(r.type,r.attrs,Ee.none,!0,e.topMatch||r.type.contentMatch,s):i?o=new _i(null,null,Ee.none,!0,null,s):o=new _i(t.schema.topNodeType,null,Ee.none,!0,null,s),this.nodes=[o],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let i=t.nodeValue,r=this.top,o=r.options&Zl?"full":this.localPreserveWS||(r.options&Lr)>0;if(o==="full"||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(i)){if(o)o!=="full"?i=i.replace(/\r?\n|\r/g," "):i=i.replace(/\r\n?/g,`
`);else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){let s=r.content[r.content.length-1],a=t.previousSibling;(!s||a&&a.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(i=i.slice(1))}i&&this.insertNode(this.parser.schema.text(i),e,!/\S/.test(i)),this.findInText(t)}else this.findInside(t)}addElement(t,e,i){let r=this.localPreserveWS,o=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let s=t.nodeName.toLowerCase(),a;wp.hasOwnProperty(s)&&this.parser.normalizeLists&&ok(t);let l=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(a=this.parser.matchTag(t,this,i));e:if(l?l.ignore:rk.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(t=l.skip);let c,u=this.needsBlock;if(kp.hasOwnProperty(s))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),c=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break e}let d=l&&l.skip?e:this.readStyles(t,e);d&&this.addAll(t,d),c&&this.sync(o),this.needsBlock=u}else{let c=this.readStyles(t,e);c&&this.addElementByRule(t,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=r}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let i=t.style;if(i&&i.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let o=this.parser.matchedStyles[r],s=i.getPropertyValue(o);if(s)for(let a=void 0;;){let l=this.parser.matchStyle(o,s,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?e=e.filter(c=>!l.clearMark(c)):e=e.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return e}addElementByRule(t,e,i,r){let o,s;if(e.node)if(s=this.parser.schema.nodes[e.node],s.isLeaf)this.insertNode(s.create(e.attrs),i,t.nodeName=="BR")||this.leafFallback(t,i);else{let l=this.enter(s,e.attrs||null,i,e.preserveWhitespace);l&&(o=!0,i=l)}else{let l=this.parser.schema.marks[e.mark];i=i.concat(l.create(e.attrs))}let a=this.top;if(s&&s.isLeaf)this.findInside(t);else if(r)this.addElement(t,i,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(l=>this.insertNode(l,i,!1));else{let l=t;typeof e.contentElement=="string"?l=t.querySelector(e.contentElement):typeof e.contentElement=="function"?l=e.contentElement(t):e.contentElement&&(l=e.contentElement),this.findAround(t,l,!0),this.addAll(l,i),this.findAround(t,l,!1)}o&&this.sync(a)&&this.open--}addAll(t,e,i,r){let o=i||0;for(let s=i?t.childNodes[i]:t.firstChild,a=r==null?null:t.childNodes[r];s!=a;s=s.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(s,e);this.findAtPoint(t,o)}findPlace(t,e,i){let r,o;for(let s=this.open,a=0;s>=0;s--){let l=this.nodes[s],c=l.findWrapping(t);if(c&&(!r||r.length>c.length+a)&&(r=c,o=l,!c.length))break;if(l.solid){if(i)break;a+=2}}if(!r)return null;this.sync(o);for(let s=0;s<r.length;s++)e=this.enterInner(r[s],null,e,!1);return e}insertNode(t,e,i){if(t.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(e=this.enterInner(o,null,e))}let r=this.findPlace(t,e,i);if(r){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(t.type));let s=Ee.none;for(let a of r.concat(t.marks))(o.type?o.type.allowsMarkType(a.type):op(a.type,t.type))&&(s=a.addToSet(s));return o.content.push(t.mark(s)),!0}return!1}enter(t,e,i,r){let o=this.findPlace(t.create(e),i,!1);return o&&(o=this.enterInner(t,e,i,!0,r)),o}enterInner(t,e,i,r=!1,o){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(t);let a=ip(t,o,s.options);s.options&Tr&&s.content.length==0&&(a|=Tr);let l=Ee.none;return i=i.filter(c=>(s.type?s.type.allowsMarkType(c.type):op(c.type,t))?(l=c.addToSet(l),!1):!0),this.nodes.push(new _i(t,e,l,r,null,a)),this.open++,i}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=Lr)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let i=this.nodes[e].content;for(let r=i.length-1;r>=0;r--)t+=i[r].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==t&&this.find[i].offset==e&&(this.find[i].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,i){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)&&e.compareDocumentPosition(this.find[r].node)&(i?2:4)&&(this.find[r].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),i=this.options.context,r=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),o=-(i?i.depth+1:0)+(r?0:1),s=(a,l)=>{for(;a>=0;a--){let c=e[a];if(c==""){if(a==e.length-1||a==0)continue;for(;l>=o;l--)if(s(a-1,l))return!0;return!1}else{let u=l>0||l==0&&r?this.nodes[l].type:i&&l>=o?i.node(l-o).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let i=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(i&&i.isTextblock&&i.defaultAttrs)return i}for(let e in this.parser.schema.nodes){let i=this.parser.schema.nodes[e];if(i.isTextblock&&i.defaultAttrs)return i}}};function ok(n){for(let t=n.firstChild,e=null;t;t=t.nextSibling){let i=t.nodeType==1?t.nodeName.toLowerCase():null;i&&wp.hasOwnProperty(i)&&e?(e.appendChild(t),t=e):i=="li"?e=t:i&&(e=null)}}function sk(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function rp(n){let t={};for(let e in n)t[e]=n[e];return t}function op(n,t){let e=t.schema.nodes;for(let i in e){let r=e[i];if(!r.allowsMarkType(n))continue;let o=[],s=a=>{o.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==t||o.indexOf(u)<0&&s(u))return!0}};if(s(r.contentMatch))return!0}}var qt=class n{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},i){i||(i=ql(e).createDocumentFragment());let r=i,o=[];return t.forEach(s=>{if(o.length||s.marks.length){let a=0,l=0;for(;a<o.length&&l<s.marks.length;){let c=s.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(o[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<o.length;)r=o.pop()[1];for(;l<s.marks.length;){let c=s.marks[l++],u=this.serializeMark(c,s.isInline,e);u&&(o.push([c,r]),r.appendChild(u.dom),r=u.contentDOM||u.dom)}}r.appendChild(this.serializeNodeInner(s,e))}),i}serializeNodeInner(t,e){let{dom:i,contentDOM:r}=Fo(ql(e),this.nodes[t.type.name](t),null,t.attrs);if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return i}serializeNode(t,e={}){let i=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(i),i=o.dom)}return i}serializeMark(t,e,i={}){let r=this.marks[t.type.name];return r&&Fo(ql(i),r(t,e),null,t.attrs)}static renderSpec(t,e,i=null,r){return Fo(t,e,i,r)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new n(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=sp(t.nodes);return e.text||(e.text=i=>i.text),e}static marksFromSchema(t){return sp(t.marks)}};function sp(n){let t={};for(let e in n){let i=n[e].spec.toDOM;i&&(t[e]=i)}return t}function ql(n){return n.document||window.document}var ap=new WeakMap;function ak(n){let t=ap.get(n);return t===void 0&&ap.set(n,t=lk(n)),t}function lk(n){let t=null;function e(i){if(i&&typeof i=="object")if(Array.isArray(i))if(typeof i[0]=="string")t||(t=[]),t.push(i);else for(let r=0;r<i.length;r++)e(i[r]);else for(let r in i)e(i[r])}return e(n),t}function Fo(n,t,e,i){if(typeof t=="string")return{dom:n.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let r=t[0],o;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(i&&(o=ak(i))&&o.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=r.indexOf(" ");s>0&&(e=r.slice(0,s),r=r.slice(s+1));let a,l=e?n.createElementNS(e,r):n.createElement(r),c=t[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<t.length;d++){let h=t[d];if(h===0){if(d<t.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:f}=Fo(n,h,e,i);if(l.appendChild(p),f){if(a)throw new RangeError("Multiple content holes");a=f}}}return{dom:l,contentDOM:a}}var Tp=65535,Cp=Math.pow(2,16);function ck(n,t){return n+t*Cp}function Sp(n){return n&Tp}function uk(n){return(n-(n&Tp))/Cp}var Lp=1,Rp=2,Uo=4,Ap=8,Ir=class{constructor(t,e,i){this.pos=t,this.delInfo=e,this.recover=i}get deleted(){return(this.delInfo&Ap)>0}get deletedBefore(){return(this.delInfo&(Lp|Uo))>0}get deletedAfter(){return(this.delInfo&(Rp|Uo))>0}get deletedAcross(){return(this.delInfo&Uo)>0}},pn=class n{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&n.empty)return n.empty}recover(t){let e=0,i=Sp(t);if(!this.inverted)for(let r=0;r<i;r++)e+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[i*3]+e+uk(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,i){let r=0,o=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>t)break;let c=this.ranges[a+o],u=this.ranges[a+s],d=l+c;if(t<=d){let h=c?t==l?-1:t==d?1:e:e,p=l+r+(h<0?0:u);if(i)return p;let f=t==(e<0?l:d)?null:ck(a/3,t-l),g=t==l?Rp:t==d?Lp:Uo;return(e<0?t!=l:t!=d)&&(g|=Ap),new Ir(p,g,f)}r+=u-c}return i?t+r:new Ir(t+r,0,null)}touches(t,e){let i=0,r=Sp(e),o=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>t)break;let c=this.ranges[a+o],u=l+c;if(t<=u&&a==r*3)return!0;i+=this.ranges[a+s]-c}return!1}forEach(t){let e=this.inverted?2:1,i=this.inverted?1:2;for(let r=0,o=0;r<this.ranges.length;r+=3){let s=this.ranges[r],a=s-(this.inverted?o:0),l=s+(this.inverted?0:o),c=this.ranges[r+e],u=this.ranges[r+i];t(a,a+c,l,l+u),o+=u-c}}invert(){return new n(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?n.empty:new n(t<0?[0,-t,0]:[0,0,t])}};pn.empty=new pn([]);var Nr=class n{constructor(t,e,i=0,r=t?t.length:0){this.mirror=e,this.from=i,this.to=r,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new n(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,i=this._maps.length;e<t._maps.length;e++){let r=t.getMirror(e);this.appendMap(t._maps[e],r!=null&&r<e?i+r:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,i=this._maps.length+t._maps.length;e>=0;e--){let r=t.getMirror(e);this.appendMap(t._maps[e].invert(),r!=null&&r>e?i-r-1:void 0)}}invert(){let t=new n;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let i=this.from;i<this.to;i++)t=this._maps[i].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,i){let r=0;for(let o=this.from;o<this.to;o++){let s=this._maps[o],a=s.mapResult(t,e);if(a.recover!=null){let l=this.getMirror(o);if(l!=null&&l>o&&l<this.to){o=l,t=this._maps[l].recover(a.recover);continue}}r|=a.delInfo,t=a.pos}return i?t:new Ir(t,r,null)}},Ql=Object.create(null),Ge=class{getMap(){return pn.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let i=Ql[e.stepType];if(!i)throw new RangeError(`No step type ${e.stepType} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in Ql)throw new RangeError("Duplicate use of step JSON ID "+t);return Ql[t]=e,e.prototype.jsonID=t,e}},et=class n{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new n(t,null)}static fail(t){return new n(null,t)}static fromReplace(t,e,i,r){try{return n.ok(t.replace(e,i,r))}catch(o){if(o instanceof si)return n.fail(o.message);throw o}}};function rc(n,t,e){let i=[];for(let r=0;r<n.childCount;r++){let o=n.child(r);o.content.size&&(o=o.copy(rc(o.content,t,o))),o.isInline&&(o=t(o,e,r)),i.push(o)}return z.fromArray(i)}var Pr=class n extends Ge{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=t.resolve(this.from),r=i.node(i.sharedDepth(this.to)),o=new q(rc(e.content,(s,a)=>!s.isAtom||!a.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),r),e.openStart,e.openEnd);return et.fromReplace(t,this.from,this.to,o)}invert(){return new fn(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new n(e.pos,i.pos,this.mark)}merge(t){return t instanceof n&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new n(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new n(e.from,e.to,t.markFromJSON(e.mark))}};Ge.jsonID("addMark",Pr);var fn=class n extends Ge{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=new q(rc(e.content,r=>r.mark(this.mark.removeFromSet(r.marks)),t),e.openStart,e.openEnd);return et.fromReplace(t,this.from,this.to,i)}invert(){return new Pr(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new n(e.pos,i.pos,this.mark)}merge(t){return t instanceof n&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new n(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new n(e.from,e.to,t.markFromJSON(e.mark))}};Ge.jsonID("removeMark",fn);var _r=class n extends Ge{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return et.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return et.fromReplace(t,this.pos,this.pos+1,new q(z.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let i=this.mark.addToSet(e.marks);if(i.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(i))return new n(this.pos,e.marks[r]);return new n(this.pos,this.mark)}}return new Di(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new n(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new n(e.pos,t.markFromJSON(e.mark))}};Ge.jsonID("addNodeMark",_r);var Di=class n extends Ge{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return et.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return et.fromReplace(t,this.pos,this.pos+1,new q(z.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new _r(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new n(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new n(e.pos,t.markFromJSON(e.mark))}};Ge.jsonID("removeNodeMark",Di);var st=class n extends Ge{constructor(t,e,i,r=!1){super(),this.from=t,this.to=e,this.slice=i,this.structure=r}apply(t){return this.structure&&nc(t,this.from,this.to)?et.fail("Structure replace would overwrite content"):et.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new pn([this.from,this.to-this.from,this.slice.size])}invert(t){return new n(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deletedAcross&&i.deletedAcross?null:new n(e.pos,Math.max(e.pos,i.pos),this.slice,this.structure)}merge(t){if(!(t instanceof n)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?q.empty:new q(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new n(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?q.empty:new q(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new n(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new n(e.from,e.to,q.fromJSON(t,e.slice),!!e.structure)}};Ge.jsonID("replace",st);var ze=class n extends Ge{constructor(t,e,i,r,o,s,a=!1){super(),this.from=t,this.to=e,this.gapFrom=i,this.gapTo=r,this.slice=o,this.insert=s,this.structure=a}apply(t){if(this.structure&&(nc(t,this.from,this.gapFrom)||nc(t,this.gapTo,this.to)))return et.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return et.fail("Gap is not a flat range");let i=this.slice.insertAt(this.insert,e.content);return i?et.fromReplace(t,this.from,this.to,i):et.fail("Content does not fit in gap")}getMap(){return new pn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new n(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1),r=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),o=this.to==this.gapTo?i.pos:t.map(this.gapTo,1);return e.deletedAcross&&i.deletedAcross||r<e.pos||o>i.pos?null:new n(e.pos,i.pos,r,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new n(e.from,e.to,e.gapFrom,e.gapTo,q.fromJSON(t,e.slice),e.insert,!!e.structure)}};Ge.jsonID("replaceAround",ze);function nc(n,t,e){let i=n.resolve(t),r=e-t,o=i.depth;for(;r>0&&o>0&&i.indexAfter(o)==i.node(o).childCount;)o--,r--;if(r>0){let s=i.node(o).maybeChild(i.indexAfter(o));for(;r>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,r--}}return!1}function dk(n,t,e,i){let r=[],o=[],s,a;n.doc.nodesBetween(t,e,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!i.isInSet(d)&&u.type.allowsMarkType(i.type)){let h=Math.max(c,t),p=Math.min(c+l.nodeSize,e),f=i.addToSet(d);for(let g=0;g<d.length;g++)d[g].isInSet(f)||(s&&s.to==h&&s.mark.eq(d[g])?s.to=p:r.push(s=new fn(h,p,d[g])));a&&a.to==h?a.to=p:o.push(a=new Pr(h,p,i))}}),r.forEach(l=>n.step(l)),o.forEach(l=>n.step(l))}function hk(n,t,e,i){let r=[],o=0;n.doc.nodesBetween(t,e,(s,a)=>{if(!s.isInline)return;o++;let l=null;if(i instanceof Cr){let c=s.marks,u;for(;u=i.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else i?i.isInSet(s.marks)&&(l=[i]):l=s.marks;if(l&&l.length){let c=Math.min(a+s.nodeSize,e);for(let u=0;u<l.length;u++){let d=l[u],h;for(let p=0;p<r.length;p++){let f=r[p];f.step==o-1&&d.eq(r[p].style)&&(h=f)}h?(h.to=c,h.step=o):r.push({style:d,from:Math.max(a,t),to:c,step:o})}}}),r.forEach(s=>n.step(new fn(s.from,s.to,s.style)))}function oc(n,t,e,i=e.contentMatch,r=!0){let o=n.doc.nodeAt(t),s=[],a=t+1;for(let l=0;l<o.childCount;l++){let c=o.child(l),u=a+c.nodeSize,d=i.matchType(c.type);if(!d)s.push(new st(a,u,q.empty));else{i=d;for(let h=0;h<c.marks.length;h++)e.allowsMarkType(c.marks[h].type)||n.step(new fn(a,u,c.marks[h]));if(r&&c.isText&&e.whitespace!="pre"){let h,p=/\r?\n|\r/g,f;for(;h=p.exec(c.text);)f||(f=new q(z.from(e.schema.text(" ",e.allowedMarks(c.marks))),0,0)),s.push(new st(a+h.index,a+h.index+h[0].length,f))}}a=u}if(!i.validEnd){let l=i.fillBefore(z.empty,!0);n.replace(a,a,new q(l,0,0))}for(let l=s.length-1;l>=0;l--)n.step(s[l])}function pk(n,t,e){return(t==0||n.canReplace(t,n.childCount))&&(e==n.childCount||n.canReplace(0,e))}function mn(n){let e=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let i=n.depth;;--i){let r=n.$from.node(i),o=n.$from.index(i),s=n.$to.indexAfter(i);if(i<n.depth&&r.canReplace(o,s,e))return i;if(i==0||r.type.spec.isolating||!pk(r,o,s))break}return null}function fk(n,t,e){let{$from:i,$to:r,depth:o}=t,s=i.before(o+1),a=r.after(o+1),l=s,c=a,u=z.empty,d=0;for(let f=o,g=!1;f>e;f--)g||i.index(f)>0?(g=!0,u=z.from(i.node(f).copy(u)),d++):l--;let h=z.empty,p=0;for(let f=o,g=!1;f>e;f--)g||r.after(f+1)<r.end(f)?(g=!0,h=z.from(r.node(f).copy(h)),p++):c++;n.step(new ze(l,c,s,a,new q(u.append(h),d,p),u.size-d,!0))}function Hi(n,t,e=null,i=n){let r=mk(n,t),o=r&&gk(i,t);return o?r.map(Mp).concat({type:t,attrs:e}).concat(o.map(Mp)):null}function Mp(n){return{type:n,attrs:null}}function mk(n,t){let{parent:e,startIndex:i,endIndex:r}=n,o=e.contentMatchAt(i).findWrapping(t);if(!o)return null;let s=o.length?o[0]:t;return e.canReplaceWith(i,r,s)?o:null}function gk(n,t){let{parent:e,startIndex:i,endIndex:r}=n,o=e.child(i),s=t.contentMatch.findWrapping(o.type);if(!s)return null;let l=(s.length?s[s.length-1]:t).contentMatch;for(let c=i;l&&c<r;c++)l=l.matchType(e.child(c).type);return!l||!l.validEnd?null:s}function bk(n,t,e){let i=z.empty;for(let s=e.length-1;s>=0;s--){if(i.size){let a=e[s].type.contentMatch.matchFragment(i);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=z.from(e[s].type.create(e[s].attrs,i))}let r=t.start,o=t.end;n.step(new ze(r,o,r,o,new q(i,0,0),e.length,!0))}function yk(n,t,e,i,r){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=n.steps.length;n.doc.nodesBetween(t,e,(s,a)=>{let l=typeof r=="function"?r(s):r;if(s.isTextblock&&!s.hasMarkup(i,l)&&vk(n.doc,n.mapping.slice(o).map(a),i)){let c=null;if(i.schema.linebreakReplacement){let p=i.whitespace=="pre",f=!!i.contentMatch.matchType(i.schema.linebreakReplacement);p&&!f?c=!1:!p&&f&&(c=!0)}c===!1&&Np(n,s,a,o),oc(n,n.mapping.slice(o).map(a,1),i,void 0,c===null);let u=n.mapping.slice(o),d=u.map(a,1),h=u.map(a+s.nodeSize,1);return n.step(new ze(d,h,d+1,h-1,new q(z.from(i.create(l,null,s.marks)),0,0),1,!0)),c===!0&&Ip(n,s,a,o),!1}})}function Ip(n,t,e,i){t.forEach((r,o)=>{if(r.isText){let s,a=/\r?\n|\r/g;for(;s=a.exec(r.text);){let l=n.mapping.slice(i).map(e+1+o+s.index);n.replaceWith(l,l+1,t.type.schema.linebreakReplacement.create())}}})}function Np(n,t,e,i){t.forEach((r,o)=>{if(r.type==r.type.schema.linebreakReplacement){let s=n.mapping.slice(i).map(e+1+o);n.replaceWith(s,s+1,t.type.schema.text(`
`))}})}function vk(n,t,e){let i=n.resolve(t),r=i.index();return i.parent.canReplaceWith(r,r+1,e)}function Ek(n,t,e,i,r){let o=n.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);let s=e.create(i,null,r||o.marks);if(o.isLeaf)return n.replaceWith(t,t+o.nodeSize,s);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);n.step(new ze(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new q(z.from(s),0,0),1,!0))}function Lt(n,t,e=1,i){let r=n.resolve(t),o=r.depth-e,s=i&&i[i.length-1]||r.parent;if(o<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!s.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,u=e-2;c>o;c--,u--){let d=r.node(c),h=r.index(c);if(d.type.spec.isolating)return!1;let p=d.content.cutByIndex(h,d.childCount),f=i&&i[u+1];f&&(p=p.replaceChild(0,f.type.create(f.attrs)));let g=i&&i[u]||d;if(!d.canReplace(h+1,d.childCount)||!g.type.validContent(p))return!1}let a=r.indexAfter(o),l=i&&i[0];return r.node(o).canReplaceWith(a,a,l?l.type:r.node(o+1).type)}function xk(n,t,e=1,i){let r=n.doc.resolve(t),o=z.empty,s=z.empty;for(let a=r.depth,l=r.depth-e,c=e-1;a>l;a--,c--){o=z.from(r.node(a).copy(o));let u=i&&i[c];s=z.from(u?u.type.create(u.attrs,s):r.node(a).copy(s))}n.step(new st(t,t,new q(o.append(s),e,e),!0))}function Pt(n,t){let e=n.resolve(t),i=e.index();return Pp(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(i,i+1)}function kk(n,t){t.content.size||n.type.compatibleContent(t.type);let e=n.contentMatchAt(n.childCount),{linebreakReplacement:i}=n.type.schema;for(let r=0;r<t.childCount;r++){let o=t.child(r),s=o.type==i?n.type.schema.nodes.text:o.type;if(e=e.matchType(s),!e||!n.type.allowsMarks(o.marks))return!1}return e.validEnd}function Pp(n,t){return!!(n&&t&&!n.isLeaf&&kk(n,t))}function ci(n,t,e=-1){let i=n.resolve(t);for(let r=i.depth;;r--){let o,s,a=i.index(r);if(r==i.depth?(o=i.nodeBefore,s=i.nodeAfter):e>0?(o=i.node(r+1),a++,s=i.node(r).maybeChild(a)):(o=i.node(r).maybeChild(a-1),s=i.node(r+1)),o&&!o.isTextblock&&Pp(o,s)&&i.node(r).canReplace(a,a+1))return t;if(r==0)break;t=e<0?i.before(r):i.after(r)}}function wk(n,t,e){let i=null,{linebreakReplacement:r}=n.doc.type.schema,o=n.doc.resolve(t-e),s=o.node().type;if(r&&s.inlineContent){let u=s.whitespace=="pre",d=!!s.contentMatch.matchType(r);u&&!d?i=!1:!u&&d&&(i=!0)}let a=n.steps.length;if(i===!1){let u=n.doc.resolve(t+e);Np(n,u.node(),u.before(),a)}s.inlineContent&&oc(n,t+e-1,s,o.node().contentMatchAt(o.index()),i==null);let l=n.mapping.slice(a),c=l.map(t-e);if(n.step(new st(c,l.map(t+e,-1),q.empty,!0)),i===!0){let u=n.doc.resolve(c);Ip(n,u.node(),u.before(),n.steps.length)}return n}function Sk(n,t,e){let i=n.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),e))return t;if(i.parentOffset==0)for(let r=i.depth-1;r>=0;r--){let o=i.index(r);if(i.node(r).canReplaceWith(o,o,e))return i.before(r+1);if(o>0)return null}if(i.parentOffset==i.parent.content.size)for(let r=i.depth-1;r>=0;r--){let o=i.indexAfter(r);if(i.node(r).canReplaceWith(o,o,e))return i.after(r+1);if(o<i.node(r).childCount)return null}return null}function Go(n,t,e){let i=n.resolve(t);if(!e.content.size)return t;let r=e.content;for(let o=0;o<e.openStart;o++)r=r.firstChild.content;for(let o=1;o<=(e.openStart==0&&e.size?2:1);o++)for(let s=i.depth;s>=0;s--){let a=s==i.depth?0:i.pos<=(i.start(s+1)+i.end(s+1))/2?-1:1,l=i.index(s)+(a>0?1:0),c=i.node(s),u=!1;if(o==1)u=c.canReplace(l,l,r);else{let d=c.contentMatchAt(l).findWrapping(r.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?i.pos:a<0?i.before(s+1):i.after(s+1)}return null}function Or(n,t,e=t,i=q.empty){if(t==e&&!i.size)return null;let r=n.resolve(t),o=n.resolve(e);return _p(r,o,i)?new st(t,e,i):new ic(r,o,i).fit()}function _p(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}var ic=class{constructor(t,e,i){this.$from=t,this.$to=e,this.unplaced=i,this.frontier=[],this.placed=z.empty;for(let r=0;r<=t.depth;r++){let o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}for(let r=t.depth;r>0;r--)this.placed=z.from(t.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,i=this.$from,r=this.close(t<0?this.$to:i.doc.resolve(t));if(!r)return null;let o=this.placed,s=i.depth,a=r.depth;for(;s&&a&&o.childCount==1;)o=o.firstChild.content,s--,a--;let l=new q(o,s,a);return t>-1?new ze(i.pos,t,this.$to.pos,this.$to.end(),l,e):l.size||i.pos!=this.$to.pos?new st(i.pos,r.pos,l):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,i=0,r=this.unplaced.openEnd;i<t;i++){let o=e.firstChild;if(e.childCount>1&&(r=0),o.type.spec.isolating&&r<=i){t=i;break}e=o.content}for(let e=1;e<=2;e++)for(let i=e==1?t:this.unplaced.openStart;i>=0;i--){let r,o=null;i?(o=ec(this.unplaced.content,i-1).firstChild,r=o.content):r=this.unplaced.content;let s=r.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(e==1&&(s?c.matchType(s.type)||(d=c.fillBefore(z.from(s),!1)):o&&l.compatibleContent(o.type)))return{sliceDepth:i,frontierDepth:a,parent:o,inject:d};if(e==2&&s&&(u=c.findWrapping(s.type)))return{sliceDepth:i,frontierDepth:a,parent:o,wrap:u};if(o&&c.matchType(o.type))break}}}openMore(){let{content:t,openStart:e,openEnd:i}=this.unplaced,r=ec(t,e);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new q(t,e+1,Math.max(i,r.size+e>=t.size-i?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:i}=this.unplaced,r=ec(t,e);if(r.childCount<=1&&e>0){let o=t.size-e<=e+r.size;this.unplaced=new q(Rr(t,e-1,1),e-1,o?e-1:i)}else this.unplaced=new q(Rr(t,e,1),e,i)}placeNodes({sliceDepth:t,frontierDepth:e,parent:i,inject:r,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let g=0;g<o.length;g++)this.openFrontierNode(o[g]);let s=this.unplaced,a=i?i.content:s.content,l=s.openStart-t,c=0,u=[],{match:d,type:h}=this.frontier[e];if(r){for(let g=0;g<r.childCount;g++)u.push(r.child(g));d=d.matchFragment(r)}let p=a.size+t-(s.content.size-s.openEnd);for(;c<a.childCount;){let g=a.child(c),m=d.matchType(g.type);if(!m)break;c++,(c>1||l==0||g.content.size)&&(d=m,u.push(Op(g.mark(h.allowedMarks(g.marks)),c==1?l:0,c==a.childCount?p:-1)))}let f=c==a.childCount;f||(p=-1),this.placed=Ar(this.placed,e,z.from(u)),this.frontier[e].match=d,f&&p<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,m=a;g<p;g++){let b=m.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),m=b.content}this.unplaced=f?t==0?q.empty:new q(Rr(s.content,t-1,1),t-1,p<0?s.openEnd:t-1):new q(Rr(s.content,t,c),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!tc(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:i}=this.$to,r=this.$to.after(i);for(;i>1&&r==this.$to.end(--i);)++r;return r}findCloseLevel(t){e:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:i,type:r}=this.frontier[e],o=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=tc(t,e,r,i,o);if(s){for(let a=e-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=tc(t,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:e,fit:s,move:o?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Ar(this.placed,e.depth,e.fit)),t=e.move;for(let i=e.depth+1;i<=t.depth;i++){let r=t.node(i),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(i));this.openFrontierNode(r.type,r.attrs,o)}return t}openFrontierNode(t,e=null,i){let r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Ar(this.placed,this.depth,z.from(t.create(e,i))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(z.empty,!0);e.childCount&&(this.placed=Ar(this.placed,this.frontier.length,e))}};function Rr(n,t,e){return t==0?n.cutByIndex(e,n.childCount):n.replaceChild(0,n.firstChild.copy(Rr(n.firstChild.content,t-1,e)))}function Ar(n,t,e){return t==0?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(Ar(n.lastChild.content,t-1,e)))}function ec(n,t){for(let e=0;e<t;e++)n=n.firstChild.content;return n}function Op(n,t,e){if(t<=0)return n;let i=n.content;return t>1&&(i=i.replaceChild(0,Op(i.firstChild,t-1,i.childCount==1?e-1:0))),t>0&&(i=n.type.contentMatch.fillBefore(i).append(i),e<=0&&(i=i.append(n.type.contentMatch.matchFragment(i).fillBefore(z.empty,!0)))),n.copy(i)}function tc(n,t,e,i,r){let o=n.node(t),s=r?n.indexAfter(t):n.index(t);if(s==o.childCount&&!e.compatibleContent(o.type))return null;let a=i.fillBefore(o.content,!0,s);return a&&!Mk(e,o.content,s)?a:null}function Mk(n,t,e){for(let i=e;i<t.childCount;i++)if(!n.allowsMarks(t.child(i).marks))return!0;return!1}function Tk(n){return n.spec.defining||n.spec.definingForContent}function Ck(n,t,e,i){if(!i.size)return n.deleteRange(t,e);let r=n.doc.resolve(t),o=n.doc.resolve(e);if(_p(r,o,i))return n.step(new st(t,e,i));let s=Bp(r,n.doc.resolve(e));s[s.length-1]==0&&s.pop();let a=-(r.depth+1);s.unshift(a);for(let h=r.depth,p=r.pos-1;h>0;h--,p--){let f=r.node(h).type.spec;if(f.defining||f.definingAsContext||f.isolating)break;s.indexOf(h)>-1?a=h:r.before(h)==p&&s.splice(1,0,-h)}let l=s.indexOf(a),c=[],u=i.openStart;for(let h=i.content,p=0;;p++){let f=h.firstChild;if(c.push(f),p==i.openStart)break;h=f.content}for(let h=u-1;h>=0;h--){let p=c[h],f=Tk(p.type);if(f&&!p.sameMarkup(r.node(Math.abs(a)-1)))u=h;else if(f||!p.type.isTextblock)break}for(let h=i.openStart;h>=0;h--){let p=(h+u+1)%(i.openStart+1),f=c[p];if(f)for(let g=0;g<s.length;g++){let m=s[(g+l)%s.length],b=!0;m<0&&(b=!1,m=-m);let y=r.node(m-1),v=r.index(m-1);if(y.canReplaceWith(v,v,f.type,f.marks))return n.replace(r.before(m),b?o.after(m):e,new q(Dp(i.content,0,i.openStart,p),p,i.openEnd))}}let d=n.steps.length;for(let h=s.length-1;h>=0&&(n.replace(t,e,i),!(n.steps.length>d));h--){let p=s[h];p<0||(t=r.before(p),e=o.after(p))}}function Dp(n,t,e,i,r){if(t<e){let o=n.firstChild;n=n.replaceChild(0,o.copy(Dp(o.content,t+1,e,i,o)))}if(t>i){let o=r.contentMatchAt(0),s=o.fillBefore(n).append(n);n=s.append(o.matchFragment(s).fillBefore(z.empty,!0))}return n}function Lk(n,t,e,i){if(!i.isInline&&t==e&&n.doc.resolve(t).parent.content.size){let r=Sk(n.doc,t,i.type);r!=null&&(t=e=r)}n.replaceRange(t,e,new q(z.from(i),0,0))}function Rk(n,t,e){let i=n.doc.resolve(t),r=n.doc.resolve(e),o=Bp(i,r);for(let s=0;s<o.length;s++){let a=o[s],l=s==o.length-1;if(l&&a==0||i.node(a).type.contentMatch.validEnd)return n.delete(i.start(a),r.end(a));if(a>0&&(l||i.node(a-1).canReplace(i.index(a-1),r.indexAfter(a-1))))return n.delete(i.before(a),r.after(a))}for(let s=1;s<=i.depth&&s<=r.depth;s++)if(t-i.start(s)==i.depth-s&&e>i.end(s)&&r.end(s)-e!=r.depth-s&&i.start(s-1)==r.start(s-1)&&i.node(s-1).canReplace(i.index(s-1),r.index(s-1)))return n.delete(i.before(s),e);n.delete(t,e)}function Bp(n,t){let e=[],i=Math.min(n.depth,t.depth);for(let r=i;r>=0;r--){let o=n.start(r);if(o<n.pos-(n.depth-r)||t.end(r)>t.pos+(t.depth-r)||n.node(r).type.spec.isolating||t.node(r).type.spec.isolating)break;(o==t.start(r)||r==n.depth&&r==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&r&&t.start(r-1)==o-1)&&e.push(r)}return e}var Ko=class n extends Ge{constructor(t,e,i){super(),this.pos=t,this.attr=e,this.value=i}apply(t){let e=t.nodeAt(this.pos);if(!e)return et.fail("No node at attribute step's position");let i=Object.create(null);for(let o in e.attrs)i[o]=e.attrs[o];i[this.attr]=this.value;let r=e.type.create(i,null,e.marks);return et.fromReplace(t,this.pos,this.pos+1,new q(z.from(r),0,e.isLeaf?0:1))}getMap(){return pn.empty}invert(t){return new n(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new n(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new n(e.pos,e.attr,e.value)}};Ge.jsonID("attr",Ko);var qo=class n extends Ge{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let r in t.attrs)e[r]=t.attrs[r];e[this.attr]=this.value;let i=t.type.create(e,t.content,t.marks);return et.ok(i)}getMap(){return pn.empty}invert(t){return new n(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new n(e.attr,e.value)}};Ge.jsonID("docAttr",qo);var Bi=class extends Error{};Bi=function n(t){let e=Error.call(this,t);return e.__proto__=n.prototype,e};Bi.prototype=Object.create(Error.prototype);Bi.prototype.constructor=Bi;Bi.prototype.name="TransformError";var Fi=class{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Nr}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new Bi(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,i=q.empty){let r=Or(this.doc,t,e,i);return r&&this.step(r),this}replaceWith(t,e,i){return this.replace(t,e,new q(z.from(i),0,0))}delete(t,e){return this.replace(t,e,q.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,i){return Ck(this,t,e,i),this}replaceRangeWith(t,e,i){return Lk(this,t,e,i),this}deleteRange(t,e){return Rk(this,t,e),this}lift(t,e){return fk(this,t,e),this}join(t,e=1){return wk(this,t,e),this}wrap(t,e){return bk(this,t,e),this}setBlockType(t,e=t,i,r=null){return yk(this,t,e,i,r),this}setNodeMarkup(t,e,i=null,r){return Ek(this,t,e,i,r),this}setNodeAttribute(t,e,i){return this.step(new Ko(t,e,i)),this}setDocAttribute(t,e){return this.step(new qo(t,e)),this}addNodeMark(t,e){return this.step(new _r(t,e)),this}removeNodeMark(t,e){let i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at position "+t);if(e instanceof Ee)e.isInSet(i.marks)&&this.step(new Di(t,e));else{let r=i.marks,o,s=[];for(;o=e.isInSet(r);)s.push(new Di(t,o)),r=o.removeFromSet(r);for(let a=s.length-1;a>=0;a--)this.step(s[a])}return this}split(t,e=1,i){return xk(this,t,e,i),this}addMark(t,e,i){return dk(this,t,e,i),this}removeMark(t,e,i){return hk(this,t,e,i),this}clearIncompatible(t,e,i){return oc(this,t,e,i),this}};var sc=Object.create(null),ie=class{constructor(t,e,i){this.$anchor=t,this.$head=e,this.ranges=i||[new Yo(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=q.empty){let i=e.content.lastChild,r=null;for(let a=0;a<e.openEnd;a++)r=i,i=i.lastChild;let o=t.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],u=t.mapping.slice(o);t.replaceRange(u.map(l.pos),u.map(c.pos),a?q.empty:e),a==0&&zp(t,o,(i?i.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let i=t.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:s,$to:a}=r[o],l=t.mapping.slice(i),c=l.map(s.pos),u=l.map(a.pos);o?t.deleteRange(c,u):(t.replaceRangeWith(c,u,e),zp(t,i,e.isInline?-1:1))}}static findFrom(t,e,i=!1){let r=t.parent.inlineContent?new j(t):zi(t.node(0),t.parent,t.pos,t.index(),e,i);if(r)return r;for(let o=t.depth-1;o>=0;o--){let s=e<0?zi(t.node(0),t.node(o),t.before(o+1),t.index(o),e,i):zi(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,i);if(s)return s}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new ht(t.node(0))}static atStart(t){return zi(t,t,0,0,1)||new ht(t)}static atEnd(t){return zi(t,t,t.content.size,t.childCount,-1)||new ht(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let i=sc[e.type];if(!i)throw new RangeError(`No selection type ${e.type} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in sc)throw new RangeError("Duplicate use of selection JSON ID "+t);return sc[t]=e,e.prototype.jsonID=t,e}getBookmark(){return j.between(this.$anchor,this.$head).getBookmark()}};ie.prototype.visible=!0;var Yo=class{constructor(t,e){this.$from=t,this.$to=e}},Fp=!1;function Hp(n){!Fp&&!n.parent.inlineContent&&(Fp=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}var j=class n extends ie{constructor(t,e=t){Hp(t),Hp(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let i=t.resolve(e.map(this.head));if(!i.parent.inlineContent)return ie.near(i);let r=t.resolve(e.map(this.anchor));return new n(r.parent.inlineContent?r:i,i)}replace(t,e=q.empty){if(super.replace(t,e),e==q.empty){let i=this.$from.marksAcross(this.$to);i&&t.ensureMarks(i)}}eq(t){return t instanceof n&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Xo(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new n(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,i=e){let r=t.resolve(e);return new this(r,i==e?r:t.resolve(i))}static between(t,e,i){let r=t.pos-e.pos;if((!i||r)&&(i=r>=0?1:-1),!e.parent.inlineContent){let o=ie.findFrom(e,i,!0)||ie.findFrom(e,-i,!0);if(o)e=o.$head;else return ie.near(e,i)}return t.parent.inlineContent||(r==0?t=e:(t=(ie.findFrom(t,-i,!0)||ie.findFrom(t,i,!0)).$anchor,t.pos<e.pos!=r<0&&(t=e))),new n(t,e)}};ie.jsonID("text",j);var Xo=class n{constructor(t,e){this.anchor=t,this.head=e}map(t){return new n(t.map(this.anchor),t.map(this.head))}resolve(t){return j.between(t.resolve(this.anchor),t.resolve(this.head))}},Y=class n extends ie{constructor(t){let e=t.nodeAfter,i=t.node(0).resolve(t.pos+e.nodeSize);super(t,i),this.node=e}map(t,e){let{deleted:i,pos:r}=e.mapResult(this.anchor),o=t.resolve(r);return i?ie.near(o):new n(o)}content(){return new q(z.from(this.node),0,0)}eq(t){return t instanceof n&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new lc(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new n(t.resolve(e.anchor))}static create(t,e){return new n(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}};Y.prototype.visible=!1;ie.jsonID("node",Y);var lc=class n{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:i}=t.mapResult(this.anchor);return e?new Xo(i,i):new n(i)}resolve(t){let e=t.resolve(this.anchor),i=e.nodeAfter;return i&&Y.isSelectable(i)?new Y(e):ie.near(e)}},ht=class n extends ie{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=q.empty){if(e==q.empty){t.delete(0,t.doc.content.size);let i=ie.atStart(t.doc);i.eq(t.selection)||t.setSelection(i)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new n(t)}map(t){return new n(t)}eq(t){return t instanceof n}getBookmark(){return Ak}};ie.jsonID("all",ht);var Ak={map(){return this},resolve(n){return new ht(n)}};function zi(n,t,e,i,r,o=!1){if(t.inlineContent)return j.create(n,e);for(let s=i-(r>0?0:1);r>0?s<t.childCount:s>=0;s+=r){let a=t.child(s);if(a.isAtom){if(!o&&Y.isSelectable(a))return Y.create(n,e-(r<0?a.nodeSize:0))}else{let l=zi(n,a,e+r,r<0?a.childCount:0,r,o);if(l)return l}e+=a.nodeSize*r}return null}function zp(n,t,e){let i=n.steps.length-1;if(i<t)return;let r=n.steps[i];if(!(r instanceof st||r instanceof ze))return;let o=n.mapping.maps[i],s;o.forEach((a,l,c,u)=>{s==null&&(s=u)}),n.setSelection(ie.near(n.doc.resolve(s),e))}var Vp=1,jo=2,$p=4,cc=class extends Fi{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Vp)&~jo,this.storedMarks=null,this}get selectionSet(){return(this.updated&Vp)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=jo,this}ensureMarks(t){return Ee.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&jo)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&~jo,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let i=this.selection;return e&&(t=t.mark(this.storedMarks||(i.empty?i.$from.marks():i.$from.marksAcross(i.$to)||Ee.none))),i.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,i){let r=this.doc.type.schema;if(e==null)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();{if(i==null&&(i=e),i=i==null?e:i,!t)return this.deleteRange(e,i);let o=this.storedMarks;if(!o){let s=this.doc.resolve(e);o=i==e?s.marks():s.marksAcross(this.doc.resolve(i))}return this.replaceRangeWith(e,i,r.text(t,o)),this.selection.empty||this.setSelection(ie.near(this.selection.$to)),this}}setMeta(t,e){return this.meta[typeof t=="string"?t:t.key]=e,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=$p,this}get scrolledIntoView(){return(this.updated&$p)>0}};function Wp(n,t){return!t||!n?n:n.bind(t)}var ui=class{constructor(t,e,i){this.name=t,this.init=Wp(e.init,i),this.apply=Wp(e.apply,i)}},Ik=[new ui("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new ui("selection",{init(n,t){return n.selection||ie.atStart(t.doc)},apply(n){return n.selection}}),new ui("storedMarks",{init(n){return n.storedMarks||null},apply(n,t,e,i){return i.selection.$cursor?n.storedMarks:null}}),new ui("scrollToSelection",{init(){return 0},apply(n,t){return n.scrolledIntoView?t+1:t}})],Dr=class{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Ik.slice(),e&&e.forEach(i=>{if(this.pluginsByKey[i.key])throw new RangeError("Adding different instances of a keyed plugin ("+i.key+")");this.plugins.push(i),this.pluginsByKey[i.key]=i,i.spec.state&&this.fields.push(new ui(i.key,i.spec.state,i))})}},Jo=class n{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=e){let r=this.config.plugins[i];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],i=this.applyInner(t),r=null;for(;;){let o=!1;for(let s=0;s<this.config.plugins.length;s++){let a=this.config.plugins[s];if(a.spec.appendTransaction){let l=r?r[s].n:0,c=r?r[s].state:this,u=l<e.length&&a.spec.appendTransaction.call(a,l?e.slice(l):e,c,i);if(u&&i.filterTransaction(u,s)){if(u.setMeta("appendedTransaction",t),!r){r=[];for(let d=0;d<this.config.plugins.length;d++)r.push(d<s?{state:i,n:e.length}:{state:this,n:0})}e.push(u),i=i.applyInner(u),o=!0}r&&(r[s]={state:i,n:e.length})}}if(!o)return{state:i,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new n(this.config),i=this.config.fields;for(let r=0;r<i.length;r++){let o=i[r];e[o.name]=o.apply(t,this[o.name],this,e)}return e}get tr(){return new cc(this)}static create(t){let e=new Dr(t.doc?t.doc.type.schema:t.schema,t.plugins),i=new n(e);for(let r=0;r<e.fields.length;r++)i[e.fields[r].name]=e.fields[r].init(t,i);return i}reconfigure(t){let e=new Dr(this.schema,t.plugins),i=e.fields,r=new n(e);for(let o=0;o<i.length;o++){let s=i[o].name;r[s]=this.hasOwnProperty(s)?this[s]:i[o].init(t,r)}return r}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(i=>i.toJSON())),t&&typeof t=="object")for(let i in t){if(i=="doc"||i=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=t[i],o=r.spec.state;o&&o.toJSON&&(e[i]=o.toJSON.call(r,this[r.key]))}return e}static fromJSON(t,e,i){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let r=new Dr(t.schema,t.plugins),o=new n(r);return r.fields.forEach(s=>{if(s.name=="doc")o.doc=yt.fromJSON(t.schema,e.doc);else if(s.name=="selection")o.selection=ie.fromJSON(o.doc,e.selection);else if(s.name=="storedMarks")e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(i)for(let a in i){let l=i[a],c=l.spec.state;if(l.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(e,a)){o[s.name]=c.fromJSON.call(l,t,e[a],o);return}}o[s.name]=s.init(t,o)}}),o}};function Up(n,t,e){for(let i in n){let r=n[i];r instanceof Function?r=r.bind(t):i=="handleDOMEvents"&&(r=Up(r,t,{})),e[i]=r}return e}var X=class{constructor(t){this.spec=t,this.props={},t.props&&Up(t.props,this,this.props),this.key=t.key?t.key.key:Kp("plugin")}getState(t){return t[this.key]}},ac=Object.create(null);function Kp(n){return n in ac?n+"$"+ ++ac[n]:(ac[n]=0,n+"$")}var se=class{constructor(t="key"){this.key=Kp(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}};var uc=!1;function dc(n){uc=n}function Ve(...n){uc&&console.log(...n)}function le(...n){uc&&console.warn(...n)}var XN=nf();var iw=/<ruby\b[^>]*>[\s\S]*?<\/ruby>/gi,rw={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" "},vc=typeof document!="undefined";function Gt(n="\u300A",t="\u300B"){let e=rf(n),i=rf(t);return new RegExp(`(?:(?:[|\\uFF5C]?(?<body1>[\\u4E00-\\u9FA0\\u3005]+?))|(?:[|\\uFF5C](?<body2>[^|\\uFF5C]+?)))${e}(?<ruby>.+?)${i}`,"gm")}function of(n){var s,a,l,c,u,d,h,p,f,g;if(!n||!vc)return!1;let t=[],e=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),i=e.nextNode();for(;i;)i instanceof Text&&t.push(i),i=e.nextNode();if(t.length===0)return!1;let r=!1,o=Gt();for(let m of t){if(!m.parentElement||lw(m,n))continue;let b=m.textContent;if(!b)continue;let y=Array.from(b.matchAll(o));if(y.length===0)continue;let v=m;for(let E of y){let x=(s=E.groups)!=null?s:{},k=(l=(a=x.body2)!=null?a:x.body1)!=null?l:"",S=(c=x.ruby)!=null?c:"",w=E[0];if(!k||!S||!v.textContent)continue;let C=v.textContent.indexOf(w);if(C===-1)continue;let I=v.splitText(C),F=I.splitText(w.length),N=(d=(u=v.ownerDocument)==null?void 0:u.createElement("ruby"))!=null?d:document.createElement("ruby");N.textContent="";let H=(p=(h=v.ownerDocument)==null?void 0:h.createTextNode(k))!=null?p:document.createTextNode(k);N.appendChild(H);let _=(g=(f=v.ownerDocument)==null?void 0:f.createElement("rt"))!=null?g:document.createElement("rt");_.textContent=S,N.appendChild(_),I.replaceWith(N),v=F,r=!0}}return r}function Vi(n){if(!n)return n;if(vc){let t=document.createElement("div");return t.innerHTML=n,of(t),t.innerHTML}return n.replace(Gt(),(t,...e)=>{var s,a,l,c;let i=(s=e[e.length-1])!=null?s:{},r=(l=(a=i.body2)!=null?a:i.body1)!=null?l:"",o=(c=i.ruby)!=null?c:"";return!r||!o?t:`<ruby>${r}<rt>${o}</rt></ruby>`})}function On(n,t={}){var i,r,o;if(!n)return n;let e=(i=t.addDelimiter)!=null?i:!0;if(vc){let s=document.createElement("div");s.innerHTML=n;let a=Array.from(s.querySelectorAll("ruby"));for(let l of a){let c=ow(l,e),u=(o=(r=s.ownerDocument)==null?void 0:r.createTextNode(c))!=null?o:document.createTextNode(c);l.replaceWith(u)}return s.innerHTML}return n.replace(iw,s=>sw(s,e))}function ow(n,t){var l;let e=n.querySelector("rt");if(!e)return n.outerHTML;let i=es((l=e.textContent)!=null?l:"").trim(),r=[];n.childNodes.forEach(c=>{var u;if(c!==e){if(c.nodeType===Node.ELEMENT_NODE){let d=c.tagName;if(d==="RT"||d==="RP")return}r.push((u=c.textContent)!=null?u:"")}});let s=es(r.join("")).replace(/\u00A0/g," ").trim();return s?`${t?"\uFF5C":""}${s}\u300A${i}\u300B`:n.outerHTML}function sw(n,t){var c,u;let e=n.match(/^<ruby\b[^>]*>([\s\S]*?)<\/ruby>$/i);if(!e)return n;let i=(c=e[1])!=null?c:"",r=i.match(/<rt[^>]*>([\s\S]*?)<\/rt>/i);if(!r)return n;let o=es((u=r[1])!=null?u:"").trim(),s=i.replace(r[0],""),a=es(aw(s)).replace(/\u00A0/g," ").trim();return a?`${t?"\uFF5C":""}${a}\u300A${o}\u300B`:n}function aw(n){return n.replace(/<[^>]*?>/g,"")}function rf(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function es(n){return n.replace(/&[a-zA-Z#0-9]+;/g,t=>{var e;return(e=rw[t])!=null?e:t})}function lw(n,t){let e=n.parentNode;for(;e&&e!==t;){if(e.nodeType===Node.ELEMENT_NODE){let i=e.tagName;if(i==="CODE"||i==="PRE"||i==="RUBY"||i==="SCRIPT"||i==="STYLE"||i==="TEXTAREA")return!0}e=e.parentNode}return!1}var ts=require("@codemirror/view"),af=require("@codemirror/state");var $i=require("@codemirror/commands"),lf=require("@codemirror/language");var Ue=require("obsidian");var di=require("obsidian"),ns=class extends di.Modal{constructor(e,i,r){super(e);this.result=null;this.styleElement=null;this.conflictData=i,this.onResolve=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-conflict-resolution-modal"),e.createEl("h2",{text:"\u30D5\u30A1\u30A4\u30EB\u7AF6\u5408\u306E\u89E3\u6C7A"});let i=e.createDiv("conflict-description");i.createEl("p",{text:`\u30D5\u30A1\u30A4\u30EB: ${this.conflictData.filePath}`}),i.createEl("p",{text:"\u3053\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u5916\u90E8\u3067\u5909\u66F4\u3055\u308C\u307E\u3057\u305F\u304C\u3001\u672A\u4FDD\u5B58\u306E\u7DE8\u96C6\u5185\u5BB9\u304C\u3042\u308A\u307E\u3059\u3002\u4FDD\u5B58\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"});let r=e.createDiv("conflict-buttons");r.style.cssText=`
			display: flex;
			gap: 0.5em;
			justify-content: flex-end;
			margin-top: 1em;
			padding-top: 1em;
			border-top: 1px solid var(--background-modifier-border);
		`,new di.ButtonComponent(r).setButtonText("\u73FE\u5728\u306E\u5185\u5BB9\u3067\u4E0A\u66F8\u304D\u4FDD\u5B58").setClass("mod-cta").onClick(()=>{this.result={action:"overwrite"},this.close()}),new di.ButtonComponent(r).setButtonText("\u5916\u90E8\u5909\u66F4\u3092\u53D6\u308A\u8FBC\u3080").onClick(()=>{this.result={action:"accept-external"},this.close()}),new di.ButtonComponent(r).setButtonText("\u4E21\u65B9\u306E\u30D0\u30FC\u30B8\u30E7\u30F3\u3092\u4FDD\u5B58").onClick(()=>{this.result={action:"keep-both"},this.close()}),new di.ButtonComponent(r).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.result={action:"cancel"},this.close()}),this.addModalStyles()}addModalStyles(){this.styleElement=document.createElement("style"),this.styleElement.textContent=`
			.tategaki-conflict-resolution-modal .conflict-description {
				margin-bottom: 1em;
				padding: 0.75em;
				background: var(--background-secondary);
				border-radius: 4px;
			}

			.tategaki-conflict-resolution-modal .conflict-buttons .clickable-icon {
				padding: 0.5em 1em;
				margin: 0;
			}

			.tategaki-conflict-resolution-modal .conflict-buttons {
				flex-wrap: wrap;
				justify-content: flex-end;
			}
		`,document.head.appendChild(this.styleElement)}onClose(){let{contentEl:e}=this;e.empty(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null),this.onResolve(this.result)}};var cf=require("obsidian"),is=class extends cf.Modal{constructor(e,i,r){super(e);this.result=null;this.styleElement=null;this.data=i,this.onResolve=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-file-switch-modal"),e.createEl("h2",{text:"\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059"});let i=e.createDiv("file-switch-warning");i.style.cssText=`
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 16px;
			margin-bottom: 16px;
			background: var(--background-modifier-error);
			border: 1px solid var(--background-modifier-border);
			border-radius: 6px;
		`;let r=i.createDiv("warning-icon");r.innerHTML=`
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
				<line x1="12" y1="9" x2="12" y2="13"/>
				<line x1="12" y1="17" x2="12.01" y2="17"/>
			</svg>
		`,r.style.cssText=`
			color: var(--text-error);
			flex-shrink: 0;
		`;let o=i.createDiv("warning-text");o.innerHTML=`
			<strong>\u30D5\u30A1\u30A4\u30EB\u3092\u5207\u308A\u66FF\u3048\u3088\u3046\u3068\u3057\u3066\u3044\u307E\u3059</strong>
			<div style="margin-top: 4px; color: var(--text-muted); font-size: 0.9em;">
				\u73FE\u5728\u306E\u30D5\u30A1\u30A4\u30EB\u306B\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002\u5909\u66F4\u3092\u4FDD\u5B58\u3057\u307E\u3059\u304B\uFF1F
			</div>
		`;let s=e.createDiv("file-switch-info");s.style.cssText=`
			margin-bottom: 24px;
			padding: 12px;
			background: var(--background-secondary);
			border-radius: 4px;
		`;let a=s.createDiv();a.innerHTML=`
			<div style="margin-bottom: 8px;">
				<strong>\u73FE\u5728\u306E\u30D5\u30A1\u30A4\u30EB:</strong> ${this.data.currentFilePath}
				<span style="color: var(--text-error); margin-left: 8px;">\u25CF\u672A\u4FDD\u5B58</span>
			</div>
		`;let l=s.createDiv();l.innerHTML=`
			<strong>\u5207\u308A\u66FF\u3048\u5148:</strong> ${this.data.newFilePath}
		`;let c=e.createDiv("options-description");c.style.cssText=`
			margin-bottom: 20px;
			color: var(--text-muted);
			font-size: 0.95em;
		`,c.innerHTML=`
			<p>\u6B21\u306E\u3044\u305A\u308C\u304B\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\uFF1A</p>
			<ul style="margin: 8px 0; padding-left: 20px;">
				<li><strong>\u4FDD\u5B58\u3057\u3066\u5207\u308A\u66FF\u3048:</strong> \u73FE\u5728\u306E\u5909\u66F4\u3092\u4FDD\u5B58\u3057\u3066\u304B\u3089\u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u958B\u304D\u307E\u3059</li>
				<li><strong>\u7834\u68C4\u3057\u3066\u5207\u308A\u66FF\u3048:</strong> \u5909\u66F4\u3092\u7834\u68C4\u3057\u3066\u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u958B\u304D\u307E\u3059</li>
				<li><strong>\u30AD\u30E3\u30F3\u30BB\u30EB:</strong> \u30D5\u30A1\u30A4\u30EB\u5207\u308A\u66FF\u3048\u3092\u30AD\u30E3\u30F3\u30BB\u30EB\u3057\u307E\u3059</li>
			</ul>
		`;let u=e.createDiv("file-switch-buttons");u.style.cssText=`
			display: flex;
			gap: 8px;
			justify-content: flex-end;
			padding-top: 16px;
			border-top: 1px solid var(--background-modifier-border);
		`;let d=u.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB",cls:"mod-cta"});d.addEventListener("click",()=>{this.result={action:"cancel"},this.close()}),u.createEl("button",{text:"\u7834\u68C4\u3057\u3066\u5207\u308A\u66FF\u3048",cls:"mod-warning"}).addEventListener("click",()=>{this.result={action:"discard-and-switch"},this.close()}),u.createEl("button",{text:"\u4FDD\u5B58\u3057\u3066\u5207\u308A\u66FF\u3048",cls:"mod-cta"}).addEventListener("click",()=>{this.result={action:"save-and-switch"},this.close()}),this.addModalStyles(),setTimeout(()=>{d.focus()},100)}addModalStyles(){this.styleElement=document.createElement("style"),this.styleElement.textContent=`
			.tategaki-file-switch-modal .file-switch-buttons button {
				padding: 8px 16px;
				margin: 0 4px;
				min-width: 100px;
				border-radius: 4px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
				color: var(--text-normal);
				cursor: pointer;
			}

			.tategaki-file-switch-modal .file-switch-buttons button:hover {
				background: var(--background-modifier-hover);
			}

			.tategaki-file-switch-modal .file-switch-buttons button.mod-cta {
				background: var(--interactive-accent);
				color: var(--text-on-accent);
				border-color: var(--interactive-accent);
			}

			.tategaki-file-switch-modal .file-switch-buttons button.mod-warning {
				background: var(--color-orange);
				color: var(--text-on-accent);
				border-color: var(--color-orange);
			}

			.tategaki-file-switch-modal .modal-content {
				max-width: 550px;
			}

			.tategaki-file-switch-modal .file-switch-info strong {
				color: var(--text-normal);
			}

			.tategaki-file-switch-modal .options-description ul {
				list-style-type: disc;
			}

			.tategaki-file-switch-modal .options-description li {
				margin: 4px 0;
			}
		`,document.head.appendChild(this.styleElement)}onClose(){let{contentEl:e}=this;e.empty(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null),this.result===null&&(this.result={action:"cancel"}),this.onResolve(this.result)}};var Ec=require("obsidian"),gw={maxWithin24h:20,usageDaysToKeep:7},Wi=".obsidian/tategaki-sync-backups",pf=Wi;async function rs(n,t,e,i,r={}){var d;let o=(d=r.reason)!=null?d:"manual-sync";await df(n,Wi);let s=bw(t),a=`${Wi}/${s}`;await df(n,a);let l=Ew(new Date),c=await hf(n,`${a}/${l}_${o}__before.md`),u=await hf(n,`${a}/${l}_${o}__after.md`);return await Promise.all([n.vault.create(c,e),n.vault.create(u,i)]),await ww(n,a,gw),{backupFolderPath:a,beforePath:c,afterPath:u,timestamp:l,reason:o}}function ss(n,t){let e=uf(n),i=uf(t);return!!(e===i||e.endsWith(`
`)&&e.slice(0,-1)===i||i.endsWith(`
`)&&i.slice(0,-1)===e)}function uf(n){return n.replace(/\r\n/g,`
`)}async function ff(n,t={}){let e=n.vault.adapter;if(!await e.exists(Wi))return"none";if(t.system!==!1)try{if(await e.trashSystem(Wi))return"system"}catch(o){}return await e.trashLocal(Wi),"local"}function bw(n){let t=yw(n.basename||"untitled"),e=vw(n.path);return`${t}__${e}`}function yw(n){let t=n.replace(/[^A-Za-z0-9._-]+/g,"_");return t.length>0?t:"file"}function vw(n){let t=2166136261;for(let e=0;e<n.length;e++)t^=n.charCodeAt(e),t=Math.imul(t,16777619);return(t>>>0).toString(16).padStart(8,"0")}function Ew(n){let t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),r=String(n.getHours()).padStart(2,"0"),o=String(n.getMinutes()).padStart(2,"0");return`${t}${e}${i}-${r}${o}`}function xw(n){return n.slice(0,8)}function kw(n){let t=n.match(/^(\d{4})(\d{2})(\d{2})-(\d{2})(\d{2})/);if(!t)return null;let[,e,i,r,o,s]=t;return new Date(parseInt(e,10),parseInt(i,10)-1,parseInt(r,10),parseInt(o,10),parseInt(s,10))}async function df(n,t){let e=n.vault.getAbstractFileByPath(t);if(e){if(!(e instanceof Ec.TFolder))throw new Error(`Backup path exists but is not a folder: ${t}`);return}let i=t.split("/").filter(Boolean),r="";for(let o of i){r=r?`${r}/${o}`:o;let s=n.vault.getAbstractFileByPath(r);if(!s){try{await n.vault.createFolder(r)}catch(a){if(!((a==null?void 0:a.message)||"").includes("Folder already exists"))throw a}continue}if(!(s instanceof Ec.TFolder))throw new Error(`Backup path segment exists but is not a folder: ${r}`)}}async function hf(n,t){if(!n.vault.getAbstractFileByPath(t))return t;let e=1;for(;e<1e3;){let i=t.replace(/\.md$/,`-${e}.md`);if(!n.vault.getAbstractFileByPath(i))return i;e+=1}throw new Error(`Failed to allocate unique backup path: ${t}`)}async function ww(n,t,e){var d,h;let i=null;try{i=await n.vault.adapter.list(t)}catch(p){return}let r=new Map;for(let p of i.files){let f=(d=p.split("/").pop())!=null?d:"",g=f.indexOf("__");if(g<=0)continue;let m=f.slice(0,g),b=m.indexOf("_"),y=b>0?m.slice(0,b):m;r.has(m)||r.set(m,{groupKey:m,timestamp:y,datePart:xw(y),files:[],createdAt:kw(y)}),(h=r.get(m))==null||h.files.push(p)}if(r.size===0)return;let o=[...r.values()].sort((p,f)=>!p.createdAt||!f.createdAt?0:f.createdAt.getTime()-p.createdAt.getTime()),s=Date.now(),a=1440*60*1e3,l=new Set,c=0;for(let p of o)p.createdAt&&s-p.createdAt.getTime()<=a&&c<e.maxWithin24h&&(l.add(p.groupKey),c++);let u=new Set;for(let p of o){if(l.has(p.groupKey)){u.add(p.datePart);continue}u.size<e.usageDaysToKeep&&(u.has(p.datePart)||(l.add(p.groupKey),u.add(p.datePart)))}for(let p of o)if(!l.has(p.groupKey))for(let f of p.files){let g=n.vault.getAbstractFileByPath(f);if(g){await n.vault.delete(g,!0);continue}try{await n.vault.adapter.remove(f)}catch(m){}}}var Sw={bigPasteCharThreshold:200,bigPasteNewlineThreshold:2,autoIntervalMs:12e5},as=class{constructor(t={}){this.lastBackupAt=null;this.sessionStartBackupDone=!1;this.config={...Sw,...t}}needsSessionStartBackup(){return!this.sessionStartBackupDone}markSessionStartBackupDone(){this.sessionStartBackupDone=!0,this.lastBackupAt=Date.now()}recordBackup(){this.lastBackupAt=Date.now()}needsAutoIntervalBackup(){return this.lastBackupAt===null?!0:Date.now()-this.lastBackupAt>=this.config.autoIntervalMs}isBigPaste(t,e){if(e.length-t.length>=this.config.bigPasteCharThreshold)return!0;let r=(t.match(/\n/g)||[]).length;return(e.match(/\n/g)||[]).length-r>=this.config.bigPasteNewlineThreshold}isRiskyChange(t,e){let i=(t.match(/<ruby[\s>]/gi)||[]).length;if((e.match(/<ruby[\s>]/gi)||[]).length>i)return!0;let o=(t.match(/<span\s+class=/gi)||[]).length;return(e.match(/<span\s+class=/gi)||[]).length>o}detectBackupReason(t,e,i,r){return i?"manual-sync":this.needsSessionStartBackup()?"session-start":this.isRiskyChange(t,e)?"risky-change":this.isBigPaste(t,e)?"big-paste":r&&this.needsAutoIntervalBackup()?"auto-interval":null}reset(){this.sessionStartBackupDone=!1,this.lastBackupAt=null}};var Mw=500,cs=class cs{constructor(t){this.currentFile=null;this.lastSavedMarkdown="";this.lastAppliedMarkdown="";this.isApplyingExternalUpdate=!1;this.isSaving=!1;this.dirty=!1;this.saveTimer=null;this.isHandlingFileSwitch=!1;this.lastCancelledFileSwitch=null;this.isManualSyncInProgress=!1;this.app=t.app,this.editor=t.editor,this.getSettings=t.getSettings,this.onStateChange=t.onStateChange,this.onBeforeApplyMarkdown=t.onBeforeApplyMarkdown,this.backupTriggerDetector=new as,this.state={mode:this.resolveSyncMode(),dirty:!1,saving:!1,lastSavedAt:null,currentFilePath:null,lastSyncResult:null,lastSyncMessage:null}}async initialize(t){t!==void 0&&await this.loadFile(t)}dispose(){this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null),this.currentFile=null,this.lastSavedMarkdown="",this.lastAppliedMarkdown="",this.dirty=!1,this.isApplyingExternalUpdate=!1,this.isSaving=!1,this.isHandlingFileSwitch=!1}async flush(){this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null),this.dirty&&await this.persistChanges({force:!0})}onSettingsChanged(t){let e=this.resolveSyncMode(t);this.updateState({mode:e}),e==="manual"?this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null):this.dirty&&this.scheduleSave()}handleEditorUpdate(){if(!this.isApplyingExternalUpdate&&this.currentFile){if(!this.dirty){let t=this.editor.getMarkdown();if(ss(t,this.lastSavedMarkdown)||ss(t,this.lastAppliedMarkdown))return;this.dirty=!0,this.updateState({dirty:!0})}this.resolveSyncMode()==="auto"&&this.scheduleSave()}}async triggerManualSync(){if(!this.currentFile){new Ue.Notice("\u540C\u671F\u3059\u308B\u30D5\u30A1\u30A4\u30EB\u304C\u958B\u304B\u308C\u3066\u3044\u307E\u305B\u3093\u3002",2e3);return}this.isManualSyncInProgress=!0;try{await this.persistChanges({force:!0}),new Ue.Notice("\u30D5\u30A1\u30A4\u30EB\u3092\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002",2e3)}finally{this.isManualSyncInProgress=!1}}async loadFile(t,e={}){if(this.saveTimer!=null&&(window.clearTimeout(this.saveTimer),this.saveTimer=null),!t){this.currentFile=null,this.lastSavedMarkdown="",this.lastAppliedMarkdown="",this.dirty=!1,this.backupTriggerDetector.reset(),this.updateState({currentFilePath:null,dirty:!1,saving:!1,lastSavedAt:null});return}if(!this.currentFile){this.backupTriggerDetector.reset(),await this.applyMarkdownFromFile(t,"load")&&(this.currentFile=t);return}if(this.currentFile.path===t.path||e.forceReload){await this.applyMarkdownFromFile(t,"load");return}if(this.isHandlingFileSwitch)return;this.isHandlingFileSwitch=!0;let i=this.getState(),r=this.currentFile,o=this.lastSavedMarkdown,s=this.lastAppliedMarkdown,a=this.dirty;try{if(!await this.showFileSwitchConfirmation(this.currentFile.path,t.path,this.dirty))return;if(this.backupTriggerDetector.reset(),this.currentFile=t,this.dirty=!1,!await this.applyMarkdownFromFile(t,"load")){this.currentFile=r,this.lastSavedMarkdown=o,this.lastAppliedMarkdown=s,this.dirty=a,this.updateState(i);return}}finally{this.isHandlingFileSwitch=!1}}getState(){return{...this.state}}adoptExternalBaseline(t){this.lastSavedMarkdown=t,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty?(this.dirty=!1,this.updateState({dirty:!1})):this.updateState({lastSavedAt:Date.now()})}hasUnsavedChanges(){return this.dirty}clearDirtyFlag(){this.dirty=!1,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.updateState({dirty:!1})}async handleExternalChange(t){if(!this.currentFile||t.path!==this.currentFile.path||this.isSaving)return!1;let e=await this.app.vault.read(t);if(e===this.lastSavedMarkdown)return!1;let i=this.editor.getMarkdown(),r=this.dirty||i!==this.lastAppliedMarkdown;return r&&!this.dirty&&(this.dirty=!0,this.updateState({dirty:!0})),r?(await this.showConflictResolutionDialog(e),!0):(await this.applyMarkdownWithDecision(e,t,"external")).applied?(this.lastSavedMarkdown=e,this.updateState({dirty:this.dirty,saving:!1,lastSavedAt:Date.now()}),!0):!1}resolveSyncMode(t){var i;return(i=(t!=null?t:this.getSettings()).wysiwyg.syncMode)!=null?i:"manual"}scheduleSave(){this.saveTimer!=null&&window.clearTimeout(this.saveTimer),this.saveTimer=window.setTimeout(()=>{this.saveTimer=null,this.persistChanges()},Mw)}async persistChanges(t={}){var o;if(!this.currentFile)return;let e=this.editor.getMarkdown(),i=e!==this.lastAppliedMarkdown;if(!t.force&&!this.dirty&&!i)return;if(!t.force&&!i){this.dirty=!1,this.updateState({dirty:!1});return}let r;try{r=await this.app.vault.read(this.currentFile)}catch(s){console.error("Tategaki BlockSync: failed to read file before save",s),new Ue.Notice("\u4FDD\u5B58\u524D\u306E\u8AAD\u307F\u53D6\u308A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3e3),this.updateState({lastSyncResult:"error",lastSyncMessage:"\u4FDD\u5B58\u524D\u306E\u8AAD\u307F\u53D6\u308A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"});return}if(!t.skipConflictCheck&&r!==this.lastSavedMarkdown){await this.showConflictResolutionDialog(r);return}this.isSaving=!0,this.updateState({saving:!0,lastSyncResult:null,lastSyncMessage:null});try{if((o=this.getSettings().wysiwyg.enableSyncBackup)!=null?o:!0){let l=this.backupTriggerDetector.detectBackupReason(r,e,this.isManualSyncInProgress,this.dirty);if(l)try{await rs(this.app,this.currentFile,r,e,{reason:l}),l==="session-start"?this.backupTriggerDetector.markSessionStartBackupDone():this.backupTriggerDetector.recordBackup()}catch(c){console.error("Tategaki BlockSync: failed to write sync backup",c),new Ue.Notice("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\uFF08\u4FDD\u5B58\u306F\u7D9A\u884C\u3057\u307E\u3059\uFF09\u3002",3500)}}await this.app.vault.modify(this.currentFile,e);let a;try{a=await this.app.vault.read(this.currentFile)}catch(l){console.error("Tategaki BlockSync: failed to read back file after save",l),new Ue.Notice("\u4FDD\u5B58\u5F8C\u306E\u8AAD\u307F\u623B\u3057\u691C\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\uFF08\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u6E08\u307F\uFF09\u3002",4e3),this.lastSavedMarkdown=e,this.lastAppliedMarkdown=e,this.dirty=!1,this.updateState({saving:!1,dirty:!1,lastSavedAt:Date.now(),lastSyncResult:"error",lastSyncMessage:"\u4FDD\u5B58\u5F8C\u306E\u8AAD\u307F\u623B\u3057\u691C\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"});return}if(!ss(e,a)){console.error("Tategaki BlockSync: read-back verification mismatch after save",{file:this.currentFile.path}),new Ue.Notice("\u540C\u671F\u306B\u5931\u6557\u3057\u305F\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\uFF08\u8AAD\u307F\u623B\u3057\u4E0D\u4E00\u81F4\uFF09\u3002\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u6E08\u307F\u3067\u3059\u3002",5e3);try{await this.app.vault.modify(this.currentFile,r),new Ue.Notice("\u5B89\u5168\u306E\u305F\u3081\u540C\u671F\u524D\u306E\u5185\u5BB9\u3078\u30ED\u30FC\u30EB\u30D0\u30C3\u30AF\u3057\u307E\u3057\u305F\u3002",4500)}catch(l){console.error("Tategaki BlockSync: rollback failed",l),new Ue.Notice("\u30ED\u30FC\u30EB\u30D0\u30C3\u30AF\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304B\u3089\u5FA9\u5143\u3057\u3066\u304F\u3060\u3055\u3044\u3002",6e3)}this.lastSavedMarkdown=r,this.lastAppliedMarkdown=e,this.dirty=!0,this.updateState({saving:!1,dirty:!0,lastSyncResult:"error",lastSyncMessage:"\u8AAD\u307F\u623B\u3057\u4E0D\u4E00\u81F4\u306E\u305F\u3081\u30ED\u30FC\u30EB\u30D0\u30C3\u30AF\u3057\u307E\u3057\u305F\u3002"});return}this.lastSavedMarkdown=a,this.lastAppliedMarkdown=e,this.dirty=!1,this.updateState({saving:!1,dirty:!1,lastSavedAt:Date.now(),lastSyncResult:"ok",lastSyncMessage:null})}catch(s){console.error("Tategaki BlockSync: failed to save file",s),new Ue.Notice("\u30D5\u30A1\u30A4\u30EB\u306E\u4FDD\u5B58\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3e3),this.updateState({saving:!1,lastSyncResult:"error",lastSyncMessage:"\u30D5\u30A1\u30A4\u30EB\u306E\u4FDD\u5B58\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"})}finally{this.isSaving=!1}}setEditorMarkdown(t){this.isApplyingExternalUpdate=!0;try{this.editor.setMarkdown(t)}finally{this.isApplyingExternalUpdate=!1}}async applyMarkdownFromFile(t,e){try{let i=await this.app.vault.read(t);return(await this.applyMarkdownWithDecision(i,t,e)).applied?(this.lastSavedMarkdown=i,this.updateState({currentFilePath:t.path,dirty:this.dirty,saving:!1,lastSavedAt:Date.now(),lastSyncResult:null,lastSyncMessage:null}),!0):!1}catch(i){return console.error("Tategaki BlockSync: failed to load file",i),new Ue.Notice("\u30D5\u30A1\u30A4\u30EB\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2e3),!1}}async applyMarkdownWithDecision(t,e,i){let r=null;if(this.onBeforeApplyMarkdown)try{r=await this.onBeforeApplyMarkdown(t,{file:e,source:i})}catch(a){le("Tategaki BlockSync: before-apply hook failed",a),r=null}if(r&&r.action==="cancel")return{applied:!1,markDirty:!1};let o=(r==null?void 0:r.action)==="apply"&&r.markdown!=null?r.markdown:t,s=(r==null?void 0:r.action)==="apply"&&r.markDirty===!0;return this.setEditorMarkdown(o),s?(this.lastAppliedMarkdown=t,this.dirty=!0,this.updateState({dirty:!0})):(this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty=!1,this.updateState({dirty:!1})),{applied:!0,markDirty:s}}async showConflictResolutionDialog(t){if(!this.currentFile)return;let e=this.editor.getMarkdown(),i={currentContent:e,externalContent:t,filePath:this.currentFile.path};return new Promise(r=>{new ns(this.app,i,async s=>{if(!s||s.action==="cancel"){new Ue.Notice("\u7AF6\u5408\u89E3\u6C7A\u304C\u30AD\u30E3\u30F3\u30BB\u30EB\u3055\u308C\u307E\u3057\u305F\u3002",3e3),r();return}try{switch(s.action){case"overwrite":await this.persistChanges({force:!0,skipConflictCheck:!0}),new Ue.Notice("\u73FE\u5728\u306E\u5185\u5BB9\u3067\u4E0A\u66F8\u304D\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002",3e3);break;case"accept-external":this.setEditorMarkdown(t),this.lastSavedMarkdown=t,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty=!1,this.updateState({dirty:!1,saving:!1,lastSavedAt:Date.now()}),new Ue.Notice("\u5916\u90E8\u5909\u66F4\u3092\u53D6\u308A\u8FBC\u307F\u307E\u3057\u305F\u3002",3e3);break;case"keep-both":await this.saveBothVersions(e,t);break}}catch(a){console.error("Tategaki BlockSync: conflict resolution failed",a),new Ue.Notice("\u7AF6\u5408\u89E3\u6C7A\u51E6\u7406\u3067\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002",4e3)}r()}).open()})}async saveBothVersions(t,e){var u,d;if(!this.currentFile)return;let i=(d=(u=this.currentFile.parent)==null?void 0:u.path)!=null?d:"",r=this.currentFile.basename,o=this.currentFile.extension||"md",s=this.formatTimestamp(new Date),a=0,l;do{let h=a===0?"":`-${a}`,p=`${r} (\u7AF6\u5408\u30B3\u30D4\u30FC ${s}${h}).${o}`;l=i?`${i}/${p}`:p,a+=1}while(this.app.vault.getAbstractFileByPath(l));await this.app.vault.create(l,t),this.setEditorMarkdown(e),this.lastSavedMarkdown=e,this.lastAppliedMarkdown=this.editor.getMarkdown(),this.dirty=!1,this.updateState({dirty:!1,saving:!1,lastSavedAt:Date.now()});let c=this.extractFileName(l);new Ue.Notice(`\u73FE\u5728\u306E\u5185\u5BB9\u3092\u300C${c}\u300D\u3068\u3057\u3066\u4FDD\u5B58\u3057\u3001\u5916\u90E8\u5909\u66F4\u3092\u53CD\u6620\u3057\u307E\u3057\u305F\u3002`,4e3)}formatTimestamp(t){let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return`${e}${i}${r}-${o}${s}${a}`}extractFileName(t){var i;let e=t.split("/");return(i=e[e.length-1])!=null?i:t}async showFileSwitchConfirmation(t,e,i){if(!i)return!0;let r=this.lastCancelledFileSwitch;if(r&&r.currentFilePath===t&&r.newFilePath===e&&Date.now()-r.at<cs.FILE_SWITCH_CANCEL_COOLDOWN_MS)return!1;let o={currentFilePath:t,newFilePath:e,hasUnsavedChanges:i};return new Promise(s=>{new is(this.app,o,l=>{if(!l||l.action==="cancel"){this.lastCancelledFileSwitch={currentFilePath:t,newFilePath:e,at:Date.now()},s(!1);return}this.lastCancelledFileSwitch=null,this.executeFileSwitchAction(l.action).then(()=>s(!0)).catch(c=>{console.error("Tategaki BlockSync: file switch action failed",c),new Ue.Notice("\u30D5\u30A1\u30A4\u30EB\u5207\u308A\u66FF\u3048\u51E6\u7406\u3067\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002",3e3),s(!1)})}).open()})}async executeFileSwitchAction(t){switch(t){case"save-and-switch":await this.persistChanges({force:!0}),new Ue.Notice("\u5909\u66F4\u3092\u4FDD\u5B58\u3057\u3066\u30D5\u30A1\u30A4\u30EB\u3092\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002",2e3);break;case"discard-and-switch":this.dirty=!1,this.updateState({dirty:!1}),new Ue.Notice("\u5909\u66F4\u3092\u7834\u68C4\u3057\u3066\u30D5\u30A1\u30A4\u30EB\u3092\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002",2e3);break}}updateState(t){var e;this.state={...this.state,...t},(e=this.onStateChange)==null||e.call(this,this.getState())}};cs.FILE_SWITCH_CANCEL_COOLDOWN_MS=800;var ls=cs;var mf=require("obsidian"),Ui=class extends mf.Modal{constructor(e,i="\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002"){super(e);this.message=i;this.result=null;this.resolvePromise=null}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\u672A\u4FDD\u5B58\u306E\u5909\u66F4"}),e.createEl("p",{text:this.message});let i=e.createDiv({cls:"modal-button-container"});i.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
		`,i.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",()=>{this.result="save",this.close()}),i.createEl("button",{text:"\u7834\u68C4",cls:"mod-warning"}).addEventListener("click",()=>{this.result="discard",this.close()}),i.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB"}).addEventListener("click",()=>{this.result="cancel",this.close()})}onClose(){let{contentEl:e}=this;e.empty(),this.resolvePromise&&this.resolvePromise(this.result||"cancel")}async waitForChoice(){return new Promise(e=>{this.resolvePromise=e,this.open()})}};var Zt=require("obsidian");var xc=class extends Zt.Modal{constructor(e,i){super(e);this.inputEl=null;this.onSubmit=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\u30C6\u30FC\u30DE\u540D\u3092\u5165\u529B"}),new Zt.Setting(e).setName("\u30C6\u30FC\u30DE\u540D").addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder("\u4F8B: \u30DE\u30A4\u30C6\u30FC\u30DE").onChange(()=>{}),i.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),this.submit())})}),new Zt.Setting(e).addButton(i=>i.setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.close()})).addButton(i=>i.setButtonText("\u4FDD\u5B58").setCta().onClick(()=>{this.submit()})),setTimeout(()=>{this.inputEl&&(this.inputEl.focus(),this.inputEl.select())},50)}submit(){var i;let e=(i=this.inputEl)==null?void 0:i.value.trim();e&&(this.onSubmit(e),this.close())}onClose(){let{contentEl:e}=this;e.empty()}};function Tw(n,t,e){let i=document.createElement("div");i.style.cssText=`
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.5);
		z-index: 10000;
		display: flex;
		align-items: center;
		justify-content: center;
	`;let r=document.createElement("div");r.style.cssText=`
		background: var(--background-primary);
		border: 1px solid var(--background-modifier-border);
		border-radius: var(--radius-m);
		padding: 20px;
		min-width: 300px;
		box-shadow: var(--shadow-l);
	`;let o=document.createElement("h3");o.textContent=n,o.style.cssText=`
		margin: 0 0 16px 0;
		color: var(--text-normal);
	`;let s=document.createElement("div");s.style.cssText=`
		display: flex;
		gap: 12px;
		align-items: center;
		margin-bottom: 20px;
	`;let a=document.createElement("input");a.type="color",a.value=t,a.style.cssText=`
		width: 60px;
		height: 40px;
		border: 1px solid var(--background-modifier-border);
		border-radius: var(--radius-s);
		cursor: pointer;
	`;let l=document.createElement("input");l.type="text",l.value=t,l.style.cssText=`
		flex: 1;
		padding: 8px 12px;
		border: 1px solid var(--background-modifier-border);
		border-radius: var(--radius-s);
		background: var(--background-primary);
		color: var(--text-normal);
		font-family: var(--font-monospace);
	`,a.addEventListener("input",()=>{l.value=a.value}),l.addEventListener("input",()=>{/^#[0-9a-fA-F]{6}$/.test(l.value)&&(a.value=l.value)});let c=document.createElement("div");c.style.cssText=`
		display: flex;
		gap: 8px;
		justify-content: flex-end;
	`;let u=document.createElement("button");u.textContent="\u30AD\u30E3\u30F3\u30BB\u30EB",u.className="mod-cta";let d=document.createElement("button");d.textContent="OK",d.className="mod-cta";let h=()=>{document.body.removeChild(i)};u.addEventListener("click",h),d.addEventListener("click",()=>{e(a.value),h()}),l.addEventListener("keydown",p=>{p.key==="Enter"?(e(a.value),h()):p.key==="Escape"&&h()}),i.addEventListener("click",p=>{p.target===i&&h()}),s.appendChild(a),s.appendChild(l),c.appendChild(u),c.appendChild(d),r.appendChild(o),r.appendChild(s),r.appendChild(c),i.appendChild(r),document.body.appendChild(i),setTimeout(()=>l.focus(),100)}var us=class us extends Zt.Modal{constructor(e,i,r,o){var s,a;super(e);this.applySettingsTimer=null;this.lastAppliedSettingsSnapshot="";this.plugin=i,this.onSettingsChange=r,this.tempSettings=JSON.parse(JSON.stringify(i.settings)),Array.isArray(this.tempSettings.customFonts)||(this.tempSettings.customFonts=[]),this.panelContext={mode:(s=o==null?void 0:o.mode)!=null?s:"sot",isCeImeMode:(a=o==null?void 0:o.isCeImeMode)!=null?a:!1}}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tategaki-settings-modal"),this.containerEl.addClass("tategaki-settings-modal-container"),e.createEl("h2",{text:"\u8868\u793A\u8A2D\u5B9A"});let i=e.createDiv("settings-scroll-container");i.style.cssText=`
			max-height: 60vh;
			overflow-y: auto;
			padding-right: 10px;
		`,this.createSettingsUI(i)}createCollapsibleSection(e,i,r,o,s){let a=e.createDiv("tategaki-settings-section");a.style.cssText=`
			margin-bottom: 4px;
			border: 1px solid var(--background-modifier-border);
			border-radius: 8px;
			overflow: hidden;
		`;let l=a.createDiv("tategaki-settings-section-header");l.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 10px 14px;
			cursor: pointer;
			user-select: none;
			background: var(--background-secondary);
			transition: background 0.15s ease;
		`,l.addEventListener("mouseenter",()=>{l.style.background="var(--background-modifier-hover)"}),l.addEventListener("mouseleave",()=>{l.style.background="var(--background-secondary)"});let c=l.createSpan();c.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: center;
			width: 16px;
			height: 16px;
			color: var(--text-muted);
			transition: transform 0.2s ease;
		`,(0,Zt.setIcon)(c,o?"chevron-down":"chevron-right");let u=l.createSpan();u.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: center;
			width: 18px;
			height: 18px;
			color: var(--text-muted);
		`,(0,Zt.setIcon)(u,i);let d=l.createSpan();d.textContent=r,d.style.cssText=`
			font-weight: 600;
			color: var(--text-normal);
			font-size: 0.95em;
		`;let h=a.createDiv("tategaki-settings-section-content");h.style.cssText=`
			padding: ${o?"4px 14px 10px":"0 14px"};
			max-height: ${o?"2000px":"0"};
			overflow: hidden;
			transition: max-height 0.3s ease, padding 0.3s ease;
		`;let p=o;return l.addEventListener("click",()=>{p=!p,(0,Zt.setIcon)(c,p?"chevron-down":"chevron-right"),h.style.maxHeight=p?"2000px":"0",h.style.padding=p?"4px 14px 10px":"0 14px"}),s(h),a}createSettingsUI(e){let i=this.panelContext.mode==="compat",r=!!this.panelContext.isCeImeMode,o=i||r,s=i?"\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093":"CE\u88DC\u52A9(IME)\u4E2D\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093",a=i||r,l=i?"\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093":"CE\u88DC\u52A9(IME)\u4E2D\u306F\u53CD\u6620\u3055\u308C\u307E\u305B\u3093",c=i,u="\u4E92\u63DB\u30E2\u30FC\u30C9\u3067\u306F\u5229\u7528\u3067\u304D\u307E\u305B\u3093",d,h,p,f,g=null,m=null;this.createCollapsibleSection(e,"sliders-horizontal","\u57FA\u672C\u8A2D\u5B9A",!0,b=>{this.createSettingItem(b,"\u66F8\u5B57\u65B9\u5411","\u7E26\u66F8\u304D\u307E\u305F\u306F\u6A2A\u66F8\u304D\u3092\u9078\u629E",y=>{let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
						`,v.createEl("option",{text:"\u7E26\u66F8\u304D",value:"vertical-rl"}),v.createEl("option",{text:"\u6A2A\u66F8\u304D",value:"horizontal-tb"}),v.value=this.tempSettings.common.writingMode,v.addEventListener("change",()=>{this.tempSettings.common.writingMode=v.value,this.applySettings()})}),this.createSettingItem(b,"\u30DA\u30FC\u30B8\u67A0\u306E\u8868\u793A","\u30DA\u30FC\u30B8\u67A0\u3092\u8868\u793A\u3059\u308B\u304B\u3001\u5168\u753B\u9762\u8868\u793A\u306B\u3059\u308B\u304B\u3092\u9078\u629E",y=>{let v=y.createEl("button",{cls:"tategaki-toggle-button"}),E=()=>{var S;return Number((S=this.tempSettings.common.pageScale)!=null?S:1)<=1},x=k=>{v.textContent=k?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A",v.setAttr("aria-pressed",k?"true":"false"),v.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${k?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${k?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};x(E()),v.addEventListener("click",()=>{let k=!E();this.tempSettings.common.pageScale=k?1:1.05,x(k),this.applySettings()})})}),this.createCollapsibleSection(e,"type","\u30D5\u30A9\u30F3\u30C8",!0,b=>{this.createSettingItem(b,"\u30D5\u30A9\u30F3\u30C8","\u30B4\u30B7\u30C3\u30AF\u4F53\u3001\u660E\u671D\u4F53\u3001\u307E\u305F\u306F\u30AB\u30B9\u30BF\u30E0\u30D5\u30A9\u30F3\u30C8\u3092\u9078\u629E\u3067\u304D\u307E\u3059",async y=>{var A,B,W;Array.isArray(this.tempSettings.customFonts)||(this.tempSettings.customFonts=[]);let v=y.createDiv();v.style.cssText=`
							display: flex;
							flex-direction: column;
							gap: 8px;
							min-width: 220px;
						`;let E=v.createEl("select");E.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 200px;
						`;let x='-apple-system, BlinkMacSystemFont, "Segoe UI", "Yu Gothic", "Hiragino Sans", "Noto Sans JP", "Noto Sans CJK JP", "Source Han Sans", Roboto, "Helvetica Neue", Arial, sans-serif',k='"Yu Mincho", "Hiragino Mincho ProN", "Noto Serif JP", "Noto Serif CJK JP", "Source Han Serif", Georgia, "Times New Roman", serif';E.createEl("option",{text:"\u30B4\u30B7\u30C3\u30AF\u4F53",value:x}),E.createEl("option",{text:"\u660E\u671D\u4F53",value:k});let S=E.createEl("optgroup");S.label="\u30AB\u30B9\u30BF\u30E0";let w=v.createDiv();w.style.cssText=`
							font-size: 0.8em;
							color: var(--text-muted);
						`,w.textContent="\u5404\u30B7\u30B9\u30C6\u30E0\u306E\u6A19\u6E96\u7684\u306A\u30D5\u30A9\u30F3\u30C8\u304C\u4F7F\u7528\u3055\u308C\u307E\u3059\u3002";let C=v.createDiv();C.style.cssText=`
							display: flex;
							flex-direction: column;
							gap: 6px;
							margin-top: 8px;
							padding-top: 8px;
							border-top: 1px solid var(--background-modifier-border);
						`;let I=C.createEl("div");I.style.cssText=`
							font-size: 0.9em;
							font-weight: 500;
							margin-bottom: 4px;
						`,I.textContent="\u30AB\u30B9\u30BF\u30E0\u30D5\u30A9\u30F3\u30C8";let F=C.createDiv();F.style.cssText=`
							display: flex;
							gap: 6px;
						`;let N=F.createEl("input");N.type="text",N.placeholder="\u30D5\u30A9\u30F3\u30C8\u540D\u3092\u5165\u529B\uFF08\u4F8B: Noto Serif JP\uFF09",N.style.cssText=`
							flex: 1;
							padding: 6px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
						`;let H=F.createEl("button");H.textContent="\u8FFD\u52A0",H.style.cssText=`
							padding: 6px 10px;
						`;let _=C.createDiv();_.style.cssText=`
							display: flex;
							flex-direction: column;
							gap: 4px;
							margin-top: 8px;
							max-height: 100px;
							overflow-y: auto;
							padding-right: 4px;
						`;let P=null,L=()=>{for(;S.firstChild;)S.removeChild(S.firstChild);for(;_.firstChild;)_.removeChild(_.firstChild);this.tempSettings.customFonts&&this.tempSettings.customFonts.length>0&&this.tempSettings.customFonts.forEach((K,J)=>{S.createEl("option",{text:K,value:K});let Z=_.createDiv();Z.draggable=!0,Z.setAttribute("data-font-index",J.toString()),Z.style.cssText=`
										display: flex;
										align-items: center;
										justify-content: space-between;
										padding: 4px 8px;
										background: var(--background-modifier-hover);
										border-radius: var(--radius-s);
										font-size: 0.9em;
										cursor: grab;
										transition: opacity 0.2s, transform 0.2s;
									`;let ee=Z.createSpan();ee.textContent="\u22EE\u22EE",ee.style.cssText=`
										margin-right: 8px;
										color: var(--text-muted);
										cursor: grab;
										user-select: none;
									`;let Me=Z.createSpan();Me.textContent=K,Me.style.cssText=`
										flex: 1;
										font-family: ${K};
									`;let Be=Z.createEl("button");Be.textContent="\u524A\u9664",Be.style.cssText=`
										padding: 2px 8px;
										font-size: 0.85em;
										background: var(--interactive-normal);
										color: var(--text-normal);
										border: 1px solid var(--background-modifier-border);
										border-radius: var(--radius-s);
										cursor: pointer;
									`,Be.addEventListener("click",()=>{let ye=this.tempSettings.customFonts.indexOf(K);ye>-1&&(this.tempSettings.customFonts.splice(ye,1),L(),this.tempSettings.common.fontFamily===K&&(E.value=x,this.tempSettings.common.fontFamily=x,this.applySettings()))}),Z.addEventListener("dragstart",ye=>{P=J,Z.style.opacity="0.5",Z.style.cursor="grabbing",ye.dataTransfer&&(ye.dataTransfer.effectAllowed="move")}),Z.addEventListener("dragend",()=>{Z.style.opacity="1",Z.style.cursor="grab",P=null}),Z.addEventListener("dragover",ye=>{ye.preventDefault(),!(P===null||P===J)&&(ye.dataTransfer&&(ye.dataTransfer.dropEffect="move"),Z.style.borderTop=P<J?"2px solid var(--interactive-accent)":"",Z.style.borderBottom=P>J?"2px solid var(--interactive-accent)":"")}),Z.addEventListener("dragleave",()=>{Z.style.borderTop="",Z.style.borderBottom=""}),Z.addEventListener("drop",ye=>{if(ye.preventDefault(),Z.style.borderTop="",Z.style.borderBottom="",P===null||P===J)return;let pe=[...this.tempSettings.customFonts],[Fe]=pe.splice(P,1);pe.splice(J,0,Fe),this.tempSettings.customFonts=pe,L(),this.applySettings()})})},R=()=>{let K=N.value.trim();if(!K)return;if(Array.isArray(this.tempSettings.customFonts)||(this.tempSettings.customFonts=[]),this.tempSettings.customFonts.some(Z=>Z.toLowerCase()===K.toLowerCase())){N.value="",E.value=K,this.tempSettings.common.fontFamily=K,this.applySettings();return}this.tempSettings.customFonts.push(K),N.value="",L(),E.value=K,this.tempSettings.common.fontFamily=K,this.applySettings()};H.addEventListener("click",()=>{R()}),N.addEventListener("keydown",K=>{K.key==="Enter"&&!K.isComposing&&(K.preventDefault(),R())}),E.addEventListener("change",()=>{E.value&&(this.tempSettings.common.fontFamily=E.value,this.applySettings())}),L();let T=(B=(A=this.tempSettings.common.fontFamily)==null?void 0:A.trim())!=null?B:"";T===x||T.includes("sans-serif")||!T?E.value=x:T===k||T.includes("serif")?E.value=k:(W=this.tempSettings.customFonts)!=null&&W.includes(T)?E.value=T:E.value=x}),this.createSettingItem(b,"\u30D5\u30A9\u30F3\u30C8\u30B5\u30A4\u30BA","\u6587\u5B57\u306E\u5927\u304D\u3055\u3092\u8ABF\u6574",y=>{let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="12",E.max="32",E.step="1",E.value=this.tempSettings.common.fontSize.toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=v.createEl("span");x.textContent=`${this.tempSettings.common.fontSize}px`,x.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let k=parseInt(E.value);this.tempSettings.common.fontSize=k,x.textContent=`${k}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u884C\u9593","\u884C\u306E\u9593\u9694\u3092\u8ABF\u6574",y=>{let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`,d=v.createEl("input"),d.type="range",d.min="1.5",d.max="3.0",d.step="0.1",d.value=this.tempSettings.common.lineHeight.toFixed(1),d.style.cssText=`
							flex: 1;
							min-width: 100px;
						`,h=v.createEl("span"),h.textContent=this.tempSettings.common.lineHeight.toFixed(1),h.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,d.addEventListener("input",()=>{let E=parseFloat(d.value);this.tempSettings.common.lineHeight=E,h.textContent=E.toFixed(1),this.applySettings({debounce:!0})}),d.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u6587\u5B57\u9593","\u6587\u5B57\u306E\u9593\u9694\u3092\u8ABF\u6574\uFF080 = \u901A\u5E38\uFF09",y=>{let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="-0.1",E.max="0.5",E.step="0.01",E.value=this.tempSettings.common.letterSpacing.toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=v.createEl("span");x.textContent=this.tempSettings.common.letterSpacing.toFixed(2),x.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let k=parseFloat(E.value);this.tempSettings.common.letterSpacing=k,x.textContent=k.toFixed(2),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"gem","\u30EB\u30D3",!1,b=>{this.createSettingItem(b,"\u30EB\u30D3\u8868\u793A","\u30AA\u30D5\u306B\u3059\u308B\u3068\u30EB\u30D3\u30BF\u30B0\u3092\u751F\u6210\u305B\u305A\u3001\u9752\u7A7A\u8A18\u6CD5\uFF08\uFF5C\u672C\u6587\u300A\u3088\u307F\u300B\uFF09\u306E\u307E\u307E\u8868\u793A\u3057\u307E\u3059",y=>{let v=y.createEl("button",{cls:"tategaki-toggle-button"}),E=k=>{v.textContent=k?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A",v.setAttr("aria-pressed",k?"true":"false"),v.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${k?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${k?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`},x=()=>this.tempSettings.wysiwyg.enableRuby!==!1;E(x()),v.addEventListener("click",()=>{let k=!x();this.tempSettings.wysiwyg.enableRuby=k,E(k),this.applySettings()})}),this.createSettingItem(b,"\u30EB\u30D3\u30B5\u30A4\u30BA","\u30EB\u30D3\uFF08\u3075\u308A\u304C\u306A\uFF09\u306E\u5927\u304D\u3055\u3092\u8ABF\u6574",y=>{let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`,p=v.createEl("input"),p.type="range",p.min="0.3",p.max="1.0",p.step="0.05",p.value=this.tempSettings.common.rubySize.toFixed(2),p.style.cssText=`
							flex: 1;
							min-width: 100px;
						`,f=v.createEl("span"),f.textContent=this.tempSettings.common.rubySize.toFixed(2),f.style.cssText=`
							min-width: 45px;
							text-align: right;
							color: var(--text-muted);
						`,p.addEventListener("input",()=>{let E=parseFloat(p.value);this.tempSettings.common.rubySize=E,f.textContent=E.toFixed(2),this.applySettings({debounce:!0})}),p.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u30EB\u30D3\u4F4D\u7F6E","\u5DE6\uFF1D\u6587\u5B57\u306B\u8FD1\u3065\u3051\u308B / \u53F3\uFF1D\u6587\u5B57\u304B\u3089\u9060\u3056\u3051\u308B\uFF08\u7E26\u306F\u52A0\u6E1B\u7B97\u3001\u6A2A\u306F\u9006\u7B26\u53F7\u3067\u52A0\u6E1B\u7B97\uFF09",y=>{var w;let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
							flex-wrap: wrap;
						`;let E=v.createEl("input");E.type="range",E.min="-1.5",E.max="1.5",E.step="0.1";let x=Math.min(1.5,Math.max(-1.5,(w=this.tempSettings.common.rubyVerticalGap)!=null?w:0));E.value=x.toString(),E.style.cssText=`
							flex: 1;
							min-width: 140px;
						`,g=E;let k=v.createEl("span");k.textContent=x.toFixed(1),k.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,m=k;let S=C=>{let I=Math.min(1.5,Math.max(-1.5,C)),F=I,N=-I-1;this.tempSettings.common.rubyVerticalGap=F,this.tempSettings.common.rubyHorizontalGap=N,m&&(m.textContent=I.toFixed(1)),g&&g.value!==I.toString()&&(g.value=I.toString())};E.addEventListener("input",()=>{let C=parseFloat(E.value);S(C),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"palette","\u8272\u8A2D\u5B9A",!1,b=>{this.createColorSettingItem(b,"\u6587\u5B57\u8272",this.tempSettings.common.textColor,y=>{this.tempSettings.common.textColor=y,this.applySettings()}),this.createColorSettingItem(b,"\u30DA\u30FC\u30B8\u8272",this.tempSettings.common.backgroundColor,y=>{this.tempSettings.common.backgroundColor=y,this.applySettings()}),this.createColorSettingItem(b,"\u80CC\u666F\u8272",this.tempSettings.common.pageBackgroundColor,y=>{this.tempSettings.common.pageBackgroundColor=y,this.applySettings()})}),this.createCollapsibleSection(e,"heading","\u898B\u51FA\u3057\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u898B\u51FA\u3057\u30D5\u30A9\u30F3\u30C8","\u898B\u51FA\u3057\u5C02\u7528\u306E\u30D5\u30A9\u30F3\u30C8\u3092\u9078\u629E\uFF08\u672C\u6587\u306E\u30AB\u30B9\u30BF\u30E0\u30D5\u30A9\u30F3\u30C8\u3082\u4F7F\u7528\u53EF\u80FD\uFF09",y=>{var C,I,F;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 200px;
						`;let E='-apple-system, BlinkMacSystemFont, "Segoe UI", "Yu Gothic", "Hiragino Sans", "Noto Sans JP", "Noto Sans CJK JP", "Source Han Sans", Roboto, "Helvetica Neue", Arial, sans-serif',x='"Yu Mincho", "Hiragino Mincho ProN", "Noto Serif JP", "Noto Serif CJK JP", "Source Han Serif", Georgia, "Times New Roman", serif';v.createEl("option",{text:"\u672C\u6587\u3068\u540C\u3058",value:""}),v.createEl("option",{text:"\u30B4\u30B7\u30C3\u30AF\u4F53",value:E}),v.createEl("option",{text:"\u660E\u671D\u4F53",value:x});let k=v.createEl("optgroup");k.label="\u30AB\u30B9\u30BF\u30E0",(()=>{for(;k.firstChild;)k.removeChild(k.firstChild);this.tempSettings.customFonts&&this.tempSettings.customFonts.length>0&&this.tempSettings.customFonts.forEach(N=>{k.createEl("option",{text:N,value:N})})})();let w=(I=(C=this.tempSettings.common.headingFontFamily)==null?void 0:C.trim())!=null?I:"";w?w===E||w.includes("sans-serif")?v.value=E:w===x||w.includes("serif")?v.value=x:(F=this.tempSettings.customFonts)!=null&&F.includes(w)?v.value=w:w?(k.createEl("option",{text:w,value:w}),v.value=w):v.value="":v.value="",v.addEventListener("change",()=>{this.tempSettings.common.headingFontFamily=v.value,this.applySettings()})}),this.createColorSettingItem(b,"\u898B\u51FA\u3057\u6587\u5B57\u8272",this.tempSettings.common.headingTextColor||this.tempSettings.common.textColor,y=>{this.tempSettings.common.headingTextColor=y,this.applySettings()}),this.createSettingItem(b,"\u898B\u51FA\u3057\u6587\u5B57\u8272\u3092\u30EA\u30BB\u30C3\u30C8","\u672C\u6587\u3068\u540C\u3058\u8272\u306B\u623B\u3057\u307E\u3059",y=>{let v=y.createEl("button");v.textContent="\u30EA\u30BB\u30C3\u30C8",v.style.cssText=`
							padding: 6px 12px;
						`,v.addEventListener("click",()=>{this.tempSettings.common.headingTextColor="",this.applySettings(),this.onOpen()})})}),this.createCollapsibleSection(e,"move-horizontal","\u4F59\u767D\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u4E0A\u4F59\u767D","\u30DA\u30FC\u30B8\u4E0A\u90E8\u306E\u4F59\u767D\u3092\u8ABF\u6574\uFF080\u301C200px\uFF09",y=>{var k,S;let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="0",E.max="200",E.step="2",E.value=((k=this.tempSettings.wysiwyg.sotPaddingTop)!=null?k:32).toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=v.createEl("span");x.textContent=`${(S=this.tempSettings.wysiwyg.sotPaddingTop)!=null?S:32}px`,x.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let w=parseInt(E.value);this.tempSettings.wysiwyg.sotPaddingTop=w,x.textContent=`${w}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})}),this.createSettingItem(b,"\u4E0B\u4F59\u767D","\u30DA\u30FC\u30B8\u4E0B\u90E8\u306E\u4F59\u767D\u3092\u8ABF\u6574\uFF080\u301C200px\uFF09",y=>{var k,S;let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="0",E.max="200",E.step="2",E.value=((k=this.tempSettings.wysiwyg.sotPaddingBottom)!=null?k:16).toString(),E.style.cssText=`
							flex: 1;
							min-width: 100px;
						`;let x=v.createEl("span");x.textContent=`${(S=this.tempSettings.wysiwyg.sotPaddingBottom)!=null?S:16}px`,x.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let w=parseInt(E.value);this.tempSettings.wysiwyg.sotPaddingBottom=w,x.textContent=`${w}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})})}),this.createCollapsibleSection(e,"text-cursor","\u30AD\u30E3\u30EC\u30C3\u30C8\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u8272","\u6587\u5B57\u8272 / \u30CF\u30A4\u30E9\u30A4\u30C8\u8272 / \u30AB\u30B9\u30BF\u30E0\u8272 \u304B\u3089\u9078\u629E\u3067\u304D\u307E\u3059",y=>{var E,x;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,v.createEl("option",{text:"\u6587\u5B57\u8272",value:"text"}),v.createEl("option",{text:"\u30CF\u30A4\u30E9\u30A4\u30C8\u8272",value:"accent"}),v.createEl("option",{text:"\u30AB\u30B9\u30BF\u30E0\u8272",value:"custom"}),v.value=(x=(E=this.tempSettings.wysiwyg.caretColorMode)!=null?E:me.wysiwyg.caretColorMode)!=null?x:"accent",v.addEventListener("change",()=>{this.tempSettings.wysiwyg.caretColorMode=v.value,this.applySettings()})}),this.createColorSettingItem(b,"\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u30AB\u30B9\u30BF\u30E0\u8272",this.tempSettings.wysiwyg.caretCustomColor||me.wysiwyg.caretCustomColor||"#1e90ff",y=>{this.tempSettings.wysiwyg.caretCustomColor=y,this.applySettings()}),this.createSettingItem(b,"\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u5E45","\u30AD\u30E3\u30EC\u30C3\u30C8\u306E\u592A\u3055\u3092\u8ABF\u6574\u3057\u307E\u3059\uFF08px\uFF09",y=>{var S,w;let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="1",E.max="8",E.step="0.5";let x=(w=(S=this.tempSettings.wysiwyg.caretWidthPx)!=null?S:me.wysiwyg.caretWidthPx)!=null?w:3;E.value=x.toString(),E.style.cssText=`
							flex: 1;
							min-width: 120px;
						`;let k=v.createEl("span");k.textContent=`${x}px`,k.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let C=parseFloat(E.value);this.tempSettings.wysiwyg.caretWidthPx=C,k.textContent=`${C}px`,this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})},{disabled:a,disabledReason:a?l:void 0}),this.createSettingItem(b,"CE\u88DC\u52A9\u30E2\u30FC\u30C9\u3067\u30CD\u30A4\u30C6\u30A3\u30D6\u30AD\u30E3\u30EC\u30C3\u30C8\u3092\u4F7F\u7528","CE\u88DC\u52A9(IME)\u3092\u30AA\u30F3\u306B\u3057\u305F\u3068\u304D\u3001OS\u6A19\u6E96\u306E\u30AD\u30E3\u30EC\u30C3\u30C8\u3092\u4F7F\u3046\u304B\u9078\u3079\u307E\u3059",y=>{let v=y.createEl("button",{cls:"tategaki-toggle-button"}),E=()=>this.tempSettings.wysiwyg.ceUseNativeCaret!==!1,x=k=>{v.textContent=k?"\u4F7F\u7528\u3059\u308B":"\u4F7F\u7528\u3057\u306A\u3044",v.setAttr("aria-pressed",k?"true":"false"),v.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${k?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${k?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};x(E()),v.addEventListener("click",()=>{let k=!E();this.tempSettings.wysiwyg.ceUseNativeCaret=k,x(k),this.applySettings()})},{disabled:c,disabledReason:c?u:void 0})}),this.createCollapsibleSection(e,"keyboard","IME\u8868\u793A\u306E\u88DC\u6B63",!1,b=>{this.createSettingItem(b,"\u6A2A\u66F8\u304D: \u4E0A\u65B9\u5411\u88DC\u6B63","\u6A2A\u66F8\u304DIME\u306E\u8868\u793A\u4F4D\u7F6E\u3092\u3001\u4E0A\u65B9\u5411(+) / \u4E0B\u65B9\u5411(-)\u306B\u8ABF\u6574\u3057\u307E\u3059\uFF08em\u5358\u4F4D\uFF09",y=>{var S,w;let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="-1",E.max="1",E.step="0.01";let x=(w=(S=this.tempSettings.wysiwyg.imeOffsetHorizontalEm)!=null?S:me.wysiwyg.imeOffsetHorizontalEm)!=null?w:0;E.value=x.toFixed(2),E.style.cssText=`
							flex: 1;
							min-width: 120px;
						`;let k=v.createEl("span");k.textContent=x.toFixed(2),k.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let C=parseFloat(E.value);this.tempSettings.wysiwyg.imeOffsetHorizontalEm=C,k.textContent=C.toFixed(2),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})},{disabled:o,disabledReason:o?s:void 0}),this.createSettingItem(b,"\u7E26\u66F8\u304D: \u53F3\u65B9\u5411\u88DC\u6B63","\u7E26\u66F8\u304DIME\u306E\u8868\u793A\u4F4D\u7F6E\u3092\u3001\u53F3\u65B9\u5411(+) / \u5DE6\u65B9\u5411(-)\u306B\u8ABF\u6574\u3057\u307E\u3059\uFF08em\u5358\u4F4D\uFF09",y=>{var S,w;let v=y.createDiv();v.style.cssText=`
							display: flex;
							align-items: center;
							gap: 10px;
						`;let E=v.createEl("input");E.type="range",E.min="-1",E.max="1",E.step="0.01";let x=(w=(S=this.tempSettings.wysiwyg.imeOffsetVerticalEm)!=null?S:me.wysiwyg.imeOffsetVerticalEm)!=null?w:0;E.value=x.toFixed(2),E.style.cssText=`
							flex: 1;
							min-width: 120px;
						`;let k=v.createEl("span");k.textContent=x.toFixed(2),k.style.cssText=`
							min-width: 50px;
							text-align: right;
							color: var(--text-muted);
						`,E.addEventListener("input",()=>{let C=parseFloat(E.value);this.tempSettings.wysiwyg.imeOffsetVerticalEm=C,k.textContent=C.toFixed(2),this.applySettings({debounce:!0})}),E.addEventListener("change",()=>{this.applySettings()})},{disabled:o,disabledReason:o?s:void 0})}),this.createCollapsibleSection(e,"file-text","\u53C2\u7167\u8A2D\u5B9A",!1,b=>{this.createSettingItem(b,"\u30D5\u30ED\u30F3\u30C8\u30DE\u30BF\u30FC\u60C5\u5831\u3092\u8868\u793A","YAML\u81EA\u4F53\u3067\u306F\u306A\u304F\u3001title/author\u306A\u3069\u306E\u5185\u5BB9\u3092\u672C\u6587\u5148\u982D\u306B\u8868\u793A\u3057\u307E\u3059",y=>{var k;let v=y.createEl("button",{cls:"tategaki-toggle-button"}),E=S=>{let w=!S;this.tempSettings.preview.hideFrontmatter=w,this.tempSettings.preview.showFrontmatterTitle=S,this.tempSettings.preview.showFrontmatterSubtitle=S,this.tempSettings.preview.showFrontmatterOriginalTitle=S,this.tempSettings.preview.showFrontmatterAuthor=S,this.tempSettings.preview.showFrontmatterCoAuthors=S,this.tempSettings.preview.showFrontmatterTranslator=S,this.tempSettings.preview.showFrontmatterCoTranslators=S,this.applySettings()},x=()=>{var w;let S=!((w=this.tempSettings.preview.hideFrontmatter)==null||w);v.textContent=S?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A",v.setAttr("aria-pressed",S?"true":"false"),v.style.cssText=`
								min-width: 96px;
								padding: 6px 12px;
								border-radius: 6px;
								border: 1px solid var(--background-modifier-border);
								background: ${S?"var(--interactive-accent)":"var(--interactive-normal)"};
								color: ${S?"var(--text-on-accent)":"var(--text-normal)"};
								cursor: pointer;
								transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
							`};E(!((k=this.tempSettings.preview.hideFrontmatter)==null||k)),x(),v.addEventListener("click",()=>{var w;let S=!((w=this.tempSettings.preview.hideFrontmatter)==null||w);E(!S),x()})})}),this.createCollapsibleSection(e,"book-open","\u66F8\u7C4D\u30E2\u30FC\u30C9",!1,b=>{this.createSettingItem(b,"\u30D8\u30C3\u30C0\u30FC\u306E\u5185\u5BB9","\u66F8\u7C4D\u30E2\u30FC\u30C9\u306E\u30D8\u30C3\u30C0\u30FC\u306B\u8868\u793A\u3059\u308B\u5185\u5BB9\u3092\u9078\u3073\u307E\u3059",y=>{var E;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,v.createEl("option",{text:"\u8868\u793A\u3057\u306A\u3044",value:"none"}),v.createEl("option",{text:"\u30BF\u30A4\u30C8\u30EB",value:"title"}),v.createEl("option",{text:"\u30DA\u30FC\u30B8\u756A\u53F7",value:"pageNumber"}),v.value=(E=this.tempSettings.preview.headerContent)!=null?E:"none",v.addEventListener("change",()=>{this.tempSettings.preview.headerContent=v.value,this.applySettings()})}),this.createSettingItem(b,"\u30D8\u30C3\u30C0\u30FC\u306E\u914D\u7F6E","\u30D8\u30C3\u30C0\u30FC\u306E\u8868\u793A\u4F4D\u7F6E\uFF08\u5DE6/\u4E2D\u592E/\u53F3\uFF09\u3092\u9078\u3073\u307E\u3059",y=>{var E;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,v.createEl("option",{text:"\u5DE6",value:"left"}),v.createEl("option",{text:"\u4E2D\u592E",value:"center"}),v.createEl("option",{text:"\u53F3",value:"right"}),v.value=(E=this.tempSettings.preview.headerAlign)!=null?E:"center",v.addEventListener("change",()=>{this.tempSettings.preview.headerAlign=v.value,this.applySettings()})}),this.createSettingItem(b,"\u30D5\u30C3\u30BF\u30FC\u306E\u5185\u5BB9","\u66F8\u7C4D\u30E2\u30FC\u30C9\u306E\u30D5\u30C3\u30BF\u30FC\u306B\u8868\u793A\u3059\u308B\u5185\u5BB9\u3092\u9078\u3073\u307E\u3059",y=>{var E;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,v.createEl("option",{text:"\u8868\u793A\u3057\u306A\u3044",value:"none"}),v.createEl("option",{text:"\u30BF\u30A4\u30C8\u30EB",value:"title"}),v.createEl("option",{text:"\u30DA\u30FC\u30B8\u756A\u53F7",value:"pageNumber"}),v.value=(E=this.tempSettings.preview.footerContent)!=null?E:"pageNumber",v.addEventListener("change",()=>{this.tempSettings.preview.footerContent=v.value,this.applySettings()})}),this.createSettingItem(b,"\u30D5\u30C3\u30BF\u30FC\u306E\u914D\u7F6E","\u30D5\u30C3\u30BF\u30FC\u306E\u8868\u793A\u4F4D\u7F6E\uFF08\u5DE6/\u4E2D\u592E/\u53F3\uFF09\u3092\u9078\u3073\u307E\u3059",y=>{var E;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,v.createEl("option",{text:"\u5DE6",value:"left"}),v.createEl("option",{text:"\u4E2D\u592E",value:"center"}),v.createEl("option",{text:"\u53F3",value:"right"}),v.value=(E=this.tempSettings.preview.footerAlign)!=null?E:"center",v.addEventListener("change",()=>{this.tempSettings.preview.footerAlign=v.value,this.applySettings()})}),this.createSettingItem(b,"\u30DA\u30FC\u30B8\u756A\u53F7\u306E\u5F62\u5F0F","\u73FE\u5728\u30DA\u30FC\u30B8\u306E\u307F / \u73FE\u5728\u30DA\u30FC\u30B8\u3068\u7DCF\u30DA\u30FC\u30B8\u6570 \u3092\u9078\u3079\u307E\u3059",y=>{var E;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 200px;
						`,v.createEl("option",{text:"\u73FE\u5728\u30DA\u30FC\u30B8",value:"current"}),v.createEl("option",{text:"\u73FE\u5728\u30DA\u30FC\u30B8/\u7DCF\u30DA\u30FC\u30B8\u6570",value:"currentTotal"}),v.value=(E=this.tempSettings.preview.pageNumberFormat)!=null?E:"currentTotal",v.addEventListener("change",()=>{this.tempSettings.preview.pageNumberFormat=v.value,this.applySettings()})}),this.createSettingItem(b,"\u30DA\u30FC\u30B8\u9077\u79FB\u52B9\u679C","\u30DA\u30FC\u30B8\u79FB\u52D5\u6642\u306E\u8996\u899A\u52B9\u679C\u3092\u9078\u3073\u307E\u3059",y=>{var E;let v=y.createEl("select");v.style.cssText=`
							padding: 4px 8px;
							border: 1px solid var(--background-modifier-border);
							border-radius: var(--radius-s);
							background: var(--background-primary);
							color: var(--text-normal);
							min-width: 160px;
						`,v.createEl("option",{text:"\u306A\u3057",value:"none"}),v.createEl("option",{text:"\u30D5\u30A7\u30FC\u30C9",value:"fade"}),v.createEl("option",{text:"\u30B9\u30E9\u30A4\u30C9",value:"slide"}),v.createEl("option",{text:"\u307C\u304B\u3057",value:"blur"}),v.value=(E=this.tempSettings.preview.pageTransitionEffect)!=null?E:"fade",v.addEventListener("change",()=>{this.tempSettings.preview.pageTransitionEffect=v.value,this.applySettings()})})}),this.createCollapsibleSection(e,"paintbrush","\u30C6\u30FC\u30DE",!1,b=>{this.createThemeSelector(b)}),i&&this.createCollapsibleSection(e,"archive","\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\uFF08\u4E92\u63DB\u30E2\u30FC\u30C9\uFF09",!1,b=>{this.createSettingItem(b,"\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210","\u4E92\u63DB\u30E2\u30FC\u30C9\u306E\u540C\u671F\u6642\u306B\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002OFF\u306B\u3059\u308B\u3068\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u4F5C\u6210\u3055\u308C\u307E\u305B\u3093\uFF08\u4E8B\u6545\u6642\u306FObsidian\u306E\u300COpen version history\u300D\u3092\u5229\u7528\u3057\u3066\u304F\u3060\u3055\u3044\uFF09\u3002",y=>{let v=y.createEl("button",{cls:"tategaki-toggle-button"}),E=k=>{v.textContent=k?"\u6709\u52B9":"\u7121\u52B9",v.setAttr("aria-pressed",k?"true":"false"),v.style.cssText=`
									min-width: 96px;
									padding: 6px 12px;
									border-radius: 6px;
									border: 1px solid var(--background-modifier-border);
									background: ${k?"var(--interactive-accent)":"var(--interactive-normal)"};
									color: ${k?"var(--text-on-accent)":"var(--text-normal)"};
									cursor: pointer;
									transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
								`},x=()=>!!this.tempSettings.wysiwyg.enableSyncBackup;E(x()),v.addEventListener("click",()=>{this.tempSettings.wysiwyg.enableSyncBackup=!x(),this.applySettings(),E(x())})}),this.createSettingItem(b,"\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u304F","\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u4FDD\u5B58\u5148\uFF08.obsidian/tategaki-sync-backups\uFF09\u3092\u958B\u304D\u307E\u3059\u3002",y=>{let v=y.createEl("button");v.textContent="\u958B\u304F",v.style.cssText=`
								padding: 6px 12px;
							`,v.addEventListener("click",()=>{this.plugin.openSyncBackupFolder()})}),this.createSettingItem(b,"\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5","\u540C\u671F\u306E\u5B89\u5168\u7B56\u3068\u3057\u3066\u4F5C\u6210\u3055\u308C\u305F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3059\uFF08\u5FA9\u5143\u3067\u304D\u306A\u304F\u306A\u308B\u306E\u3067\u6CE8\u610F\uFF09\u3002",y=>{let v=y.createEl("button");v.textContent="\u79FB\u52D5",v.style.cssText=`
								padding: 6px 12px;
								color: var(--text-on-accent);
								background: var(--text-accent);
								border: 1px solid var(--text-accent);
								border-radius: 6px;
							`,v.addEventListener("click",()=>{this.plugin.moveSyncBackupsToTrash()})})})}createSettingItem(e,i,r,o,s){let a=e.createDiv("setting-item");a.style.cssText=`
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px 0;
			border-bottom: 1px solid var(--background-modifier-border);
		`;let l=(s==null?void 0:s.disabled)===!0;l&&(a.style.opacity="0.6");let c=a.createDiv("setting-item-info");c.style.cssText=`
			flex: 1;
			margin-right: 20px;
		`,c.createDiv({text:i,attr:{style:"font-weight: 500; color: var(--text-normal); margin-bottom: 4px;"}}),c.createDiv({text:r,attr:{style:"font-size: 0.9em; color: var(--text-muted);"}}),s!=null&&s.disabledReason&&c.createDiv({text:s.disabledReason,attr:{style:"font-size: 0.85em; color: var(--text-accent); margin-top: 4px; padding: 2px 6px; border-radius: 6px; background: var(--background-secondary); display: inline-block;"}});let u=a.createDiv("setting-item-control"),d=o(u);d instanceof Promise?d.then(()=>{l&&this.disableControls(u)}).catch(h=>console.error("Error building control:",h)):l&&this.disableControls(u)}disableControls(e){e.style.pointerEvents="none",e.style.opacity="0.65",e.querySelectorAll("input, select, textarea, button").forEach(r=>{r.disabled=!0})}createColorSettingItem(e,i,r,o){this.createSettingItem(e,i,"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u8272\u3092\u5909\u66F4",s=>{let a=s.createEl("button");a.style.cssText=`
					width: 60px;
					height: 30px;
					border: 1px solid var(--background-modifier-border);
					border-radius: var(--radius-s);
					cursor: pointer;
					background: ${r};
				`,a.addEventListener("click",()=>{Tw(`${i}\u3092\u9078\u629E`,r,l=>{a.style.background=l,o(l)})})})}createThemeSelector(e){let i=e.createDiv();i.style.cssText=`
			padding: 12px 0;
		`;let r=i.createDiv();r.style.cssText=`
			display: flex;
			gap: 8px;
			margin-bottom: 10px;
		`;let o=r.createEl("select");o.style.cssText=`
			flex: 1;
			padding: 8px 12px;
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			background: var(--background-primary);
			color: var(--text-normal);
		`,o.createEl("option",{text:"Obsidian \u30D9\u30FC\u30B9\u30C6\u30FC\u30DE",value:"obsidian-base"});let s=this.tempSettings.themes||[];s.forEach(h=>{o.createEl("option",{text:h.name,value:h.id})}),o.value=this.tempSettings.activeTheme||"obsidian-base";let a=r.createEl("button");a.textContent="\u518D\u9069\u7528",a.style.cssText=`
			padding: 8px 16px;
		`;let l=r.createEl("button");l.textContent="\u524A\u9664",l.className="mod-warning",l.style.cssText=`
			padding: 8px 16px;
		`;let c=h=>h==="obsidian-base"||Oo.includes(h);l.disabled=c(o.value);let u=async h=>{await this.plugin.loadTheme(h),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen()};a.addEventListener("click",async()=>{await u(o.value)}),o.addEventListener("change",async()=>{let h=o.value;l.disabled=c(h),await u(h)}),l.addEventListener("click",async()=>{let h=o.value;if(c(h))return;let p=s.find(g=>g.id===h);if(!p)return;confirm(`\u30C6\u30FC\u30DE\u300C${p.name}\u300D\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F`)&&(await this.plugin.deleteTheme(h),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen())});let d=i.createEl("button");d.textContent="\u73FE\u5728\u306E\u8A2D\u5B9A\u3092\u30C6\u30FC\u30DE\u3068\u3057\u3066\u4FDD\u5B58",d.className="mod-cta",d.style.cssText=`
			width: 100%;
			padding: 8px 12px;
		`,d.addEventListener("click",async()=>{try{new xc(this.app,async p=>{try{await this.plugin.updateSettings(this.tempSettings);let f=await this.plugin.createThemeFromCurrentSettings(p);this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen()}catch(f){console.error("Tategaki: Failed to save theme:",f)}}).open()}catch(h){console.error("Tategaki: Failed to open theme name modal:",h)}})}applySettings(e){if(e!=null&&e.debounce){this.applySettingsTimer!==null&&window.clearTimeout(this.applySettingsTimer),this.applySettingsTimer=window.setTimeout(()=>{this.applySettingsTimer=null,this.applySettings()},us.APPLY_DEBOUNCE_MS);return}this.applySettingsTimer!==null&&(window.clearTimeout(this.applySettingsTimer),this.applySettingsTimer=null);let i=JSON.stringify(this.tempSettings);if(i===this.lastAppliedSettingsSnapshot)return;let r=this.lastAppliedSettingsSnapshot;this.lastAppliedSettingsSnapshot=i;let o=JSON.parse(i);try{let s=this.onSettingsChange(o);s instanceof Promise&&s.catch(a=>{this.lastAppliedSettingsSnapshot=r,console.error("Tategaki SettingsPanel: failed to apply settings",a)})}catch(s){this.lastAppliedSettingsSnapshot=r,console.error("Tategaki SettingsPanel: failed to apply settings",s)}}async saveAsTheme(e){await this.plugin.updateSettings(this.tempSettings),await this.plugin.createThemeFromCurrentSettings(e,"\u30E6\u30FC\u30B6\u30FC\u4F5C\u6210\u30C6\u30FC\u30DE"),this.tempSettings=JSON.parse(JSON.stringify(this.plugin.settings)),this.onOpen()}onClose(){this.applySettingsTimer!==null&&(window.clearTimeout(this.applySettingsTimer),this.applySettingsTimer=null);let{contentEl:e}=this;e.empty()}};us.APPLY_DEBOUNCE_MS=120;var Dn=us;var ds=class{constructor(t){this.options=t,this.containerEl=t.parent.createDiv("tategaki-auxiliary-input"),this.textareaEl=this.containerEl.createEl("textarea",{cls:"tategaki-auxiliary-textarea",attr:{placeholder:"\u5165\u529B\u3057\u3066 Enter \u3067\u633F\u5165\u3001Shift+Enter \u3067\u6539\u884C...",rows:"3"}}),this.textareaEl.addEventListener("focus",()=>{var i,r;(r=(i=this.options).onFocus)==null||r.call(i),window.setTimeout(()=>{this.textareaEl.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},200)}),this.textareaEl.addEventListener("blur",()=>{var i,r;(r=(i=this.options).onBlur)==null||r.call(i)}),this.buttonsEl=this.containerEl.createDiv("tategaki-auxiliary-buttons"),this.buttonsEl.createEl("button",{text:"\u633F\u5165",cls:"mod-cta"}).addEventListener("click",()=>this.handleInsert()),this.textareaEl.addEventListener("keydown",i=>{var r,o,s,a,l,c;if(i.key==="Enter"&&!i.shiftKey){if(i.isComposing)return;i.preventDefault(),this.handleInsert();return}if(this.textareaEl.value.length===0&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(i.key)){i.preventDefault(),i.stopPropagation(),(o=(r=this.options).onNavigate)==null||o.call(r,i);return}if(i.key==="Backspace"&&(i.metaKey||i.ctrlKey)&&this.textareaEl.value.length===0){i.preventDefault(),(a=(s=this.options).onBackspaceEmpty)==null||a.call(s);return}if(i.key==="Backspace"&&this.textareaEl.value.length===0){i.preventDefault(),(c=(l=this.options).onBackspace)==null||c.call(l);return}}),this.resizeHandleVertical=this.containerEl.createDiv("tategaki-auxiliary-resize-bar vertical"),this.resizeHandleHorizontal=this.containerEl.createDiv("tategaki-auxiliary-resize-bar horizontal"),this.attachResizeHandlers(),this.updateLayout(t.isVertical)}attachResizeHandlers(){let t=(e,i)=>{e.preventDefault(),e.stopPropagation();let r=e.clientX,o=e.clientY,s=this.containerEl.offsetWidth,a=this.containerEl.offsetHeight,l=u=>{var d,h;if(i==="vertical"){let p=u.clientX-r,f=Math.max(80,s+p);this.containerEl.style.width=`${f}px`}else{let p=o-u.clientY,f=Math.max(60,a+p);this.containerEl.style.height=`${f}px`}(h=(d=this.options).onResize)==null||h.call(d)},c=()=>{document.removeEventListener("pointermove",l),document.removeEventListener("pointerup",c)};document.addEventListener("pointermove",l),document.addEventListener("pointerup",c)};this.resizeHandleVertical.addEventListener("pointerdown",e=>t(e,"vertical")),this.resizeHandleHorizontal.addEventListener("pointerdown",e=>t(e,"horizontal"))}handleInsert(){let t=this.textareaEl.value,e=t.length>0?t:`
`;this.options.onInsert(e),this.textareaEl.value=""}updateLayout(t){this.containerEl.removeClass("is-vertical","is-horizontal"),this.containerEl.addClass(t?"is-vertical":"is-horizontal"),this.containerEl.style.width="",this.containerEl.style.height="",this.resizeHandleVertical.toggleClass("visible",t),this.resizeHandleHorizontal.toggleClass("visible",!t)}show(){this.containerEl.style.display="flex"}hide(){this.containerEl.style.display="none"}destroy(){this.containerEl.remove()}};var hs=(n,t)=>n.selection.empty?!1:(t&&t(n.tr.deleteSelection().scrollIntoView()),!0);function bf(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("backward",n):e.parentOffset>0)?null:e}var wc=(n,t,e)=>{let i=bf(n,e);if(!i)return!1;let r=Mc(i);if(!r){let s=i.blockRange(),a=s&&mn(s);return a==null?!1:(t&&t(n.tr.lift(s,a).scrollIntoView()),!0)}let o=r.nodeBefore;if(Tf(n,r,t,-1))return!0;if(i.parent.content.size==0&&(Ki(o,"end")||Y.isSelectable(o)))for(let s=i.depth;;s--){let a=Or(n.doc,i.before(s),i.after(s),q.empty);if(a&&a.slice.size<a.to-a.from){if(t){let l=n.tr.step(a);l.setSelection(Ki(o,"end")?ie.findFrom(l.doc.resolve(l.mapping.map(r.pos,-1)),-1):Y.create(l.doc,r.pos-o.nodeSize)),t(l.scrollIntoView())}return!0}if(s==1||i.node(s-1).childCount>1)break}return o.isAtom&&r.depth==i.depth-1?(t&&t(n.tr.delete(r.pos-o.nodeSize,r.pos).scrollIntoView()),!0):!1},yf=(n,t,e)=>{let i=bf(n,e);if(!i)return!1;let r=Mc(i);return r?Ef(n,r,t):!1},vf=(n,t,e)=>{let i=xf(n,e);if(!i)return!1;let r=Lc(i);return r?Ef(n,r,t):!1};function Ef(n,t,e){let i=t.nodeBefore,r=i,o=t.pos-1;for(;!r.isTextblock;o--){if(r.type.spec.isolating)return!1;let u=r.lastChild;if(!u)return!1;r=u}let s=t.nodeAfter,a=s,l=t.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=Or(n.doc,o,l,q.empty);if(!c||c.from!=o||c instanceof st&&c.slice.size>=l-o)return!1;if(e){let u=n.tr.step(c);u.setSelection(j.create(u.doc,o)),e(u.scrollIntoView())}return!0}function Ki(n,t,e=!1){for(let i=n;i;i=t=="start"?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(e&&i.childCount!=1)return!1}return!1}var Sc=(n,t,e)=>{let{$head:i,empty:r}=n.selection,o=i;if(!r)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("backward",n):i.parentOffset>0)return!1;o=Mc(i)}let s=o&&o.nodeBefore;return!s||!Y.isSelectable(s)?!1:(t&&t(n.tr.setSelection(Y.create(n.doc,o.pos-s.nodeSize)).scrollIntoView()),!0)};function Mc(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function xf(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("forward",n):e.parentOffset<e.parent.content.size)?null:e}var Tc=(n,t,e)=>{let i=xf(n,e);if(!i)return!1;let r=Lc(i);if(!r)return!1;let o=r.nodeAfter;if(Tf(n,r,t,1))return!0;if(i.parent.content.size==0&&(Ki(o,"start")||Y.isSelectable(o))){let s=Or(n.doc,i.before(),i.after(),q.empty);if(s&&s.slice.size<s.to-s.from){if(t){let a=n.tr.step(s);a.setSelection(Ki(o,"start")?ie.findFrom(a.doc.resolve(a.mapping.map(r.pos)),1):Y.create(a.doc,a.mapping.map(r.pos))),t(a.scrollIntoView())}return!0}}return o.isAtom&&r.depth==i.depth-1?(t&&t(n.tr.delete(r.pos,r.pos+o.nodeSize).scrollIntoView()),!0):!1},Cc=(n,t,e)=>{let{$head:i,empty:r}=n.selection,o=i;if(!r)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("forward",n):i.parentOffset<i.parent.content.size)return!1;o=Lc(i)}let s=o&&o.nodeAfter;return!s||!Y.isSelectable(s)?!1:(t&&t(n.tr.setSelection(Y.create(n.doc,o.pos)).scrollIntoView()),!0)};function Lc(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){let e=n.node(t);if(n.index(t)+1<e.childCount)return n.doc.resolve(n.after(t+1));if(e.type.spec.isolating)break}return null}var kf=(n,t)=>{let e=n.selection,i=e instanceof Y,r;if(i){if(e.node.isTextblock||!Pt(n.doc,e.from))return!1;r=e.from}else if(r=ci(n.doc,e.from,-1),r==null)return!1;if(t){let o=n.tr.join(r);i&&o.setSelection(Y.create(o.doc,r-n.doc.resolve(r).nodeBefore.nodeSize)),t(o.scrollIntoView())}return!0},wf=(n,t)=>{let e=n.selection,i;if(e instanceof Y){if(e.node.isTextblock||!Pt(n.doc,e.to))return!1;i=e.to}else if(i=ci(n.doc,e.to,1),i==null)return!1;return t&&t(n.tr.join(i).scrollIntoView()),!0},Sf=(n,t)=>{let{$from:e,$to:i}=n.selection,r=e.blockRange(i),o=r&&mn(r);return o==null?!1:(t&&t(n.tr.lift(r,o).scrollIntoView()),!0)},Rc=(n,t)=>{let{$head:e,$anchor:i}=n.selection;return!e.parent.type.spec.code||!e.sameParent(i)?!1:(t&&t(n.tr.insertText(`
`).scrollIntoView()),!0)};function Ac(n){for(let t=0;t<n.edgeCount;t++){let{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}var Ic=(n,t)=>{let{$head:e,$anchor:i}=n.selection;if(!e.parent.type.spec.code||!e.sameParent(i))return!1;let r=e.node(-1),o=e.indexAfter(-1),s=Ac(r.contentMatchAt(o));if(!s||!r.canReplaceWith(o,o,s))return!1;if(t){let a=e.after(),l=n.tr.replaceWith(a,a,s.createAndFill());l.setSelection(ie.near(l.doc.resolve(a),1)),t(l.scrollIntoView())}return!0},Nc=(n,t)=>{let e=n.selection,{$from:i,$to:r}=e;if(e instanceof ht||i.parent.inlineContent||r.parent.inlineContent)return!1;let o=Ac(r.parent.contentMatchAt(r.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let s=(!i.parentOffset&&r.index()<r.parent.childCount?i:r).pos,a=n.tr.insert(s,o.createAndFill());a.setSelection(j.create(a.doc,s+1)),t(a.scrollIntoView())}return!0},Pc=(n,t)=>{let{$cursor:e}=n.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let o=e.before();if(Lt(n.doc,o))return t&&t(n.tr.split(o).scrollIntoView()),!0}let i=e.blockRange(),r=i&&mn(i);return r==null?!1:(t&&t(n.tr.lift(i,r).scrollIntoView()),!0)};function Cw(n){return(t,e)=>{let{$from:i,$to:r}=t.selection;if(t.selection instanceof Y&&t.selection.node.isBlock)return!i.parentOffset||!Lt(t.doc,i.pos)?!1:(e&&e(t.tr.split(i.pos).scrollIntoView()),!0);if(!i.depth)return!1;let o=[],s,a,l=!1,c=!1;for(let p=i.depth;;p--)if(i.node(p).isBlock){l=i.end(p)==i.pos+(i.depth-p),c=i.start(p)==i.pos-(i.depth-p),a=Ac(i.node(p-1).contentMatchAt(i.indexAfter(p-1)));let g=n&&n(r.parent,l,i);o.unshift(g||(l&&a?{type:a}:null)),s=p;break}else{if(p==1)return!1;o.unshift(null)}let u=t.tr;(t.selection instanceof j||t.selection instanceof ht)&&u.deleteSelection();let d=u.mapping.map(i.pos),h=Lt(u.doc,d,o.length,o);if(h||(o[0]=a?{type:a}:null,h=Lt(u.doc,d,o.length,o)),!h)return!1;if(u.split(d,o.length,o),!l&&c&&i.node(s).type!=a){let p=u.mapping.map(i.before(s)),f=u.doc.resolve(p);a&&i.node(s-1).canReplaceWith(f.index(),f.index()+1,a)&&u.setNodeMarkup(u.mapping.map(i.before(s)),a)}return e&&e(u.scrollIntoView()),!0}}var Lw=Cw();var Mf=(n,t)=>{let{$from:e,to:i}=n.selection,r,o=e.sharedDepth(i);return o==0?!1:(r=e.before(o),t&&t(n.tr.setSelection(Y.create(n.doc,r))),!0)},Rw=(n,t)=>(t&&t(n.tr.setSelection(new ht(n.doc))),!0);function Aw(n,t,e){let i=t.nodeBefore,r=t.nodeAfter,o=t.index();return!i||!r||!i.type.compatibleContent(r.type)?!1:!i.content.size&&t.parent.canReplace(o-1,o)?(e&&e(n.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(o,o+1)||!(r.isTextblock||Pt(n.doc,t.pos))?!1:(e&&e(n.tr.join(t.pos).scrollIntoView()),!0)}function Tf(n,t,e,i){let r=t.nodeBefore,o=t.nodeAfter,s,a,l=r.type.spec.isolating||o.type.spec.isolating;if(!l&&Aw(n,t,e))return!0;let c=!l&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(s=(a=r.contentMatchAt(r.childCount)).findWrapping(o.type))&&a.matchType(s[0]||o.type).validEnd){if(e){let p=t.pos+o.nodeSize,f=z.empty;for(let b=s.length-1;b>=0;b--)f=z.from(s[b].create(null,f));f=z.from(r.copy(f));let g=n.tr.step(new ze(t.pos-1,p,t.pos,p,new q(f,1,0),s.length,!0)),m=g.doc.resolve(p+2*s.length);m.nodeAfter&&m.nodeAfter.type==r.type&&Pt(g.doc,m.pos)&&g.join(m.pos),e(g.scrollIntoView())}return!0}let u=o.type.spec.isolating||i>0&&l?null:ie.findFrom(t,1),d=u&&u.$from.blockRange(u.$to),h=d&&mn(d);if(h!=null&&h>=t.depth)return e&&e(n.tr.lift(d,h).scrollIntoView()),!0;if(c&&Ki(o,"start",!0)&&Ki(r,"end")){let p=r,f=[];for(;f.push(p),!p.isTextblock;)p=p.lastChild;let g=o,m=1;for(;!g.isTextblock;g=g.firstChild)m++;if(p.canReplace(p.childCount,p.childCount,g.content)){if(e){let b=z.empty;for(let v=f.length-1;v>=0;v--)b=z.from(f[v].copy(b));let y=n.tr.step(new ze(t.pos-f.length,t.pos+o.nodeSize,t.pos+m,t.pos+o.nodeSize-m,new q(b,f.length,0),0,!0));e(y.scrollIntoView())}return!0}}return!1}function Cf(n){return function(t,e){let i=t.selection,r=n<0?i.$from:i.$to,o=r.depth;for(;r.node(o).isInline;){if(!o)return!1;o--}return r.node(o).isTextblock?(e&&e(t.tr.setSelection(j.create(t.doc,n<0?r.start(o):r.end(o)))),!0):!1}}var _c=Cf(-1),Oc=Cf(1);function Lf(n,t=null){return function(e,i){let{$from:r,$to:o}=e.selection,s=r.blockRange(o),a=s&&Hi(s,n,t);return a?(i&&i(e.tr.wrap(s,a).scrollIntoView()),!0):!1}}function Dc(n,t=null){return function(e,i){let r=!1;for(let o=0;o<e.selection.ranges.length&&!r;o++){let{$from:{pos:s},$to:{pos:a}}=e.selection.ranges[o];e.doc.nodesBetween(s,a,(l,c)=>{if(r)return!1;if(!(!l.isTextblock||l.hasMarkup(n,t)))if(l.type==n)r=!0;else{let u=e.doc.resolve(c),d=u.index();r=u.parent.canReplaceWith(d,d+1,n)}})}if(!r)return!1;if(i){let o=e.tr;for(let s=0;s<e.selection.ranges.length;s++){let{$from:{pos:a},$to:{pos:l}}=e.selection.ranges[s];o.setBlockType(a,l,n,t)}i(o.scrollIntoView())}return!0}}function Bc(...n){return function(t,e,i){for(let r=0;r<n.length;r++)if(n[r](t,e,i))return!0;return!1}}var kc=Bc(hs,wc,Sc),gf=Bc(hs,Tc,Cc),Bn={Enter:Bc(Rc,Nc,Pc,Lw),"Mod-Enter":Ic,Backspace:kc,"Mod-Backspace":kc,"Shift-Backspace":kc,Delete:gf,"Mod-Delete":gf,"Mod-a":Rw},Iw={"Ctrl-h":Bn.Backspace,"Alt-Backspace":Bn["Mod-Backspace"],"Ctrl-d":Bn.Delete,"Ctrl-Alt-Backspace":Bn["Mod-Delete"],"Alt-Delete":Bn["Mod-Delete"],"Alt-d":Bn["Mod-Delete"],"Ctrl-a":_c,"Ctrl-e":Oc};for(let n in Bn)Iw[n]=Bn[n];var aO=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform?os.platform()=="darwin":!1;function Rf(n,t=null){return function(e,i){let{$from:r,$to:o}=e.selection,s=r.blockRange(o);if(!s)return!1;let a=i?e.tr:null;return Nw(a,s,n,t)?(i&&i(a.scrollIntoView()),!0):!1}}function Nw(n,t,e,i=null){let r=!1,o=t,s=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let l=s.resolve(t.start-2);o=new ai(l,l,t.depth),t.endIndex<t.parent.childCount&&(t=new ai(t.$from,s.resolve(t.$to.end(t.depth)),t.depth)),r=!0}let a=Hi(o,e,i,t);return a?(n&&Pw(n,t,a,r,e),!0):!1}function Pw(n,t,e,i,r){let o=z.empty;for(let u=e.length-1;u>=0;u--)o=z.from(e[u].type.create(e[u].attrs,o));n.step(new ze(t.start-(i?2:0),t.end,t.start,t.end,new q(o,0,0),e.length,!0));let s=0;for(let u=0;u<e.length;u++)e[u].type==r&&(s=u+1);let a=e.length-s,l=t.start+e.length-(i?2:0),c=t.parent;for(let u=t.startIndex,d=t.endIndex,h=!0;u<d;u++,h=!1)!h&&Lt(n.doc,l,a)&&(n.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return n}function Af(n){return function(t,e){let{$from:i,$to:r}=t.selection,o=i.blockRange(r,s=>s.childCount>0&&s.firstChild.type==n);return o?e?i.node(o.depth-1).type==n?_w(t,e,n,o):Ow(t,e,o):!0:!1}}function _w(n,t,e,i){let r=n.tr,o=i.end,s=i.$to.end(i.depth);o<s&&(r.step(new ze(o-1,s,o,s,new q(z.from(e.create(null,i.parent.copy())),1,0),1,!0)),i=new ai(r.doc.resolve(i.$from.pos),r.doc.resolve(s),i.depth));let a=mn(i);if(a==null)return!1;r.lift(i,a);let l=r.doc.resolve(r.mapping.map(o,-1)-1);return Pt(r.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&r.join(l.pos),t(r.scrollIntoView()),!0}function Ow(n,t,e){let i=n.tr,r=e.parent;for(let p=e.end,f=e.endIndex-1,g=e.startIndex;f>g;f--)p-=r.child(f).nodeSize,i.delete(p-1,p+1);let o=i.doc.resolve(e.start),s=o.nodeAfter;if(i.mapping.map(e.end)!=e.start+o.nodeAfter.nodeSize)return!1;let a=e.startIndex==0,l=e.endIndex==r.childCount,c=o.node(-1),u=o.index(-1);if(!c.canReplace(u+(a?0:1),u+1,s.content.append(l?z.empty:z.from(r))))return!1;let d=o.pos,h=d+s.nodeSize;return i.step(new ze(d-(a?1:0),h+(l?1:0),d+1,h-1,new q((a?z.empty:z.from(r.copy(z.empty))).append(l?z.empty:z.from(r.copy(z.empty))),a?0:1,l?0:1),a?0:1)),t(i.scrollIntoView()),!0}function If(n){return function(t,e){let{$from:i,$to:r}=t.selection,o=i.blockRange(r,c=>c.childCount>0&&c.firstChild.type==n);if(!o)return!1;let s=o.startIndex;if(s==0)return!1;let a=o.parent,l=a.child(s-1);if(l.type!=n)return!1;if(e){let c=l.lastChild&&l.lastChild.type==a.type,u=z.from(c?n.create():null),d=new q(z.from(n.create(null,z.from(a.type.create(null,u)))),c?3:1,0),h=o.start,p=o.end;e(t.tr.step(new ze(h-(c?3:1),p,h,p,d,1,!0)).scrollIntoView())}return!0}}var tt=function(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t},Xi=function(n){let t=n.assignedSlot||n.parentNode;return t&&t.nodeType==11?t.host:t},Wc=null,bn=function(n,t,e){let i=Wc||(Wc=document.createRange());return i.setEnd(n,e==null?n.nodeValue.length:e),i.setStart(n,t||0),i},Dw=function(){Wc=null},yi=function(n,t,e,i){return e&&(Nf(n,t,e,i,-1)||Nf(n,t,e,i,1))},Bw=/^(img|br|input|textarea|hr)$/i;function Nf(n,t,e,i,r){for(var o;;){if(n==e&&t==i)return!0;if(t==(r<0?0:Ot(n))){let s=n.parentNode;if(!s||s.nodeType!=1||Ur(n)||Bw.test(n.nodeName)||n.contentEditable=="false")return!1;t=tt(n)+(r<0?0:1),n=s}else if(n.nodeType==1){let s=n.childNodes[t+(r<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((o=s.pmViewDesc)===null||o===void 0)&&o.ignoreForSelection)t+=r;else return!1;else n=s,t=r<0?Ot(n):0}else return!1}}function Ot(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Fw(n,t){for(;;){if(n.nodeType==3&&t)return n;if(n.nodeType==1&&t>0){if(n.contentEditable=="false")return null;n=n.childNodes[t-1],t=Ot(n)}else if(n.parentNode&&!Ur(n))t=tt(n),n=n.parentNode;else return null}}function Hw(n,t){for(;;){if(n.nodeType==3&&t<n.nodeValue.length)return n;if(n.nodeType==1&&t<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[t],t=0}else if(n.parentNode&&!Ur(n))t=tt(n)+1,n=n.parentNode;else return null}}function zw(n,t,e){for(let i=t==0,r=t==Ot(n);i||r;){if(n==e)return!0;let o=tt(n);if(n=n.parentNode,!n)return!1;i=i&&o==0,r=r&&o==Ot(n)}}function Ur(n){let t;for(let e=n;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}var ws=function(n){return n.focusNode&&yi(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function hi(n,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=n,e.key=e.code=t,e}function Vw(n){let t=n.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function $w(n,t,e){if(n.caretPositionFromPoint)try{let i=n.caretPositionFromPoint(t,e);if(i)return{node:i.offsetNode,offset:Math.min(Ot(i.offsetNode),i.offset)}}catch(i){}if(n.caretRangeFromPoint){let i=n.caretRangeFromPoint(t,e);if(i)return{node:i.startContainer,offset:Math.min(Ot(i.startContainer),i.startOffset)}}}var Qt=typeof navigator!="undefined"?navigator:null,Pf=typeof document!="undefined"?document:null,Wn=Qt&&Qt.userAgent||"",Uc=/Edge\/(\d+)/.exec(Wn),dm=/MSIE \d/.exec(Wn),Kc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Wn),Et=!!(dm||Kc||Uc),Vn=dm?document.documentMode:Kc?+Kc[1]:Uc?+Uc[1]:0,Dt=!Et&&/gecko\/(\d+)/i.test(Wn);Dt&&+(/Firefox\/(\d+)/.exec(Wn)||[0,0])[1];var qc=!Et&&/Chrome\/(\d+)/.exec(Wn),ct=!!qc,hm=qc?+qc[1]:0,pt=!Et&&!!Qt&&/Apple Computer/.test(Qt.vendor),Ji=pt&&(/Mobile\/\w+/.test(Wn)||!!Qt&&Qt.maxTouchPoints>2),_t=Ji||(Qt?/Mac/.test(Qt.platform):!1),Ww=Qt?/Win/.test(Qt.platform):!1,yn=/Android \d/.test(Wn),Kr=!!Pf&&"webkitFontSmoothing"in Pf.documentElement.style,Uw=Kr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Kw(n){let t=n.defaultView&&n.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function gn(n,t){return typeof n=="number"?n:n[t]}function qw(n){let t=n.getBoundingClientRect(),e=t.width/n.offsetWidth||1,i=t.height/n.offsetHeight||1;return{left:t.left,right:t.left+n.clientWidth*e,top:t.top,bottom:t.top+n.clientHeight*i}}function _f(n,t,e){let i=n.someProp("scrollThreshold")||0,r=n.someProp("scrollMargin")||5,o=n.dom.ownerDocument;for(let s=e||n.dom;s;){if(s.nodeType!=1){s=Xi(s);continue}let a=s,l=a==o.body,c=l?Kw(o):qw(a),u=0,d=0;if(t.top<c.top+gn(i,"top")?d=-(c.top-t.top+gn(r,"top")):t.bottom>c.bottom-gn(i,"bottom")&&(d=t.bottom-t.top>c.bottom-c.top?t.top+gn(r,"top")-c.top:t.bottom-c.bottom+gn(r,"bottom")),t.left<c.left+gn(i,"left")?u=-(c.left-t.left+gn(r,"left")):t.right>c.right-gn(i,"right")&&(u=t.right-c.right+gn(r,"right")),u||d)if(l)o.defaultView.scrollBy(u,d);else{let p=a.scrollLeft,f=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let g=a.scrollLeft-p,m=a.scrollTop-f;t={left:t.left-g,top:t.top-m,right:t.right-g,bottom:t.bottom-m}}let h=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(h))break;s=h=="absolute"?s.offsetParent:Xi(s)}}function Gw(n){let t=n.dom.getBoundingClientRect(),e=Math.max(0,t.top),i,r;for(let o=(t.left+t.right)/2,s=e+1;s<Math.min(innerHeight,t.bottom);s+=5){let a=n.root.elementFromPoint(o,s);if(!a||a==n.dom||!n.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=e-20){i=a,r=l.top;break}}return{refDOM:i,refTop:r,stack:pm(n.dom)}}function pm(n){let t=[],e=n.ownerDocument;for(let i=n;i&&(t.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),n!=e);i=Xi(i));return t}function jw({refDOM:n,refTop:t,stack:e}){let i=n?n.getBoundingClientRect().top:0;fm(e,i==0?0:i-t)}function fm(n,t){for(let e=0;e<n.length;e++){let{dom:i,top:r,left:o}=n[e];i.scrollTop!=r+t&&(i.scrollTop=r+t),i.scrollLeft!=o&&(i.scrollLeft=o)}}var qi=null;function Yw(n){if(n.setActive)return n.setActive();if(qi)return n.focus(qi);let t=pm(n);n.focus(qi==null?{get preventScroll(){return qi={preventScroll:!0},!0}}:void 0),qi||(qi=!1,fm(t,0))}function mm(n,t){let e,i=2e8,r,o=0,s=t.top,a=t.top,l,c;for(let u=n.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=bn(u).getClientRects();else continue;for(let p=0;p<h.length;p++){let f=h[p];if(f.top<=s&&f.bottom>=a){s=Math.max(f.bottom,s),a=Math.min(f.top,a);let g=f.left>t.left?f.left-t.left:f.right<t.left?t.left-f.right:0;if(g<i){e=u,i=g,r=g&&e.nodeType==3?{left:f.right<t.left?f.right:f.left,top:t.top}:t,u.nodeType==1&&g&&(o=d+(t.left>=(f.left+f.right)/2?1:0));continue}}else f.top>t.top&&!l&&f.left<=t.left&&f.right>=t.left&&(l=u,c={left:Math.max(f.left,Math.min(f.right,t.left)),top:f.top});!e&&(t.left>=f.right&&t.top>=f.top||t.left>=f.left&&t.top>=f.bottom)&&(o=d+1)}}return!e&&l&&(e=l,r=c,i=0),e&&e.nodeType==3?Xw(e,r):!e||i&&e.nodeType==1?{node:n,offset:o}:mm(e,r)}function Xw(n,t){let e=n.nodeValue.length,i=document.createRange();for(let r=0;r<e;r++){i.setEnd(n,r+1),i.setStart(n,r);let o=Fn(i,1);if(o.top!=o.bottom&&au(t,o))return{node:n,offset:r+(t.left>=(o.left+o.right)/2?1:0)}}return{node:n,offset:0}}function au(n,t){return n.left>=t.left-1&&n.left<=t.right+1&&n.top>=t.top-1&&n.top<=t.bottom+1}function Jw(n,t){let e=n.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<n.getBoundingClientRect().left?e:n}function Zw(n,t,e){let{node:i,offset:r}=mm(t,e),o=-1;if(i.nodeType==1&&!i.firstChild){let s=i.getBoundingClientRect();o=s.left!=s.right&&e.left>(s.left+s.right)/2?1:-1}return n.docView.posFromDOM(i,r,o)}function Qw(n,t,e,i){let r=-1;for(let o=t,s=!1;o!=n.dom;){let a=n.docView.nearestDesc(o,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!s&&l.left>i.left||l.top>i.top?r=a.posBefore:(!s&&l.right<i.left||l.bottom<i.top)&&(r=a.posAfter),s=!0),!a.contentDOM&&r<0&&!a.node.isText))return(a.node.isBlock?i.top<(l.top+l.bottom)/2:i.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;o=a.dom.parentNode}return r>-1?r:n.docView.posFromDOM(t,e,-1)}function gm(n,t,e){let i=n.childNodes.length;if(i&&e.top<e.bottom)for(let r=Math.max(0,Math.min(i-1,Math.floor(i*(t.top-e.top)/(e.bottom-e.top))-2)),o=r;;){let s=n.childNodes[o];if(s.nodeType==1){let a=s.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(au(t,c))return gm(s,t,c)}}if((o=(o+1)%i)==r)break}return n}function eS(n,t){let e=n.dom.ownerDocument,i,r=0,o=$w(e,t.left,t.top);o&&({node:i,offset:r}=o);let s=(n.root.elementFromPoint?n.root:e).elementFromPoint(t.left,t.top),a;if(!s||!n.dom.contains(s.nodeType!=1?s.parentNode:s)){let c=n.dom.getBoundingClientRect();if(!au(t,c)||(s=gm(n.dom,t,c),!s))return null}if(pt)for(let c=s;i&&c;c=Xi(c))c.draggable&&(i=void 0);if(s=Jw(s,t),i){if(Dt&&i.nodeType==1&&(r=Math.min(r,i.childNodes.length),r<i.childNodes.length)){let u=i.childNodes[r],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=t.left&&d.bottom>t.top&&r++}let c;Kr&&r&&i.nodeType==1&&(c=i.childNodes[r-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=t.top&&r--,i==n.dom&&r==i.childNodes.length-1&&i.lastChild.nodeType==1&&t.top>i.lastChild.getBoundingClientRect().bottom?a=n.state.doc.content.size:(r==0||i.nodeType!=1||i.childNodes[r-1].nodeName!="BR")&&(a=Qw(n,i,r,t))}a==null&&(a=Zw(n,s,t));let l=n.docView.nearestDesc(s,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function Of(n){return n.top<n.bottom||n.left<n.right}function Fn(n,t){let e=n.getClientRects();if(e.length){let i=e[t<0?0:e.length-1];if(Of(i))return i}return Array.prototype.find.call(e,Of)||n.getBoundingClientRect()}var tS=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function bm(n,t,e){let{node:i,offset:r,atom:o}=n.docView.domFromPos(t,e<0?-1:1),s=Kr||Dt;if(i.nodeType==3)if(s&&(tS.test(i.nodeValue)||(e<0?!r:r==i.nodeValue.length))){let l=Fn(bn(i,r,r),e);if(Dt&&r&&/\s/.test(i.nodeValue[r-1])&&r<i.nodeValue.length){let c=Fn(bn(i,r-1,r-1),-1);if(c.top==l.top){let u=Fn(bn(i,r,r+1),-1);if(u.top!=l.top)return Br(u,u.left<c.left)}}return l}else{let l=r,c=r,u=e<0?1:-1;return e<0&&!r?(c++,u=-1):e>=0&&r==i.nodeValue.length?(l--,u=1):e<0?l--:c++,Br(Fn(bn(i,l,c),u),u<0)}if(!n.state.doc.resolve(t-(o||0)).parent.inlineContent){if(o==null&&r&&(e<0||r==Ot(i))){let l=i.childNodes[r-1];if(l.nodeType==1)return Fc(l.getBoundingClientRect(),!1)}if(o==null&&r<Ot(i)){let l=i.childNodes[r];if(l.nodeType==1)return Fc(l.getBoundingClientRect(),!0)}return Fc(i.getBoundingClientRect(),e>=0)}if(o==null&&r&&(e<0||r==Ot(i))){let l=i.childNodes[r-1],c=l.nodeType==3?bn(l,Ot(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Br(Fn(c,1),!1)}if(o==null&&r<Ot(i)){let l=i.childNodes[r];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?bn(l,0,s?0:1):l.nodeType==1?l:null:null;if(c)return Br(Fn(c,-1),!0)}return Br(Fn(i.nodeType==3?bn(i):i,-e),e>=0)}function Br(n,t){if(n.width==0)return n;let e=t?n.left:n.right;return{top:n.top,bottom:n.bottom,left:e,right:e}}function Fc(n,t){if(n.height==0)return n;let e=t?n.top:n.bottom;return{top:e,bottom:e,left:n.left,right:n.right}}function ym(n,t,e){let i=n.state,r=n.root.activeElement;i!=t&&n.updateState(t),r!=n.dom&&n.focus();try{return e()}finally{i!=t&&n.updateState(i),r!=n.dom&&r&&r.focus()}}function nS(n,t,e){let i=t.selection,r=e=="up"?i.$from:i.$to;return ym(n,t,()=>{let{node:o}=n.docView.domFromPos(r.pos,e=="up"?-1:1);for(;;){let a=n.docView.nearestDesc(o,!0);if(!a)break;if(a.node.isBlock){o=a.contentDOM||a.dom;break}o=a.dom.parentNode}let s=bm(n,r.pos,1);for(let a=o.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=bn(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(e=="up"?s.top-u.top>(u.bottom-s.top)*2:u.bottom-s.bottom>(s.bottom-u.top)*2))return!1}}return!0})}var iS=/[\u0590-\u08ac]/;function rS(n,t,e){let{$head:i}=t.selection;if(!i.parent.isTextblock)return!1;let r=i.parentOffset,o=!r,s=r==i.parent.content.size,a=n.domSelection();return a?!iS.test(i.parent.textContent)||!a.modify?e=="left"||e=="backward"?o:s:ym(n,t,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=n.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",e,"character");let p=i.depth?n.docView.domAfterPos(i.before()):n.dom,{focusNode:f,focusOffset:g}=n.domSelectionRange(),m=f&&!p.contains(f.nodeType==1?f:f.parentNode)||l==f&&c==g;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch(b){}return h!=null&&(a.caretBidiLevel=h),m}):i.pos==i.start()||i.pos==i.end()}var Df=null,Bf=null,Ff=!1;function oS(n,t,e){return Df==t&&Bf==e?Ff:(Df=t,Bf=e,Ff=e=="up"||e=="down"?nS(n,t,e):rS(n,t,e))}var Bt=0,Hf=1,pi=2,en=3,vi=class{constructor(t,e,i,r){this.parent=t,this.children=e,this.dom=i,this.contentDOM=r,this.dirty=Bt,i.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,i){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,i=this.posAtStart;;e++){let r=this.children[e];if(r==t)return i;i+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,i){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(i<0){let o,s;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(s)+s.size:this.posAtStart}else{let o,s;if(t==this.contentDOM)o=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.nextSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(s):this.posAtEnd}let r;if(t==this.dom&&this.contentDOM)r=e>tt(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(e==0)for(let o=t;;o=o.parentNode){if(o==this.dom){r=!1;break}if(o.previousSibling)break}if(r==null&&e==t.childNodes.length)for(let o=t;;o=o.parentNode){if(o==this.dom){r=!0;break}if(o.nextSibling)break}}return(r==null?i>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let i=!0,r=t;r;r=r.parentNode){let o=this.getDesc(r),s;if(o&&(!e||o.node))if(i&&(s=o.nodeDOM)&&!(s.nodeType==1?s.contains(t.nodeType==1?t:t.parentNode):s==t))i=!1;else return o}}getDesc(t){let e=t.pmViewDesc;for(let i=e;i;i=i.parent)if(i==this)return e}posFromDOM(t,e,i){for(let r=t;r;r=r.parentNode){let o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,i)}return-1}descAt(t){for(let e=0,i=0;e<this.children.length;e++){let r=this.children[e],o=i+r.size;if(i==t&&o!=i){for(;!r.border&&r.children.length;)for(let s=0;s<r.children.length;s++){let a=r.children[s];if(a.size){r=a;break}}return r}if(t<o)return r.descAt(t-i-r.border);i=o}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let i=0,r=0;for(let o=0;i<this.children.length;i++){let s=this.children[i],a=o+s.size;if(a>t||s instanceof ms){r=t-o;break}o=a}if(r)return this.children[i].domFromPos(r-this.children[i].border,e);for(let o;i&&!(o=this.children[i-1]).size&&o instanceof ps&&o.side>=0;i--);if(e<=0){let o,s=!0;for(;o=i?this.children[i-1]:null,!(!o||o.dom.parentNode==this.contentDOM);i--,s=!1);return o&&e&&s&&!o.border&&!o.domAtom?o.domFromPos(o.size,e):{node:this.contentDOM,offset:o?tt(o.dom)+1:0}}else{let o,s=!0;for(;o=i<this.children.length?this.children[i]:null,!(!o||o.dom.parentNode==this.contentDOM);i++,s=!1);return o&&s&&!o.border&&!o.domAtom?o.domFromPos(0,e):{node:this.contentDOM,offset:o?tt(o.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,i=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,o=-1;for(let s=i,a=0;;a++){let l=this.children[a],c=s+l.size;if(r==-1&&t<=c){let u=s+l.border;if(t>=u&&e<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(t,e,u);t=s;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){r=tt(h.dom)+1;break}t-=h.size}r==-1&&(r=0)}if(r>-1&&(c>e||a==this.children.length-1)){e=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){o=tt(d.dom);break}e+=d.size}o==-1&&(o=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return e.size==0||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:i}=this.domFromPos(t,0);if(e.nodeType!=1||i==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[i]}setSelection(t,e,i,r=!1){let o=Math.min(t,e),s=Math.max(t,e);for(let p=0,f=0;p<this.children.length;p++){let g=this.children[p],m=f+g.size;if(o>f&&s<m)return g.setSelection(t-f-g.border,e-f-g.border,i,r);f=m}let a=this.domFromPos(t,t?-1:1),l=e==t?a:this.domFromPos(e,e?-1:1),c=i.root.getSelection(),u=i.domSelectionRange(),d=!1;if((Dt||pt)&&t==e){let{node:p,offset:f}=a;if(p.nodeType==3){if(d=!!(f&&p.nodeValue[f-1]==`
`),d&&f==p.nodeValue.length)for(let g=p,m;g;g=g.parentNode){if(m=g.nextSibling){m.nodeName=="BR"&&(a=l={node:m.parentNode,offset:tt(m)+1});break}let b=g.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{let g=p.childNodes[f-1];d=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(Dt&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let p=u.focusNode.childNodes[u.focusOffset];p&&p.contentEditable=="false"&&(r=!0)}if(!(r||d&&pt)&&yi(a.node,a.offset,u.anchorNode,u.anchorOffset)&&yi(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||t==e)&&!(d&&Dt)){c.collapse(a.node,a.offset);try{t!=e&&c.extend(l.node,l.offset),h=!0}catch(p){}}if(!h){if(t>e){let f=a;a=l,l=f}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(p)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let i=0,r=0;r<this.children.length;r++){let o=this.children[r],s=i+o.size;if(i==s?t<=s&&e>=i:t<s&&e>i){let a=i+o.border,l=s-o.border;if(t>=a&&e<=l){this.dirty=t==i||e==s?pi:Hf,t==a&&e==l&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=en:o.markDirty(t-a,e-a);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?pi:en}i=s}this.dirty=pi}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let i=t==1?pi:Hf;e.dirty<i&&(e.dirty=i)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}},ps=class extends vi{constructor(t,e,i,r){let o,s=e.type.toDOM;if(typeof s=="function"&&(s=s(i,()=>{if(!o)return r;if(o.parent)return o.parent.posBeforeChild(o)})),!e.type.spec.raw){if(s.nodeType!=1){let a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(t,[],s,null),this.widget=e,this.widget=e,o=this}matchesWidget(t){return this.dirty==Bt&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return e?e(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}},Gc=class extends vi{constructor(t,e,i,r){super(t,[],e,null),this.textDOM=i,this.text=r}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}},Zi=class n extends vi{constructor(t,e,i,r,o){super(t,[],i,r),this.mark=e,this.spec=o}static create(t,e,i,r){let o=r.nodeViews[e.type.name],s=o&&o(e,r,i);return(!s||!s.dom)&&(s=qt.renderSpec(document,e.type.spec.toDOM(e,i),null,e.attrs)),new n(t,e,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&en||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=en&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=Bt){let i=this.parent;for(;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=Bt}}slice(t,e,i){let r=n.create(this.parent,this.mark,!0,i),o=this.children,s=this.size;e<s&&(o=Jc(o,e,s,i)),t>0&&(o=Jc(o,0,t,i));for(let a=0;a<o.length;a++)o[a].parent=r;return r.children=o,r}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}},$n=class n extends vi{constructor(t,e,i,r,o,s,a,l,c){super(t,[],o,s),this.node=e,this.outerDeco=i,this.innerDeco=r,this.nodeDOM=a}static create(t,e,i,r,o,s){let a=o.nodeViews[e.type.name],l,c=a&&a(e,o,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},i,r),u=c&&c.dom,d=c&&c.contentDOM;if(e.isText){if(!u)u=document.createTextNode(e.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=qt.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs));!d&&!e.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),e.type.spec.draggable&&(u.draggable=!0));let h=u;return u=xm(u,i,e),c?l=new jc(t,e,i,r,u,d||null,h,c,o,s+1):e.isText?new fs(t,e,i,r,u,h,o):new n(t,e,i,r,u,d||null,h,o,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let e=this.children.length-1;e>=0;e--){let i=this.children[e];if(this.dom.contains(i.dom.parentNode)){t.contentElement=i.dom.parentNode;break}}t.contentElement||(t.getContent=()=>z.empty)}return t}matchesNode(t,e,i){return this.dirty==Bt&&t.eq(this.node)&&gs(e,this.outerDeco)&&i.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let i=this.node.inlineContent,r=e,o=t.composing?this.localCompositionInfo(t,e):null,s=o&&o.pos>-1?o:null,a=o&&o.pos<0,l=new Xc(this,s&&s.node,t);cS(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,i,t):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?Ee.none:this.node.child(u).marks,i,t),l.placeWidget(c,t,r)},(c,u,d,h)=>{l.syncToMarks(c.marks,i,t);let p;l.findNodeMatch(c,u,d,h)||a&&t.state.selection.from>r&&t.state.selection.to<r+c.nodeSize&&(p=l.findIndexWithChild(o.node))>-1&&l.updateNodeAt(c,u,d,p,t)||l.updateNextNode(c,u,d,t,h,r)||l.addNode(c,u,d,t,r),r+=c.nodeSize}),l.syncToMarks([],i,t),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==pi)&&(s&&this.protectLocalComposition(t,s),vm(this.contentDOM,this.children,t),Ji&&uS(this.dom))}localCompositionInfo(t,e){let{from:i,to:r}=t.state.selection;if(!(t.state.selection instanceof j)||i<e||r>e+this.node.content.size)return null;let o=t.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let s=o.nodeValue,a=dS(this.node.content,s,i-e,r-e);return a<0?null:{node:o,pos:a,text:s}}else return{node:o,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:i,text:r}){if(this.getDesc(e))return;let o=e;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let s=new Gc(this,o,e,r);t.input.compositionNodes.push(s),this.children=Jc(this.children,i,i+r.length,t,s)}update(t,e,i,r){return this.dirty==en||!t.sameMarkup(this.node)?!1:(this.updateInner(t,e,i,r),!0)}updateInner(t,e,i,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=i,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=Bt}updateOuterDeco(t){if(gs(t,this.outerDeco))return;let e=this.nodeDOM.nodeType!=1,i=this.dom;this.dom=Em(this.dom,this.nodeDOM,Yc(this.outerDeco,this.node,e),Yc(t,this.node,e)),this.dom!=i&&(i.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}};function zf(n,t,e,i,r){xm(i,t,n);let o=new $n(void 0,n,t,e,i,i,i,r,0);return o.contentDOM&&o.updateChildren(r,0),o}var fs=class n extends $n{constructor(t,e,i,r,o,s,a){super(t,e,i,r,o,null,s,a,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,i,r){return this.dirty==en||this.dirty!=Bt&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(e),(this.dirty!=Bt||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=Bt,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,i){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,i)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,e,i){let r=this.node.cut(t,e),o=document.createTextNode(r.text);return new n(this.parent,r,this.outerDeco,this.innerDeco,o,o,i)}markDirty(t,e){super.markDirty(t,e),this.dom!=this.nodeDOM&&(t==0||e==this.nodeDOM.nodeValue.length)&&(this.dirty=en)}get domAtom(){return!1}isText(t){return this.node.text==t}},ms=class extends vi{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==Bt&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}},jc=class extends $n{constructor(t,e,i,r,o,s,a,l,c,u){super(t,e,i,r,o,s,a,c,u),this.spec=l}update(t,e,i,r){if(this.dirty==en)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let o=this.spec.update(t,e,i);return o&&this.updateInner(t,e,i,r),o}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,e,i,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,i,r){this.spec.setSelection?this.spec.setSelection(t,e,i.root):super.setSelection(t,e,i,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}};function vm(n,t,e){let i=n.firstChild,r=!1;for(let o=0;o<t.length;o++){let s=t[o],a=s.dom;if(a.parentNode==n){for(;a!=i;)i=Vf(i),r=!0;i=i.nextSibling}else r=!0,n.insertBefore(a,i);if(s instanceof Zi){let l=i?i.previousSibling:n.lastChild;vm(s.contentDOM,s.children,e),i=l?l.nextSibling:n.firstChild}}for(;i;)i=Vf(i),r=!0;r&&e.trackWrites==n&&(e.trackWrites=null)}var Fr=function(n){n&&(this.nodeName=n)};Fr.prototype=Object.create(null);var fi=[new Fr];function Yc(n,t,e){if(n.length==0)return fi;let i=e?fi[0]:new Fr,r=[i];for(let o=0;o<n.length;o++){let s=n[o].type.attrs;if(s){s.nodeName&&r.push(i=new Fr(s.nodeName));for(let a in s){let l=s[a];l!=null&&(e&&r.length==1&&r.push(i=new Fr(t.isInline?"span":"div")),a=="class"?i.class=(i.class?i.class+" ":"")+l:a=="style"?i.style=(i.style?i.style+";":"")+l:a!="nodeName"&&(i[a]=l))}}}return r}function Em(n,t,e,i){if(e==fi&&i==fi)return t;let r=t;for(let o=0;o<i.length;o++){let s=i[o],a=e[o];if(o){let l;a&&a.nodeName==s.nodeName&&r!=n&&(l=r.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(r),a=fi[0]),r=l}sS(r,a||fi[0],s)}return r}function sS(n,t,e){for(let i in t)i!="class"&&i!="style"&&i!="nodeName"&&!(i in e)&&n.removeAttribute(i);for(let i in e)i!="class"&&i!="style"&&i!="nodeName"&&e[i]!=t[i]&&n.setAttribute(i,e[i]);if(t.class!=e.class){let i=t.class?t.class.split(" ").filter(Boolean):[],r=e.class?e.class.split(" ").filter(Boolean):[];for(let o=0;o<i.length;o++)r.indexOf(i[o])==-1&&n.classList.remove(i[o]);for(let o=0;o<r.length;o++)i.indexOf(r[o])==-1&&n.classList.add(r[o]);n.classList.length==0&&n.removeAttribute("class")}if(t.style!=e.style){if(t.style){let i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=i.exec(t.style);)n.style.removeProperty(r[1])}e.style&&(n.style.cssText+=e.style)}}function xm(n,t,e){return Em(n,n,fi,Yc(t,e,n.nodeType!=1))}function gs(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++)if(!n[e].type.eq(t[e].type))return!1;return!0}function Vf(n){let t=n.nextSibling;return n.parentNode.removeChild(n),t}var Xc=class{constructor(t,e,i){this.lock=e,this.view=i,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=aS(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let i=t;i<e;i++)this.top.children[i].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,i){let r=0,o=this.stack.length>>1,s=Math.min(o,t.length);for(;r<s&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&t[r].type.spec.spanning!==!1;)r++;for(;r<o;)this.destroyRest(),this.top.dirty=Bt,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(t[o])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Zi.create(this.top,t[o],e,i);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,o++}}findNodeMatch(t,e,i,r){let o=-1,s;if(r>=this.preMatch.index&&(s=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&s.matchesNode(t,e,i))o=this.top.children.indexOf(s,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(t,e,i)&&!this.preMatch.matched.has(c)){o=a;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(t,e,i,r,o){let s=this.top.children[r];return s.dirty==en&&s.dom==s.contentDOM&&(s.dirty=pi),s.update(t,e,i,o)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let i=t.pmViewDesc;if(i){for(let r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==i)return r}return-1}t=e}}updateNextNode(t,e,i,r,o,s){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof $n){let c=this.preMatch.matched.get(l);if(c!=null&&c!=o)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(t.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==t.text&&l.dirty!=en&&gs(e,l.outerDeco));if(!h&&l.update(t,e,i,r))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,t,e,i,r,s)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=pi,d.updateChildren(r,s+1),d.dirty=Bt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,i,r,o,s){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!gs(i,t.outerDeco)||!r.eq(t.innerDeco))return null;let a=$n.create(this.top,e,i,r,o,s);if(a.contentDOM){a.children=t.children,t.children=[];for(let l of a.children)l.parent=a}return t.destroy(),a}addNode(t,e,i,r,o){let s=$n.create(this.top,t,e,i,r,o);s.contentDOM&&s.updateChildren(r,o+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(t,e,i){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(t)&&(t==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let o=new ps(this.top,t,e,i);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof Zi;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof fs)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((pt||ct)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let i=document.createElement(t);t=="IMG"&&(i.className="ProseMirror-separator",i.alt=""),t=="BR"&&(i.className="ProseMirror-trailingBreak");let r=new ms(this.top,[],i,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}};function aS(n,t){let e=t,i=e.children.length,r=n.childCount,o=new Map,s=[];e:for(;r>0;){let a;for(;;)if(i){let c=e.children[i-1];if(c instanceof Zi)e=c,i=c.children.length;else{a=c,i--;break}}else{if(e==t)break e;i=e.parent.children.indexOf(e),e=e.parent}let l=a.node;if(l){if(l!=n.child(r-1))break;--r,o.set(a,r),s.push(a)}}return{index:r,matched:o,matches:s.reverse()}}function lS(n,t){return n.type.side-t.type.side}function cS(n,t,e,i){let r=t.locals(n),o=0;if(r.length==0){for(let c=0;c<n.childCount;c++){let u=n.child(c);i(u,r,t.forChild(o,u),c),o+=u.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){let u,d;for(;s<r.length&&r[s].to==o;){let m=r[s++];m.widget&&(u?(d||(d=[u])).push(m):u=m)}if(u)if(d){d.sort(lS);for(let m=0;m<d.length;m++)e(d[m],c,!!l)}else e(u,c,!!l);let h,p;if(l)p=-1,h=l,l=null;else if(c<n.childCount)p=c,h=n.child(c++);else break;for(let m=0;m<a.length;m++)a[m].to<=o&&a.splice(m--,1);for(;s<r.length&&r[s].from<=o&&r[s].to>o;)a.push(r[s++]);let f=o+h.nodeSize;if(h.isText){let m=f;s<r.length&&r[s].from<m&&(m=r[s].from);for(let b=0;b<a.length;b++)a[b].to<m&&(m=a[b].to);m<f&&(l=h.cut(m-o),h=h.cut(0,m-o),f=m,p=-1)}else for(;s<r.length&&r[s].to<f;)s++;let g=h.isInline&&!h.isLeaf?a.filter(m=>!m.inline):a.slice();i(h,g,t.forChild(o,h),p),o=f}}function uS(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let t=n.style.cssText;n.style.cssText=t+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=t}}function dS(n,t,e,i){for(let r=0,o=0;r<n.childCount&&o<=i;){let s=n.child(r++),a=o;if(o+=s.nodeSize,!s.isText)continue;let l=s.text;for(;r<n.childCount;){let c=n.child(r++);if(o+=c.nodeSize,!c.isText)break;l+=c.text}if(o>=e){if(o>=i&&l.slice(i-t.length-a,i-a)==t)return i-t.length;let c=a<i?l.lastIndexOf(t,i-a-1):-1;if(c>=0&&c+t.length+a>=e)return a+c;if(e==i&&l.length>=i+t.length-a&&l.slice(i-a,i-a+t.length)==t)return i}}return-1}function Jc(n,t,e,i,r){let o=[];for(let s=0,a=0;s<n.length;s++){let l=n[s],c=a,u=a+=l.size;c>=e||u<=t?o.push(l):(c<t&&o.push(l.slice(0,t-c,i)),r&&(o.push(r),r=void 0),u>e&&o.push(l.slice(e-c,l.size,i)))}return o}function lu(n,t=null){let e=n.domSelectionRange(),i=n.state.doc;if(!e.focusNode)return null;let r=n.docView.nearestDesc(e.focusNode),o=r&&r.size==0,s=n.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(s<0)return null;let a=i.resolve(s),l,c;if(ws(e)){for(l=s;r&&!r.node;)r=r.parent;let d=r.node;if(r&&d.isAtom&&Y.isSelectable(d)&&r.parent&&!(d.isInline&&zw(e.focusNode,e.focusOffset,r.dom))){let h=r.posBefore;c=new Y(s==h?a:i.resolve(h))}}else{if(e instanceof n.dom.ownerDocument.defaultView.Selection&&e.rangeCount>1){let d=s,h=s;for(let p=0;p<e.rangeCount;p++){let f=e.getRangeAt(p);d=Math.min(d,n.docView.posFromDOM(f.startContainer,f.startOffset,1)),h=Math.max(h,n.docView.posFromDOM(f.endContainer,f.endOffset,-1))}if(d<0)return null;[l,s]=h==n.state.selection.anchor?[h,d]:[d,h],a=i.resolve(s)}else l=n.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(l<0)return null}let u=i.resolve(l);if(!c){let d=t=="pointer"||n.state.selection.head<a.pos&&!o?1:-1;c=cu(n,u,a,d)}return c}function km(n){return n.editable?n.hasFocus():Sm(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function vn(n,t=!1){let e=n.state.selection;if(wm(n,e),!!km(n)){if(!t&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&ct){let i=n.domSelectionRange(),r=n.domObserver.currentSelection;if(i.anchorNode&&r.anchorNode&&yi(i.anchorNode,i.anchorOffset,r.anchorNode,r.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)pS(n);else{let{anchor:i,head:r}=e,o,s;$f&&!(e instanceof j)&&(e.$from.parent.inlineContent||(o=Wf(n,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(s=Wf(n,e.to))),n.docView.setSelection(i,r,n,t),$f&&(o&&Uf(o),s&&Uf(s)),e.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&hS(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}var $f=pt||ct&&hm<63;function Wf(n,t){let{node:e,offset:i}=n.docView.domFromPos(t,0),r=i<e.childNodes.length?e.childNodes[i]:null,o=i?e.childNodes[i-1]:null;if(pt&&r&&r.contentEditable=="false")return Hc(r);if((!r||r.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(r)return Hc(r);if(o)return Hc(o)}}function Hc(n){return n.contentEditable="true",pt&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Uf(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function hS(n){let t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.input.hideSelectionGuard);let e=n.domSelectionRange(),i=e.anchorNode,r=e.anchorOffset;t.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(e.anchorNode!=i||e.anchorOffset!=r)&&(t.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!km(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function pS(n){let t=n.domSelection();if(!t)return;let e=n.cursorWrapper.dom,i=e.nodeName=="IMG";i?t.collapse(e.parentNode,tt(e)+1):t.collapse(e,0),!i&&!n.state.selection.visible&&Et&&Vn<=11&&(e.disabled=!0,e.disabled=!1)}function wm(n,t){if(t instanceof Y){let e=n.docView.descAt(t.from);e!=n.lastSelectedViewDesc&&(Kf(n),e&&e.selectNode(),n.lastSelectedViewDesc=e)}else Kf(n)}function Kf(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function cu(n,t,e,i){return n.someProp("createSelectionBetween",r=>r(n,t,e))||j.between(t,e,i)}function qf(n){return n.editable&&!n.hasFocus()?!1:Sm(n)}function Sm(n){let t=n.domSelectionRange();if(!t.anchorNode)return!1;try{return n.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function fS(n){let t=n.docView.domFromPos(n.state.selection.anchor,0),e=n.domSelectionRange();return yi(t.node,t.offset,e.anchorNode,e.anchorOffset)}function Zc(n,t){let{$anchor:e,$head:i}=n.selection,r=t>0?e.max(i):e.min(i),o=r.parent.inlineContent?r.depth?n.doc.resolve(t>0?r.after():r.before()):null:r;return o&&ie.findFrom(o,t)}function Hn(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function Gf(n,t,e){let i=n.state.selection;if(i instanceof j)if(e.indexOf("s")>-1){let{$head:r}=i,o=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let s=n.state.doc.resolve(r.pos+o.nodeSize*(t<0?-1:1));return Hn(n,new j(i.$anchor,s))}else if(i.empty){if(n.endOfTextblock(t>0?"forward":"backward")){let r=Zc(n.state,t);return r&&r instanceof Y?Hn(n,r):!1}else if(!(_t&&e.indexOf("m")>-1)){let r=i.$head,o=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter,s;if(!o||o.isText)return!1;let a=t<0?r.pos-o.nodeSize:r.pos;return o.isAtom||(s=n.docView.descAt(a))&&!s.contentDOM?Y.isSelectable(o)?Hn(n,new Y(t<0?n.state.doc.resolve(r.pos-o.nodeSize):r)):Kr?Hn(n,new j(n.state.doc.resolve(t<0?a:a+o.nodeSize))):!1:!1}}else return!1;else{if(i instanceof Y&&i.node.isInline)return Hn(n,new j(t>0?i.$to:i.$from));{let r=Zc(n.state,t);return r?Hn(n,r):!1}}}function bs(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Hr(n,t){let e=n.pmViewDesc;return e&&e.size==0&&(t<0||n.nextSibling||n.nodeName!="BR")}function Gi(n,t){return t<0?mS(n):gS(n)}function mS(n){let t=n.domSelectionRange(),e=t.focusNode,i=t.focusOffset;if(!e)return;let r,o,s=!1;for(Dt&&e.nodeType==1&&i<bs(e)&&Hr(e.childNodes[i],-1)&&(s=!0);;)if(i>0){if(e.nodeType!=1)break;{let a=e.childNodes[i-1];if(Hr(a,-1))r=e,o=--i;else if(a.nodeType==3)e=a,i=e.nodeValue.length;else break}}else{if(Mm(e))break;{let a=e.previousSibling;for(;a&&Hr(a,-1);)r=e.parentNode,o=tt(a),a=a.previousSibling;if(a)e=a,i=bs(e);else{if(e=e.parentNode,e==n.dom)break;i=0}}}s?Qc(n,e,i):r&&Qc(n,r,o)}function gS(n){let t=n.domSelectionRange(),e=t.focusNode,i=t.focusOffset;if(!e)return;let r=bs(e),o,s;for(;;)if(i<r){if(e.nodeType!=1)break;let a=e.childNodes[i];if(Hr(a,1))o=e,s=++i;else break}else{if(Mm(e))break;{let a=e.nextSibling;for(;a&&Hr(a,1);)o=a.parentNode,s=tt(a)+1,a=a.nextSibling;if(a)e=a,i=0,r=bs(e);else{if(e=e.parentNode,e==n.dom)break;i=r=0}}}o&&Qc(n,o,s)}function Mm(n){let t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function bS(n,t){for(;n&&t==n.childNodes.length&&!Ur(n);)t=tt(n)+1,n=n.parentNode;for(;n&&t<n.childNodes.length;){let e=n.childNodes[t];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;n=e,t=0}}function yS(n,t){for(;n&&!t&&!Ur(n);)t=tt(n),n=n.parentNode;for(;n&&t;){let e=n.childNodes[t-1];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;n=e,t=n.childNodes.length}}function Qc(n,t,e){if(t.nodeType!=3){let o,s;(s=bS(t,e))?(t=s,e=0):(o=yS(t,e))&&(t=o,e=o.nodeValue.length)}let i=n.domSelection();if(!i)return;if(ws(i)){let o=document.createRange();o.setEnd(t,e),o.setStart(t,e),i.removeAllRanges(),i.addRange(o)}else i.extend&&i.extend(t,e);n.domObserver.setCurSelection();let{state:r}=n;setTimeout(()=>{n.state==r&&vn(n)},50)}function jf(n,t){let e=n.state.doc.resolve(t);if(!(ct||Ww)&&e.parent.inlineContent){let r=n.coordsAtPos(t);if(t>e.start()){let o=n.coordsAtPos(t-1),s=(o.top+o.bottom)/2;if(s>r.top&&s<r.bottom&&Math.abs(o.left-r.left)>1)return o.left<r.left?"ltr":"rtl"}if(t<e.end()){let o=n.coordsAtPos(t+1),s=(o.top+o.bottom)/2;if(s>r.top&&s<r.bottom&&Math.abs(o.left-r.left)>1)return o.left>r.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Yf(n,t,e){let i=n.state.selection;if(i instanceof j&&!i.empty||e.indexOf("s")>-1||_t&&e.indexOf("m")>-1)return!1;let{$from:r,$to:o}=i;if(!r.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){let s=Zc(n.state,t);if(s&&s instanceof Y)return Hn(n,s)}if(!r.parent.inlineContent){let s=t<0?r:o,a=i instanceof ht?ie.near(s,t):ie.findFrom(s,t);return a?Hn(n,a):!1}return!1}function Xf(n,t){if(!(n.state.selection instanceof j))return!0;let{$head:e,$anchor:i,empty:r}=n.state.selection;if(!e.sameParent(i))return!0;if(!r)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(o&&!o.isText){let s=n.state.tr;return t<0?s.delete(e.pos-o.nodeSize,e.pos):s.delete(e.pos,e.pos+o.nodeSize),n.dispatch(s),!0}return!1}function Jf(n,t,e){n.domObserver.stop(),t.contentEditable=e,n.domObserver.start()}function vS(n){if(!pt||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=n.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let i=t.firstChild;Jf(n,i,"true"),setTimeout(()=>Jf(n,i,"false"),20)}return!1}function ES(n){let t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}function xS(n,t){let e=t.keyCode,i=ES(t);if(e==8||_t&&e==72&&i=="c")return Xf(n,-1)||Gi(n,-1);if(e==46&&!t.shiftKey||_t&&e==68&&i=="c")return Xf(n,1)||Gi(n,1);if(e==13||e==27)return!0;if(e==37||_t&&e==66&&i=="c"){let r=e==37?jf(n,n.state.selection.from)=="ltr"?-1:1:-1;return Gf(n,r,i)||Gi(n,r)}else if(e==39||_t&&e==70&&i=="c"){let r=e==39?jf(n,n.state.selection.from)=="ltr"?1:-1:1;return Gf(n,r,i)||Gi(n,r)}else{if(e==38||_t&&e==80&&i=="c")return Yf(n,-1,i)||Gi(n,-1);if(e==40||_t&&e==78&&i=="c")return vS(n)||Yf(n,1,i)||Gi(n,1);if(i==(_t?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function uu(n,t){n.someProp("transformCopied",p=>{t=p(t,n)});let e=[],{content:i,openStart:r,openEnd:o}=t;for(;r>1&&o>1&&i.childCount==1&&i.firstChild.childCount==1;){r--,o--;let p=i.firstChild;e.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),i=p.content}let s=n.someProp("clipboardSerializer")||qt.fromSchema(n.state.schema),a=Im(),l=a.createElement("div");l.appendChild(s.serializeFragment(i,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=Am[c.nodeName.toLowerCase()]);){for(let p=u.length-1;p>=0;p--){let f=a.createElement(u[p]);for(;l.firstChild;)f.appendChild(l.firstChild);l.appendChild(f),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${r} ${o}${d?` -${d}`:""} ${JSON.stringify(e)}`);let h=n.someProp("clipboardTextSerializer",p=>p(t,n))||t.content.textBetween(0,t.content.size,`

`);return{dom:l,text:h,slice:t}}function Tm(n,t,e,i,r){let o=r.parent.type.spec.code,s,a;if(!e&&!t)return null;let l=!!t&&(i||o||!e);if(l){if(n.someProp("transformPastedText",h=>{t=h(t,o||i,n)}),o)return a=new q(z.from(n.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0),n.someProp("transformPasted",h=>{a=h(a,n,!0)}),a;let d=n.someProp("clipboardTextParser",h=>h(t,r,i,n));if(d)a=d;else{let h=r.marks(),{schema:p}=n.state,f=qt.fromSchema(p);s=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(g=>{let m=s.appendChild(document.createElement("p"));g&&m.appendChild(f.serializeNode(p.text(g,h)))})}}else n.someProp("transformPastedHTML",d=>{e=d(e,n)}),s=MS(e),Kr&&TS(s);let c=s&&s.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=s.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;s=h}if(a||(a=(n.someProp("clipboardParser")||n.someProp("domParser")||vt.fromSchema(n.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||u),context:r,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!kS.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=CS(Zf(a,+u[1],+u[2]),u[4]);else if(a=q.maxOpen(wS(a.content,r),!0),a.openStart||a.openEnd){let d=0,h=0;for(let p=a.content.firstChild;d<a.openStart&&!p.type.spec.isolating;d++,p=p.firstChild);for(let p=a.content.lastChild;h<a.openEnd&&!p.type.spec.isolating;h++,p=p.lastChild);a=Zf(a,d,h)}return n.someProp("transformPasted",d=>{a=d(a,n,l)}),a}var kS=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function wS(n,t){if(n.childCount<2)return n;for(let e=t.depth;e>=0;e--){let r=t.node(e).contentMatchAt(t.index(e)),o,s=[];if(n.forEach(a=>{if(!s)return;let l=r.findWrapping(a.type),c;if(!l)return s=null;if(c=s.length&&o.length&&Lm(l,o,a,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Rm(s[s.length-1],o.length));let u=Cm(a,l);s.push(u),r=r.matchType(u.type),o=l}}),s)return z.from(s)}return n}function Cm(n,t,e=0){for(let i=t.length-1;i>=e;i--)n=t[i].create(null,z.from(n));return n}function Lm(n,t,e,i,r){if(r<n.length&&r<t.length&&n[r]==t[r]){let o=Lm(n,t,e,i.lastChild,r+1);if(o)return i.copy(i.content.replaceChild(i.childCount-1,o));if(i.contentMatchAt(i.childCount).matchType(r==n.length-1?e.type:n[r+1]))return i.copy(i.content.append(z.from(Cm(e,n,r+1))))}}function Rm(n,t){if(t==0)return n;let e=n.content.replaceChild(n.childCount-1,Rm(n.lastChild,t-1)),i=n.contentMatchAt(n.childCount).fillBefore(z.empty,!0);return n.copy(e.append(i))}function eu(n,t,e,i,r,o){let s=t<0?n.firstChild:n.lastChild,a=s.content;return n.childCount>1&&(o=0),r<i-1&&(a=eu(a,t,e,i,r+1,o)),r>=e&&(a=t<0?s.contentMatchAt(0).fillBefore(a,o<=r).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(z.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,s.copy(a))}function Zf(n,t,e){return t<n.openStart&&(n=new q(eu(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),e<n.openEnd&&(n=new q(eu(n.content,1,e,n.openEnd,0,0),n.openStart,e)),n}var Am={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Qf=null;function Im(){return Qf||(Qf=document.implementation.createHTMLDocument("title"))}var zc=null;function SS(n){let t=window.trustedTypes;return t?(zc||(zc=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e})),zc.createHTML(n)):n}function MS(n){let t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));let e=Im().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(n),r;if((r=i&&Am[i[1].toLowerCase()])&&(n=r.map(o=>"<"+o+">").join("")+n+r.map(o=>"</"+o+">").reverse().join("")),e.innerHTML=SS(n),r)for(let o=0;o<r.length;o++)e=e.querySelector(r[o])||e;return e}function TS(n){let t=n.querySelectorAll(ct?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let i=t[e];i.childNodes.length==1&&i.textContent=="\xA0"&&i.parentNode&&i.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),i)}}function CS(n,t){if(!n.size)return n;let e=n.content.firstChild.type.schema,i;try{i=JSON.parse(t)}catch(a){return n}let{content:r,openStart:o,openEnd:s}=n;for(let a=i.length-2;a>=0;a-=2){let l=e.nodes[i[a]];if(!l||l.hasRequiredAttrs())break;r=z.from(l.create(i[a+1],r)),o++,s++}return new q(r,o,s)}var ft={},mt={},LS={touchstart:!0,touchmove:!0},tu=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function RS(n){for(let t in ft){let e=ft[t];n.dom.addEventListener(t,n.input.eventHandlers[t]=i=>{IS(n,i)&&!du(n,i)&&(n.editable||!(i.type in mt))&&e(n,i)},LS[t]?{passive:!0}:void 0)}pt&&n.dom.addEventListener("input",()=>null),nu(n)}function zn(n,t){n.input.lastSelectionOrigin=t,n.input.lastSelectionTime=Date.now()}function AS(n){n.domObserver.stop();for(let t in n.input.eventHandlers)n.dom.removeEventListener(t,n.input.eventHandlers[t]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function nu(n){n.someProp("handleDOMEvents",t=>{for(let e in t)n.input.eventHandlers[e]||n.dom.addEventListener(e,n.input.eventHandlers[e]=i=>du(n,i))})}function du(n,t){return n.someProp("handleDOMEvents",e=>{let i=e[t.type];return i?i(n,t)||t.defaultPrevented:!1})}function IS(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target;e!=n.dom;e=e.parentNode)if(!e||e.nodeType==11||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0}function NS(n,t){!du(n,t)&&ft[t.type]&&(n.editable||!(t.type in mt))&&ft[t.type](n,t)}mt.keydown=(n,t)=>{let e=t;if(n.input.shiftKey=e.keyCode==16||e.shiftKey,!Pm(n,e)&&(n.input.lastKeyCode=e.keyCode,n.input.lastKeyCodeTime=Date.now(),!(yn&&ct&&e.keyCode==13)))if(e.keyCode!=229&&n.domObserver.forceFlush(),Ji&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let i=Date.now();n.input.lastIOSEnter=i,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==i&&(n.someProp("handleKeyDown",r=>r(n,hi(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",i=>i(n,e))||xS(n,e)?e.preventDefault():zn(n,"key")};mt.keyup=(n,t)=>{t.keyCode==16&&(n.input.shiftKey=!1)};mt.keypress=(n,t)=>{let e=t;if(Pm(n,e)||!e.charCode||e.ctrlKey&&!e.altKey||_t&&e.metaKey)return;if(n.someProp("handleKeyPress",r=>r(n,e))){e.preventDefault();return}let i=n.state.selection;if(!(i instanceof j)||!i.$from.sameParent(i.$to)){let r=String.fromCharCode(e.charCode),o=()=>n.state.tr.insertText(r).scrollIntoView();!/[\r\n]/.test(r)&&!n.someProp("handleTextInput",s=>s(n,i.$from.pos,i.$to.pos,r,o))&&n.dispatch(o()),e.preventDefault()}};function Ss(n){return{left:n.clientX,top:n.clientY}}function PS(n,t){let e=t.x-n.clientX,i=t.y-n.clientY;return e*e+i*i<100}function hu(n,t,e,i,r){if(i==-1)return!1;let o=n.state.doc.resolve(i);for(let s=o.depth+1;s>0;s--)if(n.someProp(t,a=>s>o.depth?a(n,e,o.nodeAfter,o.before(s),r,!0):a(n,e,o.node(s),o.before(s),r,!1)))return!0;return!1}function Yi(n,t,e){if(n.focused||n.focus(),n.state.selection.eq(t))return;let i=n.state.tr.setSelection(t);e=="pointer"&&i.setMeta("pointer",!0),n.dispatch(i)}function _S(n,t){if(t==-1)return!1;let e=n.state.doc.resolve(t),i=e.nodeAfter;return i&&i.isAtom&&Y.isSelectable(i)?(Yi(n,new Y(e),"pointer"),!0):!1}function OS(n,t){if(t==-1)return!1;let e=n.state.selection,i,r;e instanceof Y&&(i=e.node);let o=n.state.doc.resolve(t);for(let s=o.depth+1;s>0;s--){let a=s>o.depth?o.nodeAfter:o.node(s);if(Y.isSelectable(a)){i&&e.$from.depth>0&&s>=e.$from.depth&&o.before(e.$from.depth+1)==e.$from.pos?r=o.before(e.$from.depth):r=o.before(s);break}}return r!=null?(Yi(n,Y.create(n.state.doc,r),"pointer"),!0):!1}function DS(n,t,e,i,r){return hu(n,"handleClickOn",t,e,i)||n.someProp("handleClick",o=>o(n,t,i))||(r?OS(n,e):_S(n,e))}function BS(n,t,e,i){return hu(n,"handleDoubleClickOn",t,e,i)||n.someProp("handleDoubleClick",r=>r(n,t,i))}function FS(n,t,e,i){return hu(n,"handleTripleClickOn",t,e,i)||n.someProp("handleTripleClick",r=>r(n,t,i))||HS(n,e,i)}function HS(n,t,e){if(e.button!=0)return!1;let i=n.state.doc;if(t==-1)return i.inlineContent?(Yi(n,j.create(i,0,i.content.size),"pointer"),!0):!1;let r=i.resolve(t);for(let o=r.depth+1;o>0;o--){let s=o>r.depth?r.nodeAfter:r.node(o),a=r.before(o);if(s.inlineContent)Yi(n,j.create(i,a+1,a+1+s.content.size),"pointer");else if(Y.isSelectable(s))Yi(n,Y.create(i,a),"pointer");else continue;return!0}}function pu(n){return ys(n)}var Nm=_t?"metaKey":"ctrlKey";ft.mousedown=(n,t)=>{let e=t;n.input.shiftKey=e.shiftKey;let i=pu(n),r=Date.now(),o="singleClick";r-n.input.lastClick.time<500&&PS(e,n.input.lastClick)&&!e[Nm]&&n.input.lastClick.button==e.button&&(n.input.lastClick.type=="singleClick"?o="doubleClick":n.input.lastClick.type=="doubleClick"&&(o="tripleClick")),n.input.lastClick={time:r,x:e.clientX,y:e.clientY,type:o,button:e.button};let s=n.posAtCoords(Ss(e));s&&(o=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new iu(n,s,e,!!i)):(o=="doubleClick"?BS:FS)(n,s.pos,s.inside,e)?e.preventDefault():zn(n,"pointer"))};var iu=class{constructor(t,e,i,r){this.view=t,this.pos=e,this.event=i,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!i[Nm],this.allowDefault=i.shiftKey;let o,s;if(e.inside>-1)o=t.state.doc.nodeAt(e.inside),s=e.inside;else{let u=t.state.doc.resolve(e.pos);o=u.parent,s=u.depth?u.before():0}let a=r?null:i.target,l=a?t.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=t.state;(i.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||c instanceof Y&&c.from<=s&&c.to>s)&&(this.mightDrag={node:o,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Dt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),zn(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>vn(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Ss(t))),this.updateAllowDefault(t),this.allowDefault||!e?zn(this.view,"pointer"):DS(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||pt&&this.mightDrag&&!this.mightDrag.node.isAtom||ct&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(Yi(this.view,ie.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):zn(this.view,"pointer")}move(t){this.updateAllowDefault(t),zn(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}};ft.touchstart=n=>{n.input.lastTouch=Date.now(),pu(n),zn(n,"pointer")};ft.touchmove=n=>{n.input.lastTouch=Date.now(),zn(n,"pointer")};ft.contextmenu=n=>pu(n);function Pm(n,t){return n.composing?!0:pt&&Math.abs(t.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}var zS=yn?5e3:-1;mt.compositionstart=mt.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:t}=n,e=t.selection.$to;if(t.selection instanceof j&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(i=>i.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||e.marks(),ys(n,!0),n.markCursor=null;else if(ys(n,!t.selection.empty),Dt&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let i=n.domSelectionRange();for(let r=i.focusNode,o=i.focusOffset;r&&r.nodeType==1&&o!=0;){let s=o<0?r.lastChild:r.childNodes[o-1];if(!s)break;if(s.nodeType==3){let a=n.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else r=s,o=-1}}n.input.composing=!0}_m(n,zS)};mt.compositionend=(n,t)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=t.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,_m(n,20))};function _m(n,t){clearTimeout(n.input.composingTimeout),t>-1&&(n.input.composingTimeout=setTimeout(()=>ys(n),t))}function Om(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=$S());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function VS(n){let t=n.domSelectionRange();if(!t.focusNode)return null;let e=Fw(t.focusNode,t.focusOffset),i=Hw(t.focusNode,t.focusOffset);if(e&&i&&e!=i){let r=i.pmViewDesc,o=n.domObserver.lastChangedTextNode;if(e==o||i==o)return o;if(!r||!r.isText(i.nodeValue))return i;if(n.input.compositionNode==i){let s=e.pmViewDesc;if(!(!s||!s.isText(e.nodeValue)))return i}}return e||i}function $S(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function ys(n,t=!1){if(!(yn&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),Om(n),t||n.docView&&n.docView.dirty){let e=lu(n),i=n.state.selection;return e&&!e.eq(i)?n.dispatch(n.state.tr.setSelection(e)):(n.markCursor||t)&&!i.$from.node(i.$from.sharedDepth(i.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function WS(n,t){if(!n.dom.parentNode)return;let e=n.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),r=document.createRange();r.selectNodeContents(t),n.dom.blur(),i.removeAllRanges(),i.addRange(r),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),n.focus()},50)}var zr=Et&&Vn<15||Ji&&Uw<604;ft.copy=mt.cut=(n,t)=>{let e=t,i=n.state.selection,r=e.type=="cut";if(i.empty)return;let o=zr?null:e.clipboardData,s=i.content(),{dom:a,text:l}=uu(n,s);o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):WS(n,a),r&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function US(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function KS(n,t){if(!n.dom.parentNode)return;let e=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,i=n.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus();let r=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),i.parentNode&&i.parentNode.removeChild(i),e?Vr(n,i.value,null,r,t):Vr(n,i.textContent,i.innerHTML,r,t)},50)}function Vr(n,t,e,i,r){let o=Tm(n,t,e,i,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,r,o||q.empty)))return!0;if(!o)return!1;let s=US(o),a=s?n.state.tr.replaceSelectionWith(s,i):n.state.tr.replaceSelection(o);return n.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Dm(n){let t=n.getData("text/plain")||n.getData("Text");if(t)return t;let e=n.getData("text/uri-list");return e?e.replace(/\r?\n/g," "):""}mt.paste=(n,t)=>{let e=t;if(n.composing&&!yn)return;let i=zr?null:e.clipboardData,r=n.input.shiftKey&&n.input.lastKeyCode!=45;i&&Vr(n,Dm(i),i.getData("text/html"),r,e)?e.preventDefault():KS(n,e)};var vs=class{constructor(t,e,i){this.slice=t,this.move=e,this.node=i}},qS=_t?"altKey":"ctrlKey";function Bm(n,t){let e=n.someProp("dragCopies",i=>!i(t));return e!=null?e:!t[qS]}ft.dragstart=(n,t)=>{let e=t,i=n.input.mouseDown;if(i&&i.done(),!e.dataTransfer)return;let r=n.state.selection,o=r.empty?null:n.posAtCoords(Ss(e)),s;if(!(o&&o.pos>=r.from&&o.pos<=(r instanceof Y?r.to-1:r.to))){if(i&&i.mightDrag)s=Y.create(n.state.doc,i.mightDrag.pos);else if(e.target&&e.target.nodeType==1){let d=n.docView.nearestDesc(e.target,!0);d&&d.node.type.spec.draggable&&d!=n.docView&&(s=Y.create(n.state.doc,d.posBefore))}}let a=(s||n.state.selection).content(),{dom:l,text:c,slice:u}=uu(n,a);(!e.dataTransfer.files.length||!ct||hm>120)&&e.dataTransfer.clearData(),e.dataTransfer.setData(zr?"Text":"text/html",l.innerHTML),e.dataTransfer.effectAllowed="copyMove",zr||e.dataTransfer.setData("text/plain",c),n.dragging=new vs(u,Bm(n,e),s)};ft.dragend=n=>{let t=n.dragging;window.setTimeout(()=>{n.dragging==t&&(n.dragging=null)},50)};mt.dragover=mt.dragenter=(n,t)=>t.preventDefault();mt.drop=(n,t)=>{let e=t,i=n.dragging;if(n.dragging=null,!e.dataTransfer)return;let r=n.posAtCoords(Ss(e));if(!r)return;let o=n.state.doc.resolve(r.pos),s=i&&i.slice;s?n.someProp("transformPasted",f=>{s=f(s,n,!1)}):s=Tm(n,Dm(e.dataTransfer),zr?null:e.dataTransfer.getData("text/html"),!1,o);let a=!!(i&&Bm(n,e));if(n.someProp("handleDrop",f=>f(n,e,s||q.empty,a))){e.preventDefault();return}if(!s)return;e.preventDefault();let l=s?Go(n.state.doc,o.pos,s):o.pos;l==null&&(l=o.pos);let c=n.state.tr;if(a){let{node:f}=i;f?f.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,s.content.firstChild):c.replaceRange(u,u,s),c.doc.eq(h))return;let p=c.doc.resolve(u);if(d&&Y.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new Y(p));else{let f=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((g,m,b,y)=>f=y),c.setSelection(cu(n,p,c.doc.resolve(f)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))};ft.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&vn(n)},20))};ft.blur=(n,t)=>{let e=t;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),e.relatedTarget&&n.dom.contains(e.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};ft.beforeinput=(n,t)=>{if(ct&&yn&&t.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:i}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=i||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",o=>o(n,hi(8,"Backspace")))))return;let{$cursor:r}=n.state.selection;r&&r.pos>0&&n.dispatch(n.state.tr.delete(r.pos-1,r.pos).scrollIntoView())},50)}};for(let n in mt)ft[n]=mt[n];function $r(n,t){if(n==t)return!0;for(let e in n)if(n[e]!==t[e])return!1;for(let e in t)if(!(e in n))return!1;return!0}var Es=class n{constructor(t,e){this.toDOM=t,this.spec=e||gi,this.side=this.spec.side||0}map(t,e,i,r){let{pos:o,deleted:s}=t.mapResult(e.from+r,this.side<0?-1:1);return s?null:new Ne(o-i,o-i,this)}valid(){return!0}eq(t){return this==t||t instanceof n&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&$r(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}},mi=class n{constructor(t,e){this.attrs=t,this.spec=e||gi}map(t,e,i,r){let o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-i,s=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-i;return o>=s?null:new Ne(o,s,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof n&&$r(this.attrs,t.attrs)&&$r(this.spec,t.spec)}static is(t){return t.type instanceof n}destroy(){}},ru=class n{constructor(t,e){this.attrs=t,this.spec=e||gi}map(t,e,i,r){let o=t.mapResult(e.from+r,1);if(o.deleted)return null;let s=t.mapResult(e.to+r,-1);return s.deleted||s.pos<=o.pos?null:new Ne(o.pos-i,s.pos-i,this)}valid(t,e){let{index:i,offset:r}=t.content.findIndex(e.from),o;return r==e.from&&!(o=t.child(i)).isText&&r+o.nodeSize==e.to}eq(t){return this==t||t instanceof n&&$r(this.attrs,t.attrs)&&$r(this.spec,t.spec)}destroy(){}},Ne=class n{constructor(t,e,i){this.from=t,this.to=e,this.type=i}copy(t,e){return new n(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,i){return this.type.map(t,this,e,i)}static widget(t,e,i){return new n(t,t,new Es(e,i))}static inline(t,e,i,r){return new n(t,e,new mi(i,r))}static node(t,e,i,r){return new n(t,e,new ru(i,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof mi}get widget(){return this.type instanceof Es}},ji=[],gi={},ke=class n{constructor(t,e){this.local=t.length?t:ji,this.children=e.length?e:ji}static create(t,e){return e.length?ks(e,t,0,gi):lt}find(t,e,i){let r=[];return this.findInner(t==null?0:t,e==null?1e9:e,r,0,i),r}findInner(t,e,i,r,o){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=e&&a.to>=t&&(!o||o(a.spec))&&i.push(a.copy(a.from+r,a.to+r))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){let a=this.children[s]+1;this.children[s+2].findInner(t-a,e-a,i,r+a,o)}}map(t,e,i){return this==lt||t.maps.length==0?this:this.mapInner(t,e,0,0,i||gi)}mapInner(t,e,i,r,o){let s;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(t,i,r);l&&l.type.valid(e,l)?(s||(s=[])).push(l):o.onRemove&&o.onRemove(this.local[a].spec)}return this.children.length?GS(this.children,s||[],t,e,i,r,o):s?new n(s.sort(bi),ji):lt}add(t,e){return e.length?this==lt?n.create(t,e):this.addInner(t,e,0):this}addInner(t,e,i){let r,o=0;t.forEach((a,l)=>{let c=l+i,u;if(u=Hm(e,a,c)){for(r||(r=this.children.slice());o<r.length&&r[o]<l;)o+=3;r[o]==l?r[o+2]=r[o+2].addInner(a,u,c+1):r.splice(o,0,l,l+a.nodeSize,ks(u,a,c+1,gi)),o+=3}});let s=Fm(o?zm(e):e,-i);for(let a=0;a<s.length;a++)s[a].type.valid(t,s[a])||s.splice(a--,1);return new n(s.length?this.local.concat(s).sort(bi):this.local,r||this.children)}remove(t){return t.length==0||this==lt?this:this.removeInner(t,0)}removeInner(t,e){let i=this.children,r=this.local;for(let o=0;o<i.length;o+=3){let s,a=i[o]+e,l=i[o+1]+e;for(let u=0,d;u<t.length;u++)(d=t[u])&&d.from>a&&d.to<l&&(t[u]=null,(s||(s=[])).push(d));if(!s)continue;i==this.children&&(i=this.children.slice());let c=i[o+2].removeInner(s,a+1);c!=lt?i[o+2]=c:(i.splice(o,3),o-=3)}if(r.length){for(let o=0,s;o<t.length;o++)if(s=t[o])for(let a=0;a<r.length;a++)r[a].eq(s,e)&&(r==this.local&&(r=this.local.slice()),r.splice(a--,1))}return i==this.children&&r==this.local?this:r.length||i.length?new n(r,i):lt}forChild(t,e){if(this==lt)return this;if(e.isLeaf)return n.empty;let i,r;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=t){this.children[a]==t&&(i=this.children[a+2]);break}let o=t+1,s=o+e.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<s&&l.to>o&&l.type instanceof mi){let c=Math.max(o,l.from)-o,u=Math.min(s,l.to)-o;c<u&&(r||(r=[])).push(l.copy(c,u))}}if(r){let a=new n(r.sort(bi),ji);return i?new xs([a,i]):a}return i||lt}eq(t){if(this==t)return!0;if(!(t instanceof n)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return fu(this.localsInner(t))}localsInner(t){if(this==lt)return ji;if(t.inlineContent||!this.local.some(mi.is))return this.local;let e=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof mi||e.push(this.local[i]);return e}forEachSet(t){t(this)}};ke.empty=new ke([],[]);ke.removeOverlap=fu;var lt=ke.empty,xs=class n{constructor(t){this.members=t}map(t,e){let i=this.members.map(r=>r.map(t,e,gi));return n.from(i)}forChild(t,e){if(e.isLeaf)return ke.empty;let i=[];for(let r=0;r<this.members.length;r++){let o=this.members[r].forChild(t,e);o!=lt&&(o instanceof n?i=i.concat(o.members):i.push(o))}return n.from(i)}eq(t){if(!(t instanceof n)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,i=!0;for(let r=0;r<this.members.length;r++){let o=this.members[r].localsInner(t);if(o.length)if(!e)e=o;else{i&&(e=e.slice(),i=!1);for(let s=0;s<o.length;s++)e.push(o[s])}}return e?fu(i?e:e.sort(bi)):ji}static from(t){switch(t.length){case 0:return lt;case 1:return t[0];default:return new n(t.every(e=>e instanceof ke)?t:t.reduce((e,i)=>e.concat(i instanceof ke?i:i.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}};function GS(n,t,e,i,r,o,s){let a=n.slice();for(let c=0,u=o;c<e.maps.length;c++){let d=0;e.maps[c].forEach((h,p,f,g)=>{let m=g-f-(p-h);for(let b=0;b<a.length;b+=3){let y=a[b+1];if(y<0||h>y+u-d)continue;let v=a[b]+u-d;p>=v?a[b+1]=h<=v?-2:-1:h>=u&&m&&(a[b]+=m,a[b+1]+=m)}d+=m}),u=e.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=e.map(n[c]+o),d=u-r;if(d<0||d>=i.content.size){l=!0;continue}let h=e.map(n[c+1]+o,-1),p=h-r,{index:f,offset:g}=i.content.findIndex(d),m=i.maybeChild(f);if(m&&g==d&&g+m.nodeSize==p){let b=a[c+2].mapInner(e,m,u+1,n[c]+o+1,s);b!=lt?(a[c]=d,a[c+1]=p,a[c+2]=b):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=jS(a,n,t,e,r,o,s),u=ks(c,i,0,s);t=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let p=u.children[d];for(;h<a.length&&a[h]<p;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new ke(t.sort(bi),a)}function Fm(n,t){if(!t||!n.length)return n;let e=[];for(let i=0;i<n.length;i++){let r=n[i];e.push(new Ne(r.from+t,r.to+t,r.type))}return e}function jS(n,t,e,i,r,o,s){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(i,r,c);d?e.push(d):s.onRemove&&s.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<n.length;l+=3)n[l+1]==-1&&a(n[l+2],t[l]+o+1);return e}function Hm(n,t,e){if(t.isLeaf)return null;let i=e+t.nodeSize,r=null;for(let o=0,s;o<n.length;o++)(s=n[o])&&s.from>e&&s.to<i&&((r||(r=[])).push(s),n[o]=null);return r}function zm(n){let t=[];for(let e=0;e<n.length;e++)n[e]!=null&&t.push(n[e]);return t}function ks(n,t,e,i){let r=[],o=!1;t.forEach((a,l)=>{let c=Hm(n,a,l+e);if(c){o=!0;let u=ks(c,a,e+l+1,i);u!=lt&&r.push(l,l+a.nodeSize,u)}});let s=Fm(o?zm(n):n,-e).sort(bi);for(let a=0;a<s.length;a++)s[a].type.valid(t,s[a])||(i.onRemove&&i.onRemove(s[a].spec),s.splice(a--,1));return s.length||r.length?new ke(s,r):lt}function bi(n,t){return n.from-t.from||n.to-t.to}function fu(n){let t=n;for(let e=0;e<t.length-1;e++){let i=t[e];if(i.from!=i.to)for(let r=e+1;r<t.length;r++){let o=t[r];if(o.from==i.from){o.to!=i.to&&(t==n&&(t=n.slice()),t[r]=o.copy(o.from,i.to),em(t,r+1,o.copy(i.to,o.to)));continue}else{o.from<i.to&&(t==n&&(t=n.slice()),t[e]=i.copy(i.from,o.from),em(t,r,i.copy(o.from,i.to)));break}}}return t}function em(n,t,e){for(;t<n.length&&bi(e,n[t])>0;)t++;n.splice(t,0,e)}function Vc(n){let t=[];return n.someProp("decorations",e=>{let i=e(n.state);i&&i!=lt&&t.push(i)}),n.cursorWrapper&&t.push(ke.create(n.state.doc,[n.cursorWrapper.deco])),xs.from(t)}var YS={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},XS=Et&&Vn<=11,ou=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}},su=class{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new ou,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(i=>{for(let r=0;r<i.length;r++)this.queue.push(i[r]);Et&&Vn<=11&&i.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),XS&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,YS)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(qf(this.view)){if(this.suppressingSelectionUpdates)return vn(this.view);if(Et&&Vn<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&yi(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e=new Set,i;for(let o=t.focusNode;o;o=Xi(o))e.add(o);for(let o=t.anchorNode;o;o=Xi(o))if(e.has(o)){i=o;break}let r=i&&this.view.docView.nearestDesc(i);if(r&&r.ignoreMutation({type:"selection",target:i.nodeType==3?i.parentNode:i}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let i=t.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(i)&&qf(t)&&!this.ignoreSelectionChange(i),o=-1,s=-1,a=!1,l=[];if(t.editable)for(let u=0;u<e.length;u++){let d=this.registerMutation(e[u],l);d&&(o=o<0?d.from:Math.min(d.from,o),s=s<0?d.to:Math.max(d.to,s),d.typeOver&&(a=!0))}if(Dt&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let p=h.parentNode;p&&p.nodeName=="LI"&&(!d||QS(t,d)!=p)&&h.remove()}}}let c=null;o<0&&r&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&ws(i)&&(c=lu(t))&&c.eq(ie.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,vn(t),this.currentSelection.set(i),t.scrollToSelection()):(o>-1||r)&&(o>-1&&(t.docView.markDirty(o,s),JS(t)),this.handleDOMChange(o,s,a,l),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(i)||vn(t),this.currentSelection.set(i))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let i=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(i==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!i||i.ignoreMutation(t))return null;if(t.type=="childList"){for(let u=0;u<t.addedNodes.length;u++){let d=t.addedNodes[u];e.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(i.contentDOM&&i.contentDOM!=i.dom&&!i.contentDOM.contains(t.target))return{from:i.posBefore,to:i.posAfter};let r=t.previousSibling,o=t.nextSibling;if(Et&&Vn<=11&&t.addedNodes.length)for(let u=0;u<t.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=t.addedNodes[u];(!d||Array.prototype.indexOf.call(t.addedNodes,d)<0)&&(r=d),(!h||Array.prototype.indexOf.call(t.addedNodes,h)<0)&&(o=h)}let s=r&&r.parentNode==t.target?tt(r)+1:0,a=i.localPosFromDOM(t.target,s,-1),l=o&&o.parentNode==t.target?tt(o):t.target.childNodes.length,c=i.localPosFromDOM(t.target,l,1);return{from:a,to:c}}else return t.type=="attributes"?{from:i.posAtStart-i.border,to:i.posAtEnd+i.border}:(this.lastChangedTextNode=t.target,{from:i.posAtStart,to:i.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}},tm=new WeakMap,nm=!1;function JS(n){if(!tm.has(n)&&(tm.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Dt,nm)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),nm=!0}}function im(n,t){let e=t.startContainer,i=t.startOffset,r=t.endContainer,o=t.endOffset,s=n.domAtPos(n.state.selection.anchor);return yi(s.node,s.offset,r,o)&&([e,i,r,o]=[r,o,e,i]),{anchorNode:e,anchorOffset:i,focusNode:r,focusOffset:o}}function ZS(n,t){if(t.getComposedRanges){let r=t.getComposedRanges(n.root)[0];if(r)return im(n,r)}let e;function i(r){r.preventDefault(),r.stopImmediatePropagation(),e=r.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",i,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",i,!0),e?im(n,e):null}function QS(n,t){for(let e=t.parentNode;e&&e!=n.dom;e=e.parentNode){let i=n.docView.nearestDesc(e,!0);if(i&&i.node.isBlock)return e}return null}function e1(n,t,e){let{node:i,fromOffset:r,toOffset:o,from:s,to:a}=n.docView.parseRange(t,e),l=n.domSelectionRange(),c,u=l.anchorNode;if(u&&n.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],ws(l)||c.push({node:l.focusNode,offset:l.focusOffset})),ct&&n.input.lastKeyCode===8)for(let m=o;m>r;m--){let b=i.childNodes[m-1],y=b.pmViewDesc;if(b.nodeName=="BR"&&!y){o=m;break}if(!y||y.size)break}let d=n.state.doc,h=n.someProp("domParser")||vt.fromSchema(n.state.schema),p=d.resolve(s),f=null,g=h.parse(i,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:r,to:o,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:t1,context:p});if(c&&c[0].pos!=null){let m=c[0].pos,b=c[1]&&c[1].pos;b==null&&(b=m),f={anchor:m+s,head:b+s}}return{doc:g,sel:f,from:s,to:a}}function t1(n){let t=n.pmViewDesc;if(t)return t.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(pt&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}else if(n.parentNode.lastChild==n||pt&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}var n1=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function i1(n,t,e,i,r){let o=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,t<0){let w=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,C=lu(n,w);if(C&&!n.state.selection.eq(C)){if(ct&&yn&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",F=>F(n,hi(13,"Enter"))))return;let I=n.state.tr.setSelection(C);w=="pointer"?I.setMeta("pointer",!0):w=="key"&&I.scrollIntoView(),o&&I.setMeta("composition",o),n.dispatch(I)}return}let s=n.state.doc.resolve(t),a=s.sharedDepth(e);t=s.before(a+1),e=n.state.doc.resolve(e).after(a+1);let l=n.state.selection,c=e1(n,t,e),u=n.state.doc,d=u.slice(c.from,c.to),h,p;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(h=n.state.selection.to,p="end"):(h=n.state.selection.from,p="start"),n.input.lastKeyCode=null;let f=s1(d.content,c.doc.content,c.from,h,p);if(f&&n.input.domChangeCount++,(Ji&&n.input.lastIOSEnter>Date.now()-225||yn)&&r.some(w=>w.nodeType==1&&!n1.test(w.nodeName))&&(!f||f.endA>=f.endB)&&n.someProp("handleKeyDown",w=>w(n,hi(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!f)if(i&&l instanceof j&&!l.empty&&l.$head.sameParent(l.$anchor)&&!n.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))f={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let w=rm(n,n.state.doc,c.sel);if(w&&!w.eq(n.state.selection)){let C=n.state.tr.setSelection(w);o&&C.setMeta("composition",o),n.dispatch(C)}}return}n.state.selection.from<n.state.selection.to&&f.start==f.endB&&n.state.selection instanceof j&&(f.start>n.state.selection.from&&f.start<=n.state.selection.from+2&&n.state.selection.from>=c.from?f.start=n.state.selection.from:f.endA<n.state.selection.to&&f.endA>=n.state.selection.to-2&&n.state.selection.to<=c.to&&(f.endB+=n.state.selection.to-f.endA,f.endA=n.state.selection.to)),Et&&Vn<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>c.from&&c.doc.textBetween(f.start-c.from-1,f.start-c.from+1)==" \xA0"&&(f.start--,f.endA--,f.endB--);let g=c.doc.resolveNoCache(f.start-c.from),m=c.doc.resolveNoCache(f.endB-c.from),b=u.resolve(f.start),y=g.sameParent(m)&&g.parent.inlineContent&&b.end()>=f.endA,v;if((Ji&&n.input.lastIOSEnter>Date.now()-225&&(!y||r.some(w=>w.nodeName=="DIV"||w.nodeName=="P"))||!y&&g.pos<c.doc.content.size&&(!g.sameParent(m)||!g.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(g.pos,m.pos,"",""))&&(v=ie.findFrom(c.doc.resolve(g.pos+1),1,!0))&&v.head>g.pos)&&n.someProp("handleKeyDown",w=>w(n,hi(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>f.start&&o1(u,f.start,f.endA,g,m)&&n.someProp("handleKeyDown",w=>w(n,hi(8,"Backspace")))){yn&&ct&&n.domObserver.suppressSelectionUpdates();return}ct&&f.endB==f.start&&(n.input.lastChromeDelete=Date.now()),yn&&!y&&g.start()!=m.start()&&m.parentOffset==0&&g.depth==m.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==f.endA&&(f.endB-=2,m=c.doc.resolveNoCache(f.endB-c.from),setTimeout(()=>{n.someProp("handleKeyDown",function(w){return w(n,hi(13,"Enter"))})},20));let E=f.start,x=f.endA,k=w=>{let C=w||n.state.tr.replace(E,x,c.doc.slice(f.start-c.from,f.endB-c.from));if(c.sel){let I=rm(n,C.doc,c.sel);I&&!(ct&&n.composing&&I.empty&&(f.start!=f.endB||n.input.lastChromeDelete<Date.now()-100)&&(I.head==E||I.head==C.mapping.map(x)-1)||Et&&I.empty&&I.head==E)&&C.setSelection(I)}return o&&C.setMeta("composition",o),C.scrollIntoView()},S;if(y){if(g.pos==m.pos){Et&&Vn<=11&&g.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>vn(n),20));let w=k(n.state.tr.delete(E,x)),C=u.resolve(f.start).marksAcross(u.resolve(f.endA));C&&w.ensureMarks(C),n.dispatch(w)}else if(f.endA==f.endB&&(S=r1(g.parent.content.cut(g.parentOffset,m.parentOffset),b.parent.content.cut(b.parentOffset,f.endA-b.start())))){let w=k(n.state.tr);S.type=="add"?w.addMark(E,x,S.mark):w.removeMark(E,x,S.mark),n.dispatch(w)}else if(g.parent.child(g.index()).isText&&g.index()==m.index()-(m.textOffset?0:1)){let w=g.parent.textBetween(g.parentOffset,m.parentOffset),C=()=>k(n.state.tr.insertText(w,E,x));n.someProp("handleTextInput",I=>I(n,E,x,w,C))||n.dispatch(C())}}else n.dispatch(k())}function rm(n,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:cu(n,t.resolve(e.anchor),t.resolve(e.head))}function r1(n,t){let e=n.firstChild.marks,i=t.firstChild.marks,r=e,o=i,s,a,l;for(let u=0;u<i.length;u++)r=i[u].removeFromSet(r);for(let u=0;u<e.length;u++)o=e[u].removeFromSet(o);if(r.length==1&&o.length==0)a=r[0],s="add",l=u=>u.mark(a.addToSet(u.marks));else if(r.length==0&&o.length==1)a=o[0],s="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<t.childCount;u++)c.push(l(t.child(u)));if(z.from(c).eq(n))return{mark:a,type:s}}function o1(n,t,e,i,r){if(e-t<=r.pos-i.pos||$c(i,!0,!1)<r.pos)return!1;let o=n.resolve(t);if(!i.parent.isTextblock){let a=o.nodeAfter;return a!=null&&e==t+a.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let s=n.resolve($c(o,!0,!0));return!s.parent.isTextblock||s.pos>e||$c(s,!0,!1)<e?!1:i.parent.content.cut(i.parentOffset).eq(s.parent.content)}function $c(n,t,e){let i=n.depth,r=t?n.end():n.pos;for(;i>0&&(t||n.indexAfter(i)==n.node(i).childCount);)i--,r++,t=!1;if(e){let o=n.node(i).maybeChild(n.indexAfter(i));for(;o&&!o.isLeaf;)o=o.firstChild,r++}return r}function s1(n,t,e,i,r){let o=n.findDiffStart(t,e);if(o==null)return null;let{a:s,b:a}=n.findDiffEnd(t,e+n.size,e+t.size);if(r=="end"){let l=Math.max(0,o-Math.min(s,a));i-=s+l-o}if(s<o&&n.size<t.size){let l=i<=o&&i>=s?o-i:0;o-=l,o&&o<t.size&&om(t.textBetween(o-1,o+1))&&(o+=l?1:-1),a=o+(a-s),s=o}else if(a<o){let l=i<=o&&i>=a?o-i:0;o-=l,o&&o<n.size&&om(n.textBetween(o-1,o+1))&&(o+=l?1:-1),s=o+(s-a),a=o}return{start:o,endA:s,endB:a}}function om(n){if(n.length!=2)return!1;let t=n.charCodeAt(0),e=n.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}var Wr=class{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new tu,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(um),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=lm(this),am(this),this.nodeViews=cm(this),this.docView=zf(this.state.doc,sm(this),Vc(this),this.dom,this),this.domObserver=new su(this,(i,r,o,s)=>i1(this,i,r,o,s)),this.domObserver.start(),RS(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&nu(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(um),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let i in this._props)e[i]=this._props[i];e.state=this.state;for(let i in t)e[i]=t[i];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var i;let r=this.state,o=!1,s=!1;t.storedMarks&&this.composing&&(Om(this),s=!0),this.state=t;let a=r.plugins!=t.plugins||this._props.plugins!=e.plugins;if(a||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let p=cm(this);l1(p,this.nodeViews)&&(this.nodeViews=p,o=!0)}(a||e.handleDOMEvents!=this._props.handleDOMEvents)&&nu(this),this.editable=lm(this),am(this);let l=Vc(this),c=sm(this),u=r.plugins!=t.plugins&&!r.doc.eq(t.doc)?"reset":t.scrollToSelection>r.scrollToSelection?"to selection":"preserve",d=o||!this.docView.matchesNode(t.doc,c,l);(d||!t.selection.eq(r.selection))&&(s=!0);let h=u=="preserve"&&s&&this.dom.style.overflowAnchor==null&&Gw(this);if(s){this.domObserver.stop();let p=d&&(Et||ct)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&a1(r.selection,t.selection);if(d){let f=ct?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=VS(this)),(o||!this.docView.update(t.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=zf(t.doc,c,l,this.dom,this)),f&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&fS(this))?vn(this,p):(wm(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),!((i=this.dragging)===null||i===void 0)&&i.node&&!r.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,r),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&jw(h)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof Y){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&_f(this,e.getBoundingClientRect(),t)}else _f(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let i=this.directPlugins[e];i.spec.view&&this.pluginViews.push(i.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let i=this.state.plugins[e];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let i=this.pluginViews[e];i.update&&i.update(this,t)}}updateDraggedNode(t,e){let i=t.node,r=-1;if(this.state.doc.nodeAt(i.from)==i.node)r=i.from;else{let o=i.from+(this.state.doc.content.size-e.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==i.node&&(r=o)}this.dragging=new vs(t.slice,t.move,r<0?void 0:Y.create(this.state.doc,r))}someProp(t,e){let i=this._props&&this._props[t],r;if(i!=null&&(r=e?e(i):i))return r;for(let s=0;s<this.directPlugins.length;s++){let a=this.directPlugins[s].props[t];if(a!=null&&(r=e?e(a):a))return r}let o=this.state.plugins;if(o)for(let s=0;s<o.length;s++){let a=o[s].props[t];if(a!=null&&(r=e?e(a):a))return r}}hasFocus(){if(Et){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Yw(this.dom),vn(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return t||document}updateRoot(){this._root=null}posAtCoords(t){return eS(this,t)}coordsAtPos(t,e=1){return bm(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,i=-1){let r=this.docView.posFromDOM(t,e,i);if(r==null)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(t,e){return oS(this,e||this.state,t)}pasteHTML(t,e){return Vr(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return Vr(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return uu(this,t)}destroy(){this.docView&&(AS(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Vc(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Dw())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return NS(this,t)}domSelectionRange(){let t=this.domSelection();return t?pt&&this.root.nodeType===11&&Vw(this.dom.ownerDocument)==this.dom&&ZS(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};Wr.prototype.dispatch=function(n){let t=this._props.dispatchTransaction;t?t.call(this,n):this.updateState(this.state.apply(n))};function sm(n){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(n.editable),n.someProp("attributes",e=>{if(typeof e=="function"&&(e=e(n.state)),e)for(let i in e)i=="class"?t.class+=" "+e[i]:i=="style"?t.style=(t.style?t.style+";":"")+e[i]:!t[i]&&i!="contenteditable"&&i!="nodeName"&&(t[i]=String(e[i]))}),t.translate||(t.translate="no"),[Ne.node(0,n.state.doc.content.size,t)]}function am(n){if(n.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),n.cursorWrapper={dom:t,deco:Ne.widget(n.state.selection.from,t,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function lm(n){return!n.someProp("editable",t=>t(n.state)===!1)}function a1(n,t){let e=Math.min(n.$anchor.sharedDepth(n.head),t.$anchor.sharedDepth(t.head));return n.$anchor.start(e)!=t.$anchor.start(e)}function cm(n){let t=Object.create(null);function e(i){for(let r in i)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=i[r])}return n.someProp("nodeViews",e),n.someProp("markViews",e),t}function l1(n,t){let e=0,i=0;for(let r in n){if(n[r]!=t[r])return!0;e++}for(let r in t)i++;return e!=i}function um(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var En={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ts={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},c1=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),u1=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for($e=0;$e<10;$e++)En[48+$e]=En[96+$e]=String($e);var $e;for($e=1;$e<=24;$e++)En[$e+111]="F"+$e;var $e;for($e=65;$e<=90;$e++)En[$e]=String.fromCharCode($e+32),Ts[$e]=String.fromCharCode($e);var $e;for(Ms in En)Ts.hasOwnProperty(Ms)||(Ts[Ms]=En[Ms]);var Ms;function Vm(n){var t=c1&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||u1&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",e=!t&&n.key||(n.shiftKey?Ts:En)[n.keyCode]||n.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}var d1=typeof navigator!="undefined"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),h1=typeof navigator!="undefined"&&/Win/.test(navigator.platform);function p1(n){let t=n.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let i,r,o,s;for(let a=0;a<t.length-1;a++){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))i=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))d1?s=!0:r=!0;else throw new Error("Unrecognized modifier name: "+l)}return i&&(e="Alt-"+e),r&&(e="Ctrl-"+e),s&&(e="Meta-"+e),o&&(e="Shift-"+e),e}function f1(n){let t=Object.create(null);for(let e in n)t[p1(e)]=n[e];return t}function mu(n,t,e=!0){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),e&&t.shiftKey&&(n="Shift-"+n),n}function $m(n){return new X({props:{handleKeyDown:gu(n)}})}function gu(n){let t=f1(n);return function(e,i){let r=Vm(i),o,s=t[mu(r,i)];if(s&&s(e.state,e.dispatch,e))return!0;if(r.length==1&&r!=" "){if(i.shiftKey){let a=t[mu(r,i,!1)];if(a&&a(e.state,e.dispatch,e))return!0}if((i.altKey||i.metaKey||i.ctrlKey)&&!(h1&&i.ctrlKey&&i.altKey)&&(o=En[i.keyCode])&&o!=r){let a=t[mu(o,i)];if(a&&a(e.state,e.dispatch,e))return!0}}return!1}}var m1=Object.defineProperty,ku=(n,t)=>{for(var e in t)m1(n,e,{get:t[e],enumerable:!0})};function _s(n){let{state:t,transaction:e}=n,{selection:i}=e,{doc:r}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return r},get tr(){return i=e.selection,r=e.doc,o=e.storedMarks,e}}}var Os=class{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:n,editor:t,state:e}=this,{view:i}=t,{tr:r}=e,o=this.buildProps(r);return Object.fromEntries(Object.entries(n).map(([s,a])=>[s,(...c)=>{let u=a(...c)(o);return!r.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(r),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,t=!0){let{rawCommands:e,editor:i,state:r}=this,{view:o}=i,s=[],a=!!n,l=n||r.tr,c=()=>(!a&&t&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(l),s.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(e).map(([d,h])=>[d,(...f)=>{let g=this.buildProps(l,t),m=h(...f)(g);return s.push(m),u}])),run:c};return u}createCan(n){let{rawCommands:t,state:e}=this,i=!1,r=n||e.tr,o=this.buildProps(r,i);return{...Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...c)=>l(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(r,i)}}buildProps(n,t=!0){let{rawCommands:e,editor:i,state:r}=this,{view:o}=i,s={tr:n,editor:i,view:o,state:_s({state:r,transaction:n}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(n,t),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)(s)]))}};return s}},Jm={};ku(Jm,{blur:()=>g1,clearContent:()=>b1,clearNodes:()=>y1,command:()=>v1,createParagraphNear:()=>E1,cut:()=>x1,deleteCurrentNode:()=>k1,deleteNode:()=>w1,deleteRange:()=>S1,deleteSelection:()=>M1,enter:()=>T1,exitCode:()=>C1,extendMarkRange:()=>L1,first:()=>R1,focus:()=>I1,forEach:()=>N1,insertContent:()=>P1,insertContentAt:()=>D1,joinBackward:()=>H1,joinDown:()=>F1,joinForward:()=>z1,joinItemBackward:()=>V1,joinItemForward:()=>$1,joinTextblockBackward:()=>W1,joinTextblockForward:()=>U1,joinUp:()=>B1,keyboardShortcut:()=>q1,lift:()=>G1,liftEmptyBlock:()=>j1,liftListItem:()=>Y1,newlineInCode:()=>X1,resetAttributes:()=>J1,scrollIntoView:()=>Z1,selectAll:()=>Q1,selectNodeBackward:()=>eM,selectNodeForward:()=>tM,selectParentNode:()=>nM,selectTextblockEnd:()=>iM,selectTextblockStart:()=>rM,setContent:()=>oM,setMark:()=>xM,setMeta:()=>kM,setNode:()=>wM,setNodeSelection:()=>SM,setTextDirection:()=>MM,setTextSelection:()=>TM,sinkListItem:()=>CM,splitBlock:()=>LM,splitListItem:()=>RM,toggleList:()=>AM,toggleMark:()=>IM,toggleNode:()=>NM,toggleWrap:()=>PM,undoInputRule:()=>_M,unsetAllMarks:()=>OM,unsetMark:()=>DM,unsetTextDirection:()=>BM,updateAttributes:()=>FM,wrapIn:()=>HM,wrapInList:()=>zM});var g1=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window==null?void 0:window.getSelection())==null||e.removeAllRanges())}),!0),b1=(n=!0)=>({commands:t})=>t.setContent("",{emitUpdate:n}),y1=()=>({state:n,tr:t,dispatch:e})=>{let{selection:i}=t,{ranges:r}=i;return e&&r.forEach(({$from:o,$to:s})=>{n.doc.nodesBetween(o.pos,s.pos,(a,l)=>{if(a.type.isText)return;let{doc:c,mapping:u}=t,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),p=d.blockRange(h);if(!p)return;let f=mn(p);if(a.type.isTextblock){let{defaultType:g}=d.parent.contentMatchAt(d.index());t.setNodeMarkup(p.start,g)}(f||f===0)&&t.lift(p,f)})}),!0},v1=n=>t=>n(t),E1=()=>({state:n,dispatch:t})=>Nc(n,t),x1=(n,t)=>({editor:e,tr:i})=>{let{state:r}=e,o=r.doc.slice(n.from,n.to);i.deleteRange(n.from,n.to);let s=i.mapping.map(t);return i.insert(s,o.content),i.setSelection(new j(i.doc.resolve(Math.max(s-1,0)))),!0},k1=()=>({tr:n,dispatch:t})=>{let{selection:e}=n,i=e.$anchor.node();if(i.content.size>0)return!1;let r=n.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===i.type){if(t){let a=r.before(o),l=r.after(o);n.delete(a,l).scrollIntoView()}return!0}return!1};function Pe(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}var w1=n=>({tr:t,state:e,dispatch:i})=>{let r=Pe(n,e.schema),o=t.selection.$anchor;for(let s=o.depth;s>0;s-=1)if(o.node(s).type===r){if(i){let l=o.before(s),c=o.after(s);t.delete(l,c).scrollIntoView()}return!0}return!1},S1=n=>({tr:t,dispatch:e})=>{let{from:i,to:r}=n;return e&&t.delete(i,r),!0},M1=()=>({state:n,dispatch:t})=>hs(n,t),T1=()=>({commands:n})=>n.keyboardShortcut("Enter"),C1=()=>({state:n,dispatch:t})=>Ic(n,t);function wu(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function Ns(n,t,e={strict:!0}){let i=Object.keys(t);return i.length?i.every(r=>e.strict?t[r]===n[r]:wu(t[r])?t[r].test(n[r]):t[r]===n[r]):!0}function Zm(n,t,e={}){return n.find(i=>i.type===t&&Ns(Object.fromEntries(Object.keys(e).map(r=>[r,i.attrs[r]])),e))}function Wm(n,t,e={}){return!!Zm(n,t,e)}function Su(n,t,e){var i;if(!n||!t)return;let r=n.parent.childAfter(n.parentOffset);if((!r.node||!r.node.marks.some(u=>u.type===t))&&(r=n.parent.childBefore(n.parentOffset)),!r.node||!r.node.marks.some(u=>u.type===t)||(e=e||((i=r.node.marks[0])==null?void 0:i.attrs),!Zm([...r.node.marks],t,e)))return;let s=r.index,a=n.start()+r.offset,l=s+1,c=a+r.node.nodeSize;for(;s>0&&Wm([...n.parent.child(s-1).marks],t,e);)s-=1,a-=n.parent.child(s).nodeSize;for(;l<n.parent.childCount&&Wm([...n.parent.child(l).marks],t,e);)c+=n.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function xn(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}var L1=(n,t={})=>({tr:e,state:i,dispatch:r})=>{let o=xn(n,i.schema),{doc:s,selection:a}=e,{$from:l,from:c,to:u}=a;if(r){let d=Su(l,o,t);if(d&&d.from<=c&&d.to>=u){let h=j.create(s,d.from,d.to);e.setSelection(h)}}return!0},R1=n=>t=>{let e=typeof n=="function"?n(t):n;for(let i=0;i<e.length;i+=1)if(e[i](t))return!0;return!1};function Qm(n){return n instanceof j}function Ei(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function eg(n,t=null){if(!t)return null;let e=ie.atStart(n),i=ie.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return i;let r=e.from,o=i.to;return t==="all"?j.create(n,Ei(0,r,o),Ei(n.content.size,r,o)):j.create(n,Ei(t,r,o),Ei(t,r,o))}function A1(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Mu(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var I1=(n=null,t={})=>({editor:e,view:i,tr:r,dispatch:o})=>{t={scrollIntoView:!0,...t};let s=()=>{(Mu()||A1())&&i.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(i.focus(),t!=null&&t.scrollIntoView&&e.commands.scrollIntoView())})};if(i.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!Qm(e.state.selection))return s(),!0;let a=eg(r.doc,n)||e.state.selection,l=e.state.selection.eq(a);return o&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),s()),!0},N1=(n,t)=>e=>n.every((i,r)=>t(i,{...e,index:r})),P1=(n,t)=>({tr:e,commands:i})=>i.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),tg=n=>{let t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){let i=t[e];i.nodeType===3&&i.nodeValue&&/^(\n\s\s|\n)$/.test(i.nodeValue)?n.removeChild(i):i.nodeType===1&&tg(i)}return n};function Cs(n){if(typeof window=="undefined")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");let t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return tg(e)}function qr(n,t,e){if(n instanceof yt||n instanceof z)return n;e={slice:!0,parseOptions:{},...e};let i=typeof n=="object"&&n!==null,r=typeof n=="string";if(i)try{if(Array.isArray(n)&&n.length>0)return z.fromArray(n.map(a=>t.nodeFromJSON(a)));let s=t.nodeFromJSON(n);return e.errorOnInvalidContent&&s.check(),s}catch(o){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),qr("",t,e)}if(r){if(e.errorOnInvalidContent){let s=!1,a="",l=new Oi({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(s=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(e.slice?vt.fromSchema(l).parseSlice(Cs(n),e.parseOptions):vt.fromSchema(l).parse(Cs(n),e.parseOptions),e.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}let o=vt.fromSchema(t);return e.slice?o.parseSlice(Cs(n),e.parseOptions).content:o.parse(Cs(n),e.parseOptions)}return qr("",t,e)}function _1(n,t,e){let i=n.steps.length-1;if(i<t)return;let r=n.steps[i];if(!(r instanceof st||r instanceof ze))return;let o=n.mapping.maps[i],s=0;o.forEach((a,l,c,u)=>{s===0&&(s=u)}),n.setSelection(ie.near(n.doc.resolve(s),e))}var O1=n=>!("type"in n),D1=(n,t,e)=>({tr:i,dispatch:r,editor:o})=>{var s;if(r){e={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let a,l=m=>{o.emit("contentError",{editor:o,error:m,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{qr(t,o.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(m){l(m)}try{a=qr(t,o.schema,{parseOptions:c,errorOnInvalidContent:(s=e.errorOnInvalidContent)!=null?s:o.options.enableContentCheck})}catch(m){return l(m),!1}let{from:u,to:d}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},h=!0,p=!0;if((O1(a)?a:[a]).forEach(m=>{m.check(),h=h?m.isText&&m.marks.length===0:!1,p=p?m.isBlock:!1}),u===d&&p){let{parent:m}=i.doc.resolve(u);m.isTextblock&&!m.type.spec.code&&!m.childCount&&(u-=1,d+=1)}let g;if(h){if(Array.isArray(t))g=t.map(m=>m.text||"").join("");else if(t instanceof z){let m="";t.forEach(b=>{b.text&&(m+=b.text)}),g=m}else typeof t=="object"&&t&&t.text?g=t.text:g=t;i.insertText(g,u,d)}else{g=a;let m=i.doc.resolve(u),b=m.node(),y=m.parentOffset===0,v=b.isText||b.isTextblock,E=b.content.size>0;y&&v&&E&&(u=Math.max(0,u-1)),i.replaceWith(u,d,g)}e.updateSelection&&_1(i,i.steps.length-1,-1),e.applyInputRules&&i.setMeta("applyInputRules",{from:u,text:g}),e.applyPasteRules&&i.setMeta("applyPasteRules",{from:u,text:g})}return!0},B1=()=>({state:n,dispatch:t})=>kf(n,t),F1=()=>({state:n,dispatch:t})=>wf(n,t),H1=()=>({state:n,dispatch:t})=>wc(n,t),z1=()=>({state:n,dispatch:t})=>Tc(n,t),V1=()=>({state:n,dispatch:t,tr:e})=>{try{let i=ci(n.doc,n.selection.$from.pos,-1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch(i){return!1}},$1=()=>({state:n,dispatch:t,tr:e})=>{try{let i=ci(n.doc,n.selection.$from.pos,1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch(i){return!1}},W1=()=>({state:n,dispatch:t})=>yf(n,t),U1=()=>({state:n,dispatch:t})=>vf(n,t);function ng(){return typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1}function K1(n){let t=n.split(/-(?!$)/),e=t[t.length-1];e==="Space"&&(e=" ");let i,r,o,s;for(let a=0;a<t.length-1;a+=1){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))i=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))Mu()||ng()?s=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return i&&(e=`Alt-${e}`),r&&(e=`Ctrl-${e}`),s&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}var q1=n=>({editor:t,view:e,tr:i,dispatch:r})=>{let o=K1(n).split(/-(?!$)/),s=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{e.someProp("handleKeyDown",c=>c(e,a))});return l==null||l.steps.forEach(c=>{let u=c.map(i.mapping);u&&r&&i.maybeStep(u)}),!0};function tn(n,t,e={}){let{from:i,to:r,empty:o}=n.selection,s=t?Pe(t,n.schema):null,a=[];n.doc.nodesBetween(i,r,(d,h)=>{if(d.isText)return;let p=Math.max(i,h),f=Math.min(r,h+d.nodeSize);a.push({node:d,from:p,to:f})});let l=r-i,c=a.filter(d=>s?s.name===d.node.type.name:!0).filter(d=>Ns(d.node.attrs,e,{strict:!1}));return o?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var G1=(n,t={})=>({state:e,dispatch:i})=>{let r=Pe(n,e.schema);return tn(e,r,t)?Sf(e,i):!1},j1=()=>({state:n,dispatch:t})=>Pc(n,t),Y1=n=>({state:t,dispatch:e})=>{let i=Pe(n,t.schema);return Af(i)(t,e)},X1=()=>({state:n,dispatch:t})=>Rc(n,t);function Ds(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function Um(n,t){let e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((i,r)=>(e.includes(r)||(i[r]=n[r]),i),{})}var J1=(n,t)=>({tr:e,state:i,dispatch:r})=>{let o=null,s=null,a=Ds(typeof n=="string"?n:n.name,i.schema);if(!a)return!1;a==="node"&&(o=Pe(n,i.schema)),a==="mark"&&(s=xn(n,i.schema));let l=!1;return e.selection.ranges.forEach(c=>{i.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{o&&o===u.type&&(l=!0,r&&e.setNodeMarkup(d,void 0,Um(u.attrs,t))),s&&u.marks.length&&u.marks.forEach(h=>{s===h.type&&(l=!0,r&&e.addMark(d,d+u.nodeSize,s.create(Um(h.attrs,t))))})})}),l},Z1=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),Q1=()=>({tr:n,dispatch:t})=>{if(t){let e=new ht(n.doc);n.setSelection(e)}return!0},eM=()=>({state:n,dispatch:t})=>Sc(n,t),tM=()=>({state:n,dispatch:t})=>Cc(n,t),nM=()=>({state:n,dispatch:t})=>Mf(n,t),iM=()=>({state:n,dispatch:t})=>Oc(n,t),rM=()=>({state:n,dispatch:t})=>_c(n,t);function Eu(n,t,e={},i={}){return qr(n,t,{slice:!1,parseOptions:e,errorOnInvalidContent:i.errorOnInvalidContent})}var oM=(n,{errorOnInvalidContent:t,emitUpdate:e=!0,parseOptions:i={}}={})=>({editor:r,tr:o,dispatch:s,commands:a})=>{let{doc:l}=o;if(i.preserveWhitespace!=="full"){let c=Eu(n,r.schema,i,{errorOnInvalidContent:t!=null?t:r.options.enableContentCheck});return s&&o.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!e),!0}return s&&o.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:l.content.size},n,{parseOptions:i,errorOnInvalidContent:t!=null?t:r.options.enableContentCheck})};function ig(n,t){let e=xn(t,n.schema),{from:i,to:r,empty:o}=n.selection,s=[];o?(n.storedMarks&&s.push(...n.storedMarks),s.push(...n.selection.$head.marks())):n.doc.nodesBetween(i,r,l=>{s.push(...l.marks)});let a=s.find(l=>l.type.name===e.name);return a?{...a.attrs}:{}}function Tu(n,t){let e=new Fi(n);return t.forEach(i=>{i.steps.forEach(r=>{e.step(r)})}),e}function sM(n){for(let t=0;t<n.edgeCount;t+=1){let{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function Bs(n,t){let e=[];return n.descendants((i,r)=>{t(i)&&e.push({node:i,pos:r})}),e}function rg(n,t,e){let i=[];return n.nodesBetween(t.from,t.to,(r,o)=>{e(r)&&i.push({node:r,pos:o})}),i}function aM(n,t){for(let e=n.depth;e>0;e-=1){let i=n.node(e);if(t(i))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:i}}}function Fs(n){return t=>aM(t.$from,n)}function Q(n,t,e){return n.config[t]===void 0&&n.parent?Q(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?Q(n.parent,t,e):null}):n.config[t]}function Cu(n){return n.map(t=>{let e={name:t.name,options:t.options,storage:t.storage},i=Q(t,"addExtensions",e);return i?[t,...Cu(i())]:t}).flat(10)}function Lu(n,t){let e=qt.fromSchema(t).serializeFragment(n),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(e),r.innerHTML}function og(n){return typeof n=="function"}function we(n,t=void 0,...e){return og(n)?t?n.bind(t)(...e):n(...e):n}function lM(n={}){return Object.keys(n).length===0&&n.constructor===Object}function er(n){let t=n.filter(r=>r.type==="extension"),e=n.filter(r=>r.type==="node"),i=n.filter(r=>r.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:i}}function sg(n){let t=[],{nodeExtensions:e,markExtensions:i}=er(n),r=[...e,...i],o={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(s=>{let a={name:s.name,options:s.options,storage:s.storage,extensions:r},l=Q(s,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,p])=>{t.push({type:d,name:h,attribute:{...o,...p}})})})})}),r.forEach(s=>{let a={name:s.name,options:s.options,storage:s.storage},l=Q(s,"addAttributes",a);if(!l)return;let c=l();Object.entries(c).forEach(([u,d])=>{let h={...o,...d};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,t.push({type:s.name,name:u,attribute:h})})}),t}function he(...n){return n.filter(t=>!!t).reduce((t,e)=>{let i={...t};return Object.entries(e).forEach(([r,o])=>{if(!i[r]){i[r]=o;return}if(r==="class"){let a=o?String(o).split(" "):[],l=i[r]?i[r].split(" "):[],c=a.filter(u=>!l.includes(u));i[r]=[...l,...c].join(" ")}else if(r==="style"){let a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],l=i[r]?i[r].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{let[d,h]=u.split(":").map(p=>p.trim());c.set(d,h)}),a.forEach(u=>{let[d,h]=u.split(":").map(p=>p.trim());c.set(d,h)}),i[r]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else i[r]=o}),i},{})}function Ps(n,t){return t.filter(e=>e.type===n.type.name).filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(n.attrs)||{}:{[e.name]:n.attrs[e.name]}).reduce((e,i)=>he(e,i),{})}function cM(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function Km(n,t){return"style"in n?n:{...n,getAttrs:e=>{let i=n.getAttrs?n.getAttrs(e):n.attrs;if(i===!1)return!1;let r=t.reduce((o,s)=>{let a=s.attribute.parseHTML?s.attribute.parseHTML(e):cM(e.getAttribute(s.name));return a==null?o:{...o,[s.name]:a}},{});return{...i,...r}}}}function qm(n){return Object.fromEntries(Object.entries(n).filter(([t,e])=>t==="attrs"&&lM(e)?!1:e!=null))}function Gm(n){var t,e;let i={};return!((t=n==null?void 0:n.attribute)!=null&&t.isRequired)&&"default"in((n==null?void 0:n.attribute)||{})&&(i.default=n.attribute.default),((e=n==null?void 0:n.attribute)==null?void 0:e.validate)!==void 0&&(i.validate=n.attribute.validate),[n.name,i]}function uM(n,t){var e;let i=sg(n),{nodeExtensions:r,markExtensions:o}=er(n),s=(e=r.find(c=>Q(c,"topNode")))==null?void 0:e.name,a=Object.fromEntries(r.map(c=>{let u=i.filter(b=>b.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:t},h=n.reduce((b,y)=>{let v=Q(y,"extendNodeSchema",d);return{...b,...v?v(c):{}}},{}),p=qm({...h,content:we(Q(c,"content",d)),marks:we(Q(c,"marks",d)),group:we(Q(c,"group",d)),inline:we(Q(c,"inline",d)),atom:we(Q(c,"atom",d)),selectable:we(Q(c,"selectable",d)),draggable:we(Q(c,"draggable",d)),code:we(Q(c,"code",d)),whitespace:we(Q(c,"whitespace",d)),linebreakReplacement:we(Q(c,"linebreakReplacement",d)),defining:we(Q(c,"defining",d)),isolating:we(Q(c,"isolating",d)),attrs:Object.fromEntries(u.map(Gm))}),f=we(Q(c,"parseHTML",d));f&&(p.parseDOM=f.map(b=>Km(b,u)));let g=Q(c,"renderHTML",d);g&&(p.toDOM=b=>g({node:b,HTMLAttributes:Ps(b,u)}));let m=Q(c,"renderText",d);return m&&(p.toText=m),[c.name,p]})),l=Object.fromEntries(o.map(c=>{let u=i.filter(m=>m.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:t},h=n.reduce((m,b)=>{let y=Q(b,"extendMarkSchema",d);return{...m,...y?y(c):{}}},{}),p=qm({...h,inclusive:we(Q(c,"inclusive",d)),excludes:we(Q(c,"excludes",d)),group:we(Q(c,"group",d)),spanning:we(Q(c,"spanning",d)),code:we(Q(c,"code",d)),attrs:Object.fromEntries(u.map(Gm))}),f=we(Q(c,"parseHTML",d));f&&(p.parseDOM=f.map(m=>Km(m,u)));let g=Q(c,"renderHTML",d);return g&&(p.toDOM=m=>g({mark:m,HTMLAttributes:Ps(m,u)})),[c.name,p]}));return new Oi({topNode:s,nodes:a,marks:l})}function dM(n){let t=n.filter((e,i)=>n.indexOf(e)!==i);return Array.from(new Set(t))}function Ru(n){return n.sort((e,i)=>{let r=Q(e,"priority")||100,o=Q(i,"priority")||100;return r>o?-1:r<o?1:0})}function ag(n){let t=Ru(Cu(n)),e=dM(t.map(i=>i.name));return e.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${e.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),t}function lg(n,t,e){let{from:i,to:r}=t,{blockSeparator:o=`

`,textSerializers:s={}}=e||{},a="";return n.nodesBetween(i,r,(l,c,u,d)=>{var h;l.isBlock&&c>i&&(a+=o);let p=s==null?void 0:s[l.type.name];if(p)return u&&(a+=p({node:l,pos:c,parent:u,index:d,range:t})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)==null?void 0:h.slice(Math.max(i,c)-c,r-c))}),a}function hM(n,t){let e={from:0,to:n.content.size};return lg(n,e,t)}function cg(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}function pM(n,t){let e=Pe(t,n.schema),{from:i,to:r}=n.selection,o=[];n.doc.nodesBetween(i,r,a=>{o.push(a)});let s=o.reverse().find(a=>a.type.name===e.name);return s?{...s.attrs}:{}}function Au(n,t){let e=Ds(typeof t=="string"?t:t.name,n.schema);return e==="node"?pM(n,t):e==="mark"?ig(n,t):{}}function fM(n,t=JSON.stringify){let e={};return n.filter(i=>{let r=t(i);return Object.prototype.hasOwnProperty.call(e,r)?!1:e[r]=!0})}function mM(n){let t=fM(n);return t.length===1?t:t.filter((e,i)=>!t.filter((o,s)=>s!==i).some(o=>e.oldRange.from>=o.oldRange.from&&e.oldRange.to<=o.oldRange.to&&e.newRange.from>=o.newRange.from&&e.newRange.to<=o.newRange.to))}function Iu(n){let{mapping:t,steps:e}=n,i=[];return t.maps.forEach((r,o)=>{let s=[];if(r.ranges.length)r.forEach((a,l)=>{s.push({from:a,to:l})});else{let{from:a,to:l}=e[o];if(a===void 0||l===void 0)return;s.push({from:a,to:l})}s.forEach(({from:a,to:l})=>{let c=t.slice(o).map(a,-1),u=t.slice(o).map(l),d=t.invert().map(c,-1),h=t.invert().map(u);i.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),mM(i)}function Hs(n,t,e){let i=[];return n===t?e.resolve(n).marks().forEach(r=>{let o=e.resolve(n),s=Su(o,r.type);s&&i.push({mark:r,...s})}):e.nodesBetween(n,t,(r,o)=>{!r||(r==null?void 0:r.nodeSize)===void 0||i.push(...r.marks.map(s=>({from:o,to:o+r.nodeSize,mark:s})))}),i}var ug=(n,t,e,i=20)=>{let r=n.doc.resolve(e),o=i,s=null;for(;o>0&&s===null;){let a=r.node(o);(a==null?void 0:a.type.name)===t?s=a:o-=1}return[s,o]};function bu(n,t){return t.nodes[n]||t.marks[n]||null}function Is(n,t,e){return Object.fromEntries(Object.entries(e).filter(([i])=>{let r=n.find(o=>o.type===t&&o.name===i);return r?r.attribute.keepOnSplit:!1}))}var gM=(n,t=500)=>{let e="",i=n.parentOffset;return n.parent.nodesBetween(Math.max(0,i-t),i,(r,o,s,a)=>{var l,c;let u=((c=(l=r.type.spec).toText)==null?void 0:c.call(l,{node:r,pos:o,parent:s,index:a}))||r.textContent||"%leaf%";e+=r.isAtom&&!r.isText?u:u.slice(0,Math.max(0,i-o))}),e};function xu(n,t,e={}){let{empty:i,ranges:r}=n.selection,o=t?xn(t,n.schema):null;if(i)return!!(n.storedMarks||n.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>Ns(d.attrs,e,{strict:!1}));let s=0,a=[];if(r.forEach(({$from:d,$to:h})=>{let p=d.pos,f=h.pos;n.doc.nodesBetween(p,f,(g,m)=>{if(!g.isText&&!g.marks.length)return;let b=Math.max(p,m),y=Math.min(f,m+g.nodeSize),v=y-b;s+=v,a.push(...g.marks.map(E=>({mark:E,from:b,to:y})))})}),s===0)return!1;let l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>Ns(d.mark.attrs,e,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=s}function bM(n,t,e={}){if(!t)return tn(n,null,e)||xu(n,null,e);let i=Ds(t,n.schema);return i==="node"?tn(n,t,e):i==="mark"?xu(n,t,e):!1}var dg=(n,t)=>{let{$from:e,$to:i,$anchor:r}=n.selection;if(t){let o=Fs(a=>a.type.name===t)(n.selection);if(!o)return!1;let s=n.doc.resolve(o.pos+1);return r.pos+1===s.end()}return!(i.parentOffset<i.parent.nodeSize-2||e.pos!==i.pos)},hg=n=>{let{$from:t,$to:e}=n.selection;return!(t.parentOffset>0||t.pos!==e.pos)};function jm(n,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===n.name):t}function Ym(n,t){let{nodeExtensions:e}=er(t),i=e.find(s=>s.name===n);if(!i)return!1;let r={name:i.name,options:i.options,storage:i.storage},o=we(Q(i,"group",r));return typeof o!="string"?!1:o.split(" ").includes("list")}function Gr(n,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var i;if(e){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((i=n.text)!=null?i:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let r=!0;return n.content.forEach(o=>{r!==!1&&(Gr(o,{ignoreWhitespace:e,checkChildren:t})||(r=!1))}),r}return!1}function zs(n){return n instanceof Y}var pg=class fg{constructor(t){this.position=t}static fromJSON(t){return new fg(t.position)}toJSON(){return{position:this.position}}};function yM(n,t){let e=t.mapping.mapResult(n.position);return{position:new pg(e.pos),mapResult:e}}function vM(n){return new pg(n)}function EM(n,t,e){var i;let{selection:r}=t,o=null;if(Qm(r)&&(o=r.$cursor),o){let a=(i=n.storedMarks)!=null?i:o.marks();return o.parent.type.allowsMarkType(e)&&(!!e.isInSet(a)||!a.some(c=>c.type.excludes(e)))}let{ranges:s}=r;return s.some(({$from:a,$to:l})=>{let c=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){let p=!h||h.type.allowsMarkType(e),f=!!e.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(e));c=p&&f}return!c}),c})}var xM=(n,t={})=>({tr:e,state:i,dispatch:r})=>{let{selection:o}=e,{empty:s,ranges:a}=o,l=xn(n,i.schema);if(r)if(s){let c=ig(i,l);e.addStoredMark(l.create({...c,...t}))}else a.forEach(c=>{let u=c.$from.pos,d=c.$to.pos;i.doc.nodesBetween(u,d,(h,p)=>{let f=Math.max(p,u),g=Math.min(p+h.nodeSize,d);h.marks.find(b=>b.type===l)?h.marks.forEach(b=>{l===b.type&&e.addMark(f,g,l.create({...b.attrs,...t}))}):e.addMark(f,g,l.create(t))})});return EM(i,e,l)},kM=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),wM=(n,t={})=>({state:e,dispatch:i,chain:r})=>{let o=Pe(n,e.schema),s;return e.selection.$anchor.sameParent(e.selection.$head)&&(s=e.selection.$anchor.parent.attrs),o.isTextblock?r().command(({commands:a})=>Dc(o,{...s,...t})(e)?!0:a.clearNodes()).command(({state:a})=>Dc(o,{...s,...t})(a,i)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},SM=n=>({tr:t,dispatch:e})=>{if(e){let{doc:i}=t,r=Ei(n,0,i.content.size),o=Y.create(i,r);t.setSelection(o)}return!0},MM=(n,t)=>({tr:e,state:i,dispatch:r})=>{let{selection:o}=i,s,a;return typeof t=="number"?(s=t,a=t):t&&"from"in t&&"to"in t?(s=t.from,a=t.to):(s=o.from,a=o.to),r&&e.doc.nodesBetween(s,a,(l,c)=>{l.isText||e.setNodeMarkup(c,void 0,{...l.attrs,dir:n})}),!0},TM=n=>({tr:t,dispatch:e})=>{if(e){let{doc:i}=t,{from:r,to:o}=typeof n=="number"?{from:n,to:n}:n,s=j.atStart(i).from,a=j.atEnd(i).to,l=Ei(r,s,a),c=Ei(o,s,a),u=j.create(i,l,c);t.setSelection(u)}return!0},CM=n=>({state:t,dispatch:e})=>{let i=Pe(n,t.schema);return If(i)(t,e)};function Xm(n,t){let e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){let i=e.filter(r=>t==null?void 0:t.includes(r.type.name));n.tr.ensureMarks(i)}}var LM=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:i,editor:r})=>{let{selection:o,doc:s}=t,{$from:a,$to:l}=o,c=r.extensionManager.attributes,u=Is(c,a.node().type.name,a.node().attrs);if(o instanceof Y&&o.node.isBlock)return!a.parentOffset||!Lt(s,a.pos)?!1:(i&&(n&&Xm(e,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;let d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:sM(a.node(-1).contentMatchAt(a.indexAfter(-1))),p=d&&h?[{type:h,attrs:u}]:void 0,f=Lt(t.doc,t.mapping.map(a.pos),1,p);if(!p&&!f&&Lt(t.doc,t.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(f=!0,p=h?[{type:h,attrs:u}]:void 0),i){if(f&&(o instanceof j&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,p),h&&!d&&!a.parentOffset&&a.parent.type!==h)){let g=t.mapping.map(a.before()),m=t.doc.resolve(g);a.node(-1).canReplaceWith(m.index(),m.index()+1,h)&&t.setNodeMarkup(t.mapping.map(a.before()),h)}n&&Xm(e,r.extensionManager.splittableMarks),t.scrollIntoView()}return f},RM=(n,t={})=>({tr:e,state:i,dispatch:r,editor:o})=>{var s;let a=Pe(n,i.schema),{$from:l,$to:c}=i.selection,u=i.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;let d=l.node(-1);if(d.type!==a)return!1;let h=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let b=z.empty,y=l.index(-1)?1:l.index(-2)?2:3;for(let w=l.depth-y;w>=l.depth-3;w-=1)b=z.from(l.node(w).copy(b));let v=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,E={...Is(h,l.node().type.name,l.node().attrs),...t},x=((s=a.contentMatch.defaultType)==null?void 0:s.createAndFill(E))||void 0;b=b.append(z.from(a.createAndFill(null,x)||void 0));let k=l.before(l.depth-(y-1));e.replace(k,l.after(-v),new q(b,4-y,0));let S=-1;e.doc.nodesBetween(k,e.doc.content.size,(w,C)=>{if(S>-1)return!1;w.isTextblock&&w.content.size===0&&(S=C+1)}),S>-1&&e.setSelection(j.near(e.doc.resolve(S))),e.scrollIntoView()}return!0}let p=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,f={...Is(h,d.type.name,d.attrs),...t},g={...Is(h,l.node().type.name,l.node().attrs),...t};e.delete(l.pos,c.pos);let m=p?[{type:a,attrs:f},{type:p,attrs:g}]:[{type:a,attrs:f}];if(!Lt(e.doc,l.pos,2))return!1;if(r){let{selection:b,storedMarks:y}=i,{splittableMarks:v}=o.extensionManager,E=y||b.$to.parentOffset&&b.$from.marks();if(e.split(l.pos,2,m).scrollIntoView(),!E||!r)return!0;let x=E.filter(k=>v.includes(k.type.name));e.ensureMarks(x)}return!0},yu=(n,t)=>{let e=Fs(s=>s.type===t)(n.selection);if(!e)return!0;let i=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(i===void 0)return!0;let r=n.doc.nodeAt(i);return e.node.type===(r==null?void 0:r.type)&&Pt(n.doc,e.pos)&&n.join(e.pos),!0},vu=(n,t)=>{let e=Fs(s=>s.type===t)(n.selection);if(!e)return!0;let i=n.doc.resolve(e.start).after(e.depth);if(i===void 0)return!0;let r=n.doc.nodeAt(i);return e.node.type===(r==null?void 0:r.type)&&Pt(n.doc,i)&&n.join(i),!0},AM=(n,t,e,i={})=>({editor:r,tr:o,state:s,dispatch:a,chain:l,commands:c,can:u})=>{let{extensions:d,splittableMarks:h}=r.extensionManager,p=Pe(n,s.schema),f=Pe(t,s.schema),{selection:g,storedMarks:m}=s,{$from:b,$to:y}=g,v=b.blockRange(y),E=m||g.$to.parentOffset&&g.$from.marks();if(!v)return!1;let x=Fs(k=>Ym(k.type.name,d))(g);if(v.depth>=1&&x&&v.depth-x.depth<=1){if(x.node.type===p)return c.liftListItem(f);if(Ym(x.node.type.name,d)&&p.validContent(x.node.content)&&a)return l().command(()=>(o.setNodeMarkup(x.pos,p),!0)).command(()=>yu(o,p)).command(()=>vu(o,p)).run()}return!e||!E||!a?l().command(()=>u().wrapInList(p,i)?!0:c.clearNodes()).wrapInList(p,i).command(()=>yu(o,p)).command(()=>vu(o,p)).run():l().command(()=>{let k=u().wrapInList(p,i),S=E.filter(w=>h.includes(w.type.name));return o.ensureMarks(S),k?!0:c.clearNodes()}).wrapInList(p,i).command(()=>yu(o,p)).command(()=>vu(o,p)).run()},IM=(n,t={},e={})=>({state:i,commands:r})=>{let{extendEmptyMarkRange:o=!1}=e,s=xn(n,i.schema);return xu(i,s,t)?r.unsetMark(s,{extendEmptyMarkRange:o}):r.setMark(s,t)},NM=(n,t,e={})=>({state:i,commands:r})=>{let o=Pe(n,i.schema),s=Pe(t,i.schema),a=tn(i,o,e),l;return i.selection.$anchor.sameParent(i.selection.$head)&&(l=i.selection.$anchor.parent.attrs),a?r.setNode(s,l):r.setNode(o,{...l,...e})},PM=(n,t={})=>({state:e,commands:i})=>{let r=Pe(n,e.schema);return tn(e,r,t)?i.lift(r):i.wrapIn(r,t)},_M=()=>({state:n,dispatch:t})=>{let e=n.plugins;for(let i=0;i<e.length;i+=1){let r=e[i],o;if(r.spec.isInputRules&&(o=r.getState(n))){if(t){let s=n.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)s.step(a.steps[l].invert(a.docs[l]));if(o.text){let l=s.doc.resolve(o.from).marks();s.replaceWith(o.from,o.to,n.schema.text(o.text,l))}else s.delete(o.from,o.to)}return!0}}return!1},OM=()=>({tr:n,dispatch:t})=>{let{selection:e}=n,{empty:i,ranges:r}=e;return i||t&&r.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},DM=(n,t={})=>({tr:e,state:i,dispatch:r})=>{var o;let{extendEmptyMarkRange:s=!1}=t,{selection:a}=e,l=xn(n,i.schema),{$from:c,empty:u,ranges:d}=a;if(!r)return!0;if(u&&s){let{from:h,to:p}=a,f=(o=c.marks().find(m=>m.type===l))==null?void 0:o.attrs,g=Su(c,l,f);g&&(h=g.from,p=g.to),e.removeMark(h,p,l)}else d.forEach(h=>{e.removeMark(h.$from.pos,h.$to.pos,l)});return e.removeStoredMark(l),!0},BM=n=>({tr:t,state:e,dispatch:i})=>{let{selection:r}=e,o,s;return typeof n=="number"?(o=n,s=n):n&&"from"in n&&"to"in n?(o=n.from,s=n.to):(o=r.from,s=r.to),i&&t.doc.nodesBetween(o,s,(a,l)=>{if(a.isText)return;let c={...a.attrs};delete c.dir,t.setNodeMarkup(l,void 0,c)}),!0},FM=(n,t={})=>({tr:e,state:i,dispatch:r})=>{let o=null,s=null,a=Ds(typeof n=="string"?n:n.name,i.schema);if(!a)return!1;a==="node"&&(o=Pe(n,i.schema)),a==="mark"&&(s=xn(n,i.schema));let l=!1;return e.selection.ranges.forEach(c=>{let u=c.$from.pos,d=c.$to.pos,h,p,f,g;e.selection.empty?i.doc.nodesBetween(u,d,(m,b)=>{o&&o===m.type&&(l=!0,f=Math.max(b,u),g=Math.min(b+m.nodeSize,d),h=b,p=m)}):i.doc.nodesBetween(u,d,(m,b)=>{b<u&&o&&o===m.type&&(l=!0,f=Math.max(b,u),g=Math.min(b+m.nodeSize,d),h=b,p=m),b>=u&&b<=d&&(o&&o===m.type&&(l=!0,r&&e.setNodeMarkup(b,void 0,{...m.attrs,...t})),s&&m.marks.length&&m.marks.forEach(y=>{if(s===y.type&&(l=!0,r)){let v=Math.max(b,u),E=Math.min(b+m.nodeSize,d);e.addMark(v,E,s.create({...y.attrs,...t}))}}))}),p&&(h!==void 0&&r&&e.setNodeMarkup(h,void 0,{...p.attrs,...t}),s&&p.marks.length&&p.marks.forEach(m=>{s===m.type&&r&&e.addMark(f,g,s.create({...m.attrs,...t}))}))}),l},HM=(n,t={})=>({state:e,dispatch:i})=>{let r=Pe(n,e.schema);return Lf(r,t)(e,i)},zM=(n,t={})=>({state:e,dispatch:i})=>{let r=Pe(n,e.schema);return Rf(r,t)(e,i)},VM=class{constructor(){this.callbacks={}}on(n,t){return this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push(t),this}emit(n,...t){let e=this.callbacks[n];return e&&e.forEach(i=>i.apply(this,t)),this}off(n,t){let e=this.callbacks[n];return e&&(t?this.callbacks[n]=e.filter(i=>i!==t):delete this.callbacks[n]),this}once(n,t){let e=(...i)=>{this.off(n,e),t.apply(this,i)};return this.on(n,e)}removeAllListeners(){this.callbacks={}}},tr=class{constructor(n){var t;this.find=n.find,this.handler=n.handler,this.undoable=(t=n.undoable)!=null?t:!0}},$M=(n,t)=>{if(wu(t))return t.exec(n);let e=t(n);if(!e)return null;let i=[e.text];return i.index=e.index,i.input=n,i.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),i.push(e.replaceWith)),i};function Ls(n){var t;let{editor:e,from:i,to:r,text:o,rules:s,plugin:a}=n,{view:l}=e;if(l.composing)return!1;let c=l.state.doc.resolve(i);if(c.parent.type.spec.code||(t=c.nodeBefore||c.nodeAfter)!=null&&t.marks.find(h=>h.type.spec.code))return!1;let u=!1,d=gM(c)+o;return s.forEach(h=>{if(u)return;let p=$M(d,h.find);if(!p)return;let f=l.state.tr,g=_s({state:l.state,transaction:f}),m={from:i-(p[0].length-o.length),to:r},{commands:b,chain:y,can:v}=new Os({editor:e,state:g});h.handler({state:g,range:m,match:p,commands:b,chain:y,can:v})===null||!f.steps.length||(h.undoable&&f.setMeta(a,{transform:f,from:i,to:r,text:o}),l.dispatch(f),u=!0)}),u}function WM(n){let{editor:t,rules:e}=n,i=new X({state:{init(){return null},apply(r,o,s){let a=r.getMeta(i);if(a)return a;let l=r.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=Lu(z.from(u),s.schema);let{from:d}=l,h=d+u.length;Ls({editor:t,from:d,to:h,text:u,rules:e,plugin:i})}),r.selectionSet||r.docChanged?null:o}},props:{handleTextInput(r,o,s,a){return Ls({editor:t,from:o,to:s,text:a,rules:e,plugin:i})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{let{$cursor:o}=r.state.selection;o&&Ls({editor:t,from:o.pos,to:o.pos,text:"",rules:e,plugin:i})}),!1)},handleKeyDown(r,o){if(o.key!=="Enter")return!1;let{$cursor:s}=r.state.selection;return s?Ls({editor:t,from:s.pos,to:s.pos,text:`
`,rules:e,plugin:i}):!1}},isInputRules:!0});return i}function UM(n){return Object.prototype.toString.call(n).slice(8,-1)}function Rs(n){return UM(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function mg(n,t){let e={...n};return Rs(n)&&Rs(t)&&Object.keys(t).forEach(i=>{Rs(t[i])&&Rs(n[i])?e[i]=mg(n[i],t[i]):e[i]=t[i]}),e}var Nu=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...we(Q(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...we(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){let t=this.extend({...this.config,addOptions:()=>mg(this.options,n)});return t.name=this.name,t.parent=this.parent,t}extend(n={}){let t=new this.constructor({...this.config,...n});return t.parent=this,this.child=t,t.name="name"in n?n.name:t.parent.name,t}},De=class gg extends Nu{constructor(){super(...arguments),this.type="mark"}static create(t={}){let e=typeof t=="function"?t():t;return new gg(e)}static handleExit({editor:t,mark:e}){let{tr:i}=t.state,r=t.state.selection.$from;if(r.pos===r.end()){let s=r.marks();if(!!!s.find(c=>(c==null?void 0:c.type.name)===e.name))return!1;let l=s.find(c=>(c==null?void 0:c.type.name)===e.name);return l&&i.removeStoredMark(l),i.insertText(" ",r.pos),t.view.dispatch(i),!0}return!1}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}};function KM(n){return typeof n=="number"}var qM=class{constructor(n){this.find=n.find,this.handler=n.handler}},GM=(n,t,e)=>{if(wu(t))return[...n.matchAll(t)];let i=t(n,e);return i?i.map(r=>{let o=[r.text];return o.index=r.index,o.input=n,o.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(r.replaceWith)),o}):[]};function jM(n){let{editor:t,state:e,from:i,to:r,rule:o,pasteEvent:s,dropEvent:a}=n,{commands:l,chain:c,can:u}=new Os({editor:t,state:e}),d=[];return e.doc.nodesBetween(i,r,(p,f)=>{var g,m,b,y,v;if((m=(g=p.type)==null?void 0:g.spec)!=null&&m.code||!(p.isText||p.isTextblock||p.isInline))return;let E=(v=(y=(b=p.content)==null?void 0:b.size)!=null?y:p.nodeSize)!=null?v:0,x=Math.max(i,f),k=Math.min(r,f+E);if(x>=k)return;let S=p.isText?p.text||"":p.textBetween(x-f,k-f,void 0,"\uFFFC");GM(S,o.find,s).forEach(C=>{if(C.index===void 0)return;let I=x+C.index+1,F=I+C[0].length,N={from:e.tr.mapping.map(I),to:e.tr.mapping.map(F)},H=o.handler({state:e,range:N,match:C,commands:l,chain:c,can:u,pasteEvent:s,dropEvent:a});d.push(H)})}),d.every(p=>p!==null)}var As=null,YM=n=>{var t;let e=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=e.clipboardData)==null||t.setData("text/html",n),e};function XM(n){let{editor:t,rules:e}=n,i=null,r=!1,o=!1,s=typeof ClipboardEvent!="undefined"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent!="undefined"?new DragEvent("drop"):null}catch(u){a=null}let l=({state:u,from:d,to:h,rule:p,pasteEvt:f})=>{let g=u.tr,m=_s({state:u,transaction:g});if(!(!jM({editor:t,state:m,from:Math.max(d-1,0),to:h.b-1,rule:p,pasteEvent:f,dropEvent:a})||!g.steps.length)){try{a=typeof DragEvent!="undefined"?new DragEvent("drop"):null}catch(y){a=null}return s=typeof ClipboardEvent!="undefined"?new ClipboardEvent("paste"):null,g}};return e.map(u=>new X({view(d){let h=f=>{var g;i=(g=d.dom.parentElement)!=null&&g.contains(f.target)?d.dom.parentElement:null,i&&(As=t)},p=()=>{As&&(As=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(d,h)=>{if(o=i===d.dom.parentElement,a=h,!o){let p=As;p!=null&&p.isEditable&&setTimeout(()=>{let f=p.state.selection;f&&p.commands.deleteRange({from:f.from,to:f.to})},10)}return!1},paste:(d,h)=>{var p;let f=(p=h.clipboardData)==null?void 0:p.getData("text/html");return s=h,r=!!(f!=null&&f.includes("data-pm-slice")),!1}}},appendTransaction:(d,h,p)=>{let f=d[0],g=f.getMeta("uiEvent")==="paste"&&!r,m=f.getMeta("uiEvent")==="drop"&&!o,b=f.getMeta("applyPasteRules"),y=!!b;if(!g&&!m&&!y)return;if(y){let{text:x}=b;typeof x=="string"?x=x:x=Lu(z.from(x),p.schema);let{from:k}=b,S=k+x.length,w=YM(x);return l({rule:u,state:p,from:k,to:{b:S},pasteEvt:w})}let v=h.doc.content.findDiffStart(p.doc.content),E=h.doc.content.findDiffEnd(p.doc.content);if(!(!KM(v)||!E||v===E.b))return l({rule:u,state:p,from:v,to:E,pasteEvt:s})}}))}var Vs=class{constructor(n,t){this.splittableMarks=[],this.editor=t,this.baseExtensions=n,this.extensions=ag(n),this.schema=uM(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((n,t)=>{let e={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:bu(t.name,this.schema)},i=Q(t,"addCommands",e);return i?{...n,...i()}:n},{})}get plugins(){let{editor:n}=this;return Ru([...this.extensions].reverse()).flatMap(i=>{let r={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:n,type:bu(i.name,this.schema)},o=[],s=Q(i,"addKeyboardShortcuts",r),a={};if(i.type==="mark"&&Q(i,"exitable",r)&&(a.ArrowRight=()=>De.handleExit({editor:n,mark:i})),s){let h=Object.fromEntries(Object.entries(s()).map(([p,f])=>[p,()=>f({editor:n})]));a={...a,...h}}let l=$m(a);o.push(l);let c=Q(i,"addInputRules",r);if(jm(i,n.options.enableInputRules)&&c){let h=c();if(h&&h.length){let p=WM({editor:n,rules:h}),f=Array.isArray(p)?p:[p];o.push(...f)}}let u=Q(i,"addPasteRules",r);if(jm(i,n.options.enablePasteRules)&&u){let h=u();if(h&&h.length){let p=XM({editor:n,rules:h});o.push(...p)}}let d=Q(i,"addProseMirrorPlugins",r);if(d){let h=d();o.push(...h)}return o})}get attributes(){return sg(this.extensions)}get nodeViews(){let{editor:n}=this,{nodeExtensions:t}=er(this.extensions);return Object.fromEntries(t.filter(e=>!!Q(e,"addNodeView")).map(e=>{let i=this.attributes.filter(l=>l.type===e.name),r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:n,type:Pe(e.name,this.schema)},o=Q(e,"addNodeView",r);if(!o)return[];let s=o();if(!s)return[];let a=(l,c,u,d,h)=>{let p=Ps(l,i);return s({node:l,view:c,getPos:u,decorations:d,innerDecorations:h,editor:n,extension:e,HTMLAttributes:p})};return[e.name,a]}))}get markViews(){let{editor:n}=this,{markExtensions:t}=er(this.extensions);return Object.fromEntries(t.filter(e=>!!Q(e,"addMarkView")).map(e=>{let i=this.attributes.filter(a=>a.type===e.name),r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:n,type:xn(e.name,this.schema)},o=Q(e,"addMarkView",r);if(!o)return[];let s=(a,l,c)=>{let u=Ps(a,i);return o()({mark:a,view:l,inline:c,editor:n,extension:e,HTMLAttributes:u,updateAttributes:d=>{cT(a,n,d)}})};return[e.name,s]}))}setupExtensions(){let n=this.extensions;this.editor.extensionStorage=Object.fromEntries(n.map(t=>[t.name,t.storage])),n.forEach(t=>{var e;let i={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:bu(t.name,this.schema)};t.type==="mark"&&((e=we(Q(t,"keepOnSplit",i)))==null||e)&&this.splittableMarks.push(t.name);let r=Q(t,"onBeforeCreate",i),o=Q(t,"onCreate",i),s=Q(t,"onUpdate",i),a=Q(t,"onSelectionUpdate",i),l=Q(t,"onTransaction",i),c=Q(t,"onFocus",i),u=Q(t,"onBlur",i),d=Q(t,"onDestroy",i);r&&this.editor.on("beforeCreate",r),o&&this.editor.on("create",o),s&&this.editor.on("update",s),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};Vs.resolve=ag;Vs.sort=Ru;Vs.flatten=Cu;var JM={};ku(JM,{ClipboardTextSerializer:()=>yg,Commands:()=>vg,Delete:()=>Eg,Drop:()=>xg,Editable:()=>kg,FocusEvents:()=>Sg,Keymap:()=>Mg,Paste:()=>Tg,Tabindex:()=>Cg,TextDirection:()=>Lg,focusEventsPluginKey:()=>wg});var ce=class bg extends Nu{constructor(){super(...arguments),this.type="extension"}static create(t={}){let e=typeof t=="function"?t():t;return new bg(e)}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}},yg=ce.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new X({key:new se("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:n}=this,{state:t,schema:e}=n,{doc:i,selection:r}=t,{ranges:o}=r,s=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),l=cg(e);return lg(i,{from:s,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),vg=ce.create({name:"commands",addCommands(){return{...Jm}}}),Eg=ce.create({name:"delete",onUpdate({transaction:n,appendedTransactions:t}){var e,i,r;let o=()=>{var s,a,l,c;if((c=(l=(a=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,n))!=null?c:n.getMeta("y-sync$"))return;let u=Tu(n.before,[n,...t]);Iu(u).forEach(p=>{u.mapping.mapResult(p.oldRange.from).deletedAfter&&u.mapping.mapResult(p.oldRange.to).deletedBefore&&u.before.nodesBetween(p.oldRange.from,p.oldRange.to,(f,g)=>{let m=g+f.nodeSize-2,b=p.oldRange.from<=g&&m<=p.oldRange.to;this.editor.emit("delete",{type:"node",node:f,from:g,to:m,newFrom:u.mapping.map(g),newTo:u.mapping.map(m),deletedRange:p.oldRange,newRange:p.newRange,partial:!b,editor:this.editor,transaction:n,combinedTransform:u})})});let h=u.mapping;u.steps.forEach((p,f)=>{var g,m;if(p instanceof fn){let b=h.slice(f).map(p.from,-1),y=h.slice(f).map(p.to),v=h.invert().map(b,-1),E=h.invert().map(y),x=(g=u.doc.nodeAt(b-1))==null?void 0:g.marks.some(S=>S.eq(p.mark)),k=(m=u.doc.nodeAt(y))==null?void 0:m.marks.some(S=>S.eq(p.mark));this.editor.emit("delete",{type:"mark",mark:p.mark,from:p.from,to:p.to,deletedRange:{from:v,to:E},newRange:{from:b,to:y},partial:!!(k||x),editor:this.editor,transaction:n,combinedTransform:u})}})};(r=(i=(e=this.editor.options.coreExtensionOptions)==null?void 0:e.delete)==null?void 0:i.async)==null||r?setTimeout(o,0):o()}}),xg=ce.create({name:"drop",addProseMirrorPlugins(){return[new X({key:new se("tiptapDrop"),props:{handleDrop:(n,t,e,i)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:i})}}})]}}),kg=ce.create({name:"editable",addProseMirrorPlugins(){return[new X({key:new se("editable"),props:{editable:()=>this.editor.options.editable}})]}}),wg=new se("focusEvents"),Sg=ce.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:n}=this;return[new X({key:wg,props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;let i=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,e)=>{n.isFocused=!1;let i=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),Mg=ce.create({name:"keymap",addKeyboardShortcuts(){let n=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:a})=>{let{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:p}=d,f=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,g=f.parent.type.spec.isolating,m=d.pos-d.parentOffset,b=g&&f.parent.childCount===1?m===d.pos:ie.atStart(c).from===h;return!u||!p.type.isTextblock||p.textContent.length||!b||b&&d.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),i={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},r={...i},o={...i,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Mu()||ng()?o:r},addProseMirrorPlugins(){return[new X({key:new se("clearDocument"),appendTransaction:(n,t,e)=>{if(n.some(g=>g.getMeta("composition")))return;let i=n.some(g=>g.docChanged)&&!t.doc.eq(e.doc),r=n.some(g=>g.getMeta("preventClearDocument"));if(!i||r)return;let{empty:o,from:s,to:a}=t.selection,l=ie.atStart(t.doc).from,c=ie.atEnd(t.doc).to;if(o||!(s===l&&a===c)||!Gr(e.doc))return;let h=e.tr,p=_s({state:e,transaction:h}),{commands:f}=new Os({editor:this.editor,state:p});if(f.clearNodes(),!!h.steps.length)return h}})]}}),Tg=ce.create({name:"paste",addProseMirrorPlugins(){return[new X({key:new se("tiptapPaste"),props:{handlePaste:(n,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),Cg=ce.create({name:"tabindex",addProseMirrorPlugins(){return[new X({key:new se("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Lg=ce.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:n}=er(this.extensions);return[{types:n.filter(t=>t.name!=="text").map(t=>t.name),attributes:{dir:{default:this.options.direction,parseHTML:t=>{let e=t.getAttribute("dir");return e&&(e==="ltr"||e==="rtl"||e==="auto")?e:this.options.direction},renderHTML:t=>t.dir?{dir:t.dir}:{}}}}]},addProseMirrorPlugins(){return[new X({key:new se("textDirection"),props:{attributes:()=>{let n=this.options.direction;return n?{dir:n}:{}}}})]}}),ZM=class Qi{constructor(t,e,i=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=i,this.resolvedPos=t,this.editor=e,this.currentNode=r}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!=null?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,i=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}e=this.from+1,i=this.to-1}this.editor.commands.insertContentAt({from:e,to:i},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;let t=this.resolvedPos.start(this.resolvedPos.depth-1),e=this.resolvedPos.doc.resolve(t);return new Qi(e,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new Qi(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new Qi(t,this.editor)}get children(){let t=[];return this.node.content.forEach((e,i)=>{let r=e.isBlock&&!e.isTextblock,o=e.isAtom&&!e.isText,s=this.pos+i+(o?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;let a=this.resolvedPos.doc.resolve(s);if(!r&&a.depth<=this.depth)return;let l=new Qi(a,this.editor,r,r?e:null);r&&(l.actualDepth=this.depth+1),t.push(new Qi(a,this.editor,r,r?e:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){let t=this.children;return t[t.length-1]||null}closest(t,e={}){let i=null,r=this.parent;for(;r&&!i;){if(r.node.type.name===t)if(Object.keys(e).length>0){let o=r.node.attrs,s=Object.keys(e);for(let a=0;a<s.length;a+=1){let l=s[a];if(o[l]!==e[l])break}}else i=r;r=r.parent}return i}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},i=!1){let r=[];if(!this.children||this.children.length===0)return r;let o=Object.keys(e);return this.children.forEach(s=>{i&&r.length>0||(s.node.type.name===t&&o.every(l=>e[l]===s.node.attrs[l])&&r.push(s),!(i&&r.length>0)&&(r=r.concat(s.querySelectorAll(t,e,i))))}),r}setAttribute(t){let{tr:e}=this.editor.state;e.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(e)}},QM=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function eT(n,t,e){let i=document.querySelector(`style[data-tiptap-style${e?`-${e}`:""}]`);if(i!==null)return i;let r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute(`data-tiptap-style${e?`-${e}`:""}`,""),r.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(r),r}var Rg=class extends VM{constructor(n={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document!="undefined"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:i})=>{throw i},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:yM,createMappablePosition:vM},this.setOptions(n),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:i,slice:r,moved:o})=>this.options.onDrop(i,r,o)),this.on("paste",({event:i,slice:r})=>this.options.onPaste(i,r)),this.on("delete",this.options.onDelete);let t=this.createDoc(),e=eg(t,this.options.autofocus);this.editorState=Jo.create({doc:t,schema:this.schema,selection:e||void 0}),this.options.element&&this.mount(this.options.element)}mount(n){if(typeof document=="undefined")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(n),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){let n=this.editorView.dom;n!=null&&n.editor&&delete n.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(n){console.warn("Failed to remove CSS element:",n)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document!="undefined"&&(this.css=eT(QM,this.options.injectNonce))}setOptions(n={}){this.options={...this.options,...n},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(n,t=!0){this.setOptions({editable:n}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:n=>{this.editorState=n},dispatch:n=>{this.dispatchTransaction(n)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(n,t)=>{if(this.editorView)return this.editorView[t];if(t==="state")return this.editorState;if(t in n)return Reflect.get(n,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(n,t){let e=og(t)?t(n,[...this.state.plugins]):[...this.state.plugins,n],i=this.state.reconfigure({plugins:e});return this.view.updateState(i),i}unregisterPlugin(n){if(this.isDestroyed)return;let t=this.state.plugins,e=t;if([].concat(n).forEach(r=>{let o=typeof r=="string"?`${r}$`:r.key;e=e.filter(s=>!s.key.startsWith(o))}),t.length===e.length)return;let i=this.state.reconfigure({plugins:e});return this.view.updateState(i),i}createExtensionManager(){var n,t;let i=[...this.options.enableCoreExtensions?[kg,yg.configure({blockSeparator:(t=(n=this.options.coreExtensionOptions)==null?void 0:n.clipboardTextSerializer)==null?void 0:t.blockSeparator}),vg,Sg,Mg,Cg,xg,Tg,Eg,Lg.configure({direction:this.options.textDirection})].filter(r=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[r.name]!==!1:!0):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new Vs(i,this)}createCommandManager(){this.commandManager=new Os({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let n;try{n=Eu(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(e=>e.name!=="collaboration"),this.createExtensionManager()}}),n=Eu(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return n}createView(n){var t;this.editorView=new Wr(n,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)==null?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});let e=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(e),this.prependClass(),this.injectCSS();let i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(n){this.isCapturingTransaction=!0,n(),this.isCapturingTransaction=!1;let t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(n){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=n;return}n.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}let{state:t,transactions:e}=this.state.applyTransaction(n),i=!this.state.selection.eq(t.selection),r=e.includes(n),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:n,nextState:t}),!r)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:n,appendedTransactions:e.slice(1)}),i&&this.emit("selectionUpdate",{editor:this,transaction:n});let s=e.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=s==null?void 0:s.getMeta("focus"),l=s==null?void 0:s.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(n.getMeta("preventUpdate")||!e.some(c=>c.docChanged)||o.doc.eq(t.doc))&&this.emit("update",{editor:this,transaction:n,appendedTransactions:e.slice(1)})}getAttributes(n){return Au(this.state,n)}isActive(n,t){let e=typeof n=="string"?n:null,i=typeof n=="string"?t:n;return bM(this.state,e,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Lu(this.state.doc.content,this.schema)}getText(n){let{blockSeparator:t=`

`,textSerializers:e={}}=n||{};return hM(this.state.doc,{blockSeparator:t,textSerializers:{...cg(this.schema),...e}})}get isEmpty(){return Gr(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var n,t;return(t=(n=this.editorView)==null?void 0:n.isDestroyed)!=null?t:!0}$node(n,t){var e;return((e=this.$doc)==null?void 0:e.querySelector(n,t))||null}$nodes(n,t){var e;return((e=this.$doc)==null?void 0:e.querySelectorAll(n,t))||null}$pos(n){let t=this.state.doc.resolve(n);return new ZM(t,this)}get $doc(){return this.$pos(0)}};function Ft(n){return new tr({find:n.find,handler:({state:t,range:e,match:i})=>{let r=we(n.getAttributes,void 0,i);if(r===!1||r===null)return null;let{tr:o}=t,s=i[i.length-1],a=i[0];if(s){let l=a.search(/\S/),c=e.from+a.indexOf(s),u=c+s.length;if(Hs(e.from,e.to,t.doc).filter(p=>p.mark.type.excluded.find(g=>g===n.type&&g!==p.mark.type)).filter(p=>p.to>c).length)return null;u<e.to&&o.delete(u,e.to),c>e.from&&o.delete(e.from+l,c);let h=e.from+l+s.length;o.addMark(e.from+l,h,n.type.create(r||{})),o.removeStoredMark(n.type)}},undoable:n.undoable})}function Ag(n){return new tr({find:n.find,handler:({state:t,range:e,match:i})=>{let r=we(n.getAttributes,void 0,i)||{},{tr:o}=t,s=e.from,a=e.to,l=n.type.create(r);if(i[1]){let c=i[0].lastIndexOf(i[1]),u=s+c;u>a?u=a:a=u+i[1].length;let d=i[0][i[0].length-1];o.insertText(d,s+i[0].length-1),o.replaceWith(u,a,l)}else if(i[0]){let c=n.type.isInline?s:s-1;o.insert(c,n.type.create(r)).delete(o.mapping.map(s),o.mapping.map(a))}o.scrollIntoView()},undoable:n.undoable})}function jr(n){return new tr({find:n.find,handler:({state:t,range:e,match:i})=>{let r=t.doc.resolve(e.from),o=we(n.getAttributes,void 0,i)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),n.type))return null;t.tr.delete(e.from,e.to).setBlockType(e.from,e.from,n.type,o)},undoable:n.undoable})}function nn(n){return new tr({find:n.find,handler:({state:t,range:e,match:i,chain:r})=>{let o=we(n.getAttributes,void 0,i)||{},s=t.tr.delete(e.from,e.to),l=s.doc.resolve(e.from).blockRange(),c=l&&Hi(l,n.type,o);if(!c)return null;if(s.wrap(l,c),n.keepMarks&&n.editor){let{selection:d,storedMarks:h}=t,{splittableMarks:p}=n.editor.extensionManager,f=h||d.$to.parentOffset&&d.$from.marks();if(f){let g=f.filter(m=>p.includes(m.type.name));s.ensureMarks(g)}}if(n.keepAttributes){let d=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(d,o).run()}let u=s.doc.resolve(e.from-1).nodeBefore;u&&u.type===n.type&&Pt(s.doc,e.from-1)&&(!n.joinPredicate||n.joinPredicate(i,u))&&s.join(e.from-1)},undoable:n.undoable})}function Ig(n,t){let{selection:e}=n,{$from:i}=e;if(e instanceof Y){let o=i.index();return i.parent.canReplaceWith(o,o+1,t)}let r=i.depth;for(;r>=0;){let o=i.index(r);if(i.node(r).contentMatchAt(o).matchType(t))return!0;r-=1}return!1}var tT={};ku(tT,{createAtomBlockMarkdownSpec:()=>nT,createBlockMarkdownSpec:()=>iT,createInlineMarkdownSpec:()=>sT,parseAttributes:()=>Pu,parseIndentedBlocks:()=>aT,renderNestedMarkdownContent:()=>lT,serializeAttributes:()=>_u});function Pu(n){if(!(n!=null&&n.trim()))return{};let t={},e=[],i=n.replace(/["']([^"']*)["']/g,c=>(e.push(c),`__QUOTED_${e.length-1}__`)),r=i.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(r){let c=r.map(u=>u.trim().slice(1));t.class=c.join(" ")}let o=i.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);o&&(t.id=o[1]);let s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(i.matchAll(s)).forEach(([,c,u])=>{var d;let h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),p=e[h];p&&(t[c]=p.slice(1,-1))});let l=i.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(t[u]=!0)}),t}function _u(n){if(!n||Object.keys(n).length===0)return"";let t=[];return n.class&&String(n.class).split(/\s+/).filter(Boolean).forEach(i=>t.push(`.${i}`)),n.id&&t.push(`#${n.id}`),Object.entries(n).forEach(([e,i])=>{e==="class"||e==="id"||(i===!0?t.push(e):i!==!1&&i!=null&&t.push(`${e}="${String(i)}"`))}),t.join(" ")}function nT(n){let{nodeName:t,name:e,parseAttributes:i=Pu,serializeAttributes:r=_u,defaultAttributes:o={},requiredAttributes:s=[],allowedAttributes:a}=n,l=e||t,c=u=>{if(!a)return u;let d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{let h={...o,...u.attributes};return d.createNode(t,h,[])},markdownTokenizer:{name:t,level:"block",start(u){var d;let h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),p=(d=u.match(h))==null?void 0:d.index;return p!==void 0?p:-1},tokenize(u,d,h){let p=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),f=u.match(p);if(!f)return;let g=f[1]||"",m=i(g);if(!s.find(y=>!(y in m)))return{type:t,raw:f[0],attributes:m}}},renderMarkdown:u=>{let d=c(u.attrs||{}),h=r(d),p=h?` {${h}}`:"";return`:::${l}${p} :::`}}}function iT(n){let{nodeName:t,name:e,getContent:i,parseAttributes:r=Pu,serializeAttributes:o=_u,defaultAttributes:s={},content:a="block",allowedAttributes:l}=n,c=e||t,u=d=>{if(!l)return d;let h={};return l.forEach(p=>{p in d&&(h[p]=d[p])}),h};return{parseMarkdown:(d,h)=>{let p;if(i){let g=i(d);p=typeof g=="string"?[{type:"text",text:g}]:g}else a==="block"?p=h.parseChildren(d.tokens||[]):p=h.parseInline(d.tokens||[]);let f={...s,...d.attributes};return h.createNode(t,f,p)},markdownTokenizer:{name:t,level:"block",start(d){var h;let p=new RegExp(`^:::${c}`,"m"),f=(h=d.match(p))==null?void 0:h.index;return f!==void 0?f:-1},tokenize(d,h,p){var f;let g=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),m=d.match(g);if(!m)return;let[b,y=""]=m,v=r(y),E=1,x=b.length,k="",S=/^:::([\w-]*)(\s.*)?/gm,w=d.slice(x);for(S.lastIndex=0;;){let C=S.exec(w);if(C===null)break;let I=C.index,F=C[1];if(!((f=C[2])!=null&&f.endsWith(":::"))){if(F)E+=1;else if(E-=1,E===0){let N=w.slice(0,I);k=N.trim();let H=d.slice(0,x+I+C[0].length),_=[];if(k)if(a==="block")for(_=p.blockTokens(N),_.forEach(P=>{P.text&&(!P.tokens||P.tokens.length===0)&&(P.tokens=p.inlineTokens(P.text))});_.length>0;){let P=_[_.length-1];if(P.type==="paragraph"&&(!P.text||P.text.trim()===""))_.pop();else break}else _=p.inlineTokens(k);return{type:t,raw:H,attributes:v,content:k,tokens:_}}}}}},renderMarkdown:(d,h)=>{let p=u(d.attrs||{}),f=o(p),g=f?` {${f}}`:"",m=h.renderChildren(d.content||[],`

`);return`:::${c}${g}

${m}

:::`}}}function rT(n){if(!n.trim())return{};let t={},e=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,i=e.exec(n);for(;i!==null;){let[,r,o,s]=i;t[r]=o||s,i=e.exec(n)}return t}function oT(n){return Object.entries(n).filter(([,t])=>t!=null).map(([t,e])=>`${t}="${e}"`).join(" ")}function sT(n){let{nodeName:t,name:e,getContent:i,parseAttributes:r=rT,serializeAttributes:o=oT,defaultAttributes:s={},selfClosing:a=!1,allowedAttributes:l}=n,c=e||t,u=h=>{if(!l)return h;let p={};return l.forEach(f=>{let g=typeof f=="string"?f:f.name,m=typeof f=="string"?void 0:f.skipIfDefault;if(g in h){let b=h[g];if(m!==void 0&&b===m)return;p[g]=b}}),p},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,p)=>{let f={...s,...h.attributes};if(a)return p.createNode(t,f);let g=i?i(h):h.content||"";return g?p.createNode(t,f,[p.createTextNode(g)]):p.createNode(t,f,[])},markdownTokenizer:{name:t,level:"inline",start(h){let p=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),f=h.match(p),g=f==null?void 0:f.index;return g!==void 0?g:-1},tokenize(h,p,f){let g=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),m=h.match(g);if(!m)return;let b="",y="";if(a){let[,E]=m;y=E}else{let[,E,x]=m;y=E,b=x||""}let v=r(y.trim());return{type:t,raw:m[0],content:b.trim(),attributes:v}}},renderMarkdown:h=>{let p="";i?p=i(h):h.content&&h.content.length>0&&(p=h.content.filter(b=>b.type==="text").map(b=>b.text).join(""));let f=u(h.attrs||{}),g=o(f),m=g?` ${g}`:"";return a?`[${c}${m}]`:`[${c}${m}]${p}[/${c}]`}}}function aT(n,t,e){var i,r,o,s;let a=n.split(`
`),l=[],c="",u=0,d=t.baseIndentSize||2;for(;u<a.length;){let h=a[u],p=h.match(t.itemPattern);if(!p){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}let f=t.extractItemData(p),{indentLevel:g,mainContent:m}=f;c=`${c}${h}
`;let b=[m];for(u+=1;u<a.length;){let x=a[u];if(x.trim()===""){let S=a.slice(u+1).findIndex(I=>I.trim()!=="");if(S===-1)break;if((((r=(i=a[u+1+S].match(/^(\s*)/))==null?void 0:i[1])==null?void 0:r.length)||0)>g){b.push(x),c=`${c}${x}
`,u+=1;continue}else break}if((((s=(o=x.match(/^(\s*)/))==null?void 0:o[1])==null?void 0:s.length)||0)>g)b.push(x),c=`${c}${x}
`,u+=1;else break}let y,v=b.slice(1);if(v.length>0){let x=v.map(k=>k.slice(g+d)).join(`
`);x.trim()&&(t.customNestedParser?y=t.customNestedParser(x):y=e.blockTokens(x))}let E=t.createToken(f,y);l.push(E)}if(l.length!==0)return{items:l,raw:c}}function lT(n,t,e,i){if(!n||!Array.isArray(n.content))return"";let r=typeof e=="function"?e(i):e,[o,...s]=n.content,a=t.renderChildren([o]),l=[`${r}${a}`];return s&&s.length>0&&s.forEach(c=>{let u=t.renderChildren([c]);if(u){let d=u.split(`
`).map(h=>h?t.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}function cT(n,t,e={}){let{state:i}=t,{doc:r,tr:o}=i,s=n;r.descendants((a,l)=>{let c=o.mapping.map(l),u=o.mapping.map(l)+a.nodeSize,d=null;if(a.marks.forEach(p=>{if(p!==s)return!1;d=p}),!d)return;let h=!1;if(Object.keys(e).forEach(p=>{e[p]!==d.attrs[p]&&(h=!0)}),h){let p=n.type.create({...n.attrs,...e});o.removeMark(c,u,n.type),o.addMark(c,u,p)}}),o.docChanged&&t.view.dispatch(o)}var xe=class Ng extends Nu{constructor(){super(...arguments),this.type="node"}static create(t={}){let e=typeof t=="function"?t():t;return new Ng(e)}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}};function xt(n){return new qM({find:n.find,handler:({state:t,range:e,match:i,pasteEvent:r})=>{let o=we(n.getAttributes,void 0,i,r);if(o===!1||o===null)return null;let{tr:s}=t,a=i[i.length-1],l=i[0],c=e.to;if(a){let u=l.search(/\S/),d=e.from+l.indexOf(a),h=d+a.length;if(Hs(e.from,e.to,t.doc).filter(f=>f.mark.type.excluded.find(m=>m===n.type&&m!==f.mark.type)).filter(f=>f.to>d).length)return null;h<e.to&&s.delete(h,e.to),d>e.from&&s.delete(e.from+u,d),c=e.from+u+a.length,s.addMark(e.from+u,c,n.type.create(o||{})),s.removeStoredMark(n.type)}}})}var nr=(n,t)=>{if(n==="slot")return 0;if(n instanceof Function)return n(t);let{children:e,...i}=t!=null?t:{};if(n==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[n,i,e]};var uT=/^\s*>\s$/,Ou=xe.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return nr("blockquote",{...he(this.options.HTMLAttributes,n),children:nr("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[nn({find:uT,type:this.type})]}}),Pg=Ou;var dT=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,hT=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,pT=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,fT=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Du=De.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return nr("strong",{...he(this.options.HTMLAttributes,n),children:nr("slot",{})})},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ft({find:dT,type:this.type}),Ft({find:pT,type:this.type})]},addPasteRules(){return[xt({find:hT,type:this.type}),xt({find:fT,type:this.type})]}}),_g=Du;var mT=/(^|[^`])`([^`]+)`(?!`)$/,gT=/(^|[^`])`([^`]+)`(?!`)/g,Bu=De.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",he(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ft({find:mT,type:this.type})]},addPasteRules(){return[xt({find:gT,type:this.type})]}}),Og=Bu;var bT=/^```([a-z]+)?[\s\n]$/,yT=/^~~~([a-z]+)?[\s\n]$/,Fu=xe.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var t;let{languageClassPrefix:e}=this.options,o=[...((t=n.firstElementChild)==null?void 0:t.classList)||[]].filter(s=>s.startsWith(e)).map(s=>s.replace(e,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:t}){return["pre",he(this.options.HTMLAttributes,t),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},addCommands(){return{setCodeBlock:n=>({commands:t})=>t.setNode(this.name,n),toggleCodeBlock:n=>({commands:t})=>t.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:n,$anchor:t}=this.editor.state.selection,e=t.pos===1;return!n||t.parent.type.name!==this.name?!1:e||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:n})=>{if(!this.options.enableTabIndentation)return!1;let{state:t}=n,{selection:e}=t,{$from:i,empty:r}=e;if(i.parent.type!==this.type)return!1;let o=" ".repeat(this.options.tabSize);return r?n.commands.insertContent(o):n.commands.command(({tr:s})=>{let{from:a,to:l}=e,d=t.doc.textBetween(a,l,`
`,`
`).split(`
`).map(h=>o+h).join(`
`);return s.replaceWith(a,l,t.schema.text(d)),!0})},"Shift-Tab":({editor:n})=>{if(!this.options.enableTabIndentation)return!1;let{state:t}=n,{selection:e}=t,{$from:i,empty:r}=e;return i.parent.type!==this.type?!1:r?n.commands.command(({tr:o})=>{var s;let{pos:a}=i,l=i.start(),c=i.end(),d=t.doc.textBetween(l,c,`
`,`
`).split(`
`),h=0,p=0,f=a-l;for(let E=0;E<d.length;E+=1){if(p+d[E].length>=f){h=E;break}p+=d[E].length+1}let m=((s=d[h].match(/^ */))==null?void 0:s[0])||"",b=Math.min(m.length,this.options.tabSize);if(b===0)return!0;let y=l;for(let E=0;E<h;E+=1)y+=d[E].length+1;return o.delete(y,y+b),a-y<=b&&o.setSelection(j.create(o.doc,y)),!0}):n.commands.command(({tr:o})=>{let{from:s,to:a}=e,u=t.doc.textBetween(s,a,`
`,`
`).split(`
`).map(d=>{var h;let p=((h=d.match(/^ */))==null?void 0:h[0])||"",f=Math.min(p.length,this.options.tabSize);return d.slice(f)}).join(`
`);return o.replaceWith(s,a,t.schema.text(u)),!0})},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:t}=n,{selection:e}=t,{$from:i,empty:r}=e;if(!r||i.parent.type!==this.type)return!1;let o=i.parentOffset===i.parent.nodeSize-2,s=i.parent.textContent.endsWith(`

`);return!o||!s?!1:n.chain().command(({tr:a})=>(a.delete(i.pos-2,i.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;let{state:t}=n,{selection:e,doc:i}=t,{$from:r,empty:o}=e;if(!o||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;let a=r.after();return a===void 0?!1:i.nodeAt(a)?n.commands.command(({tr:c})=>(c.setSelection(ie.near(i.resolve(a))),!0)):n.commands.exitCode()}}},addInputRules(){return[jr({find:bT,type:this.type,getAttributes:n=>({language:n[1]})}),jr({find:yT,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new X({key:new se("codeBlockVSCodeHandler"),props:{handlePaste:(n,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;let e=t.clipboardData.getData("text/plain"),i=t.clipboardData.getData("vscode-editor-data"),r=i?JSON.parse(i):void 0,o=r==null?void 0:r.mode;if(!e||!o)return!1;let{tr:s,schema:a}=n.state,l=a.text(e.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:o},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(j.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),n.dispatch(s),!0}}})]}}),Dg=Fu;var Hu=xe.create({name:"doc",topNode:!0,content:"block+"}),Bg=Hu;var zu=xe.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",he(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:t,state:e,editor:i})=>n.first([()=>n.exitCode(),()=>n.command(()=>{let{selection:r,storedMarks:o}=e;if(r.$from.parent.type.spec.isolating)return!1;let{keepMarks:s}=this.options,{splittableMarks:a}=i.extensionManager,l=o||r.$to.parentOffset&&r.$from.marks();return t().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&s){let d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Fg=zu;var Vu=xe.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:t}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,he(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.setNode(this.name,n):!1,toggleHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,t)=>({...n,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(n=>jr({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}}),Hg=Vu;var $u=xe.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",he(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:t})=>{if(!Ig(t,t.schema.nodes[this.name]))return!1;let{selection:e}=t,{$to:i}=e,r=n();return zs(e)?r.insertContentAt(i.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({tr:o,dispatch:s})=>{var a;if(s){let{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(j.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(Y.create(o.doc,l.pos)):o.setSelection(j.create(o.doc,l.pos));else{let u=(a=l.parent.type.contentMatch.defaultType)==null?void 0:a.create();u&&(o.insert(c,u),o.setSelection(j.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Ag({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),zg=$u;var vT=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,ET=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,xT=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,kT=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Wu=De.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",he(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ft({find:vT,type:this.type}),Ft({find:xT,type:this.type})]},addPasteRules(){return[xt({find:ET,type:this.type}),xt({find:kT,type:this.type})]}}),Vg=Wu;var wT="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5m\xF6gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",ST="\u03B5\u03BB1\u03C52\u0431\u04331\u0435\u043B3\u0434\u0435\u0442\u04384\u0435\u044E2\u043A\u0430\u0442\u043E\u043B\u0438\u043A6\u043E\u043C3\u043C\u043A\u04342\u043E\u043D1\u0441\u043A\u0432\u04306\u043E\u043D\u043B\u0430\u0439\u043D5\u0440\u04333\u0440\u0443\u04412\u04442\u0441\u0430\u0439\u04423\u0440\u04313\u0443\u043A\u04403\u049B\u0430\u04373\u0570\u0561\u05753\u05D9\u05E9\u05E8\u05D0\u05DC5\u05E7\u05D5\u05DD3\u0627\u0628\u0648\u0638\u0628\u064A5\u0631\u0627\u0645\u0643\u06485\u0644\u0627\u0631\u062F\u06464\u0628\u062D\u0631\u064A\u06465\u062C\u0632\u0627\u0626\u06315\u0633\u0639\u0648\u062F\u064A\u06296\u0639\u0644\u064A\u0627\u06465\u0645\u063A\u0631\u06285\u0645\u0627\u0631\u0627\u062A5\u06CC\u0631\u0627\u06465\u0628\u0627\u0631\u062A2\u0632\u0627\u06314\u064A\u062A\u06433\u06BE\u0627\u0631\u062A5\u062A\u0648\u0646\u06334\u0633\u0648\u062F\u0627\u06463\u0631\u064A\u06295\u0634\u0628\u0643\u06294\u0639\u0631\u0627\u06422\u06282\u0645\u0627\u06464\u0641\u0644\u0633\u0637\u064A\u06466\u0642\u0637\u06313\u0643\u0627\u062B\u0648\u0644\u064A\u06436\u0648\u06453\u0645\u0635\u06312\u0644\u064A\u0633\u064A\u06275\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u06277\u0642\u06394\u0647\u0645\u0631\u0627\u06475\u067E\u0627\u06A9\u0633\u062A\u0627\u06467\u0680\u0627\u0631\u062A4\u0915\u0949\u092E3\u0928\u0947\u091F3\u092D\u093E\u0930\u09240\u092E\u094D3\u094B\u09245\u0938\u0902\u0917\u0920\u09285\u09AC\u09BE\u0982\u09B2\u09BE5\u09AD\u09BE\u09B0\u09A42\u09F0\u09A44\u0A2D\u0A3E\u0A30\u0A244\u0AAD\u0ABE\u0AB0\u0AA44\u0B2D\u0B3E\u0B30\u0B244\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE6\u0BB2\u0B99\u0BCD\u0B95\u0BC86\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD11\u0C2D\u0C3E\u0C30\u0C24\u0C4D5\u0CAD\u0CBE\u0CB0\u0CA44\u0D2D\u0D3E\u0D30\u0D24\u0D025\u0DBD\u0D82\u0D9A\u0DCF4\u0E04\u0E2D\u0E213\u0E44\u0E17\u0E223\u0EA5\u0EB2\u0EA73\u10D2\u10D42\u307F\u3093\u306A3\u30A2\u30DE\u30BE\u30F34\u30AF\u30E9\u30A6\u30C94\u30B0\u30FC\u30B0\u30EB4\u30B3\u30E02\u30B9\u30C8\u30A23\u30BB\u30FC\u30EB3\u30D5\u30A1\u30C3\u30B7\u30E7\u30F36\u30DD\u30A4\u30F3\u30C84\u4E16\u754C2\u4E2D\u4FE11\u56FD1\u570B1\u6587\u7F513\u4E9A\u9A6C\u900A3\u4F01\u4E1A2\u4F5B\u5C712\u4FE1\u606F2\u5065\u5EB72\u516B\u53662\u516C\u53F81\u76CA2\u53F0\u6E7E1\u70632\u5546\u57CE1\u5E971\u68072\u5609\u91CC0\u5927\u9152\u5E975\u5728\u7EBF2\u5927\u62FF2\u5929\u4E3B\u65593\u5A31\u4E502\u5BB6\u96FB2\u5E7F\u4E1C2\u5FAE\u535A2\u6148\u55842\u6211\u7231\u4F603\u624B\u673A2\u62DB\u80582\u653F\u52A11\u5E9C2\u65B0\u52A0\u57612\u95FB2\u65F6\u5C1A2\u66F8\u7C4D2\u673A\u67842\u6DE1\u9A6C\u95213\u6E38\u620F2\u6FB3\u95802\u70B9\u770B2\u79FB\u52A82\u7EC4\u7EC7\u673A\u67844\u7F51\u57401\u5E971\u7AD91\u7EDC2\u8054\u901A2\u8C37\u6B4C2\u8D2D\u72692\u901A\u8CA92\u96C6\u56E22\u96FB\u8A0A\u76C8\u79D14\u98DE\u5229\u6D663\u98DF\u54C12\u9910\u53852\u9999\u683C\u91CC\u62C93\u6E2F2\uB2F7\uB1371\uCEF42\uC0BC\uC1312\uD55C\uAD6D2",Xu="numeric",Ju="ascii",Zu="alpha",Jr="asciinumeric",Xr="alphanumeric",Qu="domain",jg="emoji",MT="scheme",TT="slashscheme",Uu="whitespace";function CT(n,t){return n in t||(t[n]=[]),t[n]}function xi(n,t,e){t[Xu]&&(t[Jr]=!0,t[Xr]=!0),t[Ju]&&(t[Jr]=!0,t[Zu]=!0),t[Jr]&&(t[Xr]=!0),t[Zu]&&(t[Xr]=!0),t[Xr]&&(t[Qu]=!0),t[jg]&&(t[Qu]=!0);for(let i in t){let r=CT(i,e);r.indexOf(n)<0&&r.push(n)}}function LT(n,t){let e={};for(let i in t)t[i].indexOf(n)>=0&&(e[i]=!0);return e}function kt(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}kt.groups={};kt.prototype={accepts(){return!!this.t},go(n){let t=this,e=t.j[n];if(e)return e;for(let i=0;i<t.jr.length;i++){let r=t.jr[i][0],o=t.jr[i][1];if(o&&r.test(n))return o}return t.jd},has(n,t=!1){return t?n in this.j:!!this.go(n)},ta(n,t,e,i){for(let r=0;r<n.length;r++)this.tt(n[r],t,e,i)},tr(n,t,e,i){i=i||kt.groups;let r;return t&&t.j?r=t:(r=new kt(t),e&&i&&xi(t,e,i)),this.jr.push([n,r]),r},ts(n,t,e,i){let r=this,o=n.length;if(!o)return r;for(let s=0;s<o-1;s++)r=r.tt(n[s]);return r.tt(n[o-1],t,e,i)},tt(n,t,e,i){i=i||kt.groups;let r=this;if(t&&t.j)return r.j[n]=t,t;let o=t,s,a=r.go(n);if(a?(s=new kt,Object.assign(s.j,a.j),s.jr.push.apply(s.jr,a.jr),s.jd=a.jd,s.t=a.t):s=new kt,o){if(i)if(s.t&&typeof s.t=="string"){let l=Object.assign(LT(s.t,i),e);xi(o,l,i)}else e&&xi(o,e,i);s.t=o}return r.j[n]=s,s}};var fe=(n,t,e,i,r)=>n.ta(t,e,i,r),_e=(n,t,e,i,r)=>n.tr(t,e,i,r),$g=(n,t,e,i,r)=>n.ts(t,e,i,r),$=(n,t,e,i,r)=>n.tt(t,e,i,r),Sn="WORD",ed="UWORD",Yg="ASCIINUMERICAL",Xg="ALPHANUMERICAL",io="LOCALHOST",td="TLD",nd="UTLD",Ks="SCHEME",ir="SLASH_SCHEME",rd="NUM",id="WS",od="NL",Zr="OPENBRACE",Qr="CLOSEBRACE",qs="OPENBRACKET",Gs="CLOSEBRACKET",js="OPENPAREN",Ys="CLOSEPAREN",Xs="OPENANGLEBRACKET",Js="CLOSEANGLEBRACKET",Zs="FULLWIDTHLEFTPAREN",Qs="FULLWIDTHRIGHTPAREN",ea="LEFTCORNERBRACKET",ta="RIGHTCORNERBRACKET",na="LEFTWHITECORNERBRACKET",ia="RIGHTWHITECORNERBRACKET",ra="FULLWIDTHLESSTHAN",oa="FULLWIDTHGREATERTHAN",sa="AMPERSAND",aa="APOSTROPHE",la="ASTERISK",Kn="AT",ca="BACKSLASH",ua="BACKTICK",da="CARET",qn="COLON",sd="COMMA",ha="DOLLAR",rn="DOT",pa="EQUALS",ad="EXCLAMATION",zt="HYPHEN",eo="PERCENT",fa="PIPE",ma="PLUS",ga="POUND",to="QUERY",ld="QUOTE",Jg="FULLWIDTHMIDDLEDOT",cd="SEMI",on="SLASH",no="TILDE",ba="UNDERSCORE",Zg="EMOJI",ya="SYM",Qg=Object.freeze({__proto__:null,ALPHANUMERICAL:Xg,AMPERSAND:sa,APOSTROPHE:aa,ASCIINUMERICAL:Yg,ASTERISK:la,AT:Kn,BACKSLASH:ca,BACKTICK:ua,CARET:da,CLOSEANGLEBRACKET:Js,CLOSEBRACE:Qr,CLOSEBRACKET:Gs,CLOSEPAREN:Ys,COLON:qn,COMMA:sd,DOLLAR:ha,DOT:rn,EMOJI:Zg,EQUALS:pa,EXCLAMATION:ad,FULLWIDTHGREATERTHAN:oa,FULLWIDTHLEFTPAREN:Zs,FULLWIDTHLESSTHAN:ra,FULLWIDTHMIDDLEDOT:Jg,FULLWIDTHRIGHTPAREN:Qs,HYPHEN:zt,LEFTCORNERBRACKET:ea,LEFTWHITECORNERBRACKET:na,LOCALHOST:io,NL:od,NUM:rd,OPENANGLEBRACKET:Xs,OPENBRACE:Zr,OPENBRACKET:qs,OPENPAREN:js,PERCENT:eo,PIPE:fa,PLUS:ma,POUND:ga,QUERY:to,QUOTE:ld,RIGHTCORNERBRACKET:ta,RIGHTWHITECORNERBRACKET:ia,SCHEME:Ks,SEMI:cd,SLASH:on,SLASH_SCHEME:ir,SYM:ya,TILDE:no,TLD:td,UNDERSCORE:ba,UTLD:nd,UWORD:ed,WORD:Sn,WS:id}),kn=/[a-z]/,Yr=/\p{L}/u,Ku=/\p{Emoji}/u;var wn=/\d/,qu=/\s/;var Wg="\r",Gu=`
`,RT="\uFE0F",AT="\u200D",ju="\uFFFC",$s=null,Ws=null;function IT(n=[]){let t={};kt.groups=t;let e=new kt;$s==null&&($s=Ug(wT)),Ws==null&&(Ws=Ug(ST)),$(e,"'",aa),$(e,"{",Zr),$(e,"}",Qr),$(e,"[",qs),$(e,"]",Gs),$(e,"(",js),$(e,")",Ys),$(e,"<",Xs),$(e,">",Js),$(e,"\uFF08",Zs),$(e,"\uFF09",Qs),$(e,"\u300C",ea),$(e,"\u300D",ta),$(e,"\u300E",na),$(e,"\u300F",ia),$(e,"\uFF1C",ra),$(e,"\uFF1E",oa),$(e,"&",sa),$(e,"*",la),$(e,"@",Kn),$(e,"`",ua),$(e,"^",da),$(e,":",qn),$(e,",",sd),$(e,"$",ha),$(e,".",rn),$(e,"=",pa),$(e,"!",ad),$(e,"-",zt),$(e,"%",eo),$(e,"|",fa),$(e,"+",ma),$(e,"#",ga),$(e,"?",to),$(e,'"',ld),$(e,"/",on),$(e,";",cd),$(e,"~",no),$(e,"_",ba),$(e,"\\",ca),$(e,"\u30FB",Jg);let i=_e(e,wn,rd,{[Xu]:!0});_e(i,wn,i);let r=_e(i,kn,Yg,{[Jr]:!0}),o=_e(i,Yr,Xg,{[Xr]:!0}),s=_e(e,kn,Sn,{[Ju]:!0});_e(s,wn,r),_e(s,kn,s),_e(r,wn,r),_e(r,kn,r);let a=_e(e,Yr,ed,{[Zu]:!0});_e(a,kn),_e(a,wn,o),_e(a,Yr,a),_e(o,wn,o),_e(o,kn),_e(o,Yr,o);let l=$(e,Gu,od,{[Uu]:!0}),c=$(e,Wg,id,{[Uu]:!0}),u=_e(e,qu,id,{[Uu]:!0});$(e,ju,u),$(c,Gu,l),$(c,ju,u),_e(c,qu,u),$(u,Wg),$(u,Gu),_e(u,qu,u),$(u,ju,u);let d=_e(e,Ku,Zg,{[jg]:!0});$(d,"#"),_e(d,Ku,d),$(d,RT,d);let h=$(d,AT);$(h,"#"),_e(h,Ku,d);let p=[[kn,s],[wn,r]],f=[[kn,null],[Yr,a],[wn,o]];for(let g=0;g<$s.length;g++)Un(e,$s[g],td,Sn,p);for(let g=0;g<Ws.length;g++)Un(e,Ws[g],nd,ed,f);xi(td,{tld:!0,ascii:!0},t),xi(nd,{utld:!0,alpha:!0},t),Un(e,"file",Ks,Sn,p),Un(e,"mailto",Ks,Sn,p),Un(e,"http",ir,Sn,p),Un(e,"https",ir,Sn,p),Un(e,"ftp",ir,Sn,p),Un(e,"ftps",ir,Sn,p),xi(Ks,{scheme:!0,ascii:!0},t),xi(ir,{slashscheme:!0,ascii:!0},t),n=n.sort((g,m)=>g[0]>m[0]?1:-1);for(let g=0;g<n.length;g++){let m=n[g][0],y=n[g][1]?{[MT]:!0}:{[TT]:!0};m.indexOf("-")>=0?y[Qu]=!0:kn.test(m)?wn.test(m)?y[Jr]=!0:y[Ju]=!0:y[Xu]=!0,$g(e,m,m,y)}return $g(e,"localhost",io,{ascii:!0}),e.jd=new kt(ya),{start:e,tokens:Object.assign({groups:t},Qg)}}function e0(n,t){let e=NT(t.replace(/[A-Z]/g,a=>a.toLowerCase())),i=e.length,r=[],o=0,s=0;for(;s<i;){let a=n,l=null,c=0,u=null,d=-1,h=-1;for(;s<i&&(l=a.go(e[s]));)a=l,a.accepts()?(d=0,h=0,u=a):d>=0&&(d+=e[s].length,h++),c+=e[s].length,o+=e[s].length,s++;o-=d,s-=h,c-=d,r.push({t:u.t,v:t.slice(o-c,o),s:o-c,e:o})}return r}function NT(n){let t=[],e=n.length,i=0;for(;i<e;){let r=n.charCodeAt(i),o,s=r<55296||r>56319||i+1===e||(o=n.charCodeAt(i+1))<56320||o>57343?n[i]:n.slice(i,i+2);t.push(s),i+=s.length}return t}function Un(n,t,e,i,r){let o,s=t.length;for(let a=0;a<s-1;a++){let l=t[a];n.j[l]?o=n.j[l]:(o=new kt(i),o.jr=r.slice(),n.j[l]=o),n=o}return o=new kt(e),o.jr=r.slice(),n.j[t[s-1]]=o,o}function Ug(n){let t=[],e=[],i=0,r="0123456789";for(;i<n.length;){let o=0;for(;r.indexOf(n[i+o])>=0;)o++;if(o>0){t.push(e.join(""));for(let s=parseInt(n.substring(i,i+o),10);s>0;s--)e.pop();i+=o}else e.push(n[i]),i++}return t}var ro={defaultProtocol:"http",events:null,format:Kg,formatHref:Kg,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function ud(n,t=null){let e=Object.assign({},ro);n&&(e=Object.assign(e,n instanceof ud?n.o:n));let i=e.ignoreTags,r=[];for(let o=0;o<i.length;o++)r.push(i[o].toUpperCase());this.o=e,t&&(this.defaultRender=t),this.ignoreTags=r}ud.prototype={o:ro,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,t,e){let i=t!=null,r=this.o[n];return r&&(typeof r=="object"?(r=e.t in r?r[e.t]:ro[n],typeof r=="function"&&i&&(r=r(t,e))):typeof r=="function"&&i&&(r=r(t,e.t,e)),r)},getObj(n,t,e){let i=this.o[n];return typeof i=="function"&&t!=null&&(i=i(t,e.t,e)),i},render(n){let t=n.render(this);return(this.get("render",null,n)||this.defaultRender)(t,n.t,n)}};function Kg(n){return n}function t0(n,t){this.t="token",this.v=n,this.tk=t}t0.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){let t=this.toString(),e=n.get("truncate",t,this),i=n.get("format",t,this);return e&&i.length>e?i.substring(0,e)+"\u2026":i},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=ro.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){let t=this,e=this.toHref(n.get("defaultProtocol")),i=n.get("formatHref",e,this),r=n.get("tagName",e,t),o=this.toFormattedString(n),s={},a=n.get("className",e,t),l=n.get("target",e,t),c=n.get("rel",e,t),u=n.getObj("attributes",e,t),d=n.getObj("events",e,t);return s.href=i,a&&(s.class=a),l&&(s.target=l),c&&(s.rel=c),u&&Object.assign(s,u),{tagName:r,attributes:s,content:o,eventListeners:d}}};function va(n,t){class e extends t0{constructor(r,o){super(r,o),this.t=n}}for(let i in t)e.prototype[i]=t[i];return e.t=n,e}var qg=va("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Gg=va("text"),PT=va("nl"),Us=va("url",{isLink:!0,toHref(n=ro.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){let n=this.tk;return n.length>=2&&n[0].t!==io&&n[1].t===qn}});var Ht=n=>new kt(n);function _T({groups:n}){let t=n.domain.concat([sa,la,Kn,ca,ua,da,ha,pa,zt,rd,eo,fa,ma,ga,on,ya,no,ba]),e=[aa,qn,sd,rn,ad,eo,to,ld,cd,Xs,Js,Zr,Qr,Gs,qs,js,Ys,Zs,Qs,ea,ta,na,ia,ra,oa],i=[sa,aa,la,ca,ua,da,ha,pa,zt,Zr,Qr,eo,fa,ma,ga,to,on,ya,no,ba],r=Ht(),o=$(r,no);fe(o,i,o),fe(o,n.domain,o);let s=Ht(),a=Ht(),l=Ht();fe(r,n.domain,s),fe(r,n.scheme,a),fe(r,n.slashscheme,l),fe(s,i,o),fe(s,n.domain,s);let c=$(s,Kn);$(o,Kn,c),$(a,Kn,c),$(l,Kn,c);let u=$(o,rn);fe(u,i,o),fe(u,n.domain,o);let d=Ht();fe(c,n.domain,d),fe(d,n.domain,d);let h=$(d,rn);fe(h,n.domain,d);let p=Ht(qg);fe(h,n.tld,p),fe(h,n.utld,p),$(c,io,p);let f=$(d,zt);$(f,zt,f),fe(f,n.domain,d),fe(p,n.domain,d),$(p,rn,h),$(p,zt,f);let g=$(p,qn);fe(g,n.numeric,qg);let m=$(s,zt),b=$(s,rn);$(m,zt,m),fe(m,n.domain,s),fe(b,i,o),fe(b,n.domain,s);let y=Ht(Us);fe(b,n.tld,y),fe(b,n.utld,y),fe(y,n.domain,s),fe(y,i,o),$(y,rn,b),$(y,zt,m),$(y,Kn,c);let v=$(y,qn),E=Ht(Us);fe(v,n.numeric,E);let x=Ht(Us),k=Ht();fe(x,t,x),fe(x,e,k),fe(k,t,x),fe(k,e,k),$(y,on,x),$(E,on,x);let S=$(a,qn),w=$(l,qn),C=$(w,on),I=$(C,on);fe(a,n.domain,s),$(a,rn,b),$(a,zt,m),fe(l,n.domain,s),$(l,rn,b),$(l,zt,m),fe(S,n.domain,x),$(S,on,x),$(S,to,x),fe(I,n.domain,x),fe(I,t,x),$(I,on,x);let F=[[Zr,Qr],[qs,Gs],[js,Ys],[Xs,Js],[Zs,Qs],[ea,ta],[na,ia],[ra,oa]];for(let N=0;N<F.length;N++){let[H,_]=F[N],P=$(x,H);$(k,H,P),$(P,_,x);let L=Ht(Us);fe(P,t,L);let R=Ht();fe(P,e),fe(L,t,L),fe(L,e,R),fe(R,t,L),fe(R,e,R),$(L,_,x),$(R,_,x)}return $(r,io,y),$(r,od,PT),{start:r,tokens:Qg}}function OT(n,t,e){let i=e.length,r=0,o=[],s=[];for(;r<i;){let a=n,l=null,c=null,u=0,d=null,h=-1;for(;r<i&&!(l=a.go(e[r].t));)s.push(e[r++]);for(;r<i&&(c=l||a.go(e[r].t));)l=null,a=c,a.accepts()?(h=0,d=a):h>=0&&h++,r++,u++;if(h<0)r-=u,r<i&&(s.push(e[r]),r++);else{s.length>0&&(o.push(Yu(Gg,t,s)),s=[]),r-=h,u-=h;let p=d.t,f=e.slice(r-u,r);o.push(Yu(p,t,f))}}return s.length>0&&o.push(Yu(Gg,t,s)),o}function Yu(n,t,e){let i=e[0].s,r=e[e.length-1].e,o=t.slice(i,r);return new n(o,e)}var DT=typeof console!="undefined"&&console&&console.warn||(()=>{}),BT="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Ae={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function n0(){return kt.groups={},Ae.scanner=null,Ae.parser=null,Ae.tokenQueue=[],Ae.pluginQueue=[],Ae.customSchemes=[],Ae.initialized=!1,Ae}function dd(n,t=!1){if(Ae.initialized&&DT(`linkifyjs: already initialized - will not register custom scheme "${n}" ${BT}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(n))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Ae.customSchemes.push([n,t])}function FT(){Ae.scanner=IT(Ae.customSchemes);for(let n=0;n<Ae.tokenQueue.length;n++)Ae.tokenQueue[n][1]({scanner:Ae.scanner});Ae.parser=_T(Ae.scanner.tokens);for(let n=0;n<Ae.pluginQueue.length;n++)Ae.pluginQueue[n][1]({scanner:Ae.scanner,parser:Ae.parser});return Ae.initialized=!0,Ae}function Ea(n){return Ae.initialized||FT(),OT(Ae.parser.start,n,e0(Ae.scanner.start,n))}Ea.scan=e0;function xa(n,t=null,e=null){if(t&&typeof t=="object"){if(e)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);e=t,t=null}let i=new ud(e),r=Ea(n),o=[];for(let s=0;s<r.length;s++){let a=r[s];a.isLink&&(!t||a.t===t)&&i.check(a)&&o.push(a.toFormattedObject(i))}return o}var hd="[\0- \xA0\u1680\u180E\u2000-\u2029\u205F\u3000]",HT=new RegExp(hd),zT=new RegExp(`${hd}$`),VT=new RegExp(hd,"g");function $T(n){return n.length===1?n[0].isLink:n.length===3&&n[1].isLink?["()","[]"].includes(n[0].value+n[2].value):!1}function WT(n){return new X({key:new se("autolink"),appendTransaction:(t,e,i)=>{let r=t.some(c=>c.docChanged)&&!e.doc.eq(i.doc),o=t.some(c=>c.getMeta("preventAutolink"));if(!r||o)return;let{tr:s}=i,a=Tu(e.doc,[...t]);if(Iu(a).forEach(({newRange:c})=>{let u=rg(i.doc,c,p=>p.isTextblock),d,h;if(u.length>1)d=u[0],h=i.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){let p=i.doc.textBetween(c.from,c.to," "," ");if(!zT.test(p))return;d=u[0],h=i.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&h){let p=h.split(HT).filter(Boolean);if(p.length<=0)return!1;let f=p[p.length-1],g=d.pos+h.lastIndexOf(f);if(!f)return!1;let m=Ea(f).map(b=>b.toObject(n.defaultProtocol));if(!$T(m))return!1;m.filter(b=>b.isLink).map(b=>({...b,from:g+b.start+1,to:g+b.end+1})).filter(b=>i.schema.marks.code?!i.doc.rangeHasMark(b.from,b.to,i.schema.marks.code):!0).filter(b=>n.validate(b.value)).filter(b=>n.shouldAutoLink(b.value)).forEach(b=>{Hs(b.from,b.to,i.doc).some(y=>y.mark.type===n.type)||s.addMark(b.from,b.to,n.type.create({href:b.href}))})}}),!!s.steps.length)return s}})}function UT(n){return new X({key:new se("handleClickLink"),props:{handleClick:(t,e,i)=>{var r,o;if(i.button!==0||!t.editable)return!1;let s=null;if(i.target instanceof HTMLAnchorElement)s=i.target;else{let u=i.target,d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;s=d.find(h=>h.nodeName==="A")}if(!s)return!1;let a=Au(t.state,n.type.name),l=(r=s==null?void 0:s.href)!=null?r:a.href,c=(o=s==null?void 0:s.target)!=null?o:a.target;return n.enableClickSelection&&n.editor.commands.extendMarkRange(n.type.name),s&&l?(window.open(l,c),!0):!1}}})}function KT(n){return new X({key:new se("handlePasteLink"),props:{handlePaste:(t,e,i)=>{let{state:r}=t,{selection:o}=r,{empty:s}=o;if(s)return!1;let a="";i.content.forEach(c=>{a+=c.textContent});let l=xa(a,{defaultProtocol:n.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:n.editor.commands.setMark(n.type,{href:l.href})}}})}function ki(n,t){let e=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(i=>{let r=typeof i=="string"?i:i.scheme;r&&e.push(r)}),!n||n.replace(VT,"").match(new RegExp(`^(?:(?:${e.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var pd=De.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(n=>{if(typeof n=="string"){dd(n);return}dd(n.scheme,n.optionalSlashes)})},onDestroy(){n0()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(n,t)=>!!ki(n,t.protocols),validate:n=>!!n,shouldAutoLink:n=>!!n}},addAttributes(){return{href:{default:null,parseHTML(n){return n.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:n=>{let t=n.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:e=>!!ki(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:n}){return this.options.isAllowedUri(n.href,{defaultValidate:t=>!!ki(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",he(this.options.HTMLAttributes,n),0]:["a",he(this.options.HTMLAttributes,{...n,href:""}),0]},addCommands(){return{setLink:n=>({chain:t})=>{let{href:e}=n;return this.options.isAllowedUri(e,{defaultValidate:i=>!!ki(i,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,n).setMeta("preventAutolink",!0).run():!1},toggleLink:n=>({chain:t})=>{let{href:e}=n||{};return e&&!this.options.isAllowedUri(e,{defaultValidate:i=>!!ki(i,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:t().toggleMark(this.name,n,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:n})=>n().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[xt({find:n=>{let t=[];if(n){let{protocols:e,defaultProtocol:i}=this.options,r=xa(n).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:s=>!!ki(s,e),protocols:e,defaultProtocol:i}));r.length&&r.forEach(o=>t.push({text:o.value,data:{href:o.href},index:o.start}))}return t},type:this.type,getAttributes:n=>{var t;return{href:(t=n.data)==null?void 0:t.href}}})]},addProseMirrorPlugins(){let n=[],{protocols:t,defaultProtocol:e}=this.options;return this.options.autolink&&n.push(WT({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:i=>this.options.isAllowedUri(i,{defaultValidate:r=>!!ki(r,t),protocols:t,defaultProtocol:e}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&n.push(UT({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&n.push(KT({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),n}}),i0=pd;var qT=Object.defineProperty,GT=(n,t)=>{for(var e in t)qT(n,e,{get:t[e],enumerable:!0})},jT="listItem",r0="textStyle",o0=/^\s*([-+*])\s$/,rr=xe.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",he(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(jT,this.editor.getAttributes(r0)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=nn({find:o0,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=nn({find:o0,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(r0),editor:this.editor})),[n]}}),or=xe.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",he(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),YT={};GT(YT,{findListItemPos:()=>oo,getNextListDepth:()=>gd,handleBackspace:()=>fd,handleDelete:()=>md,hasListBefore:()=>l0,hasListItemAfter:()=>XT,hasListItemBefore:()=>c0,listItemHasSubList:()=>u0,nextListIsDeeper:()=>d0,nextListIsHigher:()=>h0});var oo=(n,t)=>{let{$from:e}=t.selection,i=Pe(n,t.schema),r=null,o=e.depth,s=e.pos,a=null;for(;o>0&&a===null;)r=e.node(o),r.type===i?a=o:(o-=1,s-=1);return a===null?null:{$pos:t.doc.resolve(s),depth:a}},gd=(n,t)=>{let e=oo(n,t);if(!e)return!1;let[,i]=ug(t,n,e.$pos.pos+4);return i},l0=(n,t,e)=>{let{$anchor:i}=n.selection,r=Math.max(0,i.pos-2),o=n.doc.resolve(r).node();return!(!o||!e.includes(o.type.name))},c0=(n,t)=>{var e;let{$anchor:i}=t.selection,r=t.doc.resolve(i.pos-2);return!(r.index()===0||((e=r.nodeBefore)==null?void 0:e.type.name)!==n)},u0=(n,t,e)=>{if(!e)return!1;let i=Pe(n,t.schema),r=!1;return e.descendants(o=>{o.type===i&&(r=!0)}),r},fd=(n,t,e)=>{if(n.commands.undoInputRule())return!0;if(n.state.selection.from!==n.state.selection.to)return!1;if(!tn(n.state,t)&&l0(n.state,t,e)){let{$anchor:a}=n.state.selection,l=n.state.doc.resolve(a.before()-1),c=[];l.node().descendants((h,p)=>{h.type.name===t&&c.push({node:h,pos:p})});let u=c.at(-1);if(!u)return!1;let d=n.state.doc.resolve(l.start()+u.pos+1);return n.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!tn(n.state,t)||!hg(n.state))return!1;let i=oo(t,n.state);if(!i)return!1;let o=n.state.doc.resolve(i.$pos.pos-2).node(i.depth),s=u0(t,n.state,o);return c0(t,n.state)&&!s?n.commands.joinItemBackward():n.chain().liftListItem(t).run()},d0=(n,t)=>{let e=gd(n,t),i=oo(n,t);return!i||!e?!1:e>i.depth},h0=(n,t)=>{let e=gd(n,t),i=oo(n,t);return!i||!e?!1:e<i.depth},md=(n,t)=>{if(!tn(n.state,t)||!dg(n.state,t))return!1;let{selection:e}=n.state,{$from:i,$to:r}=e;return!e.empty&&i.sameParent(r)?!1:d0(t,n.state)?n.chain().focus(n.state.selection.from+4).lift(t).joinBackward().run():h0(t,n.state)?n.chain().joinForward().joinBackward().run():n.commands.joinItemForward()},XT=(n,t)=>{var e;let{$anchor:i}=t.selection,r=t.doc.resolve(i.pos-i.parentOffset-2);return!(r.index()===r.parent.childCount-1||((e=r.nodeAfter)==null?void 0:e.type.name)!==n)},bd=ce.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{n.state.schema.nodes[e]!==void 0&&md(n,e)&&(t=!0)}),t},"Mod-Delete":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{n.state.schema.nodes[e]!==void 0&&md(n,e)&&(t=!0)}),t},Backspace:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:i})=>{n.state.schema.nodes[e]!==void 0&&fd(n,e,i)&&(t=!0)}),t},"Mod-Backspace":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:i})=>{n.state.schema.nodes[e]!==void 0&&fd(n,e,i)&&(t=!0)}),t}}}}),JT="listItem",s0="textStyle",a0=/^(\d+)\.\s$/,sr=xe.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){let{start:t,...e}=n;return t===1?["ol",he(this.options.HTMLAttributes,e),0]:["ol",he(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(JT,this.editor.getAttributes(s0)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=nn({find:a0,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=nn({find:a0,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(s0)}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1],editor:this.editor})),[n]}}),ZT=/^\s*(\[([( |x])?\])\s$/,QT=xe.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{let t=n.getAttribute("data-checked");return t===""||t==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:t}){return["li",he(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){let n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:t,getPos:e,editor:i})=>{let r=document.createElement("li"),o=document.createElement("label"),s=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,h;a.ariaLabel=((h=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:h.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(n),o.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!i.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}let{checked:d}=u.target;i.isEditable&&typeof e=="function"&&i.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{let p=e();if(typeof p!="number")return!1;let f=h.doc.nodeAt(p);return h.setNodeMarkup(p,void 0,{...f==null?void 0:f.attrs,checked:d}),!0}).run(),!i.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{r.setAttribute(u,d)}),r.dataset.checked=n.attrs.checked,a.checked=n.attrs.checked,o.append(a,s),r.append(o,l),Object.entries(t).forEach(([u,d])=>{r.setAttribute(u,d)}),{dom:r,contentDOM:l,update:u=>u.type!==this.type?!1:(r.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[nn({find:ZT,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),eC=xe.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",he(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),VB=ce.create({name:"listKit",addExtensions(){let n=[];return this.options.bulletList!==!1&&n.push(rr.configure(this.options.bulletList)),this.options.listItem!==!1&&n.push(or.configure(this.options.listItem)),this.options.listKeymap!==!1&&n.push(bd.configure(this.options.listKeymap)),this.options.orderedList!==!1&&n.push(sr.configure(this.options.orderedList)),this.options.taskItem!==!1&&n.push(QT.configure(this.options.taskItem)),this.options.taskList!==!1&&n.push(eC.configure(this.options.taskList)),n}});var yd=xe.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",he(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),p0=yd;var tC=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,nC=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,vd=De.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",he(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ft({find:tC,type:this.type})]},addPasteRules(){return[xt({find:nC,type:this.type})]}}),f0=vd;var Ed=xe.create({name:"text",group:"inline"}),m0=Ed;var xd=De.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",he(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),g0=xd;function b0(n={}){return new X({view(t){return new kd(t,n)}})}var kd=class{constructor(t,e){var i;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(i=e.width)!==null&&i!==void 0?i:1,this.color=e.color===!1?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let o=s=>{this[r](s)};return t.dom.addEventListener(r,o),{name:r,handler:o}})}destroy(){this.handlers.forEach(({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e))}update(t,e){this.cursorPos!=null&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),e=!t.parent.inlineContent,i,r=this.editorView.dom,o=r.getBoundingClientRect(),s=o.width/r.offsetWidth,a=o.height/r.offsetHeight;if(e){let d=t.nodeBefore,h=t.nodeAfter;if(d||h){let p=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(p){let f=p.getBoundingClientRect(),g=d?f.bottom:f.top;d&&h&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let m=this.width/2*a;i={left:f.left,right:f.right,top:g-m,bottom:g+m}}}}if(!i){let d=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*s;i={left:d.left-h,right:d.left+h,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",e),this.element.classList.toggle("prosemirror-dropcursor-inline",!e);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),h=d.width/l.offsetWidth,p=d.height/l.offsetHeight;c=d.left-l.scrollLeft*h,u=d.top-l.scrollTop*p}this.element.style.left=(i.left-c)/s+"px",this.element.style.top=(i.top-u)/a+"px",this.element.style.width=(i.right-i.left)/s+"px",this.element.style.height=(i.bottom-i.top)/a+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),i=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=i&&i.type.spec.disableDropCursor,o=typeof r=="function"?r(this.editorView,e,t):r;if(e&&!o){let s=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=Go(this.editorView.state.doc,s,this.editorView.dragging.slice);a!=null&&(s=a)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}};var ut=class n extends ie{constructor(t){super(t,t)}map(t,e){let i=t.resolve(e.map(this.head));return n.valid(i)?new n(i):ie.near(i)}content(){return q.empty}eq(t){return t instanceof n&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new n(t.resolve(e.pos))}getBookmark(){return new wd(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!iC(t)||!rC(t))return!1;let i=e.type.spec.allowGapCursor;if(i!=null)return i;let r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(t,e,i=!1){e:for(;;){if(!i&&n.valid(t))return t;let r=t.pos,o=null;for(let s=t.depth;;s--){let a=t.node(s);if(e>0?t.indexAfter(s)<a.childCount:t.index(s)>0){o=a.child(e>0?t.indexAfter(s):t.index(s)-1);break}else if(s==0)return null;r+=e;let l=t.doc.resolve(r);if(n.valid(l))return l}for(;;){let s=e>0?o.firstChild:o.lastChild;if(!s){if(o.isAtom&&!o.isText&&!Y.isSelectable(o)){t=t.doc.resolve(r+o.nodeSize*e),i=!1;continue e}break}o=s,r+=e;let a=t.doc.resolve(r);if(n.valid(a))return a}return null}}};ut.prototype.visible=!1;ut.findFrom=ut.findGapCursorFrom;ie.jsonID("gapcursor",ut);var wd=class n{constructor(t){this.pos=t}map(t){return new n(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return ut.valid(e)?new ut(e):ie.near(e)}};function iC(n){for(let t=n.depth;t>=0;t--){let e=n.index(t),i=n.node(t);if(e==0){if(i.type.spec.isolating)return!0;continue}for(let r=i.child(e-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function rC(n){for(let t=n.depth;t>=0;t--){let e=n.indexAfter(t),i=n.node(t);if(e==i.childCount){if(i.type.spec.isolating)return!0;continue}for(let r=i.child(e);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function y0(){return new X({props:{decorations:lC,createSelectionBetween(n,t,e){return t.pos==e.pos&&ut.valid(e)?new ut(e):null},handleClick:sC,handleKeyDown:oC,handleDOMEvents:{beforeinput:aC}}})}var oC=gu({ArrowLeft:ka("horiz",-1),ArrowRight:ka("horiz",1),ArrowUp:ka("vert",-1),ArrowDown:ka("vert",1)});function ka(n,t){let e=n=="vert"?t>0?"down":"up":t>0?"right":"left";return function(i,r,o){let s=i.selection,a=t>0?s.$to:s.$from,l=s.empty;if(s instanceof j){if(!o.endOfTextblock(e)||a.depth==0)return!1;l=!1,a=i.doc.resolve(t>0?a.after():a.before())}let c=ut.findGapCursorFrom(a,t,l);return c?(r&&r(i.tr.setSelection(new ut(c))),!0):!1}}function sC(n,t,e){if(!n||!n.editable)return!1;let i=n.state.doc.resolve(t);if(!ut.valid(i))return!1;let r=n.posAtCoords({left:e.clientX,top:e.clientY});return r&&r.inside>-1&&Y.isSelectable(n.state.doc.nodeAt(r.inside))?!1:(n.dispatch(n.state.tr.setSelection(new ut(i))),!0)}function aC(n,t){if(t.inputType!="insertCompositionText"||!(n.state.selection instanceof ut))return!1;let{$from:e}=n.state.selection,i=e.parent.contentMatchAt(e.index()).findWrapping(n.state.schema.nodes.text);if(!i)return!1;let r=z.empty;for(let s=i.length-1;s>=0;s--)r=z.from(i[s].createAndFill(null,r));let o=n.state.tr.replace(e.pos,e.pos,new q(r,0,0));return o.setSelection(j.near(o.doc.resolve(e.pos+1))),n.dispatch(o),!1}function lC(n){if(!(n.selection instanceof ut))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",ke.create(n.doc,[Ne.widget(n.selection.head,t,{key:"gapcursor"})])}var wa=200,nt=function(){};nt.prototype.append=function(t){return t.length?(t=nt.from(t),!this.length&&t||t.length<wa&&this.leafAppend(t)||this.length<wa&&t.leafPrepend(this)||this.appendInner(t)):this};nt.prototype.prepend=function(t){return t.length?nt.from(t).append(this):this};nt.prototype.appendInner=function(t){return new cC(this,t)};nt.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.length),t>=e?nt.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))};nt.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};nt.prototype.forEach=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=this.length),e<=i?this.forEachInner(t,e,i,0):this.forEachInvertedInner(t,e,i,0)};nt.prototype.map=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=this.length);var r=[];return this.forEach(function(o,s){return r.push(t(o,s))},e,i),r};nt.from=function(t){return t instanceof nt?t:t&&t.length?new v0(t):nt.empty};var v0=(function(n){function t(i){n.call(this),this.values=i}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(r,o){return r==0&&o==this.length?this:new t(this.values.slice(r,o))},t.prototype.getInner=function(r){return this.values[r]},t.prototype.forEachInner=function(r,o,s,a){for(var l=o;l<s;l++)if(r(this.values[l],a+l)===!1)return!1},t.prototype.forEachInvertedInner=function(r,o,s,a){for(var l=o-1;l>=s;l--)if(r(this.values[l],a+l)===!1)return!1},t.prototype.leafAppend=function(r){if(this.length+r.length<=wa)return new t(this.values.concat(r.flatten()))},t.prototype.leafPrepend=function(r){if(this.length+r.length<=wa)return new t(r.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t})(nt);nt.empty=new v0([]);var cC=(function(n){function t(e,i){n.call(this),this.left=e,this.right=i,this.length=e.length+i.length,this.depth=Math.max(e.depth,i.depth)+1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},t.prototype.forEachInner=function(i,r,o,s){var a=this.left.length;if(r<a&&this.left.forEachInner(i,r,Math.min(o,a),s)===!1||o>a&&this.right.forEachInner(i,Math.max(r-a,0),Math.min(this.length,o)-a,s+a)===!1)return!1},t.prototype.forEachInvertedInner=function(i,r,o,s){var a=this.left.length;if(r>a&&this.right.forEachInvertedInner(i,r-a,Math.max(o,a)-a,s+a)===!1||o<a&&this.left.forEachInvertedInner(i,Math.min(r,a),o,s)===!1)return!1},t.prototype.sliceInner=function(i,r){if(i==0&&r==this.length)return this;var o=this.left.length;return r<=o?this.left.slice(i,r):i>=o?this.right.slice(i-o,r-o):this.left.slice(i,o).append(this.right.slice(0,r-o))},t.prototype.leafAppend=function(i){var r=this.right.leafAppend(i);if(r)return new t(this.left,r)},t.prototype.leafPrepend=function(i){var r=this.left.leafPrepend(i);if(r)return new t(r,this.right)},t.prototype.appendInner=function(i){return this.left.depth>=Math.max(this.right.depth,i.depth)+1?new t(this.left,new t(this.right,i)):new t(this,i)},t})(nt),Sd=nt;var uC=500,Si=class n{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(this.eventCount==0)return null;let i=this.items.length;for(;;i--)if(this.items.get(i-1).selection){--i;break}let r,o;e&&(r=this.remapping(i,this.items.length),o=r.maps.length);let s=t.tr,a,l,c=[],u=[];return this.items.forEach((d,h)=>{if(!d.step){r||(r=this.remapping(i,h+1),o=r.maps.length),o--,u.push(d);return}if(r){u.push(new sn(d.map));let p=d.step.map(r.slice(o)),f;p&&s.maybeStep(p).doc&&(f=s.mapping.maps[s.mapping.maps.length-1],c.push(new sn(f,void 0,void 0,c.length+u.length))),o--,f&&r.appendMap(f,o)}else s.maybeStep(d.step);if(d.selection)return a=r?d.selection.map(r.slice(o)):d.selection,l=new n(this.items.slice(0,i).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:a}}addTransform(t,e,i,r){let o=[],s=this.eventCount,a=this.items,l=!r&&a.length?a.get(a.length-1):null;for(let u=0;u<t.steps.length;u++){let d=t.steps[u].invert(t.docs[u]),h=new sn(t.mapping.maps[u],d,e),p;(p=l&&l.merge(h))&&(h=p,u?o.pop():a=a.slice(0,a.length-1)),o.push(h),e&&(s++,e=void 0),r||(l=h)}let c=s-i.depth;return c>hC&&(a=dC(a,c),s-=c),new n(a.append(o),s)}remapping(t,e){let i=new Nr;return this.items.forEach((r,o)=>{let s=r.mirrorOffset!=null&&o-r.mirrorOffset>=t?i.maps.length-r.mirrorOffset:void 0;i.appendMap(r.map,s)},t,e),i}addMaps(t){return this.eventCount==0?this:new n(this.items.append(t.map(e=>new sn(e))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let i=[],r=Math.max(0,this.items.length-e),o=t.mapping,s=t.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},r);let l=e;this.items.forEach(h=>{let p=o.getMirror(--l);if(p==null)return;s=Math.min(s,p);let f=o.maps[p];if(h.step){let g=t.steps[p].invert(t.docs[p]),m=h.selection&&h.selection.map(o.slice(l+1,p));m&&a++,i.push(new sn(f,g,m))}else i.push(new sn(f))},r);let c=[];for(let h=e;h<s;h++)c.push(new sn(o.maps[h]));let u=this.items.slice(0,r).append(c).append(i),d=new n(u,a);return d.emptyItemCount()>uC&&(d=d.compress(this.items.length-i.length)),d}emptyItemCount(){let t=0;return this.items.forEach(e=>{e.step||t++}),t}compress(t=this.items.length){let e=this.remapping(0,t),i=e.maps.length,r=[],o=0;return this.items.forEach((s,a)=>{if(a>=t)r.push(s),s.selection&&o++;else if(s.step){let l=s.step.map(e.slice(i)),c=l&&l.getMap();if(i--,c&&e.appendMap(c,i),l){let u=s.selection&&s.selection.map(e.slice(i));u&&o++;let d=new sn(c.invert(),l,u),h,p=r.length-1;(h=r.length&&r[p].merge(d))?r[p]=h:r.push(d)}}else s.map&&i--},this.items.length,0),new n(Sd.from(r.reverse()),o)}};Si.empty=new Si(Sd.empty,0);function dC(n,t){let e;return n.forEach((i,r)=>{if(i.selection&&t--==0)return e=r,!1}),n.slice(e)}var sn=class n{constructor(t,e,i,r){this.map=t,this.step=e,this.selection=i,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new n(e.getMap().invert(),e,this.selection)}}},an=class{constructor(t,e,i,r,o){this.done=t,this.undone=e,this.prevRanges=i,this.prevTime=r,this.prevComposition=o}},hC=20;function pC(n,t,e,i){let r=e.getMeta(wi),o;if(r)return r.historyState;e.getMeta(gC)&&(n=new an(n.done,n.undone,null,0,-1));let s=e.getMeta("appendedTransaction");if(e.steps.length==0)return n;if(s&&s.getMeta(wi))return s.getMeta(wi).redo?new an(n.done.addTransform(e,void 0,i,Sa(t)),n.undone,E0(e.mapping.maps),n.prevTime,n.prevComposition):new an(n.done,n.undone.addTransform(e,void 0,i,Sa(t)),null,n.prevTime,n.prevComposition);if(e.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let a=e.getMeta("composition"),l=n.prevTime==0||!s&&n.prevComposition!=a&&(n.prevTime<(e.time||0)-i.newGroupDelay||!fC(e,n.prevRanges)),c=s?Md(n.prevRanges,e.mapping):E0(e.mapping.maps);return new an(n.done.addTransform(e,l?t.selection.getBookmark():void 0,i,Sa(t)),Si.empty,c,e.time,a==null?n.prevComposition:a)}else return(o=e.getMeta("rebased"))?new an(n.done.rebased(e,o),n.undone.rebased(e,o),Md(n.prevRanges,e.mapping),n.prevTime,n.prevComposition):new an(n.done.addMaps(e.mapping.maps),n.undone.addMaps(e.mapping.maps),Md(n.prevRanges,e.mapping),n.prevTime,n.prevComposition)}function fC(n,t){if(!t)return!1;if(!n.docChanged)return!0;let e=!1;return n.mapping.maps[0].forEach((i,r)=>{for(let o=0;o<t.length;o+=2)i<=t[o+1]&&r>=t[o]&&(e=!0)}),e}function E0(n){let t=[];for(let e=n.length-1;e>=0&&t.length==0;e--)n[e].forEach((i,r,o,s)=>t.push(o,s));return t}function Md(n,t){if(!n)return null;let e=[];for(let i=0;i<n.length;i+=2){let r=t.map(n[i],1),o=t.map(n[i+1],-1);r<=o&&e.push(r,o)}return e}function mC(n,t,e){let i=Sa(t),r=wi.get(t).spec.config,o=(e?n.undone:n.done).popEvent(t,i);if(!o)return null;let s=o.selection.resolve(o.transform.doc),a=(e?n.done:n.undone).addTransform(o.transform,t.selection.getBookmark(),r,i),l=new an(e?a:o.remaining,e?o.remaining:a,null,0,-1);return o.transform.setSelection(s).setMeta(wi,{redo:e,historyState:l})}var Td=!1,x0=null;function Sa(n){let t=n.plugins;if(x0!=t){Td=!1,x0=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Td=!0;break}}return Td}var wi=new se("history"),gC=new se("closeHistory");function k0(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new X({key:wi,state:{init(){return new an(Si.empty,Si.empty,null,0,-1)},apply(t,e,i){return pC(e,i,t,n)}},config:n,props:{handleDOMEvents:{beforeinput(t,e){let i=e.inputType,r=i=="historyUndo"?Cd:i=="historyRedo"?Ld:null;return r?(e.preventDefault(),r(t.state,t.dispatch)):!1}}}})}function Ma(n,t){return(e,i)=>{let r=wi.getState(e);if(!r||(n?r.undone:r.done).eventCount==0)return!1;if(i){let o=mC(r,e,n);o&&i(t?o.scrollIntoView():o)}return!0}}var Cd=Ma(!1,!0),Ld=Ma(!0,!0),pF=Ma(!1,!1),fF=Ma(!0,!1);var EF=ce.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{let t=(n==null?void 0:n.node)||this.editor.state.doc;if(((n==null?void 0:n.mode)||this.options.mode)==="textSize"){let i=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(i)}return t.nodeSize},this.storage.words=n=>{let t=(n==null?void 0:n.node)||this.editor.state.doc,e=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(e)}},addProseMirrorPlugins(){let n=!1;return[new X({key:new se("characterCount"),appendTransaction:(t,e,i)=>{if(n)return;let r=this.options.limit;if(r==null||r===0){n=!0;return}let o=this.storage.characters({node:i.doc});if(o>r){let s=o-r,a=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${r} characters. Content was automatically trimmed.`);let c=i.tr.deleteRange(a,l);return n=!0,c}n=!0},filterTransaction:(t,e)=>{let i=this.options.limit;if(!t.docChanged||i===0||i===null||i===void 0)return!0;let r=this.storage.characters({node:e.doc}),o=this.storage.characters({node:t.doc});if(o<=i||r>i&&o>i&&o<=r)return!0;if(r>i&&o>i&&o>r||!t.getMeta("paste"))return!1;let a=t.selection.$head.pos,l=o-i,c=a-l,u=a;return t.deleteRange(c,u),!(this.storage.characters({node:t.doc})>i)}})]}}),S0=ce.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[b0(this.options)]}}),TF=ce.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new X({key:new se("focus"),props:{decorations:({doc:n,selection:t})=>{let{isEditable:e,isFocused:i}=this.editor,{anchor:r}=t,o=[];if(!e||!i)return ke.create(n,[]);let s=0;this.options.mode==="deepest"&&n.descendants((l,c)=>{if(l.isText)return;if(!(r>=c&&r<=c+l.nodeSize-1))return!1;s+=1});let a=0;return n.descendants((l,c)=>{if(l.isText||!(r>=c&&r<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&s-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";o.push(Ne.node(c,c+l.nodeSize,{class:this.options.className}))}),ke.create(n,o)}}})]}}),M0=ce.create({name:"gapCursor",addProseMirrorPlugins(){return[y0()]},extendNodeSchema(n){var t;let e={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(t=we(Q(n,"allowGapCursor",e)))!=null?t:null}}}),NF=ce.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something \u2026",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new X({key:new se("placeholder"),props:{decorations:({doc:n,selection:t})=>{let e=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:i}=t,r=[];if(!e)return null;let o=this.editor.isEmpty;return n.descendants((s,a)=>{let l=i>=a&&i<=a+s.nodeSize,c=!s.isLeaf&&Gr(s);if((l||!this.options.showOnlyCurrent)&&c){let u=[this.options.emptyNodeClass];o&&u.push(this.options.emptyEditorClass);let d=Ne.node(a,a+s.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:a,hasAnchor:l}):this.options.placeholder});r.push(d)}return this.options.includeChildren}),ke.create(n,r)}}})]}}),DF=ce.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){let{editor:n,options:t}=this;return[new X({key:new se("selection"),props:{decorations(e){return e.selection.empty||n.isFocused||!n.isEditable||zs(e.selection)||n.view.dragging?null:ke.create(e.doc,[Ne.inline(e.selection.from,e.selection.to,{class:t.className})])}}})]}});function w0({types:n,node:t}){return t&&Array.isArray(n)&&n.includes(t.type)||(t==null?void 0:t.type)===n}var T0=ce.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){let n=new se(this.name),t=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(this.options.node).includes(e.name));return[new X({key:n,appendTransaction:(e,i,r)=>{let{doc:o,tr:s,schema:a}=r,l=n.getState(r),c=o.content.size,u=a.nodes[this.options.node];if(l)return s.insert(c,u.create())},state:{init:(e,i)=>{let r=i.tr.doc.lastChild;return!w0({node:r,types:t})},apply:(e,i)=>{if(!e.docChanged)return i;let r=e.doc.lastChild;return!w0({node:r,types:t})}}})]}}),C0=ce.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:t})=>Cd(n,t),redo:()=>({state:n,dispatch:t})=>Ld(n,t)}},addProseMirrorPlugins(){return[k0(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}});var bC=ce.create({name:"starterKit",addExtensions(){var n,t,e,i;let r=[];return this.options.bold!==!1&&r.push(Du.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(Ou.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(rr.configure(this.options.bulletList)),this.options.code!==!1&&r.push(Bu.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(Fu.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(Hu.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(S0.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(M0.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push(zu.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push(Vu.configure(this.options.heading)),this.options.undoRedo!==!1&&r.push(C0.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&r.push($u.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(Wu.configure(this.options.italic)),this.options.listItem!==!1&&r.push(or.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(bd.configure((n=this.options)==null?void 0:n.listKeymap)),this.options.link!==!1&&r.push(pd.configure((t=this.options)==null?void 0:t.link)),this.options.orderedList!==!1&&r.push(sr.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(yd.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(vd.configure(this.options.strike)),this.options.text!==!1&&r.push(Ed.configure(this.options.text)),this.options.underline!==!1&&r.push(xd.configure((e=this.options)==null?void 0:e.underline)),this.options.trailingNode!==!1&&r.push(T0.configure((i=this.options)==null?void 0:i.trailingNode)),r}}),L0=bC;var R0=rr;var A0=sr;var I0=or;var N0=ce.create({name:"disableShortcuts",addKeyboardShortcuts(){return{Enter:({editor:n})=>n.isEditable?n.isActive("listItem")?n.commands.splitListItem("listItem"):n.commands.splitBlock():!0,"Shift-Enter":({editor:n})=>n.isEditable?n.commands.setHardBreak():!0,Tab:({editor:n})=>n.isEditable&&n.isActive("listItem")?n.commands.sinkListItem("listItem"):!0,"Shift-Tab":({editor:n})=>n.isEditable&&n.isActive("listItem")?n.commands.liftListItem("listItem"):!0,"Mod-b":()=>!0,"Mod-B":()=>!0,"Mod-Shift-b":()=>!0,"Mod-Shift-B":()=>!0,"Mod-i":()=>!0,"Mod-I":()=>!0,"Mod-Shift-i":()=>!0,"Mod-Shift-I":()=>!0,"Mod-e":()=>!0,"Mod-E":()=>!0,"Mod-Shift-e":()=>!0,"Mod-Shift-E":()=>!0,"Mod-Shift-x":()=>!0,"Mod-Shift-X":()=>!0,"Mod-Shift-1":()=>!0,"Mod-Shift-2":()=>!0,"Mod-Shift-3":()=>!0,"Mod-Shift-7":()=>!0,"Mod-Shift-8":()=>!0,"Mod-Shift-9":()=>!0,"Mod-Alt-c":()=>!0,"Mod-Alt-C":()=>!0,"Mod-s":()=>!0,"Mod-S":()=>!0,"Mod-Shift-s":()=>!0,"Mod-Shift-S":()=>!0}},priority:1e3});var P0=ce.create({name:"verticalArrowKeys",addOptions(){return{isVertical:()=>!1}},addKeyboardShortcuts(){return{ArrowLeft:({editor:n})=>{var o;if(!this.options.isVertical())return!1;let{state:t}=n,{$anchor:e}=t.selection,i=e.parent;if(i.type.name==="paragraph"&&i.childCount===0||i.type.name==="paragraph"&&i.childCount===1&&((o=i.firstChild)==null?void 0:o.type.name)==="hardBreak"){let s=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",bubbles:!0,cancelable:!0});return n.view.dom.dispatchEvent(s),!0}return!1},ArrowRight:({editor:n})=>{var o;if(!this.options.isVertical())return!1;let{state:t}=n,{$anchor:e}=t.selection,i=e.parent;if(i.type.name==="paragraph"&&i.childCount===0||i.type.name==="paragraph"&&i.childCount===1&&((o=i.firstChild)==null?void 0:o.type.name)==="hardBreak"){let s=new KeyboardEvent("keydown",{key:"ArrowUp",code:"ArrowUp",bubbles:!0,cancelable:!0});return n.view.dom.dispatchEvent(s),!0}return!1}}},priority:900});var O0=ce.create({name:"listItemMove",addOptions(){return{isVertical:()=>!1}},addKeyboardShortcuts(){let n=()=>this.editor.isEditable?this.editor.commands.moveListItemUp():!1,t=()=>this.editor.isEditable?this.editor.commands.moveListItemDown():!1;return{"Mod-ArrowUp":()=>this.options.isVertical()?!1:n(),"Mod-ArrowDown":()=>this.options.isVertical()?!1:t(),"Mod-ArrowRight":()=>this.options.isVertical()?n():!1,"Mod-ArrowLeft":()=>this.options.isVertical()?t():!1}},addCommands(){return{moveListItemUp:()=>({state:n,dispatch:t})=>this.editor.isEditable?_0(n,t,"up"):!1,moveListItemDown:()=>({state:n,dispatch:t})=>this.editor.isEditable?_0(n,t,"down"):!1}}});function _0(n,t,e){let{$from:i}=n.selection,r=-1,o=null;for(let v=i.depth;v>0;v--){let E=i.node(v);if(E.type.name==="listItem"){r=v,o=E;break}}if(r===-1||!o)return!1;let s=r-1;if(s<1)return!1;let a=i.node(s);if(a.type.name!=="bulletList"&&a.type.name!=="orderedList")return!1;let l=i.index(s),c=e==="up"?l-1:l+1;if(c<0||c>=a.childCount)return!1;if(!t)return!0;let d=i.before(s)+1,h=[];for(let v=0;v<a.childCount;v++){let E=a.child(v);h.push({start:d,end:d+E.nodeSize,node:E}),d+=E.nodeSize}let p=h[l],f=h[c];if(!p||!f)return!1;let g=n.tr,m=i.pos-p.start;e==="up"?(g.delete(p.start,p.end),g.insert(f.start,p.node)):(g.delete(f.start,f.end),g.insert(p.start,f.node));let b;e==="up"?b=f.start+m:b=p.start+f.node.nodeSize+m;let y=g.doc.content.size;b=Math.max(1,Math.min(b,y-1));try{g.setSelection(j.create(g.doc,b))}catch(v){try{let E=e==="up"?f.start+1:p.start+f.node.nodeSize+1;g.setSelection(j.create(g.doc,Math.max(1,Math.min(E,y-1))))}catch(E){}}return t(g),!0}var nb=Po(tb(),1);var ib=nb.default;function sb(n,t=[]){return n.flatMap(e=>{let i=[...t,...e.properties?e.properties.className:[]];return e.children?sb(e.children,i):{text:e.value,classes:i}})}function rb(n){return n.value||n.children||[]}function aL(n){return!!ib.getLanguage(n)}function ob({doc:n,name:t,lowlight:e,defaultLanguage:i}){let r=[];return Bs(n,o=>o.type.name===t).forEach(o=>{var s;let a=o.pos+1,l=o.node.attrs.language||i,c=e.listLanguages(),u=l&&(c.includes(l)||aL(l)||(s=e.registered)!=null&&s.call(e,l))?rb(e.highlight(l,o.node.textContent)):rb(e.highlightAuto(o.node.textContent));sb(u).forEach(d=>{let h=a+d.text.length;if(d.classes.length){let p=Ne.inline(a,h,{class:d.classes.join(" ")});r.push(p)}a=h})}),ke.create(n,r)}function lL(n){return typeof n=="function"}function cL({name:n,lowlight:t,defaultLanguage:e}){if(!["highlight","highlightAuto","listLanguages"].every(r=>lL(t[r])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");let i=new X({key:new se("lowlight"),state:{init:(r,{doc:o})=>ob({doc:o,name:n,lowlight:t,defaultLanguage:e}),apply:(r,o,s,a)=>{let l=s.selection.$head.parent.type.name,c=a.selection.$head.parent.type.name,u=Bs(s.doc,h=>h.type.name===n),d=Bs(a.doc,h=>h.type.name===n);return r.docChanged&&([l,c].includes(n)||d.length!==u.length||r.steps.some(h=>h.from!==void 0&&h.to!==void 0&&u.some(p=>p.pos>=h.from&&p.pos+p.node.nodeSize<=h.to)))?ob({doc:r.doc,name:n,lowlight:t,defaultLanguage:e}):o.map(r.mapping,r.doc)}},props:{decorations(r){return i.getState(r)}}});return i}var uL=Dg.extend({addOptions(){var n;return{...(n=this.parent)==null?void 0:n.call(this),lowlight:{},languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},addProseMirrorPlugins(){var n;return[...((n=this.parent)==null?void 0:n.call(this))||[],cL({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),ab=uL;function dL(n){let t=n.regex,e=n.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),i="decltype\\(auto\\)",r="[a-zA-Z_]\\w*::",s="(?!struct)("+i+"|"+t.optional(r)+"[a-zA-Z_]\\w*"+t.optional("<[^<>]+>")+")",a={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[n.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},n.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},u={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},d={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},n.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},e,n.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:t.optional(r)+n.IDENT_RE,relevance:0},p=t.optional(r)+n.IDENT_RE+"\\s*\\(",f=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],g=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],m=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],b=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],E={type:g,keyword:f,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:m},x={className:"function.dispatch",relevance:0,keywords:{_hint:b},begin:t.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,n.IDENT_RE,t.lookahead(/(<[^<>]+>|)\s*\(/))},k=[x,d,a,e,n.C_BLOCK_COMMENT_MODE,u,c],S={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:E,contains:k.concat([{begin:/\(/,end:/\)/,keywords:E,contains:k.concat(["self"]),relevance:0}]),relevance:0},w={className:"function",begin:"("+s+"[\\*&\\s]+)+"+p,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:E,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:i,keywords:E,relevance:0},{begin:p,returnBegin:!0,contains:[h],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[c,u]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:[e,n.C_BLOCK_COMMENT_MODE,c,u,a,{begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:["self",e,n.C_BLOCK_COMMENT_MODE,c,u,a]}]},a,e,n.C_BLOCK_COMMENT_MODE,d]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:E,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(S,w,x,k,[d,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function)\\s*<(?!<)",end:">",keywords:E,contains:["self",a]},{begin:n.IDENT_RE+"::",keywords:E},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}function lb(n){let t={type:["boolean","byte","word","String"],built_in:["KeyboardController","MouseController","SoftwareSerial","EthernetServer","EthernetClient","LiquidCrystal","RobotControl","GSMVoiceCall","EthernetUDP","EsploraTFT","HttpClient","RobotMotor","WiFiClient","GSMScanner","FileSystem","Scheduler","GSMServer","YunClient","YunServer","IPAddress","GSMClient","GSMModem","Keyboard","Ethernet","Console","GSMBand","Esplora","Stepper","Process","WiFiUDP","GSM_SMS","Mailbox","USBHost","Firmata","PImage","Client","Server","GSMPIN","FileIO","Bridge","Serial","EEPROM","Stream","Mouse","Audio","Servo","File","Task","GPRS","WiFi","Wire","TFT","GSM","SPI","SD"],_hints:["setup","loop","runShellCommandAsynchronously","analogWriteResolution","retrieveCallingNumber","printFirmwareVersion","analogReadResolution","sendDigitalPortPair","noListenOnLocalhost","readJoystickButton","setFirmwareVersion","readJoystickSwitch","scrollDisplayRight","getVoiceCallStatus","scrollDisplayLeft","writeMicroseconds","delayMicroseconds","beginTransmission","getSignalStrength","runAsynchronously","getAsynchronously","listenOnLocalhost","getCurrentCarrier","readAccelerometer","messageAvailable","sendDigitalPorts","lineFollowConfig","countryNameWrite","runShellCommand","readStringUntil","rewindDirectory","readTemperature","setClockDivider","readLightSensor","endTransmission","analogReference","detachInterrupt","countryNameRead","attachInterrupt","encryptionType","readBytesUntil","robotNameWrite","readMicrophone","robotNameRead","cityNameWrite","userNameWrite","readJoystickY","readJoystickX","mouseReleased","openNextFile","scanNetworks","noInterrupts","digitalWrite","beginSpeaker","mousePressed","isActionDone","mouseDragged","displayLogos","noAutoscroll","addParameter","remoteNumber","getModifiers","keyboardRead","userNameRead","waitContinue","processInput","parseCommand","printVersion","readNetworks","writeMessage","blinkVersion","cityNameRead","readMessage","setDataMode","parsePacket","isListening","setBitOrder","beginPacket","isDirectory","motorsWrite","drawCompass","digitalRead","clearScreen","serialEvent","rightToLeft","setTextSize","leftToRight","requestFrom","keyReleased","compassRead","analogWrite","interrupts","WiFiServer","disconnect","playMelody","parseFloat","autoscroll","getPINUsed","setPINUsed","setTimeout","sendAnalog","readSlider","analogRead","beginWrite","createChar","motorsStop","keyPressed","tempoWrite","readButton","subnetMask","debugPrint","macAddress","writeGreen","randomSeed","attachGPRS","readString","sendString","remotePort","releaseAll","mouseMoved","background","getXChange","getYChange","answerCall","getResult","voiceCall","endPacket","constrain","getSocket","writeJSON","getButton","available","connected","findUntil","readBytes","exitValue","readGreen","writeBlue","startLoop","IPAddress","isPressed","sendSysex","pauseMode","gatewayIP","setCursor","getOemKey","tuneWrite","noDisplay","loadImage","switchPIN","onRequest","onReceive","changePIN","playFile","noBuffer","parseInt","overflow","checkPIN","knobRead","beginTFT","bitClear","updateIR","bitWrite","position","writeRGB","highByte","writeRed","setSpeed","readBlue","noStroke","remoteIP","transfer","shutdown","hangCall","beginSMS","endWrite","attached","maintain","noCursor","checkReg","checkPUK","shiftOut","isValid","shiftIn","pulseIn","connect","println","localIP","pinMode","getIMEI","display","noBlink","process","getBand","running","beginSD","drawBMP","lowByte","setBand","release","bitRead","prepare","pointTo","readRed","setMode","noFill","remove","listen","stroke","detach","attach","noTone","exists","buffer","height","bitSet","circle","config","cursor","random","IRread","setDNS","endSMS","getKey","micros","millis","begin","print","write","ready","flush","width","isPIN","blink","clear","press","mkdir","rmdir","close","point","yield","image","BSSID","click","delay","read","text","move","peek","beep","rect","line","open","seek","fill","size","turn","stop","home","find","step","tone","sqrt","RSSI","SSID","end","bit","tan","cos","sin","pow","map","abs","max","min","get","run","put"],literal:["DIGITAL_MESSAGE","FIRMATA_STRING","ANALOG_MESSAGE","REPORT_DIGITAL","REPORT_ANALOG","INPUT_PULLUP","SET_PIN_MODE","INTERNAL2V56","SYSTEM_RESET","LED_BUILTIN","INTERNAL1V1","SYSEX_START","INTERNAL","EXTERNAL","DEFAULT","OUTPUT","INPUT","HIGH","LOW"]},e=dL(n),i=e.keywords;return i.type=[...i.type,...t.type],i.literal=[...i.literal,...t.literal],i.built_in=[...i.built_in,...t.built_in],i._hints=t._hints,e.name="Arduino",e.aliases=["ino"],e.supersetOf="cpp",e}function cb(n){let t=n.regex,e={},i={begin:/\$\{/,end:/\}/,contains:["self",{begin:/:-/,contains:[e]}]};Object.assign(e,{className:"variable",variants:[{begin:t.concat(/\$[\w\d#@][\w\d_]*/,"(?![\\w\\d])(?![$])")},i]});let r={className:"subst",begin:/\$\(/,end:/\)/,contains:[n.BACKSLASH_ESCAPE]},o={begin:/<<-?\s*(?=\w+)/,starts:{contains:[n.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,className:"string"})]}},s={className:"string",begin:/"/,end:/"/,contains:[n.BACKSLASH_ESCAPE,e,r]};r.contains.push(s);let a={className:"",begin:/\\"/},l={className:"string",begin:/'/,end:/'/},c={begin:/\$?\(\(/,end:/\)\)/,contains:[{begin:/\d+#[0-9a-f]+/,className:"number"},n.NUMBER_MODE,e]},u=["fish","bash","zsh","sh","csh","ksh","tcsh","dash","scsh"],d=n.SHEBANG({binary:`(${u.join("|")})`,relevance:10}),h={className:"function",begin:/\w[\w\d_]*\s*\(\s*\)\s*\{/,returnBegin:!0,contains:[n.inherit(n.TITLE_MODE,{begin:/\w[\w\d_]*/})],relevance:0},p=["if","then","else","elif","fi","for","while","until","in","do","done","case","esac","function","select"],f=["true","false"],g={match:/(\/[a-z._-]+)+/},m=["break","cd","continue","eval","exec","exit","export","getopts","hash","pwd","readonly","return","shift","test","times","trap","umask","unset"],b=["alias","bind","builtin","caller","command","declare","echo","enable","help","let","local","logout","mapfile","printf","read","readarray","source","type","typeset","ulimit","unalias"],y=["autoload","bg","bindkey","bye","cap","chdir","clone","comparguments","compcall","compctl","compdescribe","compfiles","compgroups","compquote","comptags","comptry","compvalues","dirs","disable","disown","echotc","echoti","emulate","fc","fg","float","functions","getcap","getln","history","integer","jobs","kill","limit","log","noglob","popd","print","pushd","pushln","rehash","sched","setcap","setopt","stat","suspend","ttyctl","unfunction","unhash","unlimit","unsetopt","vared","wait","whence","where","which","zcompile","zformat","zftp","zle","zmodload","zparseopts","zprof","zpty","zregexparse","zsocket","zstyle","ztcp"],v=["chcon","chgrp","chown","chmod","cp","dd","df","dir","dircolors","ln","ls","mkdir","mkfifo","mknod","mktemp","mv","realpath","rm","rmdir","shred","sync","touch","truncate","vdir","b2sum","base32","base64","cat","cksum","comm","csplit","cut","expand","fmt","fold","head","join","md5sum","nl","numfmt","od","paste","ptx","pr","sha1sum","sha224sum","sha256sum","sha384sum","sha512sum","shuf","sort","split","sum","tac","tail","tr","tsort","unexpand","uniq","wc","arch","basename","chroot","date","dirname","du","echo","env","expr","factor","groups","hostid","id","link","logname","nice","nohup","nproc","pathchk","pinky","printenv","printf","pwd","readlink","runcon","seq","sleep","stat","stdbuf","stty","tee","test","timeout","tty","uname","unlink","uptime","users","who","whoami","yes"];return{name:"Bash",aliases:["sh"],keywords:{$pattern:/\b[a-z][a-z0-9._-]+\b/,keyword:p,literal:f,built_in:[...m,...b,"set","shopt",...y,...v]},contains:[d,n.SHEBANG(),h,c,n.HASH_COMMENT_MODE,o,g,s,a,l,e]}}function ub(n){let t=n.regex,e=n.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),i="decltype\\(auto\\)",r="[a-zA-Z_]\\w*::",s="("+i+"|"+t.optional(r)+"[a-zA-Z_]\\w*"+t.optional("<[^<>]+>")+")",a={className:"type",variants:[{begin:"\\b[a-z\\d_]*_t\\b"},{match:/\batomic_[a-z]{3,6}\b/}]},c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[n.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},n.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},u={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},d={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},n.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},e,n.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:t.optional(r)+n.IDENT_RE,relevance:0},p=t.optional(r)+n.IDENT_RE+"\\s*\\(",m={keyword:["asm","auto","break","case","continue","default","do","else","enum","extern","for","fortran","goto","if","inline","register","restrict","return","sizeof","struct","switch","typedef","union","volatile","while","_Alignas","_Alignof","_Atomic","_Generic","_Noreturn","_Static_assert","_Thread_local","alignas","alignof","noreturn","static_assert","thread_local","_Pragma"],type:["float","double","signed","unsigned","int","short","long","char","void","_Bool","_Complex","_Imaginary","_Decimal32","_Decimal64","_Decimal128","const","static","complex","bool","imaginary"],literal:"true false NULL",built_in:"std string wstring cin cout cerr clog stdin stdout stderr stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set pair bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap priority_queue make_pair array shared_ptr abort terminate abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf future isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc realloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf endl initializer_list unique_ptr"},b=[d,a,e,n.C_BLOCK_COMMENT_MODE,u,c],y={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:m,contains:b.concat([{begin:/\(/,end:/\)/,keywords:m,contains:b.concat(["self"]),relevance:0}]),relevance:0},v={begin:"("+s+"[\\*&\\s]+)+"+p,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:m,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:i,keywords:m,relevance:0},{begin:p,returnBegin:!0,contains:[n.inherit(h,{className:"title.function"})],relevance:0},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:m,relevance:0,contains:[e,n.C_BLOCK_COMMENT_MODE,c,u,a,{begin:/\(/,end:/\)/,keywords:m,relevance:0,contains:["self",e,n.C_BLOCK_COMMENT_MODE,c,u,a]}]},a,e,n.C_BLOCK_COMMENT_MODE,d]};return{name:"C",aliases:["h"],keywords:m,disableAutodetect:!0,illegal:"</",contains:[].concat(y,v,b,[d,{begin:n.IDENT_RE+"::",keywords:m},{className:"class",beginKeywords:"enum class struct union",end:/[{;:<>=]/,contains:[{beginKeywords:"final class struct"},n.TITLE_MODE]}]),exports:{preprocessor:d,strings:c,keywords:m}}}function db(n){let t=n.regex,e=n.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),i="decltype\\(auto\\)",r="[a-zA-Z_]\\w*::",s="(?!struct)("+i+"|"+t.optional(r)+"[a-zA-Z_]\\w*"+t.optional("<[^<>]+>")+")",a={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[n.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},n.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},u={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},d={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},n.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},e,n.C_BLOCK_COMMENT_MODE]},h={className:"title",begin:t.optional(r)+n.IDENT_RE,relevance:0},p=t.optional(r)+n.IDENT_RE+"\\s*\\(",f=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],g=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],m=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],b=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],E={type:g,keyword:f,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:m},x={className:"function.dispatch",relevance:0,keywords:{_hint:b},begin:t.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,n.IDENT_RE,t.lookahead(/(<[^<>]+>|)\s*\(/))},k=[x,d,a,e,n.C_BLOCK_COMMENT_MODE,u,c],S={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:E,contains:k.concat([{begin:/\(/,end:/\)/,keywords:E,contains:k.concat(["self"]),relevance:0}]),relevance:0},w={className:"function",begin:"("+s+"[\\*&\\s]+)+"+p,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:E,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:i,keywords:E,relevance:0},{begin:p,returnBegin:!0,contains:[h],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[c,u]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:[e,n.C_BLOCK_COMMENT_MODE,c,u,a,{begin:/\(/,end:/\)/,keywords:E,relevance:0,contains:["self",e,n.C_BLOCK_COMMENT_MODE,c,u,a]}]},a,e,n.C_BLOCK_COMMENT_MODE,d]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:E,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(S,w,x,k,[d,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function)\\s*<(?!<)",end:">",keywords:E,contains:["self",a]},{begin:n.IDENT_RE+"::",keywords:E},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}function hb(n){let t=["bool","byte","char","decimal","delegate","double","dynamic","enum","float","int","long","nint","nuint","object","sbyte","short","string","ulong","uint","ushort"],e=["public","private","protected","static","internal","protected","abstract","async","extern","override","unsafe","virtual","new","sealed","partial"],i=["default","false","null","true"],r=["abstract","as","base","break","case","catch","class","const","continue","do","else","event","explicit","extern","finally","fixed","for","foreach","goto","if","implicit","in","interface","internal","is","lock","namespace","new","operator","out","override","params","private","protected","public","readonly","record","ref","return","scoped","sealed","sizeof","stackalloc","static","struct","switch","this","throw","try","typeof","unchecked","unsafe","using","virtual","void","volatile","while"],o=["add","alias","and","ascending","async","await","by","descending","equals","from","get","global","group","init","into","join","let","nameof","not","notnull","on","or","orderby","partial","remove","select","set","unmanaged","value|0","var","when","where","with","yield"],s={keyword:r.concat(o),built_in:t,literal:i},a=n.inherit(n.TITLE_MODE,{begin:"[a-zA-Z](\\.?\\w)*"}),l={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)(u|U|l|L|ul|UL|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},c={className:"string",begin:'@"',end:'"',contains:[{begin:'""'}]},u=n.inherit(c,{illegal:/\n/}),d={className:"subst",begin:/\{/,end:/\}/,keywords:s},h=n.inherit(d,{illegal:/\n/}),p={className:"string",begin:/\$"/,end:'"',illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},n.BACKSLASH_ESCAPE,h]},f={className:"string",begin:/\$@"/,end:'"',contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},d]},g=n.inherit(f,{illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},h]});d.contains=[f,p,c,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,l,n.C_BLOCK_COMMENT_MODE],h.contains=[g,p,u,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,l,n.inherit(n.C_BLOCK_COMMENT_MODE,{illegal:/\n/})];let m={variants:[f,p,c,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE]},b={begin:"<",end:">",contains:[{beginKeywords:"in out"},a]},y=n.IDENT_RE+"(<"+n.IDENT_RE+"(\\s*,\\s*"+n.IDENT_RE+")*>)?(\\[\\])?",v={begin:"@"+n.IDENT_RE,relevance:0};return{name:"C#",aliases:["cs","c#"],keywords:s,illegal:/::/,contains:[n.COMMENT("///","$",{returnBegin:!0,contains:[{className:"doctag",variants:[{begin:"///",relevance:0},{begin:"<!--|-->"},{begin:"</?",end:">"}]}]}),n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,{className:"meta",begin:"#",end:"$",keywords:{keyword:"if else elif endif define undef warning error line region endregion pragma checksum"}},m,l,{beginKeywords:"class interface",relevance:0,end:/[{;=]/,illegal:/[^\s:,]/,contains:[{beginKeywords:"where class"},a,b,n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},{beginKeywords:"namespace",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[a,n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},{beginKeywords:"record",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[a,b,n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},{className:"meta",begin:"^\\s*\\[(?=[\\w])",excludeBegin:!0,end:"\\]",excludeEnd:!0,contains:[{className:"string",begin:/"/,end:/"/}]},{beginKeywords:"new return throw await else",relevance:0},{className:"function",begin:"("+y+"\\s+)+"+n.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,end:/\s*[{;=]/,excludeEnd:!0,keywords:s,contains:[{beginKeywords:e.join(" "),relevance:0},{begin:n.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,contains:[n.TITLE_MODE,b],relevance:0},{match:/\(\)/},{className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:s,relevance:0,contains:[m,l,n.C_BLOCK_COMMENT_MODE]},n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},v]}}var hL=n=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:n.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[n.APOS_STRING_MODE,n.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:n.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),pL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],fL=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],mL=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],gL=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],bL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function pb(n){let t=n.regex,e=hL(n),i={begin:/-(webkit|moz|ms|o)-(?=[a-z])/},r="and or not only",o=/@-?\w[\w]*(-\w+)*/,s="[a-zA-Z-][a-zA-Z0-9_-]*",a=[n.APOS_STRING_MODE,n.QUOTE_STRING_MODE];return{name:"CSS",case_insensitive:!0,illegal:/[=|'\$]/,keywords:{keyframePosition:"from to"},classNameAliases:{keyframePosition:"selector-tag"},contains:[e.BLOCK_COMMENT,i,e.CSS_NUMBER_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/,relevance:0},{className:"selector-class",begin:"\\."+s,relevance:0},e.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",variants:[{begin:":("+mL.join("|")+")"},{begin:":(:)?("+gL.join("|")+")"}]},e.CSS_VARIABLE,{className:"attribute",begin:"\\b("+bL.join("|")+")\\b"},{begin:/:/,end:/[;}{]/,contains:[e.BLOCK_COMMENT,e.HEXCOLOR,e.IMPORTANT,e.CSS_NUMBER_MODE,...a,{begin:/(url|data-uri)\(/,end:/\)/,relevance:0,keywords:{built_in:"url data-uri"},contains:[...a,{className:"string",begin:/[^)]/,endsWithParent:!0,excludeEnd:!0}]},e.FUNCTION_DISPATCH]},{begin:t.lookahead(/@/),end:"[{;]",relevance:0,illegal:/:/,contains:[{className:"keyword",begin:o},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:{$pattern:/[a-z-]+/,keyword:r,attribute:fL.join(" ")},contains:[{begin:/[a-z-]+(?=:)/,className:"attribute"},...a,e.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"\\b("+pL.join("|")+")\\b"}]}}function fb(n){let t=n.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:t.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:t.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}function mb(n){let o={keyword:["break","case","chan","const","continue","default","defer","else","fallthrough","for","func","go","goto","if","import","interface","map","package","range","return","select","struct","switch","type","var"],type:["bool","byte","complex64","complex128","error","float32","float64","int8","int16","int32","int64","string","uint8","uint16","uint32","uint64","int","uint","uintptr","rune"],literal:["true","false","iota","nil"],built_in:["append","cap","close","complex","copy","imag","len","make","new","panic","print","println","real","recover","delete"]};return{name:"Go",aliases:["golang"],keywords:o,illegal:"</",contains:[n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,{className:"string",variants:[n.QUOTE_STRING_MODE,n.APOS_STRING_MODE,{begin:"`",end:"`"}]},{className:"number",variants:[{begin:n.C_NUMBER_RE+"[i]",relevance:1},n.C_NUMBER_MODE]},{begin:/:=/},{className:"function",beginKeywords:"func",end:"\\s*(\\{|$)",excludeEnd:!0,contains:[n.TITLE_MODE,{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:o,illegal:/["']/}]}]}}function gb(n){let t=n.regex,e=/[_A-Za-z][_0-9A-Za-z]*/;return{name:"GraphQL",aliases:["gql"],case_insensitive:!0,disableAutodetect:!1,keywords:{keyword:["query","mutation","subscription","type","input","schema","directive","interface","union","scalar","fragment","enum","on"],literal:["true","false","null"]},contains:[n.HASH_COMMENT_MODE,n.QUOTE_STRING_MODE,n.NUMBER_MODE,{scope:"punctuation",match:/[.]{3}/,relevance:0},{scope:"punctuation",begin:/[\!\(\)\:\=\[\]\{\|\}]{1}/,relevance:0},{scope:"variable",begin:/\$/,end:/\W/,excludeEnd:!0,relevance:0},{scope:"meta",match:/@\w+/,excludeEnd:!0},{scope:"symbol",begin:t.concat(e,t.lookahead(/\s*:/)),relevance:0}],illegal:[/[;<']/,/BEGIN/]}}function bb(n){let t=n.regex,e={className:"number",relevance:0,variants:[{begin:/([+-]+)?[\d]+_[\d_]+/},{begin:n.NUMBER_RE}]},i=n.COMMENT();i.variants=[{begin:/;/,end:/$/},{begin:/#/,end:/$/}];let r={className:"variable",variants:[{begin:/\$[\w\d"][\w\d_]*/},{begin:/\$\{(.*?)\}/}]},o={className:"literal",begin:/\bon|off|true|false|yes|no\b/},s={className:"string",contains:[n.BACKSLASH_ESCAPE],variants:[{begin:"'''",end:"'''",relevance:10},{begin:'"""',end:'"""',relevance:10},{begin:'"',end:'"'},{begin:"'",end:"'"}]},a={begin:/\[/,end:/\]/,contains:[i,o,r,s,e,"self"],relevance:0},l=/[A-Za-z0-9_-]+/,c=/"(\\"|[^"])*"/,u=/'[^']*'/,d=t.either(l,c,u),h=t.concat(d,"(\\s*\\.\\s*",d,")*",t.lookahead(/\s*=\s*[^#\s]/));return{name:"TOML, also INI",aliases:["toml"],case_insensitive:!0,illegal:/\S/,contains:[i,{className:"section",begin:/\[+/,end:/\]+/},{begin:h,className:"attr",starts:{end:/$/,contains:[i,a,o,r,s,e]}}]}}var cr="[0-9](_*[0-9])*",Aa=`\\.(${cr})`,Ia="[0-9a-fA-F](_*[0-9a-fA-F])*",yb={className:"number",variants:[{begin:`(\\b(${cr})((${Aa})|\\.)?|(${Aa}))[eE][+-]?(${cr})[fFdD]?\\b`},{begin:`\\b(${cr})((${Aa})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${Aa})[fFdD]?\\b`},{begin:`\\b(${cr})[fFdD]\\b`},{begin:`\\b0[xX]((${Ia})\\.?|(${Ia})?\\.(${Ia}))[pP][+-]?(${cr})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${Ia})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function vb(n,t,e){return e===-1?"":n.replace(t,i=>vb(n,t,e-1))}function Eb(n){let t=n.regex,e="[\xC0-\u02B8a-zA-Z_$][\xC0-\u02B8a-zA-Z_$0-9]*",i=e+vb("(?:<"+e+"~~~(?:\\s*,\\s*"+e+"~~~)*>)?",/~~~/g,2),l={keyword:["synchronized","abstract","private","var","static","if","const ","for","while","strictfp","finally","protected","import","native","final","void","enum","else","break","transient","catch","instanceof","volatile","case","assert","package","default","public","try","switch","continue","throws","protected","public","private","module","requires","exports","do","sealed","yield","permits"],literal:["false","true","null"],type:["char","boolean","long","float","int","byte","short","double"],built_in:["super","this"]},c={className:"meta",begin:"@"+e,contains:[{begin:/\(/,end:/\)/,contains:["self"]}]},u={className:"params",begin:/\(/,end:/\)/,keywords:l,relevance:0,contains:[n.C_BLOCK_COMMENT_MODE],endsParent:!0};return{name:"Java",aliases:["jsp"],keywords:l,illegal:/<\/|#/,contains:[n.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{begin:/\w+@/,relevance:0},{className:"doctag",begin:"@[A-Za-z]+"}]}),{begin:/import java\.[a-z]+\./,keywords:"import",relevance:2},n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,{begin:/"""/,end:/"""/,className:"string",contains:[n.BACKSLASH_ESCAPE]},n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,{match:[/\b(?:class|interface|enum|extends|implements|new)/,/\s+/,e],className:{1:"keyword",3:"title.class"}},{match:/non-sealed/,scope:"keyword"},{begin:[t.concat(/(?!else)/,e),/\s+/,e,/\s+/,/=(?!=)/],className:{1:"type",3:"variable",5:"operator"}},{begin:[/record/,/\s+/,e],className:{1:"keyword",3:"title.class"},contains:[u,n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},{beginKeywords:"new throw return else",relevance:0},{begin:["(?:"+i+"\\s+)",n.UNDERSCORE_IDENT_RE,/\s*(?=\()/],className:{2:"title.function"},keywords:l,contains:[{className:"params",begin:/\(/,end:/\)/,keywords:l,relevance:0,contains:[c,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,yb,n.C_BLOCK_COMMENT_MODE]},n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},yb,c]}}var xb="[A-Za-z$_][0-9A-Za-z$_]*",yL=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],vL=["true","false","null","undefined","NaN","Infinity"],kb=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],wb=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Sb=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],EL=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],xL=[].concat(Sb,kb,wb);function Mb(n){let t=n.regex,e=(T,{after:A})=>{let B="</"+T[0].slice(1);return T.input.indexOf(B,A)!==-1},i=xb,r={begin:"<>",end:"</>"},o=/<[A-Za-z0-9\\._:-]+\s*\/>/,s={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(T,A)=>{let B=T[0].length+T.index,W=T.input[B];if(W==="<"||W===","){A.ignoreMatch();return}W===">"&&(e(T,{after:B})||A.ignoreMatch());let K,J=T.input.substring(B);if(K=J.match(/^\s*=/)){A.ignoreMatch();return}if((K=J.match(/^\s+extends\s+/))&&K.index===0){A.ignoreMatch();return}}},a={$pattern:xb,keyword:yL,literal:vL,built_in:xL,"variable.language":EL},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",d={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},h={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},p={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[n.BACKSLASH_ESCAPE,h],subLanguage:"xml"}},f={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[n.BACKSLASH_ESCAPE,h],subLanguage:"css"}},g={begin:"gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[n.BACKSLASH_ESCAPE,h],subLanguage:"graphql"}},m={className:"string",begin:"`",end:"`",contains:[n.BACKSLASH_ESCAPE,h]},y={className:"comment",variants:[n.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:i+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),n.C_BLOCK_COMMENT_MODE,n.C_LINE_COMMENT_MODE]},v=[n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,p,f,g,m,{match:/\$\d+/},d];h.contains=v.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(v)});let E=[].concat(y,h.contains),x=E.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(E)}]),k={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x},S={variants:[{match:[/class/,/\s+/,i,/\s+/,/extends/,/\s+/,t.concat(i,"(",t.concat(/\./,i),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,i],scope:{1:"keyword",3:"title.class"}}]},w={relevance:0,match:t.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...kb,...wb]}},C={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},I={variants:[{match:[/function/,/\s+/,i,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[k],illegal:/%/},F={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function N(T){return t.concat("(?!",T.join("|"),")")}let H={match:t.concat(/\b/,N([...Sb,"super","import"]),i,t.lookahead(/\(/)),className:"title.function",relevance:0},_={begin:t.concat(/\./,t.lookahead(t.concat(i,/(?![0-9A-Za-z$_(])/))),end:i,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},P={match:[/get|set/,/\s+/,i,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},k]},L="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+n.UNDERSCORE_IDENT_RE+")\\s*=>",R={match:[/const|var|let/,/\s+/,i,/\s*/,/=\s*/,/(async\s*)?/,t.lookahead(L)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[k]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:x,CLASS_REFERENCE:w},illegal:/#(?![$_A-z])/,contains:[n.SHEBANG({label:"shebang",binary:"node",relevance:5}),C,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,p,f,g,m,y,{match:/\$\d+/},d,w,{className:"attr",begin:i+t.lookahead(":"),relevance:0},R,{begin:"("+n.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[y,n.REGEXP_MODE,{className:"function",begin:L,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:n.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:r.begin,end:r.end},{match:o},{begin:s.begin,"on:begin":s.isTrulyOpeningTag,end:s.end}],subLanguage:"xml",contains:[{begin:s.begin,end:s.end,skip:!0,contains:["self"]}]}]},I,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+n.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[k,n.inherit(n.TITLE_MODE,{begin:i,className:"title.function"})]},{match:/\.\.\./,relevance:0},_,{match:"\\$"+i,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[k]},H,F,S,P,{match:/\$[(.]/}]}}function Tb(n){let t={className:"attr",begin:/"(\\.|[^\\"\r\n])*"(?=\s*:)/,relevance:1.01},e={match:/[{}[\],:]/,className:"punctuation",relevance:0},i=["true","false","null"],r={scope:"literal",beginKeywords:i.join(" ")};return{name:"JSON",keywords:{literal:i},contains:[t,e,n.QUOTE_STRING_MODE,r,n.C_NUMBER_MODE,n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE],illegal:"\\S"}}var ur="[0-9](_*[0-9])*",Na=`\\.(${ur})`,Pa="[0-9a-fA-F](_*[0-9a-fA-F])*",kL={className:"number",variants:[{begin:`(\\b(${ur})((${Na})|\\.)?|(${Na}))[eE][+-]?(${ur})[fFdD]?\\b`},{begin:`\\b(${ur})((${Na})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${Na})[fFdD]?\\b`},{begin:`\\b(${ur})[fFdD]\\b`},{begin:`\\b0[xX]((${Pa})\\.?|(${Pa})?\\.(${Pa}))[pP][+-]?(${ur})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${Pa})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function Cb(n){let t={keyword:"abstract as val var vararg get set class object open private protected public noinline crossinline dynamic final enum if else do while for when throw try catch finally import package is in fun override companion reified inline lateinit init interface annotation data sealed internal infix operator out by constructor super tailrec where const inner suspend typealias external expect actual",built_in:"Byte Short Char Int Long Boolean Float Double Void Unit Nothing",literal:"true false null"},e={className:"keyword",begin:/\b(break|continue|return|this)\b/,starts:{contains:[{className:"symbol",begin:/@\w+/}]}},i={className:"symbol",begin:n.UNDERSCORE_IDENT_RE+"@"},r={className:"subst",begin:/\$\{/,end:/\}/,contains:[n.C_NUMBER_MODE]},o={className:"variable",begin:"\\$"+n.UNDERSCORE_IDENT_RE},s={className:"string",variants:[{begin:'"""',end:'"""(?=[^"])',contains:[o,r]},{begin:"'",end:"'",illegal:/\n/,contains:[n.BACKSLASH_ESCAPE]},{begin:'"',end:'"',illegal:/\n/,contains:[n.BACKSLASH_ESCAPE,o,r]}]};r.contains.push(s);let a={className:"meta",begin:"@(?:file|property|field|get|set|receiver|param|setparam|delegate)\\s*:(?:\\s*"+n.UNDERSCORE_IDENT_RE+")?"},l={className:"meta",begin:"@"+n.UNDERSCORE_IDENT_RE,contains:[{begin:/\(/,end:/\)/,contains:[n.inherit(s,{className:"string"}),"self"]}]},c=kL,u=n.COMMENT("/\\*","\\*/",{contains:[n.C_BLOCK_COMMENT_MODE]}),d={variants:[{className:"type",begin:n.UNDERSCORE_IDENT_RE},{begin:/\(/,end:/\)/,contains:[]}]},h=d;return h.variants[1].contains=[d],d.variants[1].contains=[h],{name:"Kotlin",aliases:["kt","kts"],keywords:t,contains:[n.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"}]}),n.C_LINE_COMMENT_MODE,u,e,i,a,l,{className:"function",beginKeywords:"fun",end:"[(]|$",returnBegin:!0,excludeEnd:!0,keywords:t,relevance:5,contains:[{begin:n.UNDERSCORE_IDENT_RE+"\\s*\\(",returnBegin:!0,relevance:0,contains:[n.UNDERSCORE_TITLE_MODE]},{className:"type",begin:/</,end:/>/,keywords:"reified",relevance:0},{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:t,relevance:0,contains:[{begin:/:/,end:/[=,\/]/,endsWithParent:!0,contains:[d,n.C_LINE_COMMENT_MODE,u],relevance:0},n.C_LINE_COMMENT_MODE,u,a,l,s,n.C_NUMBER_MODE]},u]},{begin:[/class|interface|trait/,/\s+/,n.UNDERSCORE_IDENT_RE],beginScope:{3:"title.class"},keywords:"class interface trait",end:/[:\{(]|$/,excludeEnd:!0,illegal:"extends implements",contains:[{beginKeywords:"public protected internal private constructor"},n.UNDERSCORE_TITLE_MODE,{className:"type",begin:/</,end:/>/,excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:/[,:]\s*/,end:/[<\(,){\s]|$/,excludeBegin:!0,returnEnd:!0},a,l]},s,{className:"meta",begin:"^#!/usr/bin/env",end:"$",illegal:`
`},c]}}var wL=n=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:n.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[n.APOS_STRING_MODE,n.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:n.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),SL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],ML=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],Lb=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],Rb=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],TL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse(),CL=Lb.concat(Rb);function Ab(n){let t=wL(n),e=CL,i="and or not only",r="[\\w-]+",o="("+r+"|@\\{"+r+"\\})",s=[],a=[],l=function(v){return{className:"string",begin:"~?"+v+".*?"+v}},c=function(v,E,x){return{className:v,begin:E,relevance:x}},u={$pattern:/[a-z-]+/,keyword:i,attribute:ML.join(" ")},d={begin:"\\(",end:"\\)",contains:a,keywords:u,relevance:0};a.push(n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,l("'"),l('"'),t.CSS_NUMBER_MODE,{begin:"(url|data-uri)\\(",starts:{className:"string",end:"[\\)\\n]",excludeEnd:!0}},t.HEXCOLOR,d,c("variable","@@?"+r,10),c("variable","@\\{"+r+"\\}"),c("built_in","~?`[^`]*?`"),{className:"attribute",begin:r+"\\s*:",end:":",returnBegin:!0,excludeEnd:!0},t.IMPORTANT,{beginKeywords:"and not"},t.FUNCTION_DISPATCH);let h=a.concat({begin:/\{/,end:/\}/,contains:s}),p={beginKeywords:"when",endsWithParent:!0,contains:[{beginKeywords:"and not"}].concat(a)},f={begin:o+"\\s*:",returnBegin:!0,end:/[;}]/,relevance:0,contains:[{begin:/-(webkit|moz|ms|o)-/},t.CSS_VARIABLE,{className:"attribute",begin:"\\b("+TL.join("|")+")\\b",end:/(?=:)/,starts:{endsWithParent:!0,illegal:"[<=$]",relevance:0,contains:a}}]},g={className:"keyword",begin:"@(import|media|charset|font-face|(-[a-z]+-)?keyframes|supports|document|namespace|page|viewport|host)\\b",starts:{end:"[;{}]",keywords:u,returnEnd:!0,contains:a,relevance:0}},m={className:"variable",variants:[{begin:"@"+r+"\\s*:",relevance:15},{begin:"@"+r}],starts:{end:"[;}]",returnEnd:!0,contains:h}},b={variants:[{begin:"[\\.#:&\\[>]",end:"[;{}]"},{begin:o,end:/\{/}],returnBegin:!0,returnEnd:!0,illegal:`[<='$"]`,relevance:0,contains:[n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,p,c("keyword","all\\b"),c("variable","@\\{"+r+"\\}"),{begin:"\\b("+SL.join("|")+")\\b",className:"selector-tag"},t.CSS_NUMBER_MODE,c("selector-tag",o,0),c("selector-id","#"+o),c("selector-class","\\."+o,0),c("selector-tag","&",0),t.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",begin:":("+Lb.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+Rb.join("|")+")"},{begin:/\(/,end:/\)/,relevance:0,contains:h},{begin:"!important"},t.FUNCTION_DISPATCH]},y={begin:r+`:(:)?(${e.join("|")})`,returnBegin:!0,contains:[b]};return s.push(n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,g,m,y,f,b,p,t.FUNCTION_DISPATCH),{name:"Less",case_insensitive:!0,illegal:`[=>'/<($"]`,contains:s}}function Ib(n){let t="\\[=*\\[",e="\\]=*\\]",i={begin:t,end:e,contains:["self"]},r=[n.COMMENT("--(?!"+t+")","$"),n.COMMENT("--"+t,e,{contains:[i],relevance:10})];return{name:"Lua",keywords:{$pattern:n.UNDERSCORE_IDENT_RE,literal:"true false nil",keyword:"and break do else elseif end for goto if in local not or repeat return then until while",built_in:"_G _ENV _VERSION __index __newindex __mode __call __metatable __tostring __len __gc __add __sub __mul __div __mod __pow __concat __unm __eq __lt __le assert collectgarbage dofile error getfenv getmetatable ipairs load loadfile loadstring module next pairs pcall print rawequal rawget rawset require select setfenv setmetatable tonumber tostring type unpack xpcall arg self coroutine resume yield status wrap create running debug getupvalue debug sethook getmetatable gethook setmetatable setlocal traceback setfenv getinfo setupvalue getlocal getregistry getfenv io lines write close flush open output type read stderr stdin input stdout popen tmpfile math log max acos huge ldexp pi cos tanh pow deg tan cosh sinh random randomseed frexp ceil floor rad abs sqrt modf asin min mod fmod log10 atan2 exp sin atan os exit setlocale date getenv difftime remove time clock tmpname rename execute package preload loadlib loaded loaders cpath config path seeall string sub upper len gfind rep find match char dump gmatch reverse byte format gsub lower table setn insert getn foreachi maxn foreach concat sort remove"},contains:r.concat([{className:"function",beginKeywords:"function",end:"\\)",contains:[n.inherit(n.TITLE_MODE,{begin:"([_a-zA-Z]\\w*\\.)*([_a-zA-Z]\\w*:)?[_a-zA-Z]\\w*"}),{className:"params",begin:"\\(",endsWithParent:!0,contains:r}].concat(r)},n.C_NUMBER_MODE,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,{className:"string",begin:t,end:e,contains:[i],relevance:5}])}}function Nb(n){let t={className:"variable",variants:[{begin:"\\$\\("+n.UNDERSCORE_IDENT_RE+"\\)",contains:[n.BACKSLASH_ESCAPE]},{begin:/\$[@%<?\^\+\*]/}]},e={className:"string",begin:/"/,end:/"/,contains:[n.BACKSLASH_ESCAPE,t]},i={className:"variable",begin:/\$\([\w-]+\s/,end:/\)/,keywords:{built_in:"subst patsubst strip findstring filter filter-out sort word wordlist firstword lastword dir notdir suffix basename addsuffix addprefix join wildcard realpath abspath error warning shell origin flavor foreach if or and call eval file value"},contains:[t]},r={begin:"^"+n.UNDERSCORE_IDENT_RE+"\\s*(?=[:+?]?=)"},o={className:"meta",begin:/^\.PHONY:/,end:/$/,keywords:{$pattern:/[\.\w]+/,keyword:".PHONY"}},s={className:"section",begin:/^[^\s]+:/,end:/$/,contains:[t]};return{name:"Makefile",aliases:["mk","mak","make"],keywords:{$pattern:/[\w-]+/,keyword:"define endef undefine ifdef ifndef ifeq ifneq else endif include -include sinclude override export unexport private vpath"},contains:[n.HASH_COMMENT_MODE,t,e,i,r,o,s]}}function Pb(n){let t=n.regex,e={begin:/<\/?[A-Za-z_]/,end:">",subLanguage:"xml",relevance:0},i={begin:"^[-\\*]{3,}",end:"$"},r={className:"code",variants:[{begin:"(`{3,})[^`](.|\\n)*?\\1`*[ ]*"},{begin:"(~{3,})[^~](.|\\n)*?\\1~*[ ]*"},{begin:"```",end:"```+[ ]*$"},{begin:"~~~",end:"~~~+[ ]*$"},{begin:"`.+?`"},{begin:"(?=^( {4}|\\t))",contains:[{begin:"^( {4}|\\t)",end:"(\\n)$"}],relevance:0}]},o={className:"bullet",begin:"^[ 	]*([*+-]|(\\d+\\.))(?=\\s+)",end:"\\s+",excludeEnd:!0},s={begin:/^\[[^\n]+\]:/,returnBegin:!0,contains:[{className:"symbol",begin:/\[/,end:/\]/,excludeBegin:!0,excludeEnd:!0},{className:"link",begin:/:\s*/,end:/$/,excludeBegin:!0}]},a=/[A-Za-z][A-Za-z0-9+.-]*/,l={variants:[{begin:/\[.+?\]\[.*?\]/,relevance:0},{begin:/\[.+?\]\(((data|javascript|mailto):|(?:http|ftp)s?:\/\/).*?\)/,relevance:2},{begin:t.concat(/\[.+?\]\(/,a,/:\/\/.*?\)/),relevance:2},{begin:/\[.+?\]\([./?&#].*?\)/,relevance:1},{begin:/\[.*?\]\(.*?\)/,relevance:0}],returnBegin:!0,contains:[{match:/\[(?=\])/},{className:"string",relevance:0,begin:"\\[",end:"\\]",excludeBegin:!0,returnEnd:!0},{className:"link",relevance:0,begin:"\\]\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0},{className:"symbol",relevance:0,begin:"\\]\\[",end:"\\]",excludeBegin:!0,excludeEnd:!0}]},c={className:"strong",contains:[],variants:[{begin:/_{2}(?!\s)/,end:/_{2}/},{begin:/\*{2}(?!\s)/,end:/\*{2}/}]},u={className:"emphasis",contains:[],variants:[{begin:/\*(?![*\s])/,end:/\*/},{begin:/_(?![_\s])/,end:/_/,relevance:0}]},d=n.inherit(c,{contains:[]}),h=n.inherit(u,{contains:[]});c.contains.push(h),u.contains.push(d);let p=[e,l];return[c,u,d,h].forEach(m=>{m.contains=m.contains.concat(p)}),p=p.concat(c,u),{name:"Markdown",aliases:["md","mkdown","mkd"],contains:[{className:"section",variants:[{begin:"^#{1,6}",end:"$",contains:p},{begin:"(?=^.+?\\n[=-]{2,}$)",contains:[{begin:"^[=-]*$"},{begin:"^",end:"\\n",contains:p}]}]},e,o,c,u,{className:"quote",begin:"^>\\s+",contains:p,end:"$"},r,i,l,s]}}function _b(n){let t={className:"built_in",begin:"\\b(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)\\w+"},e=/[a-zA-Z@][a-zA-Z0-9_]*/,a={"variable.language":["this","super"],$pattern:e,keyword:["while","export","sizeof","typedef","const","struct","for","union","volatile","static","mutable","if","do","return","goto","enum","else","break","extern","asm","case","default","register","explicit","typename","switch","continue","inline","readonly","assign","readwrite","self","@synchronized","id","typeof","nonatomic","IBOutlet","IBAction","strong","weak","copy","in","out","inout","bycopy","byref","oneway","__strong","__weak","__block","__autoreleasing","@private","@protected","@public","@try","@property","@end","@throw","@catch","@finally","@autoreleasepool","@synthesize","@dynamic","@selector","@optional","@required","@encode","@package","@import","@defs","@compatibility_alias","__bridge","__bridge_transfer","__bridge_retained","__bridge_retain","__covariant","__contravariant","__kindof","_Nonnull","_Nullable","_Null_unspecified","__FUNCTION__","__PRETTY_FUNCTION__","__attribute__","getter","setter","retain","unsafe_unretained","nonnull","nullable","null_unspecified","null_resettable","class","instancetype","NS_DESIGNATED_INITIALIZER","NS_UNAVAILABLE","NS_REQUIRES_SUPER","NS_RETURNS_INNER_POINTER","NS_INLINE","NS_AVAILABLE","NS_DEPRECATED","NS_ENUM","NS_OPTIONS","NS_SWIFT_UNAVAILABLE","NS_ASSUME_NONNULL_BEGIN","NS_ASSUME_NONNULL_END","NS_REFINED_FOR_SWIFT","NS_SWIFT_NAME","NS_SWIFT_NOTHROW","NS_DURING","NS_HANDLER","NS_ENDHANDLER","NS_VALUERETURN","NS_VOIDRETURN"],literal:["false","true","FALSE","TRUE","nil","YES","NO","NULL"],built_in:["dispatch_once_t","dispatch_queue_t","dispatch_sync","dispatch_async","dispatch_once"],type:["int","float","char","unsigned","signed","short","long","double","wchar_t","unichar","void","bool","BOOL","id|0","_Bool"]},l={$pattern:e,keyword:["@interface","@class","@protocol","@implementation"]};return{name:"Objective-C",aliases:["mm","objc","obj-c","obj-c++","objective-c++"],keywords:a,illegal:"</",contains:[t,n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,n.C_NUMBER_MODE,n.QUOTE_STRING_MODE,n.APOS_STRING_MODE,{className:"string",variants:[{begin:'@"',end:'"',illegal:"\\n",contains:[n.BACKSLASH_ESCAPE]}]},{className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},n.inherit(n.QUOTE_STRING_MODE,{className:"string"}),{className:"string",begin:/<.*?>/,end:/$/,illegal:"\\n"},n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE]},{className:"class",begin:"("+l.keyword.join("|")+")\\b",end:/(\{|$)/,excludeEnd:!0,keywords:l,contains:[n.UNDERSCORE_TITLE_MODE]},{begin:"\\."+n.UNDERSCORE_IDENT_RE,relevance:0}]}}function Ob(n){let t=n.regex,e=["abs","accept","alarm","and","atan2","bind","binmode","bless","break","caller","chdir","chmod","chomp","chop","chown","chr","chroot","close","closedir","connect","continue","cos","crypt","dbmclose","dbmopen","defined","delete","die","do","dump","each","else","elsif","endgrent","endhostent","endnetent","endprotoent","endpwent","endservent","eof","eval","exec","exists","exit","exp","fcntl","fileno","flock","for","foreach","fork","format","formline","getc","getgrent","getgrgid","getgrnam","gethostbyaddr","gethostbyname","gethostent","getlogin","getnetbyaddr","getnetbyname","getnetent","getpeername","getpgrp","getpriority","getprotobyname","getprotobynumber","getprotoent","getpwent","getpwnam","getpwuid","getservbyname","getservbyport","getservent","getsockname","getsockopt","given","glob","gmtime","goto","grep","gt","hex","if","index","int","ioctl","join","keys","kill","last","lc","lcfirst","length","link","listen","local","localtime","log","lstat","lt","ma","map","mkdir","msgctl","msgget","msgrcv","msgsnd","my","ne","next","no","not","oct","open","opendir","or","ord","our","pack","package","pipe","pop","pos","print","printf","prototype","push","q|0","qq","quotemeta","qw","qx","rand","read","readdir","readline","readlink","readpipe","recv","redo","ref","rename","require","reset","return","reverse","rewinddir","rindex","rmdir","say","scalar","seek","seekdir","select","semctl","semget","semop","send","setgrent","sethostent","setnetent","setpgrp","setpriority","setprotoent","setpwent","setservent","setsockopt","shift","shmctl","shmget","shmread","shmwrite","shutdown","sin","sleep","socket","socketpair","sort","splice","split","sprintf","sqrt","srand","stat","state","study","sub","substr","symlink","syscall","sysopen","sysread","sysseek","system","syswrite","tell","telldir","tie","tied","time","times","tr","truncate","uc","ucfirst","umask","undef","unless","unlink","unpack","unshift","untie","until","use","utime","values","vec","wait","waitpid","wantarray","warn","when","while","write","x|0","xor","y|0"],i=/[dualxmsipngr]{0,12}/,r={$pattern:/[\w.]+/,keyword:e.join(" ")},o={className:"subst",begin:"[$@]\\{",end:"\\}",keywords:r},s={begin:/->\{/,end:/\}/},a={variants:[{begin:/\$\d/},{begin:t.concat(/[$%@](\^\w\b|#\w+(::\w+)*|\{\w+\}|\w+(::\w*)*)/,"(?![A-Za-z])(?![@$%])")},{begin:/[$%@][^\s\w{]/,relevance:0}]},l=[n.BACKSLASH_ESCAPE,o,a],c=[/!/,/\//,/\|/,/\?/,/'/,/"/,/#/],u=(p,f,g="\\1")=>{let m=g==="\\1"?g:t.concat(g,f);return t.concat(t.concat("(?:",p,")"),f,/(?:\\.|[^\\\/])*?/,m,/(?:\\.|[^\\\/])*?/,g,i)},d=(p,f,g)=>t.concat(t.concat("(?:",p,")"),f,/(?:\\.|[^\\\/])*?/,g,i),h=[a,n.HASH_COMMENT_MODE,n.COMMENT(/^=\w/,/=cut/,{endsWithParent:!0}),s,{className:"string",contains:l,variants:[{begin:"q[qwxr]?\\s*\\(",end:"\\)",relevance:5},{begin:"q[qwxr]?\\s*\\[",end:"\\]",relevance:5},{begin:"q[qwxr]?\\s*\\{",end:"\\}",relevance:5},{begin:"q[qwxr]?\\s*\\|",end:"\\|",relevance:5},{begin:"q[qwxr]?\\s*<",end:">",relevance:5},{begin:"qw\\s+q",end:"q",relevance:5},{begin:"'",end:"'",contains:[n.BACKSLASH_ESCAPE]},{begin:'"',end:'"'},{begin:"`",end:"`",contains:[n.BACKSLASH_ESCAPE]},{begin:/\{\w+\}/,relevance:0},{begin:"-?\\w+\\s*=>",relevance:0}]},{className:"number",begin:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",relevance:0},{begin:"(\\/\\/|"+n.RE_STARTERS_RE+"|\\b(split|return|print|reverse|grep)\\b)\\s*",keywords:"split return print reverse grep",relevance:0,contains:[n.HASH_COMMENT_MODE,{className:"regexp",variants:[{begin:u("s|tr|y",t.either(...c,{capture:!0}))},{begin:u("s|tr|y","\\(","\\)")},{begin:u("s|tr|y","\\[","\\]")},{begin:u("s|tr|y","\\{","\\}")}],relevance:2},{className:"regexp",variants:[{begin:/(m|qr)\/\//,relevance:0},{begin:d("(?:m|qr)?",/\//,/\//)},{begin:d("m|qr",t.either(...c,{capture:!0}),/\1/)},{begin:d("m|qr",/\(/,/\)/)},{begin:d("m|qr",/\[/,/\]/)},{begin:d("m|qr",/\{/,/\}/)}]}]},{className:"function",beginKeywords:"sub",end:"(\\s*\\(.*?\\))?[;{]",excludeEnd:!0,relevance:5,contains:[n.TITLE_MODE]},{begin:"-\\w\\b",relevance:0},{begin:"^__DATA__$",end:"^__END__$",subLanguage:"mojolicious",contains:[{begin:"^@@.*",end:"$",className:"comment"}]}];return o.contains=h,s.contains=h,{name:"Perl",aliases:["pl","pm"],keywords:r,contains:h}}function Db(n){let t=n.regex,e=/(?![A-Za-z0-9])(?![$])/,i=t.concat(/[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/,e),r=t.concat(/(\\?[A-Z][a-z0-9_\x7f-\xff]+|\\?[A-Z]+(?=[A-Z][a-z0-9_\x7f-\xff])){1,}/,e),o={scope:"variable",match:"\\$+"+i},s={scope:"meta",variants:[{begin:/<\?php/,relevance:10},{begin:/<\?=/},{begin:/<\?/,relevance:.1},{begin:/\?>/}]},a={scope:"subst",variants:[{begin:/\$\w+/},{begin:/\{\$/,end:/\}/}]},l=n.inherit(n.APOS_STRING_MODE,{illegal:null}),c=n.inherit(n.QUOTE_STRING_MODE,{illegal:null,contains:n.QUOTE_STRING_MODE.contains.concat(a)}),u={begin:/<<<[ \t]*(?:(\w+)|"(\w+)")\n/,end:/[ \t]*(\w+)\b/,contains:n.QUOTE_STRING_MODE.contains.concat(a),"on:begin":(H,_)=>{_.data._beginMatch=H[1]||H[2]},"on:end":(H,_)=>{_.data._beginMatch!==H[1]&&_.ignoreMatch()}},d=n.END_SAME_AS_BEGIN({begin:/<<<[ \t]*'(\w+)'\n/,end:/[ \t]*(\w+)\b/}),h=`[ 	
]`,p={scope:"string",variants:[c,l,u,d]},f={scope:"number",variants:[{begin:"\\b0[bB][01]+(?:_[01]+)*\\b"},{begin:"\\b0[oO][0-7]+(?:_[0-7]+)*\\b"},{begin:"\\b0[xX][\\da-fA-F]+(?:_[\\da-fA-F]+)*\\b"},{begin:"(?:\\b\\d+(?:_\\d+)*(\\.(?:\\d+(?:_\\d+)*))?|\\B\\.\\d+)(?:[eE][+-]?\\d+)?"}],relevance:0},g=["false","null","true"],m=["__CLASS__","__DIR__","__FILE__","__FUNCTION__","__COMPILER_HALT_OFFSET__","__LINE__","__METHOD__","__NAMESPACE__","__TRAIT__","die","echo","exit","include","include_once","print","require","require_once","array","abstract","and","as","binary","bool","boolean","break","callable","case","catch","class","clone","const","continue","declare","default","do","double","else","elseif","empty","enddeclare","endfor","endforeach","endif","endswitch","endwhile","enum","eval","extends","final","finally","float","for","foreach","from","global","goto","if","implements","instanceof","insteadof","int","integer","interface","isset","iterable","list","match|0","mixed","new","never","object","or","private","protected","public","readonly","real","return","string","switch","throw","trait","try","unset","use","var","void","while","xor","yield"],b=["Error|0","AppendIterator","ArgumentCountError","ArithmeticError","ArrayIterator","ArrayObject","AssertionError","BadFunctionCallException","BadMethodCallException","CachingIterator","CallbackFilterIterator","CompileError","Countable","DirectoryIterator","DivisionByZeroError","DomainException","EmptyIterator","ErrorException","Exception","FilesystemIterator","FilterIterator","GlobIterator","InfiniteIterator","InvalidArgumentException","IteratorIterator","LengthException","LimitIterator","LogicException","MultipleIterator","NoRewindIterator","OutOfBoundsException","OutOfRangeException","OuterIterator","OverflowException","ParentIterator","ParseError","RangeException","RecursiveArrayIterator","RecursiveCachingIterator","RecursiveCallbackFilterIterator","RecursiveDirectoryIterator","RecursiveFilterIterator","RecursiveIterator","RecursiveIteratorIterator","RecursiveRegexIterator","RecursiveTreeIterator","RegexIterator","RuntimeException","SeekableIterator","SplDoublyLinkedList","SplFileInfo","SplFileObject","SplFixedArray","SplHeap","SplMaxHeap","SplMinHeap","SplObjectStorage","SplObserver","SplPriorityQueue","SplQueue","SplStack","SplSubject","SplTempFileObject","TypeError","UnderflowException","UnexpectedValueException","UnhandledMatchError","ArrayAccess","BackedEnum","Closure","Fiber","Generator","Iterator","IteratorAggregate","Serializable","Stringable","Throwable","Traversable","UnitEnum","WeakReference","WeakMap","Directory","__PHP_Incomplete_Class","parent","php_user_filter","self","static","stdClass"],v={keyword:m,literal:(H=>{let _=[];return H.forEach(P=>{_.push(P),P.toLowerCase()===P?_.push(P.toUpperCase()):_.push(P.toLowerCase())}),_})(g),built_in:b},E=H=>H.map(_=>_.replace(/\|\d+$/,"")),x={variants:[{match:[/new/,t.concat(h,"+"),t.concat("(?!",E(b).join("\\b|"),"\\b)"),r],scope:{1:"keyword",4:"title.class"}}]},k=t.concat(i,"\\b(?!\\()"),S={variants:[{match:[t.concat(/::/,t.lookahead(/(?!class\b)/)),k],scope:{2:"variable.constant"}},{match:[/::/,/class/],scope:{2:"variable.language"}},{match:[r,t.concat(/::/,t.lookahead(/(?!class\b)/)),k],scope:{1:"title.class",3:"variable.constant"}},{match:[r,t.concat("::",t.lookahead(/(?!class\b)/))],scope:{1:"title.class"}},{match:[r,/::/,/class/],scope:{1:"title.class",3:"variable.language"}}]},w={scope:"attr",match:t.concat(i,t.lookahead(":"),t.lookahead(/(?!::)/))},C={relevance:0,begin:/\(/,end:/\)/,keywords:v,contains:[w,o,S,n.C_BLOCK_COMMENT_MODE,p,f,x]},I={relevance:0,match:[/\b/,t.concat("(?!fn\\b|function\\b|",E(m).join("\\b|"),"|",E(b).join("\\b|"),"\\b)"),i,t.concat(h,"*"),t.lookahead(/(?=\()/)],scope:{3:"title.function.invoke"},contains:[C]};C.contains.push(I);let F=[w,S,n.C_BLOCK_COMMENT_MODE,p,f,x],N={begin:t.concat(/#\[\s*/,r),beginScope:"meta",end:/]/,endScope:"meta",keywords:{literal:g,keyword:["new","array"]},contains:[{begin:/\[/,end:/]/,keywords:{literal:g,keyword:["new","array"]},contains:["self",...F]},...F,{scope:"meta",match:r}]};return{case_insensitive:!1,keywords:v,contains:[N,n.HASH_COMMENT_MODE,n.COMMENT("//","$"),n.COMMENT("/\\*","\\*/",{contains:[{scope:"doctag",match:"@[A-Za-z]+"}]}),{match:/__halt_compiler\(\);/,keywords:"__halt_compiler",starts:{scope:"comment",end:n.MATCH_NOTHING_RE,contains:[{match:/\?>/,scope:"meta",endsParent:!0}]}},s,{scope:"variable.language",match:/\$this\b/},o,I,S,{match:[/const/,/\s/,i],scope:{1:"keyword",3:"variable.constant"}},x,{scope:"function",relevance:0,beginKeywords:"fn function",end:/[;{]/,excludeEnd:!0,illegal:"[$%\\[]",contains:[{beginKeywords:"use"},n.UNDERSCORE_TITLE_MODE,{begin:"=>",endsParent:!0},{scope:"params",begin:"\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0,keywords:v,contains:["self",o,S,n.C_BLOCK_COMMENT_MODE,p,f]}]},{scope:"class",variants:[{beginKeywords:"enum",illegal:/[($"]/},{beginKeywords:"class interface trait",illegal:/[:($"]/}],relevance:0,end:/\{/,excludeEnd:!0,contains:[{beginKeywords:"extends implements"},n.UNDERSCORE_TITLE_MODE]},{beginKeywords:"namespace",relevance:0,end:";",illegal:/[.']/,contains:[n.inherit(n.UNDERSCORE_TITLE_MODE,{scope:"title.class"})]},{beginKeywords:"use",relevance:0,end:";",contains:[{match:/\b(as|const|function)\b/,scope:"keyword"},n.UNDERSCORE_TITLE_MODE]},p,f]}}function Bb(n){return{name:"PHP template",subLanguage:"xml",contains:[{begin:/<\?(php|=)?/,end:/\?>/,subLanguage:"php",contains:[{begin:"/\\*",end:"\\*/",skip:!0},{begin:'b"',end:'"',skip:!0},{begin:"b'",end:"'",skip:!0},n.inherit(n.APOS_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0}),n.inherit(n.QUOTE_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0})]}]}}function Fb(n){return{name:"Plain text",aliases:["text","txt"],disableAutodetect:!0}}function Hb(n){let t=n.regex,e=/[\p{XID_Start}_]\p{XID_Continue}*/u,i=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],a={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:i,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},l={className:"meta",begin:/^(>>>|\.\.\.) /},c={className:"subst",begin:/\{/,end:/\}/,keywords:a,illegal:/#/},u={begin:/\{\{/,relevance:0},d={className:"string",contains:[n.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[n.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[n.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[n.BACKSLASH_ESCAPE,l,u,c]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[n.BACKSLASH_ESCAPE,l,u,c]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[n.BACKSLASH_ESCAPE,u,c]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[n.BACKSLASH_ESCAPE,u,c]},n.APOS_STRING_MODE,n.QUOTE_STRING_MODE]},h="[0-9](_?[0-9])*",p=`(\\b(${h}))?\\.(${h})|\\b(${h})\\.`,f=`\\b|${i.join("|")}`,g={className:"number",relevance:0,variants:[{begin:`(\\b(${h})|(${p}))[eE][+-]?(${h})[jJ]?(?=${f})`},{begin:`(${p})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${f})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${f})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${f})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${f})`},{begin:`\\b(${h})[jJ](?=${f})`}]},m={className:"comment",begin:t.lookahead(/# type:/),end:/$/,keywords:a,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},b={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:["self",l,g,d,n.HASH_COMMENT_MODE]}]};return c.contains=[d,g,l],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:a,illegal:/(<\/|\?)|=>/,contains:[l,g,{begin:/\bself\b/},{beginKeywords:"if",relevance:0},d,m,n.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,e],scope:{1:"keyword",3:"title.function"},contains:[b]},{variants:[{match:[/\bclass/,/\s+/,e,/\s*/,/\(\s*/,e,/\s*\)/]},{match:[/\bclass/,/\s+/,e]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[g,b,d]}]}}function zb(n){return{aliases:["pycon"],contains:[{className:"meta.prompt",starts:{end:/ |$/,starts:{end:"$",subLanguage:"python"}},variants:[{begin:/^>>>(?=[ ]|$)/},{begin:/^\.\.\.(?=[ ]|$)/}]}]}}function Vb(n){let t=n.regex,e=/(?:(?:[a-zA-Z]|\.[._a-zA-Z])[._a-zA-Z0-9]*)|\.(?!\d)/,i=t.either(/0[xX][0-9a-fA-F]+\.[0-9a-fA-F]*[pP][+-]?\d+i?/,/0[xX][0-9a-fA-F]+(?:[pP][+-]?\d+)?[Li]?/,/(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?[Li]?/),r=/[=!<>:]=|\|\||&&|:::?|<-|<<-|->>|->|\|>|[-+*\/?!$&|:<=>@^~]|\*\*/,o=t.either(/[()]/,/[{}]/,/\[\[/,/[[\]]/,/\\/,/,/);return{name:"R",keywords:{$pattern:e,keyword:"function if in break next repeat else for while",literal:"NULL NA TRUE FALSE Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10",built_in:"LETTERS letters month.abb month.name pi T F abs acos acosh all any anyNA Arg as.call as.character as.complex as.double as.environment as.integer as.logical as.null.default as.numeric as.raw asin asinh atan atanh attr attributes baseenv browser c call ceiling class Conj cos cosh cospi cummax cummin cumprod cumsum digamma dim dimnames emptyenv exp expression floor forceAndCall gamma gc.time globalenv Im interactive invisible is.array is.atomic is.call is.character is.complex is.double is.environment is.expression is.finite is.function is.infinite is.integer is.language is.list is.logical is.matrix is.na is.name is.nan is.null is.numeric is.object is.pairlist is.raw is.recursive is.single is.symbol lazyLoadDBfetch length lgamma list log max min missing Mod names nargs nzchar oldClass on.exit pos.to.env proc.time prod quote range Re rep retracemem return round seq_along seq_len seq.int sign signif sin sinh sinpi sqrt standardGeneric substitute sum switch tan tanh tanpi tracemem trigamma trunc unclass untracemem UseMethod xtfrm"},contains:[n.COMMENT(/#'/,/$/,{contains:[{scope:"doctag",match:/@examples/,starts:{end:t.lookahead(t.either(/\n^#'\s*(?=@[a-zA-Z]+)/,/\n^(?!#')/)),endsParent:!0}},{scope:"doctag",begin:"@param",end:/$/,contains:[{scope:"variable",variants:[{match:e},{match:/`(?:\\.|[^`\\])+`/}],endsParent:!0}]},{scope:"doctag",match:/@[a-zA-Z]+/},{scope:"keyword",match:/\\[a-zA-Z]+/}]}),n.HASH_COMMENT_MODE,{scope:"string",contains:[n.BACKSLASH_ESCAPE],variants:[n.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\(/,end:/\)(-*)"/}),n.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\{/,end:/\}(-*)"/}),n.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\[/,end:/\](-*)"/}),n.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\(/,end:/\)(-*)'/}),n.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\{/,end:/\}(-*)'/}),n.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\[/,end:/\](-*)'/}),{begin:'"',end:'"',relevance:0},{begin:"'",end:"'",relevance:0}]},{relevance:0,variants:[{scope:{1:"operator",2:"number"},match:[r,i]},{scope:{1:"operator",2:"number"},match:[/%[^%]*%/,i]},{scope:{1:"punctuation",2:"number"},match:[o,i]},{scope:{2:"number"},match:[/[^a-zA-Z0-9._]|^/,i]}]},{scope:{3:"operator"},match:[e,/\s+/,/<-/,/\s+/]},{scope:"operator",relevance:0,variants:[{match:r},{match:/%[^%]*%/}]},{scope:"punctuation",relevance:0,match:o},{begin:"`",end:"`",contains:[{begin:/\\./}]}]}}function $b(n){let t=n.regex,e="([a-zA-Z_]\\w*[!?=]?|[-+~]@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?)",i=t.either(/\b([A-Z]+[a-z0-9]+)+/,/\b([A-Z]+[a-z0-9]+)+[A-Z]+/),r=t.concat(i,/(::\w+)*/),s={"variable.constant":["__FILE__","__LINE__","__ENCODING__"],"variable.language":["self","super"],keyword:["alias","and","begin","BEGIN","break","case","class","defined","do","else","elsif","end","END","ensure","for","if","in","module","next","not","or","redo","require","rescue","retry","return","then","undef","unless","until","when","while","yield",...["include","extend","prepend","public","private","protected","raise","throw"]],built_in:["proc","lambda","attr_accessor","attr_reader","attr_writer","define_method","private_constant","module_function"],literal:["true","false","nil"]},a={className:"doctag",begin:"@[A-Za-z]+"},l={begin:"#<",end:">"},c=[n.COMMENT("#","$",{contains:[a]}),n.COMMENT("^=begin","^=end",{contains:[a],relevance:10}),n.COMMENT("^__END__",n.MATCH_NOTHING_RE)],u={className:"subst",begin:/#\{/,end:/\}/,keywords:s},d={className:"string",contains:[n.BACKSLASH_ESCAPE,u],variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/`/,end:/`/},{begin:/%[qQwWx]?\(/,end:/\)/},{begin:/%[qQwWx]?\[/,end:/\]/},{begin:/%[qQwWx]?\{/,end:/\}/},{begin:/%[qQwWx]?</,end:/>/},{begin:/%[qQwWx]?\//,end:/\//},{begin:/%[qQwWx]?%/,end:/%/},{begin:/%[qQwWx]?-/,end:/-/},{begin:/%[qQwWx]?\|/,end:/\|/},{begin:/\B\?(\\\d{1,3})/},{begin:/\B\?(\\x[A-Fa-f0-9]{1,2})/},{begin:/\B\?(\\u\{?[A-Fa-f0-9]{1,6}\}?)/},{begin:/\B\?(\\M-\\C-|\\M-\\c|\\c\\M-|\\M-|\\C-\\M-)[\x20-\x7e]/},{begin:/\B\?\\(c|C-)[\x20-\x7e]/},{begin:/\B\?\\?\S/},{begin:t.concat(/<<[-~]?'?/,t.lookahead(/(\w+)(?=\W)[^\n]*\n(?:[^\n]*\n)*?\s*\1\b/)),contains:[n.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,contains:[n.BACKSLASH_ESCAPE,u]})]}]},h="[1-9](_?[0-9])*|0",p="[0-9](_?[0-9])*",f={className:"number",relevance:0,variants:[{begin:`\\b(${h})(\\.(${p}))?([eE][+-]?(${p})|r)?i?\\b`},{begin:"\\b0[dD][0-9](_?[0-9])*r?i?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*r?i?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*r?i?\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*r?i?\\b"},{begin:"\\b0(_?[0-7])+r?i?\\b"}]},g={variants:[{match:/\(\)/},{className:"params",begin:/\(/,end:/(?=\))/,excludeBegin:!0,endsParent:!0,keywords:s}]},k=[d,{variants:[{match:[/class\s+/,r,/\s+<\s+/,r]},{match:[/\b(class|module)\s+/,r]}],scope:{2:"title.class",4:"title.class.inherited"},keywords:s},{match:[/(include|extend)\s+/,r],scope:{2:"title.class"},keywords:s},{relevance:0,match:[r,/\.new[. (]/],scope:{1:"title.class"}},{relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"},{relevance:0,match:i,scope:"title.class"},{match:[/def/,/\s+/,e],scope:{1:"keyword",3:"title.function"},contains:[g]},{begin:n.IDENT_RE+"::"},{className:"symbol",begin:n.UNDERSCORE_IDENT_RE+"(!|\\?)?:",relevance:0},{className:"symbol",begin:":(?!\\s)",contains:[d,{begin:e}],relevance:0},f,{className:"variable",begin:"(\\$\\W)|((\\$|@@?)(\\w+))(?=[^@$?])(?![A-Za-z])(?![@$?'])"},{className:"params",begin:/\|/,end:/\|/,excludeBegin:!0,excludeEnd:!0,relevance:0,keywords:s},{begin:"("+n.RE_STARTERS_RE+"|unless)\\s*",keywords:"unless",contains:[{className:"regexp",contains:[n.BACKSLASH_ESCAPE,u],illegal:/\n/,variants:[{begin:"/",end:"/[a-z]*"},{begin:/%r\{/,end:/\}[a-z]*/},{begin:"%r\\(",end:"\\)[a-z]*"},{begin:"%r!",end:"![a-z]*"},{begin:"%r\\[",end:"\\][a-z]*"}]}].concat(l,c),relevance:0}].concat(l,c);u.contains=k,g.contains=k;let I=[{begin:/^\s*=>/,starts:{end:"$",contains:k}},{className:"meta.prompt",begin:"^("+"[>?]>"+"|"+"[\\w#]+\\(\\w+\\):\\d+:\\d+[>*]"+"|"+"(\\w+-)?\\d+\\.\\d+\\.\\d+(p\\d+)?[^\\d][^>]+>"+")(?=[ ])",starts:{end:"$",keywords:s,contains:k}}];return c.unshift(l),{name:"Ruby",aliases:["rb","gemspec","podspec","thor","irb"],keywords:s,illegal:/\/\*/,contains:[n.SHEBANG({binary:"ruby"})].concat(I).concat(c).concat(k)}}function Wb(n){let t=n.regex,e={className:"title.function.invoke",relevance:0,begin:t.concat(/\b/,/(?!let\b)/,n.IDENT_RE,t.lookahead(/\s*\(/))},i="([ui](8|16|32|64|128|size)|f(32|64))?",r=["abstract","as","async","await","become","box","break","const","continue","crate","do","dyn","else","enum","extern","false","final","fn","for","if","impl","in","let","loop","macro","match","mod","move","mut","override","priv","pub","ref","return","self","Self","static","struct","super","trait","true","try","type","typeof","unsafe","unsized","use","virtual","where","while","yield"],o=["true","false","Some","None","Ok","Err"],s=["drop ","Copy","Send","Sized","Sync","Drop","Fn","FnMut","FnOnce","ToOwned","Clone","Debug","PartialEq","PartialOrd","Eq","Ord","AsRef","AsMut","Into","From","Default","Iterator","Extend","IntoIterator","DoubleEndedIterator","ExactSizeIterator","SliceConcatExt","ToString","assert!","assert_eq!","bitflags!","bytes!","cfg!","col!","concat!","concat_idents!","debug_assert!","debug_assert_eq!","env!","panic!","file!","format!","format_args!","include_bytes!","include_str!","line!","local_data_key!","module_path!","option_env!","print!","println!","select!","stringify!","try!","unimplemented!","unreachable!","vec!","write!","writeln!","macro_rules!","assert_ne!","debug_assert_ne!"],a=["i8","i16","i32","i64","i128","isize","u8","u16","u32","u64","u128","usize","f32","f64","str","char","bool","Box","Option","Result","String","Vec"];return{name:"Rust",aliases:["rs"],keywords:{$pattern:n.IDENT_RE+"!?",type:a,keyword:r,literal:o,built_in:s},illegal:"</",contains:[n.C_LINE_COMMENT_MODE,n.COMMENT("/\\*","\\*/",{contains:["self"]}),n.inherit(n.QUOTE_STRING_MODE,{begin:/b?"/,illegal:null}),{className:"string",variants:[{begin:/b?r(#*)"(.|\n)*?"\1(?!#)/},{begin:/b?'\\?(x\w{2}|u\w{4}|U\w{8}|.)'/}]},{className:"symbol",begin:/'[a-zA-Z_][a-zA-Z0-9_]*/},{className:"number",variants:[{begin:"\\b0b([01_]+)"+i},{begin:"\\b0o([0-7_]+)"+i},{begin:"\\b0x([A-Fa-f0-9_]+)"+i},{begin:"\\b(\\d[\\d_]*(\\.[0-9_]+)?([eE][+-]?[0-9_]+)?)"+i}],relevance:0},{begin:[/fn/,/\s+/,n.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.function"}},{className:"meta",begin:"#!?\\[",end:"\\]",contains:[{className:"string",begin:/"/,end:/"/}]},{begin:[/let/,/\s+/,/(?:mut\s+)?/,n.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"keyword",4:"variable"}},{begin:[/for/,/\s+/,n.UNDERSCORE_IDENT_RE,/\s+/,/in/],className:{1:"keyword",3:"variable",5:"keyword"}},{begin:[/type/,/\s+/,n.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.class"}},{begin:[/(?:trait|enum|struct|union|impl|for)/,/\s+/,n.UNDERSCORE_IDENT_RE],className:{1:"keyword",3:"title.class"}},{begin:n.IDENT_RE+"::",keywords:{keyword:"Self",built_in:s,type:a}},{className:"punctuation",begin:"->"},e]}}var LL=n=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:n.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[n.APOS_STRING_MODE,n.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:n.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),RL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],AL=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],IL=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],NL=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],PL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function Ub(n){let t=LL(n),e=NL,i=IL,r="@[a-z-]+",o="and or not only",a={className:"variable",begin:"(\\$"+"[a-zA-Z-][a-zA-Z0-9_-]*"+")\\b",relevance:0};return{name:"SCSS",case_insensitive:!0,illegal:"[=/|']",contains:[n.C_LINE_COMMENT_MODE,n.C_BLOCK_COMMENT_MODE,t.CSS_NUMBER_MODE,{className:"selector-id",begin:"#[A-Za-z0-9_-]+",relevance:0},{className:"selector-class",begin:"\\.[A-Za-z0-9_-]+",relevance:0},t.ATTRIBUTE_SELECTOR_MODE,{className:"selector-tag",begin:"\\b("+RL.join("|")+")\\b",relevance:0},{className:"selector-pseudo",begin:":("+i.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+e.join("|")+")"},a,{begin:/\(/,end:/\)/,contains:[t.CSS_NUMBER_MODE]},t.CSS_VARIABLE,{className:"attribute",begin:"\\b("+PL.join("|")+")\\b"},{begin:"\\b(whitespace|wait|w-resize|visible|vertical-text|vertical-ideographic|uppercase|upper-roman|upper-alpha|underline|transparent|top|thin|thick|text|text-top|text-bottom|tb-rl|table-header-group|table-footer-group|sw-resize|super|strict|static|square|solid|small-caps|separate|se-resize|scroll|s-resize|rtl|row-resize|ridge|right|repeat|repeat-y|repeat-x|relative|progress|pointer|overline|outside|outset|oblique|nowrap|not-allowed|normal|none|nw-resize|no-repeat|no-drop|newspaper|ne-resize|n-resize|move|middle|medium|ltr|lr-tb|lowercase|lower-roman|lower-alpha|loose|list-item|line|line-through|line-edge|lighter|left|keep-all|justify|italic|inter-word|inter-ideograph|inside|inset|inline|inline-block|inherit|inactive|ideograph-space|ideograph-parenthesis|ideograph-numeric|ideograph-alpha|horizontal|hidden|help|hand|groove|fixed|ellipsis|e-resize|double|dotted|distribute|distribute-space|distribute-letter|distribute-all-lines|disc|disabled|default|decimal|dashed|crosshair|collapse|col-resize|circle|char|center|capitalize|break-word|break-all|bottom|both|bolder|bold|block|bidi-override|below|baseline|auto|always|all-scroll|absolute|table|table-cell)\\b"},{begin:/:/,end:/[;}{]/,relevance:0,contains:[t.BLOCK_COMMENT,a,t.HEXCOLOR,t.CSS_NUMBER_MODE,n.QUOTE_STRING_MODE,n.APOS_STRING_MODE,t.IMPORTANT,t.FUNCTION_DISPATCH]},{begin:"@(page|font-face)",keywords:{$pattern:r,keyword:"@page @font-face"}},{begin:"@",end:"[{;]",returnBegin:!0,keywords:{$pattern:/[a-z-]+/,keyword:o,attribute:AL.join(" ")},contains:[{begin:r,className:"keyword"},{begin:/[a-z-]+(?=:)/,className:"attribute"},a,n.QUOTE_STRING_MODE,n.APOS_STRING_MODE,t.HEXCOLOR,t.CSS_NUMBER_MODE]},t.FUNCTION_DISPATCH]}}function Kb(n){return{name:"Shell Session",aliases:["console","shellsession"],contains:[{className:"meta.prompt",begin:/^\s{0,3}[/~\w\d[\]()@-]*[>%$#][ ]?/,starts:{end:/[^\\](?=\s*$)/,subLanguage:"bash"}}]}}function qb(n){let t=n.regex,e=n.COMMENT("--","$"),i={className:"string",variants:[{begin:/'/,end:/'/,contains:[{begin:/''/}]}]},r={begin:/"/,end:/"/,contains:[{begin:/""/}]},o=["true","false","unknown"],s=["double precision","large object","with timezone","without timezone"],a=["bigint","binary","blob","boolean","char","character","clob","date","dec","decfloat","decimal","float","int","integer","interval","nchar","nclob","national","numeric","real","row","smallint","time","timestamp","varchar","varying","varbinary"],l=["add","asc","collation","desc","final","first","last","view"],c=["abs","acos","all","allocate","alter","and","any","are","array","array_agg","array_max_cardinality","as","asensitive","asin","asymmetric","at","atan","atomic","authorization","avg","begin","begin_frame","begin_partition","between","bigint","binary","blob","boolean","both","by","call","called","cardinality","cascaded","case","cast","ceil","ceiling","char","char_length","character","character_length","check","classifier","clob","close","coalesce","collate","collect","column","commit","condition","connect","constraint","contains","convert","copy","corr","corresponding","cos","cosh","count","covar_pop","covar_samp","create","cross","cube","cume_dist","current","current_catalog","current_date","current_default_transform_group","current_path","current_role","current_row","current_schema","current_time","current_timestamp","current_path","current_role","current_transform_group_for_type","current_user","cursor","cycle","date","day","deallocate","dec","decimal","decfloat","declare","default","define","delete","dense_rank","deref","describe","deterministic","disconnect","distinct","double","drop","dynamic","each","element","else","empty","end","end_frame","end_partition","end-exec","equals","escape","every","except","exec","execute","exists","exp","external","extract","false","fetch","filter","first_value","float","floor","for","foreign","frame_row","free","from","full","function","fusion","get","global","grant","group","grouping","groups","having","hold","hour","identity","in","indicator","initial","inner","inout","insensitive","insert","int","integer","intersect","intersection","interval","into","is","join","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","language","large","last_value","lateral","lead","leading","left","like","like_regex","listagg","ln","local","localtime","localtimestamp","log","log10","lower","match","match_number","match_recognize","matches","max","member","merge","method","min","minute","mod","modifies","module","month","multiset","national","natural","nchar","nclob","new","no","none","normalize","not","nth_value","ntile","null","nullif","numeric","octet_length","occurrences_regex","of","offset","old","omit","on","one","only","open","or","order","out","outer","over","overlaps","overlay","parameter","partition","pattern","per","percent","percent_rank","percentile_cont","percentile_disc","period","portion","position","position_regex","power","precedes","precision","prepare","primary","procedure","ptf","range","rank","reads","real","recursive","ref","references","referencing","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","release","result","return","returns","revoke","right","rollback","rollup","row","row_number","rows","running","savepoint","scope","scroll","search","second","seek","select","sensitive","session_user","set","show","similar","sin","sinh","skip","smallint","some","specific","specifictype","sql","sqlexception","sqlstate","sqlwarning","sqrt","start","static","stddev_pop","stddev_samp","submultiset","subset","substring","substring_regex","succeeds","sum","symmetric","system","system_time","system_user","table","tablesample","tan","tanh","then","time","timestamp","timezone_hour","timezone_minute","to","trailing","translate","translate_regex","translation","treat","trigger","trim","trim_array","true","truncate","uescape","union","unique","unknown","unnest","update","upper","user","using","value","values","value_of","var_pop","var_samp","varbinary","varchar","varying","versioning","when","whenever","where","width_bucket","window","with","within","without","year"],u=["abs","acos","array_agg","asin","atan","avg","cast","ceil","ceiling","coalesce","corr","cos","cosh","count","covar_pop","covar_samp","cume_dist","dense_rank","deref","element","exp","extract","first_value","floor","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","last_value","lead","listagg","ln","log","log10","lower","max","min","mod","nth_value","ntile","nullif","percent_rank","percentile_cont","percentile_disc","position","position_regex","power","rank","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","row_number","sin","sinh","sqrt","stddev_pop","stddev_samp","substring","substring_regex","sum","tan","tanh","translate","translate_regex","treat","trim","trim_array","unnest","upper","value_of","var_pop","var_samp","width_bucket"],d=["current_catalog","current_date","current_default_transform_group","current_path","current_role","current_schema","current_transform_group_for_type","current_user","session_user","system_time","system_user","current_time","localtime","current_timestamp","localtimestamp"],h=["create table","insert into","primary key","foreign key","not null","alter table","add constraint","grouping sets","on overflow","character set","respect nulls","ignore nulls","nulls first","nulls last","depth first","breadth first"],p=u,f=[...c,...l].filter(v=>!u.includes(v)),g={className:"variable",begin:/@[a-z0-9][a-z0-9_]*/},m={className:"operator",begin:/[-+*/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?/,relevance:0},b={begin:t.concat(/\b/,t.either(...p),/\s*\(/),relevance:0,keywords:{built_in:p}};function y(v,{exceptions:E,when:x}={}){let k=x;return E=E||[],v.map(S=>S.match(/\|\d+$/)||E.includes(S)?S:k(S)?`${S}|0`:S)}return{name:"SQL",case_insensitive:!0,illegal:/[{}]|<\//,keywords:{$pattern:/\b[\w\.]+/,keyword:y(f,{when:v=>v.length<3}),literal:o,type:a,built_in:d},contains:[{begin:t.either(...h),relevance:0,keywords:{$pattern:/[\w\.]+/,keyword:f.concat(h),literal:o,type:a}},{className:"type",begin:t.either(...s)},b,g,i,r,n.C_NUMBER_MODE,n.C_BLOCK_COMMENT_MODE,e,m]}}function Xb(n){return n?typeof n=="string"?n:n.source:null}function _a(n){return Te("(?=",n,")")}function Te(...n){return n.map(e=>Xb(e)).join("")}function _L(n){let t=n[n.length-1];return typeof t=="object"&&t.constructor===Object?(n.splice(n.length-1,1),t):{}}function wt(...n){return"("+(_L(n).capture?"":"?:")+n.map(i=>Xb(i)).join("|")+")"}var zd=n=>Te(/\b/,n,/\w$/.test(n)?/\b/:/\B/),OL=["Protocol","Type"].map(zd),Gb=["init","self"].map(zd),DL=["Any","Self"],Bd=["actor","any","associatedtype","async","await",/as\?/,/as!/,"as","break","case","catch","class","continue","convenience","default","defer","deinit","didSet","distributed","do","dynamic","else","enum","extension","fallthrough",/fileprivate\(set\)/,"fileprivate","final","for","func","get","guard","if","import","indirect","infix",/init\?/,/init!/,"inout",/internal\(set\)/,"internal","in","is","isolated","nonisolated","lazy","let","mutating","nonmutating",/open\(set\)/,"open","operator","optional","override","postfix","precedencegroup","prefix",/private\(set\)/,"private","protocol",/public\(set\)/,"public","repeat","required","rethrows","return","set","some","static","struct","subscript","super","switch","throws","throw",/try\?/,/try!/,"try","typealias",/unowned\(safe\)/,/unowned\(unsafe\)/,"unowned","var","weak","where","while","willSet"],jb=["false","nil","true"],BL=["assignment","associativity","higherThan","left","lowerThan","none","right"],FL=["#colorLiteral","#column","#dsohandle","#else","#elseif","#endif","#error","#file","#fileID","#fileLiteral","#filePath","#function","#if","#imageLiteral","#keyPath","#line","#selector","#sourceLocation","#warn_unqualified_access","#warning"],Yb=["abs","all","any","assert","assertionFailure","debugPrint","dump","fatalError","getVaList","isKnownUniquelyReferenced","max","min","numericCast","pointwiseMax","pointwiseMin","precondition","preconditionFailure","print","readLine","repeatElement","sequence","stride","swap","swift_unboxFromSwiftValueWithType","transcode","type","unsafeBitCast","unsafeDowncast","withExtendedLifetime","withUnsafeMutablePointer","withUnsafePointer","withVaList","withoutActuallyEscaping","zip"],Jb=wt(/[/=\-+!*%<>&|^~?]/,/[\u00A1-\u00A7]/,/[\u00A9\u00AB]/,/[\u00AC\u00AE]/,/[\u00B0\u00B1]/,/[\u00B6\u00BB\u00BF\u00D7\u00F7]/,/[\u2016-\u2017]/,/[\u2020-\u2027]/,/[\u2030-\u203E]/,/[\u2041-\u2053]/,/[\u2055-\u205E]/,/[\u2190-\u23FF]/,/[\u2500-\u2775]/,/[\u2794-\u2BFF]/,/[\u2E00-\u2E7F]/,/[\u3001-\u3003]/,/[\u3008-\u3020]/,/[\u3030]/),Zb=wt(Jb,/[\u0300-\u036F]/,/[\u1DC0-\u1DFF]/,/[\u20D0-\u20FF]/,/[\uFE00-\uFE0F]/,/[\uFE20-\uFE2F]/),Fd=Te(Jb,Zb,"*"),Qb=wt(/[a-zA-Z_]/,/[\u00A8\u00AA\u00AD\u00AF\u00B2-\u00B5\u00B7-\u00BA]/,/[\u00BC-\u00BE\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF]/,/[\u0100-\u02FF\u0370-\u167F\u1681-\u180D\u180F-\u1DBF]/,/[\u1E00-\u1FFF]/,/[\u200B-\u200D\u202A-\u202E\u203F-\u2040\u2054\u2060-\u206F]/,/[\u2070-\u20CF\u2100-\u218F\u2460-\u24FF\u2776-\u2793]/,/[\u2C00-\u2DFF\u2E80-\u2FFF]/,/[\u3004-\u3007\u3021-\u302F\u3031-\u303F\u3040-\uD7FF]/,/[\uF900-\uFD3D\uFD40-\uFDCF\uFDF0-\uFE1F\uFE30-\uFE44]/,/[\uFE47-\uFEFE\uFF00-\uFFFD]/),Oa=wt(Qb,/\d/,/[\u0300-\u036F\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]/),Mn=Te(Qb,Oa,"*"),Hd=Te(/[A-Z]/,Oa,"*"),HL=["autoclosure",Te(/convention\(/,wt("swift","block","c"),/\)/),"discardableResult","dynamicCallable","dynamicMemberLookup","escaping","frozen","GKInspectable","IBAction","IBDesignable","IBInspectable","IBOutlet","IBSegueAction","inlinable","main","nonobjc","NSApplicationMain","NSCopying","NSManaged",Te(/objc\(/,Mn,/\)/),"objc","objcMembers","propertyWrapper","requires_stored_property_inits","resultBuilder","testable","UIApplicationMain","unknown","usableFromInline"],zL=["iOS","iOSApplicationExtension","macOS","macOSApplicationExtension","macCatalyst","macCatalystApplicationExtension","watchOS","watchOSApplicationExtension","tvOS","tvOSApplicationExtension","swift"];function ey(n){let t={match:/\s+/,relevance:0},e=n.COMMENT("/\\*","\\*/",{contains:["self"]}),i=[n.C_LINE_COMMENT_MODE,e],r={match:[/\./,wt(...OL,...Gb)],className:{2:"keyword"}},o={match:Te(/\./,wt(...Bd)),relevance:0},s=Bd.filter(pe=>typeof pe=="string").concat(["_|0"]),a=Bd.filter(pe=>typeof pe!="string").concat(DL).map(zd),l={variants:[{className:"keyword",match:wt(...a,...Gb)}]},c={$pattern:wt(/\b\w+/,/#\w+/),keyword:s.concat(FL),literal:jb},u=[r,o,l],d={match:Te(/\./,wt(...Yb)),relevance:0},h={className:"built_in",match:Te(/\b/,wt(...Yb),/(?=\()/)},p=[d,h],f={match:/->/,relevance:0},g={className:"operator",relevance:0,variants:[{match:Fd},{match:`\\.(\\.|${Zb})+`}]},m=[f,g],b="([0-9]_*)+",y="([0-9a-fA-F]_*)+",v={className:"number",relevance:0,variants:[{match:`\\b(${b})(\\.(${b}))?([eE][+-]?(${b}))?\\b`},{match:`\\b0x(${y})(\\.(${y}))?([pP][+-]?(${b}))?\\b`},{match:/\b0o([0-7]_*)+\b/},{match:/\b0b([01]_*)+\b/}]},E=(pe="")=>({className:"subst",variants:[{match:Te(/\\/,pe,/[0\\tnr"']/)},{match:Te(/\\/,pe,/u\{[0-9a-fA-F]{1,8}\}/)}]}),x=(pe="")=>({className:"subst",match:Te(/\\/,pe,/[\t ]*(?:[\r\n]|\r\n)/)}),k=(pe="")=>({className:"subst",label:"interpol",begin:Te(/\\/,pe,/\(/),end:/\)/}),S=(pe="")=>({begin:Te(pe,/"""/),end:Te(/"""/,pe),contains:[E(pe),x(pe),k(pe)]}),w=(pe="")=>({begin:Te(pe,/"/),end:Te(/"/,pe),contains:[E(pe),k(pe)]}),C={className:"string",variants:[S(),S("#"),S("##"),S("###"),w(),w("#"),w("##"),w("###")]},I={match:Te(/`/,Mn,/`/)},F={className:"variable",match:/\$\d+/},N={className:"variable",match:`\\$${Oa}+`},H=[I,F,N],_={match:/(@|#(un)?)available/,className:"keyword",starts:{contains:[{begin:/\(/,end:/\)/,keywords:zL,contains:[...m,v,C]}]}},P={className:"keyword",match:Te(/@/,wt(...HL))},L={className:"meta",match:Te(/@/,Mn)},R=[_,P,L],T={match:_a(/\b[A-Z]/),relevance:0,contains:[{className:"type",match:Te(/(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)/,Oa,"+")},{className:"type",match:Hd,relevance:0},{match:/[?!]+/,relevance:0},{match:/\.\.\./,relevance:0},{match:Te(/\s+&\s+/,_a(Hd)),relevance:0}]},A={begin:/</,end:/>/,keywords:c,contains:[...i,...u,...R,f,T]};T.contains.push(A);let B={match:Te(Mn,/\s*:/),keywords:"_|0",relevance:0},W={begin:/\(/,end:/\)/,relevance:0,keywords:c,contains:["self",B,...i,...u,...p,...m,v,C,...H,...R,T]},K={begin:/</,end:/>/,contains:[...i,T]},J={begin:wt(_a(Te(Mn,/\s*:/)),_a(Te(Mn,/\s+/,Mn,/\s*:/))),end:/:/,relevance:0,contains:[{className:"keyword",match:/\b_\b/},{className:"params",match:Mn}]},Z={begin:/\(/,end:/\)/,keywords:c,contains:[J,...i,...u,...m,v,C,...R,T,W],endsParent:!0,illegal:/["']/},ee={match:[/func/,/\s+/,wt(I.match,Mn,Fd)],className:{1:"keyword",3:"title.function"},contains:[K,Z,t],illegal:[/\[/,/%/]},Me={match:[/\b(?:subscript|init[?!]?)/,/\s*(?=[<(])/],className:{1:"keyword"},contains:[K,Z,t],illegal:/\[|%/},Be={match:[/operator/,/\s+/,Fd],className:{1:"keyword",3:"title"}},ye={begin:[/precedencegroup/,/\s+/,Hd],className:{1:"keyword",3:"title"},contains:[T],keywords:[...BL,...jb],end:/}/};for(let pe of C.variants){let Fe=pe.contains.find(Mt=>Mt.label==="interpol");Fe.keywords=c;let rt=[...u,...p,...m,v,C,...H];Fe.contains=[...rt,{begin:/\(/,end:/\)/,contains:["self",...rt]}]}return{name:"Swift",keywords:c,contains:[...i,ee,Me,{beginKeywords:"struct protocol class extension enum actor",end:"\\{",excludeEnd:!0,keywords:c,contains:[n.inherit(n.TITLE_MODE,{className:"title.class",begin:/[A-Za-z$_][\u00C0-\u02B80-9A-Za-z$_]*/}),...u]},Be,ye,{beginKeywords:"import",end:/$/,contains:[...i],relevance:0},...u,...p,...m,v,C,...H,...R,T,W]}}var Da="[A-Za-z$_][0-9A-Za-z$_]*",ty=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],ny=["true","false","null","undefined","NaN","Infinity"],iy=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],ry=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],oy=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],sy=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],ay=[].concat(oy,iy,ry);function VL(n){let t=n.regex,e=(T,{after:A})=>{let B="</"+T[0].slice(1);return T.input.indexOf(B,A)!==-1},i=Da,r={begin:"<>",end:"</>"},o=/<[A-Za-z0-9\\._:-]+\s*\/>/,s={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(T,A)=>{let B=T[0].length+T.index,W=T.input[B];if(W==="<"||W===","){A.ignoreMatch();return}W===">"&&(e(T,{after:B})||A.ignoreMatch());let K,J=T.input.substring(B);if(K=J.match(/^\s*=/)){A.ignoreMatch();return}if((K=J.match(/^\s+extends\s+/))&&K.index===0){A.ignoreMatch();return}}},a={$pattern:Da,keyword:ty,literal:ny,built_in:ay,"variable.language":sy},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",d={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},h={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},p={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[n.BACKSLASH_ESCAPE,h],subLanguage:"xml"}},f={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[n.BACKSLASH_ESCAPE,h],subLanguage:"css"}},g={begin:"gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[n.BACKSLASH_ESCAPE,h],subLanguage:"graphql"}},m={className:"string",begin:"`",end:"`",contains:[n.BACKSLASH_ESCAPE,h]},y={className:"comment",variants:[n.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:i+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),n.C_BLOCK_COMMENT_MODE,n.C_LINE_COMMENT_MODE]},v=[n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,p,f,g,m,{match:/\$\d+/},d];h.contains=v.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(v)});let E=[].concat(y,h.contains),x=E.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(E)}]),k={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x},S={variants:[{match:[/class/,/\s+/,i,/\s+/,/extends/,/\s+/,t.concat(i,"(",t.concat(/\./,i),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,i],scope:{1:"keyword",3:"title.class"}}]},w={relevance:0,match:t.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...iy,...ry]}},C={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},I={variants:[{match:[/function/,/\s+/,i,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[k],illegal:/%/},F={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function N(T){return t.concat("(?!",T.join("|"),")")}let H={match:t.concat(/\b/,N([...oy,"super","import"]),i,t.lookahead(/\(/)),className:"title.function",relevance:0},_={begin:t.concat(/\./,t.lookahead(t.concat(i,/(?![0-9A-Za-z$_(])/))),end:i,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},P={match:[/get|set/,/\s+/,i,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},k]},L="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+n.UNDERSCORE_IDENT_RE+")\\s*=>",R={match:[/const|var|let/,/\s+/,i,/\s*/,/=\s*/,/(async\s*)?/,t.lookahead(L)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[k]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:x,CLASS_REFERENCE:w},illegal:/#(?![$_A-z])/,contains:[n.SHEBANG({label:"shebang",binary:"node",relevance:5}),C,n.APOS_STRING_MODE,n.QUOTE_STRING_MODE,p,f,g,m,y,{match:/\$\d+/},d,w,{className:"attr",begin:i+t.lookahead(":"),relevance:0},R,{begin:"("+n.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[y,n.REGEXP_MODE,{className:"function",begin:L,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:n.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:x}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:r.begin,end:r.end},{match:o},{begin:s.begin,"on:begin":s.isTrulyOpeningTag,end:s.end}],subLanguage:"xml",contains:[{begin:s.begin,end:s.end,skip:!0,contains:["self"]}]}]},I,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+n.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[k,n.inherit(n.TITLE_MODE,{begin:i,className:"title.function"})]},{match:/\.\.\./,relevance:0},_,{match:"\\$"+i,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[k]},H,F,S,P,{match:/\$[(.]/}]}}function ly(n){let t=VL(n),e=Da,i=["any","void","number","boolean","string","object","never","symbol","bigint","unknown"],r={beginKeywords:"namespace",end:/\{/,excludeEnd:!0,contains:[t.exports.CLASS_REFERENCE]},o={beginKeywords:"interface",end:/\{/,excludeEnd:!0,keywords:{keyword:"interface extends",built_in:i},contains:[t.exports.CLASS_REFERENCE]},s={className:"meta",relevance:10,begin:/^\s*['"]use strict['"]/},a=["type","namespace","interface","public","private","protected","implements","declare","abstract","readonly","enum","override"],l={$pattern:Da,keyword:ty.concat(a),literal:ny,built_in:ay.concat(i),"variable.language":sy},c={className:"meta",begin:"@"+e},u=(h,p,f)=>{let g=h.contains.findIndex(m=>m.label===p);if(g===-1)throw new Error("can not find mode to replace");h.contains.splice(g,1,f)};Object.assign(t.keywords,l),t.exports.PARAMS_CONTAINS.push(c),t.contains=t.contains.concat([c,r,o]),u(t,"shebang",n.SHEBANG()),u(t,"use_strict",s);let d=t.contains.find(h=>h.label==="func.def");return d.relevance=0,Object.assign(t,{name:"TypeScript",aliases:["ts","tsx","mts","cts"]}),t}function cy(n){let t=n.regex,e={className:"string",begin:/"(""|[^/n])"C\b/},i={className:"string",begin:/"/,end:/"/,illegal:/\n/,contains:[{begin:/""/}]},r=/\d{1,2}\/\d{1,2}\/\d{4}/,o=/\d{4}-\d{1,2}-\d{1,2}/,s=/(\d|1[012])(:\d+){0,2} *(AM|PM)/,a=/\d{1,2}(:\d{1,2}){1,2}/,l={className:"literal",variants:[{begin:t.concat(/# */,t.either(o,r),/ *#/)},{begin:t.concat(/# */,a,/ *#/)},{begin:t.concat(/# */,s,/ *#/)},{begin:t.concat(/# */,t.either(o,r),/ +/,t.either(s,a),/ *#/)}]},c={className:"number",relevance:0,variants:[{begin:/\b\d[\d_]*((\.[\d_]+(E[+-]?[\d_]+)?)|(E[+-]?[\d_]+))[RFD@!#]?/},{begin:/\b\d[\d_]*((U?[SIL])|[%&])?/},{begin:/&H[\dA-F_]+((U?[SIL])|[%&])?/},{begin:/&O[0-7_]+((U?[SIL])|[%&])?/},{begin:/&B[01_]+((U?[SIL])|[%&])?/}]},u={className:"label",begin:/^\w+:/},d=n.COMMENT(/'''/,/$/,{contains:[{className:"doctag",begin:/<\/?/,end:/>/}]}),h=n.COMMENT(null,/$/,{variants:[{begin:/'/},{begin:/([\t ]|^)REM(?=\s)/}]});return{name:"Visual Basic .NET",aliases:["vb"],case_insensitive:!0,classNameAliases:{label:"symbol"},keywords:{keyword:"addhandler alias aggregate ansi as async assembly auto binary by byref byval call case catch class compare const continue custom declare default delegate dim distinct do each equals else elseif end enum erase error event exit explicit finally for friend from function get global goto group handles if implements imports in inherits interface into iterator join key let lib loop me mid module mustinherit mustoverride mybase myclass namespace narrowing new next notinheritable notoverridable of off on operator option optional order overloads overridable overrides paramarray partial preserve private property protected public raiseevent readonly redim removehandler resume return select set shadows shared skip static step stop structure strict sub synclock take text then throw to try unicode until using when where while widening with withevents writeonly yield",built_in:"addressof and andalso await directcast gettype getxmlnamespace is isfalse isnot istrue like mod nameof new not or orelse trycast typeof xor cbool cbyte cchar cdate cdbl cdec cint clng cobj csbyte cshort csng cstr cuint culng cushort",type:"boolean byte char date decimal double integer long object sbyte short single string uinteger ulong ushort",literal:"true false nothing"},illegal:"//|\\{|\\}|endif|gosub|variant|wend|^\\$ ",contains:[e,i,l,c,u,d,h,{className:"meta",begin:/[\t ]*#(const|disable|else|elseif|enable|end|externalsource|if|region)\b/,end:/$/,keywords:{keyword:"const disable else elseif enable end externalsource if region then"},contains:[h]}]}}function uy(n){n.regex;let t=n.COMMENT(/\(;/,/;\)/);t.contains.push("self");let e=n.COMMENT(/;;/,/$/),i=["anyfunc","block","br","br_if","br_table","call","call_indirect","data","drop","elem","else","end","export","func","global.get","global.set","local.get","local.set","local.tee","get_global","get_local","global","if","import","local","loop","memory","memory.grow","memory.size","module","mut","nop","offset","param","result","return","select","set_global","set_local","start","table","tee_local","then","type","unreachable"],r={begin:[/(?:func|call|call_indirect)/,/\s+/,/\$[^\s)]+/],className:{1:"keyword",3:"title.function"}},o={className:"variable",begin:/\$[\w_]+/},s={match:/(\((?!;)|\))+/,className:"punctuation",relevance:0},a={className:"number",relevance:0,match:/[+-]?\b(?:\d(?:_?\d)*(?:\.\d(?:_?\d)*)?(?:[eE][+-]?\d(?:_?\d)*)?|0x[\da-fA-F](?:_?[\da-fA-F])*(?:\.[\da-fA-F](?:_?[\da-fA-D])*)?(?:[pP][+-]?\d(?:_?\d)*)?)\b|\binf\b|\bnan(?::0x[\da-fA-F](?:_?[\da-fA-D])*)?\b/},l={match:/(i32|i64|f32|f64)(?!\.)/,className:"type"},c={className:"keyword",match:/\b(f32|f64|i32|i64)(?:\.(?:abs|add|and|ceil|clz|const|convert_[su]\/i(?:32|64)|copysign|ctz|demote\/f64|div(?:_[su])?|eqz?|extend_[su]\/i32|floor|ge(?:_[su])?|gt(?:_[su])?|le(?:_[su])?|load(?:(?:8|16|32)_[su])?|lt(?:_[su])?|max|min|mul|nearest|neg?|or|popcnt|promote\/f32|reinterpret\/[fi](?:32|64)|rem_[su]|rot[lr]|shl|shr_[su]|store(?:8|16|32)?|sqrt|sub|trunc(?:_[su]\/f(?:32|64))?|wrap\/i64|xor))\b/};return{name:"WebAssembly",keywords:{$pattern:/[\w.]+/,keyword:i},contains:[e,t,{match:[/(?:offset|align)/,/\s*/,/=/],className:{1:"keyword",3:"operator"}},o,s,r,n.QUOTE_STRING_MODE,l,c,a]}}function dy(n){let t=n.regex,e=t.concat(/[\p{L}_]/u,t.optional(/[\p{L}0-9_.-]*:/u),/[\p{L}0-9_.-]*/u),i=/[\p{L}0-9._:-]+/u,r={className:"symbol",begin:/&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;/},o={begin:/\s/,contains:[{className:"keyword",begin:/#?[a-z_][a-z1-9_-]+/,illegal:/\n/}]},s=n.inherit(o,{begin:/\(/,end:/\)/}),a=n.inherit(n.APOS_STRING_MODE,{className:"string"}),l=n.inherit(n.QUOTE_STRING_MODE,{className:"string"}),c={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:i,relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[r]},{begin:/'/,end:/'/,contains:[r]},{begin:/[^\s"'=<>`]+/}]}]}]};return{name:"HTML, XML",aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,unicodeRegex:!0,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,relevance:10,contains:[o,l,a,s,{begin:/\[/,end:/\]/,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,contains:[o,s,l,a]}]}]},n.COMMENT(/<!--/,/-->/,{relevance:10}),{begin:/<!\[CDATA\[/,end:/\]\]>/,relevance:10},r,{className:"meta",end:/\?>/,variants:[{begin:/<\?xml/,relevance:10,contains:[l]},{begin:/<\?[a-z][a-z0-9]+/}]},{className:"tag",begin:/<style(?=\s|>)/,end:/>/,keywords:{name:"style"},contains:[c],starts:{end:/<\/style>/,returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:/<script(?=\s|>)/,end:/>/,keywords:{name:"script"},contains:[c],starts:{end:/<\/script>/,returnEnd:!0,subLanguage:["javascript","handlebars","xml"]}},{className:"tag",begin:/<>|<\/>/},{className:"tag",begin:t.concat(/</,t.lookahead(t.concat(e,t.either(/\/>/,/>/,/\s/)))),end:/\/?>/,contains:[{className:"name",begin:e,relevance:0,starts:c}]},{className:"tag",begin:t.concat(/<\//,t.lookahead(t.concat(e,/>/))),contains:[{className:"name",begin:e,relevance:0},{begin:/>/,relevance:0,endsParent:!0}]}]}}function hy(n){let t="true false yes no null",e="[\\w#;/?:@&=+$,.~*'()[\\]]+",i={className:"attr",variants:[{begin:"\\w[\\w :\\/.-]*:(?=[ 	]|$)"},{begin:'"\\w[\\w :\\/.-]*":(?=[ 	]|$)'},{begin:"'\\w[\\w :\\/.-]*':(?=[ 	]|$)"}]},r={className:"template-variable",variants:[{begin:/\{\{/,end:/\}\}/},{begin:/%\{/,end:/\}/}]},o={className:"string",relevance:0,variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/\S+/}],contains:[n.BACKSLASH_ESCAPE,r]},s=n.inherit(o,{variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/[^\s,{}[\]]+/}]}),d={className:"number",begin:"\\b"+"[0-9]{4}(-[0-9][0-9]){0,2}"+"([Tt \\t][0-9][0-9]?(:[0-9][0-9]){2})?"+"(\\.[0-9]*)?"+"([ \\t])*(Z|[-+][0-9][0-9]?(:[0-9][0-9])?)?"+"\\b"},h={end:",",endsWithParent:!0,excludeEnd:!0,keywords:t,relevance:0},p={begin:/\{/,end:/\}/,contains:[h],illegal:"\\n",relevance:0},f={begin:"\\[",end:"\\]",contains:[h],illegal:"\\n",relevance:0},g=[i,{className:"meta",begin:"^---\\s*$",relevance:10},{className:"string",begin:"[\\|>]([1-9]?[+-])?[ ]*\\n( +)[^ ][^\\n]*\\n(\\2[^\\n]+\\n?)*"},{begin:"<%[%=-]?",end:"[%-]?%>",subLanguage:"ruby",excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:"!\\w+!"+e},{className:"type",begin:"!<"+e+">"},{className:"type",begin:"!"+e},{className:"type",begin:"!!"+e},{className:"meta",begin:"&"+n.UNDERSCORE_IDENT_RE+"$"},{className:"meta",begin:"\\*"+n.UNDERSCORE_IDENT_RE+"$"},{className:"bullet",begin:"-(?=[ ]|$)",relevance:0},n.HASH_COMMENT_MODE,{beginKeywords:t,keywords:{literal:t}},d,{className:"number",begin:n.C_NUMBER_RE+"\\b",relevance:0},p,f,o],m=[...g];return m.pop(),m.push(s),h.contains=m,{name:"YAML",case_insensitive:!0,aliases:["yml"],contains:g}}var Py=Po(Ny(),1);var Vt=Py.default;var Oy=Po(_y(),1),uo=Object.assign(Ri(Error),{eval:Ri(EvalError),range:Ri(RangeError),reference:Ri(ReferenceError),syntax:Ri(SyntaxError),type:Ri(TypeError),uri:Ri(URIError)});function Ri(n){return t.displayName=n.displayName||n.name,t;function t(e,...i){let r=e&&(0,Oy.default)(e,...i);return new n(r)}}var IR={}.hasOwnProperty,Dy="hljs-";function By(n,t,e={}){let i=e.prefix;if(typeof n!="string")throw uo("Expected `string` for name, got `%s`",n);if(!Vt.getLanguage(n))throw uo("Unknown language: `%s` is not registered",n);if(typeof t!="string")throw uo("Expected `string` for value, got `%s`",t);i==null&&(i=Dy),Vt.configure({__emitter:Xd,classPrefix:i});let r=Vt.highlight(t,{language:n,ignoreIllegals:!0});if(Vt.configure({}),r.errorRaised)throw r.errorRaised;return r._emitter.root.data.language=r.language,r._emitter.root.data.relevance=r.relevance,r._emitter.root}function NR(n,t={}){let e=t.subset||Vt.listLanguages(),i=t.prefix,r=-1,o={type:"root",data:{language:null,relevance:0},children:[]};if(i==null&&(i=Dy),typeof n!="string")throw uo("Expected `string` for value, got `%s`",n);for(;++r<e.length;){let s=e[r];if(!Vt.getLanguage(s))continue;let a=By(s,n,t);a.data.relevance>o.data.relevance&&(o=a)}return o}function PR(n,t){Vt.registerLanguage(n,t)}var _R=(function(n,t){if(typeof n=="string")Vt.registerAliases(t,{languageName:n});else{let e;for(e in n)IR.call(n,e)&&Vt.registerAliases(n[e],{languageName:e})}});function OR(n){return!!Vt.getLanguage(n)}function DR(){return Vt.listLanguages()}var Xd=class{constructor(t){this.options=t,this.root={type:"root",data:{language:null,relevance:0},children:[]},this.stack=[this.root]}addText(t){if(t==="")return;let e=this.stack[this.stack.length-1],i=e.children[e.children.length-1];i&&i.type==="text"?i.value+=t:e.children.push({type:"text",value:t})}startScope(t){this.openNode(String(t))}endScope(){this.closeNode()}__addSublanguage(t,e){let i=this.stack[this.stack.length-1],r=t.root.children;e?i.children.push({type:"element",tagName:"span",properties:{className:[e]},children:r}):i.children.push(...r)}openNode(t){let e=t.split(".").map((o,s)=>s?o+"_".repeat(s):this.options.classPrefix+o),i=this.stack[this.stack.length-1],r={type:"element",tagName:"span",properties:{className:e},children:[]};i.children.push(r),this.stack.push(r)}closeNode(){this.stack.pop()}finalize(){}toHTML(){return""}},ae={highlight:By,highlightAuto:NR,registerLanguage:PR,registered:OR,listLanguages:DR,registerAlias:_R};ae.registerLanguage("arduino",lb);ae.registerLanguage("bash",cb);ae.registerLanguage("c",ub);ae.registerLanguage("cpp",db);ae.registerLanguage("csharp",hb);ae.registerLanguage("css",pb);ae.registerLanguage("diff",fb);ae.registerLanguage("go",mb);ae.registerLanguage("graphql",gb);ae.registerLanguage("ini",bb);ae.registerLanguage("java",Eb);ae.registerLanguage("javascript",Mb);ae.registerLanguage("json",Tb);ae.registerLanguage("kotlin",Cb);ae.registerLanguage("less",Ab);ae.registerLanguage("lua",Ib);ae.registerLanguage("makefile",Nb);ae.registerLanguage("markdown",Pb);ae.registerLanguage("objectivec",_b);ae.registerLanguage("perl",Ob);ae.registerLanguage("php",Db);ae.registerLanguage("php-template",Bb);ae.registerLanguage("plaintext",Fb);ae.registerLanguage("python",Hb);ae.registerLanguage("python-repl",zb);ae.registerLanguage("r",Vb);ae.registerLanguage("ruby",$b);ae.registerLanguage("rust",Wb);ae.registerLanguage("scss",Ub);ae.registerLanguage("shell",Kb);ae.registerLanguage("sql",qb);ae.registerLanguage("swift",ey);ae.registerLanguage("typescript",ly);ae.registerLanguage("vbnet",cy);ae.registerLanguage("wasm",uy);ae.registerLanguage("xml",dy);ae.registerLanguage("yaml",hy);var Fy=ab.configure({lowlight:ae,HTMLAttributes:{class:"tategaki-code-block"},languageClassPrefix:"language-"});var Hy=zg.extend({selectable:!0,addProseMirrorPlugins(){var t,e;let n=this.name;return[...(e=(t=this.parent)==null?void 0:t.call(this))!=null?e:[],new X({props:{handleClickOn:(i,r,o,s,a,l)=>{if(!l||o.type.name!==n)return!1;let c=i.state.tr.setSelection(Y.create(i.state.doc,s));return i.dispatch(c),!0}}})]}});function BR(n,t){return n==="vertical-rl"||n==="horizontal-tb"?n:t}var zy=ce.create({name:"verticalWriting",addOptions(){return{defaultMode:"vertical-rl",targetNodeTypes:["paragraph","heading"]}},addStorage(){return{currentMode:this.options.defaultMode}},onCreate(){this.storage.currentMode=this.options.defaultMode},addGlobalAttributes(){return[{types:this.options.targetNodeTypes,attributes:{writingMode:{default:this.options.defaultMode,parseHTML:n=>n.style.writingMode||this.storage.currentMode,renderHTML:n=>{if(!n.writingMode)return{};let t=n.writingMode==="vertical-rl";return{style:`writing-mode: ${n.writingMode}; text-orientation: ${t?"mixed":"initial"};`}}}}}]},addProseMirrorPlugins(){return[new X({appendTransaction:(n,t,e)=>{if(!n.some(a=>a.docChanged))return;let i=this.storage.currentMode,r=new Set(this.options.targetNodeTypes),o=e.tr,s=!1;if(e.doc.descendants((a,l)=>{var u;if(!r.has(a.type.name)||((u=a.attrs)==null?void 0:u.writingMode)===i)return!0;let c={...a.attrs,writingMode:i};return o=o.setNodeMarkup(l,a.type,c,a.marks),s=!0,!0}),!!s)return o.setMeta("addToHistory",!1),o}})]},addCommands(){return{setWritingMode:n=>({state:t,dispatch:e})=>{var l;let i=BR(n,this.options.defaultMode),{tr:r}=t;r.setMeta("addToHistory",!1);let o=new Set(this.options.targetNodeTypes),s=!1;t.doc.descendants((c,u)=>{var h;if(!o.has(c.type.name)||((h=c.attrs)==null?void 0:h.writingMode)===i)return!0;let d={...c.attrs,writingMode:i};return r.setNodeMarkup(u,c.type,d,c.marks),s=!0,!0}),e&&s&&e(r),this.storage.currentMode=i;let a=(l=this.editor)==null?void 0:l.view.dom;if(a){a.setAttribute("data-writing-mode",i);let c=a.closest(".tategaki-wysiwyg-editor");c&&(c.setAttribute("data-writing-mode",i),c.style.setProperty("--tategaki-writing-mode",i))}return!0}}}});var Vy=Fg.extend({addStorage(){return{markdown:{serialize(n){n.write(`
`)}}}}});var Tn=new se("tategaki-search-highlight");function Jd(n,t,e){let i=[];return t.forEach((r,o)=>{let s=o===e;i.push(Ne.inline(r.from,r.to,{class:s?"tategaki-search-match-active":"tategaki-search-match"}))}),ke.create(n,i)}var FR=ce.create({name:"searchHighlight",addProseMirrorPlugins(){return[new X({key:Tn,state:{init(n,t){return{results:[],currentIndex:-1,decorations:ke.create(t.doc,[])}},apply(n,t,e,i){let r=n.getMeta(Tn),o=t;if(n.docChanged){let s=t.results.map(a=>({from:n.mapping.map(a.from),to:n.mapping.map(a.to)})).filter(a=>a.from<a.to);o={...o,results:s,decorations:Jd(i.doc,s,t.currentIndex)}}if(r)switch(r.type){case"set":return{results:r.results,currentIndex:r.currentIndex,decorations:Jd(i.doc,r.results,r.currentIndex)};case"index":return{...o,currentIndex:r.currentIndex,decorations:Jd(i.doc,o.results,r.currentIndex)};case"clear":return{results:[],currentIndex:-1,decorations:ke.create(i.doc,[])}}return o}},props:{decorations(n){var t;return((t=Tn.getState(n))==null?void 0:t.decorations)||null}}})]},addCommands(){return{setSearchResults:(n,t)=>({tr:e,dispatch:i})=>(i&&i(e.setMeta(Tn,{type:"set",results:n,currentIndex:t})),!0),setSearchCurrentIndex:n=>({tr:t,dispatch:e})=>(e&&e(t.setMeta(Tn,{type:"index",currentIndex:n})),!0),clearSearchResults:()=>({tr:n,dispatch:t})=>(t&&t(n.setMeta(Tn,{type:"clear"})),!0)}}}),$y=FR;var HR=/(?:(?:[|\uFF5C]?(?<body1>[\u4E00-\u9FA0\u3005]+?))|(?:[|\uFF5C](?<body2>[^|\uFF5C]+?)))(?<ruby>.+?)$/,Wy=/(?:(?:[|\uFF5C]?(?<body1>[\u4E00-\u9FA0\u3005]+?))|(?:[|\uFF5C](?<body2>[^|\uFF5C]+?)))(?<ruby>.+?)/g,Uy=xe.create({name:"aozoraRuby",inline:!0,group:"inline",content:"text*",selectable:!0,addAttributes(){return{ruby:{default:""},hasDelimiter:{default:!1}}},parseHTML(){return[{tag:"span.tategaki-aozora-ruby[data-aozora-ruby]",getAttrs:n=>{var r;if(!(n instanceof HTMLElement))return!1;let t=(r=n.querySelector(".tategaki-aozora-ruby-rt"))==null?void 0:r.textContent,e=t!=null?t:"",i=n.getAttribute("data-aozora-delimiter")==="1";return{ruby:e,hasDelimiter:i}},contentElement:n=>n.querySelector("span[data-aozora-base]")},{tag:"ruby[data-aozora-ruby]",getAttrs:n=>{var r;if(!(n instanceof HTMLElement))return!1;let t=n.querySelector("rt"),e=(r=t==null?void 0:t.textContent)!=null?r:"",i=n.getAttribute("data-aozora-delimiter")==="1";return{ruby:e,hasDelimiter:i}},contentElement:n=>n.querySelector("span[data-aozora-base]")},{tag:"ruby",getAttrs:n=>{var i;if(!(n instanceof HTMLElement)||n.hasAttribute("data-aozora-ruby"))return!1;let t=n.querySelector("rt");return{ruby:(i=t==null?void 0:t.textContent)!=null?i:"",hasDelimiter:!1}},contentElement:n=>{var i,r;let t=n,e=(r=(i=t.ownerDocument)==null?void 0:i.createElement("span"))!=null?r:document.createElement("span");for(let o of Array.from(t.childNodes)){if(o instanceof HTMLElement){let s=o.tagName.toUpperCase();if(s==="RT"||s==="RP")continue}e.appendChild(o.cloneNode(!0))}return e}}]},renderHTML({node:n}){var e;return["span",{...{"data-aozora-ruby":"1","data-aozora-delimiter":n.attrs.hasDelimiter?"1":"0"},class:"tategaki-aozora-ruby"},["span",{"data-aozora-base":"1"},0],["span",{class:"tategaki-aozora-ruby-rt","data-pm-ignore":"true",contenteditable:"false",draggable:"false","aria-hidden":"true"},(e=n.attrs.ruby)!=null?e:""]]},addInputRules(){return[new tr({find:HR,handler:({commands:n,match:t,range:e})=>{var a,l,c,u;let i=t.groups,r=(l=(a=i==null?void 0:i.body2)!=null?a:i==null?void 0:i.body1)!=null?l:"",o=(c=i==null?void 0:i.ruby)!=null?c:"";if(!r||!o)return null;let s=/^[|\uFF5C]/.test((u=t[0])!=null?u:"");return n.insertContentAt(e,{type:this.name,attrs:{ruby:o,hasDelimiter:s},content:[{type:"text",text:r}]}),null}})]},addProseMirrorPlugins(){let n=this.type,t=e=>{if(e.isText&&e.text){let i=e.text,r=Array.from(i.matchAll(Wy));if(r.length===0)return e;let o=[],s=0;if(r.forEach(a=>{var h,p,f,g,m;let l=(h=a.index)!=null?h:0;if(l>s){let b=i.slice(s,l);o.push(n.schema.text(b,e.marks))}let c=a.groups,u=(f=(p=c==null?void 0:c.body2)!=null?p:c==null?void 0:c.body1)!=null?f:"",d=(g=c==null?void 0:c.ruby)!=null?g:"";if(u&&d){let b=/^[|\uFF5C]/.test((m=a[0])!=null?m:""),y=n.create({ruby:d,hasDelimiter:b},n.schema.text(u));o.push(y)}s=l+a[0].length}),s<i.length){let a=i.slice(s);o.push(n.schema.text(a,e.marks))}return o}else if(e.content&&e.content.size>0){let i=[];return e.content.forEach(r=>{let o=t(r);Array.isArray(o)?i.push(...o):i.push(o)}),e.copy(z.from(i))}return e};return[new X({key:new se("aozoraRubyPaste"),props:{transformPasted:e=>{let i=[];return e.content.forEach(r=>{let o=t(r);Array.isArray(o)?i.push(...o):i.push(o)}),new q(z.from(i),e.openStart,e.openEnd)},transformPastedText:e=>{let i=e;return Array.from(e.matchAll(Wy)).length>0?e:i}}})]},addStorage(){return{markdown:{serialize:(n,t)=>{var o,s,a,l;let e=(o=t.textContent)!=null?o:"",i=String((a=(s=t.attrs)==null?void 0:s.ruby)!=null?a:"");if(!e||!i){n.text(e||i||"",!1);return}let r=(l=t.attrs)!=null&&l.hasDelimiter?"\uFF5C":"";n.write(`${r}${e}\u300A${i}\u300B`)}}}}});var zR=/(?:^|\s)(==(?!\s+==)((?:[^=\n]+))==)$/,VR=/(?:^|\s)(==(?!\s+==)((?:[^=\n]+))==)/g,Ky=De.create({name:"obsidianHighlight",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:n}){return["mark",he(this.options.HTMLAttributes,n),0]},addCommands(){return{setObsidianHighlight:()=>({commands:n})=>n.setMark(this.name),toggleObsidianHighlight:()=>({commands:n})=>n.toggleMark(this.name),unsetObsidianHighlight:()=>({commands:n})=>n.unsetMark(this.name)}},addInputRules(){return[Ft({find:zR,type:this.type})]},addPasteRules(){return[xt({find:VR,type:this.type})]},addStorage(){return{markdown:{serialize:{open:"==",close:"==",expelEnclosingWhitespace:!0},parse:{}}}}});var ho=new se("tategakiExternalCursor");function $R(n,t){let e=Math.max(0,n.doc.content.size);return Math.max(0,Math.min(t,e))}function WR(n,t){if(typeof t!="number")return null;let e=$R(n,t),i=Ne.widget(e,()=>{let r=document.createElement("span");return r.className="cursor-indicator tategaki-external-caret",r},{side:-1});return ke.create(n.doc,[i])}function UR(n,t,e){let i=e.getMeta(ho);return i?i.type==="clear"?{pos:null}:i.type==="set"?{pos:i.pos}:t:t}var qy=ce.create({name:"externalCursor",addCommands(){return{setExternalCursor:n=>({tr:t,dispatch:e})=>(e==null||e(t.setMeta(ho,{type:"set",pos:n})),!0),clearExternalCursor:()=>({tr:n,dispatch:t})=>(t==null||t(n.setMeta(ho,{type:"clear"})),!0)}},addProseMirrorPlugins(){return[new X({key:ho,state:{init:()=>({pos:null}),apply:(n,t,e,i)=>UR(i,t,n)},props:{decorations:n=>{var e;let t=ho.getState(n);return WR(n,(e=t==null?void 0:t.pos)!=null?e:null)}},view:n=>({destroy:()=>{}})})]}});var Gy=De.create({name:"spanStyle",addAttributes(){return{class:{default:null},style:{default:null},dataAttrs:{default:{}}}},parseHTML(){return[{tag:"span",getAttrs:n=>{if(!(n instanceof HTMLElement)||n.classList.contains("tategaki-aozora-ruby")||n.classList.contains("tategaki-aozora-ruby-rt")||n.hasAttribute("data-aozora-base"))return!1;let t=n.getAttribute("class"),e=n.getAttribute("style"),i={};for(let r of n.getAttributeNames()){if(!r.startsWith("data-"))continue;let o=n.getAttribute(r);o!=null&&(i[r]=o)}return{class:t||null,style:e||null,dataAttrs:i}}}]},renderHTML({mark:n}){var o,s,a,l,c,u;let t={},e=(s=(o=n.attrs)==null?void 0:o.class)!=null?s:null,i=(l=(a=n.attrs)==null?void 0:a.style)!=null?l:null;e&&(t.class=e),i&&(t.style=i);let r=(u=(c=n.attrs)==null?void 0:c.dataAttrs)!=null?u:{};for(let[d,h]of Object.entries(r))d.startsWith("data-")&&(t[d]=h);return["span",t,0]}});var jy=De.create({name:"superscript",parseHTML(){return[{tag:"sup"}]},renderHTML(){return["sup",0]}}),Yy=De.create({name:"subscript",parseHTML(){return[{tag:"sub"}]},renderHTML(){return["sub",0]}}),Xy=De.create({name:"smallText",parseHTML(){return[{tag:"small"}]},renderHTML(){return["small",0]}});var Jy=xe.create({name:"wbr",inline:!0,group:"inline",atom:!0,selectable:!1,parseHTML(){return[{tag:"wbr"}]},renderHTML(){return["wbr"]}});var Zy=xe.create({name:"tategakiImage",group:"inline",inline:!0,atom:!0,draggable:!0,selectable:!0,addAttributes(){return{src:{default:""},alt:{default:""},title:{default:""},source:{default:"markdown"},originalSrc:{default:""},obsidianSrc:{default:""},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:"img",getAttrs:n=>{var d,h,p,f,g,m,b,y;if(!(n instanceof HTMLElement))return!1;let t=(d=n.getAttribute("src"))!=null?d:"",e=(h=n.getAttribute("alt"))!=null?h:"",i=(p=n.getAttribute("title"))!=null?p:"",r=(f=n.getAttribute("data-tategaki-source"))!=null?f:"markdown",o=(g=n.getAttribute("data-tategaki-original-src"))!=null?g:"",s=(m=n.getAttribute("data-tategaki-obsidian-src"))!=null?m:"",a=(b=n.getAttribute("data-tategaki-width"))!=null?b:n.getAttribute("width"),l=(y=n.getAttribute("data-tategaki-height"))!=null?y:n.getAttribute("height"),c=a?Number(a):null,u=l?Number(l):null;return{src:t,alt:e,title:i,source:r==="obsidian"?"obsidian":"markdown",originalSrc:o,obsidianSrc:s,width:Number.isFinite(c)?c:null,height:Number.isFinite(u)?u:null}}}]},renderHTML({HTMLAttributes:n}){var c,u,d,h,p,f;let t={src:String((c=n.src)!=null?c:"")},e=String((u=n.alt)!=null?u:"");e&&(t.alt=e);let i=String((d=n.title)!=null?d:"");i&&(t.title=i);let r=String((h=n.source)!=null?h:"markdown");t["data-tategaki-source"]=r==="obsidian"?"obsidian":"markdown";let o=String((p=n.originalSrc)!=null?p:"");o&&(t["data-tategaki-original-src"]=o);let s=String((f=n.obsidianSrc)!=null?f:"");s&&(t["data-tategaki-obsidian-src"]=s);let a=n.width;typeof a=="number"&&Number.isFinite(a)&&(t["data-tategaki-width"]=String(a));let l=n.height;return typeof l=="number"&&Number.isFinite(l)&&(t["data-tategaki-height"]=String(l)),t.contenteditable="false",["img",he(t)]}});function Zd(n){let{element:t,content:e="",onUpdate:i,settings:r}=n,o=r.common.writingMode,s=l=>l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");t.classList.add("tategaki-wysiwyg-editor"),t.setAttribute("data-writing-mode",o),t.setAttribute("lang","ja");let a=new Rg({element:t,extensions:[N0,P0.configure({isVertical:()=>t.getAttribute("data-writing-mode")==="vertical-rl"}),O0.configure({isVertical:()=>t.getAttribute("data-writing-mode")==="vertical-rl"}),$y,qy,Gy,jy,Yy,Xy,Jy,Zy,Bg,p0,m0,Ky,Uy,Hg.configure({levels:[1,2,3,4,5,6]}),_g,Vg,f0,g0,R0,A0,I0,Pg,Og,Fy,Vy,Hy,i0.configure({autolink:!0,openOnClick:!0,linkOnPaste:!0,HTMLAttributes:{rel:"noopener noreferrer",target:"_blank"}}),zy.configure({defaultMode:o,targetNodeTypes:["paragraph","heading"]}),L0.configure({document:!1,paragraph:!1,text:!1,heading:!1,bold:!1,italic:!1,bulletList:!1,orderedList:!1,listItem:!1,blockquote:!1,code:!1,hardBreak:!1,strike:!1,underline:!1,horizontalRule:!1,link:!1,codeBlock:!1})],content:e,editorProps:{handleDOMEvents:{copy:(l,c)=>{var m,b,y,v,E,x,k,S;if(!(c instanceof ClipboardEvent))return!1;let u=window.getSelection();if(!u||u.rangeCount===0)return!1;let d=u.getRangeAt(0),h=document.createElement("div");h.appendChild(d.cloneContents()),h.querySelectorAll("br[data-tategaki-placeholder]").forEach(w=>w.remove()),h.querySelectorAll("br.Apple-interchange-newline").forEach(w=>w.remove());let p=Array.from(h.querySelectorAll(".tategaki-aozora-ruby"));for(let w of p){let C=(m=w.querySelector("span[data-aozora-base]"))==null?void 0:m.textContent,I=(b=w.querySelector(".tategaki-aozora-ruby-rt"))==null?void 0:b.textContent,F=w.getAttribute("data-aozora-delimiter")==="1";if(!C||!I)continue;let N=(v=(y=w.ownerDocument)==null?void 0:y.createElement("ruby"))!=null?v:document.createElement("ruby");N.setAttribute("data-aozora-ruby","1"),N.setAttribute("data-aozora-delimiter",F?"1":"0");let H=(x=(E=w.ownerDocument)==null?void 0:E.createElement("span"))!=null?x:document.createElement("span");H.setAttribute("data-aozora-base","1"),H.textContent=C;let _=(S=(k=w.ownerDocument)==null?void 0:k.createElement("rt"))!=null?S:document.createElement("rt");_.textContent=I,N.appendChild(H),N.appendChild(_),w.replaceWith(N)}let f=h.innerHTML,g=On(f,{addDelimiter:!0});return c.clipboardData?(c.preventDefault(),c.clipboardData.setData("text/plain",g),c.clipboardData.setData("text/markdown",g),c.clipboardData.setData("text/html",f),!0):!1}},transformPastedHTML:l=>Vi(l),transformPastedText:l=>Vi(l),clipboardTextSerializer:l=>l.content.textBetween(0,l.content.size,`
`,`
`)},onUpdate:({editor:l})=>{i==null||i(l)}});return a.commands.setWritingMode(o),a}var it=require("obsidian");function Cn(n,t){return n.isActive("heading",{level:t})?n.chain().focus().toggleHeading({level:t}).run():n.chain().focus().command(({state:e,tr:i,dispatch:r})=>{var C;let{selection:o}=e,{$from:s}=o,a=s.parent,l=e.schema.nodes.heading,c=e.schema.nodes.paragraph;if(!a.isTextblock||!l||!c)return!1;let u=s.parentOffset,d=a.content.size,h=0,p=0,f=d,g=d;a.forEach((I,F)=>{if(I.type.name==="hardBreak"){if(F<u){h=F,p=F+I.nodeSize;return}F>=u&&f===d&&(f=F,g=F+I.nodeSize)}});let m=h>0?a.content.cut(0,h):null,b=a.content.cut(p,f),y=g<d?a.content.cut(g,d):null;if(!b||b.size===0)return!1;let v=[],E=typeof((C=a.attrs)==null?void 0:C.writingMode)=="string"?{writingMode:a.attrs.writingMode}:void 0,x=E?{...E,level:t}:{level:t},k=E!=null?E:void 0;m&&m.size>0&&v.push(c.create(k||null,m)),v.push(l.create(x,b)),y&&y.size>0&&v.push(c.create(k||null,y));let S=s.before(s.depth),w=s.after(s.depth);return i.replaceWith(S,w,v),r==null||r(i.scrollIntoView()),!0}).run()}var Yn=require("obsidian"),jt=class extends Yn.Modal{constructor(e,i,r){super(e);this.result={url:null,text:null,cancelled:!0};this.urlInput=null;this.textInput=null;this.selectedText=i,this.needsTextInput=!i||i.trim()==="",this.onResolve=r}onOpen(){var a;let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-link-input-modal"),e.createEl("h2",{text:"\u30EA\u30F3\u30AF\u306E\u633F\u5165"});let i=e.createDiv("link-url-container");i.style.cssText=`
			margin-bottom: 1em;
		`;let r=i.createEl("label",{text:"URL"});if(r.style.cssText=`
			display: block;
			margin-bottom: 0.5em;
			font-weight: 500;
		`,this.urlInput=new Yn.TextComponent(i),this.urlInput.inputEl.style.cssText=`
			width: 100%;
			box-sizing: border-box;
		`,this.urlInput.setPlaceholder("https://example.com"),this.urlInput.setValue("https://"),this.needsTextInput){let l=e.createDiv("link-text-container");l.style.cssText=`
				margin-bottom: 1em;
			`;let c=l.createEl("label",{text:"\u30EA\u30F3\u30AF\u30C6\u30AD\u30B9\u30C8"});c.style.cssText=`
				display: block;
				margin-bottom: 0.5em;
				font-weight: 500;
			`,this.textInput=new Yn.TextComponent(l),this.textInput.inputEl.style.cssText=`
				width: 100%;
				box-sizing: border-box;
			`,this.textInput.setPlaceholder("\u30EA\u30F3\u30AF\u306E\u30C6\u30AD\u30B9\u30C8")}else{let l=e.createDiv("link-text-container");l.style.cssText=`
				margin-bottom: 1em;
			`;let c=l.createEl("label",{text:"\u30EA\u30F3\u30AF\u30C6\u30AD\u30B9\u30C8"});c.style.cssText=`
				display: block;
				margin-bottom: 0.5em;
				font-weight: 500;
			`;let u=l.createDiv();u.style.cssText=`
				padding: 0.5em;
				background: var(--background-secondary);
				border-radius: 4px;
				color: var(--text-muted);
			`,u.textContent=this.selectedText}let o=e.createDiv("link-buttons");o.style.cssText=`
			display: flex;
			gap: 0.75em;
			justify-content: flex-end;
			padding-top: 1em;
			border-top: 1px solid var(--background-modifier-border);
		`,new Yn.ButtonComponent(o).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.result={url:null,text:null,cancelled:!0},this.close()});let s=new Yn.ButtonComponent(o).setButtonText("\u633F\u5165").setClass("mod-cta").onClick(()=>{this.submitLink()});(a=this.urlInput)==null||a.inputEl.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),this.needsTextInput&&this.textInput?this.textInput.inputEl.focus():this.submitLink())}),this.textInput&&this.textInput.inputEl.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),this.submitLink())}),setTimeout(()=>{var l,c;(l=this.urlInput)==null||l.inputEl.focus(),(c=this.urlInput)==null||c.inputEl.setSelectionRange(8,8)},10)}submitLink(){var r,o,s;let e=((r=this.urlInput)==null?void 0:r.getValue())||"";if(!e||e==="https://"){(o=this.urlInput)==null||o.inputEl.focus();return}let i=this.selectedText;this.needsTextInput&&(i=((s=this.textInput)==null?void 0:s.getValue())||e),this.result={url:e,text:i,cancelled:!1},this.close()}onClose(){let{contentEl:e}=this;e.empty(),this.onResolve(this.result)}};var Ln=require("obsidian"),Yt=class extends Ln.Modal{constructor(e,i,r){super(e);this.result={text:null,ruby:null,isDot:!1,cancelled:!0};this.rubyInput=null;this.dotToggle=null;this.isComposing=!1;this.selectedText=i,this.onResolve=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("tategaki-ruby-input-modal"),this.modalEl.style.cssText=`
			max-width: 500px;
			width: 90%;
		`,e.style.cssText=`
			padding: 20px;
		`,e.createEl("h2",{text:"\u30EB\u30D3\u306E\u633F\u5165"});let i=e.createDiv({cls:"tategaki-modal-text-display"});i.style.cssText=`
			margin-bottom: 15px;
			display: flex;
			flex-direction: column;
			gap: 8px;
		`;let r=i.createEl("label",{text:"\u5BFE\u8C61\u30C6\u30AD\u30B9\u30C8:"});r.style.fontWeight="bold";let o=i.createEl("div",{text:this.selectedText,cls:"tategaki-modal-selected-text"});o.style.cssText=`
			padding: 8px 12px;
			background: var(--background-secondary);
			border-radius: 4px;
			color: var(--text-normal);
		`;let s=e.createDiv({cls:"tategaki-modal-input-container"});s.style.cssText=`
			margin-bottom: 15px;
			display: flex;
			flex-direction: column;
			gap: 8px;
		`,s.createEl("label",{text:"\u30EB\u30D3:"}),this.rubyInput=new Ln.TextComponent(s),this.rubyInput.inputEl.addClass("tategaki-modal-input-full"),this.rubyInput.inputEl.style.width="100%",this.rubyInput.inputEl.placeholder="\u3075\u308A\u304C\u306A",this.rubyInput.inputEl.addEventListener("compositionstart",()=>{this.isComposing=!0}),this.rubyInput.inputEl.addEventListener("compositionend",()=>{this.isComposing=!1}),this.rubyInput.inputEl.addEventListener("keydown",c=>{c.key==="Enter"&&!this.isComposing&&(c.preventDefault(),this.submitRuby())});let a=e.createDiv({cls:"tategaki-modal-input-container"});a.style.cssText=`
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 10px;
		`,a.createEl("label",{text:"\u508D\u70B9:"}),this.dotToggle=new Ln.ToggleComponent(a),this.dotToggle.onChange(c=>{c&&this.rubyInput?(this.rubyInput.setValue("\u30FB"),this.rubyInput.inputEl.disabled=!0):this.rubyInput&&(this.rubyInput.setValue(""),this.rubyInput.inputEl.disabled=!1,this.rubyInput.inputEl.focus())});let l=e.createDiv({cls:"tategaki-modal-button-container"});l.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 10px;
			margin-top: 20px;
		`,new Ln.ButtonComponent(l).setButtonText("\u633F\u5165").setCta().onClick(()=>{this.submitRuby()}),new Ln.ButtonComponent(l).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>{this.close()}),setTimeout(()=>{var c;(c=this.rubyInput)==null||c.inputEl.focus()},100)}submitRuby(){var o,s;let e=this.selectedText,i=((o=this.rubyInput)==null?void 0:o.getValue())||"",r=((s=this.dotToggle)==null?void 0:s.getValue())||!1;this.result={text:e,ruby:r?"\u30FB":i,isDot:r,cancelled:!1},this.close()}onClose(){let{contentEl:e}=this;e.empty(),this.onResolve(this.result)}};var Va=class{constructor(t,e,i,r={app:i}){this.buttons=new Map;this.isReadOnly=!1;this.hideEditingButtonsWhenReadOnly=!1;this.separators=[];this.writingModeButton=null;this.horizontalRuleButton=null;this.readingModeButton=null;this.statusElement=null;this.rubyToggleButton=null;this.auxiliaryToggleButton=null;this.plainEditToggleButton=null;this.fileSwitchButton=null;this.container=t,this.editor=e,this.app=i,this.options=r,this.createToolbar(),this.setupUpdateListener()}createToolbar(){var r,o;if(this.container.empty(),this.container.addClass("contenteditable-toolbar"),this.separators=[],it.Platform.isMobile||it.Platform.isMobileApp){if(this.container.addClass("tiptap-toolbar-mobile"),this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: nowrap;
				flex: 1 1 auto;
				min-width: 0;
				width: 100%;
				max-width: 100%;
				overflow-x: auto;
				overflow-y: hidden;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				touch-action: pan-x;
				overscroll-behavior-x: contain;
			`,!document.getElementById("tiptap-toolbar-mobile-scrollbar-style")){let s=document.createElement("style");s.id="tiptap-toolbar-mobile-scrollbar-style",s.textContent=`
					.tiptap-toolbar-mobile::-webkit-scrollbar {
						display: none;
					}
					.tiptap-toolbar-mobile .contenteditable-toolbar-button,
					.tiptap-toolbar-mobile .contenteditable-toolbar-separator {
						flex: 0 0 auto;
					}
				`,document.head.appendChild(s)}}else this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: wrap;
				flex: 1 1 auto;
				min-width: 0;
			`;this.options.onToggleWritingMode&&this.options.getWritingMode&&(this.writingModeButton=this.createButton("arrow-down-up","\u66F8\u5B57\u65B9\u5411\u5207\u308A\u66FF\u3048",()=>{var s,a;(a=(s=this.options).onToggleWritingMode)==null||a.call(s),this.updateWritingModeButton(),this.updateHorizontalRuleIcon()}),this.updateWritingModeButton(),this.createSeparator()),this.options.onOpenFileSwitcher&&(this.fileSwitchButton=this.createButton("folder-open","\u30D5\u30A1\u30A4\u30EB\u5207\u66FF",()=>{var s,a;return(a=(s=this.options).onOpenFileSwitcher)==null?void 0:a.call(s)}),this.createSeparator()),this.createButton("undo","\u5143\u306B\u623B\u3059",()=>this.safeUndo()),this.createButton("redo","\u3084\u308A\u76F4\u3059",()=>this.safeRedo()),this.createSeparator(),this.createButton("bold","\u592A\u5B57",()=>this.runInlineCommand({type:"bold"},()=>this.editor.chain().focus().toggleBold().run())),this.createButton("italic","\u30A4\u30BF\u30EA\u30C3\u30AF",()=>this.runInlineCommand({type:"italic"},()=>this.editor.chain().focus().toggleItalic().run())),this.createButton("strikethrough","\u53D6\u308A\u6D88\u3057\u7DDA",()=>this.runInlineCommand({type:"strike"},()=>this.editor.chain().focus().toggleStrike().run())),this.createButton("underline","\u4E0B\u7DDA",()=>this.runInlineCommand({type:"underline"},()=>this.editor.chain().focus().toggleUnderline().run())),this.createButton("highlighter","\u30CF\u30A4\u30E9\u30A4\u30C8",()=>this.runInlineCommand({type:"highlight"},()=>this.editor.chain().focus().toggleMark("obsidianHighlight").run())),this.createSeparator(),this.createHeadingMenuButton(),this.createSeparator(),this.createButton("list","\u7B87\u6761\u66F8\u304D\u30EA\u30B9\u30C8",()=>this.editor.chain().focus().toggleBulletList().run()),this.createButton("list-ordered","\u756A\u53F7\u4ED8\u304D\u30EA\u30B9\u30C8",()=>this.editor.chain().focus().toggleOrderedList().run()),this.createButton("quote","\u5F15\u7528",()=>this.toggleBlockquoteWithTrailingParagraph()),this.createButton("code-2","\u30B3\u30FC\u30C9\u30D6\u30ED\u30C3\u30AF",()=>this.editor.chain().focus().toggleCodeBlock().run()),this.createSeparator(),this.createButton("link","\u30EA\u30F3\u30AF\u633F\u5165",()=>this.insertLink()),this.createButton("gem","\u30EB\u30D3\u633F\u5165",()=>this.insertRuby());let i=(((o=(r=this.options).getWritingMode)==null?void 0:o.call(r))||"horizontal-tb")==="vertical-rl"?"separator-vertical":"separator-horizontal";this.horizontalRuleButton=this.createButton(i,"\u533A\u5207\u308A\u7DDA",()=>this.editor.chain().focus().setHorizontalRule().run()),this.createSeparator(),this.createButton("eraser","\u66F8\u5F0F\u30AF\u30EA\u30A2",()=>this.clearFormatting()),this.options.onToggleRuby&&(this.createSeparator(),this.rubyToggleButton=this.createButton("eye","\u30EB\u30D3\u8868\u793A\u306E\u30AA\u30F3/\u30AA\u30D5",()=>{var s,a;(a=(s=this.options).onToggleRuby)==null||a.call(s),this.updateRubyButton()}),this.updateRubyButton()),this.options.onSettings&&(this.createSeparator(),this.createButton("settings","\u8868\u793A\u8A2D\u5B9A",()=>{var s,a;(a=(s=this.options).onSettings)==null||a.call(s)})),this.options.onFindReplace&&(this.createSeparator(),this.createButton("search","\u691C\u7D22\u30FB\u7F6E\u63DB",()=>{var s,a;(a=(s=this.options).onFindReplace)==null||a.call(s,!0)})),this.options.onToggleOutline&&(this.createSeparator(),this.createButton("list-tree","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",()=>{var s,a;(a=(s=this.options).onToggleOutline)==null||a.call(s)})),this.options.onToggleReadingMode&&(this.createSeparator(),this.readingModeButton=this.createButton("book","\u66F8\u7C4D\u30E2\u30FC\u30C9\uFF08\u30DA\u30FC\u30B8\u30CD\u30FC\u30B7\u30E7\u30F3\uFF09",()=>{var s,a;(a=(s=this.options).onToggleReadingMode)==null||a.call(s),this.updateReadingModeButton()}),this.updateReadingModeButton()),this.options.onToggleAuxiliary&&(this.createSeparator(),this.auxiliaryToggleButton=this.createButton("keyboard","\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB",()=>{var s,a;return(a=(s=this.options).onToggleAuxiliary)==null?void 0:a.call(s)}),this.updateAuxiliaryButton()),this.options.onTogglePlainEdit&&(this.createSeparator(),this.plainEditToggleButton=this.createButton("file-text","\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6",()=>{var s,a;return(a=(s=this.options).onTogglePlainEdit)==null?void 0:a.call(s)}),this.updatePlainEditButton()),this.createSeparator(),this.statusElement=this.container.createDiv("contenteditable-toolbar-status"),this.statusElement.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			margin-left: 8px;
			font-size: 12px;
			color: var(--text-muted);
		`,this.updateButtonStates()}createButton(t,e,i){let r=this.container.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":e}});return(0,it.setIcon)(r,t),r.addEventListener("click",o=>{o.preventDefault(),i(),this.updateButtonStates()}),this.buttons.set(t,r),r}createHeadingMenuButton(){let t=this.container.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":"\u898B\u51FA\u3057"}});(0,it.setIcon)(t,"heading");let e={1:"heading-1",2:"heading-2",3:"heading-3",4:"heading-4",5:"heading-5",6:"heading-6"};t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation();let r=new it.Menu,o=0;for(let a=1;a<=6;a++)if(this.editor.isActive("heading",{level:a})){o=a;break}for(let a=1;a<=6;a++){let l=a;r.addItem(c=>{c.setTitle(` \u898B\u51FA\u3057${l}`).setIcon(e[l]).onClick(()=>{Cn(this.editor,l),this.updateButtonStates()}),o===l&&c.setChecked(!0)})}r.addItem(a=>{a.setTitle("\u898B\u51FA\u3057\u89E3\u9664").setIcon("text").onClick(()=>{this.editor.chain().focus().setParagraph().run(),this.updateButtonStates()}),o===0&&a.setChecked(!0)});let s=t.getBoundingClientRect();r.showAtPosition({x:s.left,y:s.bottom})}),this.buttons.set("heading",t)}createSeparator(){let t=this.container.createEl("div",{cls:"contenteditable-toolbar-separator"});t.style.cssText=`
			width: 1px;
			height: 24px;
			background-color: var(--background-modifier-border);
			margin: 0 4px;
		`,this.separators.push(t)}insertLink(){var r,o,s,a,l;if((o=(r=this.options).getPlainEditEnabled)!=null&&o.call(r)){let c=(l=(a=(s=this.options).getPlainEditSelectionText)==null?void 0:a.call(s))!=null?l:"";new jt(this.app,c,u=>{var h,p;if(u.cancelled||!u.url)return;let d=u.text&&u.text.trim().length>0?u.text:c||u.url;(p=(h=this.options).onPlainEditCommand)==null||p.call(h,{type:"link",url:u.url,text:d})}).open();return}let{from:t,to:e}=this.editor.state.selection,i=this.editor.state.doc.textBetween(t,e," ");new jt(this.app,i,c=>{if(c.cancelled||!c.url)return;let u=c.text&&c.text.trim().length>0?c.text:i||c.url;this.editor.chain().focus().extendMarkRange("link").setLink({href:c.url}).insertContent(u).run(),this.updateButtonStates()}).open()}insertRuby(){var d,h,p,f,g;if((h=(d=this.options).getPlainEditEnabled)!=null&&h.call(d)){let m=(g=(f=(p=this.options).getPlainEditSelectionText)==null?void 0:f.call(p))!=null?g:"";if(!m||m.trim()==="")return;new Yt(this.app,m,b=>{var y,v,E;b.cancelled||(E=(v=this.options).onPlainEditCommand)==null||E.call(v,{type:"ruby",text:m,ruby:(y=b.ruby)!=null?y:"",isDot:b.isDot})}).open();return}let{from:t,to:e}=this.editor.state.selection,i=this.editor.state.doc.textBetween(t,e,"");if(!i||i.trim()==="")return;let r=t,o=e,s=!1,a="",l=this.editor.state.doc.resolve(t),c=this.editor.state.doc.resolve(e);for(let m=l.depth;m>0;m--){let b=l.node(m);if(b.type.name==="aozoraRuby"){let y=l.before(m);r=Math.min(r,y),o=Math.max(o,y+b.nodeSize),a=b.textContent,s=!0;break}}for(let m=c.depth;m>0;m--){let b=c.node(m);if(b.type.name==="aozoraRuby"){let y=c.before(m);r=Math.min(r,y),o=Math.max(o,y+b.nodeSize),a=b.textContent,s=!0;break}}let u=s&&a===i?a:i;new Yt(this.app,u,m=>{var y,v,E;if(m.cancelled)return;let b=(E=(v=(y=this.options).getRubyEnabled)==null?void 0:v.call(y))!=null?E:!0;if(!m.ruby||m.ruby.trim()===""){s&&this.editor.chain().focus().deleteRange({from:r,to:o}).insertContent(i).run();return}if(!b){if(this.editor.chain().focus().deleteRange({from:r,to:o}).run(),m.isDot){let x=Array.from(u).map(k=>`\uFF5C${k}\u300A\u30FB\u300B`).join("");this.editor.chain().focus().insertContent(x).run()}else{let x=`\uFF5C${u}\u300A${m.ruby}\u300B`;this.editor.chain().focus().insertContent(x).run()}this.updateButtonStates();return}this.editor.chain().focus().deleteRange({from:r,to:o}).run(),m.isDot?Array.from(u).forEach(x=>{this.editor.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:"\u30FB",hasDelimiter:!0},content:[{type:"text",text:x}]}).run()}):this.editor.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:m.ruby,hasDelimiter:!0},content:[{type:"text",text:u}]}).run(),this.updateButtonStates()}).open()}clearFormatting(){if(this.runInlineCommand({type:"clear"},()=>{})){this.updateButtonStates();return}this.editor.chain().focus().unsetAllMarks().run(),this.updateButtonStates()}runInlineCommand(t,e){var i,r,o,s,a;return(r=(i=this.options).getPlainEditEnabled)!=null&&r.call(i)&&((a=(s=(o=this.options).onPlainEditCommand)==null?void 0:s.call(o,t))!=null?a:!1)?!0:(e(),!1)}setupUpdateListener(){this.editor.on("selectionUpdate",()=>{this.updateButtonStates()}),this.editor.on("transaction",()=>{this.updateButtonStates()})}updateButtonStates(){if(this.isReadOnly){this.updateReadingModeButton();return}this.updateButtonState("bold",this.editor.isActive("bold")),this.updateButtonState("italic",this.editor.isActive("italic")),this.updateButtonState("strikethrough",this.editor.isActive("strike")),this.updateButtonState("underline",this.editor.isActive("underline")),this.updateButtonState("highlighter",this.editor.isActive("obsidianHighlight")),this.updateButtonState("list",this.editor.isActive("bulletList")),this.updateButtonState("list-ordered",this.editor.isActive("orderedList")),this.updateButtonState("quote",this.editor.isActive("blockquote")),this.updateButtonState("code-2",this.editor.isActive("codeBlock"));let t=!1;for(let r=1;r<=6;r++)if(this.editor.isActive("heading",{level:r})){t=!0;break}this.updateButtonState("heading",t);let e=this.buttons.get("undo");e&&(e.disabled=!this.editor.can().undo(),e.style.opacity=e.disabled?"0.5":"1");let i=this.buttons.get("redo");i&&(i.disabled=!this.editor.can().redo(),i.style.opacity=i.disabled?"0.5":"1")}updateReadingModeButton(){var i,r,o;if(!this.readingModeButton)return;let t=(o=(r=(i=this.options).getReadingModeEnabled)==null?void 0:r.call(i))!=null?o:!1;this.setButtonActive(this.readingModeButton,t);let e=t?"book-open":"book";(0,it.setIcon)(this.readingModeButton,e)}safeUndo(){this.editor.chain().focus().undo().run()&&this.reapplyCurrentWritingMode()}safeRedo(){this.editor.chain().focus().redo().run()&&this.reapplyCurrentWritingMode()}reapplyCurrentWritingMode(){var e,i,r;let t=(r=(i=(e=this.options).getWritingMode)==null?void 0:i.call(e))!=null?r:"vertical-rl";try{this.editor.commands.setWritingMode(t)}catch(o){}}updateSyncStatus(t){if(!this.statusElement||(this.statusElement.empty(),this.isReadOnly))return;if(this.statusElement.style.cssText=`
			display: flex;
			align-items: center;
			gap: 4px;
			margin-left: auto;
		`,t.mode){let s=t.mode==="manual",a=!!this.options.onToggleSyncMode&&!this.isReadOnly,l=this.statusElement.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":s?"\u624B\u52D5\u540C\u671F\u30E2\u30FC\u30C9\uFF08\u30AF\u30EA\u30C3\u30AF\u3067\u81EA\u52D5\u540C\u671F\u306B\u5207\u66FF\uFF09":"\u81EA\u52D5\u540C\u671F\u30E2\u30FC\u30C9\uFF08\u30AF\u30EA\u30C3\u30AF\u3067\u624B\u52D5\u540C\u671F\u306B\u5207\u66FF\uFF09"}});(0,it.setIcon)(l,s?"refresh-cw-off":"refresh-ccw"),l.style.cssText=`
				opacity: ${a?.85:.7};
				cursor: ${a?"pointer":"default"};
			`,l.disabled=!a,a&&l.addEventListener("click",u=>{var d,h;u.preventDefault(),u.stopPropagation(),(h=(d=this.options).onToggleSyncMode)==null||h.call(d)})}let e=this.statusElement.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button"}),i="check-circle",r="\u4FDD\u5B58\u6E08\u307F",o="var(--text-success)";if(t.saving?(i="loader",r="\u4FDD\u5B58\u4E2D...",o="var(--text-accent)",e.addClass("is-loading")):t.lastSyncResult==="error"?(i="x-circle",r=t.lastSyncMessage||"\u540C\u671F\u30A8\u30E9\u30FC",o="var(--text-error)"):t.dirty&&(i="circle-dot",r="\u672A\u4FDD\u5B58",o="var(--text-warning)"),e.setAttribute("aria-label",r),(0,it.setIcon)(e,i),e.style.cssText=`
			color: ${o};
			opacity: 1;
			cursor: default;
		`,e.disabled=!0,!this.isReadOnly&&t.mode==="manual"&&this.options.onManualSync){let s=it.Platform.isMacOS?"\u2318":"Ctrl",a=this.statusElement.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":`\u4FDD\u5B58 (${s}+Shift+S)`}});(0,it.setIcon)(a,"save"),t.dirty?a.style.cssText=`
					color: var(--text-accent);
				`:a.style.cssText=`
					opacity: 0.5;
				`,a.addEventListener("click",l=>{var c,u;l.preventDefault(),l.stopPropagation(),(u=(c=this.options).onManualSync)==null||u.call(c)})}}updateButtonState(t,e){let i=this.buttons.get(t);i&&this.setButtonActive(i,e)}setButtonActive(t,e){e?(t.addClass("is-active"),t.style.backgroundColor="var(--interactive-accent)",t.style.color="var(--text-on-accent)"):(t.removeClass("is-active"),t.style.backgroundColor="",t.style.color="")}updateHorizontalRuleIcon(){if(!this.horizontalRuleButton||!this.options.getWritingMode)return;let e=this.options.getWritingMode()==="vertical-rl"?"separator-vertical":"separator-horizontal";this.horizontalRuleButton.empty(),(0,it.setIcon)(this.horizontalRuleButton,e)}updateWritingModeButton(){if(!this.writingModeButton||!this.options.getWritingMode)return;let e=this.options.getWritingMode()==="vertical-rl";this.writingModeButton.empty();let i=this.writingModeButton.createSpan();(0,it.setIcon)(i,e?"arrow-down-up":"arrow-left-right"),this.writingModeButton.setAttribute("aria-label",e?"\u6A2A\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048":"\u7E26\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048")}refreshRubyToggle(){this.updateRubyButton()}updateAuxiliaryButton(){this.updateAuxiliaryButtonInternal()}updateAuxiliaryButtonInternal(){var e,i,r;if(!this.auxiliaryToggleButton)return;let t=(r=(i=(e=this.options).getAuxiliaryEnabled)==null?void 0:i.call(e))!=null?r:!1;this.setButtonActive(this.auxiliaryToggleButton,t),this.auxiliaryToggleButton.setAttribute("aria-label",t?"\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u3092\u30AA\u30D5\u306B\u3059\u308B":"\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u3092\u30AA\u30F3\u306B\u3059\u308B")}updatePlainEditButton(){this.updatePlainEditButtonInternal()}updatePlainEditButtonInternal(){var i,r,o;if(!this.plainEditToggleButton)return;let t=(o=(r=(i=this.options).getPlainEditEnabled)==null?void 0:r.call(i))!=null?o:!1,e=t?"file-code":"file-text";this.plainEditToggleButton.empty(),(0,it.setIcon)(this.plainEditToggleButton,e),this.setButtonActive(this.plainEditToggleButton,t),this.plainEditToggleButton.setAttribute("aria-label",t?"\u88C5\u98FE\u8868\u793A\u306B\u623B\u3059":"\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u30E2\u30FC\u30C9")}updateRubyButton(){var i,r,o;if(!this.rubyToggleButton)return;let t=(o=(r=(i=this.options).getRubyEnabled)==null?void 0:r.call(i))!=null?o:!0,e=t?"eye":"eye-off";this.rubyToggleButton.empty(),(0,it.setIcon)(this.rubyToggleButton,e),this.rubyToggleButton.setAttribute("aria-label",t?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3059\u308B":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3059\u308B"),this.setButtonActive(this.rubyToggleButton,t)}toggleBlockquoteWithTrailingParagraph(){let t=this.editor.isActive("blockquote"),e=this.editor.chain().focus().toggleBlockquote().run();if(this.updateButtonStates(),!e)return;let i=this.editor.isActive("blockquote");t||!i||this.insertBlankParagraphAfterCurrentBlockquote()}insertBlankParagraphAfterCurrentBlockquote(){let t=this.editor.state.schema.nodes.paragraph;if(!t)return;let{state:e}=this.editor,{$from:i,$to:r}=e.selection;if(!i.blockRange(r,f=>f.type.name==="blockquote"))return;let s=-1;for(let f=i.depth;f>0;f--)if(i.node(f).type.name==="blockquote"){s=f;break}if(s===-1)return;let a=i.after(s),l=e.doc.nodeAt(a);if(l&&l.type.name==="paragraph"&&l.content.size===0){let f=e.tr.setSelection(j.near(e.doc.resolve(a+1)));this.editor.view.dispatch(f);return}let c=e.doc.resolve(a),u=c.parent,d=c.index();if(!u.canReplaceWith(d,d,t))return;let h=t.createAndFill();if(!h)return;let p=e.tr.insert(a,h);p=p.setSelection(j.near(p.doc.resolve(a+1))),this.editor.view.dispatch(p)}destroy(){this.container.empty(),this.buttons.clear()}setReadOnly(t,e={}){this.isReadOnly=t,this.hideEditingButtonsWhenReadOnly=!!e.hideEditingButtons&&t,this.applyReadOnlyButtonStates(),this.updateButtonStates(),this.statusElement&&(this.statusElement.style.opacity=t?"0.6":"1")}applyReadOnlyButtonStates(){let t=new Set(["arrow-down-up","folder-open","book","eye","settings","search","list-tree"]);for(let[e,i]of this.buttons.entries()){let r=!this.isReadOnly||t.has(e);i.disabled=!r,i.style.opacity=i.disabled?"0.35":"1",this.hideEditingButtonsWhenReadOnly&&!r?i.style.display="none":i.style.display=""}this.updateSeparatorVisibility(),this.updateReadingModeButton(),this.statusElement&&(this.statusElement.style.opacity=this.isReadOnly?"0.6":"1")}updateSeparatorVisibility(){let t=Array.from(this.container.children),e=u=>u.classList.contains("contenteditable-toolbar-separator"),i=u=>u.style.display!=="none",r=u=>{for(let d=u-1;d>=0;d--){let h=t[d];if(i(h)&&!e(h))return h}return null},o=u=>{for(let d=u+1;d<t.length;d++){let h=t[d];if(i(h)&&!e(h))return h}return null};for(let u=0;u<t.length;u++){let d=t[u];if(!e(d))continue;if(!this.hideEditingButtonsWhenReadOnly){d.style.display="";continue}let h=!!r(u),p=!!o(u);d.style.display=h&&p?"":"none"}let s=t.filter(i),a=!1;for(let u=0;u<s.length;u++){let d=s[u];if(!e(d)){a=!0;continue}if(!a){d.style.display="none";continue}let h=null;for(let p=u+1;p<s.length;p++){let f=s[p];if(!e(f)){h=f;break}}if(!h){d.style.display="none";continue}a=!1}let l=t.filter(i),c=!1;for(let u of l){if(!e(u)){c=!1;continue}if(c){u.style.display="none";continue}c=!0}}updateEditor(t){this.editor=t,this.setupUpdateListener(),this.updateButtonStates()}};var po=require("obsidian");var $a=class{constructor(t,e){this.editor=t,this.options=e,this.app=e.app,this.actions=this.getDefaultActions()}isReadOnly(){var t,e,i;return(i=(e=(t=this.options).isReadOnly)==null?void 0:e.call(t))!=null?i:!1}getDefaultActions(){let t=e=>{var a,l,c,u;let i=(l=(a=e.view)==null?void 0:a.dom)==null?void 0:l.closest(".tategaki-wysiwyg-editor"),r=i==null?void 0:i.getAttribute("data-writing-mode"),o=(u=(c=e.storage)==null?void 0:c.verticalWriting)==null?void 0:u.currentMode,s=r==="vertical-rl"||r==="horizontal-tb"?r:o==="vertical-rl"||o==="horizontal-tb"?o:"vertical-rl";try{e.commands.setWritingMode(s)}catch(d){}};return[{name:"cut",title:"\u5207\u308A\u53D6\u308A",icon:"scissors",action:()=>{document.execCommand("cut")},isDisabled:e=>e.state.selection.empty},{name:"copy",title:"\u30B3\u30D4\u30FC",icon:"copy",action:()=>{document.execCommand("copy")},isDisabled:e=>e.state.selection.empty},{name:"paste",title:"\u8CBC\u308A\u4ED8\u3051",icon:"clipboard-paste",action:async e=>{try{if(navigator.clipboard&&navigator.clipboard.readText){let i=await navigator.clipboard.readText();i&&e.chain().focus().insertContent(i).run()}else document.execCommand("paste")}catch(i){le("Tategaki TipTap: paste failed",i),new po.Notice("\u8CBC\u308A\u4ED8\u3051\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30D6\u30E9\u30A6\u30B6\u306E\u6A29\u9650\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",3e3)}}},{name:"selectAll",title:"\u3059\u3079\u3066\u9078\u629E",icon:"select-all",action:e=>{e.chain().focus().selectAll().run()}},{name:"separator1",title:"",icon:"",action:()=>{},separator:!0},{name:"undo",title:"\u5143\u306B\u623B\u3059",icon:"undo",action:e=>{e.chain().focus().undo().run()&&t(e)},isDisabled:e=>!e.can().undo()},{name:"redo",title:"\u3084\u308A\u76F4\u3057",icon:"redo",action:e=>{e.chain().focus().redo().run()&&t(e)},isDisabled:e=>!e.can().redo()},{name:"separator2",title:"",icon:"",action:()=>{},separator:!0},{name:"bold",title:"\u592A\u5B57",icon:"bold",action:e=>this.runInlineCommand({type:"bold"},()=>e.chain().focus().toggleBold().run()),isActive:e=>e.isActive("bold"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"italic",title:"\u659C\u4F53",icon:"italic",action:e=>this.runInlineCommand({type:"italic"},()=>e.chain().focus().toggleItalic().run()),isActive:e=>e.isActive("italic"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"strike",title:"\u53D6\u308A\u6D88\u3057\u7DDA",icon:"strikethrough",action:e=>this.runInlineCommand({type:"strike"},()=>e.chain().focus().toggleStrike().run()),isActive:e=>e.isActive("strike"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"underline",title:"\u4E0B\u7DDA",icon:"underline",action:e=>this.runInlineCommand({type:"underline"},()=>e.chain().focus().toggleUnderline().run()),isActive:e=>e.isActive("underline"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"highlight",title:"\u30CF\u30A4\u30E9\u30A4\u30C8",icon:"highlighter",action:e=>this.runInlineCommand({type:"highlight"},()=>e.chain().focus().toggleMark("obsidianHighlight").run()),isActive:e=>e.isActive("obsidianHighlight"),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"link",title:"\u30EA\u30F3\u30AF\u633F\u5165",icon:"link",action:e=>{this.insertLink(e)},isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"ruby",title:"\u30EB\u30D3\u633F\u5165",icon:"gem",action:e=>{this.insertRuby(e)},isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"clear",title:"\u66F8\u5F0F\u30AF\u30EA\u30A2",icon:"eraser",action:e=>this.runInlineCommand({type:"clear"},()=>e.chain().focus().unsetAllMarks().run()),isDisabled:e=>this.isPlainEditActive()?!this.hasPlainEditSelection():e.state.selection.empty},{name:"separator3",title:"",icon:"",action:()=>{},separator:!0},{name:"heading1",title:"\u898B\u51FA\u30571",icon:"heading-1",action:e=>Cn(e,1),isActive:e=>e.isActive("heading",{level:1})},{name:"heading2",title:"\u898B\u51FA\u30572",icon:"heading-2",action:e=>Cn(e,2),isActive:e=>e.isActive("heading",{level:2})},{name:"heading3",title:"\u898B\u51FA\u30573",icon:"heading-3",action:e=>Cn(e,3),isActive:e=>e.isActive("heading",{level:3})},{name:"heading4",title:"\u898B\u51FA\u30574",icon:"heading-4",action:e=>Cn(e,4),isActive:e=>e.isActive("heading",{level:4})},{name:"heading5",title:"\u898B\u51FA\u30575",icon:"heading-5",action:e=>Cn(e,5),isActive:e=>e.isActive("heading",{level:5})},{name:"heading6",title:"\u898B\u51FA\u30576",icon:"heading-6",action:e=>Cn(e,6),isActive:e=>e.isActive("heading",{level:6})},{name:"separator4",title:"",icon:"",action:()=>{},separator:!0},{name:"blockquote",title:"\u5F15\u7528",icon:"quote",action:e=>e.chain().focus().toggleBlockquote().run(),isActive:e=>e.isActive("blockquote")},{name:"separator5",title:"",icon:"",action:()=>{},separator:!0},{name:"plainEdit",title:"\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6",icon:"file-text",action:()=>{this.options.onTogglePlainEdit&&this.options.onTogglePlainEdit()},isActive:()=>{var e,i,r;return(r=(i=(e=this.options).getPlainEditEnabled)==null?void 0:i.call(e))!=null?r:!1}},{name:"findReplace",title:"\u691C\u7D22\u30FB\u7F6E\u63DB",icon:"search",action:()=>{this.options.onFindReplace?this.options.onFindReplace(!0):new po.Notice("\u691C\u7D22\u30FB\u7F6E\u63DB\u306F\u672A\u5B9F\u88C5\u3067\u3059\u3002",2500)}}]}runInlineCommand(t,e){var i,r,o;this.isPlainEditActive()&&((o=(r=(i=this.options).onPlainEditCommand)==null?void 0:r.call(i,t))!=null&&o)||e()}isPlainEditActive(){var t,e,i;return(i=(e=(t=this.options).getPlainEditEnabled)==null?void 0:e.call(t))!=null?i:!1}hasPlainEditSelection(){var e,i,r;return((r=(i=(e=this.options).getPlainEditSelectionText)==null?void 0:i.call(e))!=null?r:"").length>0}insertLink(t){var o,s,a;if(this.isPlainEditActive()){let l=(a=(s=(o=this.options).getPlainEditSelectionText)==null?void 0:s.call(o))!=null?a:"";new jt(this.app,l,c=>{var d,h;if(c.cancelled||!c.url)return;let u=c.text&&c.text.trim().length>0?c.text:l||c.url;(h=(d=this.options).onPlainEditCommand)==null||h.call(d,{type:"link",url:c.url,text:u})}).open();return}let{from:e,to:i}=t.state.selection,r=t.state.doc.textBetween(e,i," ");new jt(this.app,r,l=>{if(l.cancelled||!l.url)return;let c=l.text&&l.text.trim().length>0?l.text:r||l.url;t.chain().focus().extendMarkRange("link").setLink({href:l.url}).insertContent(c).run()}).open()}insertRuby(t){var h,p,f;if(this.isPlainEditActive()){let g=(f=(p=(h=this.options).getPlainEditSelectionText)==null?void 0:p.call(h))!=null?f:"";if(!g||g.trim()==="")return;new Yt(this.app,g,m=>{var b,y,v;m.cancelled||(v=(y=this.options).onPlainEditCommand)==null||v.call(y,{type:"ruby",text:g,ruby:(b=m.ruby)!=null?b:"",isDot:m.isDot})}).open();return}let{from:e,to:i}=t.state.selection,r=t.state.doc.textBetween(e,i," ");if(!r||r.trim()==="")return;let o=e,s=i,a=!1,l="",c=t.state.doc.resolve(e),u=t.state.doc.resolve(i);for(let g=c.depth;g>0;g--){let m=c.node(g);if(m.type.name==="aozoraRuby"){let b=c.before(g);o=Math.min(o,b),s=Math.max(s,b+m.nodeSize),l=m.textContent,a=!0;break}}for(let g=u.depth;g>0;g--){let m=u.node(g);if(m.type.name==="aozoraRuby"){let b=u.before(g);o=Math.min(o,b),s=Math.max(s,b+m.nodeSize),l=m.textContent,a=!0;break}}let d=a&&l===r?l:r;new Yt(this.app,d,g=>{var b,y,v;if(g.cancelled)return;let m=(v=(y=(b=this.options).getRubyEnabled)==null?void 0:y.call(b))!=null?v:!0;if(!g.ruby||g.ruby.trim()===""){a&&t.chain().focus().deleteRange({from:o,to:s}).insertContent(r).run();return}if(!m){if(t.chain().focus().deleteRange({from:o,to:s}).run(),g.isDot){let E=Array.from(d).map(x=>`\uFF5C${x}\u300A\u30FB\u300B`).join("");t.chain().focus().insertContent(E).run()}else{let E=`\uFF5C${d}\u300A${g.ruby}\u300B`;t.chain().focus().insertContent(E).run()}return}t.chain().focus().deleteRange({from:o,to:s}).run(),g.isDot?Array.from(d).forEach(E=>{t.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:"\u30FB",hasDelimiter:!0},content:[{type:"text",text:E}]}).run()}):t.chain().focus().insertContent({type:"aozoraRuby",attrs:{ruby:g.ruby,hasDelimiter:!0},content:[{type:"text",text:d}]}).run()}).open()}show(t){t.preventDefault(),t.stopPropagation();let e=new po.Menu,i=this.isReadOnly(),r=new Set(["cut","paste","undo","redo","bold","italic","strike","underline","highlight","link","ruby","clear","heading1","heading2","heading3","heading4","heading5","heading6","blockquote","plainEdit"]);document.body.addClass("tategaki-context-menu-active");let o=e.hide.bind(e);e.hide=()=>(document.body.removeClass("tategaki-context-menu-active"),o());for(let s of this.actions){if(s.separator){e.addSeparator();continue}let a=i&&r.has(s.name)||(s.isDisabled?s.isDisabled(this.editor):!1),l=s.isActive?s.isActive(this.editor):!1;e.addItem(c=>{c.setTitle(s.title).setIcon(s.icon).setDisabled(a).setChecked(l||!1).onClick(()=>{a||s.action(this.editor)})})}e.showAtMouseEvent(t)}updateEditor(t){this.editor=t}destroy(){}};var Wa=class{constructor(t){this.editor=t}search(t,e){if(!t)return[];let i=this.editor.state.doc,r=[],o=this.normalizeText(t,e.caseSensitive);return this.traverseDoc(i,(s,a)=>{if(!s.isText||!s.text)return;let l=this.findMatches(s.text,o,a,e);r.push(...l)}),r}replace(t,e){try{let i=this.editor.state.tr;return e.length===0?i.delete(t.from,t.to):i.replaceWith(t.from,t.to,this.editor.state.schema.text(e)),this.editor.view.dispatch(i),!0}catch(i){return console.error("Tategaki TipTap: replace error",i),!1}}replaceAll(t,e){if(t.length===0)return 0;try{let i=[...t].sort((s,a)=>a.from-s.from),r=this.editor.state.tr,o=0;for(let s of i)e.length===0?r.delete(s.from,s.to):r.replaceWith(s.from,s.to,this.editor.state.schema.text(e)),o+=1;return this.editor.view.dispatch(r),o}catch(i){return console.error("Tategaki TipTap: replace all error",i),0}}highlightMatches(t,e){let i=this.editor.state.tr;i.setMeta(Tn,{type:"set",results:t.map(r=>({from:r.from,to:r.to})),currentIndex:e}),this.editor.view.dispatch(i)}clearHighlights(){let t=this.editor.state.tr;t.setMeta(Tn,{type:"clear"}),this.editor.view.dispatch(t)}scrollToMatch(t){var e;try{let i=this.editor.view.coordsAtPos(t.from),r=(e=this.editor.view.dom.closest(".tategaki-tiptap-compat-editor-host"))!=null?e:this.editor.view.dom.closest(".tategaki-editor-area");if(!r||!i)return;let o=r.getBoundingClientRect(),s=i.top-o.top+r.scrollTop,a=i.left-o.left+r.scrollLeft;r.scrollTo({top:s-r.clientHeight/2,left:a-r.clientWidth/2,behavior:"smooth"})}catch(i){console.error("Tategaki TipTap: scroll to match error",i)}}updateEditor(t){this.editor=t,this.clearHighlights()}destroy(){this.clearHighlights()}findMatches(t,e,i,r){let o=[];if(!e)return o;let s=this.normalizeText(t,r.caseSensitive),a=0;for(;a<=s.length-e.length;){let l=s.indexOf(e,a);if(l===-1)break;o.push({from:i+l,to:i+l+e.length,text:t.slice(l,l+e.length)}),a=l+e.length}return o}normalizeText(t,e){return e?t:t.toLocaleLowerCase()}traverseDoc(t,e){t.nodesBetween(0,t.content.size,(i,r)=>{e(i,r)})}};var Ua=class{constructor(t,e,i){this.isVisible=!1;this.panel=null;this.searchInput=null;this.replaceInput=null;this.caseSensitiveCheckbox=null;this.matchCountElement=null;this.searchOptions={caseSensitive:!1};this.currentResults=[];this.currentIndex=-1;this.searchDebounceTimer=null;this.searchDebounceDelay=300;this.isReadOnly=!1;this.container=t,this.editor=e,this.onUpdateCallback=i,this.searchEngine=new Wa(e)}show(t=!1){if(t&&this.isReadOnly&&(t=!1),this.isVisible){this.focus();return}this.createPanel(t),this.isVisible=!0,this.focus()}hide(){!this.isVisible||!this.panel||(this.clearSearch(),this.panel.remove(),this.panel=null,this.isVisible=!1,this.editor.commands.focus())}toggle(t=!1){this.isVisible?this.hide():this.show(t)}createPanel(t){this.panel=document.createElement("div"),this.panel.className="tategaki-search-replace-panel",this.panel.style.cssText=`
			position: absolute;
			top: 10px;
			right: 10px;
			width: 320px;
			background: var(--background-primary);
			border: 1px solid var(--background-modifier-border);
			border-radius: 6px;
			box-shadow: var(--shadow-s);
			z-index: 1000;
			padding: 12px;
			font-size: 13px;
		`;let e=this.panel.createDiv("search-section");e.style.cssText="margin-bottom: 8px;";let i=e.createDiv();i.style.cssText="display: flex; align-items: center; margin-bottom: 6px;",this.searchInput=i.createEl("input"),this.searchInput.type="text",this.searchInput.placeholder="\u691C\u7D22...",this.searchInput.style.cssText=`
			flex: 1;
			padding: 4px 8px;
			border: 1px solid var(--background-modifier-border);
			border-radius: 3px;
			margin-right: 6px;
			background: var(--background-primary);
			color: var(--text-normal);
		`;let r=i.createDiv();r.style.cssText="display: flex; gap: 2px; margin-right: 6px;";let o=r.createEl("button");o.textContent="\u2191",o.title="\u524D\u3092\u691C\u7D22",o.style.cssText=`
			width: 24px; height: 24px;
			border: 1px solid var(--background-modifier-border);
			background: var(--background-primary);
			border-radius: 3px;
			cursor: pointer;
		`,o.addEventListener("click",()=>this.findPrevious());let s=r.createEl("button");s.textContent="\u2193",s.title="\u6B21\u3092\u691C\u7D22",s.style.cssText=`
			width: 24px; height: 24px;
			border: 1px solid var(--background-modifier-border);
			background: var(--background-primary);
			border-radius: 3px;
			cursor: pointer;
		`,s.addEventListener("click",()=>this.findNext());let a=i.createEl("button");if(a.textContent="\xD7",a.title="\u9589\u3058\u308B",a.style.cssText=`
			width: 24px; height: 24px;
			border: 1px solid var(--background-modifier-border);
			background: var(--background-primary);
			border-radius: 3px;
			cursor: pointer;
		`,a.addEventListener("click",()=>this.hide()),this.matchCountElement=e.createDiv(),this.matchCountElement.style.cssText=`
			font-size: 11px;
			color: var(--text-muted);
			margin-bottom: 6px;
		`,this.matchCountElement.textContent="",t){let u=this.panel.createDiv("replace-section");u.style.cssText="margin-bottom: 8px;";let d=u.createDiv();d.style.cssText="display: flex; align-items: center; margin-bottom: 6px;",this.replaceInput=d.createEl("input"),this.replaceInput.type="text",this.replaceInput.placeholder="\u7F6E\u63DB...",this.replaceInput.style.cssText=`
				flex: 1;
				padding: 4px 8px;
				border: 1px solid var(--background-modifier-border);
				border-radius: 3px;
				margin-right: 6px;
				background: var(--background-primary);
				color: var(--text-normal);
			`;let h=d.createDiv();h.style.cssText="display: flex; gap: 4px;";let p=h.createEl("button");p.textContent="\u7F6E\u63DB",p.style.cssText=`
				padding: 4px 8px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
				border-radius: 3px;
				cursor: pointer;
				font-size: 11px;
			`,p.addEventListener("click",()=>this.replaceOne());let f=h.createEl("button");f.textContent="\u5168\u7F6E\u63DB",f.style.cssText=`
				padding: 4px 8px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
				border-radius: 3px;
				cursor: pointer;
				font-size: 11px;
			`,f.addEventListener("click",()=>this.replaceAll())}let l=this.panel.createDiv("options-section");l.style.cssText="display: flex; gap: 12px; font-size: 11px;";let c=l.createEl("label");c.style.cssText="display: flex; align-items: center; cursor: pointer;",this.caseSensitiveCheckbox=c.createEl("input"),this.caseSensitiveCheckbox.type="checkbox",this.caseSensitiveCheckbox.style.cssText="margin-right: 4px;",c.createSpan().textContent="\u5927\u6587\u5B57\u5C0F\u6587\u5B57\u533A\u5225",this.setupEventListeners(),this.container.appendChild(this.panel)}setupEventListeners(){this.searchInput&&(this.searchInput.addEventListener("input",()=>this.performSearchDebounced()),this.searchInput.addEventListener("keydown",t=>this.handleSearchKeydown(t))),this.replaceInput&&this.replaceInput.addEventListener("keydown",t=>this.handleReplaceKeydown(t)),this.caseSensitiveCheckbox&&this.caseSensitiveCheckbox.addEventListener("change",()=>{this.updateSearchOptions(),this.performSearch()})}handleSearchKeydown(t){switch(t.key){case"Enter":t.preventDefault(),t.shiftKey?this.findPrevious():this.findNext();break;case"Escape":t.preventDefault(),this.hide();break}}handleReplaceKeydown(t){switch(t.key){case"Enter":t.preventDefault(),this.replaceOne();break;case"Escape":t.preventDefault(),this.hide();break}}updateSearchOptions(){var t,e;this.searchOptions={caseSensitive:(e=(t=this.caseSensitiveCheckbox)==null?void 0:t.checked)!=null?e:!1}}performSearchDebounced(){this.searchDebounceTimer!==null&&window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=window.setTimeout(()=>{this.searchDebounceTimer=null,this.performSearch()},this.searchDebounceDelay)}performSearch(){var i;let t=((i=this.searchInput)==null?void 0:i.value)||"";if(!t){this.clearSearch();return}let e={...this.searchOptions};this.currentResults=this.searchEngine.search(t,e),this.currentIndex=this.currentResults.length>0?0:-1,this.updateMatchCount(),this.highlightMatches(),this.currentResults.length>0&&this.scrollToCurrentMatch()}clearSearch(){this.currentResults=[],this.currentIndex=-1,this.searchEngine.clearHighlights(),this.updateMatchCount()}findNext(){this.currentResults.length!==0&&(this.currentIndex=(this.currentIndex+1)%this.currentResults.length,this.updateMatchCount(),this.highlightMatches(),this.scrollToCurrentMatch())}findPrevious(){this.currentResults.length!==0&&(this.currentIndex=this.currentIndex<=0?this.currentResults.length-1:this.currentIndex-1,this.updateMatchCount(),this.highlightMatches(),this.scrollToCurrentMatch())}replaceOne(){var i;if(this.isReadOnly||!this.replaceInput||this.currentIndex===-1)return;let t=this.replaceInput.value;this.searchEngine.replace(this.currentResults[this.currentIndex],t)&&((i=this.onUpdateCallback)==null||i.call(this),this.performSearch())}replaceAll(){var i;if(this.isReadOnly||!this.replaceInput||this.currentResults.length===0)return;let t=this.replaceInput.value;this.searchEngine.replaceAll(this.currentResults,t)>0&&((i=this.onUpdateCallback)==null||i.call(this),this.performSearch())}updateMatchCount(){this.matchCountElement&&(this.currentResults.length===0?this.matchCountElement.textContent="\u30DE\u30C3\u30C1\u306A\u3057":this.matchCountElement.textContent=`${this.currentIndex+1} / ${this.currentResults.length}`)}highlightMatches(){this.searchEngine.highlightMatches(this.currentResults,this.currentIndex)}scrollToCurrentMatch(){if(this.currentIndex===-1)return;let t=this.currentResults[this.currentIndex];t&&this.searchEngine.scrollToMatch(t)}focus(){this.searchInput&&(this.searchInput.focus(),this.searchInput.select())}updateEditor(t){this.editor=t,this.searchEngine.updateEditor(t)}setReadOnly(t){this.isReadOnly=t}destroy(){this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null),this.hide(),this.searchEngine.destroy()}};var yr="\u2060",qI=oE(),ko=new qI({html:!0,breaks:!1,linkify:!1,typographer:!1});function lE(n,t={}){return new Mh(n,t)}var Mh=class{constructor(t,e){this.isApplying=!1;this.frontmatterBlock=null;this.editor=t,this.getSettings=e.getSettings,this.getContextFilePath=e.getContextFilePath,this.resolveImageSrc=e.resolveImageSrc}setMarkdown(t){var a,l,c,u;let e=So(t);this.frontmatterBlock=e.frontmatter||null;let i=((l=(a=this.getSettings)==null?void 0:a.call(this).wysiwyg)==null?void 0:l.enableRuby)!==!1,r=(u=(c=this.getContextFilePath)==null?void 0:c.call(this))!=null?u:null,o=wo(e.body),s=Mo(o,{enableRuby:i,contextFilePath:r,resolveImageSrc:this.resolveImageSrc});this.isApplying=!0;try{this.editor.chain().command(({tr:d})=>(d.setMeta("addToHistory",!1),!0)).setContent(s,{emitUpdate:!1}).run(),this.reapplyWritingMode()}finally{this.isApplying=!1}}getMarkdown(){var r;let t=eN(this.editor),e=nN(t),i=GI(e);return`${(r=this.frontmatterBlock)!=null?r:""}${i}`}isApplyingExternalUpdate(){return this.isApplying}reapplyWritingMode(){var o,s,a,l;let t=(s=(o=this.editor.view)==null?void 0:o.dom)==null?void 0:s.closest(".tategaki-wysiwyg-editor"),e=t==null?void 0:t.getAttribute("data-writing-mode"),i=(l=(a=this.editor.storage)==null?void 0:a.verticalWriting)==null?void 0:l.currentMode,r=e==="vertical-rl"||e==="horizontal-tb"?e:i==="vertical-rl"||i==="horizontal-tb"?i:"vertical-rl";this.editor.commands.setWritingMode(r)}};function wo(n){let t=/^([ \t]*)([-*+]|[0-9]+[.)])\s+/,e=/^([ \t]{0,3}#{1,6}[ \t])([ \t]+)(.*)$/;return hE(n).map(o=>{if(!o.convert)return o.text;let s=o.text.split(`
`),a=!1;return s.map(c=>{let u=c.trim(),d=t.test(c),h=/^[ \t]+\S/.test(c);if(d)return a=!0,c;if(a){if(u===""||h)return c;a=!1}let p=e.exec(c);if(p){let f=p[2].split("").map(g=>g==="\u3000"?"&#12288;":"&nbsp;").join("");return`${p[1]}${f}${p[3]}`}return c.replace(/^([ ]+)/,f=>f.split("").map(m=>m==="\u3000"?"&#12288;":"&nbsp;").join(""))}).join(`
`)}).join("")}function GI(n){let t=n;return t=t.replace(/&#12288;/g,"\u3000"),t=t.replace(/&nbsp;/g," "),t=t.replace(/\u00A0/g," "),t=t.replace(/\u3000/g,"\u3000"),t}function So(n){let t=n.match(/^(?:\uFEFF)?---\s*\n[\s\S]*?\n---\s*\n/);if(!t)return{frontmatter:"",body:n};let e=t[0];return{frontmatter:e,body:n.slice(e.length)}}function Mo(n,t){var r,o;let e=(t==null?void 0:t.enableRuby)!==!1,i=jI(n,e,{contextFilePath:(r=t==null?void 0:t.contextFilePath)!=null?r:null,resolveImageSrc:t==null?void 0:t.resolveImageSrc});return YI(i,e,{contextFilePath:(o=t==null?void 0:t.contextFilePath)!=null?o:null,resolveImageSrc:t==null?void 0:t.resolveImageSrc})}function jI(n,t,e){return hE(n).map(r=>r.convert?iN(r.text,o=>{let s=JI(o,e);return cE(s,t)}):r.text).join("")}function YI(n,t,e){let i=[],r=n.split(`
`);for(let a=0;a<r.length;a++){let l=r[a],c=l.trim();if(!c){i.push(`<p>${yr}</p>`);continue}let u=c.match(/^(`{3,}|~{3,})/);if(u){let h=u[1][0],p=u[1].length,f=c.slice(p).trim(),g=f.length>0?f.split(/\s+/)[0]:"",m=[l],b=a+1,y=!1;for(;b<r.length;){let k=r[b];m.push(k);let w=k.trim().match(/^(`{3,}|~{3,})\s*$/);if(w&&w[1][0]===h&&w[1].length>=p){y=!0;break}b++}if(!y){i.push(ko.render(l));continue}let E=m.slice(1,-1).join(`
`),x=g?` class="language-${At(g)}"`:"";i.push(`<pre><code${x}>${At(E)}</code></pre>`),a=b;continue}if(/^(\s*)[-*+]\s+/.test(l)||/^(\s*)\d+[.)]\s+/.test(l)){let h=[l],p=a+1;for(;p<r.length;){let f=r[p];if(!f.trim()){if(p+1<r.length){let m=r[p+1];if(!(/^(\s*)[-*+]\s+/.test(m)||/^(\s*)\d+[.)]\s+/.test(m)))break}h.push(f),p++;continue}if(/^(\s*)[-*+]\s+/.test(f)||/^(\s*)\d+[.)]\s+/.test(f)||/^\s+\S/.test(f)){h.push(f),p++;continue}break}i.push(ko.render(h.join(`
`))),a=p-1;continue}if(c.startsWith(">")){let h=[l],p=a+1;for(;p<r.length;){let f=r[p];if(f.trim().startsWith(">")){h.push(f),p++;continue}break}i.push(ko.render(h.join(`
`))),a=p-1;continue}i.push(ko.render(l))}let o=i.join(`
`),s=XI(o,e);return t?s:On(s,{addDelimiter:!1})}function XI(n,t){var r;if(typeof document=="undefined"||!t.resolveImageSrc)return n;let e=document.implementation.createHTMLDocument("");e.body.innerHTML=n;let i=Array.from(e.body.querySelectorAll("img"));for(let o of i){if(o.getAttribute("data-tategaki-source"))continue;let a=(r=o.getAttribute("src"))!=null?r:"";if(!a)continue;o.setAttribute("data-tategaki-source","markdown"),o.setAttribute("data-tategaki-original-src",a);let l=t.resolveImageSrc(a,t.contextFilePath);l&&l!==a&&o.setAttribute("src",l)}return e.body.innerHTML}function JI(n,t){let e=/!\[\[([^\]]+)\]\]/g;return n.replace(e,(i,r)=>{var p;let o=String(r).split("|").map(f=>f.trim()).filter(Boolean);if(o.length===0)return i;let s=(p=o[0])!=null?p:"";if(!ZI(s))return i;let a=null,l=null,c="";for(let f of o.slice(1)){let g=f.match(/^(\d+)(?:\s*x\s*(\d+))?$/i);if(g){a=Number(g[1]),l=g[2]?Number(g[2]):null;continue}c||(c=f)}let d=(t.resolveImageSrc?t.resolveImageSrc(s,t.contextFilePath):null)||s,h=[`src="${At(d)}"`,'data-tategaki-source="obsidian"',`data-tategaki-obsidian-src="${At(s)}"`];return c&&h.push(`alt="${At(c)}"`),a!=null&&Number.isFinite(a)&&h.push(`data-tategaki-width="${At(String(a))}"`),l!=null&&Number.isFinite(l)&&h.push(`data-tategaki-height="${At(String(l))}"`),`<img ${h.join(" ")} />`})}function ZI(n){var r,o;let t=(o=(r=n.split("#")[0])==null?void 0:r.split("?")[0])!=null?o:n,e=t.lastIndexOf(".");if(e<0)return!1;let i=t.slice(e+1).toLowerCase();return i==="png"||i==="jpg"||i==="jpeg"||i==="gif"||i==="webp"||i==="svg"||i==="bmp"||i==="avif"}function cE(n,t){let e=n;return t?(e=QI(e),e):(e=dE(e),e)}function uE(n,t={}){let e=t.enableRuby!==!1,i=cE(n,e);return ko.renderInline(i)}function QI(n){let t=Gt();t.lastIndex=0;let e=n.replace(t,(i,...r)=>{var u,d,h;let o=r[r.length-1],s=(d=(u=o==null?void 0:o.body2)!=null?u:o==null?void 0:o.body1)!=null?d:"",a=(h=o==null?void 0:o.ruby)!=null?h:"";return!s||!a?i:`<ruby data-aozora-ruby="1" data-aozora-delimiter="${/^[|\uFF5C]/.test(i)?"1":"0"}"><span data-aozora-base="1">${At(s)}</span><rt>${At(a)}</rt></ruby>`});return e=dE(e),e}function dE(n){let t=/==([^=\n]+)==/g;return n.replace(t,(e,i)=>i?`<mark>${At(i)}</mark>`:e)}function eN(n){let{doc:t}=n.state,e=[];for(let i=0;i<t.childCount;i++){let r=t.child(i),o=Th(r,0,i,t.childCount);if(o!=null&&(e.push(o),r.type.name==="blockquote"&&i<t.childCount-1)){let s=t.child(i+1);if(s.type.name==="paragraph"){let a=br(s);a.trim()===""||a===yr||e.push(yr)}}}return e.join(`
`)}function Th(n,t,e,i){var r,o;switch(n.type.name){case"heading":{let s=br(n);return`${"#".repeat((r=n.attrs.level)!=null?r:1)} ${s}`}case"paragraph":{let s=br(n);return s.trim()===""||s===yr?yr:s}case"blockquote":return aE(n,t).split(`
`).map(a=>`> ${a}`).join(`
`);case"bulletList":return sE(n,t,"-");case"orderedList":return sE(n,t,"1.");case"listItem":return aE(n,t);case"codeBlock":{let s=n.attrs.language?n.attrs.language:"",a=(o=n.textContent)!=null?o:"",l=a.endsWith(`
`)?a.slice(0,-1):a;return["```"+s,l,"```"].join(`
`)}case"horizontalRule":return"---";default:return br(n)}}function sE(n,t,e){var s;let i=[],r=" ".repeat(t),o=" ".repeat(t+e.length+1);for(let a=0;a<n.childCount;a++){let l=n.child(a),c=(s=Th(l,t+e.length+1,a,n.childCount))!=null?s:"",u=`${r}${e} `;i.push(c.split(`
`).map((d,h)=>h===0?u+d:/^\s/.test(d)?d:`${o}${d}`).join(`
`))}return i.join(`
`)}function aE(n,t){let e=[];for(let i=0;i<n.childCount;i++){let r=n.child(i),o=Th(r,t,i,n.childCount);o!=null&&e.push(o)}return e.join(`
`)}function br(n){var e,i,r,o,s,a,l;if(n.isText)return tN(n);if(n.type.name==="tategakiImage"){let c=(e=n.attrs)!=null?e:{},u=c.source==="obsidian"?"obsidian":"markdown",d=String((i=c.alt)!=null?i:""),h=String((r=c.title)!=null?r:""),p=typeof c.width=="number"?c.width:null,f=typeof c.height=="number"?c.height:null;if(u==="obsidian"){let b=String(c.obsidianSrc||c.originalSrc||"");if(!b)return"";let y=[];if(p!=null&&Number.isFinite(p)){let E=f!=null&&Number.isFinite(f)?`${p}x${f}`:String(p);y.push(E)}d&&y.push(d);let v=y.length>0?`|${y.join("|")}`:"";return`![[${b}${v}]]`}let g=String(c.originalSrc||c.src||"");if(!g)return"";let m=h?` "${h.replace(/"/g,'\\"')}"`:"";return`![${d}](${g}${m})`}if(n.type.name==="hardBreak")return"<br>";if(n.type.name==="wbr")return"<wbr>";if(n.type.name==="aozoraRuby"){let c=(o=n.textContent)!=null?o:"",u=(a=(s=n.attrs)==null?void 0:s.ruby)!=null?a:"";return!c||!u?c:`${(l=n.attrs)!=null&&l.hasDelimiter?"\uFF5C":""}${c}\u300A${u}\u300B`}let t="";for(let c=0;c<n.childCount;c++)t+=br(n.child(c));return t}function To(n){return br(n)}function tN(n){var o,s,a,l,c,u,d,h,p;let t=(o=n.text)!=null?o:"";if(!t)return"";let e=(s=n.marks)!=null?s:[],i=e.find(f=>f.type.name==="spanStyle"),r=e.filter(f=>f.type.name!=="spanStyle");for(let f of r)switch(f.type.name){case"bold":t=`**${t}**`;break;case"italic":t=`*${t}*`;break;case"strike":t=`~~${t}~~`;break;case"underline":t=`<u>${t}</u>`;break;case"code":t=`\`${t}\``;break;case"obsidianHighlight":t=`==${t}==`;break;case"link":{let g=((a=f.attrs)==null?void 0:a.href)||"";t=`[${t}](${g})`;break}case"superscript":t=`<sup>${t}</sup>`;break;case"subscript":t=`<sub>${t}</sub>`;break;case"smallText":t=`<small>${t}</small>`;break}if(i){let f=(c=(l=i.attrs)==null?void 0:l.class)!=null?c:"",g=(d=(u=i.attrs)==null?void 0:u.style)!=null?d:"",m=(p=(h=i.attrs)==null?void 0:h.dataAttrs)!=null?p:{},b=[];f&&b.push(`class="${At(f)}"`),g&&b.push(`style="${At(g)}"`);for(let[v,E]of Object.entries(m))v.startsWith("data-")&&b.push(`${v}="${At(E)}"`);t=`<span${b.length>0?` ${b.join(" ")}`:""}>${t}</span>`}return t}function nN(n){let t=new RegExp(`[\\t ]*${rN(yr)}[\\t ]*`,"g");return n.replace(t,"")}function iN(n,t){let e="",i="",r=null;for(let o=0;o<n.length;){let s=n[o];if(s!=="`"){i+=s,o+=1;continue}let a=o;for(;a<n.length&&n[a]==="`";)a+=1;let l=n.slice(o,a);if(r===null){e+=t(i),i="",e+=l,r=l,o=a;continue}if(l.length===r.length){e+=i,i="",e+=l,r=null,o=a;continue}i+=l,o=a}return r===null?e+=t(i):e+=i,e}function hE(n){let t=n.split(`
`),e=[],i="",r="",o=!1,s="",a=0,l=()=>{i&&(e.push({text:i,convert:!0}),i="")},c=()=>{r&&(e.push({text:r,convert:!1}),r="")};for(let u=0;u<t.length;u++){let d=t[u],h=u===t.length-1?"":`
`;if(!o){let g=d.match(/^\s*(`{3,}|~{3,})/);if(g){l(),o=!0,s=g[1][0],a=g[1].length,r+=d+h;continue}i+=d+h;continue}r+=d+h;let p=d.match(/^\s*(`{3,}|~{3,})\s*$/);if(!p)continue;let f=p[1];f[0]===s&&(f.length<a||(o=!1,s="",a=0,c()))}return r&&c(),i&&l(),e}function rN(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function At(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var al=class{constructor(t){this.isActive=!1;this.currentPlainParagraph=null;this.pluginKey=new se("tategakiPlainEdit");this.plugin=null;this.overlayEl=null;this.overlayHost=null;this.overlayActivePos=null;this.overlayBaseRect=null;this.isApplying=!1;this.lastView=null;this.isComposing=!1;this.pendingSelection=null;this.suppressFocusOnNextStart=!1;this.outsidePointerHandler=null;this.options=t}isPlainMode(){return this.isActive}suspendOverlay(){this.overlayEl&&(document.activeElement===this.overlayEl&&this.overlayEl.blur(),this.overlayEl.style.display="none",this.overlayEl.style.pointerEvents="none")}resumeOverlay(){this.overlayEl&&this.isActive&&this.overlayActivePos!=null&&(this.overlayEl.style.display="",this.overlayEl.style.pointerEvents="")}blurOverlay(){this.suspendOverlay()}getSelectionText(){var o,s;if(!this.overlayEl)return"";let t=(o=this.overlayEl.selectionStart)!=null?o:0,e=(s=this.overlayEl.selectionEnd)!=null?s:t,i=Math.min(t,e),r=Math.max(t,e);return this.overlayEl.value.slice(i,r)}applyInlineCommand(t){var e,i;if(!this.isActive||!this.overlayEl)return!1;switch(t.type){case"bold":return this.wrapSelection("**","**"),!0;case"italic":return this.wrapSelection("*","*"),!0;case"strike":return this.wrapSelection("~~","~~"),!0;case"underline":return this.wrapSelection("<u>","</u>"),!0;case"highlight":return this.wrapSelection("==","=="),!0;case"clear":return this.clearSelectionFormatting(),!0;case"link":return this.insertLink((e=t.text)!=null?e:"",t.url),!0;case"ruby":return this.insertRuby((i=t.text)!=null?i:"",t.ruby,t.isDot),!0}return!1}isOverlayTarget(t){return!this.overlayEl||!t||!(t instanceof Node)?!1:t===this.overlayEl||this.overlayEl.contains(t)}activate(){var t,e;this.isActive||(this.isActive=!0,this.registerPlugin(),this.registerOutsidePointerHandler(),(e=(t=this.options).onModeChange)==null||e.call(t,!0))}deactivate(){var t,e;this.isActive&&(this.commitCurrentPlainParagraph(!0),this.unregisterOutsidePointerHandler(),this.unregisterPlugin(),this.isActive=!1,(e=(t=this.options).onModeChange)==null||e.call(t,!1))}toggle(){this.isActive?this.deactivate():this.activate()}registerPlugin(){this.plugin||(this.plugin=this.createPlainEditPlugin(),this.options.editor.registerPlugin(this.plugin))}unregisterPlugin(){this.plugin&&(this.options.editor.unregisterPlugin(this.pluginKey),this.plugin=null,this.destroyOverlay())}createPlainEditPlugin(){return new X({key:this.pluginKey,state:{init:(t,e)=>({pos:this.findParagraphPos(e)}),apply:(t,e,i,r)=>({pos:this.findParagraphPos(r)})},props:{decorations:t=>this.buildDecorations(t)},view:t=>this.createOverlayView(t)})}registerOutsidePointerHandler(){this.outsidePointerHandler||(this.outsidePointerHandler=t=>{!this.isActive||this.isApplying||!this.currentPlainParagraph||t.target instanceof Element&&(this.isFocusInsideView(t.target)||(this.suppressFocusOnNextStart=!0,this.commitCurrentPlainParagraph(!0)))},document.addEventListener("pointerdown",this.outsidePointerHandler,!0))}unregisterOutsidePointerHandler(){this.outsidePointerHandler&&(document.removeEventListener("pointerdown",this.outsidePointerHandler,!0),this.outsidePointerHandler=null)}buildDecorations(t){var s;if(!this.isActive)return null;let e=this.pluginKey.getState(t),i=(s=e==null?void 0:e.pos)!=null?s:null;if(i==null)return null;let r=t.doc.nodeAt(i);if(!r||!this.isPlainTargetNode(r))return null;let o=Ne.node(i,i+r.nodeSize,{class:"tategaki-plain-overlay-target","data-plain-mode":"true"});return ke.create(t.doc,[o])}createOverlayView(t){return this.ensureOverlayElement(t),this.updateOverlayFromView(t),{update:e=>{this.updateOverlayFromView(e)},destroy:()=>{this.destroyOverlay()}}}ensureOverlayElement(t){var r;let e=(r=t.dom.parentElement)!=null?r:t.dom;this.overlayHost=e,this.overlayEl||(this.overlayEl=document.createElement("textarea"),this.overlayEl.className="tategaki-plain-overlay",this.overlayEl.spellcheck=!1,this.overlayEl.wrap="soft",this.overlayEl.addEventListener("mousedown",o=>{o.button===2&&o.preventDefault(),o.stopPropagation()}),this.overlayEl.addEventListener("compositionstart",()=>{this.isComposing=!0}),this.overlayEl.addEventListener("compositionend",()=>{this.isComposing=!1}),this.overlayEl.addEventListener("keydown",o=>{var s,a;if(o.key==="Escape"){o.preventDefault(),this.deactivate();return}if(o.key.startsWith("Arrow")&&!o.shiftKey&&!o.altKey&&!o.metaKey&&!o.ctrlKey&&!o.isComposing&&!this.isComposing&&o.keyCode!==229&&this.handleArrowKey(o.key)){o.preventDefault();return}if(o.key==="Backspace"&&!o.shiftKey&&!o.isComposing&&!this.isComposing&&o.keyCode!==229&&((s=this.overlayEl)==null?void 0:s.selectionStart)===0&&((a=this.overlayEl)==null?void 0:a.selectionEnd)===0){o.preventDefault(),this.handleBackspaceAtStart();return}if(o.key==="Enter"&&!o.shiftKey&&!o.isComposing&&!this.isComposing&&o.keyCode!==229){o.preventDefault(),this.handleEnterKey();return}o.stopPropagation()}),this.overlayEl.addEventListener("input",()=>{var o,s;this.adjustOverlaySizeToContent(),(s=(o=this.options).onUpdate)==null||s.call(o)})),getComputedStyle(e).position==="static"&&(e.style.position="relative"),this.overlayEl.parentElement||e.appendChild(this.overlayEl)}updateOverlayFromView(t){var r;if(!this.isActive||this.isApplying){this.hideOverlay();return}this.lastView=t;let e=this.pluginKey.getState(t.state),i=(r=e==null?void 0:e.pos)!=null?r:null;if(i==null){this.commitCurrentPlainParagraph(!0),this.hideOverlay();return}this.overlayActivePos!==i?(this.commitCurrentPlainParagraph(!0),this.startPlainParagraph(t,i)):this.currentPlainParagraph&&(this.currentPlainParagraph.pos=i),this.positionOverlay(t,i)}startPlainParagraph(t,e){let i=t.state.doc.nodeAt(e);if(!i||!this.isPlainTargetNode(i)){this.overlayActivePos=null,this.hideOverlay();return}let r=this.serializeInlineHtml(i),o=this.serializePlainMarkdown(i);if(this.currentPlainParagraph={pos:e,originalHtml:r,originalMarkdown:o},this.overlayEl&&(this.overlayEl.value=o,this.overlayEl.style.display="",this.suppressFocusOnNextStart||this.overlayEl.focus({preventScroll:!0}),this.suppressFocusOnNextStart=!1,this.pendingSelection)){let s=this.overlayEl.value.length,a=Math.min(this.pendingSelection.start,s),l=Math.min(this.pendingSelection.end,s);try{this.overlayEl.setSelectionRange(a,l)}catch(c){}this.pendingSelection=null}this.overlayActivePos=e}commitCurrentPlainParagraph(t){var r,o,s,a;if(!this.currentPlainParagraph){this.overlayActivePos=null;return}let e=(o=(r=this.overlayEl)==null?void 0:r.value)!=null?o:"";if(t&&e!==this.currentPlainParagraph.originalMarkdown){let{content:l,attrs:c}=this.normalizePlainMarkdown(e),u=this.renderInlineMarkdownToHtml(l);this.applyInlineHtmlToParagraph(this.currentPlainParagraph.pos,u,!0,c),(a=(s=this.options).onCommit)==null||a.call(s)}this.currentPlainParagraph=null,this.overlayActivePos=null}isFocusInsideView(t){var i,r,o;let e=(o=(r=(i=this.options).getViewRoot)==null?void 0:r.call(i))!=null?o:this.overlayHost;return!e||!t?!1:e.contains(t)}positionOverlay(t,e){if(!this.overlayEl||!this.overlayHost)return;let i=this.getParagraphElementAtPos(t,e);if(!i){this.hideOverlay();return}this.syncOverlayStyleFromParagraph(i);let r=i.getBoundingClientRect(),o=this.overlayHost.getBoundingClientRect(),s=this.adjustRectForVerticalListItem(i,r),a=s.top-o.top+this.overlayHost.scrollTop,l=s.left-o.left+this.overlayHost.scrollLeft;this.overlayEl.style.top=`${a}px`,this.overlayEl.style.left=`${l}px`,this.overlayEl.style.width=`${s.width}px`,this.overlayEl.style.height=`${s.height}px`,this.overlayBaseRect={top:a,left:l,width:s.width,height:s.height},this.adjustOverlaySizeToContent()}adjustRectForVerticalListItem(t,e){if(this.getCurrentWritingMode()!=="vertical-rl")return e;let r=t.closest("li");if(!r)return e;let o=getComputedStyle(t),s=parseFloat(o.fontSize)||16,l=(parseFloat(o.lineHeight)||s*1.5)*1.3;if(!(e.width>l*1.5)){let u=r.getBoundingClientRect();return new DOMRect(e.right-l,u.top,l,u.height)}return e}wrapSelection(t,e){if(!this.overlayEl)return;let i=this.getSelectionRange(),r=i.text,o=`${t}${r}${e}`,s=i.start+t.length,a=s+r.length;if(i.start===i.end){this.replaceSelection(o,s,s);return}this.replaceSelection(o,s,a)}clearSelectionFormatting(){if(!this.overlayEl)return;let t=this.getSelectionRange();if(t.start===t.end)return;let e=this.stripInlineFormatting(t.text),i=t.start,r=i+e.length;this.replaceSelection(e,i,r)}insertLink(t,e){if(!this.overlayEl)return;let i=this.getSelectionRange(),r=t||i.text||e;if(!r||!e)return;let o=`[${r}](${e})`,s=i.start+1,a=s+r.length;this.replaceSelection(o,s,a)}insertRuby(t,e,i){if(!this.overlayEl)return;let r=this.getSelectionRange(),o=t||r.text;if(!o)return;if(!e||e.trim()===""){this.replaceSelection(o);return}let s="";i?s=Array.from(o).map(l=>`\uFF5C${l}\u300A\u30FB\u300B`).join(""):s=`\uFF5C${o}\u300A${e}\u300B`;let a=r.start+s.length;this.replaceSelection(s,a,a)}replaceSelection(t,e,i){var d,h;if(!this.overlayEl)return;let r=this.getSelectionRange(),o=this.overlayEl.value,s=o.slice(0,r.start),a=o.slice(r.end);this.overlayEl.value=`${s}${t}${a}`;let l=s.length,c=e!=null?e:l+t.length,u=i!=null?i:c;try{this.overlayEl.setSelectionRange(c,u)}catch(p){}(h=(d=this.options).onUpdate)==null||h.call(d),this.adjustOverlaySizeToContent()}getSelectionRange(){var o,s;if(!this.overlayEl)return{start:0,end:0,text:""};let t=(o=this.overlayEl.selectionStart)!=null?o:0,e=(s=this.overlayEl.selectionEnd)!=null?s:t,i=Math.min(t,e),r=Math.max(t,e);return{start:i,end:r,text:this.overlayEl.value.slice(i,r)}}stripInlineFormatting(t){let e=t;e=e.replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1"),e=e.replace(/==([^=\n]+)==/g,"$1"),e=e.replace(/\*\*([^*\n]+)\*\*/g,"$1"),e=e.replace(/\*([^*\n]+)\*/g,"$1"),e=e.replace(/~~([^~\n]+)~~/g,"$1"),e=e.replace(/<u>([\s\S]*?)<\/u>/gi,"$1");let i=Gt();return e=e.replace(i,(r,...o)=>{var a,l;let s=o[o.length-1];return(l=(a=s==null?void 0:s.body2)!=null?a:s==null?void 0:s.body1)!=null?l:r}),e}adjustOverlaySizeToContent(){if(!this.overlayEl||!this.overlayBaseRect)return;let t=this.overlayBaseRect,e=2,i=Math.max(0,Math.ceil(t.width)),r=Math.max(0,Math.ceil(t.height));this.overlayEl.style.width=`${i}px`,this.overlayEl.style.height=`${r}px`;let o=Math.ceil(this.overlayEl.scrollWidth),s=Math.ceil(this.overlayEl.scrollHeight),a=Math.max(i,o+e),l=Math.max(r,s+e);if(this.overlayEl.style.width=`${a}px`,this.overlayEl.style.height=`${l}px`,(this.overlayEl.style.writingMode||getComputedStyle(this.overlayEl).writingMode)==="vertical-rl"){let u=t.left+t.width-a;this.overlayEl.style.left=`${u}px`}else this.overlayEl.style.left=`${t.left}px`;this.overlayEl.style.top=`${t.top}px`}getParagraphElementAtPos(t,e){var o;let i=t.domAtPos(e+1).node,r=i.nodeType===Node.ELEMENT_NODE?i:i.parentElement;return r?(o=r.closest("p, h1, h2, h3, h4, h5, h6"))!=null?o:r:null}findParagraphPos(t){let{$from:e}=t.selection;for(let i=e.depth;i>0;i--){let r=e.node(i);if(this.isPlainTargetNode(r))return e.before(i)}return null}isPlainTargetNode(t){return t.type.name==="paragraph"||t.type.name==="heading"}serializeInlineHtml(t){let e=qt.fromSchema(this.options.editor.schema),i=document.createElement("div");return i.appendChild(e.serializeFragment(t.content)),i.innerHTML}renderInlineMarkdownToHtml(t){var i,r,o;let e=(o=(r=(i=this.options).getRubyEnabled)==null?void 0:r.call(i))!=null?o:!0;return uE(t,{enableRuby:e})}serializePlainMarkdown(t){var e;if(t.type.name==="heading"){let i=typeof((e=t.attrs)==null?void 0:e.level)=="number"?t.attrs.level:1,r="#".repeat(Math.min(Math.max(i,1),6)),o=To(t);return`${r} ${o}`.trimEnd()}return To(t)}normalizePlainMarkdown(t){var s;let e=this.currentPlainParagraph?this.options.editor.state.doc.nodeAt(this.currentPlainParagraph.pos):null;if(!e||e.type.name!=="heading")return{content:t};let i=typeof((s=e.attrs)==null?void 0:s.level)=="number"?e.attrs.level:1,r=this.parseHeadingMarkdown(t,i),o={...e.attrs,level:r.level};return{content:r.content,attrs:o}}parseHeadingMarkdown(t,e){var r;let i=t.match(/^(#{1,6})\s+(.*)$/);return i?{level:Math.min(Math.max(i[1].length,1),6),content:(r=i[2])!=null?r:""}:{level:e,content:t}}handleEnterKey(){var C,I,F,N;let t=this.lastView;if(!t||!this.overlayEl||!this.currentPlainParagraph)return;let e=(C=this.overlayEl.value)!=null?C:"",i=(I=this.overlayEl.selectionStart)!=null?I:e.length,r=(F=this.overlayEl.selectionEnd)!=null?F:i,o=e.slice(0,i),s=e.slice(r),a=this.options.editor.state,l=a.doc.nodeAt(this.currentPlainParagraph.pos);if(!l)return;let c=a.schema.nodes.paragraph;if(!c)return;let u=l.type.name==="heading",d=typeof((N=l.attrs)==null?void 0:N.level)=="number"?l.attrs.level:1,h=vt.fromSchema(a.schema),p=document.createElement("div"),f=u?this.parseHeadingMarkdown(o,d):{level:d,content:o};p.innerHTML=this.renderInlineMarkdownToHtml(f.content);let g=h.parseSlice(p,{preserveWhitespace:!0}),m=u?l.type.createChecked({...l.attrs,level:f.level},g.content):c.createChecked(null,g.content),b=document.createElement("div"),y=u?this.stripHeadingPrefix(s):s;b.innerHTML=this.renderInlineMarkdownToHtml(y);let v=h.parseSlice(b,{preserveWhitespace:!0}),E=c.createChecked(null,v.content),x=this.currentPlainParagraph.pos,k=x+l.nodeSize;this.currentPlainParagraph=null,this.overlayActivePos=null,this.hideOverlay();let S=a.tr.replaceWith(x,k,[m,E]),w=x+m.nodeSize+1;S.setSelection(j.create(S.doc,w)),t.dispatch(S),requestAnimationFrame(()=>{this.isActive&&this.lastView&&this.updateOverlayFromView(this.lastView)})}stripHeadingPrefix(t){var i;let e=t.match(/^(#{1,6})\s+(.*)$/);return e?(i=e[2])!=null?i:"":t}handleBackspaceAtStart(){var x;let t=this.lastView;if(!t||!this.overlayEl||!this.currentPlainParagraph)return;let e=this.options.editor.state,i=this.currentPlainParagraph.pos,r=e.doc.nodeAt(i);if(!r)return;let o=e.doc.resolve(i),s=o.index(o.depth);if(s===0)return;let l=o.parent.child(s-1);if(!l||!l.isTextblock)return;let c=i-l.nodeSize,u=To(l),d=(x=this.overlayEl.value)!=null?x:"",h=`${u}${d}`,p=vt.fromSchema(e.schema),f=document.createElement("div");f.innerHTML=this.renderInlineMarkdownToHtml(h);let g=p.parseSlice(f,{preserveWhitespace:!0}),m=l.type.createChecked(l.attrs,g.content);this.currentPlainParagraph=null,this.overlayActivePos=c,this.overlayEl.value=h;try{this.overlayEl.setSelectionRange(u.length,u.length)}catch(k){}let b=c,y=i+r.nodeSize,v=e.tr.replaceWith(b,y,m),E=c+1+l.content.size;v.setSelection(j.create(v.doc,E)),t.dispatch(v)}handleArrowKey(t){var g,m,b;if(!this.overlayEl||!this.currentPlainParagraph)return!1;let e=(g=this.overlayEl.value)!=null?g:"",i=(m=this.overlayEl.selectionStart)!=null?m:0,r=(b=this.overlayEl.selectionEnd)!=null?b:i;if(i!==r)return!1;let o=i===0,s=i===e.length;if(!o&&!s)return!1;let a=this.getArrowMoveDirection(t,o,s,this.getCurrentWritingMode());if(!a)return!1;let l=this.currentPlainParagraph.pos;this.commitCurrentPlainParagraph(!0);let c=this.options.editor.state,u=this.findAdjacentPlainParagraph(c,l,a);if(!u)return!1;let d=To(u.node),h=a==="prev"?d.length:0;this.pendingSelection={start:h,end:h};let p=a==="prev"?u.pos+u.node.content.size:u.pos+1,f=c.tr.setSelection(j.create(c.doc,p));return this.options.editor.view.dispatch(f),!0}getArrowMoveDirection(t,e,i,r){return r==="vertical-rl"?i&&t==="ArrowLeft"?"next":e&&t==="ArrowRight"?"prev":null:i&&t==="ArrowDown"?"next":e&&t==="ArrowUp"?"prev":null}getCurrentWritingMode(){return this.overlayEl&&getComputedStyle(this.overlayEl).writingMode==="horizontal-tb"?"horizontal-tb":"vertical-rl"}findAdjacentPlainParagraph(t,e,i){let r=t.doc.nodeAt(e);if(!r)return null;let o=t.doc.resolve(e),s=o.depth,a=o.parent,l=o.index(s);if(i==="prev"){let u=e;for(let d=l-1;d>=0;d--){let h=a.child(d);if(u-=h.nodeSize,this.isPlainTargetNode(h))return{pos:u,node:h}}return null}let c=e+r.nodeSize;for(let u=l+1;u<a.childCount;u++){let d=a.child(u);if(this.isPlainTargetNode(d))return{pos:c,node:d};c+=d.nodeSize}return null}syncOverlayStyleFromParagraph(t){var s;if(!this.overlayEl)return;let e=getComputedStyle(t),i=this.overlayHost?getComputedStyle(this.overlayHost):null,r=this.overlayEl.style;r.fontFamily=e.fontFamily,r.fontSize=e.fontSize,r.fontWeight=e.fontWeight,r.fontStyle=e.fontStyle,r.lineHeight=e.lineHeight,r.letterSpacing=e.letterSpacing,r.textAlign=e.textAlign,r.textIndent=e.textIndent;let o=(e.color==="transparent"||e.color==="rgba(0, 0, 0, 0)")&&(s=i==null?void 0:i.color)!=null?s:e.color;r.color=o,r.caretColor=o,r.direction=e.direction,r.setProperty("writing-mode",e.getPropertyValue("writing-mode")),r.setProperty("text-orientation",e.getPropertyValue("text-orientation"))}applyInlineHtmlToParagraph(t,e,i,r){try{let{state:o,view:s}=this.options.editor,a=o.doc.nodeAt(t);if(!a)return;let l=document.createElement("div");l.innerHTML=e;let u=vt.fromSchema(o.schema).parseSlice(l,{preserveWhitespace:!0}),d=t+1,h=t+a.nodeSize-1,p=o.tr.replaceRange(d,h,u);r&&p.setNodeMarkup(t,void 0,r),i||p.setMeta("addToHistory",!1),this.isApplying=!0,s.dispatch(p)}catch(o){le("[Tategaki TipTap Plain Edit] Failed to apply html:",o)}finally{this.isApplying=!1}}hideOverlay(){this.overlayEl&&(this.overlayEl.style.display="none"),this.overlayBaseRect=null}destroyOverlay(){this.overlayEl&&(this.overlayEl.remove(),this.overlayEl=null),this.overlayHost=null,this.overlayActivePos=null,this.overlayBaseRect=null,this.currentPlainParagraph=null}destroy(){this.isActive&&this.deactivate()}};var pE=require("obsidian"),ll=class extends pE.Modal{constructor(e,i){super(e);this.result=null;this.resolvePromise=null;this.tags=i}onOpen(){let{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u672A\u5BFE\u5FDCHTML\u30BF\u30B0\u306E\u691C\u51FA"}),e.createEl("p",{text:"\u672A\u5BFE\u5FDC\u306EHTML\u30BF\u30B0\u304C\u542B\u307E\u308C\u3066\u3044\u308B\u305F\u3081\u3001\u305D\u306E\u307E\u307E\u7DE8\u96C6\u3059\u308B\u3068\u5931\u308F\u308C\u308B\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\u3002"}),this.tags.length>0){let a=e.createDiv();a.style.marginTop="8px",a.style.marginBottom="8px",a.createEl("div",{text:`\u691C\u51FA\u3055\u308C\u305F\u30BF\u30B0: ${this.tags.join(", ")}`})}let i=e.createDiv({cls:"modal-button-container"});i.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
			flex-wrap: wrap;
		`,i.createEl("button",{text:"\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u958B\u304F",cls:"mod-cta"}).addEventListener("click",()=>{this.result="read-only",this.close()}),i.createEl("button",{text:"\u7834\u68C4\u3057\u3066\u958B\u304F",cls:"mod-warning"}).addEventListener("click",()=>{this.result="discard",this.close()}),i.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB"}).addEventListener("click",()=>{this.result="cancel",this.close()})}onClose(){this.contentEl.empty(),this.resolvePromise&&this.resolvePromise(this.result||"cancel")}async waitForChoice(){return new Promise(e=>{this.resolvePromise=e,this.open()})}};var cl=new Set(["\u3001","\u3002","\uFF0C","\uFF0E",",",".","\uFF09",")","\uFF3D","]","\uFF5D","}","\u3011","\u300F","\u300D","\u3009","\u300A","\u3017","\u3019","\u301F","\u2019","\u201D","\xBB","\uFF01","\uFF1F","!","?","\uFF1B","\uFF1A",";",":"]),fE=new Set(["\uFF08","\u3014","\uFF3B","\uFF5B","\u3008","\u300A","\u300C","\u300E","\u3010","\u3018","\u3016","\u301D","\u2018","\u201C","\xAB","(","[","{"]),mE=new Set(["P","DIV","LI","BLOCKQUOTE","H1","H2","H3","H4","H5","H6"]);var ul=class{constructor(t){this.cancelled=!1;this.options=t}cancel(){this.cancelled=!0}async paginate(){var f,g;this.cancelled=!1;let t=(f=this.options.timeSliceMs)!=null?f:12,e={start:this.getNow()},i=(g=this.options.container)==null?void 0:g.ownerDocument;if(!i)return le("[MeasuredPagination] Missing ownerDocument"),[];let r=i.createElement("div");r.innerHTML=this.options.contentHtml;let o=this.collectTextNodes(r,i),s=this.buildPrefixLengths(o),a=this.buildTextNodeRanges(o,s),l=s.length>0?s[s.length-1]:0;if(Ve(`[MeasuredPagination] Content text length: ${l}`),Ve(`[MeasuredPagination] Text nodes: ${o.length}`),l===0)return le("[MeasuredPagination] No content to paginate"),[];let c=this.createBlockSegments(r,this.options.writingMode,i);Ve(`[MeasuredPagination] Created ${c.length} block segments`);let u={host:r,textNodes:o,prefixLengths:s,textNodeRanges:a,blockSegments:c,startIndex:0,totalLength:l,pageCount:0,cumulativeChars:0,lastCharCount:0,writingMode:this.options.writingMode},d=[],h=0,p=1e4;for(;u.startIndex<u.totalLength&&h<p;){if(this.cancelled){Ve("[MeasuredPagination] Pagination cancelled");break}let m=await this.computeNextPagePrecise(u,e,t);if(!m){le("[MeasuredPagination] computeNextPagePrecise returned null");break}if(d.push(m),this.options.onPage&&this.options.onPage(m),Ve(`[MeasuredPagination] Page ${u.pageCount}: chars=${m.charCount}, range=${m.startIndex}-${m.endIndex}`),this.options.onProgress&&this.options.onProgress(u.startIndex,u.totalLength),await this.maybeYield(e,t),this.cancelled){Ve("[MeasuredPagination] Pagination cancelled");break}h++}return Ve(`[MeasuredPagination] Pagination complete: ${d.length} pages, ${h} iterations`),d}getNow(){var e,i;let t=(e=this.options.container.ownerDocument.defaultView)==null?void 0:e.performance;return(i=t==null?void 0:t.now())!=null?i:Date.now()}async yieldToMain(){let t=this.options.container.ownerDocument.defaultView;if(t&&typeof t.requestAnimationFrame=="function"){await new Promise(e=>{t.requestAnimationFrame(()=>e())});return}await new Promise(e=>setTimeout(e,0))}async maybeYield(t,e){!Number.isFinite(e)||e<=0||this.getNow()-t.start<e||(await this.yieldToMain(),t.start=this.getNow())}createBlockSegments(t,e,i){var d,h;let r=e==="vertical-rl"||e==="vertical-lr",o=(h=(d=i.defaultView)==null?void 0:d.NodeFilter)!=null?h:NodeFilter,s=i.createTreeWalker(t,o.SHOW_TEXT,null),a=new Map,l=0,c;for(;c=s.nextNode();){let p=c.textContent;if(!p)continue;let f=this.findPaginationBlockAncestor(c,t);if(!f)continue;let g=p.length,m=l,b=l+g;if(l=b,a.has(f)){let y=a.get(f);y.end=b,y.charCount+=g}else a.set(f,{start:m,end:b,charCount:g})}let u=[];return a.forEach((p,f)=>{let g=this.measureBlockAxisSize(f,r);u.push({block:f,startIndex:p.start,endIndex:p.end,charCount:Math.max(1,p.charCount),axisSize:g>0?g:0})}),u.sort((p,f)=>p.startIndex-f.startIndex),u}findPaginationBlockAncestor(t,e){let i=t instanceof HTMLElement?t:t.parentElement;for(;i&&i!==e;){if(this.isPaginationBlockElement(i))return i;i=i.parentElement}return e}isPaginationBlockElement(t){return mE.has(t.tagName)}measureBlockAxisSize(t,e){try{let i=document.createRange();i.selectNodeContents(t);let r=i.getBoundingClientRect(),o=e?r.width:r.height;if(o>0)return o;let s=t.getBoundingClientRect(),a=e?s.width:s.height;if(a>0)return a}catch(i){Ve("[MeasuredPagination] measureBlockAxisSize failed",i)}return 0}async computeNextPagePrecise(t,e,i){if(this.cancelled||t.startIndex>=t.totalLength)return null;let r=this.createEmptyPage(),o=r.querySelector(".page-content");if(!o)return r.remove(),null;o.style.whiteSpace="normal",o.style.visibility="hidden";let s=t.totalLength-t.startIndex,a=t.lastCharCount,l=t.pageCount>0?Math.ceil(t.cumulativeChars/t.pageCount):0,c=Math.max(a,l);c<=0&&(c=Math.min(s,1800));let u=this.getPageAxisLimit(o,t.writingMode),d=this.estimateCharsForNextPage(t,u);d>0&&(c=Math.max(1,Math.min(s,d)));let h=1,p;if(d>0){let w=Math.max(64,Math.floor(c*.25));p=Math.min(s,c+w),p<1&&(p=Math.max(1,c+w))}else{let w=Math.max(512,Math.floor(c*1.1)),C=Math.min(s,Math.max(w,c+512));h=Math.max(1,Math.min(Math.floor(c*.5),C)),p=C}p<h&&(p=Math.max(h,Math.min(s,h+256)));let f=0;for(;h<=p;){if(this.cancelled||(await this.maybeYield(e,i),this.cancelled))return r.remove(),null;let w=Math.floor((h+p)/2);o.innerHTML="";let C=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,w);o.appendChild(C),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight,this.isOverflow(r,t.writingMode)?p=w-1:(f=w,h=w+1)}let g=Math.max(1,f),m=Math.max(1,Math.floor(Math.max(c,g)*.12));for(;t.startIndex+g<t.totalLength;){if(this.cancelled||(await this.maybeYield(e,i),this.cancelled))return r.remove(),null;let w=Math.min(s,Math.min(t.totalLength-t.startIndex,g+m));if(w<=g)break;o.innerHTML="";let C=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,w);if(o.appendChild(C),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight,this.isOverflow(r,t.writingMode)){if(m===1)break;m=Math.max(1,Math.floor(m/2))}else if(g=w,m=Math.max(1,Math.floor(m*1.5)),g>=s)break}let b=Math.max(1,Math.min(g,s)),y=0,v=32;for(;y<v;){if(this.cancelled||(await this.maybeYield(e,i),this.cancelled))return r.remove(),null;o.innerHTML="";let w=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,b);if(o.appendChild(w),this.pruneTrailingWhitespaceNodes(o),o.offsetHeight,!this.isOverflow(r,t.writingMode)||b<=1)break;b=Math.max(1,b-1),y++}b=this.adjustBreakForKinsoku(t,r,o,b),b=this.adjustBreakForRuby(t,r,o,b),b=this.adjustBreakForKinsoku(t,r,o,b),o.innerHTML="";let E=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,b);o.appendChild(E),this.pruneTrailingWhitespaceNodes(o),o.style.visibility="";let x=t.startIndex+b;this.isPageContinuation(t,x)?(r.setAttribute("data-continued","true"),this.markContinuationBlock(o)):r.removeAttribute("data-continued");let S={element:r,startIndex:t.startIndex,endIndex:t.startIndex+b,charCount:b};return t.startIndex+=b,t.pageCount+=1,t.cumulativeChars+=b,t.lastCharCount=b,S}markContinuationBlock(t){let e="p, li, blockquote, h1, h2, h3, h4, h5, h6, div",i=Array.from(t.querySelectorAll(e));for(let r=i.length-1;r>=0;r--){let o=i[r];if(!o.querySelector(e)){o.classList.add("tategaki-continued-block");return}}}isPageContinuation(t,e){if(e>=t.totalLength)return!1;let i=Math.max(t.startIndex,e-1),r=this.findContainingBlockSegment(t.blockSegments,i);return r?e<r.endIndex:!1}findContainingBlockSegment(t,e){for(let i of t)if(i.startIndex<=e&&e<i.endIndex)return i;return null}getPageAxisLimit(t,e){let i=e==="vertical-rl"||e==="vertical-lr";t.offsetWidth;let r=i?t.clientWidth:t.clientHeight;return Math.max(1,r)}estimateCharsForNextPage(t,e){if(!Number.isFinite(e)||e<=0||t.blockSegments.length===0)return 0;let i=Math.max(0,t.totalLength-t.startIndex);if(i===0)return 0;let r=t.blockSegments,o=t.startIndex,s=e,a=0,l=this.findFirstBlockSegmentIndex(r,o);for(;l<r.length&&s>0&&o<t.totalLength&&a<i;){let c=r[l];if(c.endIndex<=o){l++;continue}let u=c.endIndex-Math.max(c.startIndex,o);if(u<=0){l++;continue}let h=(c.axisSize>0?c.axisSize:e)/Math.max(1,c.charCount),p=h>0?h:e/Math.max(c.charCount,1);if(p<=0){let b=Math.min(u,Math.max(1,Math.floor(s)));a+=b,o+=b,s-=b*(e/Math.max(i,1)),l++;continue}let f=p*u;if(f<=s*1.05){a+=u,o+=u,s-=f,l++;continue}let g=Math.floor(s/p);if(g<=0)break;let m=Math.max(1,Math.min(u,g));a+=m,o+=m,s-=m*p;break}return Math.min(a,i)}findFirstBlockSegmentIndex(t,e){for(let i=0;i<t.length;i++)if(t[i].endIndex>e)return i;return t.length}createEmptyPage(){let t=this.options.container;if(!t)throw new Error("MeasuredPagination container is missing");let e=t.ownerDocument,i=e.createElement("div");i.className="tategaki-page",i.setAttribute("data-writing-mode",this.options.writingMode);let r=e.createElement("div");return r.className="page-content",i.appendChild(r),t.appendChild(i),i}collectTextNodes(t,e){var a,l;let i=[],r=(l=(a=e.defaultView)==null?void 0:a.NodeFilter)!=null?l:NodeFilter,o=e.createTreeWalker(t,r.SHOW_TEXT,null),s=o.nextNode();for(;s;)s.nodeType===Node.TEXT_NODE&&s.nodeValue&&s.nodeValue.length&&i.push(s),s=o.nextNode();return i}buildPrefixLengths(t){let e=[],i=0;for(let r of t){let o=r.nodeValue?r.nodeValue.length:0;i+=o,e.push(i)}return e}buildTextNodeRanges(t,e){var o;let i=new Map,r=0;for(let s=0;s<t.length;s+=1){let a=t[s],l=(o=e[s])!=null?o:r;i.set(a,{start:r,end:l}),r=l}return i}mapCharIndex(t,e,i){if(t.length===0)throw new Error("mapCharIndex called with empty textNodes");let r=Math.max(0,i),o=0,s=e.length-1;for(;o<=s;){let p=o+s>>>1,f=e[p];r<f?s=p-1:o=p+1}let a=Math.min(o,t.length-1),l=a>0?e[a-1]:0,c=t[a],u=c.nodeValue?c.nodeValue.length:0,d=r-l,h=Math.max(0,Math.min(u,d));return{node:c,offset:h}}cloneFragmentByCharRange(t,e,i,r){var c,u;let s=((u=(c=t[0])==null?void 0:c.ownerDocument)!=null?u:this.options.container.ownerDocument).createRange(),a=this.mapCharIndex(t,e,i),l=this.mapCharIndex(t,e,i+Math.max(1,r));return s.setStart(a.node,a.offset),s.setEnd(l.node,l.offset),s.cloneContents()}isOverflow(t,e){let i=t.querySelector(".page-content");return i?e==="vertical-rl"||e==="vertical-lr"?i.scrollWidth>i.clientWidth:i.scrollHeight>i.clientHeight:!1}pruneTrailingWhitespaceNodes(t){var i;let e=t.lastChild;for(;e;){if(e.nodeType===Node.TEXT_NODE){let o=(i=e.nodeValue)!=null?i:"";if(/^\s*$/.test(o)){let s=e.previousSibling;t.removeChild(e),e=s;continue}}break}}adjustBreakForKinsoku(t,e,i,r){var a,l,c,u,d,h,p,f;if(r<=1||t.startIndex+r>=t.totalLength)return r;let o=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+r),s=(l=(a=o.node.nodeValue)==null?void 0:a[o.offset])!=null?l:"";if(cl.has(s)){let g=r,m=Math.min(10,t.totalLength-t.startIndex-r),b=!1;for(let y=1;y<=m;y++){g=r+y,i.innerHTML="";let v=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,g);if(i.appendChild(v),this.pruneTrailingWhitespaceNodes(i),i.offsetHeight,this.isOverflow(e,t.writingMode))break;let E=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+g),x=(u=(c=E.node.nodeValue)==null?void 0:c[E.offset])!=null?u:"";if(!cl.has(x)){b=!0,r=g;break}}if(!b){let y=Math.min(80,r-1);for(let v=1;v<=y;v++){let E=r-v,x=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+E),k=(h=(d=x.node.nodeValue)==null?void 0:d[x.offset])!=null?h:"";if(!cl.has(k)){r=Math.max(1,E);break}}}}if(r>0){let g=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+r-1),m=(f=(p=g.node.nodeValue)==null?void 0:p[g.offset])!=null?f:"";if(fE.has(m))return Math.max(1,r-1)}return r}adjustBreakForRuby(t,e,i,r){if(r<=1||t.startIndex+r>=t.totalLength)return r;let o=this.mapCharIndex(t.textNodes,t.prefixLengths,t.startIndex+r),s=this.findRubyAncestor(o.node,t.host);if(!s)return r;let a=this.getElementTextRange(s,t.textNodeRanges);if(!a)return r;let l=a.start,c=a.end,u=t.startIndex+r;if(u<=l||u>=c)return r;let d=c-t.startIndex;if(d>r){i.innerHTML="";let p=this.cloneFragmentByCharRange(t.textNodes,t.prefixLengths,t.startIndex,d);if(i.appendChild(p),this.pruneTrailingWhitespaceNodes(i),i.offsetHeight,!this.isOverflow(e,t.writingMode))return d}let h=l-t.startIndex;return h>=1?Math.min(r,h):r}findRubyAncestor(t,e){let i=t instanceof HTMLElement?t:t.parentElement;for(;i&&i!==e;){if(i.tagName==="RUBY"||i.classList.contains("tategaki-aozora-ruby"))return i;i=i.parentElement}return null}getElementTextRange(t,e){var c,u;let i=t.ownerDocument;if(!i)return null;let r=(u=(c=i.defaultView)==null?void 0:c.NodeFilter)!=null?u:NodeFilter,o=i.createTreeWalker(t,r.SHOW_TEXT,null),s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=o.nextNode();for(;l;){if(l.nodeType===Node.TEXT_NODE){let d=e.get(l);d&&(s=Math.min(s,d.start),a=Math.max(a,d.end))}l=o.nextNode()}return!Number.isFinite(s)||!Number.isFinite(a)?null:{start:s,end:a}}};function gE(n,t){return Math.max(1,n+t)}function oN(n,t,e){let i=Math.max(0,Math.floor(n)),r=Math.max(1,t),o=gE(r,e);return i*o}var vr=class{constructor(t){this.styleEl=null;this.viewportEl=null;this.pagesContainerEl=null;this.pageElements=[];this.headerEl=null;this.footerEl=null;this.headerMaskEl=null;this.footerMaskEl=null;this.pageCount=0;this.pageIndex=0;this.pendingPageIndex=null;this.renderToken=0;this.destroyed=!1;this.isRendering=!1;this.hasRenderedOnce=!1;this.paginationInProgress=!1;this.transitionTimeouts=[];this.pendingRender=!1;this.lastViewportSize=null;this.pendingViewportSize=null;this.activePagination=null;this.debugLayout=!0;this.lastLayoutMetrics=null;this.lastLineMetrics=null;this.layoutLinePitchPx=null;this.resizeObserver=null;this.resizeTimeout=null;this.keydownHandler=null;this.wheelHandler=null;this.pointerDownHandler=null;this.pointerUpHandler=null;this.pointerCancelHandler=null;this.pointerStartX=null;this.pointerStartY=null;this.pointerStartTime=0;var e,i;this.container=t.container,this.contentHtml=t.contentHtml,this.writingMode=t.writingMode,this.settings=t.settings,this.previewSettings=(e=t.previewSettings)!=null?e:{syncCursor:!0,updateInterval:300,headerContent:"none",headerAlign:"center",footerContent:"pageNumber",footerAlign:"center",pageNumberFormat:"currentTotal"},this.title=(i=t.title)!=null?i:"",this.onPageChange=t.onPageChange,this.onPageAdded=t.onPageAdded,this.onRepaginationRequired=t.onRepaginationRequired,this.onRendered=t.onRendered,this.initialize()}destroy(){var t,e,i,r,o,s,a,l,c,u;this.destroyed=!0,this.renderToken+=1,this.removeInputHandlers(),this.resizeTimeout!==null&&(((t=this.container.ownerDocument.defaultView)!=null?t:window).clearTimeout(this.resizeTimeout),this.resizeTimeout=null),(e=this.resizeObserver)==null||e.disconnect(),this.resizeObserver=null,(i=this.activePagination)==null||i.cancel(),this.activePagination=null,(r=this.styleEl)==null||r.remove(),this.styleEl=null,this.pageElements.forEach(d=>d.remove()),this.pageElements=[],(o=this.pagesContainerEl)==null||o.remove(),this.pagesContainerEl=null,(s=this.headerEl)==null||s.remove(),this.headerEl=null,(a=this.footerEl)==null||a.remove(),this.footerEl=null,(l=this.headerMaskEl)==null||l.remove(),this.headerMaskEl=null,(c=this.footerMaskEl)==null||c.remove(),this.footerMaskEl=null,(u=this.viewportEl)==null||u.remove(),this.viewportEl=null,this.pageCount=0,this.pageIndex=0}getProgress(){return this.pageCount<=1?0:this.pageIndex/(this.pageCount-1)}repaginate(){this.destroyed||this.render()}jumpToProgress(t){if(this.pageCount<=1)return;let e=Math.max(0,Math.min(1,t)),i=Math.round(e*(this.pageCount-1));this.goToPage(i,!1)}scrollToPage(t,e=!0){this.goToPage(t,e)}initialize(){this.container.classList.add("tategaki-reading-paged-container"),this.container.hasAttribute("tabindex")||(this.container.tabIndex=-1),this.container.style.setProperty("--tategaki-writing-mode",this.writingMode),this.container.style.setProperty("--tategaki-font-family",this.settings.fontFamily),this.container.style.setProperty("--tategaki-font-size",`${this.settings.fontSize}px`),this.container.style.setProperty("--tategaki-line-height",this.settings.lineHeight.toString()),this.container.style.setProperty("--tategaki-letter-spacing",`${this.settings.letterSpacing}em`),this.container.style.setProperty("--tategaki-text-color",this.settings.textColor),this.container.style.setProperty("--tategaki-background-color",this.settings.backgroundColor),this.container.style.setProperty("--tategaki-page-background-color",this.settings.pageBackgroundColor),this.container.style.setProperty("--tategaki-ruby-size",this.settings.rubySize.toString()),this.container.style.setProperty("--ruby-size",this.settings.rubySize.toString()),this.container.style.setProperty("--tategaki-ruby-gap-vertical",`${this.settings.rubyVerticalGap}em`),this.container.style.setProperty("--tategaki-ruby-gap-horizontal",`${this.settings.rubyHorizontalGap}em`);let t=this.settings.headingFontFamily||this.settings.fontFamily,e=this.settings.headingTextColor||this.settings.textColor;this.container.style.setProperty("--tategaki-heading-font-family",t),this.container.style.setProperty("--tategaki-heading-text-color",e);let i=this.container.ownerDocument;this.styleEl=i.createElement("style"),this.styleEl.setAttribute("data-tategaki-reading-paged","true"),i.head.appendChild(this.styleEl),this.viewportEl=i.createElement("div"),this.viewportEl.className="tategaki-reading-paged-viewport",this.pagesContainerEl=i.createElement("div"),this.pagesContainerEl.className="tategaki-reading-paged-pages-container",this.viewportEl.appendChild(this.pagesContainerEl),this.container.appendChild(this.viewportEl),this.updatePaginationLayoutClasses(),this.ensureFixedHeaderFooterElements(),this.setupInputHandlers();try{this.container.focus()}catch(r){}this.setupResizeObserver(),this.render()}setupResizeObserver(){let t=this.container.ownerDocument.defaultView;!this.container||!(t!=null&&t.ResizeObserver)||(this.resizeObserver=new t.ResizeObserver(()=>{this.resizeTimeout!==null&&t.clearTimeout(this.resizeTimeout),this.resizeTimeout=t.setTimeout(()=>{if(!this.destroyed&&this.viewportEl){if(this.isOverlayOpen())return;let e=this.getViewportSize();if(this.lastViewportSize&&this.lastViewportSize.width===e.width&&this.lastViewportSize.height===e.height)return;if(this.onRepaginationRequired&&this.hasRenderedOnce){this.onRepaginationRequired();return}if(this.isRendering){this.pendingRender=!0,this.pendingViewportSize=e;return}let i=this.getPageGapPx();if(this.writingMode==="vertical-rl"){let r=this.viewportEl.scrollLeft,o=this.viewportEl.clientWidth;if(o>0){let s=Math.max(0,this.viewportEl.scrollWidth-o);this.pageIndex=Math.round((s-r)/(o+i))}}else{let r=this.viewportEl.scrollTop,o=this.viewportEl.clientHeight;o>0&&(this.pageIndex=Math.round(r/(o+i)))}this.render()}},50)}),this.resizeObserver.observe(this.container))}setupInputHandlers(){var t;this.removeInputHandlers(),this.keydownHandler=e=>{if(this.isEventTargetWithinContainer(e.target)&&!this.isOverlayOpen()&&this.isContainerInActiveLeaf()){if(e.key==="PageUp"){e.preventDefault(),this.previousPage();return}if(e.key==="PageDown"){e.preventDefault(),this.nextPage();return}if(e.key==="Home"){e.preventDefault(),this.goToFirstPage();return}if(this.writingMode==="vertical-rl"){if(e.key==="ArrowLeft"){e.preventDefault(),this.nextPage();return}if(e.key==="ArrowRight"){e.preventDefault(),this.previousPage();return}}else{if(e.key==="ArrowDown"){e.preventDefault(),this.nextPage();return}if(e.key==="ArrowUp"){e.preventDefault(),this.previousPage();return}}}},this.wheelHandler=e=>{if(e.defaultPrevented||!this.isEventTargetWithinContainer(e.target)||this.isOverlayOpen()||!this.isContainerInActiveLeaf()||this.isWithinScrollableElement(e.target))return;let i=Math.abs(e.deltaX)>Math.abs(e.deltaY)?e.deltaX:e.deltaY;i!==0&&(e.preventDefault(),i>0?this.nextPage():this.previousPage())},this.pointerDownHandler=e=>{try{this.container.focus()}catch(i){}e.pointerType&&e.pointerType!=="touch"&&e.pointerType!=="pen"||(this.pointerStartX=e.clientX,this.pointerStartY=e.clientY,this.pointerStartTime=Date.now())},this.pointerUpHandler=e=>{if(this.pointerStartX===null||this.pointerStartY===null)return;let i=e.clientX-this.pointerStartX,r=e.clientY-this.pointerStartY,o=Date.now()-this.pointerStartTime;this.pointerStartX=null,this.pointerStartY=null,this.pointerStartTime=0;let s=Math.abs(i),a=Math.abs(r),l=12,c=40;if(s<=l&&a<=l&&o<=400){let h=this.container.getBoundingClientRect(),p=h.left+h.width/2;e.clientX<p?this.nextPage():this.previousPage();return}if(this.writingMode==="vertical-rl"){if(s<c||s<a)return;i<0?this.nextPage():this.previousPage();return}a<c||a<s||(r<0?this.nextPage():this.previousPage())},this.pointerCancelHandler=()=>{this.pointerStartX=null,this.pointerStartY=null,this.pointerStartTime=0},this.container.addEventListener("keydown",this.keydownHandler),this.container.addEventListener("pointerdown",this.pointerDownHandler,{capture:!0}),this.container.addEventListener("pointerup",this.pointerUpHandler),this.container.addEventListener("pointercancel",this.pointerCancelHandler),this.container.addEventListener("wheel",this.wheelHandler,{passive:!1}),(t=this.viewportEl)==null||t.addEventListener("wheel",this.wheelHandler,{passive:!1}),this.container.ownerDocument.addEventListener("wheel",this.wheelHandler,{passive:!1,capture:!0})}updatePaginationLayoutClasses(){if(!this.viewportEl||!this.pagesContainerEl)return;let t=this.writingMode==="vertical-rl";this.viewportEl.classList.toggle("pages-horizontal-reverse",t),this.viewportEl.classList.toggle("pages-vertical",!t),this.pagesContainerEl.classList.toggle("pages-horizontal-reverse",t),this.pagesContainerEl.classList.toggle("pages-vertical",!t)}removeInputHandlers(){var t;this.keydownHandler&&(this.container.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null),this.wheelHandler&&(this.container.removeEventListener("wheel",this.wheelHandler),(t=this.viewportEl)==null||t.removeEventListener("wheel",this.wheelHandler),this.container.ownerDocument.removeEventListener("wheel",this.wheelHandler,{capture:!0}),this.wheelHandler=null),this.pointerDownHandler&&(this.container.removeEventListener("pointerdown",this.pointerDownHandler),this.pointerDownHandler=null),this.pointerUpHandler&&(this.container.removeEventListener("pointerup",this.pointerUpHandler),this.pointerUpHandler=null),this.pointerCancelHandler&&(this.container.removeEventListener("pointercancel",this.pointerCancelHandler),this.pointerCancelHandler=null)}isEventTargetWithinContainer(t){return!t||!(t instanceof Element)?!1:this.container.contains(t)}isOverlayOpen(){let t=this.container.ownerDocument;if(t.querySelectorAll(".modal-container").length>0)return!0;let i=t.querySelector(".menu")!==null,r=t.querySelector(".popover")!==null;return!!(i||r)}isContainerInActiveLeaf(){let t=this.container.ownerDocument,e=t.defaultView;if(e&&e!==window)return!0;let i=t.querySelector(".workspace-leaf.mod-active");return i?i.contains(this.container):!0}isWithinScrollableElement(t){let e=t;for(;e&&e!==this.container;){if(e.classList.contains("modal")||e.classList.contains("modal-container")||e.classList.contains("setting-item")||e.classList.contains("vertical-tab-content")||e.classList.contains("tategaki-control-panel")||e.classList.contains("control-panel-content"))return!0;if(e.classList.contains("view-content")||e.classList.contains("workspace-leaf-content")){e=e.parentElement;continue}let i=getComputedStyle(e),r=i.overflowY,o=i.overflowX;if((r==="auto"||r==="scroll"||o==="auto"||o==="scroll")&&e!==this.viewportEl&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth))return!0;e=e.parentElement}return!1}nextPage(){this.goToPage(this.pageIndex+1,!0)}previousPage(){this.goToPage(this.pageIndex-1,!0)}goToFirstPage(){this.goToPage(0,!0)}goToPage(t,e){let i=Math.max(0,t);this.paginationInProgress&&(this.pendingPageIndex=i);let r=Math.max(0,Math.min(i,this.pageCount-1));if(r===this.pageIndex)return;let o=r<this.pageIndex;this.pageIndex=r,this.scrollToCurrentPage(e,o),this.emitPageChange()}scrollToCurrentPage(t,e=!1){var o;if(!this.viewportEl)return;let i=(o=this.previewSettings.pageTransitionEffect)!=null?o:"fade";if(["fade","blur"].includes(i)&&this.pageElements.length>0){this.applySimpleTransition(i,()=>this.performScrollToCurrentPage());return}this.applyNonFadeTransition(i,e),this.performScrollToCurrentPage()}performScrollToCurrentPage(){if(!this.viewportEl)return;let t="auto",e=this.getPageGapPx(),i=this.pageElements[this.pageIndex];if(this.writingMode==="vertical-rl"){let s=Math.max(1,this.viewportEl.clientWidth);if(this.paginationInProgress&&i){let u=i.offsetLeft+i.offsetWidth-s;this.viewportEl.scrollTo({left:Math.max(0,u),behavior:t});return}let a=s+e,l=Math.max(0,this.viewportEl.scrollWidth-s),c=Math.max(0,l-this.pageIndex*a);this.viewportEl.scrollTo({left:c,behavior:t});return}if(this.paginationInProgress&&i){this.viewportEl.scrollTo({top:Math.max(0,i.offsetTop),behavior:t});return}let r=Math.max(1,this.viewportEl.clientHeight),o=oN(this.pageIndex,r,e);this.viewportEl.scrollTo({top:o,behavior:t})}applySimpleTransition(t,e){if(!this.pagesContainerEl||!this.container){e();return}this.transitionTimeouts.forEach(o=>clearTimeout(o)),this.transitionTimeouts=[],this.container.querySelectorAll(".page-transition-mask").forEach(o=>o.remove()),this.pagesContainerEl.classList.remove("page-transition-fade-out","page-transition-fade-in","page-transition-blur-out","page-transition-blur-in"),this.pagesContainerEl.classList.add(`page-transition-${t}-out`);let i=setTimeout(()=>{this.pagesContainerEl&&(this.pagesContainerEl.style.visibility="hidden",this.pagesContainerEl.classList.remove(`page-transition-${t}-out`),e(),requestAnimationFrame(()=>{this.pagesContainerEl&&(this.pagesContainerEl.style.visibility="",this.pagesContainerEl.classList.add(`page-transition-${t}-in`))}))},200),r=setTimeout(()=>{this.pagesContainerEl&&this.pagesContainerEl.classList.remove(`page-transition-${t}-in`)},400);this.transitionTimeouts.push(i,r)}applyNonFadeTransition(t,e=!1){if(!this.pagesContainerEl||!this.viewportEl||!this.container||t!=="slide")return;this.container.querySelectorAll(".page-transition-mask").forEach(o=>o.remove()),this.pagesContainerEl.classList.remove("page-transition-fade-out","page-transition-fade-in","page-transition-blur-out","page-transition-blur-in"),this.transitionTimeouts.forEach(o=>clearTimeout(o)),this.transitionTimeouts=[];let r=this.container.ownerDocument.createElement("div");r.className="page-transition-mask",this.container.appendChild(r),requestAnimationFrame(()=>{let o=this.writingMode==="vertical-rl"?"slide-horizontal":"slide-vertical";e&&(o+="-reverse"),r.classList.remove("slide-horizontal","slide-vertical","slide-horizontal-reverse","slide-vertical-reverse"),r.offsetWidth,r.classList.add(o);let s=()=>{r.removeEventListener("animationend",s),r.remove()};r.addEventListener("animationend",s)})}emitPageChange(){if(this.updateFixedHeaderFooterContent(),!this.onPageChange)return;let t=this.pageCount,e=this.getProgress();this.onPageChange({currentPage:t===0?0:this.pageIndex+1,totalPages:t,progress:e})}buildStyles(){var y,v,E,x,k,S,w;let t=Math.max(1,(v=(y=this.viewportEl)==null?void 0:y.clientWidth)!=null?v:Math.round(this.container.getBoundingClientRect().width)),e=Math.max(1,(x=(E=this.viewportEl)==null?void 0:E.clientHeight)!=null?x:Math.round(this.container.getBoundingClientRect().height));Ve(`[Tategaki] buildStyles: width=${t}, height=${e}, viewportEl.clientWidth=${(k=this.viewportEl)==null?void 0:k.clientWidth}, viewportEl.clientHeight=${(S=this.viewportEl)==null?void 0:S.clientHeight}`);let i=this.writingMode==="vertical-rl"?"vertical-rl":"horizontal-tb",r=this.writingMode==="vertical-rl",o=(w=this.layoutLinePitchPx)!=null?w:this.getLinePitchPx(),s=o/Math.max(1,this.settings.fontSize),a=24,l=24,c=0,d=a+c+20,h=l+c+8,p=c+8,f=d,g=h,m=p,b=p;return this.lastLayoutMetrics={width:t,height:e,paddingTop:f,paddingBottom:g,paddingLeft:m,paddingRight:b,columnGap:0,columnWidth:0,linePitch:o,snappedLineHeight:s},`
.tategaki-reading-paged-container {
	--tategaki-reading-padding-top: ${f}px;
	--tategaki-reading-padding-bottom: ${g}px;
	--tategaki-reading-padding-left: ${m}px;
	--tategaki-reading-padding-right: ${b}px;
	--tategaki-viewport-height: ${e}px;
	--tategaki-reading-page-width: ${t}px;
	--tategaki-reading-page-gap: ${this.getPageGapPx()}px;
	--tategaki-writing-mode: ${i};
}

.tategaki-reading-paged-header {
	top: ${c}px;
}

.tategaki-reading-paged-footer {
	bottom: ${c}px;
}

/* \u30D8\u30C3\u30C0\u30FC/\u30D5\u30C3\u30BF\u30FC\u80CC\u666F\u30DE\u30B9\u30AF */
.tategaki-reading-paged-mask {
	position: absolute;
	left: 0;
	right: 0;
	background: var(--tategaki-background-color, var(--background-primary));
	pointer-events: none;
	z-index: 15;
}

.tategaki-reading-paged-mask.top {
	top: 0;
	height: var(--tategaki-reading-padding-top);
}

.tategaki-reading-paged-mask.bottom {
	bottom: 0;
	height: var(--tategaki-reading-padding-bottom);
}

/* \u30D8\u30C3\u30C0\u30FC/\u30D5\u30C3\u30BF\u30FC\uFF08\u56FA\u5B9A\uFF09 */
.tategaki-reading-paged-header,
.tategaki-reading-paged-footer {
	position: absolute;
	left: 0;
	right: 0;
	height: 24px;
	display: flex;
	align-items: center;
	padding: 0 16px;
	box-sizing: border-box;
	font-size: 12px;
	color: var(--tategaki-text-color, var(--text-muted));
	background: var(--tategaki-background-color, var(--background-primary));
	opacity: 0.7;
	writing-mode: horizontal-tb !important;
	text-orientation: mixed !important;
	pointer-events: none;
	z-index: 16;
}

.tategaki-reading-paged-header.align-left,
.tategaki-reading-paged-footer.align-left {
	justify-content: flex-start;
}

.tategaki-reading-paged-header.align-center,
.tategaki-reading-paged-footer.align-center {
	justify-content: center;
}

.tategaki-reading-paged-header.align-right,
.tategaki-reading-paged-footer.align-right {
	justify-content: flex-end;
}
`}getHeaderFooterContent(t,e,i){switch(t){case"title":return this.title;case"pageNumber":return this.formatPageNumber(e,i);default:return""}}formatPageNumber(t,e){var r;return((r=this.previewSettings.pageNumberFormat)!=null?r:"currentTotal")==="current"?`${t}`:`${t} / ${e}`}ensureFixedHeaderFooterElements(){var s,a,l,c,u,d;let t=this.container.ownerDocument,e=(s=this.previewSettings.headerContent)!=null?s:"none",i=(a=this.previewSettings.footerContent)!=null?a:"pageNumber",r=(l=this.previewSettings.headerAlign)!=null?l:"center",o=(c=this.previewSettings.footerAlign)!=null?c:"center";this.headerMaskEl||(this.headerMaskEl=t.createElement("div"),this.headerMaskEl.className="tategaki-reading-paged-mask top",this.container.appendChild(this.headerMaskEl)),this.footerMaskEl||(this.footerMaskEl=t.createElement("div"),this.footerMaskEl.className="tategaki-reading-paged-mask bottom",this.container.appendChild(this.footerMaskEl)),e==="none"?((u=this.headerEl)==null||u.remove(),this.headerEl=null):this.headerEl||(this.headerEl=t.createElement("div"),this.container.appendChild(this.headerEl)),this.headerEl&&(this.headerEl.className=`tategaki-reading-paged-header align-${r}`),i==="none"?((d=this.footerEl)==null||d.remove(),this.footerEl=null):this.footerEl||(this.footerEl=t.createElement("div"),this.container.appendChild(this.footerEl)),this.footerEl&&(this.footerEl.className=`tategaki-reading-paged-footer align-${o}`)}updateFixedHeaderFooterContent(){var i,r;let t=this.pageCount,e=t===0?0:this.pageIndex+1;if(this.ensureFixedHeaderFooterElements(),this.headerEl){let o=(i=this.previewSettings.headerContent)!=null?i:"none";this.headerEl.textContent=this.getHeaderFooterContent(o,e,t)}if(this.footerEl){let o=(r=this.previewSettings.footerContent)!=null?r:"pageNumber";this.footerEl.textContent=this.getHeaderFooterContent(o,e,t)}}async render(){if(this.isRendering){this.pendingRender=!0;return}this.isRendering=!0;let t=this.getViewportSize(),e=this.renderToken+=1;try{if(this.destroyed||!this.pagesContainerEl||!this.styleEl||!this.container.isConnected)return;let i=this.buildStyles();if(this.styleEl.textContent=i,e!==this.renderToken||this.destroyed||(await new Promise(r=>requestAnimationFrame(r)),e!==this.renderToken||this.destroyed)||(await new Promise(r=>requestAnimationFrame(r)),e!==this.renderToken||this.destroyed)||(await new Promise(r=>setTimeout(r,50)),e!==this.renderToken||this.destroyed)||(await this.splitContentIntoPages(e),e!==this.renderToken||this.destroyed))return;if(this.recalculatePageCount(),this.pageIndex>=this.pageCount&&(this.pageIndex=Math.max(0,this.pageCount-1)),this.scrollToCurrentPage(!1),this.lastViewportSize=t,this.hasRenderedOnce=!0,this.emitPageChange(),this.logLayoutMetrics(),this.onRendered)try{this.onRendered({pages:this.pageElements})}catch(r){le("[Tategaki] reading mode onRendered failed",r)}}finally{this.isRendering=!1;let i=this.getViewportSize(),r=!this.lastViewportSize||this.lastViewportSize.width!==i.width||this.lastViewportSize.height!==i.height;this.pendingRender&&!this.destroyed&&r?(this.pendingRender=!1,this.pendingViewportSize=null,this.render()):(this.pendingRender=!1,this.pendingViewportSize=null)}}getViewportSize(){var i,r,o,s;let t=Math.max(1,(r=(i=this.viewportEl)==null?void 0:i.clientWidth)!=null?r:0),e=Math.max(1,(s=(o=this.viewportEl)==null?void 0:o.clientHeight)!=null?s:0);return{width:t,height:e}}async splitContentIntoPages(t){var b,y;let e=this.pagesContainerEl,i=this.viewportEl;if(!e||!i){console.error("[Tategaki] Missing container elements:",{pagesContainerEl:!!this.pagesContainerEl,viewportEl:!!this.viewportEl});return}this.activePagination&&(this.activePagination.cancel(),this.activePagination=null),this.paginationInProgress=!0,this.pageElements.forEach(v=>v.remove()),this.pageElements=[],e.textContent="",Ve("[Tategaki] Starting measured pagination..."),Ve(`[Tategaki] Content HTML length: ${((b=this.contentHtml)==null?void 0:b.length)||0}`),Ve("[Tategaki] Content HTML preview:",(y=this.contentHtml)==null?void 0:y.substring(0,100));let r=Math.max(1,i.clientWidth),o=Math.max(1,i.clientHeight);Ve(`[Tategaki] Viewport size: ${r}x${o}`);let s=24,a=24,l=0,u=s+l+20,d=a+l+8,h=l+8,p=[],f=0,g=(v=!1)=>{var k,S,w,C;if(this.destroyed||t!==this.renderToken)return;this.pageElements=p,this.pageCount=Math.max(1,p.length);let E=Math.max(0,this.pageCount-1);if(this.pendingPageIndex!==null&&this.pendingPageIndex<=E){let I=this.pendingPageIndex;if(this.pendingPageIndex=null,I!==this.pageIndex){let F=I<this.pageIndex;this.pageIndex=I,this.scrollToCurrentPage(!1,F)}}else this.pageIndex>E&&(this.pageIndex=E);let x=(C=(w=(S=(k=this.container.ownerDocument.defaultView)==null?void 0:k.performance)==null?void 0:S.now)==null?void 0:w.call(S))!=null?C:Date.now();(v||x-f>120)&&(this.emitPageChange(),f=x)},m=new ul({container:e,contentHtml:this.contentHtml,writingMode:this.writingMode==="vertical-rl"?"vertical-rl":"horizontal-tb",pageWidth:r,pageHeight:o,paddingTop:u,paddingBottom:d,paddingLeft:h,paddingRight:h,timeSliceMs:12,onPage:v=>{if(this.destroyed||t!==this.renderToken){v.element.remove();return}let E=p.length;if(v.element.setAttribute("data-page",E.toString()),p.push(v.element),this.onPageAdded)try{this.onPageAdded(v.element,E)}catch(x){le("[Tategaki] reading mode onPageAdded failed",x)}g(p.length===1)},onProgress:(v,E)=>{Ve(`[Tategaki] Pagination progress: ${v}/${E}`)}});this.activePagination=m;try{let v=await m.paginate();if(this.destroyed||t!==this.renderToken){v.forEach(E=>E.element.remove()),this.pageElements.forEach(E=>E.remove()),this.pageElements=[];return}if(!this.pagesContainerEl||!this.viewportEl){v.forEach(E=>E.element.remove()),this.pageElements.forEach(E=>E.remove()),this.pageElements=[];return}Ve(`[Tategaki] Pagination returned ${v.length} pages`),this.pageElements=p.length?p:v.map((E,x)=>(E.element.setAttribute("data-page",x.toString()),E.element)),Ve(`[Tategaki] Created ${this.pageElements.length} pages using measured pagination`),e&&Ve("[Tategaki] Pages in DOM:",e.querySelectorAll(".tategaki-page").length)}catch(v){if(this.destroyed||t!==this.renderToken||(console.error("[Tategaki] Pagination failed:",v),!e))return;let E=this.createPageElement(0),x=E.querySelector(".page-content");x&&(x.innerHTML=this.contentHtml),e.appendChild(E),this.pageElements.push(E)}finally{if(this.paginationInProgress=!1,this.pendingPageIndex!==null){let v=Math.max(0,this.pageCount-1),E=Math.max(0,Math.min(this.pendingPageIndex,v));if(this.pendingPageIndex=null,E!==this.pageIndex){let x=E<this.pageIndex;this.pageIndex=E,this.scrollToCurrentPage(!1,x),this.emitPageChange()}}else this.pageIndex>=this.pageCount&&(this.pageIndex=Math.max(0,this.pageCount-1),this.emitPageChange());this.activePagination===m&&(this.activePagination=null)}}createPageElement(t){let e=this.container.ownerDocument,i=e.createElement("div");i.className="tategaki-page",i.setAttribute("data-page",t.toString());let r=e.createElement("div");return r.className="page-content",i.appendChild(r),i}recalculatePageCount(){this.pageCount=Math.max(1,this.pageElements.length)}getPageGapPx(){return 24}getLinePitchPx(){let e=Math.max(1,this.settings.fontSize)*this.settings.lineHeight;return Math.max(1,this.snapToDevicePixel(e))}snapToDevicePixel(t){var i,r,o;let e=(o=(r=(i=this.container.ownerDocument)==null?void 0:i.defaultView)==null?void 0:r.devicePixelRatio)!=null?o:1;return Math.round(t*e)/e}snapToLineGrid(t,e){if(!Number.isFinite(t)||!Number.isFinite(e))return Math.max(1,t);let i=Math.max(1,t),r=Math.max(1,e),o=Math.max(1,Math.floor(i/r));return Math.min(i,o*r)}getRenderStridePx(){if(!this.lastLayoutMetrics)return null;let{height:t}=this.lastLayoutMetrics,e=this.getPageGapPx(),i=t+e;return!Number.isFinite(i)||i<=0?null:i}updateSnappedLineHeightFromComputed(){let t=this.measureComputedLineMetrics();if(!t)return!1;let e=this.snapToDevicePixel(t.lineHeightPx),i=e/Math.max(1,t.fontSizePx),r=parseFloat(this.container.style.getPropertyValue("--tategaki-line-height"))||this.settings.lineHeight;return this.lastLineMetrics={fontSizePx:t.fontSizePx,lineHeightPx:t.lineHeightPx,usedProbe:t.usedProbe,snappedLineHeight:i},this.layoutLinePitchPx=e,Math.abs(r-i)<.001?!1:(this.container.style.setProperty("--tategaki-line-height",i.toString()),!0)}measureComputedLineMetrics(){let t=this.pageElements[0];if(!t)return null;let e=getComputedStyle(t),i=parseFloat(e.fontSize),r=parseFloat(e.lineHeight),o=!1;if(!Number.isFinite(r)||r<=0){let s=this.measureLineHeightWithProbe(t);s>0&&(r=s,o=!0)}return!Number.isFinite(i)||i<=0||!Number.isFinite(r)||r<=0?null:{fontSizePx:i,lineHeightPx:r,usedProbe:o}}measureLineHeightWithProbe(t){let i=t.ownerDocument.createElement("div");i.style.cssText=["position:absolute","visibility:hidden","pointer-events:none","padding:0","margin:0","border:0","white-space:pre","font:inherit","line-height:inherit","writing-mode:inherit","text-orientation:inherit"].join(";"),i.textContent=`\u3042
\u3042`,t.appendChild(i);let r=i.getBoundingClientRect();i.textContent="\u3042";let o=i.getBoundingClientRect();i.remove();let s=this.writingMode==="vertical-rl",a=s?r.width:r.height,l=s?o.width:o.height,c=a-l;return Number.isFinite(c)?c:0}logLayoutMetrics(){var s,a,l,c,u,d,h;if(!this.debugLayout||!this.viewportEl||!this.lastLayoutMetrics)return;let t=this.viewportEl.clientWidth,e=this.viewportEl.clientHeight,i=this.viewportEl.scrollHeight,r=this.getPageGapPx(),o=(s=this.getRenderStridePx())!=null?s:gE(e,r);Ve("[Tategaki] paged layout metrics (page blocks)",{writingMode:this.writingMode,pageIndex:this.pageIndex,pageCount:this.pageCount,pageElementsLength:this.pageElements.length,viewportWidth:t,viewportHeight:e,viewportScrollHeight:i,pageGap:r,stride:o,computedFontSizePx:(l=(a=this.lastLineMetrics)==null?void 0:a.fontSizePx)!=null?l:null,computedLineHeightPx:(u=(c=this.lastLineMetrics)==null?void 0:c.lineHeightPx)!=null?u:null,computedLineHeightProbe:(h=(d=this.lastLineMetrics)==null?void 0:d.usedProbe)!=null?h:null,...this.lastLayoutMetrics})}};var dl=require("obsidian"),Er=class extends dl.FuzzySuggestModal{constructor(e,i,r,o){super(e);this.footerEl=null;this.files=i,this.onSelect=r,this.onCreateNew=o!=null?o:null,this.setPlaceholder("\u5207\u308A\u66FF\u3048\u308B\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E")}onOpen(){super.onOpen(),this.onCreateNew&&(this.footerEl&&(this.footerEl.remove(),this.footerEl=null),this.footerEl=this.modalEl.createDiv("tategaki-file-switch-footer"),this.footerEl.style.cssText=`
			display: flex;
			justify-content: flex-end;
			padding-top: 8px;
			border-top: 1px solid var(--background-modifier-border);
			margin-top: 8px;
		`,new dl.ButtonComponent(this.footerEl).setButtonText("\u65B0\u898F\u30CE\u30FC\u30C8\u3092\u4F5C\u6210").setClass("mod-cta").onClick(()=>{var i,r,o;let e=(r=(i=this.inputEl)==null?void 0:i.value)!=null?r:"";this.close(),(o=this.onCreateNew)==null||o.call(this,e)}))}onClose(){this.footerEl&&(this.footerEl.remove(),this.footerEl=null)}getItems(){return this.files}getItemText(e){return e.path}onChooseItem(e,i){this.onSelect(e)}};var Rn=require("obsidian"),xr=class extends Rn.Modal{constructor(e,i,r){var o,s;super(e);this.input=null;this.onSubmit=r,this.defaultFolder=(o=i.defaultFolder)!=null?o:null,this.initialValue=(s=i.initialValue)!=null?s:""}onOpen(){let{contentEl:e}=this;e.empty(),this.titleEl.setText("\u65B0\u898F\u30CE\u30FC\u30C8\u3092\u4F5C\u6210");let i=e.createDiv();if(i.style.cssText="margin-bottom: 8px; color: var(--text-muted);",i.setText("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF08.md \u306F\u7701\u7565\u53EF\uFF09"),this.defaultFolder!==null){let s=e.createDiv();s.style.cssText="margin-bottom: 12px; color: var(--text-muted); font-size: 12px;",s.setText(`\u4F5C\u6210\u5148: ${this.defaultFolder||"/"}`)}let r=e.createDiv();r.style.cssText="margin-bottom: 12px;",this.input=new Rn.TextComponent(r),this.input.inputEl.style.cssText="width: 100%; box-sizing: border-box;",this.input.setPlaceholder("\u65B0\u898F\u30CE\u30FC\u30C8\u540D"),this.initialValue&&this.input.setValue(this.initialValue);let o=e.createDiv();o.style.cssText=`
			display: flex;
			gap: 8px;
			justify-content: flex-end;
			padding-top: 8px;
			border-top: 1px solid var(--background-modifier-border);
		`,new Rn.ButtonComponent(o).setButtonText("\u30AD\u30E3\u30F3\u30BB\u30EB").onClick(()=>this.close()),new Rn.ButtonComponent(o).setButtonText("\u4F5C\u6210").setClass("mod-cta").onClick(()=>this.submit()),this.input.inputEl.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),this.submit())}),window.setTimeout(()=>{var s,a;(s=this.input)==null||s.inputEl.focus(),(a=this.input)==null||a.inputEl.select()},0)}submit(){var i,r;let e=(r=(i=this.input)==null?void 0:i.getValue().trim())!=null?r:"";if(!e){new Rn.Notice("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2e3);return}this.close(),this.onSubmit(e)}};var Xe="tategaki-tiptap-compat-view",It="tategaki-tiptap-dev-view",bE="__tategakiInitialFile",sN="__tategakiInitialViewMode",yE="\u200B\u200C\u200D";function aN(n,t){let e=Math.max(0,Math.min(t,n.length));return n.slice(0,e)+yE+n.slice(e)}function lN(n,t){var s,a,l,c;let e=t.split(`
`),i=Math.max(0,Math.min(n.line,e.length-1)),r=Math.max(0,n.ch),o=0;for(let u=0;u<i;u++)o+=((a=(s=e[u])==null?void 0:s.length)!=null?a:0)+1;return o+=Math.min(r,(c=(l=e[i])==null?void 0:l.length)!=null?c:0),Math.max(0,Math.min(o,t.length))}var hl=class hl extends ue.ItemView{constructor(e,i,r=null){super(e);this.currentFile=null;this.readingModeActive=!1;this.readingModePager=null;this.readingModeContainerEl=null;this.readingModeLayoutBackup=null;this.proseMirrorBeforeReadingStyle=null;this.editor=null;this.syncManager=null;this.markdownAdapter=null;this.isComposing=!1;this.compositionStartHandler=null;this.compositionEndHandler=null;this.editorHostEl=null;this.editorPaddingTopPx=0;this.editorPaddingBottomPx=0;this.frontmatterContainer=null;this.keyHandler=null;this.formattingToolbar=null;this.contextMenu=null;this.contextMenuHandler=null;this.searchReplacePanel=null;this.plainEditMode=null;this.editorAreaEl=null;this.boundWheelHandler=null;this.wheelThrottleTimer=null;this.cursorSyncTimer=null;this.cursorSyncDebounceTimer=null;this.pendingExternalCursor=null;this.lastExternalCursor=null;this.fileUpdateDebounceTimer=null;this.recentFilePaths=[];this.recentFilePathsInitialized=!1;this.modeBadgeEl=null;this.initialScrollApplied=!1;this.frontmatterUpdateToken=0;this.plainEditAutoPaused=!1;this.beforeInputHandler=null;this.beforeInputKeydownHandler=null;this.lastEnterKeydownAt=0;this.lastEnterKeydownShift=!1;this.updateDebounceTimer=null;this.pendingUpdate=!1;this.UPDATE_DEBOUNCE_MS=180;this.cursorSyncPausedByFocus=!1;this.cursorSyncPausedByAuxiliary=!1;this.cursorFocusInHandler=null;this.cursorFocusOutHandler=null;this.cursorPointerDownHandler=null;this.cursorGlobalPointerDownHandler=null;this.lastPointerDownInsideViewAt=0;this.lastPointerDownInsideLeafAt=0;this.lastAppliedSettings=null;this.lastSyncState=null;this.auxiliaryInputPanel=null;this.auxiliaryCaretEl=null;this.lastAuxiliaryRange=null;this.lastAuxiliaryPos=null;this.scrollHandlerForAuxiliaryCaret=null;this.outlinePanelEl=null;this.outlineUpdateTimer=null;this.pageContainerEl=null;this.borderWrapperEl=null;this.contentWrapperEl=null;this.viewRootEl=null;this.visualViewportResizeHandler=null;this.editorFocusHandler=null;this.selectionUpdateHandler=null;this.selectionUpdateTimer=null;this.lastViewportHeight=0;this.lastViewportOffsetTop=0;this.lastViewportOffsetLeft=0;this.viewportResizeTimer=null;this.isReadOnlyProtected=!1;this.readOnlyProtectionReason=null;this.unsupportedHtmlDecisions=new Map;this.unsupportedHtmlBackedUp=new Set;this.unsupportedHtmlCancelState=new Map;this.unsupportedHtmlPromptInFlight=new Map;this.suppressEditorUpdates=!1;this.listItemMoveCaptureHandler=null;this.plugin=i,this.viewTypeOverride=r}getViewType(){var e;return(e=this.viewTypeOverride)!=null?e:Xe}getDisplayText(){var r;let e=this.getDisplayFile(),i=(r=this.getFrontmatterTitle(e))!=null?r:e?e.basename:"";return i?`Tategaki: - ${i} -`:"Tategaki"}updatePaneHeaderTitle(){let e=this.getDisplayText(),i=this.containerEl.querySelector(".view-header-title");i&&(i.textContent=e)}ensureRecentFilePathsInitialized(){if(this.recentFilePathsInitialized)return;this.recentFilePathsInitialized=!0;let e=this.app.workspace.getLastOpenFiles();for(let i of e){let r=this.app.vault.getAbstractFileByPath(i);r instanceof ue.TFile&&r.extension==="md"&&this.pushRecentFilePath(r.path,!1)}}pushRecentFilePath(e,i=!0){let r=e.trim();if(!r)return;let o=this.recentFilePaths.indexOf(r);o===0&&i||(o>=0&&this.recentFilePaths.splice(o,1),i?this.recentFilePaths.unshift(r):this.recentFilePaths.push(r),this.recentFilePaths.length>20&&(this.recentFilePaths.length=20))}recordRecentFile(e){e&&e.extension==="md"&&(this.ensureRecentFilePathsInitialized(),this.pushRecentFilePath(e.path,!0))}buildFileSwitchItems(){let e=this.app.vault.getMarkdownFiles();if(e.length===0)return[];this.ensureRecentFilePathsInitialized();let i=new Map;for(let s of e)i.set(s.path,s);let r=[],o=new Set;for(let s of this.recentFilePaths){let a=i.get(s);a&&(r.push(a),o.add(s))}for(let s of e)o.has(s.path)||r.push(s);return r}openFileSwitcher(){let e=this.buildFileSwitchItems();new Er(this.app,e,r=>{this.switchToFile(r)},r=>this.openNewNoteModal(r)).open(),e.length===0&&new ue.Notice("\u5207\u308A\u66FF\u3048\u53EF\u80FD\u306A\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2e3)}openNewNoteModal(e=""){var o,s,a;let i=(a=(s=(o=this.currentFile)==null?void 0:o.parent)==null?void 0:s.path)!=null?a:"";new xr(this.app,{defaultFolder:i,initialValue:e},l=>{this.createNewNote(l,i)}).open()}async createNewNote(e,i){let r=e.trim();if(!r){new ue.Notice("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2e3);return}let o=r.replace(/^[\\/]+/,"").replace(/^\.\//,""),a=o.toLowerCase().endsWith(".md")?o:`${o}.md`,l=i?`${i}/${a}`:a,c=(0,ue.normalizePath)(l),u=this.app.vault.getAbstractFileByPath(c);if(u instanceof ue.TFile){new ue.Notice("\u65E2\u5B58\u30CE\u30FC\u30C8\u3092\u958B\u304D\u307E\u3059\u3002",2e3),await this.switchToFile(u);return}let d=c.split("/").slice(0,-1).join("/");if(d){let h=this.app.vault.getAbstractFileByPath(d);if(h){if(!(h instanceof ue.TFolder)){new ue.Notice("\u30D5\u30A9\u30EB\u30C0\u540D\u304C\u4E0D\u6B63\u3067\u3059\u3002",2500);return}}else try{await this.app.vault.createFolder(d)}catch(p){console.error("[Tategaki TipTap] Failed to create folder",p),new ue.Notice("\u30D5\u30A9\u30EB\u30C0\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500);return}}try{let h=await this.app.vault.create(c,"");await this.switchToFile(h)}catch(h){console.error("[Tategaki TipTap] Failed to create note",h),new ue.Notice("\u65B0\u898F\u30CE\u30FC\u30C8\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}async switchToFile(e){var r;if(!this.syncManager)return;if(((r=this.currentFile)==null?void 0:r.path)===e.path){new ue.Notice("\u65E2\u306B\u8868\u793A\u4E2D\u306E\u30D5\u30A1\u30A4\u30EB\u3067\u3059\u3002",1500);return}await this.checkUnsavedChanges()&&(this.initialScrollApplied=!1,await this.loadFile(e),this.currentFile=e,this.recordRecentFile(e),this.updatePaneHeaderTitle())}getDisplayFile(){var r,o;if(this.currentFile)return this.currentFile;let e=this.getCurrentFilePath();if(e){let s=this.app.vault.getAbstractFileByPath(e);if(s instanceof ue.TFile)return s}let i=(o=(r=this.app.workspace).getActiveFile)==null?void 0:o.call(r);return i!=null?i:null}getFrontmatterTitle(e){var s;if(!e)return null;let i=this.app.metadataCache.getFileCache(e),r=(s=i==null?void 0:i.frontmatter)==null?void 0:s.title;if(r==null)return null;let o=String(r).trim();return o.length>0?o:null}async onOpen(){let e=this.leaf[bE];if(!e){window.setTimeout(()=>{try{this.leaf.detach()}catch(h){}},0);return}delete this.leaf[bE],this.currentFile=e,delete this.leaf[sN];let i=this.containerEl.children[1];this.viewRootEl=i,i.empty(),i.style.cssText=`
				position: relative;
				width: 100%;
				height: 100%;
				display: flex;
				flex-direction: column;
				min-height: 0;
				overflow: hidden;
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			`;let r="(hover: none) and (pointer: coarse) and (max-width: 700px)",o=()=>{let h=this.containerEl.querySelector(".view-header"),p=h?Math.ceil(h.getBoundingClientRect().height):0;i.style.setProperty("--tategaki-view-header-height",`${p}px`);let f=window.matchMedia(r).matches;i.style.paddingTop=f?"calc(var(--tategaki-safe-area-top, 0px) + var(--tategaki-view-header-height, 0px))":"0px";let g=!1,m=i.ownerDocument.activeElement;m&&i.contains(m)&&(g=m.isContentEditable||m.tagName==="TEXTAREA"||m.tagName==="INPUT"),i.style.paddingBottom=f&&!g?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};o(),window.setTimeout(o,0),this.registerDomEvent(window,"resize",o),this.registerDomEvent(i.ownerDocument,"focusin",o),this.registerDomEvent(i.ownerDocument,"focusout",o);let s=this.containerEl.querySelector(".view-header");if(s&&"ResizeObserver"in window){let h=new ResizeObserver(()=>{o()});h.observe(s),this.register(()=>h.disconnect())}let a=i.createDiv("tategaki-tiptap-compat-toolbar-row");a.style.cssText=`
				display: flex;
				align-items: center;
				gap: 8px;
				flex: 0 0 auto;
				padding: 0;
				background: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
			`;let l=a.createDiv();l.style.cssText=`
			display: flex;
			align-items: center;
			flex: 1;
			min-width: 0;
		`;let c=a.createDiv();c.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 0 8px;
			flex-shrink: 0;
		`;let u=c.createDiv();u.textContent="\u4E92\u63DB",u.style.cssText=`
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 2px 8px;
			border-radius: 999px;
			background: var(--background-modifier-hover);
			border: 1px solid var(--background-modifier-border);
			color: var(--text-normal);
			font-size: 11px;
			white-space: nowrap;
		`,this.modeBadgeEl=u;let d=i.createDiv("tategaki-tiptap-compat-editor-area");d.style.cssText=`
				position: relative;
				flex: 1 1 auto;
				min-height: 0;
				width: 100%;
				overflow: hidden;
				display: flex;
			`,this.editorAreaEl=d,this.pageContainerEl=d.createDiv("tategaki-tiptap-page-container"),this.pageContainerEl.style.cssText=`
				flex: 1 1 auto;
				min-width: 0;
				min-height: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				box-sizing: border-box;
				overflow: visible;
				padding: 40px 32px 22px 32px;
				background: transparent;
			`,this.borderWrapperEl=this.pageContainerEl.createDiv("tategaki-tiptap-border-wrapper"),this.borderWrapperEl.style.cssText=`
				position: relative;
				width: 100%;
				height: 100%;
				min-width: 0;
				min-height: 0;
				border: none !important;
				outline: none !important;
				border-radius: 0;
				background: ${this.plugin.settings.common.backgroundColor} !important;
				box-shadow: 0 6px 12px rgba(0,0,0,0.4);
			box-sizing: border-box;
			overflow: hidden;
			transform-origin: center center;
			transform: scale(1);
		`,this.contentWrapperEl=this.borderWrapperEl.createDiv("tategaki-tiptap-content-wrapper"),this.contentWrapperEl.style.cssText=`
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: ${this.plugin.settings.common.backgroundColor};
			color: var(--text-normal);
			display: flex;
			flex-direction: column;
			overflow: hidden;
			border: none !important;
			outline: none !important;
		`,this.editorHostEl=this.contentWrapperEl.createDiv("tategaki-tiptap-compat-editor-host"),this.editorHostEl.style.cssText=`
				flex: 1 1 auto;
				min-width: 0;
				min-height: 0;
				width: 100%;
				position: relative;
				overflow: auto;
				box-sizing: border-box;
				scrollbar-gutter: stable;
			`,this.suppressEditorUpdates=!0,this.editor=Zd({element:this.editorHostEl,settings:this.plugin.settings,onUpdate:()=>{this.handleEditorContentUpdate()}}),this.setupCursorSyncFocusGuards(),this.setupCompositionGuards(),this.setupMobileKeyboardSupport(),this.formattingToolbar=new Va(l,this.editor,this.app,{app:this.app,onToggleWritingMode:()=>this.toggleWritingMode(),getWritingMode:()=>this.plugin.settings.common.writingMode,onToggleReadingMode:()=>this.toggleReadingMode(),getReadingModeEnabled:()=>this.isReadingViewOpenForCurrentFile(),onSettings:()=>this.openSettingsPanel(),onFindReplace:h=>{var p;return(p=this.searchReplacePanel)==null?void 0:p.show(h!=null?h:!0)},onManualSync:()=>{this.requestManualSync()},onToggleSyncMode:()=>{this.toggleSyncMode()},onToggleRuby:()=>{this.toggleRubyVisibility()},getRubyEnabled:()=>this.plugin.settings.wysiwyg.enableRuby!==!1,onToggleAuxiliary:()=>{this.toggleAuxiliaryPanel()},getAuxiliaryEnabled:()=>!!this.plugin.settings.wysiwyg.enableAssistantInput,onToggleOutline:()=>this.toggleOutlinePanel(),onPlainEditCommand:h=>{var p,f;return(f=(p=this.plainEditMode)==null?void 0:p.applyInlineCommand(h))!=null?f:!1},getPlainEditSelectionText:()=>{var h,p;return(p=(h=this.plainEditMode)==null?void 0:h.getSelectionText())!=null?p:""},onOpenFileSwitcher:()=>this.openFileSwitcher(),onTogglePlainEdit:()=>{this.togglePlainEditMode()},getPlainEditEnabled:()=>{var h,p;return(p=(h=this.plainEditMode)==null?void 0:h.isPlainMode())!=null?p:!1}}),this.registerEvent(this.app.workspace.on("layout-change",()=>{var h;(h=this.formattingToolbar)==null||h.updateReadingModeButton()})),this.updatePaneHeaderTitle(),this.searchReplacePanel=new Ua(d,this.editor,()=>{this.handleEditorContentUpdate()}),this.plainEditMode=new al({editor:this.editor,getRubyEnabled:()=>{var h;return((h=this.plugin.settings.wysiwyg)==null?void 0:h.enableRuby)!==!1},getViewRoot:()=>this.viewRootEl,onModeChange:()=>{var h;(h=this.formattingToolbar)==null||h.updatePlainEditButton()},onUpdate:()=>{},onCommit:()=>{this.flushPendingEditorUpdate()}}),this.contextMenu=new $a(this.editor,{app:this.app,onFindReplace:()=>{var h;(h=this.searchReplacePanel)==null||h.show(!0)},onTogglePlainEdit:()=>{this.togglePlainEditMode()},getPlainEditEnabled:()=>{var h,p;return(p=(h=this.plainEditMode)==null?void 0:h.isPlainMode())!=null?p:!1},isReadOnly:()=>this.isEditorReadOnly(),onPlainEditCommand:h=>{var p,f;return(f=(p=this.plainEditMode)==null?void 0:p.applyInlineCommand(h))!=null?f:!1},getPlainEditSelectionText:()=>{var h,p;return(p=(h=this.plainEditMode)==null?void 0:h.getSelectionText())!=null?p:""},getRubyEnabled:()=>this.plugin.settings.wysiwyg.enableRuby!==!1}),this.contextMenuHandler=h=>{var g,m,b;if(!this.contextMenu||!this.editor)return;let p=(m=(g=this.plainEditMode)==null?void 0:g.isPlainMode())!=null?m:!1,f=p&&((b=this.plainEditMode)==null?void 0:b.isOverlayTarget(h.target));!p&&!f&&this.editor.commands.focus(),this.contextMenu.show(h)},this.editorHostEl.addEventListener("contextmenu",this.contextMenuHandler),this.applySettingsToEditor(this.plugin.settings),this.suppressEditorUpdates=!1,this.setupWheelScroll(),this.setupBeforeInputFixes(),this.updateReadOnlyState(),this.markdownAdapter=lE(this.editor,{getSettings:()=>this.plugin.settings,getContextFilePath:()=>{var h,p,f,g;return(g=(f=(h=this.syncManager)==null?void 0:h.getState().currentFilePath)!=null?f:(p=this.currentFile)==null?void 0:p.path)!=null?g:null},resolveImageSrc:(h,p)=>{var y;let f=String(h||"").trim();if(!f||/^(https?:|data:|app:|obsidian:|file:)/i.test(f))return f;let m=((y=f.split("#")[0])!=null?y:f).replace(/^\.\//,"");if(!p)return f;let b=this.app.metadataCache.getFirstLinkpathDest(m,p);if(!b)return f;try{return this.app.vault.getResourcePath(b)}catch(v){return f}}}),this.syncManager=new ls({app:this.app,editor:this.markdownAdapter,getSettings:()=>this.plugin.settings,onStateChange:h=>this.handleSyncStateChange(h),onBeforeApplyMarkdown:(h,p)=>this.handleBeforeApplyMarkdown(h,p.file,p.source)}),this.registerFileWatchers(),this.registerEditorChangeWatchers(),await this.syncManager.initialize(e),this.recordRecentFile(e),this.registerEvent(this.app.workspace.on("file-open",h=>{this.recordRecentFile(h)})),this.applyCursorSyncSetting(this.plugin.settings),this.applyInitialScrollPosition(),this.updateRubyPluginState(this.plugin.settings),await this.updateFrontmatterDisplay(),this.initializeAuxiliaryInput(),this.handleSyncStateChange(this.syncManager.getState()),this.originalDetach=this.leaf.detach.bind(this.leaf),this.leaf.detach=async()=>{if(this.isReadOnlyProtected){this.originalDetach&&this.originalDetach();return}if(this.syncManager&&this.syncManager.hasUnsavedChanges()&&this.plugin.settings.wysiwyg.syncMode==="manual"){let p=await new Ui(this.app,"\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002\u30BF\u30D6\u3092\u9589\u3058\u308B\u524D\u306B\u4FDD\u5B58\u3057\u307E\u3059\u304B\uFF1F").waitForChoice();if(p==="save")await this.syncManager.triggerManualSync();else if(p==="discard")this.syncManager.clearDirtyFlag();else if(p==="cancel")return}this.originalDetach&&this.originalDetach()},this.keyHandler=h=>{var f,g,m;if(!(h.metaKey||h.ctrlKey))return;let p=h.key.toLowerCase();if(p==="s"){if(!h.shiftKey)return;h.preventDefault(),h.stopPropagation(),(f=this.syncManager)==null||f.triggerManualSync();return}if(p==="f"){h.preventDefault(),h.stopPropagation(),(g=this.searchReplacePanel)==null||g.show(!1);return}if(p==="h"){h.preventDefault(),h.stopPropagation(),(m=this.searchReplacePanel)==null||m.show(!0);return}},i.addEventListener("keydown",this.keyHandler,!0),this.setupListItemMoveCaptureHandler()}async onClose(){this.disableReadingMode(),this.teardownListItemMoveCaptureHandler();let e=this.containerEl.children[1];this.keyHandler&&(e.removeEventListener("keydown",this.keyHandler,!0),this.keyHandler=null),this.stopCursorSync(),this.teardownBeforeInputFixes(),this.teardownCompositionGuards(),this.teardownCursorSyncFocusGuards(),this.teardownMobileKeyboardSupport(),this.fileUpdateDebounceTimer!=null&&(window.clearTimeout(this.fileUpdateDebounceTimer),this.fileUpdateDebounceTimer=null),this.teardownWheelScroll(),this.formattingToolbar&&(this.formattingToolbar.destroy(),this.formattingToolbar=null),this.searchReplacePanel&&(this.searchReplacePanel.destroy(),this.searchReplacePanel=null),this.plainEditMode&&(this.plainEditMode.destroy(),this.plainEditMode=null),this.auxiliaryInputPanel&&(this.removeAuxiliaryPanelPadding(),this.auxiliaryInputPanel.destroy(),this.auxiliaryInputPanel=null),this.outlinePanelEl&&(this.outlinePanelEl.remove(),this.outlinePanelEl=null),this.updateDebounceTimer!=null&&(window.clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null,this.pendingUpdate=!1),this.outlineUpdateTimer!=null&&(window.clearTimeout(this.outlineUpdateTimer),this.outlineUpdateTimer=null),this.editorAreaEl=null,this.editorHostEl&&this.contextMenuHandler&&this.editorHostEl.removeEventListener("contextmenu",this.contextMenuHandler),this.contextMenuHandler=null,this.contextMenu&&(this.contextMenu.destroy(),this.contextMenu=null);let i=this.syncManager;if(this.syncManager=null,this.markdownAdapter=null,i){try{await i.flush()}catch(r){le("Tategaki TipTap: failed to flush on close",r)}i.dispose()}if(this.editor)try{this.editor.destroy()}finally{this.editor=null}this.clearAuxiliaryCaret(),this.detachScrollHandlerForAuxiliaryCaret(),this.frontmatterContainer&&(this.frontmatterContainer.remove(),this.frontmatterContainer=null),this.editorHostEl=null,this.viewRootEl=null,this.contentWrapperEl=null,this.borderWrapperEl=null,this.pageContainerEl=null,this.originalDetach&&(this.leaf.detach=this.originalDetach,this.originalDetach=void 0),this.currentFile=null}async updateSettings(e){var l;let i=this.lastAppliedSettings,r=i?i.preview.hideFrontmatter!==e.preview.hideFrontmatter||i.preview.showFrontmatterTitle!==e.preview.showFrontmatterTitle||i.preview.showFrontmatterSubtitle!==e.preview.showFrontmatterSubtitle||i.preview.showFrontmatterOriginalTitle!==e.preview.showFrontmatterOriginalTitle||i.preview.showFrontmatterAuthor!==e.preview.showFrontmatterAuthor||i.preview.showFrontmatterCoAuthors!==e.preview.showFrontmatterCoAuthors||i.preview.showFrontmatterTranslator!==e.preview.showFrontmatterTranslator||i.preview.showFrontmatterCoTranslators!==e.preview.showFrontmatterCoTranslators:!0,o=i?i.common.writingMode!==e.common.writingMode:!0,s=i?i.wysiwyg.enableRuby!==e.wysiwyg.enableRuby:!0,a=i?i.wysiwyg.enableAssistantInput!==e.wysiwyg.enableAssistantInput:!0;e.wysiwyg.enableAssistantInput&&(this.plainEditAutoPaused=!1,this.deactivatePlainEditMode()),this.applySettingsToEditor(e),this.setupWheelScroll(),(l=this.syncManager)==null||l.onSettingsChanged(e),this.applyCursorSyncSetting(e),this.updateReadOnlyState(),this.updateRubyPluginState(e),this.auxiliaryInputPanel&&o&&(this.auxiliaryInputPanel.updateLayout(e.common.writingMode==="vertical-rl"),this.addAuxiliaryPanelPadding()),this.formattingToolbar&&(o&&(this.formattingToolbar.updateWritingModeButton(),this.formattingToolbar.updateHorizontalRuleIcon()),a&&(this.initializeAuxiliaryInput(),this.formattingToolbar.updateAuxiliaryButton()),s&&(this.refreshRubyRendering(),this.formattingToolbar.refreshRubyToggle())),(r||o)&&await this.updateFrontmatterDisplay(),this.lastAppliedSettings=JSON.parse(JSON.stringify(e)),this.readingModeActive&&this.rebuildReadingMode()}toggleWritingMode(){let i=this.plugin.settings.common.writingMode==="vertical-rl"?"horizontal-tb":"vertical-rl";if(this.plugin.settings.common.writingMode=i,this.plugin.saveSettings(),this.applySettingsToEditor(this.plugin.settings),this.editor&&this.withSuppressedEditorUpdates(()=>{var r;(r=this.editor)==null||r.commands.setWritingMode(i)}),this.frontmatterContainer?this.applyFrontmatterWritingMode(this.frontmatterContainer,i):this.updateFrontmatterDisplay(),this.auxiliaryInputPanel&&(this.auxiliaryInputPanel.updateLayout(i==="vertical-rl"),this.addAuxiliaryPanelPadding(),this.auxiliaryInputPanel.textareaEl===document.activeElement)){let r=this.captureCurrentInsertionRange();this.renderAuxiliaryCaret(r)}this.readingModeActive&&this.rebuildReadingMode()}async togglePlainEditMode(){if(!this.plainEditMode)return;if(this.isEditorReadOnly()){new ue.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u306F\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}this.plainEditAutoPaused=!1,this.plainEditMode.isPlainMode()?this.deactivatePlainEditMode():await this.activatePlainEditMode()}async activatePlainEditMode(){var i;return!this.plainEditMode||this.isEditorReadOnly()?!1:this.plainEditMode.isPlainMode()?!0:((i=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?i:!1)&&!await this.setAuxiliaryPanelEnabled(!1)?!1:(this.plainEditMode.activate(),this.applyCursorSyncSetting(this.plugin.settings),!0)}deactivatePlainEditMode(){var e;(e=this.plainEditMode)!=null&&e.isPlainMode()&&(this.plainEditMode.deactivate(),this.editor&&this.editor.commands.focus(),window.setTimeout(()=>{this.applyCursorSyncSetting(this.plugin.settings)},50))}async setAuxiliaryPanelEnabled(e){var r;if(((r=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?r:!1)===e)return!0;try{return await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableAssistantInput:e}}),await this.updateSettings(this.plugin.settings),!0}catch(o){return console.error("[Tategaki TipTap] Failed to toggle auxiliary panel",o),new ue.Notice("\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500),!1}}handleSyncStateChange(e){var i;this.lastSyncState=e,(i=this.formattingToolbar)==null||i.updateSyncStatus(e)}openSettingsPanel(){new Dn(this.app,this.plugin,async i=>{await this.plugin.updateSettings(i)},{mode:"compat"}).open()}async toggleSyncMode(){var r,o,s,a,l;if(this.isReadOnlyProtected){new ue.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u540C\u671F\u30E2\u30FC\u30C9\u306F\u5909\u66F4\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}let i=((r=this.plugin.settings.wysiwyg.syncMode)!=null?r:"auto")==="manual"?"auto":"manual";try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,syncMode:i,autoSave:i==="auto"}}),(o=this.syncManager)==null||o.onSettingsChanged(this.plugin.settings),this.handleSyncStateChange((l=(a=(s=this.syncManager)==null?void 0:s.getState())!=null?a:this.lastSyncState)!=null?l:{mode:i,dirty:!1,saving:!1,lastSavedAt:null,currentFilePath:this.getCurrentFilePath(),lastSyncResult:null,lastSyncMessage:null}),new ue.Notice(i==="manual"?"\u624B\u52D5\u540C\u671F\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002":"\u81EA\u52D5\u540C\u671F\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002",2e3)}catch(c){console.error("[Tategaki TipTap] Failed to toggle sync mode",c),new ue.Notice("\u540C\u671F\u30E2\u30FC\u30C9\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3e3)}}async requestManualSync(){var e;if(this.isReadOnlyProtected){new ue.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u4FDD\u5B58\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}await((e=this.syncManager)==null?void 0:e.triggerManualSync())}async toggleRubyVisibility(){var r;let i=!(this.plugin.settings.wysiwyg.enableRuby!==!1);try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableRuby:i}}),await this.updateSettings(this.plugin.settings),new ue.Notice(i?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3057\u307E\u3057\u305F\u3002":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3057\u307E\u3057\u305F\u3002",1800)}catch(o){console.error("[Tategaki TipTap] Failed to toggle ruby",o),new ue.Notice("\u30EB\u30D3\u8868\u793A\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}finally{(r=this.formattingToolbar)==null||r.refreshRubyToggle()}}refreshRubyRendering(){if(this.markdownAdapter)try{let e=this.markdownAdapter.getMarkdown();this.markdownAdapter.setMarkdown(e)}catch(e){le("Tategaki TipTap: failed to refresh ruby rendering",e)}}updateRubyPluginState(e=this.plugin.settings){var l,c,u,d,h;let r=((l=e.wysiwyg)==null?void 0:l.enableRuby)!==!1&&this.isJapaneseNovelRubyActive(),s=Math.max(.2,Math.min(1,(c=e.common.rubySize)!=null?c:.5)).toString(),a=p=>{p&&(p.classList.toggle("tategaki-ruby-plugin-active",r),p.style.setProperty("--tategaki-ruby-size",s),p.style.setProperty("--ruby-size",s))};a((u=this.editorHostEl)!=null?u:null),a((h=(d=this.editor)==null?void 0:d.view.dom)!=null?h:null)}isJapaneseNovelRubyActive(){var i,r;let e=(i=this.app)==null?void 0:i.plugins;if(!e)return!1;try{if(e.enabledPlugins instanceof Set||e.enabledPlugins&&typeof e.enabledPlugins.has=="function")return e.enabledPlugins.has("japanese-novel-ruby")}catch(o){}return!!((r=e.plugins)!=null&&r["japanese-novel-ruby"])}async toggleAuxiliaryPanel(){var r;if(this.isEditorReadOnly()){new ue.Notice("\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u306F\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u306F\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}let i=!((r=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?r:!1);i&&this.deactivatePlainEditMode();try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableAssistantInput:i}}),await this.updateSettings(this.plugin.settings)}catch(o){console.error("[Tategaki TipTap] Failed to toggle auxiliary panel",o),new ue.Notice("\u88DC\u52A9\u5165\u529B\u30D1\u30CD\u30EB\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}initializeAuxiliaryInput(){if(!(!this.isEditorReadOnly()&&!!this.plugin.settings.wysiwyg.enableAssistantInput)){this.auxiliaryInputPanel&&(this.removeAuxiliaryPanelPadding(),this.auxiliaryInputPanel.destroy(),this.auxiliaryInputPanel=null),this.clearAuxiliaryCaret(),this.detachScrollHandlerForAuxiliaryCaret(),this.cursorSyncPausedByAuxiliary=!1;return}if(this.auxiliaryInputPanel){this.auxiliaryInputPanel.show(),this.addAuxiliaryPanelPadding();return}this.editorAreaEl&&(this.auxiliaryInputPanel=new ds({parent:this.editorAreaEl,isVertical:this.plugin.settings.common.writingMode==="vertical-rl",onInsert:i=>this.handleAuxiliaryInsert(i),onFocus:()=>{this.cursorSyncPausedByAuxiliary=!0,this.stopCursorSync();let i=this.captureCurrentInsertionRange();this.renderAuxiliaryCaret(i),this.attachScrollHandlerForAuxiliaryCaret()},onBlur:()=>{this.clearAuxiliaryCaret(),this.detachScrollHandlerForAuxiliaryCaret(),this.cursorSyncPausedByAuxiliary=!1,this.plugin.settings.wysiwyg.syncCursor&&!this.cursorSyncPausedByFocus&&this.startCursorSync()},onResize:()=>this.addAuxiliaryPanelPadding(),onBackspace:()=>this.handleAuxiliaryBackspace(),onBackspaceEmpty:()=>{this.toggleAuxiliaryPanel()},onNavigate:i=>this.handleAuxiliaryNavigate(i)}),this.addAuxiliaryPanelPadding())}addAuxiliaryPanelPadding(){if(!this.editorHostEl||!this.auxiliaryInputPanel)return;if(this.plugin.settings.common.writingMode==="vertical-rl"){let r=Math.max(0,this.auxiliaryInputPanel.containerEl.offsetWidth);this.editorHostEl.style.paddingLeft=`${r}px`,this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx}px`;return}let i=Math.max(0,this.auxiliaryInputPanel.containerEl.offsetHeight);this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx+i}px`,this.editorHostEl.style.paddingLeft=""}removeAuxiliaryPanelPadding(){this.editorHostEl&&(this.editorHostEl.style.paddingLeft="",this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx}px`)}isSelectionInsideEditor(e){var o,s;let i=(s=(o=this.editor)==null?void 0:o.view)==null?void 0:s.dom;if(!i||e.rangeCount===0)return!1;let r=e.getRangeAt(0).commonAncestorContainer;return r.nodeType===Node.TEXT_NODE&&(r=r.parentNode),i.contains(r)}captureCurrentInsertionRange(){let e=window.getSelection();return e&&e.rangeCount>0&&this.isSelectionInsideEditor(e)&&(this.lastAuxiliaryRange=e.getRangeAt(0).cloneRange(),this.editor&&(this.lastAuxiliaryPos=this.editor.state.selection.from)),this.lastAuxiliaryRange}updateAuxiliaryRangeFromEditor(){if(this.editor)try{let{state:e,view:i}=this.editor,{from:r}=e.selection;this.lastAuxiliaryPos=r;let o=i.domAtPos(r);if(!o||!o.node)return;let s=document.createRange();if(o.node.nodeType===Node.TEXT_NODE)s.setStart(o.node,o.offset),s.setEnd(o.node,o.offset);else{let a=o.node.childNodes[o.offset];a?(s.setStartBefore(a),s.setEndBefore(a)):(s.selectNodeContents(o.node),s.collapse(!1))}this.lastAuxiliaryRange=s}catch(e){le("Failed to update auxiliary range from editor",e)}}renderAuxiliaryCaret(e){var S,w,C;if(!this.editorHostEl){this.clearAuxiliaryCaret();return}let i=this.getAuxiliaryCaretRect(e);if(!i){this.clearAuxiliaryCaret();return}if(this.scrollAuxiliaryCaretIntoView(i)&&(i=this.getAuxiliaryCaretRect(e)),!i){this.clearAuxiliaryCaret();return}let r=this.editorHostEl.getBoundingClientRect(),o=this.editorHostEl.scrollTop,s=this.editorHostEl.scrollLeft,a=i.top-r.top,l=i.left-r.left,c=a+o,u=l+s,d=this.plugin.settings.common.writingMode==="vertical-rl",h=(S=this.auxiliaryInputPanel)==null?void 0:S.containerEl.getBoundingClientRect(),p=(w=h==null?void 0:h.height)!=null?w:0,f=(C=h==null?void 0:h.width)!=null?C:0,g=parseFloat(getComputedStyle(this.editorHostEl).fontSize)||16,m=d?g*1.4:2,b=d?3:g*1.4,y=0,v=d?f:0,E=r.height-(d?0:p),x=r.width,k=a<y||l<v||a+b>E||l+m>x;this.auxiliaryCaretEl||(this.auxiliaryCaretEl=document.createElement("div"),this.auxiliaryCaretEl.className="tategaki-auxiliary-caret",this.auxiliaryCaretEl.style.pointerEvents="none",this.auxiliaryCaretEl.style.overflow="hidden",this.editorHostEl.appendChild(this.auxiliaryCaretEl)),this.auxiliaryCaretEl.classList.remove("vertical","horizontal"),this.auxiliaryCaretEl.classList.add(d?"vertical":"horizontal"),this.auxiliaryCaretEl.style.top=`${c}px`,this.auxiliaryCaretEl.style.left=`${u}px`,this.auxiliaryCaretEl.style.display=k?"none":""}getAuxiliaryCaretRect(e){if(this.editor&&this.lastAuxiliaryPos!==null)try{let i=this.lastAuxiliaryPos,r=this.editor.state.doc.resolve(i),o=this.plugin.settings.common.writingMode==="vertical-rl",s=r.parent.content.size>0,a=r.parentOffset>=r.parent.content.size;if(o&&e){let u=this.getRangeRectWithFallback(e);if(u)return u}let l=o&&a&&s?-1:1,c=this.editor.view.coordsAtPos(i,l);return new DOMRect(c.left,c.top,c.right-c.left,c.bottom-c.top)}catch(i){}return e?this.getRangeRectWithFallback(e):null}scrollAuxiliaryCaretIntoView(e){var d,h,p;if(!this.editorHostEl)return!1;let i=this.plugin.settings.common.writingMode==="vertical-rl",r=this.getScrollableElement(i);if(!r)return this.scrollCoordsIntoView({left:e.left,right:e.right,top:e.top,bottom:e.bottom});let o=this.editorHostEl.getBoundingClientRect(),s=(d=this.auxiliaryInputPanel)==null?void 0:d.containerEl.getBoundingClientRect(),a=(h=s==null?void 0:s.height)!=null?h:0,l=(p=s==null?void 0:s.width)!=null?p:0,c=12,u=!1;if(i){let f=o.left+l+c,g=o.right-c;e.left<f?(r.scrollLeft-=f-e.left,u=!0):e.right>g&&(r.scrollLeft+=e.right-g,u=!0)}else{let f=o.top+c,g=o.bottom-a-c;e.bottom>g?(r.scrollTop+=e.bottom-g,u=!0):e.top<f&&(r.scrollTop-=f-e.top,u=!0)}return u}scrollCoordsIntoView(e,i){var u,d,h,p,f;if(!this.editor)return!1;let r=this.editor.view,o=r.dom.ownerDocument,s=(u=r.someProp("scrollThreshold"))!=null?u:0,a=(h=(d=i==null?void 0:i.margin)!=null?d:r.someProp("scrollMargin"))!=null?h:12,l=!1,c={...e};for(let g=(p=i==null?void 0:i.startNode)!=null?p:r.dom;g;){if(g.nodeType!==Node.ELEMENT_NODE){g=this.getParentNode(g);continue}let m=g,b=m===o.body,y=b?this.getWindowRect(o):this.getClientRect(m),v=0,E=0;if(c.top<y.top+this.getScrollSide(s,"top")?E=-(y.top-c.top+this.getScrollSide(a,"top")):c.bottom>y.bottom-this.getScrollSide(s,"bottom")&&(E=c.bottom-c.top>y.bottom-y.top?c.top+this.getScrollSide(a,"top")-y.top:c.bottom-y.bottom+this.getScrollSide(a,"bottom")),c.left<y.left+this.getScrollSide(s,"left")?v=-(y.left-c.left+this.getScrollSide(a,"left")):c.right>y.right-this.getScrollSide(s,"right")&&(v=c.right-y.right+this.getScrollSide(a,"right")),v||E)if(l=!0,b)(f=o.defaultView)==null||f.scrollBy(v,E);else{let k=m.scrollLeft,S=m.scrollTop;E&&(m.scrollTop+=E),v&&(m.scrollLeft+=v);let w=m.scrollLeft-k,C=m.scrollTop-S;c={left:c.left-w,right:c.right-w,top:c.top-C,bottom:c.bottom-C}}let x=b?"fixed":getComputedStyle(m).position;if(/^(fixed|sticky)$/.test(x))break;g=x==="absolute"?m.offsetParent:this.getParentNode(m)}return l}getScrollSide(e,i){var r;return typeof e=="number"?e:(r=e[i])!=null?r:0}getWindowRect(e){var r;let i=(r=e.defaultView)==null?void 0:r.visualViewport;return i?{left:i.offsetLeft,right:i.offsetLeft+i.width,top:i.offsetTop,bottom:i.offsetTop+i.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}getClientRect(e){let i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1;return{left:i.left,right:i.left+e.clientWidth*r,top:i.top,bottom:i.top+e.clientHeight*o}}getParentNode(e){var r,o;let i=(r=e.assignedSlot)!=null?r:e.parentNode;return i&&i.nodeType===Node.DOCUMENT_FRAGMENT_NODE?(o=i.host)!=null?o:null:i}clearAuxiliaryCaret(){this.auxiliaryCaretEl&&(this.auxiliaryCaretEl.remove(),this.auxiliaryCaretEl=null),this.lastAuxiliaryPos=null}attachScrollHandlerForAuxiliaryCaret(){if(this.scrollHandlerForAuxiliaryCaret)return;let e=this.editorHostEl;e&&(this.scrollHandlerForAuxiliaryCaret=()=>{this.lastAuxiliaryRange&&this.renderAuxiliaryCaret(this.lastAuxiliaryRange)},e.addEventListener("scroll",this.scrollHandlerForAuxiliaryCaret,{passive:!0}))}detachScrollHandlerForAuxiliaryCaret(){!this.scrollHandlerForAuxiliaryCaret||!this.editorHostEl||(this.editorHostEl.removeEventListener("scroll",this.scrollHandlerForAuxiliaryCaret),this.scrollHandlerForAuxiliaryCaret=null)}getRangeRectWithFallback(e){let i=e.getBoundingClientRect();if(i&&!(i.width===0&&i.height===0))return i;let r=e.getClientRects();if(r.length>0){let a=r[0];if(!(a.width===0&&a.height===0))return a}let o=e.cloneRange(),s=document.createElement("span");s.className="tategaki-auxiliary-caret-probe",s.style.display="inline-block",s.style.width="0",s.style.height="1em",s.style.pointerEvents="none",s.style.opacity="0";try{return o.insertNode(s),s.getBoundingClientRect()}catch(a){return le("Failed to measure auxiliary caret position",a),null}finally{s.remove()}}handleAuxiliaryInsert(e){if(!this.editor||this.isEditorReadOnly())return;let i=e.length>0?e:`
`;try{if(i===`
`||i==="")this.editor.commands.splitBlock()||this.editor.commands.setHardBreak();else{let r=i.replace(/\r\n?/g,`
`).split(`
`);for(let o=0;o<r.length;o++){let s=r[o];s.length>0&&this.editor.commands.insertContent(s),o<r.length-1&&(this.editor.commands.splitBlock()||this.editor.commands.setHardBreak())}}this.updateAuxiliaryRangeFromEditor()}catch(r){le("Tategaki TipTap: failed to insert auxiliary text",r)}finally{setTimeout(()=>{this.auxiliaryInputPanel&&this.lastAuxiliaryRange&&(this.auxiliaryInputPanel.textareaEl.focus(),this.renderAuxiliaryCaret(this.lastAuxiliaryRange))},10)}}handleAuxiliaryBackspace(){if(!(!this.editor||this.isEditorReadOnly()))try{let{selection:e}=this.editor.state,{from:i,empty:r,$from:o}=e;r?o.parentOffset===0?!this.editor.commands.joinBackward()&&i>0&&this.editor.chain().deleteRange({from:i-1,to:i}).run():i>0&&this.editor.chain().deleteRange({from:i-1,to:i}).run():this.editor.commands.deleteSelection(),this.updateAuxiliaryRangeFromEditor()}catch(e){le("Tategaki TipTap: failed to delete character",e)}finally{setTimeout(()=>{this.auxiliaryInputPanel&&this.lastAuxiliaryRange&&(this.auxiliaryInputPanel.textareaEl.focus(),this.renderAuxiliaryCaret(this.lastAuxiliaryRange))},10)}}handleAuxiliaryNavigate(e){if(!this.editor||!this.auxiliaryInputPanel||this.isEditorReadOnly()||!this.isArrowKey(e.key))return;let{state:i,view:r}=this.editor,o=e.key,s=i.selection.head,a=this.getNextPosForArrow(r,o,s);if(a==null)return;let l=i.doc.resolve(a),c=this.getArrowBias(o),u=e.shiftKey?j.create(i.doc,i.selection.anchor,a):ie.near(l,c);u.eq(i.selection)||(r.dispatch(i.tr.setSelection(u).scrollIntoView()),setTimeout(()=>{!this.editor||!this.auxiliaryInputPanel||(this.updateAuxiliaryRangeFromEditor(),this.lastAuxiliaryRange&&this.renderAuxiliaryCaret(this.lastAuxiliaryRange))},0))}isArrowKey(e){return e==="ArrowLeft"||e==="ArrowRight"||e==="ArrowUp"||e==="ArrowDown"}getArrowBias(e){return e==="ArrowLeft"||e==="ArrowUp"?-1:1}getNextPosForArrow(e,i,r){let o=e.state.doc.content.size,s=Math.max(0,Math.min(r,o)),a=this.getNextPosFromCoords(e,i,s);if(a==null||a===s){let l=i==="ArrowLeft"||i==="ArrowUp"?s-1:s+1;a=Math.max(0,Math.min(l,o))}return a}getNextPosFromCoords(e,i,r){var k;let o;try{o=e.coordsAtPos(r)}catch(S){return null}let s=(o.left+o.right)/2,a=(o.top+o.bottom)/2,l=window.getComputedStyle(e.dom),c=parseFloat(l.fontSize)||16,u=parseFloat(l.lineHeight),d=Number.isFinite(u)?u:c*1.6,h=this.plugin.settings.common.writingMode==="vertical-rl",p=Math.max(1,c*.8),f=Math.max(p,d),g=h?f:p,m=h?p:f,b=i==="ArrowLeft"?-g:i==="ArrowRight"?g:0,y=i==="ArrowUp"?-m:i==="ArrowDown"?m:0,v=e.state.doc.resolve(r),E=v.parent,x=v.start()-1;for(let S=1;S<=6;S++){let w=s+b*S,C=a+y*S,I=document.elementFromPoint(w,C);if(I){let N=I,H=!1;for(;N&&N!==e.dom;){if((k=N.classList)!=null&&k.contains("tategaki-aozora-ruby-rt")||N.getAttribute("data-pm-ignore")==="true"){H=!0;break}N=N.parentElement}if(H)continue}let F=e.posAtCoords({left:w,top:C});if(F&&F.pos!==r)try{let N=e.state.doc.resolve(F.pos),H=N.parent,_=N.start()-1;if(E===H&&x===_||(i==="ArrowDown"||i==="ArrowUp"))return F.pos}catch(N){continue}}return null}toggleOutlinePanel(){if(!this.editorAreaEl)return;if(this.outlinePanelEl){this.outlinePanelEl.remove(),this.outlinePanelEl=null;return}let e=this.editorAreaEl.createDiv("tategaki-tiptap-outline-panel");e.style.cssText=`
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			width: 280px;
			background: color-mix(in srgb, var(--background-primary) 80%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			border-left: 1px solid var(--background-modifier-border);
			z-index: 900;
			overflow: auto;
			padding: 8px 0;
		`,this.outlinePanelEl=e,this.renderOutline(e)}renderOutline(e){if(!this.editor)return;e.empty();let i=e.createDiv();i.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 8px 12px;
			border-bottom: 1px solid var(--background-modifier-border);
			font-weight: 600;
			position: sticky;
			top: 0;
			background: color-mix(in srgb, var(--background-primary) 90%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			z-index: 1;
		`,i.createSpan({text:"\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3"});let r=i.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":"\u9589\u3058\u308B"}});(0,ue.setIcon)(r,"x"),r.addEventListener("click",a=>{a.preventDefault(),this.toggleOutlinePanel()});let o=e.createDiv();o.style.cssText="padding: 6px 0;";let s=[];try{this.editor.state.doc.descendants((a,l)=>{var c,u,d,h;if(((c=a.type)==null?void 0:c.name)==="heading"){let p=Number((d=(u=a.attrs)==null?void 0:u.level)!=null?d:1),f=(h=a.textContent)!=null?h:"";f.trim().length>0&&s.push({level:p,text:f,pos:l})}return!0})}catch(a){le("Tategaki TipTap: failed to build outline",a)}if(s.length===0){let a=o.createDiv();a.textContent="\u898B\u51FA\u3057\u304C\u3042\u308A\u307E\u305B\u3093",a.style.cssText="padding: 8px 12px; color: var(--text-muted);";return}for(let a of s){let l=o.createDiv();l.style.cssText=`
				padding: 6px 12px;
				cursor: pointer;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				padding-left: ${12+Math.max(0,a.level-1)*12}px;
			`,l.textContent=a.text,l.addEventListener("click",c=>{var u,d;c.preventDefault();try{(u=this.editor)==null||u.commands.focus(),(d=this.editor)==null||d.commands.setTextSelection(a.pos+1),this.ensureExternalCursorVisible(a.pos+1)}catch(h){}})}}registerEditorChangeWatchers(){let e=this.app.workspace.on("active-leaf-change",()=>{this.handleWorkspaceFocusChange()});this.registerEvent(e)}async handleWorkspaceFocusChange(){await this.syncPlainEditModeWithWorkspace()}async syncPlainEditModeWithWorkspace(){var r,o,s;let e=this.app.workspace.activeLeaf,i=e==null?void 0:e.view;if(i instanceof ue.MarkdownView&&((r=i.getMode)==null?void 0:r.call(i))!=="preview"){(o=this.plainEditMode)!=null&&o.isPlainMode()&&(this.plainEditAutoPaused=!0,this.deactivatePlainEditMode());return}if(i===this){if(!this.plainEditAutoPaused)return;if((s=this.plugin.settings.wysiwyg.enableAssistantInput)!=null?s:!1){this.plainEditAutoPaused=!1;return}await this.activatePlainEditMode(),this.plainEditAutoPaused=!1}}async handleBeforeApplyMarkdown(e,i,r){let o=this.detectUnsupportedHtmlTags(e);if(o.length===0)return this.readOnlyProtectionReason==="unsupported"&&this.setReadOnlyProtection(!1),{action:"apply"};await this.ensureUnsupportedHtmlBackup(i,e);let s=o.slice().sort().join(","),a=this.unsupportedHtmlCancelState.get(i.path);if(a&&a.signature===s&&Date.now()-a.at<hl.UNSUPPORTED_HTML_CANCEL_COOLDOWN_MS)return{action:"cancel"};let l=this.unsupportedHtmlDecisions.get(i.path);if(l)return this.unsupportedHtmlCancelState.delete(i.path),this.buildUnsupportedHtmlDecision(l);let c=this.unsupportedHtmlPromptInFlight.get(i.path),u;if(c)u=await c.promise;else{let d=(async()=>await new ll(this.app,o).waitForChoice())().finally(()=>{this.unsupportedHtmlPromptInFlight.delete(i.path)});this.unsupportedHtmlPromptInFlight.set(i.path,{signature:s,promise:d}),u=await d}return u==="cancel"?(this.unsupportedHtmlCancelState.set(i.path,{at:Date.now(),signature:s}),{action:"cancel"}):(this.unsupportedHtmlCancelState.delete(i.path),this.unsupportedHtmlDecisions.set(i.path,u),this.buildUnsupportedHtmlDecision(u))}buildUnsupportedHtmlDecision(e){return e==="read-only"?(this.setReadOnlyProtection(!0,"unsupported"),new ue.Notice("\u672A\u5BFE\u5FDC\u30BF\u30B0\u304C\u3042\u308B\u305F\u3081\u8AAD\u307F\u53D6\u308A\u5C02\u7528\u3067\u958B\u304D\u307E\u3057\u305F\u3002",3500),{action:"apply"}):(this.setReadOnlyProtection(!1),{action:"apply"})}async ensureUnsupportedHtmlBackup(e,i){if(this.plugin.settings.wysiwyg.enableSyncBackup&&!this.unsupportedHtmlBackedUp.has(e.path))try{await rs(this.app,e,i,i),this.unsupportedHtmlBackedUp.add(e.path)}catch(r){le("Tategaki TipTap: failed to write unsupported tag backup",r),new ue.Notice("\u672A\u5BFE\u5FDC\u30BF\u30B0\u306E\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3500)}}detectUnsupportedHtmlTags(e){var u;let i=new Set(["span","ruby","rt","rp","mark","u","sup","sub","small","br","wbr","img"]),r=this.stripFencedCodeBlocks(e),s=this.stripInlineCode(r).replace(/<!--[\s\S]*?-->/g,""),a=/<\s*\/?\s*([a-zA-Z][\w:-]*)\b[^>]*>/g,l=new Set,c=null;for(;(c=a.exec(s))!==null;){let d=(u=c[1])==null?void 0:u.toLowerCase();d&&!i.has(d)&&l.add(d)}return Array.from(l.values()).sort()}stripFencedCodeBlocks(e){let i=e.split(`
`),r=[],o=!1,s="",a=0;for(let l of i){let c=l.trim();if(!o){let d=c.match(/^(`{3,}|~{3,})/);if(d){o=!0,s=d[1][0],a=d[1].length;continue}r.push(l);continue}let u=c.match(/^(`{3,}|~{3,})\s*$/);u&&u[1][0]===s&&u[1].length>=a&&(o=!1,s="",a=0)}return r.join(`
`)}stripInlineCode(e){let i="",r=!1,o=0;for(let s=0;s<e.length;s++){let a=e[s];if(a==="`"){let l=s;for(;e[l]==="`";)l++;let c=l-s;if(!r){r=!0,o=c,s=l-1;continue}if(c>=o){r=!1,o=0,s=l-1;continue}}r||(i+=a)}return i}applyInitialScrollPosition(){if(this.initialScrollApplied||!this.editorHostEl)return;if(!(this.plugin.settings.common.writingMode==="vertical-rl")){this.initialScrollApplied=!0;return}let i=this.getScrollableElement(!0);if(!i){this.initialScrollApplied=!0;return}requestAnimationFrame(()=>{try{let r=Math.max(0,i.scrollWidth-i.clientWidth);r>0&&i.scrollLeft<1&&(i.scrollLeft=r)}finally{this.initialScrollApplied=!0}})}setupBeforeInputFixes(){if(!this.editor||this.beforeInputHandler)return;let e=this.editor.view.dom,i=o=>{o.key==="Enter"&&(this.lastEnterKeydownAt=Date.now(),this.lastEnterKeydownShift=o.shiftKey)},r=o=>{var a,l,c;if(this.isEditorReadOnly())return;let s=o.inputType;if(s==="insertParagraph"){o.preventDefault(),this.consumeShiftEnterFlag();try{this.runInsertParagraphCommand()||(a=this.editor)==null||a.commands.setHardBreak()}catch(u){}return}if(s==="insertLineBreak"){o.preventDefault();let u=this.consumeShiftEnterFlag();try{u?(l=this.editor)==null||l.commands.setHardBreak():this.runInsertParagraphCommand()||(c=this.editor)==null||c.commands.setHardBreak()}catch(d){}}};this.beforeInputHandler=r,this.beforeInputKeydownHandler=i,e.addEventListener("beforeinput",r),e.addEventListener("keydown",i,!0)}teardownBeforeInputFixes(){if(!this.editor){this.beforeInputHandler=null,this.beforeInputKeydownHandler=null;return}if(!this.beforeInputHandler&&!this.beforeInputKeydownHandler){this.beforeInputHandler=null,this.beforeInputKeydownHandler=null;return}try{let e=this.editor.view.dom;this.beforeInputHandler&&e.removeEventListener("beforeinput",this.beforeInputHandler),this.beforeInputKeydownHandler&&e.removeEventListener("keydown",this.beforeInputKeydownHandler,!0)}finally{this.beforeInputHandler=null,this.beforeInputKeydownHandler=null}}consumeShiftEnterFlag(){let e=Date.now(),i=this.lastEnterKeydownShift&&e-this.lastEnterKeydownAt<400;return this.lastEnterKeydownShift=!1,this.lastEnterKeydownAt=0,i}runInsertParagraphCommand(){var e;return(e=this.editor)!=null&&e.isEditable?this.editor.isActive("listItem")?this.editor.commands.splitListItem("listItem"):this.editor.commands.splitBlock():!1}setupCompositionGuards(){if(!this.editor||this.compositionStartHandler||this.compositionEndHandler)return;let e=this.editor.view.dom;this.compositionStartHandler=()=>{this.isComposing=!0,this.ensureCaretVisible(200)},this.compositionEndHandler=()=>{let i=this.isComposing;this.isComposing=!1,i&&this.flushPendingEditorUpdate()},e.addEventListener("compositionstart",this.compositionStartHandler,!0),e.addEventListener("compositionend",this.compositionEndHandler,!0)}teardownCompositionGuards(){if(!this.editor){this.compositionStartHandler=null,this.compositionEndHandler=null,this.isComposing=!1;return}let e=this.editor.view.dom;this.compositionStartHandler&&e.removeEventListener("compositionstart",this.compositionStartHandler,!0),this.compositionEndHandler&&e.removeEventListener("compositionend",this.compositionEndHandler,!0),this.compositionStartHandler=null,this.compositionEndHandler=null,this.isComposing=!1}ensureCaretVisible(e=300){this.editor&&window.setTimeout(()=>{var a;if(!this.editor)return;let{state:i,view:r}=this.editor,{selection:o}=i,{from:s}=o;try{let l=r.coordsAtPos(s);if(!l)return;let c=r.domAtPos(s),u=(a=c==null?void 0:c.node)!=null?a:r.dom;this.scrollCoordsIntoView({left:l.left,right:l.right,top:l.top,bottom:l.bottom},{startNode:u,margin:80})||r.dispatch(i.tr.scrollIntoView())}catch(l){le("[Tategaki TipTap] Failed to ensure caret visible:",l)}},e)}setupMobileKeyboardSupport(){if(typeof window.visualViewport!="undefined"&&window.visualViewport&&(this.lastViewportHeight=window.visualViewport.height,this.lastViewportOffsetTop=window.visualViewport.offsetTop,this.lastViewportOffsetLeft=window.visualViewport.offsetLeft,this.visualViewportResizeHandler=()=>{window.visualViewport&&(this.viewportResizeTimer!=null&&window.clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=window.setTimeout(()=>{if(!window.visualViewport)return;let e=window.visualViewport.height,i=this.lastViewportHeight-e,r=Math.abs(window.visualViewport.offsetTop-this.lastViewportOffsetTop),o=Math.abs(window.visualViewport.offsetLeft-this.lastViewportOffsetLeft);(i>50||r>24||o>24)&&this.ensureCaretVisible(400),this.lastViewportHeight=e,this.lastViewportOffsetTop=window.visualViewport.offsetTop,this.lastViewportOffsetLeft=window.visualViewport.offsetLeft,this.viewportResizeTimer=null},100))},window.visualViewport.addEventListener("resize",this.visualViewportResizeHandler),window.visualViewport.addEventListener("scroll",this.visualViewportResizeHandler)),this.editor){let e=this.editor.view.dom;this.editorFocusHandler=()=>{this.ensureCaretVisible(350)},e.addEventListener("focus",this.editorFocusHandler,!0)}this.editor&&(ue.Platform.isMobile||ue.Platform.isMobileApp)&&(this.selectionUpdateHandler=()=>{!window.visualViewport||!(window.visualViewport.height<window.innerHeight-80)||(this.selectionUpdateTimer!=null&&window.clearTimeout(this.selectionUpdateTimer),this.selectionUpdateTimer=window.setTimeout(()=>{this.selectionUpdateTimer=null,this.ensureCaretVisible(80)},60))},this.editor.on("selectionUpdate",this.selectionUpdateHandler))}teardownMobileKeyboardSupport(){this.viewportResizeTimer!=null&&(window.clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=null),this.visualViewportResizeHandler&&typeof window.visualViewport!="undefined"&&window.visualViewport&&(window.visualViewport.removeEventListener("resize",this.visualViewportResizeHandler),window.visualViewport.removeEventListener("scroll",this.visualViewportResizeHandler),this.visualViewportResizeHandler=null),this.editorFocusHandler&&this.editor&&(this.editor.view.dom.removeEventListener("focus",this.editorFocusHandler,!0),this.editorFocusHandler=null),this.selectionUpdateTimer!=null&&(window.clearTimeout(this.selectionUpdateTimer),this.selectionUpdateTimer=null),this.selectionUpdateHandler&&this.editor&&(this.editor.off("selectionUpdate",this.selectionUpdateHandler),this.selectionUpdateHandler=null),this.lastViewportHeight=0,this.lastViewportOffsetTop=0,this.lastViewportOffsetLeft=0}setupListItemMoveCaptureHandler(){this.listItemMoveCaptureHandler=e=>{if(!(e.metaKey||e.ctrlKey)||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)||e.shiftKey||e.altKey||!this.editor||!this.editor.isFocused||this.isEditorReadOnly())return;let{$from:o}=this.editor.state.selection,s=!1;for(let u=o.depth;u>0;u--)if(o.node(u).type.name==="listItem"){s=!0;break}if(!s)return;let l=this.plugin.settings.common.writingMode==="vertical-rl",c=null;l?e.key==="ArrowRight"?c="up":e.key==="ArrowLeft"&&(c="down"):e.key==="ArrowUp"?c="up":e.key==="ArrowDown"&&(c="down"),c&&(e.preventDefault(),e.stopImmediatePropagation(),c==="up"?this.editor.commands.moveListItemUp():this.editor.commands.moveListItemDown())},window.addEventListener("keydown",this.listItemMoveCaptureHandler,{capture:!0})}teardownListItemMoveCaptureHandler(){this.listItemMoveCaptureHandler&&(window.removeEventListener("keydown",this.listItemMoveCaptureHandler,{capture:!0}),this.listItemMoveCaptureHandler=null)}handleEditorContentUpdate(){var e,i;this.isComposing||(e=this.editor)!=null&&e.view.composing||this.suppressEditorUpdates||(i=this.markdownAdapter)!=null&&i.isApplyingExternalUpdate()||this.syncManager&&(this.pendingUpdate=!0,this.updateDebounceTimer==null&&(this.updateDebounceTimer=window.setTimeout(()=>{var r;this.updateDebounceTimer=null,this.pendingUpdate&&(this.pendingUpdate=!1,(r=this.syncManager)==null||r.handleEditorUpdate())},this.UPDATE_DEBOUNCE_MS),this.outlinePanelEl&&this.outlineUpdateTimer==null&&(this.outlineUpdateTimer=window.setTimeout(()=>{this.outlineUpdateTimer=null,this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)},200))))}flushPendingEditorUpdate(){this.syncManager&&(this.updateDebounceTimer!=null&&(window.clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null),this.pendingUpdate=!1,this.syncManager.handleEditorUpdate())}updateReadOnlyState(){var i,r;if(!this.editor)return;let e=this.isEditorReadOnly();try{this.editor.setEditable(!e)}catch(o){}(i=this.formattingToolbar)==null||i.setReadOnly(e,{hideEditingButtons:!1}),(r=this.searchReplacePanel)==null||r.setReadOnly(e)}isEditorReadOnly(){return this.isReadOnlyProtected}toggleReadingMode(){this.readingModeActive&&this.disableReadingMode();let e=this.getDisplayFile();if(!e){new ue.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}this.plugin.modeManager.toggleReadingView(e,{targetLeaf:this.leaf,returnViewMode:"edit"}).then(i=>{var r;(r=this.formattingToolbar)==null||r.updateReadingModeButton(),new ue.Notice(i?"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u958B\u304D\u307E\u3057\u305F\u3002":"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u9589\u3058\u307E\u3057\u305F\u3002",2e3)})}isReadingViewOpenForCurrentFile(){var i,r,o;let e=(o=(r=this.getCurrentFilePath())!=null?r:(i=this.currentFile)==null?void 0:i.path)!=null?o:null;return this.plugin.modeManager.isReadingViewOpenForFile(e)}getEffectiveCommonSettings(e){return typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common}getCurrentBorderScale(e){var s;let i=this.getEffectiveCommonSettings(e),r=Number((s=i.pageScale)!=null?s:1);return r>1?1:Math.max(.7,Math.min(1,r))}enableReadingMode(){var f,g,m,b,y;if(!this.editor||!this.editorHostEl)return!1;this.disableReadingMode();let e=this.editorHostEl.querySelector(".ProseMirror");if(!e)return!1;let i=document.createElement("div");i.className="tategaki-reading-mode-container";let r=window.matchMedia("(hover: none) and (pointer: coarse) and (max-width: 700px)").matches;i.style.cssText=`
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			overflow: hidden;
			background: var(--tategaki-page-background-color, var(--background-primary));
			z-index: 10;
			padding-bottom: ${r?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};
		`,i.addEventListener("pointerdown",()=>{try{i.focus()}catch(v){}},{capture:!0});let o=this.plugin.settings,s=this.getEffectiveCommonSettings(o),l=Number((f=s.pageScale)!=null?f:1)>1;this.applyReadingModeLayout(s.backgroundColor),i.style.color=s.textColor,i.style.setProperty("--tategaki-text-color",s.textColor),i.style.setProperty("--tategaki-page-background-color",l?s.backgroundColor:s.pageBackgroundColor);let c=document.createElement("div");c.className="tategaki-reading-mode-snapshot",c.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
		`,this.frontmatterContainer&&c.appendChild(this.frontmatterContainer.cloneNode(!0));let u=e.cloneNode(!0);u.removeAttribute("contenteditable"),u.setAttribute("contenteditable","false"),u.removeAttribute("tabindex"),u.style.visibility="",u.style.color=s.textColor,c.appendChild(u);let d=c.innerHTML;this.editorHostEl.appendChild(i),this.proseMirrorBeforeReadingStyle={display:e.style.display,visibility:e.style.visibility,pointerEvents:e.style.pointerEvents},e.style.visibility="hidden",e.style.pointerEvents="none";let h=this.currentFile?this.getFrontmatterTitle(this.currentFile):null,p=(m=h!=null?h:(g=this.currentFile)==null?void 0:g.basename)!=null?m:"";try{this.readingModePager=new vr({container:i,contentHtml:d,writingMode:s.writingMode,settings:s,previewSettings:o.preview,title:p,onRepaginationRequired:()=>{new ue.Notice("\u30EC\u30A4\u30A2\u30A6\u30C8\u5909\u66F4\u3092\u691C\u51FA\u3057\u305F\u305F\u3081\u3001\u66F8\u7C4D\u30E2\u30FC\u30C9\u3092\u7D42\u4E86\u3057\u307E\u3057\u305F\u3002",2500),this.disableReadingMode()}})}catch(v){console.error("[Tategaki] Failed to start reading mode",v);try{(b=this.readingModePager)==null||b.destroy()}catch(E){}return this.readingModePager=null,i.remove(),e.style.visibility=this.proseMirrorBeforeReadingStyle.visibility,e.style.pointerEvents=this.proseMirrorBeforeReadingStyle.pointerEvents,this.proseMirrorBeforeReadingStyle=null,!1}this.readingModeContainerEl=i,this.readingModeActive=!0,(y=this.formattingToolbar)==null||y.updateReadingModeButton();try{i.focus()}catch(v){}return!0}disableReadingMode(){var e;if(!(!this.readingModeActive&&!this.readingModePager)){if(this.readingModePager){try{this.readingModePager.destroy()}catch(i){}this.readingModePager=null}if(this.readingModeContainerEl&&(this.readingModeContainerEl.remove(),this.readingModeContainerEl=null),this.editorHostEl){let i=this.editorHostEl.querySelector(".ProseMirror");i&&this.proseMirrorBeforeReadingStyle&&(i.style.display=this.proseMirrorBeforeReadingStyle.display,i.style.visibility=this.proseMirrorBeforeReadingStyle.visibility,i.style.pointerEvents=this.proseMirrorBeforeReadingStyle.pointerEvents)}this.proseMirrorBeforeReadingStyle=null,this.restoreReadingModeLayout(),this.readingModeActive=!1,(e=this.formattingToolbar)==null||e.updateReadingModeButton()}}applyReadingModeLayout(e){this.readingModeLayoutBackup||!this.pageContainerEl||!this.borderWrapperEl||!this.contentWrapperEl||(this.readingModeLayoutBackup={pageContainerPadding:this.pageContainerEl.style.padding,pageContainerAlignItems:this.pageContainerEl.style.alignItems,pageContainerJustifyContent:this.pageContainerEl.style.justifyContent,pageContainerBackground:this.pageContainerEl.style.background,borderWrapperBoxShadow:this.borderWrapperEl.style.boxShadow,borderWrapperBackground:this.borderWrapperEl.style.background,borderWrapperTransform:this.borderWrapperEl.style.transform,borderWrapperBorder:this.borderWrapperEl.style.border,borderWrapperOutline:this.borderWrapperEl.style.outline,contentWrapperBackground:this.contentWrapperEl.style.background},this.pageContainerEl.style.padding="0",this.pageContainerEl.style.alignItems="stretch",this.pageContainerEl.style.justifyContent="stretch",this.pageContainerEl.style.background="transparent",this.borderWrapperEl.style.boxShadow="none",this.borderWrapperEl.style.transform="none",this.borderWrapperEl.style.border="none",this.borderWrapperEl.style.outline="none",this.borderWrapperEl.style.background="transparent",this.contentWrapperEl.style.background=e)}restoreReadingModeLayout(){if(!this.readingModeLayoutBackup||!this.pageContainerEl||!this.borderWrapperEl||!this.contentWrapperEl){this.readingModeLayoutBackup=null;return}this.pageContainerEl.style.padding=this.readingModeLayoutBackup.pageContainerPadding,this.pageContainerEl.style.alignItems=this.readingModeLayoutBackup.pageContainerAlignItems,this.pageContainerEl.style.justifyContent=this.readingModeLayoutBackup.pageContainerJustifyContent,this.pageContainerEl.style.background=this.readingModeLayoutBackup.pageContainerBackground,this.borderWrapperEl.style.boxShadow=this.readingModeLayoutBackup.borderWrapperBoxShadow,this.borderWrapperEl.style.transform=this.readingModeLayoutBackup.borderWrapperTransform,this.borderWrapperEl.style.border=this.readingModeLayoutBackup.borderWrapperBorder,this.borderWrapperEl.style.outline=this.readingModeLayoutBackup.borderWrapperOutline,this.borderWrapperEl.style.background=this.readingModeLayoutBackup.borderWrapperBackground,this.contentWrapperEl.style.background=this.readingModeLayoutBackup.contentWrapperBackground,this.readingModeLayoutBackup=null}rebuildReadingMode(){var r,o,s;if(!this.readingModeActive)return;let e=(o=(r=this.readingModePager)==null?void 0:r.getProgress())!=null?o:0;if(this.enableReadingMode())try{(s=this.readingModePager)==null||s.jumpToProgress(e)}catch(a){}}setReadOnlyProtection(e,i){this.isReadOnlyProtected===e&&this.readOnlyProtectionReason===(e?i!=null?i:"unsupported":null)||(this.isReadOnlyProtected=e,this.readOnlyProtectionReason=e?i!=null?i:"unsupported":null,this.updateReadOnlyState())}isEditorInputFocused(){var i,r;let e=document.activeElement;return e?((i=this.auxiliaryInputPanel)==null?void 0:i.textareaEl)===e?!0:!!((r=this.editorHostEl)!=null&&r.contains(e)):!1}withSuppressedEditorUpdates(e){if(this.suppressEditorUpdates){e();return}this.suppressEditorUpdates=!0;try{e()}finally{this.suppressEditorUpdates=!1}}registerFileWatchers(){let e=this.app.vault.on("modify",i=>{i instanceof ue.TFile&&this.handleExternalFileModify(i)});this.registerEvent(e)}async handleExternalFileModify(e){var o;if(!this.syncManager)return;let i=this.syncManager.getState();if(!i.currentFilePath||e.path!==i.currentFilePath)return;let r=(o=this.plugin.settings.preview.updateInterval)!=null?o:300;if(r===0){try{await this.syncManager.handleExternalChange(e),await this.updateFrontmatterDisplay()}catch(s){console.error("Tategaki TipTap: failed to process external modification",s)}return}this.fileUpdateDebounceTimer!=null&&window.clearTimeout(this.fileUpdateDebounceTimer),this.fileUpdateDebounceTimer=window.setTimeout(async()=>{this.fileUpdateDebounceTimer=null;try{this.syncManager&&(await this.syncManager.handleExternalChange(e),await this.updateFrontmatterDisplay())}catch(s){console.error("Tategaki TipTap: failed to process external modification",s)}},r)}applyCursorSyncSetting(e){var i;if(this.stopCursorSync(),e.wysiwyg.syncCursor&&!this.cursorSyncPausedByFocus&&!this.cursorSyncPausedByAuxiliary){if((i=this.plainEditMode)!=null&&i.isPlainMode())return;this.startCursorSync()}}startCursorSync(){if(this.cursorSyncTimer!=null)return;let e=this.plugin.settings.preview.updateInterval||300;this.cursorSyncTimer=window.setInterval(()=>{this.pollExternalCursor()},e)}stopCursorSync(){var e;this.cursorSyncTimer!=null&&(window.clearInterval(this.cursorSyncTimer),this.cursorSyncTimer=null),this.cursorSyncDebounceTimer!=null&&(window.clearTimeout(this.cursorSyncDebounceTimer),this.cursorSyncDebounceTimer=null),this.pendingExternalCursor=null,this.lastExternalCursor=null;try{(e=this.editor)==null||e.commands.clearExternalCursor()}catch(i){}}pollExternalCursor(){var a;if(!this.editor||!this.syncManager||this.cursorSyncPausedByFocus||(a=this.plainEditMode)!=null&&a.isPlainMode())return;if(!this.plugin.settings.wysiwyg.syncCursor){this.stopCursorSync();return}let e=this.syncManager.getState();if(!e.currentFilePath){try{this.editor.commands.clearExternalCursor()}catch(l){}this.pendingExternalCursor=null,this.lastExternalCursor=null;return}let i=this.getMarkdownViewForFile(e.currentFilePath);if(!(i!=null&&i.file)||i.file.path!==e.currentFilePath)return;let r=i.editor.getCursor();if(!r||this.lastExternalCursor&&this.lastExternalCursor.line===r.line&&this.lastExternalCursor.ch===r.ch)return;this.lastExternalCursor={line:r.line,ch:r.ch};let o=i.editor.getValue();this.pendingExternalCursor={filePath:i.file.path,pos:{line:r.line,ch:r.ch},content:o},this.cursorSyncDebounceTimer!=null&&window.clearTimeout(this.cursorSyncDebounceTimer);let s=this.getExternalSyncInterval();s<=0?(this.cursorSyncDebounceTimer=null,this.applyExternalCursorFromPending()):this.cursorSyncDebounceTimer=window.setTimeout(()=>{this.cursorSyncDebounceTimer=null,this.applyExternalCursorFromPending()},s)}getMarkdownViewForFile(e){var o,s;let i=this.app.workspace.getActiveViewOfType(ue.MarkdownView);if(((o=i==null?void 0:i.file)==null?void 0:o.path)===e)return i;let r=this.app.workspace.getLeavesOfType("markdown");for(let a of r){let l=a.view;if(l instanceof ue.MarkdownView&&((s=l.file)==null?void 0:s.path)===e)return l}return null}getExternalSyncInterval(){var i;let e=(i=this.plugin.settings.preview.updateInterval)!=null?i:300;return Number.isFinite(e)?Math.max(0,e):300}async applyExternalCursorFromPending(){if(!this.editor||!this.editorHostEl||!this.syncManager)return;let e=this.pendingExternalCursor;if(!e)return;let i=this.syncManager.getState();if(!i.currentFilePath||i.currentFilePath!==e.filePath)return;let r=lN(e.pos,e.content),o=So(e.content),s=o.frontmatter.length;if(r<=s){try{this.editor.commands.clearExternalCursor()}catch(f){}return}let a=Math.max(0,r-s),l=aN(o.body,a),c=this.plugin.settings.wysiwyg.enableRuby!==!1,u=Mo(wo(l),{enableRuby:c}),d=document.createElement("div");d.style.display="none",document.body.appendChild(d);let h=null,p=null;try{h=Zd({element:d,settings:this.plugin.settings,content:u}),p=this.findCursorMarkerPos(h.state.doc)}catch(f){le("Tategaki TipTap: failed to parse markdown for cursor sync",f)}finally{h&&h.destroy(),document.body.removeChild(d)}if(p==null){try{this.editor.commands.clearExternalCursor()}catch(f){}return}try{this.editor.commands.setExternalCursor(p),this.ensureExternalCursorVisible(p)}catch(f){le("Tategaki TipTap: failed to apply external cursor",f)}}findCursorMarkerPos(e){let i=null;try{e.descendants((r,o)=>{if(i!=null)return!1;if(r!=null&&r.isText&&typeof r.text=="string"){let s=r.text.indexOf(yE);if(s!==-1)return i=o+s,!1}return!0})}catch(r){return null}return i}isFocusInsideView(e){var r;if(!e||!(e instanceof Node))return!1;let i=(r=this.viewRootEl)!=null?r:this.editorHostEl;return i?i.contains(e):!1}isRecentPointerDownInsideView(e){return this.lastPointerDownInsideViewAt?Date.now()-this.lastPointerDownInsideViewAt<=e:!1}getLeafRootEl(){return this.containerEl?this.containerEl.closest(".workspace-leaf"):null}isPointerInsideLeaf(e){if(!e||!(e instanceof Node))return!1;let i=this.getLeafRootEl();return i?i.contains(e):!1}isRecentPointerDownInsideLeaf(e){return this.lastPointerDownInsideLeafAt?Date.now()-this.lastPointerDownInsideLeafAt<=e:!1}setupCursorSyncFocusGuards(){var i;if(!this.editorHostEl||this.cursorFocusInHandler||this.cursorFocusOutHandler||this.cursorPointerDownHandler||this.cursorGlobalPointerDownHandler)return;let e=(i=this.viewRootEl)!=null?i:this.editorHostEl;this.cursorFocusInHandler=()=>{this.cursorSyncPausedByFocus=!0,this.stopCursorSync()},this.cursorFocusOutHandler=r=>{this.isFocusInsideView(r.relatedTarget)||this.isPointerInsideLeaf(r.relatedTarget)||!r.relatedTarget&&(this.isRecentPointerDownInsideView(200)||this.isRecentPointerDownInsideLeaf(200))||(this.captureCurrentInsertionRange(),this.cursorSyncPausedByFocus=!1,window.setTimeout(()=>{this.cursorSyncPausedByAuxiliary||this.cursorSyncPausedByFocus||this.isFocusInsideView(document.activeElement)||this.plugin.settings.wysiwyg.syncCursor&&this.startCursorSync()},0))},this.cursorPointerDownHandler=()=>{this.lastPointerDownInsideViewAt=Date.now(),this.lastPointerDownInsideLeafAt=this.lastPointerDownInsideViewAt},this.cursorGlobalPointerDownHandler=r=>{var s;let o=Date.now();if(this.isPointerInsideLeaf(r.target)){this.lastPointerDownInsideLeafAt=o,this.isFocusInsideView(r.target)&&(this.lastPointerDownInsideViewAt=o);return}this.cursorSyncPausedByFocus&&(this.lastPointerDownInsideViewAt=0,this.lastPointerDownInsideLeafAt=0,this.captureCurrentInsertionRange(),this.cursorSyncPausedByFocus=!1,this.plugin.settings.wysiwyg.syncCursor&&!this.cursorSyncPausedByAuxiliary&&!((s=this.plainEditMode)!=null&&s.isPlainMode())&&this.startCursorSync())},e.addEventListener("focusin",this.cursorFocusInHandler,!0),e.addEventListener("focusout",this.cursorFocusOutHandler,!0),e.addEventListener("pointerdown",this.cursorPointerDownHandler,!0),document.addEventListener("pointerdown",this.cursorGlobalPointerDownHandler,!0)}teardownCursorSyncFocusGuards(){var i;let e=(i=this.viewRootEl)!=null?i:this.editorHostEl;e&&this.cursorFocusInHandler&&e.removeEventListener("focusin",this.cursorFocusInHandler,!0),e&&this.cursorFocusOutHandler&&e.removeEventListener("focusout",this.cursorFocusOutHandler,!0),e&&this.cursorPointerDownHandler&&e.removeEventListener("pointerdown",this.cursorPointerDownHandler,!0),this.cursorGlobalPointerDownHandler&&document.removeEventListener("pointerdown",this.cursorGlobalPointerDownHandler,!0),this.cursorFocusInHandler=null,this.cursorFocusOutHandler=null,this.cursorPointerDownHandler=null,this.cursorGlobalPointerDownHandler=null,this.cursorSyncPausedByFocus=!1,this.cursorSyncPausedByAuxiliary=!1,this.lastPointerDownInsideViewAt=0,this.lastPointerDownInsideLeafAt=0}ensureExternalCursorVisible(e){if(this.readingModeActive||!this.editor||!this.editorHostEl)return;let i=this.getScrollableElement(!0);if(!i)return;let r=Math.max(0,this.editor.state.doc.content.size),o=Math.max(0,Math.min(e,r)),s;try{s=this.editor.view.coordsAtPos(o)}catch(u){return}let a=i.getBoundingClientRect(),l=20;if(this.plugin.settings.common.writingMode==="vertical-rl"){let u=0;s.right<a.left+l?u=a.left-s.right+l:s.left>a.right-l&&(u=a.right-s.left-l),u!==0&&(i.scrollLeft-=u);return}s.top<a.top+l?i.scrollTop-=a.top-s.top+l:s.bottom>a.bottom-l&&(i.scrollTop+=s.bottom-a.bottom+l)}applySettingsToEditor(e){var h,p,f;if(!this.editorHostEl||!this.editor||!this.editorAreaEl)return;let i=typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common;this.applyPageLayout(e);let r=this.editorAreaEl;r.style.setProperty("--tategaki-writing-mode",i.writingMode),r.style.setProperty("--tategaki-font-family",i.fontFamily),r.style.setProperty("--tategaki-font-size",`${i.fontSize}px`),r.style.setProperty("--tategaki-line-height",`${i.lineHeight}`),r.style.setProperty("--tategaki-letter-spacing",`${i.letterSpacing}em`),r.style.setProperty("--tategaki-text-color",i.textColor),r.style.setProperty("--tategaki-background-color",i.backgroundColor),r.style.setProperty("--tategaki-accent-color",i.accentColor);let o=this.resolveCaretColor(e,i);r.style.setProperty("--tategaki-caret-color",o);let s=(h=i.rubyVerticalGap)!=null?h:me.common.rubyVerticalGap,a=(p=i.rubyHorizontalGap)!=null?p:me.common.rubyHorizontalGap;r.style.setProperty("--tategaki-ruby-gap-vertical",`${s}em`),r.style.setProperty("--tategaki-ruby-gap-horizontal",`${a}em`);let c=Math.max(.2,Math.min(1,(f=i.rubySize)!=null?f:.5)).toString();r.style.setProperty("--tategaki-ruby-size",c),r.style.setProperty("--ruby-size",c);let u=i.headingFontFamily||i.fontFamily,d=i.headingTextColor||i.textColor;r.style.setProperty("--tategaki-heading-font-family",u),r.style.setProperty("--tategaki-heading-text-color",d),this.editorHostEl.setAttribute("data-writing-mode",i.writingMode),this.withSuppressedEditorUpdates(()=>{var g;(g=this.editor)==null||g.commands.setWritingMode(i.writingMode)}),this.applyScrollbarVisibility(i.writingMode),this.applyEditorPadding(e),this.auxiliaryInputPanel?this.addAuxiliaryPanelPadding():this.removeAuxiliaryPanelPadding()}resolveCaretColor(e,i){var o,s;let r=(o=e.wysiwyg.caretColorMode)!=null?o:"accent";if(r==="text")return i.textColor;if(r==="custom"){let a=(s=e.wysiwyg.caretCustomColor)==null?void 0:s.trim();if(a)return a}return i.accentColor}applyEditorPadding(e){var i,r;this.editorHostEl&&(this.editorPaddingTopPx=(i=e.wysiwyg.sotPaddingTop)!=null?i:32,this.editorPaddingBottomPx=(r=e.wysiwyg.sotPaddingBottom)!=null?r:16,this.editorHostEl.style.paddingTop=`${this.editorPaddingTopPx}px`,this.editorHostEl.style.paddingBottom=`${this.editorPaddingBottomPx}px`)}applyPageLayout(e){var f,g,m,b;let i=typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common,r=Number((f=i.pageScale)!=null?f:1),o=r>1,s=o?1:Math.max(.7,Math.min(1,r)),l=Math.max(.2,Math.min(1,(g=i.rubySize)!=null?g:.5)).toString(),c=(m=i.rubyVerticalGap)!=null?m:me.common.rubyVerticalGap,u=(b=i.rubyHorizontalGap)!=null?b:me.common.rubyHorizontalGap,d=`${c}em`,h=`${u}em`;this.borderWrapperEl&&(this.borderWrapperEl.style.transformOrigin="center center",this.borderWrapperEl.style.transform=`scale(${o?1:s})`,this.borderWrapperEl.style.boxShadow=o?"none":"0 6px 12px rgba(0,0,0,0.4)",this.borderWrapperEl.style.setProperty("background",i.backgroundColor,"important"),this.borderWrapperEl.style.setProperty("border","none","important"),this.borderWrapperEl.style.setProperty("outline","none","important")),this.pageContainerEl&&(this.pageContainerEl.style.alignItems=o?"stretch":"center",this.pageContainerEl.style.justifyContent=o?"stretch":"center",this.pageContainerEl.style.padding=o?"0":"40px 32px 22px 32px",this.pageContainerEl.style.background="transparent");let p=this.containerEl.children[1];if(p&&(p.style.background=o?i.backgroundColor:i.pageBackgroundColor),this.contentWrapperEl&&(this.contentWrapperEl.style.background=i.backgroundColor,this.contentWrapperEl.style.color=i.textColor,this.contentWrapperEl.style.letterSpacing=`${i.letterSpacing}em`,this.contentWrapperEl.style.setProperty("--tategaki-font-family",i.fontFamily),this.contentWrapperEl.style.setProperty("--tategaki-font-size",`${i.fontSize}px`),this.contentWrapperEl.style.setProperty("--tategaki-line-height",i.lineHeight.toString()),this.contentWrapperEl.style.setProperty("--tategaki-letter-spacing",`${i.letterSpacing}em`),this.contentWrapperEl.style.setProperty("--tategaki-text-color",i.textColor),this.contentWrapperEl.style.setProperty("--tategaki-background-color",i.backgroundColor),this.contentWrapperEl.style.setProperty("--tategaki-ruby-size",l),this.contentWrapperEl.style.setProperty("--ruby-size",l),this.contentWrapperEl.style.setProperty("--tategaki-ruby-gap-vertical",d),this.contentWrapperEl.style.setProperty("--tategaki-ruby-gap-horizontal",h)),this.editorHostEl){let y=this.editorHostEl.querySelector(".ProseMirror");if(y){let v=y.querySelector("style[data-tategaki-heading-style]");v&&v.remove();let E=document.createElement("style");E.setAttribute("data-tategaki-heading-style","true"),E.textContent=`
					.ProseMirror h1,
					.ProseMirror h2,
					.ProseMirror h3,
					.ProseMirror h4,
					.ProseMirror h5,
					.ProseMirror h6,
					.ProseMirror p {
						color: ${i.textColor} !important;
						line-height: ${i.lineHeight} !important;
					}
				`,y.appendChild(E)}}}applyScrollbarVisibility(e){if(!this.editorHostEl)return;let i=e==="horizontal-tb";this.editorHostEl.style.overflowX=i?"hidden":"scroll",this.editorHostEl.style.overflowY=i?"scroll":"hidden",this.editorHostEl.style.scrollbarGutter="stable"}async updateFrontmatterDisplay(){var o;let e=++this.frontmatterUpdateToken;if(this.frontmatterContainer&&(this.frontmatterContainer.remove(),this.frontmatterContainer=null),!this.editorHostEl||!this.editor)return;let i=this.getCurrentFilePath();if(!i)return;let r=this.app.vault.getAbstractFileByPath(i);if(r instanceof ue.TFile){this.currentFile=r;try{let s=await this.app.vault.read(r);if(e!==this.frontmatterUpdateToken||this.getCurrentFilePath()!==r.path)return;let a=this.plugin.settings,{frontmatter:l}=this.parseFrontmatter(s);if(l&&!a.preview.hideFrontmatter){let c=this.renderFrontmatter(l,a);if(c){this.applyFrontmatterWritingMode(c,a.common.writingMode);let u=(o=this.editor.view)==null?void 0:o.dom;u&&this.editorHostEl.contains(u)?this.editorHostEl.insertBefore(c,u):this.editorHostEl.appendChild(c),this.frontmatterContainer=c}}}catch(s){console.error("[Tategaki] Failed to update frontmatter display:",s)}typeof this.leaf.updateHeader=="function"&&this.leaf.updateHeader(),this.updatePaneHeaderTitle(),this.readingModeActive&&this.rebuildReadingMode()}}parseFrontmatter(e){let i=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=e.match(i);if(!r)return{frontmatter:null,contentWithoutFrontmatter:e};let o=r[1],s=e.slice(r[0].length),a={},l=o.split(`
`),c="",u=[],d=!1;for(let h of l){let p=h.trim();if(!p||p.startsWith("#"))continue;if(p.startsWith("- ")){d&&u.push(p.slice(2).trim());continue}d&&!p.startsWith("- ")&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u),d=!1,u=[]);let f=p.indexOf(":");if(f!==-1){let g=p.slice(0,f).trim(),m=p.slice(f+1).trim();switch(g){case"title":a.title=m,c=g;break;case"subtitle":a.subtitle=m,c=g;break;case"original_title":a.original_title=m,c=g;break;case"author":a.author=m,c=g;break;case"translator":a.translator=m,c=g;break;case"co_authors":m?a.co_authors=[m]:(d=!0,c=g,u=[]);break;case"co_translators":m?a.co_translators=[m]:(d=!0,c=g,u=[]);break}}}return d&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u)),{frontmatter:Object.keys(a).length>0?a:null,contentWithoutFrontmatter:s}}renderFrontmatter(e,i){let r=document.createElement("div");r.className="tategaki-frontmatter";let o=!1,s=r.createDiv("tategaki-frontmatter-top");if(e.title&&i.preview.showFrontmatterTitle){let l=s.createEl("h1",{cls:"tategaki-frontmatter-title"});l.textContent=e.title,o=!0}if(e.subtitle&&i.preview.showFrontmatterSubtitle){let l=s.createEl("h2",{cls:"tategaki-frontmatter-subtitle"});l.textContent=e.subtitle,o=!0}if(e.original_title&&i.preview.showFrontmatterOriginalTitle){let l=s.createEl("h2",{cls:"tategaki-frontmatter-original-title"});l.textContent=e.original_title,o=!0}let a=r.createDiv("tategaki-frontmatter-bottom");if(e.author&&i.preview.showFrontmatterAuthor){let l=a.createEl("h4",{cls:"tategaki-frontmatter-author"});l.textContent=e.author,this.applyFrontmatterInlineEndAlignment(l),o=!0}if(e.co_authors&&i.preview.showFrontmatterCoAuthors)for(let l of e.co_authors){let c=a.createEl("h4",{cls:"tategaki-frontmatter-co-author"});c.textContent=l,this.applyFrontmatterInlineEndAlignment(c),o=!0}if(e.translator&&i.preview.showFrontmatterTranslator){let l=a.createEl("h5",{cls:"tategaki-frontmatter-translator"});l.textContent=e.translator,this.applyFrontmatterInlineEndAlignment(l),o=!0}if(e.co_translators&&i.preview.showFrontmatterCoTranslators)for(let l of e.co_translators){let c=a.createEl("h5",{cls:"tategaki-frontmatter-co-translator"});c.textContent=l,this.applyFrontmatterInlineEndAlignment(c),o=!0}return o?r:null}applyFrontmatterInlineEndAlignment(e){e.style.display="block",e.style.setProperty("text-align","end","important"),e.style.setProperty("text-align-last","end","important"),e.style.marginInlineStart="auto",e.style.marginInlineEnd="0",e.style.marginLeft="auto",e.style.marginRight="0",e.style.justifySelf="end"}applyFrontmatterWritingMode(e,i){e.style.writingMode=i,e.style.textOrientation="mixed"}setupWheelScroll(){if(!this.editorHostEl)return;this.boundWheelHandler&&(this.editorHostEl.removeEventListener("wheel",this.boundWheelHandler),this.boundWheelHandler=null);let e=i=>this.handleWheel(i);this.boundWheelHandler=e,this.editorHostEl.addEventListener("wheel",e,{passive:!1})}teardownWheelScroll(){!this.editorHostEl||!this.boundWheelHandler||(this.editorHostEl.removeEventListener("wheel",this.boundWheelHandler),this.boundWheelHandler=null,this.wheelThrottleTimer=null)}handleWheel(e){if(this.readingModeActive||!this.editorHostEl)return;let i=this.plugin.settings.common.writingMode==="horizontal-tb",{deltaX:r,deltaY:o,shiftKey:s}=e,a=this.getScrollableElement(!0);if(a){if(i){if(!s)return;e.preventDefault(),this.throttledWheelScroll(()=>{a.scrollLeft-=o});return}s||(e.preventDefault(),this.throttledWheelScroll(()=>{let l=-o*.8+r;a.scrollLeft+=l}))}}throttledWheelScroll(e){this.wheelThrottleTimer===null&&(e(),this.wheelThrottleTimer=window.setTimeout(()=>{this.wheelThrottleTimer=null},16))}getScrollableElement(e){var r,o;let i=[this.editorHostEl,(o=(r=this.editor)==null?void 0:r.view.dom)!=null?o:null];for(let s of i)if(s){if(e){if(s.scrollWidth-s.clientWidth>1)return s}else if(s.scrollHeight-s.clientHeight>1)return s}return this.editorHostEl}async loadFile(e){var i,r;await((i=this.syncManager)==null?void 0:i.loadFile(e)),await this.updateFrontmatterDisplay(),(r=this.formattingToolbar)==null||r.updateReadingModeButton(),this.readingModeActive&&this.rebuildReadingMode()}getCurrentFilePath(){var e,i,r;return(r=(i=(e=this.syncManager)==null?void 0:e.getState())==null?void 0:i.currentFilePath)!=null?r:null}async checkUnsavedChanges(){var r;if(!((r=this.syncManager)!=null&&r.hasUnsavedChanges()))return!0;let e=new Ui(this.app);switch(e.open(),await e.waitForChoice()){case"save":return await this.syncManager.triggerManualSync(),this.syncManager.clearDirtyFlag(),!0;case"discard":return this.syncManager.clearDirtyFlag(),!0;default:return!1}}async requestSave(){if(this.isReadOnlyProtected||!this.syncManager||!this.syncManager.hasUnsavedChanges()||this.plugin.settings.wysiwyg.syncMode!=="manual")return;let i=await new Ui(this.app,"\u672A\u4FDD\u5B58\u306E\u5909\u66F4\u304C\u3042\u308A\u307E\u3059\u3002\u30BF\u30D6\u3092\u9589\u3058\u308B\u524D\u306B\u4FDD\u5B58\u3057\u307E\u3059\u304B\uFF1F").waitForChoice();if(i==="save")await this.syncManager.triggerManualSync();else if(i==="discard")this.syncManager.clearDirtyFlag();else if(i==="cancel")throw new Error("User cancelled")}async handleAppQuit(e){if(this.syncManager&&!this.isReadOnlyProtected){if(e==="save"){this.flushPendingEditorUpdate(),await this.syncManager.flush();return}this.updateDebounceTimer!=null&&(window.clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null,this.pendingUpdate=!1),this.syncManager.clearDirtyFlag()}}getState(){return{}}};hl.UNSUPPORTED_HTML_CANCEL_COOLDOWN_MS=1200;var Co=hl;var Oe=require("obsidian");var Nt="tategaki-reading-view",pl=class extends Oe.ItemView{constructor(e,i){super(e);this.rootEl=null;this.hostEl=null;this.toolbarLeftEl=null;this.toolbarRightEl=null;this.modeBadgeEl=null;this.writingModeButton=null;this.readingModeButton=null;this.outlineButton=null;this.rubyToggleButton=null;this.searchButton=null;this.pinButton=null;this.outlinePanelEl=null;this.outlineItems=[];this.pager=null;this.filePath=null;this.returnViewMode="sot";this.pendingState=null;this.isReady=!1;this.renderToken=0;this.renderTimer=null;this.plugin=i}getViewType(){return Nt}getDisplayText(){let e=this.getDisplayFile(),i=this.getFrontmatterTitle(e);return i?`Tategaki \u66F8\u7C4D: - ${i} -`:"Tategaki \u66F8\u7C4D"}getState(){var e;return{filePath:(e=this.filePath)!=null?e:void 0,returnViewMode:this.returnViewMode}}async setState(e,i){if(e!=null&&e.filePath?this.filePath=e.filePath:this.filePath=null,e!=null&&e.returnViewMode&&(this.returnViewMode=e.returnViewMode==="preview"?"edit":e.returnViewMode,this.updateReturnButton()),!this.isReady){this.pendingState=e;return}this.scheduleRender()}async onOpen(){var u,d;let e=this.containerEl.children[1];e.empty(),e.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			min-height: 0;
			overflow: hidden;
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		`;let i="(hover: none) and (pointer: coarse) and (max-width: 700px)",r=()=>{let h=this.containerEl.querySelector(".view-header"),p=h?Math.ceil(h.getBoundingClientRect().height):0;e.style.setProperty("--tategaki-view-header-height",`${p}px`);let f=window.matchMedia(i).matches;e.style.paddingTop=f?"calc(var(--tategaki-safe-area-top, 0px) + var(--tategaki-view-header-height, 0px))":"0px",e.style.paddingBottom=f?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};r(),window.setTimeout(r,0),this.registerDomEvent(window,"resize",r);let o=this.containerEl.querySelector(".view-header");if(o&&"ResizeObserver"in window){let h=new ResizeObserver(()=>{r()});h.observe(o),this.register(()=>h.disconnect())}let s=e.createDiv("tategaki-reading-toolbar-row");s.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			flex: 0 0 auto;
			padding: 0;
			background: var(--background-secondary);
			border-bottom: 1px solid var(--background-modifier-border);
		`;let a=s.createDiv();a.style.cssText=`
			display: flex;
			align-items: center;
			flex: 1;
			min-width: 0;
		`,this.toolbarLeftEl=a;let l=s.createDiv();l.style.cssText=`
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 0 8px;
			flex-shrink: 0;
		`,this.toolbarRightEl=l,this.buildToolbar(a,l);let c=e.createDiv("tategaki-reading-view-area");if(c.style.cssText=`
			position: relative;
			flex: 1 1 auto;
			min-height: 0;
			width: 100%;
			overflow: hidden;
			display: flex;
		`,this.rootEl=c.createDiv("tategaki-reading-view-root"),this.rootEl.style.cssText=`
			position: relative;
			flex: 1 1 auto;
			min-width: 0;
			min-height: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
			box-sizing: border-box;
			background: var(--tategaki-page-background-color, var(--background-primary));
		`,this.hostEl=this.rootEl.createDiv("tategaki-reading-view-host"),this.hostEl.style.cssText=`
			position: relative;
			width: 100%;
			height: 100%;
			overflow: hidden;
		`,this.isReady=!0,(u=this.pendingState)!=null&&u.filePath&&(this.filePath=this.pendingState.filePath),(d=this.pendingState)!=null&&d.returnViewMode&&(this.returnViewMode=this.pendingState.returnViewMode==="preview"?"edit":this.pendingState.returnViewMode),this.pendingState=null,this.updateReturnButton(),!this.filePath){window.setTimeout(()=>{if(!this.filePath){try{this.leaf.detach()}catch(h){}return}this.registerFileWatchers(),this.scheduleRender()},0);return}this.registerFileWatchers(),this.scheduleRender()}async onClose(){this.clearRenderTimer(),this.destroyPager(),this.outlinePanelEl&&(this.outlinePanelEl.remove(),this.outlinePanelEl=null),this.rootEl=null,this.hostEl=null,this.toolbarLeftEl=null,this.toolbarRightEl=null,this.modeBadgeEl=null,this.writingModeButton=null,this.readingModeButton=null,this.outlineButton=null,this.rubyToggleButton=null,this.searchButton=null,this.pinButton=null,this.outlineItems=[],this.isReady=!1,this.pendingState=null,this.returnViewMode="sot"}updateSettings(e){return this.plugin.settings=e,this.updateWritingModeButton(),this.scheduleRender(),Promise.resolve()}getCurrentFilePath(){return this.filePath}getReturnViewMode(){return this.returnViewMode}buildToolbar(e,i){e.empty(),i.empty(),this.applyToolbarLayout(e),this.writingModeButton=this.createToolbarButton(e,"arrow-down-up","\u66F8\u5B57\u65B9\u5411\u5207\u308A\u66FF\u3048",()=>{this.toggleWritingMode()}),this.updateWritingModeButton(),this.createSeparator(e),this.outlineButton=this.createToolbarButton(e,"list-tree","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",()=>this.toggleOutlinePanel()),this.createSeparator(e),this.readingModeButton=this.createToolbarButton(e,"corner-left-up","\u623B\u308B",()=>this.exitReadingView()),this.setButtonActive(this.readingModeButton,!0),this.updateReturnButton();let r=i.createDiv();r.textContent="\u66F8\u7C4D",r.style.cssText=`
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 2px 8px;
			border-radius: 999px;
			background: var(--background-modifier-hover);
			border: 1px solid var(--background-modifier-border);
			color: var(--text-normal);
			font-size: 11px;
			white-space: nowrap;
		`,this.modeBadgeEl=r}applyToolbarLayout(e){if(e.addClass("contenteditable-toolbar"),Oe.Platform.isMobile||Oe.Platform.isMobileApp){e.addClass("tiptap-toolbar-mobile"),e.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				flex-wrap: nowrap;
				flex: 1 1 auto;
				min-width: 0;
				width: 100%;
				max-width: 100%;
				overflow-x: auto;
				overflow-y: hidden;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				touch-action: pan-x;
				overscroll-behavior-x: contain;
			`;let r=e.ownerDocument;if(!r.getElementById("tategaki-reading-toolbar-mobile-scrollbar-style")){let o=r.createElement("style");o.id="tategaki-reading-toolbar-mobile-scrollbar-style",o.textContent=`
					.tiptap-toolbar-mobile::-webkit-scrollbar {
						display: none;
					}
					.tiptap-toolbar-mobile .contenteditable-toolbar-button,
					.tiptap-toolbar-mobile .contenteditable-toolbar-separator {
						flex: 0 0 auto;
					}
				`,r.head.appendChild(o)}}else e.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				flex-wrap: wrap;
				flex: 1 1 auto;
				min-width: 0;
			`}createToolbarButton(e,i,r,o){let s=e.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":r}});return(0,Oe.setIcon)(s,i),s.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),o()}),s}createDisabledToolbarButton(e,i,r){let o=e.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":r,"aria-disabled":"true"}});return(0,Oe.setIcon)(o,i),o.disabled=!0,o.style.opacity="0.35",o}createSeparator(e){let i=e.createDiv("contenteditable-toolbar-separator");i.style.cssText=`
			width: 1px;
			height: 24px;
			background-color: var(--background-modifier-border);
			margin: 0 4px;
		`}setButtonActive(e,i){e&&(i?(e.addClass("is-active"),e.style.backgroundColor="var(--interactive-accent)",e.style.color="var(--text-on-accent)"):(e.removeClass("is-active"),e.style.backgroundColor="",e.style.color=""))}updateWritingModeButton(){if(!this.writingModeButton)return;let i=this.getEffectiveCommonSettings().writingMode==="vertical-rl";this.writingModeButton.empty();let r=this.writingModeButton.createSpan();(0,Oe.setIcon)(r,i?"arrow-down-up":"arrow-left-right"),this.writingModeButton.setAttribute("aria-label",i?"\u6A2A\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048":"\u7E26\u66F8\u304D\u306B\u5207\u308A\u66FF\u3048")}updateReturnButton(){if(!this.readingModeButton)return;let e=this.getReturnViewLabel();this.readingModeButton.empty();let i=this.readingModeButton.createSpan();(0,Oe.setIcon)(i,"corner-left-up"),this.readingModeButton.setAttribute("aria-label",`${e}\u3078\u623B\u308B`)}async toggleWritingMode(){let i=this.plugin.settings.common.writingMode==="vertical-rl"?"horizontal-tb":"vertical-rl";try{await this.plugin.updateSettings({common:{...this.plugin.settings.common,writingMode:i}})}catch(r){console.error("[Tategaki] Failed to toggle writing mode",r),new Oe.Notice("\u66F8\u5B57\u65B9\u5411\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}openSettingsPanel(){let e=this.getReturnViewLabel();new Oe.Notice(`\u8868\u793A\u8A2D\u5B9A\u3092\u958B\u304F\u305F\u3081\u3001${e}\u3078\u5207\u308A\u66FF\u3048\u307E\u3059\u3002`,2e3),this.returnToOriginView().finally(()=>{let i=this.returnViewMode==="edit"?"compat":"sot";new Dn(this.app,this.plugin,async o=>{await this.plugin.updateSettings(o)},{mode:i}).open()})}exitReadingView(){this.returnToOriginView()}getReturnViewLabel(){switch(this.returnViewMode){case"sot":return"SoT\u7DE8\u96C6\u30D3\u30E5\u30FC";case"edit":return"\u4E92\u63DB\u30E2\u30FC\u30C9";default:return"\u4E92\u63DB\u30E2\u30FC\u30C9"}}async returnToOriginView(){let e=this.getDisplayFile();if(!e){new Oe.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}if(this.returnViewMode==="sot"){await this.plugin.modeManager.openSoTWysiwygViewInLeaf(e,this.leaf);return}await this.plugin.modeManager.openTipTapViewInLeaf(e,this.leaf,this.returnViewMode)}toggleOutlinePanel(){if(!this.rootEl)return;if(this.outlinePanelEl){this.outlinePanelEl.remove(),this.outlinePanelEl=null;return}let e=this.rootEl.createDiv("tategaki-reading-outline-panel");e.style.cssText=`
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			width: 280px;
			background: color-mix(in srgb, var(--background-primary) 80%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			border-left: 1px solid var(--background-modifier-border);
			z-index: 900;
			overflow: auto;
			padding: 8px 0;
		`,this.outlinePanelEl=e,this.renderOutline(e)}renderOutline(e){e.empty();let i=e.createDiv();i.style.cssText=`
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 8px 12px;
			border-bottom: 1px solid var(--background-modifier-border);
			font-weight: 600;
			position: sticky;
			top: 0;
			background: color-mix(in srgb, var(--background-primary) 90%, transparent);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			z-index: 1;
		`,i.createSpan({text:"\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3"});let r=i.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":"\u9589\u3058\u308B"}});(0,Oe.setIcon)(r,"x"),r.addEventListener("click",s=>{s.preventDefault(),this.toggleOutlinePanel()});let o=e.createDiv();if(o.style.cssText="padding: 6px 0;",this.outlineItems.length===0){let s=o.createDiv();s.textContent="\u898B\u51FA\u3057\u304C\u3042\u308A\u307E\u305B\u3093",s.style.cssText="padding: 8px 12px; color: var(--text-muted);";return}for(let s of this.outlineItems){let a=o.createDiv();a.style.cssText=`
				padding: 6px 12px;
				cursor: pointer;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				padding-left: ${12+Math.max(0,s.level-1)*12}px;
			`,a.textContent=s.text,a.addEventListener("click",l=>{var c;l.preventDefault(),(c=this.pager)==null||c.scrollToPage(s.pageIndex,!0)})}}appendOutlineItemsFromPage(e,i){var s,a;let r=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")),o=!1;for(let l of r){let c=(a=(s=l.textContent)==null?void 0:s.trim())!=null?a:"";if(!c)continue;let u=Number(l.tagName.replace("H",""))||1;this.outlineItems.push({level:u,text:c,pageIndex:i}),o=!0}o&&this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)}updateOutlineItems(e){let i=[];e.forEach((r,o)=>{var a,l;let s=Array.from(r.querySelectorAll("h1, h2, h3, h4, h5, h6"));for(let c of s){let u=(l=(a=c.textContent)==null?void 0:a.trim())!=null?l:"";if(!u)continue;let d=Number(c.tagName.replace("H",""))||1;i.push({level:d,text:u,pageIndex:o})}}),this.outlineItems=i,this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)}registerFileWatchers(){this.registerEvent(this.app.vault.on("modify",e=>{e instanceof Oe.TFile&&e.path===this.filePath&&this.scheduleRender()})),this.registerEvent(this.app.vault.on("rename",(e,i)=>{e instanceof Oe.TFile&&this.filePath&&i===this.filePath&&(this.filePath=e.path,this.leaf.setViewState({type:Nt,state:{filePath:e.path},active:!1}),this.scheduleRender())})),this.registerEvent(this.app.vault.on("delete",e=>{if(e instanceof Oe.TFile&&this.filePath&&e.path===this.filePath){this.filePath=null;try{this.leaf.detach()}catch(i){}}}))}scheduleRender(){this.isReady&&(this.clearRenderTimer(),this.renderTimer=window.setTimeout(()=>{this.renderTimer=null,this.render()},80))}clearRenderTimer(){this.renderTimer!==null&&(window.clearTimeout(this.renderTimer),this.renderTimer=null)}async render(){let e=++this.renderToken;if(!this.hostEl||!this.filePath)return;let i=this.app.vault.getAbstractFileByPath(this.filePath);if(!(i instanceof Oe.TFile)){this.destroyPager(),this.hostEl.empty();return}let r="";try{r=await this.app.vault.read(i)}catch(u){console.error("[Tategaki] Failed to read reading view file",u);return}if(e!==this.renderToken)return;let o=this.plugin.settings,s=this.getEffectiveCommonSettings(),a=this.buildSnapshotHtml(r,i.path,o,s);this.destroyPager(),this.hostEl.empty(),this.outlineItems=[],this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl);let l=this.getFrontmatterTitle(i),c=l!=null?l:i.basename;try{this.pager=new vr({container:this.hostEl,contentHtml:a,writingMode:s.writingMode,settings:s,previewSettings:o.preview,title:c,onPageAdded:(u,d)=>{this.appendOutlineItemsFromPage(u,d)},onRepaginationRequired:()=>{let u=this.getReturnViewLabel();new Oe.Notice(`\u30EC\u30A4\u30A2\u30A6\u30C8\u5909\u66F4\u3092\u691C\u51FA\u3057\u305F\u305F\u3081\u3001${u}\u3078\u5207\u308A\u66FF\u3048\u307E\u3057\u305F\u3002`,2500),this.exitReadingView()},onRendered:({pages:u})=>{this.updateOutlineItems(u)}})}catch(u){console.error("[Tategaki] Failed to start reading view",u),this.pager=null}}destroyPager(){if(this.pager){try{this.pager.destroy()}catch(e){}this.pager=null,this.outlineItems=[],this.outlinePanelEl&&this.renderOutline(this.outlinePanelEl)}}buildSnapshotHtml(e,i,r,o){var f,g;let s=So(e),a=r.wysiwyg.enableRuby!==!1,l=wo(s.body),c=Mo(l,{enableRuby:a,contextFilePath:i,resolveImageSrc:(m,b)=>this.resolveImageSrc(m,b)}),u=(g=(f=this.hostEl)==null?void 0:f.ownerDocument)!=null?g:document,d=u.createElement("div");d.className="tategaki-reading-view-snapshot";let{frontmatter:h}=this.parseFrontmatter(e);if(h&&!r.preview.hideFrontmatter){let m=this.renderFrontmatter(h,r);m&&(this.applyFrontmatterWritingMode(m,o.writingMode),d.appendChild(m))}let p=u.createElement("div");return p.className="tiptap ProseMirror",p.setAttribute("contenteditable","false"),p.innerHTML=c,d.appendChild(p),d.innerHTML}resolveImageSrc(e,i){var l;let r=String(e||"").trim();if(!r||/^(https?:|data:|app:|obsidian:|file:)/i.test(r))return r;let s=((l=r.split("#")[0])!=null?l:r).replace(/^\.\//,"");if(!i)return r;let a=this.app.metadataCache.getFirstLinkpathDest(s,i);if(!a)return r;try{return this.app.vault.getResourcePath(a)}catch(c){return r}}parseFrontmatter(e){let i=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=e.match(i);if(!r)return{frontmatter:null,contentWithoutFrontmatter:e};let o=r[1],s=e.slice(r[0].length),a={},l=o.split(`
`),c="",u=[],d=!1;for(let h of l){let p=h.trim();if(!p||p.startsWith("#"))continue;if(p.startsWith("- ")){d&&u.push(p.slice(2).trim());continue}d&&!p.startsWith("- ")&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u),d=!1,u=[]);let f=p.indexOf(":");if(f!==-1){let g=p.slice(0,f).trim(),m=p.slice(f+1).trim();switch(g){case"title":a.title=m,c=g;break;case"subtitle":a.subtitle=m,c=g;break;case"original_title":a.original_title=m,c=g;break;case"author":a.author=m,c=g;break;case"translator":a.translator=m,c=g;break;case"co_authors":m?a.co_authors=[m]:(d=!0,c=g,u=[]);break;case"co_translators":m?a.co_translators=[m]:(d=!0,c=g,u=[]);break}}}return d&&(c==="co_authors"?a.co_authors=u:c==="co_translators"&&(a.co_translators=u)),{frontmatter:Object.keys(a).length>0?a:null,contentWithoutFrontmatter:s}}renderFrontmatter(e,i){var c,u;let r=(u=(c=this.hostEl)==null?void 0:c.ownerDocument)!=null?u:document,o=r.createElement("div");o.className="tategaki-frontmatter";let s=!1,a=r.createElement("div");if(a.className="tategaki-frontmatter-top",o.appendChild(a),e.title&&i.preview.showFrontmatterTitle){let d=r.createElement("h1");d.className="tategaki-frontmatter-title",d.textContent=e.title,a.appendChild(d),s=!0}if(e.subtitle&&i.preview.showFrontmatterSubtitle){let d=r.createElement("h2");d.className="tategaki-frontmatter-subtitle",d.textContent=e.subtitle,a.appendChild(d),s=!0}if(e.original_title&&i.preview.showFrontmatterOriginalTitle){let d=r.createElement("h2");d.className="tategaki-frontmatter-original-title",d.textContent=e.original_title,a.appendChild(d),s=!0}let l=r.createElement("div");if(l.className="tategaki-frontmatter-bottom",o.appendChild(l),e.author&&i.preview.showFrontmatterAuthor){let d=r.createElement("h4");d.className="tategaki-frontmatter-author",d.textContent=e.author,this.applyFrontmatterInlineEndAlignment(d),l.appendChild(d),s=!0}if(e.co_authors&&i.preview.showFrontmatterCoAuthors)for(let d of e.co_authors){let h=r.createElement("h4");h.className="tategaki-frontmatter-co-author",h.textContent=d,this.applyFrontmatterInlineEndAlignment(h),l.appendChild(h),s=!0}if(e.translator&&i.preview.showFrontmatterTranslator){let d=r.createElement("h5");d.className="tategaki-frontmatter-translator",d.textContent=e.translator,this.applyFrontmatterInlineEndAlignment(d),l.appendChild(d),s=!0}if(e.co_translators&&i.preview.showFrontmatterCoTranslators)for(let d of e.co_translators){let h=r.createElement("h5");h.className="tategaki-frontmatter-co-translator",h.textContent=d,this.applyFrontmatterInlineEndAlignment(h),l.appendChild(h),s=!0}return s?o:null}applyFrontmatterInlineEndAlignment(e){e.style.display="block",e.style.setProperty("text-align","end","important"),e.style.setProperty("text-align-last","end","important"),e.style.marginInlineStart="auto",e.style.marginInlineEnd="0",e.style.marginLeft="auto",e.style.marginRight="0",e.style.justifySelf="end"}applyFrontmatterWritingMode(e,i){e.style.writingMode=i,e.style.textOrientation="mixed"}getDisplayFile(){if(!this.filePath)return null;let e=this.app.vault.getAbstractFileByPath(this.filePath);return e instanceof Oe.TFile?e:null}getFrontmatterTitle(e){var s;if(!e)return null;let i=this.app.metadataCache.getFileCache(e),r=(s=i==null?void 0:i.frontmatter)==null?void 0:s.title;if(r==null)return null;let o=String(r).trim();return o.length>0?o:null}getEffectiveCommonSettings(){return typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():this.plugin.settings.common}};var Ie=require("obsidian"),Bl=require("@codemirror/language");var fl=class{constructor(t,e,i={}){this.isComposing=!1;this.isActive=!0;this.isVertical=!0;this.maxHeight=500;this.maxWidth=500;this.baseLineSize=32;this.textIndentPx=0;this.caretVisibleClass="tategaki-show-native-caret";this.flushTimer=null;this.flushDelayMs=250;this.flushLengthThreshold=8;this.sizeRaf=null;this.immediateFlushChars=new Set([" ","	",`
`,"\u3000","\u3001","\u3002","\uFF0C","\uFF0E","\uFF01","\uFF1F","!","?",",",".",":",";","\uFF1A","\uFF1B"]);this.parentEl=t,this.callbacks=e,this.focusCallbacks=i,this.textarea=t.createEl("textarea",{cls:"tategaki-sot-overlay-textarea"}),this.textarea.spellcheck=!1,this.textarea.autocapitalize="off",this.textarea.autocomplete="off",this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("wrap","soft"),this.textarea.addEventListener("focus",()=>{var r,o;(o=(r=this.focusCallbacks).onFocus)==null||o.call(r)}),this.textarea.addEventListener("blur",()=>{var r,o;(o=(r=this.focusCallbacks).onBlur)==null||o.call(r),this.isComposing||this.flushPending()}),this.textarea.addEventListener("compositionstart",r=>{var s;this.isComposing=!0,this.clearFlushTimer(),this.textarea.classList.add("tategaki-ime-visible");let o=(s=r.data)!=null?s:"";this.updateDynamicSize(o)}),this.textarea.addEventListener("compositionupdate",r=>{var s,a,l;let o=(s=r.data)!=null?s:this.textarea.value;(l=(a=this.callbacks).onPendingText)==null||l.call(a,o),this.updateDynamicSize(o)}),this.textarea.addEventListener("compositionend",r=>{var s,a,l;this.isComposing=!1,this.textarea.classList.remove("tategaki-ime-visible");let o=(s=r.data)!=null?s:this.textarea.value;this.textarea.value=o,(l=(a=this.callbacks).onPendingText)==null||l.call(a,o),this.flushPending()}),this.textarea.addEventListener("input",()=>{var o,s;if(this.isComposing)return;let r=this.textarea.value;if((s=(o=this.callbacks).onPendingText)==null||s.call(o,r),r.length>=this.flushLengthThreshold||this.shouldFlushImmediate(r)){this.flushPending();return}this.scheduleFlush()}),this.textarea.addEventListener("keydown",r=>{var a,l,c,u,d,h;if(r.key==="Escape"){!this.isComposing&&!r.isComposing&&r.preventDefault(),r.stopPropagation();return}if(r.stopPropagation(),this.isComposing||r.isComposing)return;let o=r.metaKey||r.ctrlKey;if((!o&&!r.altKey&&r.key==="Tab"||o&&!r.shiftKey&&!r.altKey&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r.key))&&this.callbacks.listOutliner&&(this.flushPending(),this.callbacks.listOutliner(r)||r.key==="Tab")){r.preventDefault();return}if(o&&(r.key==="z"||r.key==="Z")){r.preventDefault(),r.shiftKey?this.callbacks.redo():this.callbacks.undo();return}if(o&&(r.key==="y"||r.key==="Y")){r.preventDefault(),this.callbacks.redo();return}if(o&&(r.key==="a"||r.key==="A")){r.preventDefault(),this.flushPending(),(l=(a=this.callbacks).selectAll)==null||l.call(a);return}if(r.key==="Enter"&&!r.shiftKey){r.preventDefault(),this.flushPending(`
`);return}if(r.key==="Backspace"&&this.textarea.value.length===0){r.preventDefault(),r.metaKey||r.ctrlKey?(u=(c=this.callbacks).backspaceEmpty)==null||u.call(c):this.callbacks.backspace();return}if(r.key==="Delete"&&this.textarea.value.length===0){r.preventDefault(),this.callbacks.del();return}this.textarea.value.length===0&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r.key)&&(r.preventDefault(),(h=(d=this.callbacks).navigate)==null||h.call(d,r))}),this.textarea.addEventListener("keyup",r=>{r.key==="Escape"&&(!this.isComposing&&!r.isComposing&&r.preventDefault(),r.stopPropagation())})}focus(t=!0){if(this.isActive){if(t){let e=this.parentEl.scrollTop,i=this.parentEl.scrollLeft;try{this.textarea.focus({preventScroll:!0})}catch(r){this.textarea.focus()}this.parentEl.scrollTop=e,this.parentEl.scrollLeft=i;return}this.textarea.focus()}}setActive(t){var e,i;this.isActive!==t&&(this.isActive=t,this.textarea.style.display=t?"":"none",this.textarea.disabled=!t,t||(this.isComposing=!1,this.textarea.value="",this.textarea.classList.remove("tategaki-ime-visible"),this.textarea.blur(),(i=(e=this.callbacks).onPendingText)==null||i.call(e,""),this.clearFlushTimer(),this.resetSize()))}isFocused(){return document.activeElement===this.textarea}getSelectionStart(){let t=this.textarea.selectionStart;return t===null||!Number.isFinite(t)?null:Math.max(0,t)}setCaretVisible(t){t?this.textarea.classList.add(this.caretVisibleClass):this.textarea.classList.remove(this.caretVisibleClass)}setAnchorPosition(t,e){this.textarea.style.left=`${t}px`,this.textarea.style.right="",this.textarea.style.top=`${e}px`}setAnchorPositionVertical(t,e){this.textarea.style.left="",this.textarea.style.right=`${this.parentEl.clientWidth-t}px`,this.textarea.style.top=`${e}px`}setConstraints(t,e,i){let r=this.isVertical!==t;this.isVertical=t,this.baseLineSize=i,t?(this.maxHeight=e,this.textarea.style.height=`${e}px`,(r||!this.textarea.style.width)&&(this.textarea.style.width=`${i}px`)):(this.maxWidth=e,this.textarea.style.width=`${e}px`,(r||!this.textarea.style.height)&&(this.textarea.style.height=`${i}px`))}setTextIndent(t){let e=Number.isFinite(t)?Math.max(0,t):0;this.textIndentPx!==e&&(this.textIndentPx=e,this.textarea.style.textIndent=`${e}px`)}updateDynamicSize(t){let e=this.baseLineSize*10,i=0,r=0;if(this.isVertical){let s=Math.ceil(this.textarea.scrollWidth),a=this.textarea.clientWidth||Number.parseFloat(this.textarea.style.width)||0,l=Math.max(this.baseLineSize,Math.min(s,e));s>a+1&&(l=Math.max(l,a+this.baseLineSize)),l=Math.min(l,e);let c=Math.max(a,l);i=a,r=c,this.textarea.style.width=`${c}px`}else{let s=Math.ceil(this.textarea.scrollHeight),a=this.textarea.clientHeight||Number.parseFloat(this.textarea.style.height)||0,l=Math.max(this.baseLineSize,Math.min(s,e));s>a+1&&(l=Math.max(l,a+this.baseLineSize)),l=Math.min(l,e);let c=Math.max(a,l);i=a,r=c,this.textarea.style.height=`${c}px`}r>i+.5&&this.sizeRaf===null&&(this.sizeRaf=window.requestAnimationFrame(()=>{this.sizeRaf=null,this.updateDynamicSize()}))}getPendingText(){return this.textarea.value}isImeVisible(){return this.isComposing}shouldFlushImmediate(t){var i;if(t.length===0)return!1;let e=(i=t[t.length-1])!=null?i:"";return this.immediateFlushChars.has(e)}scheduleFlush(){this.clearFlushTimer(),this.flushTimer=window.setTimeout(()=>{this.flushTimer=null,this.flushPending()},this.flushDelayMs)}clearFlushTimer(){this.flushTimer!==null&&(window.clearTimeout(this.flushTimer),this.flushTimer=null)}flushPending(t=""){var r,o;if(this.isComposing)return;let e=this.textarea.value;if(e.length===0&&t.length===0){this.clearFlushTimer();return}let i=`${e}${t}`;this.callbacks.replaceSelection(i),this.textarea.value="",(o=(r=this.callbacks).onPendingText)==null||o.call(r,""),this.clearFlushTimer(),this.resetSize()}resetSize(){this.isVertical?this.textarea.style.width=`${this.baseLineSize}px`:this.textarea.style.height=`${this.baseLineSize}px`}destroy(){var t,e;(e=(t=this.callbacks).onPendingText)==null||e.call(t,""),this.clearFlushTimer(),this.sizeRaf!==null&&(window.cancelAnimationFrame(this.sizeRaf),this.sizeRaf=null),this.textarea.detach()}};var ml=class{constructor(t,e){this.isOpen=!1;this.callbacks=e,this.rootEl=t.createDiv("tategaki-sot-outline-panel"),this.rootEl.style.display="none",this.rootEl.setAttribute("role","dialog"),this.rootEl.setAttribute("aria-label","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3"),this.rootEl.addEventListener("pointerdown",o=>{o.stopPropagation()});let i=this.rootEl.createDiv("tategaki-sot-outline-header"),r=i.createDiv("tategaki-sot-outline-title");r.textContent="\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",this.closeButton=i.createEl("button",{cls:"tategaki-sot-outline-close",text:"\xD7",attr:{type:"button","aria-label":"\u9589\u3058\u308B"}}),this.closeButton.addEventListener("click",()=>this.close()),this.listEl=this.rootEl.createDiv("tategaki-sot-outline-list")}toggle(){if(this.isOpen){this.close();return}this.open()}open(){this.isOpen=!0,this.rootEl.style.display="",this.refresh()}close(){var t,e;this.isOpen&&(this.isOpen=!1,this.rootEl.style.display="none",this.listEl.replaceChildren(),(e=(t=this.callbacks).onClose)==null||e.call(t))}refresh(){if(!this.isOpen)return;let t=this.callbacks.getItems();if(this.listEl.replaceChildren(),t.length===0){let e=this.listEl.createDiv("tategaki-sot-outline-empty");e.textContent="\u898B\u51FA\u3057\u304C\u3042\u308A\u307E\u305B\u3093";return}for(let e of t){let i=this.listEl.createDiv("tategaki-sot-outline-item");i.style.paddingLeft=`${(e.level-1)*12}px`,i.textContent=e.text,i.addEventListener("click",()=>{this.callbacks.onSelect(e)})}}};var gl=n=>{var l,c,u,d,h;let t="",e=n,i=e.match(/^([ \t]{0,3}(?:> ?)+)(.*)$/);i&&(t+=(l=i[1])!=null?l:"",e=(c=i[2])!=null?c:"");let r=e.match(/^([ \t]*)([-+*])[ \t]+\[([ xX])\][ \t]+/);if(r&&r[0])t+=r[0],e=e.slice(r[0].length);else{let p=e.match(/^([ \t]*)([-+*])[ \t]+/);if(p&&p[0])t+=p[0],e=e.slice(p[0].length);else{let f=e.match(/^([ \t]*)(\d{1,9})([.)])[ \t]+/);f&&f[0]&&(t+=f[0],e=e.slice(f[0].length))}}let o=e.match(/^(#{1,6})([ \t]+)(.*)$/);if(!o)return{prefix:t,content:e,level:0,hasHeading:!1};let s=(d=(u=o[1])==null?void 0:u.length)!=null?d:0,a=(h=o[3])!=null?h:"";return a=a.replace(/[ \t]+#+[ \t]*$/,""),{prefix:t,content:a,level:s,hasHeading:s>0}},gt=n=>{var l,c,u,d,h,p,f,g,m,b;let t="",e=n,i=e.match(/^([ \t]{0,3}(?:> ?)+)(.*)$/);i&&(t=(l=i[1])!=null?l:"",e=(c=i[2])!=null?c:"");let r=e.match(/^([ \t]*)([-+*])[ \t]+\[([ xX])\][ \t]+(.*)$/);if(r)return{prefix:t,indent:(u=r[1])!=null?u:"",content:(d=r[4])!=null?d:"",kind:"task"};let o=e.match(/^([ \t]*)([-+*])[ \t]+(.*)$/);if(o)return{prefix:t,indent:(h=o[1])!=null?h:"",content:(p=o[3])!=null?p:"",kind:"bullet"};let s=e.match(/^([ \t]*)(\d{1,9})([.)])[ \t]+(.*)$/);if(s)return{prefix:t,indent:(f=s[1])!=null?f:"",content:(g=s[4])!=null?g:"",kind:"ordered"};let a=e.match(/^([ \t]*)(.*)$/);return{prefix:t,indent:(m=a==null?void 0:a[1])!=null?m:"",content:(b=a==null?void 0:a[2])!=null?b:"",kind:"none"}},Ch=n=>/^[ \t]{0,3}> ?/.test(n);var bl=(n,t,e,i,r,o)=>{if(!e.includes("<"))return;let s=e.toLowerCase(),a=0,l=r.filter(c=>c.className==="tategaki-md-code").map(c=>({from:c.from,to:c.to}));for(;a<s.length;){let c=s.indexOf("<u>",a);if(c<0)break;let u=s.indexOf("</u>",c+3);if(u<0)break;let d=c+3,h=u;if(h<=d){a=u+4;continue}let p=n+d,f=n+h;if(p<n||f>t){a=u+4;continue}if(o(p,f,l)){a=u+4;continue}i.push({from:n+c,to:n+c+3}),i.push({from:n+u,to:n+u+4}),r.push({from:p,to:f,className:"tategaki-md-underline"}),a=u+4}},cN=(n,t)=>{if(n.length===0||t.length===0)return n;let e=Array.from(new Set(t)).sort((r,o)=>r-o),i=[];for(let r of n){let o=e.filter(a=>a>r.from&&a<r.to);if(o.length===0){i.push(r);continue}let s=r.from;for(let a of[...o,r.to]){if(a<=s)continue;let l=s-r.from,c=a-r.from,u=r.text.slice(l,c);u.length>0&&i.push({...r,from:s,to:a,text:u}),s=a}}return i},Lh=(n,t)=>{if(n.length===0||t.length===0)return n;let e=[];for(let r of t)e.push(r.from,r.to);return cN(n,e).map(r=>{let o=[...r.classNames];for(let s of t)r.from>=s.from&&r.to<=s.to&&(o.includes(s.className)||o.push(s.className));return{...r,classNames:o}})};var uN=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);function kE(n,t){let e=dN(n,t);if(!e)return!1;let i=hN(n,e);return e==="indent"||e==="outdent"?!0:i}function dN(n,t){let e=t.metaKey||t.ctrlKey;return!e&&!t.altKey&&t.key==="Tab"?t.shiftKey?"outdent":"indent":!e||t.shiftKey||t.altKey||!uN.has(t.key)?null:n.getWritingMode()==="vertical-rl"?t.key==="ArrowRight"?"move-up":t.key==="ArrowLeft"?"move-down":null:t.key==="ArrowUp"?"move-up":t.key==="ArrowDown"?"move-down":null}function hN(n,t){return t==="indent"||t==="outdent"?pN(n,t):fN(n,t)}function pN(n,t){var b,y;let e=n.getDoc(),i=n.getSelection();if(!e||!i)return!1;let r=e.split(`
`),o=SE(r,n.getLineRanges()),s=n.getLineBlockKinds(),a=Math.min(i.anchor,i.head),l=Math.max(i.anchor,i.head),c=vl(a,o),u=vl(l,o);if(c===null||u===null)return!1;let d=o[u];d&&l===d.from&&l>a&&(u=Math.max(c,u-1));let h=(()=>{if(i.anchor!==i.head)return null;let v=vl(i.head,o);if(v===null)return null;let E=o[v];return E?{lineIndex:v,offset:i.head-E.from}:null})(),p=[];for(let v=c;v<=u;v+=1)!hn(s,v)||gt((b=r[v])!=null?b:"").kind==="none"||p.push(v);if(p.length===0)return!1;let f=[],g=-1;for(let v of p){if(v<=g)continue;let E=yl(r,s,v);E&&(f.push(E),g=E.end)}if(f.length===0)return!1;let m=[];for(let v of f){let E=Rh(v.rootKind),x=EE(v.rootIndentColumns),k=xE(x),S=k;if(t==="indent"){let I=yN(r,s,v.start,v.rootPrefix,E);if(I===null)continue;S=Math.min(k+1,I+1)}else S=Math.max(0,k-1);if(S===k&&t==="indent")continue;let w=S-k,C=t==="outdent"&&k===0;for(let I=v.start;I<=v.end;I+=1){if(!hn(s,I))continue;let F=(y=r[I])!=null?y:"",N=gt(F),H=N.prefix,_=N.indent,P=Ni(_),L=EE(P),R=xE(L),T=Math.max(0,R+w),A=" ".repeat(T*E),B;if(C&&I===v.start){let W=F.slice(H.length+_.length);B=`${H}${A}${bN(W,v.rootKind)}`}else{let W=F.slice(H.length+_.length);B=`${H}${A}${W}`}if(B!==F){let W=o[I];if(!W)continue;m.push({from:W.from,to:W.to,insert:B})}}}return m.length===0?!1:(wE(n,m,i,h),vN(n,s,f),!0)}function fN(n,t){var f;let e=n.getDoc(),i=n.getSelection();if(!e||!i)return!1;let r=e.split(`
`),o=SE(r,n.getLineRanges()),s=n.getLineBlockKinds(),a=vl(i.head,o);if(a===null||!hn(s,a)||gt((f=r[a])!=null?f:"").kind==="none")return!1;let c=yl(r,s,a);if(!c)return!1;let u=c.rootIndentColumns,d=c.rootPrefix;if(t==="move-up"){let g=mN(r,s,c.start,u,d);if(g===null)return!1;let m=yl(r,s,g);return m?vE(n,r,o,i,m,c,!0):!1}let h=gN(r,s,c.end,u,d);if(h===null)return!1;let p=yl(r,s,h);return p?vE(n,r,o,i,c,p,!1):!1}function yl(n,t,e){var l,c;let i=(l=n[e])!=null?l:"",r=gt(i);if(r.kind==="none")return null;let o=Ni(r.indent),s=r.prefix,a=e;for(let u=e+1;u<n.length&&hn(t,u);u+=1){let d=(c=n[u])!=null?c:"",h=gt(d);if(h.prefix!==s)break;let p=Ni(h.indent),f=d.trim().length===0;if(h.kind!=="none"){if(p<=o)break;a=u;continue}if(f){if(p>o){a=u;continue}break}if(p<=o)break;a=u}return{start:e,end:a,rootKind:r.kind,rootIndentColumns:o,rootPrefix:s}}function mN(n,t,e,i,r){var o;for(let s=e-1;s>=0;s-=1){if(!hn(t,s))return null;let a=(o=n[s])!=null?o:"",l=gt(a);if(l.prefix!==r)return null;let c=Ni(l.indent);if(a.trim().length!==0){if(l.kind!=="none"){if(c<i)return null;if(c===i)return s;continue}if(c<=i)return null}}return null}function gN(n,t,e,i,r){var o;for(let s=e+1;s<n.length;s+=1){if(!hn(t,s))return null;let a=(o=n[s])!=null?o:"",l=gt(a);if(l.prefix!==r)return null;let c=Ni(l.indent);if(a.trim().length!==0){if(l.kind!=="none"){if(c<i)return null;if(c===i)return s;continue}if(c<=i)return null}}return null}function vE(n,t,e,i,r,o,s){var w,C,I,F,N,H,_,P;let a=e[r.start],l=e[o.end];if(!a||!l)return!1;let c=t.slice(r.start,r.end+1),u=t.slice(o.start,o.end+1),d=t.slice(r.end+1,o.start),p=[...u,...d,...c].join(`
`);n.updatePendingText("",!0),(w=n.markImmediateRender)==null||w.call(n),n.replaceRange(a.from,l.to,p);let f=(I=(C=e[r.start])==null?void 0:C.from)!=null?I:a.from,g=(()=>{let L=[...u,...d];return L.length===0?0:L.join(`
`).length+1})(),m=s?f:f+g,b=s?o:r,y=(N=(F=e[b.start])==null?void 0:F.from)!=null?N:a.from,v=(_=(H=e[b.end])==null?void 0:H.to)!=null?_:l.to,E=L=>L<y||L>v?L:m+(L-y),x=E(i.anchor),k=E(i.head);return((P=n.setSelectionRaw)!=null?P:n.setSelectionNormalized)(x,k),n.focusInputSurface(!0),!0}function wE(n,t,e,i){var g,m,b;if(t.length===0)return;n.updatePendingText("",!0),(g=n.markImmediateRender)==null||g.call(n);let r=t.slice().sort((y,v)=>y.from-v.from),o=(m=n.getDoc())!=null?m:"",s=r[0].from,a=r[r.length-1].to,l=[],c=s;for(let y of r)y.from>c&&l.push(o.slice(c,y.from)),l.push(y.insert),c=y.to;let u=l.join("");n.replaceRange(s,a,u);let d=e.anchor,h=e.head,p=r.slice().reverse();for(let y of p){let v=y.insert.length-(y.to-y.from),E=x=>{if(x>y.to)return x+v;if(x<y.from)return x;let k=x+v,S=y.from,w=y.from+y.insert.length;return Math.max(S,Math.min(k,w))};d=E(d),h=E(h)}let f=(b=n.setSelectionRaw)!=null?b:n.setSelectionNormalized;if(f(d,h),i){let y=n.getDoc();if(y){let v=y.split(`
`);if(i.lineIndex>=0&&i.lineIndex<v.length){let x=Ah(v)[i.lineIndex];if(x){let k=Math.max(x.from,Math.min(x.to,x.from+i.offset));f(k,k)}}}}n.focusInputSurface(!0)}function bN(n,t){return t==="task"?n.replace(/^[-+*][ \t]+\[[ xX]\][ \t]+/,""):t==="ordered"?n.replace(/^\d{1,9}[.)][ \t]+/,""):n.replace(/^[-+*][ \t]+/,"")}function Ni(n){let t=0;for(let e of n)e==="	"?t+=4:t+=1;return t}function Rh(n){return 4}function EE(n){if(!Number.isFinite(n)||n<=0)return 0;let t=Rh("bullet");return Math.floor(n/t)*t}function xE(n){let t=Rh("bullet");return Math.max(0,Math.floor(n/t))}function yN(n,t,e,i,r){var o;for(let s=e-1;s>=0;s-=1){if(!hn(t,s))return null;let a=(o=n[s])!=null?o:"",l=gt(a);if(l.kind==="none"||l.prefix!==i)return null;let c=Ni(l.indent);return Math.max(0,Math.floor(c/r))}return null}function hn(n,t){let e=n[t];return e?e==="normal":!0}function SE(n,t){return Ah(n)}function Ah(n){let t=[],e=0;for(let i of n){let r=e,o=e+i.length;t.push({from:r,to:o}),e=o+1}return t}function vl(n,t){if(!Number.isFinite(n)||n<0)return null;for(let e=0;e<t.length;e+=1){let i=t[e];if(i&&n<=i.to)return e}return t.length>0?t.length-1:null}function vN(n,t,e){var d,h,p,f,g;let i=n.getDoc();if(!i)return;let r=i.split(`
`),o=Ah(r),s=r.length,a=-1;for(let m of e)s=Math.min(s,m.start),a=Math.max(a,m.end);if(s>a)return;for(;s>0;){let m=s-1;if(!hn(t,m)||gt((d=r[m])!=null?d:"").kind==="none")break;s=m}for(;a<r.length-1;){let m=a+1;if(!hn(t,m)||gt((h=r[m])!=null?h:"").kind==="none")break;a=m}let l=[],c=new Map;for(let m=s;m<=a;m+=1){if(!hn(t,m))continue;let b=(p=r[m])!=null?p:"",y=gt(b);if(y.kind!=="ordered")continue;let v=Ni(y.indent);for(let[I]of c)I>v&&c.delete(I);let E=((f=c.get(v))!=null?f:0)+1;c.set(v,E);let k=b.slice(y.prefix.length).match(/^([ \t]*)(\d{1,9})([.)])([ \t]+.*)$/);if(!k||Number.parseInt((g=k[2])!=null?g:"1",10)===E)continue;let w=`${y.prefix}${k[1]}${E}${k[3]}${k[4]}`,C=o[m];C&&l.push({from:C.from,to:C.to,insert:w})}if(l.length===0)return;let u=n.getSelection();u&&wE(n,l,u,null)}var ME=n=>{let t=/^---\s*\n([\s\S]*?)\n---\s*\n/,e=n.match(t);if(!e)return{frontmatter:null,contentWithoutFrontmatter:n};let i=e[1],r=n.slice(e[0].length),o={},s=i.split(`
`),a="",l=[],c=!1;for(let u of s){let d=u.trim();if(!d||d.startsWith("#"))continue;if(d.startsWith("- ")){c&&l.push(d.slice(2).trim());continue}c&&!d.startsWith("- ")&&(a==="co_authors"?o.co_authors=l:a==="co_translators"&&(o.co_translators=l),c=!1,l=[]);let h=d.indexOf(":");if(h!==-1){let p=d.slice(0,h).trim(),f=d.slice(h+1).trim();switch(p){case"title":o.title=f;break;case"subtitle":o.subtitle=f;break;case"original_title":o.original_title=f;break;case"author":o.author=f;break;case"translator":o.translator=f;break;case"co_authors":case"co_translators":if(f){let g=f.split(",").map(m=>m.trim()).filter(m=>m.length>0);p==="co_authors"?o.co_authors=g:o.co_translators=g}else a=p,c=!0,l=[];break;default:break}}}return c&&(a==="co_authors"?o.co_authors=l:a==="co_translators"&&(o.co_translators=l)),{frontmatter:Object.keys(o).length>0?o:null,contentWithoutFrontmatter:r}},El=n=>{n.style.display="block",n.style.setProperty("text-align","end","important"),n.style.setProperty("text-align-last","end","important"),n.style.marginInlineStart="auto",n.style.marginInlineEnd="0",n.style.marginLeft="auto",n.style.marginRight="0",n.style.justifySelf="end"},Ih=(n,t)=>{n.style.writingMode=t,n.style.textOrientation="mixed"},TE=(n,t)=>{let e=document.createElement("div");e.className="tategaki-frontmatter";let i=!1,r=e.createDiv("tategaki-frontmatter-top");if(n.title&&t.preview.showFrontmatterTitle){let s=r.createEl("h1",{cls:"tategaki-frontmatter-title"});s.textContent=n.title,i=!0}if(n.subtitle&&t.preview.showFrontmatterSubtitle){let s=r.createEl("h2",{cls:"tategaki-frontmatter-subtitle"});s.textContent=n.subtitle,i=!0}if(n.original_title&&t.preview.showFrontmatterOriginalTitle){let s=r.createEl("h2",{cls:"tategaki-frontmatter-original-title"});s.textContent=n.original_title,i=!0}let o=e.createDiv("tategaki-frontmatter-bottom");if(n.author&&t.preview.showFrontmatterAuthor){let s=o.createEl("h4",{cls:"tategaki-frontmatter-author"});s.textContent=n.author,El(s),i=!0}if(n.co_authors&&t.preview.showFrontmatterCoAuthors)for(let s of n.co_authors){let a=o.createEl("h4",{cls:"tategaki-frontmatter-co-author"});a.textContent=s,El(a),i=!0}if(n.translator&&t.preview.showFrontmatterTranslator){let s=o.createEl("h5",{cls:"tategaki-frontmatter-translator"});s.textContent=n.translator,El(s),i=!0}if(n.co_translators&&t.preview.showFrontmatterCoTranslators)for(let s of n.co_translators){let a=o.createEl("h5",{cls:"tategaki-frontmatter-co-translator"});a.textContent=s,El(a),i=!0}return i?e:null};var In=n=>{var o,s;let t=(o=n.selectionStart)!=null?o:0,e=(s=n.selectionEnd)!=null?s:t,i=Math.min(t,e),r=Math.max(t,e);return{start:i,end:r,text:n.value.slice(i,r)}},An=(n,t,e={})=>{var u,d,h,p;let i=In(n),r=(u=n.value)!=null?u:"",o=r.slice(0,i.start),s=r.slice(i.end);n.value=`${o}${t}${s}`;let a=o.length,l=(d=e.selectionStart)!=null?d:a+t.length,c=(h=e.selectionEnd)!=null?h:l;n.focus({preventScroll:!0});try{n.setSelectionRange(l,c)}catch(f){}(p=e.onResize)==null||p.call(e)},kr=(n,t,e,i)=>{let r=In(n),o=`${t}${r.text}${e}`,s=r.start+t.length,a=s+r.text.length;if(r.start===r.end){An(n,o,{selectionStart:s,selectionEnd:s,onResize:i});return}An(n,o,{selectionStart:s,selectionEnd:a,onResize:i})},EN=n=>{let t=n;t=t.replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1"),t=t.replace(/==([^=\n]+)==/g,"$1"),t=t.replace(/\*\*([^*\n]+)\*\*/g,"$1"),t=t.replace(/\*([^*\n]+)\*/g,"$1"),t=t.replace(/~~([^~\n]+)~~/g,"$1"),t=t.replace(/<u>([\s\S]*?)<\/u>/gi,"$1");let e=Gt();return t=t.replace(e,(i,...r)=>{var s,a;let o=r[r.length-1];return(a=(s=o==null?void 0:o.body2)!=null?s:o==null?void 0:o.body1)!=null?a:i}),t},CE=(n,t)=>{let e=In(n);if(e.start===e.end)return;let i=EN(e.text),r=e.start,o=r+i.length;An(n,i,{selectionStart:r,selectionEnd:o,onResize:t})},LE=(n,t,e,i)=>{let r=In(n),o=t||r.text||e;if(!o||!e)return;let s=`[${o}](${e})`,a=r.start+1,l=a+o.length;An(n,s,{selectionStart:a,selectionEnd:l,onResize:i})},RE=(n,t,e,i,r,o)=>{let s=In(n),a=t||s.text;if(!a)return;if(!e||e.trim()===""){An(n,a,{onResize:o});return}let l=r(a,e,!!i),c=s.start+l.length;An(n,l,{selectionStart:c,selectionEnd:c,onResize:o})};function Nh(n,t,e){let i=n;if(typeof i.caretPositionFromPoint=="function"){let r=i.caretPositionFromPoint(t,e);if(r!=null&&r.offsetNode)return{node:r.offsetNode,offset:r.offset}}if(typeof i.caretRangeFromPoint=="function"){let r=i.caretRangeFromPoint(t,e);if(r)return{node:r.startContainer,offset:r.startOffset}}return null}function AE(n,t,e){let r=n.width>2?Math.max(n.left+1,Math.min(t,n.right-1)):n.left+n.width/2,o=n.height>2?Math.max(n.top+1,Math.min(e,n.bottom-1)):n.top+n.height/2;return{x:r,y:o}}function wr(n,t){if(n.length===0)return t;let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let s of n)e=Math.min(e,s.left),i=Math.max(i,s.right),r=Math.min(r,s.top),o=Math.max(o,s.bottom);return!Number.isFinite(e)||!Number.isFinite(i)?t:DOMRect.fromRect({x:e,y:r,width:i-e,height:o-r})}var xl=class{constructor(t){this.host=t}ensureOverlay(){if(this.host.derivedRootEl&&!this.host.plainEditOverlayEl){let t=document.createElement("textarea");t.className="tategaki-plain-overlay",t.spellcheck=!1,t.wrap="soft",t.setAttribute("autocapitalize","off"),t.setAttribute("autocomplete","off"),t.setAttribute("autocorrect","off"),t.addEventListener("mousedown",e=>{e.button===2&&e.preventDefault(),e.stopPropagation()}),t.addEventListener("pointerdown",e=>{e.button===2&&e.preventDefault(),e.stopPropagation()}),t.addEventListener("compositionstart",()=>{this.host.plainEditComposing=!0}),t.addEventListener("compositionend",()=>{this.host.plainEditComposing=!1}),t.addEventListener("keydown",e=>{if(e.key==="Escape"){e.preventDefault(),e.stopPropagation(),this.host.toggleSourceMode();return}if(!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.ctrlKey&&!e.isComposing&&!this.host.plainEditComposing&&e.keyCode!==229){if(e.key.startsWith("Arrow")&&this.handleArrowKey(e.key)){e.preventDefault();return}if(e.key==="Enter"&&this.handleEnter()){e.preventDefault();return}if(e.key==="Backspace"&&this.handleBackspace()){e.preventDefault();return}if(e.key==="Delete"&&this.handleDelete()){e.preventDefault();return}}e.stopPropagation()}),t.addEventListener("input",()=>{this.adjustOverlaySize()}),this.host.plainEditOverlayEl=t,this.host.derivedRootEl.appendChild(t)}}destroyOverlay(){this.host.plainEditOverlayEl&&(this.host.plainEditOverlayEl.remove(),this.host.plainEditOverlayEl=null),this.host.plainEditOverlayBaseRect=null}adjustOverlaySize(){if(!this.host.plainEditOverlayEl||!this.host.plainEditOverlayBaseRect)return;let t=this.host.plainEditOverlayBaseRect,e=2,i=Math.max(0,Math.ceil(t.width)),r=Math.max(0,Math.ceil(t.height));this.host.plainEditOverlayEl.style.width=`${i}px`,this.host.plainEditOverlayEl.style.height=`${r}px`;let o=Math.ceil(this.host.plainEditOverlayEl.scrollWidth),s=Math.ceil(this.host.plainEditOverlayEl.scrollHeight),a=Math.max(i,o+e),l=Math.max(r,s+e);if(this.host.plainEditOverlayEl.style.width=`${a}px`,this.host.plainEditOverlayEl.style.height=`${l}px`,(this.host.plainEditOverlayEl.style.writingMode||getComputedStyle(this.host.plainEditOverlayEl).writingMode)==="vertical-rl"){let u=t.left+t.width-a;this.host.plainEditOverlayEl.style.left=`${u}px`}else this.host.plainEditOverlayEl.style.left=`${t.left}px`;this.host.plainEditOverlayEl.style.top=`${t.top}px`}getWritingMode(){if(!this.host.plainEditOverlayEl)return"vertical-rl";let t=getComputedStyle(this.host.plainEditOverlayEl).writingMode;return t==="horizontal-tb"?"horizontal-tb":t==="vertical-lr"?"vertical-lr":"vertical-rl"}getArrowMoveDirection(t,e,i,r){return r==="vertical-lr"?i&&t==="ArrowRight"?"next":e&&t==="ArrowLeft"?"prev":null:r==="vertical-rl"?i&&t==="ArrowLeft"?"next":e&&t==="ArrowRight"?"prev":null:i&&t==="ArrowDown"?"next":e&&t==="ArrowUp"?"prev":null}handleArrowKey(t){var p,f,g;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let e=(p=this.host.plainEditOverlayEl.value)!=null?p:"",i=(f=this.host.plainEditOverlayEl.selectionStart)!=null?f:0,r=(g=this.host.plainEditOverlayEl.selectionEnd)!=null?g:i;if(i!==r)return!1;let o=i===0,s=i===e.length;if(!o&&!s)return!1;let a=this.getArrowMoveDirection(t,o,s,this.getWritingMode());if(!a)return!1;let l=this.host.plainEditRange.startLine,c=a==="prev"?l-1:l+1;if(c<0||c>=this.host.lineRanges.length)return!1;let u=this.host.lineRanges[c];if(!u)return!1;let d=a==="prev"?u.to-u.from:0;this.commit(!0,!1);let h=u.from+Math.max(0,d);return this.host.setSelectionNormalized(h,h),this.startFromSelection(),!0}handleEnter(){var u,d,h;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||!this.host.sotEditor||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let t=(u=this.host.plainEditOverlayEl.value)!=null?u:"",e=(d=this.host.plainEditOverlayEl.selectionStart)!=null?d:0,i=(h=this.host.plainEditOverlayEl.selectionEnd)!=null?h:e,r=Math.min(e,i),o=Math.max(e,i),s=t.slice(0,r),a=t.slice(o),l=`${s}
${a}`,c=this.host.plainEditRange.from+s.length+1;return this.applyRangeReplacement(this.host.plainEditRange.from,this.host.plainEditRange.to,l,c),!0}handleBackspace(){var u,d,h;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||!this.host.sotEditor||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let t=(u=this.host.plainEditOverlayEl.selectionStart)!=null?u:0,e=(d=this.host.plainEditOverlayEl.selectionEnd)!=null?d:t;if(t!==e||t!==0)return!1;let i=this.host.plainEditRange.startLine;if(i<=0)return!1;let r=this.host.lineRanges[i-1];if(!r)return!1;let s=this.host.sotEditor.getDoc().slice(r.from,r.to),a=(h=this.host.plainEditOverlayEl.value)!=null?h:"",l=`${s}${a}`,c=r.from+s.length;return this.applyRangeReplacement(r.from,this.host.plainEditRange.to,l,c),!0}handleDelete(){var d,h,p;if(!this.host.plainEditOverlayEl||!this.host.plainEditRange||!this.host.sotEditor||this.host.plainEditRange.startLine!==this.host.plainEditRange.endLine)return!1;let t=(d=this.host.plainEditOverlayEl.value)!=null?d:"",e=(h=this.host.plainEditOverlayEl.selectionStart)!=null?h:0,i=(p=this.host.plainEditOverlayEl.selectionEnd)!=null?p:e;if(e!==i||e!==t.length)return!1;let o=this.host.plainEditRange.startLine+1;if(o>=this.host.lineRanges.length)return!1;let s=this.host.lineRanges[o];if(!s)return!1;let l=this.host.sotEditor.getDoc().slice(s.from,s.to),c=`${t}${l}`,u=this.host.plainEditRange.from+t.length;return this.applyRangeReplacement(this.host.plainEditRange.from,s.to,c,u),!0}applyRangeReplacement(t,e,i,r){if(this.host.sotEditor){this.host.updatePendingText("",!0),this.host.immediateRender=!0,this.host.plainEditCommitting=!0;try{this.host.sotEditor.replaceRange(t,e,i)}finally{this.host.plainEditCommitting=!1}this.clearTargets(),this.host.plainEditRange=null,this.host.plainEditOverlayEl&&(this.host.plainEditOverlayEl.style.display="none"),this.host.setSelectionNormalized(r,r),this.startFromSelection()}}clearTargets(){if(this.host.plainEditRange)for(let t=this.host.plainEditRange.startLine;t<=this.host.plainEditRange.endLine;t+=1){let e=this.host.getLineElement(t);e&&(e.classList.remove("tategaki-plain-overlay-target"),e.removeAttribute("data-plain-mode"))}}applyTargetClass(t,e){if(!this.host.sourceModeEnabled||!this.host.plainEditRange){t.classList.remove("tategaki-plain-overlay-target"),t.removeAttribute("data-plain-mode");return}if(e!==null){if(e<this.host.plainEditRange.startLine||e>this.host.plainEditRange.endLine){t.classList.remove("tategaki-plain-overlay-target"),t.removeAttribute("data-plain-mode");return}t.classList.add("tategaki-plain-overlay-target"),t.setAttribute("data-plain-mode","true")}}applyTargets(t){for(let e=t.startLine;e<=t.endLine;e+=1){let i=this.host.getLineElement(e);i&&this.applyTargetClass(i,e)}}getRangeFromSelection(){var m,b;if(!this.host.sotEditor)return null;let t=this.host.sotEditor.getSelection(),e=Math.min(t.anchor,t.head),i=Math.max(t.anchor,t.head),r=t.head,o=this.host.findLineIndex(r);if(o===null)return null;let s=this.getBlockLineRange(o),a=(m=s==null?void 0:s.start)!=null?m:o,l=(b=s==null?void 0:s.end)!=null?b:o,c=this.host.lineRanges[a],u=this.host.lineRanges[l];if(!c||!u)return null;let d=c.from,h=u.to,p=Math.max(0,h-d),f=Math.max(0,Math.min(e-d,p)),g=Math.max(0,Math.min(i-d,p));return{startLine:a,endLine:l,from:d,to:h,selectionStart:f,selectionEnd:g}}getBlockLineRange(t){var i,r,o,s;if(t<0||t>=this.host.lineBlockKinds.length)return null;let e=(i=this.host.lineBlockKinds[t])!=null?i:"normal";if(e==="code"||e==="code-fence")return(r=this.host.getCodeBlockRangeForLine(t))!=null?r:{start:t,end:t};if(e==="math"||e==="math-fence"){let a=this.host.lineMathBlockStart[t],l=this.host.lineMathBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="callout"||e==="callout-title"){let a=this.host.lineCalloutBlockStart[t],l=this.host.lineCalloutBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="table-row"||e==="table-sep"){let a=this.host.lineTableBlockStart[t],l=this.host.lineTableBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="deflist"){let a=this.host.lineDeflistBlockStart[t],l=this.host.lineDeflistBlockEnd[t];if(a!==null&&l!==null)return{start:a,end:l}}if(e==="frontmatter"||e==="frontmatter-fence"){let a=t,l=t;for(;a>0;){let c=(o=this.host.lineBlockKinds[a-1])!=null?o:"normal";if(c!=="frontmatter"&&c!=="frontmatter-fence")break;a-=1}for(;l+1<this.host.lineBlockKinds.length;){let c=(s=this.host.lineBlockKinds[l+1])!=null?s:"normal";if(c!=="frontmatter"&&c!=="frontmatter-fence")break;l+=1}return{start:a,end:l}}return{start:t,end:t}}updateOverlayPosition(t){if(!this.host.derivedRootEl||!this.host.plainEditOverlayEl)return;let e=this.host.derivedRootEl.getBoundingClientRect(),i=null,r=(h,p)=>{let f=Math.min(h.left,p.left),g=Math.min(h.top,p.top),m=Math.max(h.right,p.right),b=Math.max(h.bottom,p.bottom);return DOMRect.fromRect({x:f,y:g,width:Math.max(1,m-f),height:Math.max(1,b-g)})};for(let h=t.startLine;h<=t.endLine;h+=1){let p=this.host.getLineElement(h);if(!p)continue;this.host.ensureLineRendered(p);let f=this.host.getLineVisualRects(p),g=p.getBoundingClientRect(),m=wr(f,g),b=r(m,g);i=i?r(i,b):b}if(!i)return;let o=this.host.derivedRootEl.dataset.writingMode||getComputedStyle(this.host.derivedRootEl).writingMode,s=e.left+this.host.derivedRootEl.clientWidth,a=e.top+this.host.derivedRootEl.clientHeight;if(o.startsWith("vertical")){let h=Math.max(i.bottom,a);i=DOMRect.fromRect({x:i.left,y:i.top,width:i.width,height:Math.max(1,h-i.top)})}else{let h=Math.max(i.right,s);i=DOMRect.fromRect({x:i.left,y:i.top,width:Math.max(1,h-i.left),height:i.height})}let l=i.left-e.left+this.host.derivedRootEl.scrollLeft,c=i.top-e.top+this.host.derivedRootEl.scrollTop,u=Math.max(1,i.width),d=Math.max(1,i.height);this.host.plainEditOverlayEl.style.left=`${l}px`,this.host.plainEditOverlayEl.style.top=`${c}px`,this.host.plainEditOverlayEl.style.width=`${u}px`,this.host.plainEditOverlayEl.style.height=`${d}px`,this.host.plainEditOverlayBaseRect={left:l,top:c,width:u,height:d},this.adjustOverlaySize()}startFromSelection(){var r,o;if(!this.host.sourceModeEnabled||this.host.plainEditCommitting||!this.host.derivedRootEl||!this.host.plainEditOverlayEl)return;let t=this.getRangeFromSelection();if(!t)return;if(this.host.plainEditRange&&this.host.plainEditRange.startLine===t.startLine&&this.host.plainEditRange.endLine===t.endLine&&this.host.plainEditRange.from===t.from&&this.host.plainEditRange.to===t.to){this.host.plainEditComposing||this.host.plainEditOverlayEl.setSelectionRange(t.selectionStart,t.selectionEnd),this.updateOverlayPosition(t);return}this.host.plainEditRange&&this.commit(!0,!1);let i=((o=(r=this.host.sotEditor)==null?void 0:r.getDoc())!=null?o:"").slice(t.from,t.to);this.host.plainEditOverlayEl.value=i,this.host.plainEditOverlayEl.style.display="",this.host.plainEditOverlayEl.focus({preventScroll:!0}),this.host.plainEditComposing||this.host.plainEditOverlayEl.setSelectionRange(t.selectionStart,t.selectionEnd),this.clearTargets(),this.host.plainEditRange={from:t.from,to:t.to,startLine:t.startLine,endLine:t.endLine,originalText:i},this.applyTargets(t),this.updateOverlayPosition(t)}commit(t,e){var i,r,o;if(!this.host.plainEditCommitting&&!(!this.host.plainEditRange||!this.host.plainEditOverlayEl||!this.host.sotEditor)){this.host.plainEditCommitting=!0;try{let s=this.host.plainEditRange,a=(i=this.host.plainEditOverlayEl.value)!=null?i:"",l=(r=this.host.plainEditOverlayEl.selectionStart)!=null?r:a.length,c=(o=this.host.plainEditOverlayEl.selectionEnd)!=null?o:l,u=this.host.sotEditor.getSelection(),d=Math.min(u.anchor,u.head),h=Math.max(u.anchor,u.head),p=d>=s.from&&h<=s.to,f=e&&p;if(t&&a!==s.originalText&&this.host.sotEditor.replaceRange(s.from,s.to,a),f){let g=this.host.sotEditor.getDoc().length,m=Math.max(0,Math.min(s.from+l,g)),b=Math.max(0,Math.min(s.from+c,g));this.host.setSelectionNormalized(m,b)}this.clearTargets(),this.host.plainEditRange=null,this.host.plainEditOverlayEl.style.display="none"}finally{this.host.plainEditCommitting=!1}}}registerOutsidePointerHandler(){this.host.plainEditOutsidePointerHandler||(this.host.plainEditOutsidePointerHandler=t=>{var i;if(!this.host.sourceModeEnabled||!this.host.plainEditOverlayEl)return;let e=t.target;e&&(this.host.plainEditOverlayEl.contains(e)||(i=this.host.derivedRootEl)!=null&&i.contains(e)&&this.commit(!0,!1))},document.addEventListener("pointerdown",this.host.plainEditOutsidePointerHandler,!0))}unregisterOutsidePointerHandler(){this.host.plainEditOutsidePointerHandler&&(document.removeEventListener("pointerdown",this.host.plainEditOutsidePointerHandler,!0),this.host.plainEditOutsidePointerHandler=null)}};var Se=require("obsidian");var ti=require("@codemirror/state"),IE=require("@codemirror/view"),wl=require("@codemirror/commands"),kl=class{constructor(t){this.listeners=new Set;this.updateCompartment=new ti.Compartment;var i;let e=(i=t.editor)==null?void 0:i.cm;if(!e){this.view=null;return}this.view=e,this.attachUpdateListener()}getDoc(){return this.view?this.view.state.doc.toString():""}setDoc(t){if(!this.view)return;let e=this.view.state.doc.length,i=Math.max(0,t.length);this.view.dispatch({changes:{from:0,to:e,insert:t},selection:ti.EditorSelection.single(i,i),scrollIntoView:!1})}getSelection(){if(!this.view)return{anchor:0,head:0};let t=this.view.state.selection.main;return{anchor:t.anchor,head:t.head}}setSelection(t){if(!this.view)return;let e=this.view.state.doc.length,i=Math.max(0,Math.min(t.anchor,e)),r=Math.max(0,Math.min(t.head,e));this.view.dispatch({selection:ti.EditorSelection.single(i,r),scrollIntoView:!1})}getEditorView(){return this.view}replaceRange(t,e,i){if(!this.view)return;let r=this.view.state.doc.length,o=Math.max(0,Math.min(t,r)),s=Math.max(o,Math.min(e,r)),a=o+i.length;this.view.dispatch({changes:{from:o,to:s,insert:i},selection:ti.EditorSelection.single(a,a),scrollIntoView:!1})}undo(){this.view&&(0,wl.undo)(this.view)}redo(){this.view&&(0,wl.redo)(this.view)}onUpdate(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}destroy(){this.listeners.clear(),this.view&&this.view.dispatch({effects:this.updateCompartment.reconfigure([])}),this.view=null}attachUpdateListener(){if(!this.view)return;let t=IE.EditorView.updateListener.of(e=>{if(!e.docChanged&&!e.selectionSet)return;let i;e.docChanged&&(i=[],e.changes.iterChanges((o,s,a,l,c)=>{i==null||i.push({from:o,to:s,fromB:a,toB:l,insert:c.toString()})}));let r={docChanged:e.docChanged,selectionChanged:e.selectionSet,changes:i};for(let o of this.listeners)o(r)});this.view.dispatch({effects:ti.StateEffect.appendConfig.of([this.updateCompartment.of(t)])})}};var NE="tategaki-paired-tab-badge",Ph="tategaki-paired-tab-badge-icon",_h="tategaki-paired-tab-badge-text",PE="\u7E26",_E="Tategaki\u7DE8\u96C6\u4E2D",xN="tategaki-sot-tab-badge",OE="Tategaki SoT",DE=50,Sl=class{constructor(t){this.escapeKeymapHandler=null;this.host=t}async openFile(t){this.host.showLoadingOverlay();let e=await this.ensureMarkdownViewForFile(t);if(!e){new Se.Notice("MarkdownView \u304C\u898B\u3064\u304B\u3089\u306A\u3044\u305F\u3081\u9589\u3058\u307E\u3059\u3002",2500),this.host.closeSelf();return}if(!this.verifyPairedMarkdownViewFile(e,t)){this.host.closeSelf();return}this.host.currentFile=t,this.recordRecentFile(t),this.host.updateToolbar(),this.host.attachSoTEditor(new kl(e)),this.host.scheduleRender(!0)}registerWorkspacePairGuards(){let t=()=>{this.ensurePairedMarkdownView(),this.applySoTTabBadge()};t(),this.host.registerEvent(this.host.app.workspace.on("file-open",e=>{this.recordRecentFile(e),t()})),this.host.registerEvent(this.host.app.workspace.on("active-leaf-change",()=>t())),this.host.registerEvent(this.host.app.workspace.on("layout-change",t))}registerEscapeGuard(){var r,o;let t=(r=this.host.containerEl.ownerDocument)!=null?r:document,e=(o=t.defaultView)!=null?o:window,i=s=>{var u,d;if(s.key!=="Escape"||!this.isLeafActive())return;let a=t.activeElement,l=s.target;if(this.isInModalLayer(a)||this.isInModalLayer(l))return;this.host.plainEditComposing||(d=(u=this.host.overlayTextarea)==null?void 0:u.isImeVisible())!=null&&d||s.isComposing||s.preventDefault(),typeof s.stopImmediatePropagation=="function"&&s.stopImmediatePropagation(),s.stopPropagation(),this.host.focusInputSurface(!0)};e.addEventListener("keydown",i,!0),e.addEventListener("keyup",i,!0),this.host.register(()=>{e.removeEventListener("keydown",i,!0),e.removeEventListener("keyup",i,!0)})}registerEscapeKeymap(){!this.host.scope||this.escapeKeymapHandler||(this.escapeKeymapHandler=this.host.scope.register(null,"Escape",t=>{var s,a,l;if(!this.isLeafActive())return;let i=((s=this.host.containerEl.ownerDocument)!=null?s:document).activeElement,r=t.target;return this.isInModalLayer(i)||this.isInModalLayer(r)?void 0:(this.host.plainEditComposing||(l=(a=this.host.overlayTextarea)==null?void 0:a.isImeVisible())!=null&&l||t.isComposing||t.preventDefault(),typeof t.stopImmediatePropagation=="function"&&t.stopImmediatePropagation(),t.stopPropagation(),this.host.focusInputSurface(!0),!1)}),this.host.register(()=>{this.host.scope&&this.escapeKeymapHandler&&this.host.scope.unregister(this.escapeKeymapHandler),this.escapeKeymapHandler=null}))}isLeafActive(){return this.host.app.workspace.activeLeaf===this.host.leaf}isInModalLayer(t){return t?!!t.closest(".modal, .prompt, .suggestion-container, .menu, .popover"):!1}getValidPairedMarkdownLeaf(){return!this.host.pairedMarkdownLeaf||!this.host.app.workspace.getLeavesOfType("markdown").includes(this.host.pairedMarkdownLeaf)||!(this.host.pairedMarkdownLeaf.view instanceof Se.MarkdownView)?null:this.host.pairedMarkdownLeaf}ensureRecentFilePathsInitialized(){if(this.host.recentFilePathsInitialized)return;this.host.recentFilePathsInitialized=!0;let t=this.host.app.workspace.getLastOpenFiles();for(let e of t){let i=this.host.app.vault.getAbstractFileByPath(e);i instanceof Se.TFile&&i.extension==="md"&&this.pushRecentFilePath(i.path,!1)}}pushRecentFilePath(t,e=!0){let i=t.trim();if(!i)return;let r=this.host.recentFilePaths.indexOf(i);r===0&&e||(r>=0&&this.host.recentFilePaths.splice(r,1),e?this.host.recentFilePaths.unshift(i):this.host.recentFilePaths.push(i),this.host.recentFilePaths.length>DE&&(this.host.recentFilePaths.length=DE))}recordRecentFile(t){t&&t.extension==="md"&&(this.ensureRecentFilePathsInitialized(),this.pushRecentFilePath(t.path,!0))}buildFileSwitchItems(){let t=this.host.app.vault.getMarkdownFiles();if(t.length===0)return[];this.ensureRecentFilePathsInitialized();let e=new Map;for(let o of t)e.set(o.path,o);let i=[],r=new Set;for(let o of this.host.recentFilePaths){let s=e.get(o);s&&(i.push(s),r.add(o))}for(let o of t)r.has(o.path)||i.push(o);return i}openFileSwitcher(){let t=this.buildFileSwitchItems();new Er(this.host.app,t,i=>{this.switchToFile(i)},i=>{this.openNewNoteModal(i)}).open(),t.length===0&&new Se.Notice("\u5207\u308A\u66FF\u3048\u53EF\u80FD\u306A\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2e3)}openNewNoteModal(t=""){var r,o,s;let e=(s=(o=(r=this.host.currentFile)==null?void 0:r.parent)==null?void 0:o.path)!=null?s:"";new xr(this.host.app,{defaultFolder:e,initialValue:t},a=>{this.createNewNote(a,e)}).open()}async createNewNote(t,e){let i=t.trim();if(!i){new Se.Notice("\u30D5\u30A1\u30A4\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2e3);return}let r=i.replace(/^[\\/]+/,"").replace(/^\.\//,""),s=r.toLowerCase().endsWith(".md")?r:`${r}.md`,a=e?`${e}/${s}`:s,l=(0,Se.normalizePath)(a),c=this.host.app.vault.getAbstractFileByPath(l);if(c instanceof Se.TFile){new Se.Notice("\u65E2\u5B58\u30CE\u30FC\u30C8\u3092\u958B\u304D\u307E\u3059\u3002",2e3),await this.switchToFile(c);return}let u=l.split("/").slice(0,-1).join("/");if(u){let d=this.host.app.vault.getAbstractFileByPath(u);if(d){if(!(d instanceof Se.TFolder)){new Se.Notice("\u30D5\u30A9\u30EB\u30C0\u540D\u304C\u4E0D\u6B63\u3067\u3059\u3002",2500);return}}else try{await this.host.app.vault.createFolder(u)}catch(h){console.error("[Tategaki SoT] Failed to create folder",h),new Se.Notice("\u30D5\u30A9\u30EB\u30C0\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500);return}}try{let d=await this.host.app.vault.create(l,"");await this.switchToFile(d)}catch(d){console.error("[Tategaki SoT] Failed to create note",d),new Se.Notice("\u65B0\u898F\u30CE\u30FC\u30C8\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}async switchToFile(t){var i;if(((i=this.host.currentFile)==null?void 0:i.path)===t.path){new Se.Notice("\u65E2\u306B\u8868\u793A\u4E2D\u306E\u30D5\u30A1\u30A4\u30EB\u3067\u3059\u3002",1500);return}let e=this.getValidPairedMarkdownLeaf();if(!e){new Se.Notice("\u30DA\u30A2\u306EMarkdownView\u304C\u898B\u3064\u304B\u3089\u306A\u3044\u305F\u3081\u5207\u308A\u66FF\u3048\u3067\u304D\u307E\u305B\u3093\u3002",2500);return}this.host.suppressPairCheck=!0;try{await e.openFile(t,{active:!1,state:{mode:"source"}});let r=this.host.leaf;await r.setViewState({type:"empty",active:!1}),await this.host.plugin.modeManager.openSoTWysiwygViewInLeaf(t,r)}catch(r){this.host.suppressPairCheck=!1,console.error("[Tategaki SoT] Failed to switch file",r),new Se.Notice("\u30D5\u30A1\u30A4\u30EB\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}async ensureMarkdownViewForFile(t){var r,o,s;if(this.host.pairedMarkdownView&&((r=this.host.pairedMarkdownView.file)==null?void 0:r.path)===t.path)return this.host.pairedMarkdownLeaf&&this.applyPairedMarkdownBadge(this.host.pairedMarkdownLeaf,this.host.pairedMarkdownView),this.host.pairedMarkdownView;let e=this.findMarkdownLeafForFile(t.path);if(e){let a=e.view;if(a instanceof Se.MarkdownView)return(o=a.editor)!=null&&o.cm?(this.host.pairedMarkdownLeaf=e,this.host.pairedMarkdownView=a,this.applyPairedMarkdownBadge(e,a),a):null}let i=this.host.app.workspace.getLeaf("tab");return await i.openFile(t,{active:!1,state:{mode:"source"}}),i.view instanceof Se.MarkdownView&&(s=i.view.editor)!=null&&s.cm?(this.host.pairedMarkdownLeaf=i,this.host.pairedMarkdownView=i.view,this.applyPairedMarkdownBadge(i,i.view),i.view):null}findMarkdownLeafForFile(t){var i;let e=this.host.app.workspace.getLeavesOfType("markdown");for(let r of e){let o=r.view;if(o instanceof Se.MarkdownView&&((i=o.file)==null?void 0:i.path)===t)return r}return null}ensurePairedMarkdownView(){if(this.host.suppressPairCheck||!this.host.currentFile||!this.host.pairedMarkdownLeaf)return;if(!this.host.app.workspace.getLeavesOfType("markdown").includes(this.host.pairedMarkdownLeaf)){this.clearPairedMarkdownBadge(),this.host.closeSelf();return}let e=this.host.pairedMarkdownLeaf.view;if(!(e instanceof Se.MarkdownView)){this.clearPairedMarkdownBadge(),this.host.closeSelf();return}if(!this.verifyPairedMarkdownViewFile(e,this.host.currentFile)){this.clearPairedMarkdownBadge(),this.host.closeSelf();return}this.host.pairedMarkdownView=e,this.applyPairedMarkdownBadge(this.host.pairedMarkdownLeaf,e)}verifyPairedMarkdownViewFile(t,e){var i;return((i=t.file)==null?void 0:i.path)===e.path?(this.host.pairedMismatchNotified=!1,!0):(this.host.pairedMismatchNotified||(this.host.pairedMismatchNotified=!0,new Se.Notice("\u30DA\u30A2\u306EMarkdownView\u304C\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u3068\u4E00\u81F4\u3057\u306A\u3044\u305F\u3081\u9589\u3058\u307E\u3059\u3002",2500)),!1)}applyPairedMarkdownBadge(t,e){var l,c;let i=this.getLeafTabHeaderEl(t),r=(l=i?this.getTabHeaderTitleHost(i):null)!=null?l:this.getViewHeaderTitleHost(e.containerEl);if(!r||this.host.pairedMarkdownBadgeLeaf===t&&this.host.pairedMarkdownBadgeEl&&this.host.pairedMarkdownBadgeEl.isConnected)return;this.clearPairedMarkdownBadge();let o=r.querySelector(`.${NE}`),s=(c=r.ownerDocument)!=null?c:document,a=o!=null?o:s.createElement("span");if(o||(a.className=NE,r.appendChild(a)),a.setAttribute("aria-label",_E),a.setAttribute("title",_E),!a.querySelector(`.${Ph}`)){let u=s.createElement("span");u.className=Ph,a.appendChild(u),(0,Se.setIcon)(u,"user-round-pen")}if(!a.querySelector(`.${_h}`)){let u=s.createElement("span");u.className=_h,u.textContent=PE,a.appendChild(u)}(a.parentElement!==r||r.firstChild!==a)&&r.insertBefore(a,r.firstChild),this.host.pairedMarkdownBadgeLeaf=t,this.host.pairedMarkdownBadgeEl=a}clearPairedMarkdownBadge(){var t;(t=this.host.pairedMarkdownBadgeEl)!=null&&t.isConnected&&this.host.pairedMarkdownBadgeEl.remove(),this.host.pairedMarkdownBadgeLeaf=null,this.host.pairedMarkdownBadgeEl=null}applySoTTabBadge(){var a,l,c;let t=this.getLeafTabHeaderEl(this.host.leaf),e=(a=t?this.getTabHeaderTitleHost(t):null)!=null?a:this.getViewHeaderTitleHost(this.host.containerEl);if(!e||(l=this.host.sotTabBadgeEl)!=null&&l.isConnected)return;this.clearSoTTabBadge();let i=(c=e.ownerDocument)!=null?c:document,r=i.createElement("span");r.className=xN,r.setAttribute("aria-label",OE),r.setAttribute("title",OE);let o=i.createElement("span");o.className=Ph,r.appendChild(o),(0,Se.setIcon)(o,"user-round-pen");let s=i.createElement("span");s.className=_h,s.textContent=PE,r.appendChild(s),e.insertBefore(r,e.firstChild),this.host.sotTabBadgeEl=r}clearSoTTabBadge(){var t;(t=this.host.sotTabBadgeEl)!=null&&t.isConnected&&this.host.sotTabBadgeEl.remove(),this.host.sotTabBadgeEl=null}getLeafTabHeaderEl(t){var l,c,u,d,h,p;let e=t,i=e==null?void 0:e.tabHeaderEl;if(i instanceof HTMLElement)return i;let r=(l=e==null?void 0:e.tabHeader)==null?void 0:l.el;if(r instanceof HTMLElement)return r;let o=(c=e==null?void 0:e.containerEl)!=null?c:void 0,s=(h=(u=e==null?void 0:e.id)!=null?u:o==null?void 0:o.getAttribute("data-id"))!=null?h:(d=o==null?void 0:o.dataset)==null?void 0:d.id,a=(p=o==null?void 0:o.ownerDocument)!=null?p:document;if(s){let f=a.querySelector(`.workspace-tab-header[data-id="${s}"]`);if(f)return f;let g=a.querySelector(`.workspace-tab-header[data-leaf-id="${s}"]`);if(g)return g}return null}getTabHeaderTitleHost(t){var e,i;return(i=(e=t.querySelector(".workspace-tab-header-inner-title"))!=null?e:t.querySelector(".workspace-tab-header-inner"))!=null?i:t}getViewHeaderTitleHost(t){var i;let e=t.querySelector(".view-header-title");return e?(i=e.parentElement)!=null?i:e:null}};var Oh=require("obsidian"),Ml=class{constructor(){this.lineDecorationCache=new Map;this.lineSegmentCache=new Map}shouldUseLineCache(){return!(Oh.Platform.isMobile||Oh.Platform.isMobileApp)}clear(){this.lineDecorationCache.clear(),this.lineSegmentCache.clear()}getCachedBlockLineDecoration(t,e,i,r,o){if(!this.shouldUseLineCache()||t===null)return o();let s=this.lineDecorationCache.get(t);if(s&&s.from===e&&s.to===i&&s.text===r)return s.decoration;let a=o();return this.lineDecorationCache.set(t,{from:e,to:i,text:r,decoration:a}),a}getCachedSegments(t,e,i,r,o,s,a,l){if(!this.shouldUseLineCache()||t===null)return null;let c=this.lineSegmentCache.get(t);return c&&c.from===e&&c.to===i&&c.text===r&&c.kind===o&&c.codeLang===s&&c.isSource===a&&c.rubyEnabled===l?c.segments:null}storeSegments(t,e,i,r,o,s,a,l,c){!this.shouldUseLineCache()||t===null||this.lineSegmentCache.set(t,{from:e,to:i,text:r,kind:o,codeLang:s,isSource:a,rubyEnabled:l,segments:c})}purgeLineCaches(t,e,i){if(!this.shouldUseLineCache()||i<=0)return;let r=64,o=Math.max(0,t-r),s=Math.min(i-1,e+r),a=c=>c>=o&&c<=s,l=c=>{for(let u of Array.from(c.keys()))a(u)||c.delete(u)};l(this.lineDecorationCache),l(this.lineSegmentCache)}};var Sr=require("obsidian");var Wt=require("obsidian");function FE(n,t,e,i){let r=n.getDoc();if(!r||i===null)return;let o=n.lineMathBlockStart[i],s=n.lineMathBlockEnd[i];if(o===null||s===null||o<0||s<o||s>=n.lineRanges.length){let m=document.createElement("div");m.className="tategaki-md-math-widget-loading",m.textContent="\u6570\u5F0F\u30D6\u30ED\u30C3\u30AF\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(m);return}if(i!==o){let m=document.createElement("span");m.className="tategaki-sot-eol",m.dataset.offset=String(e.to),m.textContent="\u200B",t.appendChild(m);return}let a=document.createElement("div");a.className="tategaki-md-math-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-math-widget-loading",l.textContent="\u6570\u5F0F\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-math-widget-content",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=n.lineRanges[o],h=n.lineRanges[s];if(!d||!h){l.textContent="\u6570\u5F0F\u30D6\u30ED\u30C3\u30AF\u7BC4\u56F2\u304C\u4E0D\u6B63\u3067\u3059\u3002";return}let p=r.slice(d.from,h.to),f=n.getSourcePath(),g=new Wt.MarkdownRenderChild(c);n.addChild(g),n.mathRenderChildren.set(o,g),Wt.MarkdownRenderer.render(n.app,p,c,f,g).then(()=>{t.isConnected&&l.remove()}).catch(()=>{t.isConnected&&(l.textContent="\u6570\u5F0F\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function HE(n,t,e,i){var m;let r=n.getDoc();if(!r||i===null)return;let o=n.lineCalloutBlockStart[i],s=n.lineCalloutBlockEnd[i];if(o===null||s===null||o<0||s<o||s>=n.lineRanges.length){let b=document.createElement("div");b.className="tategaki-md-callout-widget-loading",b.textContent="\u30B3\u30FC\u30EB\u30A2\u30A6\u30C8\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(b);return}if(i!==o){let b=document.createElement("span");b.className="tategaki-sot-eol",b.dataset.offset=String(e.to),b.textContent="\u200B",t.appendChild(b);return}let a=document.createElement("div");a.className="tategaki-md-callout-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-callout-widget-loading",l.textContent="\u30B3\u30FC\u30EB\u30A2\u30A6\u30C8\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-callout-widget-content markdown-rendered",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=[];for(let b=o;b<=s;b+=1){let y=n.lineRanges[b];y&&d.push(r.slice(y.from,y.to))}let h=d.join(`
`),p=n.getSourcePath(),f=(m=t.dataset.calloutRange)!=null?m:"",g=new Wt.MarkdownRenderChild(c);n.addChild(g),n.calloutRenderChildren.set(i,g),Wt.MarkdownRenderer.render(n.app,h,c,p,g).then(()=>{var b;t.isConnected&&((b=t.dataset.calloutRange)!=null?b:"")===f&&l.remove()}).catch(()=>{var b;t.isConnected&&((b=t.dataset.calloutRange)!=null?b:"")===f&&(l.textContent="\u30B3\u30FC\u30EB\u30A2\u30A6\u30C8\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function zE(n,t,e,i){var m;let r=n.getDoc();if(!r||i===null)return;let o=n.lineTableBlockStart[i],s=n.lineTableBlockEnd[i];if(o===null||s===null||o<0||s<o||s>=n.lineRanges.length){let b=document.createElement("div");b.className="tategaki-md-table-widget-loading",b.textContent="\u30C6\u30FC\u30D6\u30EB\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(b);return}if(i!==o){let b=document.createElement("span");b.className="tategaki-sot-eol",b.dataset.offset=String(e.to),b.textContent="\u200B",t.appendChild(b);return}let a=document.createElement("div");a.className="tategaki-md-table-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-table-widget-loading",l.textContent="\u30C6\u30FC\u30D6\u30EB\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-table-widget-content markdown-rendered",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=[];for(let b=o;b<=s;b+=1){let y=n.lineRanges[b];y&&d.push(r.slice(y.from,y.to))}let h=d.join(`
`),p=n.getSourcePath(),f=(m=t.dataset.tableRange)!=null?m:"",g=new Wt.MarkdownRenderChild(c);n.addChild(g),n.tableRenderChildren.set(i,g),Wt.MarkdownRenderer.render(n.app,h,c,p,g).then(()=>{var b;t.isConnected&&((b=t.dataset.tableRange)!=null?b:"")===f&&l.remove()}).catch(()=>{var b;t.isConnected&&((b=t.dataset.tableRange)!=null?b:"")===f&&(l.textContent="\u30C6\u30FC\u30D6\u30EB\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function VE(n,t,e,i){var m;let r=n.getDoc();if(!r||i===null)return;let o=n.lineDeflistBlockStart[i],s=n.lineDeflistBlockEnd[i];if(o===null||s===null||o<0||s<o||s>=n.lineRanges.length){let b=document.createElement("div");b.className="tategaki-md-deflist-widget-loading",b.textContent="\u5B9A\u7FA9\u30EA\u30B9\u30C8\u306E\u89E3\u6790\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",t.appendChild(b);return}if(i!==o){let b=document.createElement("span");b.className="tategaki-sot-eol",b.dataset.offset=String(e.to),b.textContent="\u200B",t.appendChild(b);return}let a=document.createElement("div");a.className="tategaki-md-deflist-widget-inner",t.appendChild(a);let l=document.createElement("div");l.className="tategaki-md-deflist-widget-loading",l.textContent="\u5B9A\u7FA9\u30EA\u30B9\u30C8\u3092\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u4E2D\u2026",a.appendChild(l);let c=document.createElement("div");c.className="tategaki-md-deflist-widget-content markdown-rendered",a.appendChild(c);let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u);let d=[];for(let b=o;b<=s;b+=1){let y=n.lineRanges[b];y&&d.push(r.slice(y.from,y.to))}let h=d.join(`
`),p=n.getSourcePath(),f=(m=t.dataset.deflistRange)!=null?m:"",g=new Wt.MarkdownRenderChild(c);n.addChild(g),n.deflistRenderChildren.set(i,g),Wt.MarkdownRenderer.render(n.app,h,c,p,g).then(()=>{var b;t.isConnected&&((b=t.dataset.deflistRange)!=null?b:"")===f&&l.remove()}).catch(()=>{var b;t.isConnected&&((b=t.dataset.deflistRange)!=null?b:"")===f&&(l.textContent="\u5B9A\u7FA9\u30EA\u30B9\u30C8\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function $E(n,t,e){var u,d,h;let i=((u=t.dataset.imageSrc)!=null?u:"").trim(),r=((d=t.dataset.imageAlt)!=null?d:"").trim(),o=((h=t.dataset.imageWidth)!=null?h:"").trim(),s=document.createElement("span");s.className="tategaki-md-image-widget-inner",t.appendChild(s);let a=document.createElement("img");a.className="tategaki-md-image-widget-img",a.loading="lazy",a.alt=r;let l=wN(n,i);if(l?a.src=l:a.src=i,/^\d+$/.test(o)&&(a.style.maxWidth=`${o}px`,a.style.maxHeight=`${o}px`),s.appendChild(a),r.length>0){let p=document.createElement("span");p.className="tategaki-md-image-widget-caption",p.textContent=r,s.appendChild(p)}let c=document.createElement("span");c.className="tategaki-sot-eol",c.dataset.offset=String(e.to),c.textContent="\u200B",t.appendChild(c)}function WE(n,t,e,i){var g,m,b;let r=((g=t.dataset.embedTarget)!=null?g:"").trim(),o=document.createElement("div");o.className="tategaki-md-embed-widget-inner markdown-embed",t.appendChild(o);let s=document.createElement("div");s.className="tategaki-md-embed-widget-loading",s.textContent="\u57CB\u3081\u8FBC\u307F\u3092\u8AAD\u307F\u8FBC\u307F\u4E2D\u2026",o.appendChild(s);let a=document.createElement("div");a.className="tategaki-md-embed-widget-content",o.appendChild(a);let l=document.createElement("span");if(l.className="tategaki-sot-eol",l.dataset.offset=String(e.to),l.textContent="\u200B",t.appendChild(l),!r){s.textContent="\u57CB\u3081\u8FBC\u307F\u5148\u304C\u7A7A\u3067\u3059\u3002";return}let c=n.getSourcePath(),u=kN(r);if(!u){s.textContent=`\u57CB\u3081\u8FBC\u307F\u306E\u5F62\u5F0F\u304C\u4E0D\u6B63\u3067\u3059: ${r}`;return}let d=n.app.metadataCache.getFirstLinkpathDest(u.linkpath,c);if(!d){s.textContent=`\u57CB\u3081\u8FBC\u307F\u5148\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${u.linkpath}`;return}let h=n.app.metadataCache.getFileCache(d);if(u.heading&&!((m=h==null?void 0:h.headings)!=null?m:[]).some(v=>BE(v.heading)===BE(u.heading))){s.textContent=`\u898B\u51FA\u3057\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${u.heading}`;return}if(u.blockId){let y=(b=h==null?void 0:h.blocks)!=null?b:{};if(!(y[u.blockId]||y[`^${u.blockId}`])){s.textContent=`\u30D6\u30ED\u30C3\u30AF\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${u.blockId}`;return}}let p=`![[${r}]]`,f=new Wt.MarkdownRenderChild(a);n.addChild(f),i!==null&&n.embedRenderChildren.set(i,f),Wt.MarkdownRenderer.render(n.app,p,a,c,f).then(()=>{var y;t.isConnected&&((y=t.dataset.embedTarget)!=null?y:"").trim()===r&&s.remove()}).catch(()=>{var y;t.isConnected&&((y=t.dataset.embedTarget)!=null?y:"").trim()===r&&(s.textContent="\u57CB\u3081\u8FBC\u307F\u306E\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}function kN(n){var c,u;let t=n.trim();if(!t)return null;let e=(u=(c=t.split("|",1)[0])==null?void 0:c.trim())!=null?u:"";if(!e)return null;let i=null,r=e,o=r.lastIndexOf("^");o>=0&&o+1<r.length&&(i=r.slice(o+1).trim()||null,r=r.slice(0,o));let s=r,a=null,l=r.indexOf("#");return l>=0?(s=r.slice(0,l).trim(),a=r.slice(l+1).trim()||null):s=r.trim(),s?{linkpath:s,heading:a,blockId:i}:null}function BE(n){return n.replace(/\s+/g," ").trim().toLowerCase()}function wN(n,t){let e=t.trim();if(!e)return null;if(/^[a-z][a-z0-9+.-]*:\/\//i.test(e))return e;let i=n.getSourcePath(),r=n.app.metadataCache.getFirstLinkpathDest(e,i);if(!r)return null;try{return n.app.vault.getResourcePath(r)}catch(o){return null}}var Tl=class{constructor(t){this.finishRenderMathTimer=null;this.host=t}dispose(){this.finishRenderMathTimer!==null&&(window.clearTimeout(this.finishRenderMathTimer),this.finishRenderMathTimer=null)}get sotEditor(){var t;return(t=this.host.sotEditor)!=null?t:null}get lineRanges(){return this.host.lineRanges}get frontmatterDetected(){return this.host.frontmatterDetected}get ceImeMode(){return this.host.ceImeMode}get footnoteDefinitionOrder(){return this.host.footnoteDefinitionOrder}get footnoteDefinitionText(){return this.host.footnoteDefinitionText}get currentFile(){var t;return(t=this.host.currentFile)!=null?t:null}get app(){return this.host.app}get embedRenderChildren(){return this.host.embedRenderChildren}get mathRenderChildren(){return this.host.mathRenderChildren}get calloutRenderChildren(){return this.host.calloutRenderChildren}get tableRenderChildren(){return this.host.tableRenderChildren}get deflistRenderChildren(){return this.host.deflistRenderChildren}get pendingSpacerEl(){var t;return(t=this.host.pendingSpacerEl)!=null?t:null}set pendingSpacerEl(t){this.host.pendingSpacerEl=t}isLineInSourceMode(t){return this.host.isLineInSourceMode(t)}applyCeEditableState(t,e){this.host.applyCeEditableState(t,e)}applyCeNonEditableMarkers(t){this.host.applyCeNonEditableMarkers(t)}applyPlainEditTargetClass(t,e){this.host.applyPlainEditTargetClass(t,e)}createLinePrefixElement(t){return this.host.createLinePrefixElement(t)}getCollapsedContentPreview(t,e){return this.host.getCollapsedContentPreview(t,e)}showCollapsePreviewTooltip(t,e){this.host.showCollapsePreviewTooltip(t,e)}hideCollapsePreviewTooltip(){this.host.hideCollapsePreviewTooltip()}getLineText(t){return this.host.getLineText(t)}getTablePipeOffsets(t){return this.host.getTablePipeOffsets(t)}getCachedBlockLineDecoration(t,e,i,r){return this.host.getCachedBlockLineDecoration(t,e,i,r)}buildSegmentsForLine(t,e){return this.host.buildSegmentsForLine(t,e)}getInlineWidgetsForLineRange(t){return this.host.getInlineWidgetsForLineRange(t)}ensureLineRendered(t){var r;if(t.dataset.virtual!=="1")return;let e=Number.parseInt((r=t.dataset.line)!=null?r:"",10);if(!Number.isFinite(e))return;let i=this.lineRanges[e];i&&this.renderLine(t,i,e)}renderLine(t,e,i){var l;if(!this.sotEditor)return;let r=i!=null?i:Number.parseInt((l=t.dataset.line)!=null?l:"",10),o=Number.isFinite(r)&&this.isLineInSourceMode(r);if(Number.isFinite(r)){let c=this.embedRenderChildren.get(r);if(c){try{c.unload()}catch(f){}this.embedRenderChildren.delete(r)}let u=this.mathRenderChildren.get(r);if(u){try{u.unload()}catch(f){}this.mathRenderChildren.delete(r)}let d=this.calloutRenderChildren.get(r);if(d){try{d.unload()}catch(f){}this.calloutRenderChildren.delete(r)}let h=this.tableRenderChildren.get(r);if(h){try{h.unload()}catch(f){}this.tableRenderChildren.delete(r)}let p=this.deflistRenderChildren.get(r);if(p){try{p.unload()}catch(f){}this.deflistRenderChildren.delete(r)}}if(t.removeAttribute("data-virtual"),delete t.dataset.mdKind,delete t.dataset.mdLevel,delete t.dataset.mdDepth,delete t.dataset.headingCollapsed,delete t.dataset.headingFoldable,delete t.dataset.listMarker,delete t.dataset.taskChecked,delete t.dataset.listDepth,delete t.dataset.listBullet,delete t.dataset.codeInfo,delete t.dataset.calloutType,delete t.dataset.calloutRange,delete t.dataset.footnoteId,delete t.dataset.tableHeader,delete t.dataset.tableRange,delete t.dataset.deflistRange,delete t.dataset.imageSrc,delete t.dataset.imageAlt,delete t.dataset.imageWidth,delete t.dataset.embedTarget,delete t.dataset.mathRange,t.style.removeProperty("--tategaki-sot-list-depth"),t.style.removeProperty("--tategaki-sot-blockquote-depth"),this.applyCeEditableState(t,Number.isFinite(r)?r:null),o){t.className="tategaki-sot-line";let c=this.sotEditor.getDoc(),u=e.to>e.from?[{from:e.from,to:e.to,text:c.slice(e.from,e.to),classNames:["tategaki-sot-run"]}]:[];this.renderLineFromSegments(t,e,u),this.applyCeNonEditableMarkers(t),this.applyPlainEditTargetClass(t,Number.isFinite(r)?r:null);return}{let c=this.sotEditor.getDoc(),u=Number.isFinite(r)?r:null,d=c.slice(e.from,e.to),h=this.getCachedBlockLineDecoration(u,e.from,e.to,d);t.className=["tategaki-sot-line",...h.classes].join(" ");for(let[p,f]of Object.entries(h.dataset))t.dataset[p]=f;for(let[p,f]of Object.entries(h.styleVars))t.style.setProperty(p,f)}if(this.frontmatterDetected&&(t.dataset.mdKind==="frontmatter"||t.dataset.mdKind==="frontmatter-fence")){t.classList.add("tategaki-md-frontmatter-hidden"),this.renderLineFromSegments(t,e,[]),this.applyCeNonEditableMarkers(t),this.applyPlainEditTargetClass(t,Number.isFinite(r)?r:null);return}if(t.dataset.mdKind==="heading-hidden"){this.renderLineFromSegments(t,e,[]),this.applyCeNonEditableMarkers(t),this.applyPlainEditTargetClass(t,Number.isFinite(r)?r:null);return}let s=this.buildSegmentsForLine(e.from,e.to),a=this.getInlineWidgetsForLineRange(e);this.renderLineFromSegments(t,e,s,void 0,a),this.applyCeNonEditableMarkers(t),this.applyPlainEditTargetClass(t,Number.isFinite(r)?r:null)}renderLineLight(t,e,i){t.replaceChildren(),t.className="tategaki-sot-line tategaki-sot-line-virtual",t.dataset.virtual="1",this.applyCeEditableState(t,i),this.applyPlainEditTargetClass(t,i);let r=e.to-e.from;if(r>0){let o=document.createElement("span");o.className="tategaki-sot-virtual-placeholder",o.style.setProperty("--placeholder-chars",String(Math.min(r,100))),t.appendChild(o)}}removeRangeFromSegments(t,e,i){let r=Math.min(e,i),o=Math.max(e,i);if(r===o)return t;let s=[];for(let a of t){if(a.to<=r||a.from>=o){s.push(a);continue}if(a.from<r){let l=Math.min(a.to,r),c=l-a.from;c>0&&s.push({from:a.from,to:l,text:a.text.slice(0,c),classNames:a.classNames,href:a.href,ruby:a.ruby})}if(a.to>o){let l=Math.max(a.from,o),c=l-a.from;c<a.text.length&&s.push({from:l,to:a.to,text:a.text.slice(c),classNames:a.classNames,href:a.href,ruby:a.ruby})}}return s}removeRangeFromInlineWidgets(t,e,i){let r=Math.min(e,i),o=Math.max(e,i);return r===o?t:t.filter(s=>s.to<=r||s.from>=o)}splitSegmentsAtOffset(t,e){let i=[],r=[];for(let o of t){if(o.to<=e){i.push(o);continue}if(o.from>=e){r.push(o);continue}let s=Math.max(0,Math.min(e-o.from,o.text.length)),a=o.text.slice(0,s),l=o.text.slice(s);a.length>0&&i.push({from:o.from,to:o.from+a.length,text:a,classNames:o.classNames,href:o.href,ruby:o.ruby}),l.length>0&&r.push({from:o.from+a.length,to:o.to,text:l,classNames:o.classNames,href:o.href,ruby:o.ruby})}return{before:i,after:r}}renderInlineSegmentsWithWidgets(t,e,i,r,o){var m,b;let s=(r!=null?r:[]).filter(y=>y.from>=e.from&&y.from<=e.to&&y.to>=e.from&&y.to<=e.to).slice().sort((y,v)=>y.from-v.from||y.to-v.to),a=y=>{let v=document.createElement("span");if(v.className=y.classNames.join(" "),v.dataset.from=String(y.from-e.from),v.dataset.to=String(y.to-e.from),y.classNames.includes("tategaki-md-footnote-ref")){let E=y.text,x=this.footnoteDefinitionOrder.get(E);v.dataset.footnoteId=E,x!==void 0?v.dataset.footnoteNumber=String(x):delete v.dataset.footnoteNumber;let k=this.footnoteDefinitionText.get(E);k?(v.setAttribute("aria-label",k),v.setAttribute("data-tooltip-position","top")):(v.removeAttribute("aria-label"),v.removeAttribute("data-tooltip-position"))}y.href?v.dataset.href=y.href:delete v.dataset.href,y.ruby?(v.dataset.ruby=y.ruby,v.dataset.aozoraRuby="1"):(delete v.dataset.ruby,delete v.dataset.aozoraRuby),v.textContent=y.text,t.appendChild(v)},l=y=>{if(y.kind!=="math-inline")return;let v=document.createElement("span");v.className="tategaki-md-inline-widget tategaki-md-math-inline-widget",v.dataset.from=String(y.from-e.from),v.dataset.to=String(y.to-e.from),v.dataset.widgetKind=y.kind;try{let E=(0,Sr.renderMath)(y.source,!1);v.appendChild(E),this.scheduleFinishRenderMath()}catch(E){v.textContent=`$${y.source}$`,v.classList.add("is-fallback")}t.appendChild(v)},c=o?Math.max(e.from,Math.min(o.insertOffset,e.to)):null,u=s.map(y=>y.from);c!==null&&u.push(c);let d=this.splitSegmentsAtOffsets(i,Array.from(new Set(u))),h=0,p=0,f=c===null,g=()=>{let y=d[h],v=s[p],E=y?y.from:null,x=v?v.from:null,k=f?null:c,S=null;for(let w of[E,x,k])w!==null&&(S===null||w<S)&&(S=w);return S};for(;;){let y=g();if(y===null)break;if(!f&&c!==null&&y===c){let x=document.createElement("span");x.className="tategaki-sot-pending-spacer",x.textContent=(m=o==null?void 0:o.pendingText)!=null?m:"",t.appendChild(x),this.pendingSpacerEl=x,f=!0;continue}let v=s[p];if(v&&v.from===y){l(v),p+=1;continue}let E=d[h];if(E&&E.from===y){a(E),h+=1;continue}break}for(;p<s.length;p+=1)l(s[p]);for(;h<d.length;h+=1)a(d[h]);if(!f&&c!==null){let y=document.createElement("span");y.className="tategaki-sot-pending-spacer",y.textContent=(b=o==null?void 0:o.pendingText)!=null?b:"",t.appendChild(y),this.pendingSpacerEl=y}}getWidgetRenderContext(){return{app:this.app,getDoc:()=>{var t,e;return(e=(t=this.sotEditor)==null?void 0:t.getDoc())!=null?e:null},getSourcePath:()=>{var t,e;return(e=(t=this.currentFile)==null?void 0:t.path)!=null?e:""},lineRanges:this.host.lineRanges,lineMathBlockStart:this.host.lineMathBlockStart,lineMathBlockEnd:this.host.lineMathBlockEnd,lineCalloutBlockStart:this.host.lineCalloutBlockStart,lineCalloutBlockEnd:this.host.lineCalloutBlockEnd,lineTableBlockStart:this.host.lineTableBlockStart,lineTableBlockEnd:this.host.lineTableBlockEnd,lineDeflistBlockStart:this.host.lineDeflistBlockStart,lineDeflistBlockEnd:this.host.lineDeflistBlockEnd,addChild:t=>this.host.addChild(t),mathRenderChildren:this.mathRenderChildren,calloutRenderChildren:this.calloutRenderChildren,tableRenderChildren:this.tableRenderChildren,deflistRenderChildren:this.deflistRenderChildren,embedRenderChildren:this.embedRenderChildren}}renderLineFromSegments(t,e,i,r,o){var d,h,p,f,g,m,b;t.replaceChildren();let s=(d=t.dataset.mdKind)!=null?d:"",a=this.getWidgetRenderContext();if(s==="image-widget"){$E(a,t,e);return}if(s==="math-widget"){let y=Number.parseInt((h=t.dataset.line)!=null?h:"",10);FE(a,t,e,Number.isFinite(y)?y:null);return}if(s==="math-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(e.to),y.textContent="\u200B",t.appendChild(y);return}if(s==="callout-widget"){let y=Number.parseInt((p=t.dataset.line)!=null?p:"",10);HE(a,t,e,Number.isFinite(y)?y:null);return}if(s==="callout-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(e.to),y.textContent="\u200B",t.appendChild(y);return}if(s==="table-widget"){let y=Number.parseInt((f=t.dataset.line)!=null?f:"",10);zE(a,t,e,Number.isFinite(y)?y:null);return}if(s==="table-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(e.to),y.textContent="\u200B",t.appendChild(y);return}if(s==="deflist-widget"){let y=Number.parseInt((g=t.dataset.line)!=null?g:"",10);VE(a,t,e,Number.isFinite(y)?y:null);return}if(s==="deflist-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(e.to),y.textContent="\u200B",t.appendChild(y);return}if(s==="heading-hidden"){let y=document.createElement("span");y.className="tategaki-sot-eol",y.dataset.offset=String(e.to),y.textContent="\u200B",t.appendChild(y);return}if(s==="embed-widget"){let y=Number.parseInt((m=t.dataset.line)!=null?m:"",10);WE(a,t,e,Number.isFinite(y)?y:null);return}if(s==="table-row"){this.renderTableRowLine(t,e,i,o!=null?o:[],r);return}if(s==="table-sep"){let y=document.createElement("span");y.className="tategaki-md-table-sep-line",y.textContent="\u200B",t.appendChild(y);let v=document.createElement("span");v.className="tategaki-sot-eol",v.dataset.offset=String(e.to),v.textContent="\u200B",t.appendChild(v);return}let l=this.createLinePrefixElement(t);l&&t.appendChild(l),this.renderInlineSegmentsWithWidgets(t,e,i,o!=null?o:[],r);let c=e.from===e.to;if(this.ceImeMode&&c){let y=document.createElement("span");y.className="tategaki-sot-ce-input-placeholder",y.textContent="\u200B",t.appendChild(y)}if(s==="heading"&&t.dataset.headingCollapsed==="1"){let y=document.createElement("span");y.className="tategaki-md-heading-ellipsis",(0,Sr.setIcon)(y,"message-circle-more");let v=Number.parseInt((b=t.dataset.line)!=null?b:"",10);if(Number.isFinite(v)){let E=this.getCollapsedContentPreview(v,3);E&&(y.setAttribute("data-preview",E),y.addEventListener("mouseenter",x=>{this.showCollapsePreviewTooltip(x.target,E)}),y.addEventListener("mouseleave",()=>{this.hideCollapsePreviewTooltip()}))}t.appendChild(y)}let u=document.createElement("span");u.className="tategaki-sot-eol",u.dataset.offset=String(e.to),u.textContent="\u200B",t.appendChild(u)}scheduleFinishRenderMath(){this.finishRenderMathTimer===null&&(this.finishRenderMathTimer=window.setTimeout(()=>{this.finishRenderMathTimer=null,(0,Sr.finishRenderMath)().catch(()=>{})},0))}renderTableRowLine(t,e,i,r,o){let s=this.getLineText(e),l=this.getTablePipeOffsets(s).filter(m=>m>0&&m<Math.max(0,s.length-1)).map(m=>e.from+m+1),c=[e.from,...l,e.to].filter((m,b,y)=>y.indexOf(m)===b).sort((m,b)=>m-b),u=c.slice(1,-1).filter(m=>m>e.from&&m<e.to),d=this.splitSegmentsAtOffsets(i,u),h=this.createLinePrefixElement(t);h&&t.appendChild(h);let p=document.createElement("span");p.className="tategaki-md-table-row-container",t.appendChild(p);let f=0;for(let m=0;m<c.length-1;m+=1){let b=c[m],y=c[m+1];if(y<=b)continue;let v=document.createElement("span");v.className="tategaki-md-table-cell",p.appendChild(v);let E=[];for(;f<d.length;){let S=d[f];if(S.from<b){f+=1;continue}if(S.from>=y)break;E.push(S),f+=1}let x=(r!=null?r:[]).filter(S=>S.from>=b&&S.from<y),k;if(o){let S=Math.max(e.from,Math.min(o.insertOffset,e.to));S>=b&&S<=y&&(k={insertOffset:S,pendingText:o.pendingText})}this.renderInlineSegmentsWithWidgets(v,{from:b,to:y},E,x,k)}let g=document.createElement("span");g.className="tategaki-sot-eol",g.dataset.offset=String(e.to),g.textContent="\u200B",t.appendChild(g)}splitSegmentsAtOffsets(t,e){if(e.length===0)return t;let i=e.filter(s=>Number.isFinite(s)).map(s=>Math.floor(s)).filter((s,a,l)=>l.indexOf(s)===a).sort((s,a)=>s-a),r=t,o=[];for(let s of i){let a=[];for(let l of r){if(l.to<=s||l.from>=s){a.push(l);continue}let c=this.splitSegmentsAtOffset([l],s);c.before.length>0&&o.push(...c.before),c.after.length>0&&a.push(...c.after)}r=a}return o.push(...r),o}};function UE(n){let t=[],e=0;for(let i of n){let r=e,o=e+i.length;t.push({from:r,to:o}),e=o+1}return t}function KE(n){var Me,Be,ye,pe,Fe,rt,Mt,Tt,dt,He,Je,Kt,ne,re,Le,oe,be,qe,Ze,Ct,U,O;let{lines:t,normalizeLinkLabel:e}=n,i=new Set(n.collapsedHeadingLines),r=new Array(t.length).fill("normal"),o=new Array(t.length).fill(null),s=new Array(t.length).fill(null),a=new Array(t.length).fill(null),l=new Array(t.length).fill(null),c=new Array(t.length).fill(null),u=new Array(t.length).fill(null),d=new Array(t.length).fill(!1),h=new Array(t.length).fill(null),p=new Array(t.length).fill(null),f=new Array(t.length).fill(!1),g=new Array(t.length).fill(null),m=new Array(t.length).fill(null),b=new Array(t.length).fill(null),y=new Array(t.length).fill(null),v=new Array(t.length).fill(null),E=new Array(t.length).fill(null),x=new Map,k=new Map,S=new Map,w=!1,C=!1,I=!1,F="",N=null;for(let M=0;M<t.length;M+=1){let D=(Me=t[M])!=null?Me:"";if(!C&&M===0&&D.trim()==="---"){C=!0,w=!0,r[M]="frontmatter-fence";continue}if(w){D.trim()==="---"?(r[M]="frontmatter-fence",w=!1):r[M]="frontmatter";continue}if(I){F.length>0&&D.startsWith(F)?(r[M]="code-fence",s[M]=N,I=!1,F="",N=null):(r[M]="code",s[M]=N);continue}let V=D.match(/^(```+|~~~+)/);if(V&&V[1]){F=V[1],I=!0,r[M]="code-fence";let G=D.slice(F.length).trim();o[M]=G.length>0?G:null,N=G.length>0&&(Be=G.split(/\s+/)[0])!=null?Be:null,s[M]=N;continue}}let H=0;for(let M=0;M<t.length;M+=1){if(r[M]!=="normal")continue;let D=(ye=t[M])!=null?ye:"",V=D.match(/^[ \t]*\[\^([^\]]+)\]:[ \t]*/);if(!V||!V[1])continue;let G=V[1];if(!x.has(G)){H+=1,x.set(G,H);let de=D.slice(V[0].length).trim();de.length>0&&k.set(G,de)}}for(let M=0;M<t.length;M+=1){if(r[M]!=="normal")continue;let V=((pe=t[M])!=null?pe:"").match(/^[ \t]*\[((?:\\.|[^\]])+)\]:[ \t]*([^\s]+)(?:[ \t]+(?:"([^"]+)"|'([^']+)'|\(([^)]+)\)))?[ \t]*$/);if(!V||!V[1]||!V[2])continue;let G=V[1],de=V[2],ve=e(G),We=de.trim();We.startsWith("<")&&We.endsWith(">")&&(We=We.slice(1,-1)),ve&&We&&S.set(ve,We)}for(let M=0;M<t.length;M+=1){let D=(Fe=r[M])!=null?Fe:"normal";if(D!=="code"&&D!=="code-fence")continue;let V=(rt=r[M-1])!=null?rt:"";if(V==="code"||V==="code-fence")continue;let G=M;for(;G<t.length;){let ve=(Mt=r[G])!=null?Mt:"normal";if(ve!=="code"&&ve!=="code-fence")break;G+=1}let de=G-1;if(!(de<M)){if(de===M)a[M]="single";else{a[M]="start";for(let ve=M+1;ve<de;ve+=1)a[ve]="middle";a[de]="end"}M=de}}let _=[],P=!1,L=-1,R=M=>/^\s*\$\$\s*$/.test(M);for(let M=0;M<t.length;M+=1){if(r[M]!=="normal"){P&&(_.push({start:L,end:M-1}),P=!1,L=-1);continue}let D=(Tt=t[M])!=null?Tt:"";if(!P){if(R(D)){P=!0,L=M,r[M]="math-fence";continue}D.match(/^\s*\$\$(.+)\$\$\s*$/)&&(r[M]="math",_.push({start:M,end:M}));continue}if(R(D)){r[M]="math-fence",_.push({start:L,end:M}),P=!1,L=-1;continue}r[M]="math"}P&&L>=0&&_.push({start:L,end:t.length-1});for(let M of _)for(let D=M.start;D<=M.end;D+=1)l[D]=M.start,c[D]=M.end;let T=[],A=null,B=null;for(let M=0;M<t.length;M+=1){if(r[M]!=="normal"){A&&B!==null&&T.push({start:B,end:M-1}),A=null,B=null;continue}let D=(dt=t[M])!=null?dt:"",V=D.match(/^[ \t]{0,3}>[ \t]*\[!([A-Za-z0-9_-]+)\](?:[+-])?[ \t]*(.*)$/);if(V&&V[1]){A&&B!==null&&T.push({start:B,end:M-1}),A=V[1].toLowerCase(),B=M,r[M]="callout-title",u[M]=A,d[M]=!0;continue}if(A){if(/^[ \t]{0,3}>/.test(D)){r[M]="callout",u[M]=A;continue}B!==null&&T.push({start:B,end:M-1}),A=null,B=null}}A&&B!==null&&T.push({start:B,end:t.length-1});for(let M of T)for(let D=M.start;D<=M.end;D+=1)h[D]=M.start,p[D]=M.end;let W=M=>{let D=M.trim();return D.includes("|")?/^(\|?\s*:?-{3,}:?\s*)(\|\s*:?-{3,}:?\s*)+\|?$/.test(D):!1},K=M=>{for(let D=0;D<M.length;D+=1){if(M[D]!=="|")continue;let V=0;for(let G=D-1;G>=0&&M[G]==="\\";G-=1)V+=1;if(V%2===0)return!0}return!1};for(let M=0;M<t.length-1;M+=1){if(r[M]!=="normal"||r[M+1]!=="normal")continue;let D=(He=t[M])!=null?He:"",V=(Je=t[M+1])!=null?Je:"";if(!K(D)||!W(V))continue;r[M]="table-row",f[M]=!0,r[M+1]="table-sep";let G=M+2;for(;G<t.length&&r[G]==="normal";G+=1){let de=(Kt=t[G])!=null?Kt:"";if(de.trim().length===0||!K(de))break;r[G]="table-row"}M=G-1}for(let M=0;M<t.length;M+=1){let D=(ne=r[M])!=null?ne:"normal";if(D!=="table-row"&&D!=="table-sep")continue;let V=(re=r[M-1])!=null?re:"normal";if(V==="table-row"||V==="table-sep")continue;let G=M;for(;G<t.length;){let ve=(Le=r[G])!=null?Le:"normal";if(ve!=="table-row"&&ve!=="table-sep")break;G+=1}let de=G-1;if(!(de<M)){for(let ve=M;ve<=de;ve+=1)g[ve]=M,m[ve]=de;M=de}}let J=[],Z=M=>/^[ \t]*:[ \t]+/.test(M);for(let M=0;M<t.length-1;M+=1){if(r[M]!=="normal"||r[M+1]!=="normal")continue;let D=(oe=t[M])!=null?oe:"",V=(be=t[M+1])!=null?be:"";if(D.trim().length===0||!Z(V))continue;let G=M,de=M+1,ve=M+2;for(;ve<t.length&&r[ve]==="normal";ve+=1){let We=(qe=t[ve])!=null?qe:"";if(We.trim().length===0)break;if(Z(We)){de=ve;continue}let Io=(Ze=t[ve+1])!=null?Ze:"";if(ve+1<t.length&&Z(Io)&&We.trim().length>0){de=ve+1,ve+=1;continue}break}J.push({start:G,end:de});for(let We=G;We<=de;We+=1)r[We]="deflist";M=de}for(let M of J)for(let D=M.start;D<=M.end;D+=1)b[D]=M.start,y[D]=M.end;let ee=[];for(let M=0;M<t.length;M+=1){if(r[M]!=="normal")continue;let V=((Ct=t[M])!=null?Ct:"").match(/^(#{1,6})([ \t]+)(.*)$/);if(!V)continue;let G=(O=(U=V[1])==null?void 0:U.length)!=null?O:1;ee.push({index:M,level:G})}for(let M=0;M<ee.length;M+=1){let D=ee[M],V=t.length-1;for(let G=M+1;G<ee.length;G+=1){let de=ee[G];if(de.level<=D.level){V=de.index-1;break}}v[D.index]=V}if(i.size>0){let M=new Set;for(let D of ee)i.has(D.index)&&M.add(D.index);i=M}for(let M of ee){if(!i.has(M.index))continue;let D=v[M.index];if(!(D===null||D<=M.index))for(let V=M.index+1;V<=D;V+=1)E[V]===null&&(E[V]=M.index)}return{lineBlockKinds:r,lineCodeFenceInfo:o,lineCodeLang:s,lineCodeBlockPart:a,lineMathBlockStart:l,lineMathBlockEnd:c,lineCalloutType:u,lineCalloutIsTitle:d,lineCalloutBlockStart:h,lineCalloutBlockEnd:p,lineTableIsHeader:f,lineTableBlockStart:g,lineTableBlockEnd:m,lineDeflistBlockStart:b,lineDeflistBlockEnd:y,lineHeadingSectionEnd:v,lineHeadingHiddenBy:E,footnoteDefinitionOrder:x,footnoteDefinitionText:k,linkReferenceMap:S,collapsedHeadingLines:i}}var Nn=require("obsidian"),Cl=class{constructor(t,e){this.buttons=[];this.headingButton=null;this.writingModeButton=null;this.readingModeButton=null;this.horizontalRuleButton=null;this.sourceToggleButton=null;this.rubyToggleButton=null;this.ceImeToggleButton=null;this.container=t,this.adapter=e,this.createToolbar()}destroy(){this.container.empty(),this.buttons=[],this.headingButton=null,this.writingModeButton=null,this.readingModeButton=null,this.horizontalRuleButton=null,this.sourceToggleButton=null,this.rubyToggleButton=null,this.ceImeToggleButton=null}update(){this.updateButtonStates()}createToolbar(){if(this.container.empty(),this.container.addClass("contenteditable-toolbar"),this.buttons=[],Nn.Platform.isMobile||Nn.Platform.isMobileApp){if(this.container.addClass("tiptap-toolbar-mobile"),this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: nowrap;
				flex: 1 1 auto;
				min-width: 0;
				width: 100%;
				max-width: 100%;
				overflow-x: auto;
				overflow-y: hidden;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				touch-action: pan-x;
				overscroll-behavior-x: contain;
			`,!document.getElementById("tiptap-toolbar-mobile-scrollbar-style")){let e=document.createElement("style");e.id="tiptap-toolbar-mobile-scrollbar-style",e.textContent=`
					.tiptap-toolbar-mobile::-webkit-scrollbar {
						display: none;
					}
					.tiptap-toolbar-mobile .contenteditable-toolbar-button,
					.tiptap-toolbar-mobile .contenteditable-toolbar-separator {
						flex: 0 0 auto;
					}
				`,document.head.appendChild(e)}}else this.container.style.cssText=`
				display: flex;
				align-items: center;
				gap: 4px;
				padding: 8px;
				background-color: var(--background-secondary);
				border-bottom: 1px solid var(--background-modifier-border);
				flex-wrap: wrap;
				flex: 1 1 auto;
				min-width: 0;
			`;this.createWritingModeButton(),this.createSeparator(),this.adapter.openFileSwitcher&&(this.createFileSwitchButton(),this.createSeparator()),this.adapter.toggleReadingMode&&(this.createReadingModeButton(),this.createSeparator()),this.createUndoRedoButtons(),this.createSeparator(),this.createInlineButtons(),this.createSeparator(),this.createHeadingMenuButton(),this.createSeparator(),this.createListButtons(),this.createSeparator(),this.createInsertButtons(),this.createSeparator(),this.createClearFormattingButton(),this.adapter.toggleRuby&&(this.createSeparator(),this.createRubyToggleButton()),this.createSeparator(),this.createSourceToggleButton(),this.adapter.toggleCeImeMode&&(this.createSeparator(),this.createCeImeToggleButton()),this.adapter.openSettings&&(this.createSeparator(),this.createSettingsButton()),this.adapter.openOutline&&(this.createSeparator(),this.createOutlineButton()),this.updateButtonStates()}createButton(t,e,i,r,o,s,a,l){let c=this.container.createEl("button",{cls:"clickable-icon contenteditable-toolbar-button",attr:{"aria-label":i}});(0,Nn.setIcon)(c,e);let u={id:t,button:c,icon:e,title:i,onClick:r,isActive:o,isDisabled:s,getIcon:a,getTitle:l,currentIcon:e};return this.buttons.push(u),c.addEventListener("click",d=>{if(d.preventDefault(),c.disabled)return;let h=r==null?void 0:r();h&&typeof h.then=="function"?h.finally(()=>this.updateButtonStates()):this.updateButtonStates()}),c}createSeparator(){let t=this.container.createEl("div",{cls:"contenteditable-toolbar-separator"});t.style.cssText=`
			width: 1px;
			height: 24px;
			background-color: var(--background-modifier-border);
			margin: 0 4px;
		`}createWritingModeButton(){this.writingModeButton=this.createButton("writingMode","arrow-down-up","\u66F8\u5B57\u65B9\u5411\u5207\u308A\u66FF\u3048",this.adapter.toggleWritingMode?()=>{var t,e;(e=(t=this.adapter).toggleWritingMode)==null||e.call(t)}:void 0,void 0,()=>!this.adapter.toggleWritingMode)}createFileSwitchButton(){this.createButton("fileSwitch","folder-open","\u30D5\u30A1\u30A4\u30EB\u5207\u66FF",this.adapter.openFileSwitcher,void 0,()=>!this.adapter.openFileSwitcher)}createReadingModeButton(){let t=()=>{var r,o,s;return(s=(o=(r=this.adapter).isReadingMode)==null?void 0:o.call(r))!=null?s:!1},e=()=>t()?"book-open":"book",i=()=>t()?"\u66F8\u7C4D\u30E2\u30FC\u30C9\u3092\u7D42\u4E86":"\u66F8\u7C4D\u30E2\u30FC\u30C9\u3078\u79FB\u52D5";this.readingModeButton=this.createButton("readingMode",e(),i(),this.adapter.toggleReadingMode,t,()=>!this.adapter.toggleReadingMode,e,i)}createUndoRedoButtons(){this.createButton("undo","undo","\u5143\u306B\u623B\u3059",this.adapter.undo,void 0,()=>{var t,e;return!this.adapter.undo||((e=(t=this.adapter).canUndo)==null?void 0:e.call(t))===!1}),this.createButton("redo","redo","\u3084\u308A\u76F4\u3059",this.adapter.redo,void 0,()=>{var t,e;return!this.adapter.redo||((e=(t=this.adapter).canRedo)==null?void 0:e.call(t))===!1})}createInlineButtons(){this.createButton("bold","bold","\u592A\u5B57",this.adapter.toggleBold,this.adapter.isBoldActive,()=>{var t,e,i;return!this.adapter.toggleBold||!((i=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&i)}),this.createButton("italic","italic","\u659C\u4F53",this.adapter.toggleItalic,this.adapter.isItalicActive,()=>{var t,e,i;return!this.adapter.toggleItalic||!((i=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&i)}),this.createButton("strikethrough","strikethrough","\u53D6\u308A\u6D88\u3057\u7DDA",this.adapter.toggleStrikethrough,this.adapter.isStrikethroughActive,()=>{var t,e,i;return!this.adapter.toggleStrikethrough||!((i=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&i)}),this.adapter.toggleUnderline&&this.createButton("underline","underline","\u4E0B\u7DDA",this.adapter.toggleUnderline,this.adapter.isUnderlineActive,()=>{var t,e,i;return!this.adapter.toggleUnderline||!((i=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&i)}),this.createButton("highlight","highlighter","\u30CF\u30A4\u30E9\u30A4\u30C8",this.adapter.toggleHighlight,this.adapter.isHighlightActive,()=>{var t,e,i;return!this.adapter.toggleHighlight||!((i=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&i)}),this.createButton("inlineCode","code","\u30A4\u30F3\u30E9\u30A4\u30F3\u30B3\u30FC\u30C9",this.adapter.toggleInlineCode,this.adapter.isInlineCodeActive,()=>{var t,e,i;return!this.adapter.toggleInlineCode||!((i=(e=(t=this.adapter).hasSelection)==null?void 0:e.call(t))!=null&&i)})}createHeadingMenuButton(){this.headingButton=this.createButton("heading","heading","\u898B\u51FA\u3057",()=>{var o,s,a;if(!this.headingButton||!this.adapter.setHeading)return;let t=new Nn.Menu,e=(a=(s=(o=this.adapter).getHeadingLevel)==null?void 0:s.call(o))!=null?a:0,i={1:"heading-1",2:"heading-2",3:"heading-3",4:"heading-4",5:"heading-5",6:"heading-6"};for(let l=1;l<=6;l+=1)t.addItem(c=>{c.setTitle(`\u898B\u51FA\u3057${l}`).setIcon(i[l]).onClick(()=>{var u,d;(d=(u=this.adapter).setHeading)==null||d.call(u,l)}),e===l&&c.setChecked(!0)});t.addItem(l=>{l.setTitle("\u898B\u51FA\u3057\u89E3\u9664").setIcon("text").onClick(()=>{var c,u;(u=(c=this.adapter).clearHeading)==null||u.call(c)}),e===0&&l.setChecked(!0)});let r=this.headingButton.getBoundingClientRect();t.showAtPosition({x:r.left,y:r.bottom})},()=>{var t,e,i;return((i=(e=(t=this.adapter).getHeadingLevel)==null?void 0:e.call(t))!=null?i:0)>0},()=>!this.adapter.setHeading)}createListButtons(){this.createButton("bulletList","list","\u7B87\u6761\u66F8\u304D\u30EA\u30B9\u30C8",this.adapter.toggleBulletList,this.adapter.isBulletListActive,()=>!this.adapter.toggleBulletList),this.createButton("orderedList","list-ordered","\u756A\u53F7\u4ED8\u304D\u30EA\u30B9\u30C8",this.adapter.toggleOrderedList,this.adapter.isOrderedListActive,()=>!this.adapter.toggleOrderedList),this.createButton("blockquote","quote","\u5F15\u7528",this.adapter.toggleBlockquote,this.adapter.isBlockquoteActive,()=>!this.adapter.toggleBlockquote),this.createButton("codeBlock","code-2","\u30B3\u30FC\u30C9\u30D6\u30ED\u30C3\u30AF",this.adapter.toggleCodeBlock,this.adapter.isCodeBlockActive,()=>!this.adapter.toggleCodeBlock)}createInsertButtons(){this.createButton("link","link","\u30EA\u30F3\u30AF\u633F\u5165",this.adapter.insertLink,void 0,()=>!this.adapter.insertLink),this.createButton("ruby","gem","\u30EB\u30D3\u633F\u5165",this.adapter.insertRuby,void 0,()=>!this.adapter.insertRuby);let t=()=>{var i,r;return((r=(i=this.adapter).getWritingMode)==null?void 0:r.call(i))==="vertical-rl"?"separator-vertical":"separator-horizontal"};this.horizontalRuleButton=this.createButton("horizontalRule",t(),"\u533A\u5207\u308A\u7DDA",this.adapter.insertHorizontalRule,void 0,()=>!this.adapter.insertHorizontalRule,t)}createClearFormattingButton(){this.createButton("clearFormatting","eraser","\u66F8\u5F0F\u30AF\u30EA\u30A2",this.adapter.clearFormatting,void 0,()=>!this.adapter.clearFormatting)}createRubyToggleButton(){this.rubyToggleButton=this.createButton("rubyToggle","eye","\u30EB\u30D3\u8868\u793A\u306E\u30AA\u30F3/\u30AA\u30D5",this.adapter.toggleRuby,()=>{var t,e,i;return(i=(e=(t=this.adapter).isRubyEnabled)==null?void 0:e.call(t))!=null?i:!0},()=>!this.adapter.toggleRuby,()=>{var t,e;return((e=(t=this.adapter).isRubyEnabled)==null?void 0:e.call(t))===!1?"eye-off":"eye"},()=>{var t,e;return((e=(t=this.adapter).isRubyEnabled)==null?void 0:e.call(t))===!1?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3059\u308B":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3059\u308B"})}createSourceToggleButton(){this.sourceToggleButton=this.createButton("sourceMode","file-text","\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6",this.adapter.toggleSourceMode,()=>{var t,e,i;return(i=(e=(t=this.adapter).isSourceMode)==null?void 0:e.call(t))!=null?i:!1},()=>!this.adapter.toggleSourceMode,()=>{var t,e,i;return(i=(e=(t=this.adapter).isSourceMode)==null?void 0:e.call(t))!=null&&i?"file-code":"file-text"},()=>{var t,e,i;return(i=(e=(t=this.adapter).isSourceMode)==null?void 0:e.call(t))!=null&&i?"\u88C5\u98FE\u8868\u793A\u306B\u623B\u3059":"\u30BD\u30FC\u30B9\u30C6\u30AD\u30B9\u30C8\u7DE8\u96C6\u30E2\u30FC\u30C9"})}createCeImeToggleButton(){this.ceImeToggleButton=this.createButton("ceImeMode","toggle-left","CE\u88DC\u52A9(IME)",this.adapter.toggleCeImeMode,()=>{var t,e,i;return(i=(e=(t=this.adapter).isCeImeMode)==null?void 0:e.call(t))!=null?i:!1},()=>!this.adapter.toggleCeImeMode,()=>{var t,e;return(e=(t=this.adapter).isCeImeMode)!=null&&e.call(t)?"toggle-right":"toggle-left"},()=>{var t,e;return(e=(t=this.adapter).isCeImeMode)!=null&&e.call(t)?"CE\u88DC\u52A9(IME)\u3092\u30AA\u30D5\u306B\u3059\u308B":"CE\u88DC\u52A9(IME)\u3092\u30AA\u30F3\u306B\u3059\u308B"})}createSettingsButton(){this.createButton("settings","settings","\u8868\u793A\u8A2D\u5B9A",this.adapter.openSettings,void 0,()=>!this.adapter.openSettings)}createOutlineButton(){this.createButton("outline","list-tree","\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3",this.adapter.openOutline,void 0,()=>!this.adapter.openOutline)}updateButtonStates(){var e,i,r,o,s,a,l,c,u,d;let t=(i=(e=this.adapter).getWritingMode)==null?void 0:i.call(e);if(this.writingModeButton){let h=t==="vertical-rl"?"\u7E26\u66F8\u304D":"\u6A2A\u66F8\u304D";this.writingModeButton.setAttr("aria-label",`${h}\u306B\u5207\u308A\u66FF\u3048`)}if(this.horizontalRuleButton){let h=t==="vertical-rl"?"separator-vertical":"separator-horizontal",p=this.buttons.find(f=>f.button===this.horizontalRuleButton);p&&p.currentIcon!==h&&((0,Nn.setIcon)(this.horizontalRuleButton,h),p.currentIcon=h)}for(let h of this.buttons){let p=(o=(r=h.isActive)==null?void 0:r.call(h))!=null?o:!1,f=(a=(s=h.isDisabled)==null?void 0:s.call(h))!=null?a:!1;h.button.disabled=f,h.button.classList.toggle("is-active",p);let g=(c=(l=h.getTitle)==null?void 0:l.call(h))!=null?c:h.title;g&&h.button.setAttr("aria-label",g);let m=(d=(u=h.getIcon)==null?void 0:u.call(h))!=null?d:h.icon;m&&h.currentIcon!==m&&((0,Nn.setIcon)(h.button,m),h.currentIcon=m)}}};var qE=require("obsidian"),Ll=class{constructor(t){this.adapter=t}show(t){t.preventDefault(),t.stopPropagation();let e=new qE.Menu;this.buildMenu(e),e.showAtPosition({x:t.clientX,y:t.clientY})}buildMenu(t){this.addClipboardSection(t),this.addInlineSection(t),this.addHeadingSection(t),this.addBlockSection(t),this.addInsertSection(t),this.addClearSection(t)}addClipboardSection(t){var r,o,s;let e=!1,i=(s=(o=(r=this.adapter).hasSelection)==null?void 0:o.call(r))!=null?s:!1;this.adapter.cut&&(t.addItem(a=>{a.setTitle("\u5207\u308A\u53D6\u308A").setIcon("scissors").setDisabled(!i).onClick(()=>{var l,c;(c=(l=this.adapter).cut)==null||c.call(l)})}),e=!0),this.adapter.copy&&(t.addItem(a=>{a.setTitle("\u30B3\u30D4\u30FC").setIcon("copy").setDisabled(!i).onClick(()=>{var l,c;(c=(l=this.adapter).copy)==null||c.call(l)})}),e=!0),this.adapter.paste&&(t.addItem(a=>{a.setTitle("\u8CBC\u308A\u4ED8\u3051").setIcon("clipboard-paste").onClick(()=>{var l,c;(c=(l=this.adapter).paste)==null||c.call(l)})}),e=!0),this.adapter.selectAll&&(t.addItem(a=>{a.setTitle("\u3059\u3079\u3066\u9078\u629E").setIcon("select-all").onClick(()=>{var l,c;(c=(l=this.adapter).selectAll)==null||c.call(l)})}),e=!0),e&&t.addSeparator()}addInlineSection(t){var o,s,a;let e=(a=(s=(o=this.adapter).hasSelection)==null?void 0:s.call(o))!=null?a:!1,i=[{title:"\u592A\u5B57",icon:"bold",action:this.adapter.toggleBold,active:this.adapter.isBoldActive},{title:"\u659C\u4F53",icon:"italic",action:this.adapter.toggleItalic,active:this.adapter.isItalicActive},{title:"\u53D6\u308A\u6D88\u3057\u7DDA",icon:"strikethrough",action:this.adapter.toggleStrikethrough,active:this.adapter.isStrikethroughActive},{title:"\u4E0B\u7DDA",icon:"underline",action:this.adapter.toggleUnderline,active:this.adapter.isUnderlineActive},{title:"\u30CF\u30A4\u30E9\u30A4\u30C8",icon:"highlighter",action:this.adapter.toggleHighlight,active:this.adapter.isHighlightActive}],r=!1;for(let l of i)l.action&&(t.addItem(c=>{var u;c.setTitle(l.title).setIcon(l.icon).setDisabled(!e).onClick(()=>{var d;(d=l.action)==null||d.call(l)}),(u=l.active)!=null&&u.call(l)&&c.setChecked(!0)}),r=!0);r&&t.addSeparator()}addHeadingSection(t){var i,r,o;if(!this.adapter.setHeading)return;let e=(o=(r=(i=this.adapter).getHeadingLevel)==null?void 0:r.call(i))!=null?o:0;for(let s=1;s<=6;s+=1)t.addItem(a=>{a.setTitle(`\u898B\u51FA\u3057${s}`).setIcon(`heading-${s}`).onClick(()=>{var l,c;(c=(l=this.adapter).setHeading)==null||c.call(l,s)}),e===s&&a.setChecked(!0)});t.addItem(s=>{s.setTitle("\u898B\u51FA\u3057\u89E3\u9664").setIcon("text").onClick(()=>{var a,l;(l=(a=this.adapter).clearHeading)==null||l.call(a)}),e===0&&s.setChecked(!0)}),t.addSeparator()}addBlockSection(t){let e=[{title:"\u7B87\u6761\u66F8\u304D\u30EA\u30B9\u30C8",icon:"list",action:this.adapter.toggleBulletList,active:this.adapter.isBulletListActive},{title:"\u756A\u53F7\u4ED8\u304D\u30EA\u30B9\u30C8",icon:"list-ordered",action:this.adapter.toggleOrderedList,active:this.adapter.isOrderedListActive}],i=!1;for(let r of e)r.action&&(t.addItem(o=>{var s;o.setTitle(r.title).setIcon(r.icon).onClick(()=>{var a;(a=r.action)==null||a.call(r)}),(s=r.active)!=null&&s.call(r)&&o.setChecked(!0)}),i=!0);i&&t.addSeparator()}addInsertSection(t){let e=!1;this.adapter.insertRuby&&(t.addItem(i=>{i.setTitle("\u30EB\u30D3\u633F\u5165").setIcon("gem").onClick(()=>{var r,o;(o=(r=this.adapter).insertRuby)==null||o.call(r)})}),e=!0),e&&t.addSeparator()}addClearSection(t){this.adapter.clearFormatting&&t.addItem(e=>{e.setTitle("\u66F8\u5F0F\u30AF\u30EA\u30A2").setIcon("eraser").onClick(()=>{var i,r;(r=(i=this.adapter).clearFormatting)==null||r.call(i)})})}};var Rl=class{constructor(t){this.autoScrollRaf=null;this.autoScrollActive=!1;this.lastPointerEvent=null;this.context=t}handlePointerDown(t){var d,h,p,f,g;let e=this.context.getSotEditor(),i=this.context.getDerivedRootEl();if(!e||!i||t.button!==0)return;let r=t.target,o=r==null?void 0:r.closest(".tategaki-md-callout-widget-content .callout-title, .tategaki-md-callout-widget-content .callout-fold");if(o&&!t.metaKey&&!t.ctrlKey){let m=o.closest(".tategaki-md-callout-widget-content .callout");if(m!=null&&m.classList.contains("is-collapsible")){t.preventDefault(),t.stopPropagation(),m.classList.toggle("is-collapsed");return}}let s=r==null?void 0:r.closest(".tategaki-md-heading-toggle");if(s){let m=s.closest(".tategaki-sot-line"),b=Number.parseInt((d=m==null?void 0:m.dataset.line)!=null?d:"",10);if(m&&Number.isFinite(b)){t.preventDefault(),t.stopPropagation(),this.context.toggleHeadingFold(b);return}}let a=r==null?void 0:r.closest(".tategaki-md-embed-widget-content a");if(a&&(t.metaKey||t.ctrlKey)){let b=(((f=(p=(h=a.dataset)==null?void 0:h.href)!=null?p:a.getAttribute("data-href"))!=null?f:"")||a.getAttribute("href")||"").trim();if(b){t.preventDefault(),t.stopPropagation(),this.context.openHref(b);return}}let l=r==null?void 0:r.closest(".tategaki-sot-run[data-href]");if(l&&(t.metaKey||t.ctrlKey)){let m=(g=l.dataset.href)!=null?g:"";if(m){t.preventDefault(),t.stopPropagation(),this.context.openHref(m);return}}let c=r==null?void 0:r.closest(".tategaki-md-task-box");if(c){t.preventDefault(),t.stopPropagation();let m=c.closest(".tategaki-sot-line");m&&(this.context.toggleTaskForLineElement(m),this.context.focusInputSurface(!0));return}if(this.context.isCeImeMode()){if(this.handleCeClickToLineEnd(t)){t.preventDefault(),t.stopPropagation(),this.context.focusInputSurface(!0);return}return}t.preventDefault(),i.focus({preventScroll:!0});let u=this.getOffsetFromPointerEvent(t);if(u!==null){let m=e.getSelection(),b=t.shiftKey?m.anchor:u;this.context.setPointerState({isPointerSelecting:!0,pointerSelectAnchor:this.context.normalizeOffsetToVisible(b,u>=b),pointerSelectPointerId:t.pointerId});try{i.setPointerCapture(t.pointerId)}catch(y){}this.context.setSelectionNormalized(b,u),this.context.scheduleCaretUpdate(!0)}this.context.focusInputSurface(!0)}handlePointerMove(t){if(this.context.isCeImeMode()||!this.context.getSotEditor())return;let i=this.context.getPointerState();if(!i.isPointerSelecting||i.pointerSelectPointerId!==null&&t.pointerId!==i.pointerSelectPointerId)return;this.lastPointerEvent=t;let r=this.getOffsetFromPointerEvent(t);r===null||i.pointerSelectAnchor===null||(this.context.setSelectionNormalized(i.pointerSelectAnchor,r),this.context.updateSelectionOverlay(),this.updateAutoScroll())}handlePointerUp(t){if(this.context.isCeImeMode())return;let e=this.context.getPointerState();if(!e.isPointerSelecting||e.pointerSelectPointerId!==null&&t.pointerId!==e.pointerSelectPointerId)return;let i=this.getOffsetFromPointerEvent(t);i!==null&&e.pointerSelectAnchor!==null&&(this.context.setSelectionNormalized(e.pointerSelectAnchor,i),this.context.updateSelectionOverlay());let r=this.context.getDerivedRootEl();if(r&&e.pointerSelectPointerId!==null)try{r.releasePointerCapture(e.pointerSelectPointerId)}catch(o){}this.context.setPointerState({isPointerSelecting:!1,pointerSelectAnchor:null,pointerSelectPointerId:null}),this.stopAutoScroll()}updateAutoScroll(){let t=this.context.getDerivedRootEl(),e=this.context.getPointerState();if(!t||!this.lastPointerEvent||!e.isPointerSelecting){this.stopAutoScroll();return}let{delta:i}=this.computeAutoScrollDelta(t,this.lastPointerEvent);if(i===0){this.stopAutoScroll();return}this.autoScrollActive||(this.autoScrollActive=!0,this.context.setAutoScrollSelecting(!0),this.autoScrollRaf=window.requestAnimationFrame(()=>{this.runAutoScroll()}))}runAutoScroll(){if(!this.autoScrollActive)return;let t=this.context.getDerivedRootEl(),e=this.context.getPointerState(),i=this.lastPointerEvent;if(!t||!i||!e.isPointerSelecting){this.stopAutoScroll();return}let{delta:r,axis:o}=this.computeAutoScrollDelta(t,i);if(r===0){this.stopAutoScroll();return}o==="x"?t.scrollLeft+=r:t.scrollTop+=r;let s=this.getOffsetFromPointerEvent(i);s!==null&&e.pointerSelectAnchor!==null&&(this.context.setSelectionNormalized(e.pointerSelectAnchor,s),this.context.updateSelectionOverlay()),this.autoScrollRaf=window.requestAnimationFrame(()=>{this.runAutoScroll()})}stopAutoScroll(){this.autoScrollRaf!==null&&(window.cancelAnimationFrame(this.autoScrollRaf),this.autoScrollRaf=null),this.autoScrollActive=!1,this.context.setAutoScrollSelecting(!1)}computeAutoScrollDelta(t,e){let i=t.getBoundingClientRect(),o=window.getComputedStyle(t).writingMode.startsWith("vertical"),s=28;if(o){let c=e.clientX-i.left,u=i.right-e.clientX;return c<s?{delta:-this.computeAutoScrollSpeed(c,s),axis:"x"}:u<s?{delta:this.computeAutoScrollSpeed(u,s),axis:"x"}:{delta:0,axis:"x"}}let a=e.clientY-i.top,l=i.bottom-e.clientY;return a<s?{delta:-this.computeAutoScrollSpeed(a,s),axis:"y"}:l<s?{delta:this.computeAutoScrollSpeed(l,s),axis:"y"}:{delta:0,axis:"y"}}computeAutoScrollSpeed(t,e){let i=Math.max(0,Math.min(t,e)),r=(e-i)/e,o=2;return o+(24-o)*r}handleCeClickToLineEnd(t){var f,g;let e=this.context.getSotEditor(),i=this.context.getDerivedRootEl();if(!this.context.isCeImeMode()||!e||!i)return!1;let r=this.findLineElementFromPoint(t.clientX,t.clientY);if(r||(r=this.findNearestLineElementFromPoint(t.clientX,t.clientY)),!r)return!1;this.context.ensureLineRendered(r);let o=Number.parseInt((f=r.dataset.from)!=null?f:"0",10),s=Number.parseInt((g=r.dataset.to)!=null?g:"0",10);if(Math.max(0,s-o)===0)return this.context.setSelectionNormalized(s,s),this.context.syncSelectionToCe(),!0;let l=this.context.getLineVisualRects(r);if(l.length===0)return!1;let c=window.getComputedStyle(i).writingMode,u=c.startsWith("vertical"),d=2,h=l[0];if(u){let m=c!=="vertical-lr";for(let y of l)m?y.left<h.left-.5&&(h=y):y.left>h.left+.5&&(h=y);return t.clientX>=h.left-d&&t.clientX<=h.right+d&&t.clientY>h.bottom+d?(this.context.setSelectionNormalized(s,s),this.context.syncSelectionToCe(),!0):!1}for(let m of l)(m.top>h.top+.5||Math.abs(m.top-h.top)<.5&&m.right>h.right)&&(h=m);return t.clientY>=h.top-d&&t.clientY<=h.bottom+d&&t.clientX>h.right+d?(this.context.setSelectionNormalized(s,s),this.context.syncSelectionToCe(),!0):!1}getOffsetFromPointerEvent(t){var h,p,f,g,m,b;let e=this.context.getDerivedRootEl();if(!e)return null;let i=t.target,r=i==null?void 0:i.closest(".tategaki-md-inline-widget"),o=i==null?void 0:i.closest(".tategaki-sot-line");if(o||(o=this.findLineElementFromPoint(t.clientX,t.clientY)),!o)return null;this.context.ensureLineRendered(o);let s=Number.parseInt((h=o.dataset.from)!=null?h:"0",10),a=Number.parseInt((p=o.dataset.to)!=null?p:"0",10);if(r&&o.contains(r)){let y=Number.parseInt((f=r.dataset.from)!=null?f:"",10),v=Number.parseInt((g=r.dataset.to)!=null?g:"",10),E=s+(Number.isFinite(y)?y:0),x=s+(Number.isFinite(v)?v:0),k=Math.max(s,Math.min(E,a)),S=Math.max(s,Math.min(x,a)),w=r.getBoundingClientRect();if(window.getComputedStyle(e).writingMode.startsWith("vertical")){let F=w.top+w.height/2;return this.context.normalizeOffsetToVisible(t.clientY>F?S:k,!0)}let I=w.left+w.width/2;return this.context.normalizeOffsetToVisible(t.clientX>I?S:k,!0)}let l=(m=o.dataset.mdKind)!=null?m:"";if(l==="image-widget"||l==="embed-widget"||l==="math-widget"||l==="math-hidden"||l==="callout-widget"||l==="callout-hidden"||l==="table-widget"||l==="table-hidden"||l==="deflist-widget"||l==="deflist-hidden"||l==="heading-hidden")return this.context.normalizeOffsetToVisible(s,!0);let c=Math.max(0,a-s),u=(b=this.context.getLocalOffsetFromPoint(o,t.clientX,t.clientY,c))!=null?b:0,d=Math.max(0,Math.min(u,c));return this.context.normalizeOffsetToVisible(s+d,!0)}findLineElementFromPoint(t,e){var r;let i=document.elementFromPoint(t,e);return(r=i==null?void 0:i.closest(".tategaki-sot-line"))!=null?r:null}findNearestLineElementFromPoint(t,e){let i=this.context.getDerivedContentEl();if(!i)return null;let r=i.getBoundingClientRect(),o=24;if(t<r.left-o||t>r.right+o||e<r.top-o||e>r.bottom+o)return null;let s=this.context.getDerivedRootEl(),a=window.getComputedStyle(s!=null?s:i),c=a.writingMode.startsWith("vertical"),u=Number.parseFloat(a.fontSize)||18,d=Number.parseFloat(a.lineHeight)||Math.max(1,u*1.6),h=Array.from(i.children),p=null,f=Number.POSITIVE_INFINITY;for(let g of h){if(!g.classList.contains("tategaki-sot-line"))continue;let m=this.context.getLineVisualRects(g),b=m.length>0?wr(m,g.getBoundingClientRect()):g.getBoundingClientRect();if(!Number.isFinite(b.left))continue;let y=b.left,v=b.top,E=Math.max(b.width,u),x=Math.max(b.height,d);c&&(E=Math.max(E,u),x=Math.max(x,d)),E>b.width&&(y-=(E-b.width)/2),x>b.height&&(v-=(x-b.height)/2);let k=y+E,S=v+x,w=t<y?y-t:t>k?t-k:0,C=e<v?v-e:e>S?e-S:0,I=w*w+C*C;I<f&&(f=I,p=g)}return p}};function GE(n,t,e,i,r,o){let s=t.to-t.from,a=Math.max(0,Math.min(e,s)),l=Math.max(0,Math.min(i,s));if(a===l)return[];let c=o.getLineTextNodes(n);if(c.length===0){let g=n.getBoundingClientRect();return g?[g]:[]}let u=c[c.length-1],d=document.createRange(),h=a>=s?{node:u,offset:u.length}:o.findTextNodeAtOffset(n,a),p=l>=s?{node:u,offset:u.length}:o.findTextNodeAtOffset(n,l);if(!h||!p)return[];d.setStart(h.node,h.offset),d.setEnd(p.node,p.offset);let f=Array.from(d.getClientRects());return SN(f,r)}function SN(n,t){let e=n.filter(o=>o.width>0||o.height>0);if(e.length<=1)return e;let i=t.startsWith("vertical"),r=[];for(let o of e)o.width<=0&&o.height<=0||r.some(a=>Math.abs(a.left-o.left)<.5&&Math.abs(a.right-o.right)<.5&&Math.abs(a.top-o.top)<.5&&Math.abs(a.bottom-o.bottom)<.5)||r.push(o);return r}var Al=class{constructor(t){this.context=t}updateSelectionOverlay(){var E;let t=this.context.getDerivedRootEl(),e=this.context.getDerivedContentEl(),i=this.context.getSelectionLayerEl(),r=this.context.getSotEditor();if(!t||!e||!i||!r)return;let o=this.context.getPendingSelectionState();if(o.pendingText.length>0&&o.pendingSelectionFrom!==null){i.replaceChildren();return}let s=r.getSelection(),a=Math.min(s.anchor,s.head),l=Math.max(s.anchor,s.head);if(a===l){i.replaceChildren();return}let c=t.getBoundingClientRect();if(this.context.isAutoScrollSelecting()){i.replaceChildren();let x=e.getBoundingClientRect(),k=Math.max(c.left,x.left),S=Math.min(c.right,x.right),w=Math.max(c.top,x.top),C=Math.min(c.bottom,x.bottom),I=Math.max(0,S-k),F=Math.max(0,C-w);if(I>0&&F>0){let N=this.createSelectionRect(new DOMRect(k,w,I,F),c,t);i.appendChild(N)}return}let u=this.context.findLineIndex(a),d=this.context.findLineIndex(l);if(u===null||d===null){i.replaceChildren();return}let p=this.context.isPointerSelecting()?null:this.findVisibleLineRange(t),f=p!==null?Math.max(u,p.start):u,g=p!==null?Math.min(d,p.end):d;if(f>g){i.replaceChildren();return}let m=window.getComputedStyle(t).writingMode,b=document.createDocumentFragment(),y=this.context.getLineRanges(),v={getLineTextNodes:x=>this.context.getLineTextNodes(x),findTextNodeAtOffset:(x,k)=>this.context.findTextNodeAtOffset(x,k)};for(let x=f;x<=g;x+=1){let k=y[x],S=this.context.getLineElement(x);if(!k||!S)continue;this.context.ensureLineRendered(S);let w=k.to-k.from,C=0,I=w;if(x===f&&(C=Math.max(0,Math.min(a-k.from,w))),x===g&&(I=Math.max(0,Math.min(l-k.from,w))),w===0){if(a<=k.from&&l>=k.to){let N=S.querySelector(".tategaki-sot-eol"),H=(E=N==null?void 0:N.getBoundingClientRect())!=null?E:S.getBoundingClientRect(),_=this.createSelectionRect(H,c,t);b.appendChild(_)}continue}if(C===I)continue;let F=GE(S,k,C,I,m,v);for(let N of F){let H=this.createSelectionRect(N,c,t);b.appendChild(H)}}i.replaceChildren(b)}findVisibleLineRange(t){let e=t.getBoundingClientRect(),i=[{x:e.left+4,y:e.top+4},{x:e.left+4,y:e.bottom-4},{x:e.right-4,y:e.top+4},{x:e.right-4,y:e.bottom-4},{x:e.left+e.width/2,y:e.top+4},{x:e.left+e.width/2,y:e.bottom-4}],r=(a,l)=>{var h;let c=document.elementFromPoint(a,l),u=c==null?void 0:c.closest(".tategaki-sot-line");if(!u)return null;let d=Number.parseInt((h=u.dataset.line)!=null?h:"",10);return Number.isFinite(d)?d:null},o=null,s=null;for(let a of i){let l=r(a.x,a.y);l!==null&&((o===null||l<o)&&(o=l),(s===null||l>s)&&(s=l))}return o===null||s===null?null:{start:o,end:s}}createSelectionRect(t,e,i){let r=document.createElement("div");r.className="tategaki-sot-selection-rect";let o=t.left-e.left+i.scrollLeft,s=t.top-e.top+i.scrollTop,a=Math.max(1,t.width),l=Math.max(1,t.height);return r.style.left=`${o}px`,r.style.top=`${s}px`,r.style.width=`${a}px`,r.style.height=`${l}px`,r}};var Il=class{constructor(t){this.context=t}syncSelectionFromCe(){var a;if(!this.context.isCeImeMode())return null;let t=this.context.getSotEditor();if(!t)return null;let e=(a=this.context.getDerivedContentEl())==null?void 0:a.ownerDocument.getSelection();if(!e||!this.context.isSelectionInsideDerivedContent(e))return null;let i=this.context.getLineElementForNode(e.anchorNode),r=this.context.getLineElementForNode(e.focusNode);if(!i||!r)return null;let o=this.getSelectionOffsetsFromCe(e);if(!o)return this.context.recordCeMappingFailure("selection"),null;let s=t.getSelection();return(s.anchor!==o.anchor||s.head!==o.head)&&(this.context.setCeImeSelectionSyncing(!0),this.context.setSelectionNormalized(o.anchor,o.head),this.context.setCeImeSelectionSyncing(!1)),o}syncSelectionToCe(){if(!this.context.isCeImeMode())return;let t=this.context.getSotEditor(),e=this.context.getDerivedContentEl();if(!t||!e||!this.context.isLeafActive()||this.context.isCeImeComposing())return;let i=e.ownerDocument.getSelection();if(!i)return;let{anchor:r,head:o}=t.getSelection(),s=this.getDomPositionForOffset(r),a=this.getDomPositionForOffset(o);if(!s||!a){this.context.recordCeMappingFailure("selection");return}this.context.setCeImeSelectionSyncing(!0);let l=i;if(typeof l.setBaseAndExtent=="function")l.setBaseAndExtent(s.node,s.offset,a.node,a.offset);else{let c=e.ownerDocument.createRange();c.setStart(s.node,s.offset),c.setEnd(a.node,a.offset),i.removeAllRanges(),i.addRange(c)}this.context.setCeImeSelectionSyncing(!1)}handleCeSelectionChange(){var e;if(!this.context.isCeImeMode()||this.context.isCeImeSelectionSyncing()||this.context.isCeImeComposing())return;this.syncSelectionFromCe();let t=(e=this.context.getDerivedContentEl())==null?void 0:e.ownerDocument.getSelection();t&&this.context.isSelectionInsideDerivedContent(t)&&(this.context.isUnsafeCeSelectionNode(t.anchorNode)||this.context.isUnsafeCeSelectionNode(t.focusNode))&&this.syncSelectionToCe(),this.context.scheduleCeSafetyCheck()}getSelectionOffsetsFromCe(t){let e=this.getOffsetFromSelectionNode(t.anchorNode,t.anchorOffset),i=this.getOffsetFromSelectionNode(t.focusNode,t.focusOffset);return e===null||i===null?null:{anchor:e,head:i}}getOffsetFromSelectionNode(t,e){var d,h,p;let i=this.context.getSotEditor();if(!t||!i)return null;let r=t instanceof Element?t:(d=t.parentElement)!=null?d:null;if(!r)return null;let o=r.closest(".tategaki-sot-line");if(!o)return null;let s=Number.parseInt((h=o.dataset.from)!=null?h:"0",10),a=Number.parseInt((p=o.dataset.to)!=null?p:"0",10),l=Math.max(0,a-s),c=this.context.resolveOffsetFromCaretPosition(o,{node:t,offset:e},l);if(c===null)return s;let u=i.getDoc().length;return Math.max(0,Math.min(s+c,u))}getDomPositionForOffset(t){let e=this.context.getSotEditor();if(!e)return null;let i=e.getDoc().length,r=Math.max(0,Math.min(t,i)),o=this.context.findLineIndex(r);if(o===null)return null;let a=this.context.getLineRanges()[o],l=this.context.getLineElement(o);if(!a||!l)return null;this.context.ensureLineRendered(l);let c=Math.max(0,a.to-a.from),u=Math.max(0,Math.min(r-a.from,c));if(this.context.isCeImeMode()&&c===0){let f=this.context.ensureCeInputPlaceholderNode(l);if(f)return{node:f,offset:0};let g=l.querySelector(".tategaki-sot-eol"),m=g!=null&&g.firstChild&&g.firstChild.nodeType===Node.TEXT_NODE?g.firstChild:null;if(m)return{node:m,offset:0};let b=l.childNodes.length,y=Math.max(0,b-1);return{node:l,offset:y}}let d=this.context.findTextNodeAtOffset(l,u);if(d)return{node:d.node,offset:d.offset};let h=l.querySelector(".tategaki-sot-eol"),p=h!=null&&h.firstChild&&h.firstChild.nodeType===Node.TEXT_NODE?h.firstChild:null;return p?{node:p,offset:p.length}:{node:l,offset:0}}};var Nl=class{constructor(t){this.renderTimer=null;this.renderChunkRaf=null;this.renderGeneration=0;this.virtualObserver=null;this.virtualEnabled=!1;this.virtualInitialEnd=-1;this.virtualQueue=[];this.virtualQueued=new Set;this.virtualQueueRaf=null;this.scrollingActive=!1;this.scrollHoldTimer=null;this.resumeAfterScrollRaf=null;this.context=t}suspend(){this.cancelScheduledRender(),this.cancelChunkedRender(),this.cancelVirtualQueue(),this.cancelScrollHold(),this.disconnectVirtualObserver(),this.virtualQueue=[],this.virtualQueued.clear(),this.scrollingActive=!1}dispose(){this.suspend()}cancelScheduledRender(){this.renderTimer!==null&&(window.clearTimeout(this.renderTimer),this.renderTimer=null)}cancelScrollHold(){this.scrollHoldTimer!==null&&(window.clearTimeout(this.scrollHoldTimer),this.scrollHoldTimer=null),this.resumeAfterScrollRaf!==null&&(window.cancelAnimationFrame(this.resumeAfterScrollRaf),this.resumeAfterScrollRaf=null),this.scrollingActive=!1}notifyScrollActivity(t){this.virtualEnabled&&t&&(this.scrollingActive=!0,this.scrollHoldTimer!==null&&window.clearTimeout(this.scrollHoldTimer),this.scrollHoldTimer=window.setTimeout(()=>{this.scrollHoldTimer=null,this.scrollingActive=!1,this.scheduleResumeAfterScroll()},140))}scheduleRender(t=!1){let e=this.context.getDerivedRootEl(),i=this.context.getDerivedContentEl(),r=this.context.getSotEditor();if(!(!e||!i||!r)){if(this.renderTimer!==null){if(!t)return;window.clearTimeout(this.renderTimer),this.renderTimer=null}this.renderTimer=window.setTimeout(()=>{this.renderTimer=null,this.renderNow()},0)}}renderNow(){var g;let t=this.context.getDerivedRootEl(),e=this.context.getDerivedContentEl(),i=this.context.getSotEditor();if(!t||!e||!i)return;let r=this.renderGeneration+1;this.renderGeneration=r,this.cancelChunkedRender(),this.cancelVirtualQueue();let o=t.scrollTop,s=t.scrollLeft,a=i.getDoc(),l=a.split(`
`),c=this.context.parseFrontmatter(a);this.context.setFrontmatterDetected(!!c.frontmatter);let u=this.context.computeLineRangesFromLines(l);if(this.context.setLineRanges(u),this.context.recomputeLineBlockKinds(l),this.virtualEnabled=this.shouldUseVirtualizedRender(u.length,a.length),this.resetVirtualQueue(),this.setupVirtualObserver(t),this.virtualInitialEnd=this.virtualEnabled?this.getInitialFullRenderEnd(t,u.length):-1,this.shouldUseChunkedRender(u.length,a.length)){this.renderChunked(r,(g=c.frontmatter)!=null?g:null,o,s);return}let d=document.createDocumentFragment(),h=this.context.getPluginSettings(),p=this.context.getHideFrontmatter(),f=this.context.getWritingMode();if(c.frontmatter&&!p){let m=this.context.renderFrontmatter(c.frontmatter,h);m&&(this.context.applyFrontmatterWritingMode(m,f),d.appendChild(m))}for(let m=0;m<u.length;m+=1){let b=u[m];if(!b)continue;let y=document.createElement("div");y.className="tategaki-sot-line",y.dataset.from=String(b.from),y.dataset.to=String(b.to),y.dataset.line=String(m),this.renderLineWithVirtualization(y,b,m),d.appendChild(y)}e.replaceChildren(d),this.context.resetPendingRenderState(),this.context.finalizeRender(o,s)}shouldUseChunkedRender(t,e){return t>=800||e>=12e4}shouldUseVirtualizedRender(t,e){return t>=1200||e>=16e4}setupVirtualObserver(t){if(!this.virtualEnabled){this.disconnectVirtualObserver();return}this.disconnectVirtualObserver(),this.virtualObserver=new IntersectionObserver(e=>{var i,r,o,s;if(!this.scrollingActive)for(let a of e){if(!a.isIntersecting)continue;let l=a.target;if(l.dataset.virtual!=="1"){(i=this.virtualObserver)==null||i.unobserve(l);continue}let c=Number.parseInt((r=l.dataset.line)!=null?r:"",10);if(!Number.isFinite(c)){(o=this.virtualObserver)==null||o.unobserve(l);continue}if(!this.context.getLineRanges()[c]){(s=this.virtualObserver)==null||s.unobserve(l);continue}this.enqueueVirtualLine(l)}},{root:t,rootMargin:"200px"})}disconnectVirtualObserver(){this.virtualObserver&&(this.virtualObserver.disconnect(),this.virtualObserver=null)}getInitialFullRenderEnd(t,e){let i=window.getComputedStyle(t),r=Number.parseFloat(i.fontSize)||16,o=Number.parseFloat(i.lineHeight)||r*1.8,a=i.writingMode!=="horizontal-tb"?t.clientWidth:t.clientHeight,l=Math.max(o,r),c=Math.ceil(a/l),d=Math.min(e-1,c+80);return Math.max(0,d)}renderLineWithVirtualization(t,e,i){if(!this.virtualEnabled||i<=this.virtualInitialEnd){this.context.renderLine(t,e,i);return}this.context.renderLineLight(t,e,i),this.virtualObserver&&this.virtualObserver.observe(t)}enqueueVirtualLine(t){var i;let e=Number.parseInt((i=t.dataset.line)!=null?i:"",10);Number.isFinite(e)&&(this.virtualQueued.has(e)||(this.virtualQueued.add(e),this.virtualQueue.push({index:e,element:t}),this.scheduleVirtualQueue()))}scheduleVirtualQueue(){this.virtualQueueRaf===null&&(this.virtualQueueRaf=window.requestAnimationFrame(()=>{this.virtualQueueRaf=null,this.flushVirtualQueue()}))}flushVirtualQueue(){if(this.scrollingActive)return;let t=performance.now(),e=10,i=this.context.getLineRanges();for(;this.virtualQueue.length>0&&performance.now()-t<e;){let r=this.virtualQueue.shift();this.virtualQueued.delete(r.index);let o=r.element;if(this.virtualObserver&&this.virtualObserver.unobserve(o),!o.isConnected||o.dataset.virtual!=="1")continue;let s=i[r.index];s&&(o.removeAttribute("data-virtual"),o.classList.remove("tategaki-sot-line-virtual"),this.context.renderLine(o,s,r.index))}this.virtualQueue.length>0&&this.scheduleVirtualQueue()}resetVirtualQueue(){this.virtualQueue=[],this.virtualQueued.clear()}cancelVirtualQueue(){this.virtualQueueRaf!==null&&(window.cancelAnimationFrame(this.virtualQueueRaf),this.virtualQueueRaf=null),this.resetVirtualQueue()}scheduleResumeAfterScroll(){this.resumeAfterScrollRaf===null&&(this.resumeAfterScrollRaf=window.requestAnimationFrame(()=>{this.resumeAfterScrollRaf=null;let t=this.renderVisibleVirtualLinesImmediate();this.scheduleVirtualQueue(),t&&this.scheduleResumeAfterScroll()}))}onScrollSettled(){this.virtualEnabled&&(this.scrollingActive||this.scheduleResumeAfterScroll())}renderVisibleVirtualLinesImmediate(){var l;let t=this.context.getDerivedRootEl(),e=this.context.getDerivedContentEl();if(!t||!e)return!1;let i=t.getBoundingClientRect(),r=this.context.getLineRanges(),o=e.querySelectorAll('.tategaki-sot-line-virtual[data-virtual="1"]'),s=[];for(let c of Array.from(o)){if(!c.isConnected)continue;let u=c.getBoundingClientRect();u.bottom>=i.top&&u.top<=i.bottom&&u.right>=i.left&&u.left<=i.right&&s.push(c)}for(let c of s){if(!c.isConnected||c.dataset.virtual!=="1")continue;let u=Number.parseInt((l=c.dataset.line)!=null?l:"",10);if(!Number.isFinite(u))continue;let d=r[u];if(!d)continue;this.virtualQueued.delete(u);let h=this.virtualQueue.findIndex(p=>p.index===u);h!==-1&&this.virtualQueue.splice(h,1),this.virtualObserver&&this.virtualObserver.unobserve(c),c.removeAttribute("data-virtual"),c.classList.remove("tategaki-sot-line-virtual"),this.context.renderLine(c,d,u)}let a=e.querySelectorAll('.tategaki-sot-line-virtual[data-virtual="1"]');for(let c of Array.from(a)){if(!c.isConnected)continue;let u=c.getBoundingClientRect();if(u.bottom>=i.top&&u.top<=i.bottom&&u.right>=i.left&&u.left<=i.right)return!0}return!1}cancelChunkedRender(){this.renderChunkRaf!==null&&(window.cancelAnimationFrame(this.renderChunkRaf),this.renderChunkRaf=null)}renderChunked(t,e,i,r){let o=this.context.getDerivedRootEl(),s=this.context.getDerivedContentEl();if(!o||!s)return;this.cancelChunkedRender(),s.replaceChildren();let a=this.context.getPluginSettings(),l=this.context.getHideFrontmatter(),c=this.context.getWritingMode();if(e&&!l){let g=this.context.renderFrontmatter(e,a);g&&(this.context.applyFrontmatterWritingMode(g,c),s.appendChild(g))}this.context.resetPendingRenderState();let u=this.context.getLineRanges(),d=u.length,h=0,p=12,f=()=>{if(t!==this.renderGeneration){this.renderChunkRaf=null;return}let g=this.context.getDerivedRootEl(),m=this.context.getDerivedContentEl();if(!g||!m){this.renderChunkRaf=null;return}let b=performance.now(),y=document.createDocumentFragment();for(;h<d&&performance.now()-b<p;){let v=u[h];if(v){let E=document.createElement("div");E.className="tategaki-sot-line",E.dataset.from=String(v.from),E.dataset.to=String(v.to),E.dataset.line=String(h),this.renderLineWithVirtualization(E,v,h),y.appendChild(E)}h+=1}if(m.appendChild(y),h<d){this.renderChunkRaf=window.requestAnimationFrame(f);return}this.renderChunkRaf=null,this.context.finalizeRender(i,r)};this.renderChunkRaf=window.requestAnimationFrame(f)}};function jE(n,t){n.empty(),n.style.cssText=`
		position: relative;
		width: 100%;
		height: 100%;
		display: flex;
		flex-direction: column;
		min-height: 0;
		overflow: hidden;
		box-sizing: border-box;
		margin: 0;
		padding: 0;
	`;let e=n.createDiv("tategaki-sot-toolbar-row");e.style.cssText=`
		display: flex;
		align-items: center;
		gap: 8px;
		flex: 0 0 auto;
		padding: 0;
		background: var(--background-secondary);
		border-bottom: 1px solid var(--background-modifier-border);
	`;let i=e.createDiv();i.style.cssText=`
		display: flex;
		align-items: center;
		flex: 1;
		min-width: 0;
	`;let r=n.createDiv("tategaki-sot-content");r.style.cssText=`
		position: relative;
		flex: 1 1 auto;
		min-height: 0;
		overflow: hidden;
		display: flex;
		flex-direction: column;
	`;let o=r.createDiv("tategaki-sot-page-container");o.style.cssText=`
		flex: 1 1 auto;
		min-width: 0;
		min-height: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		box-sizing: border-box;
		overflow: visible;
		padding: 40px 32px 22px 32px;
		background: transparent;
	`;let s=o.createDiv("tategaki-sot-border-wrapper");s.style.cssText=`
		position: relative;
		width: 100%;
		height: 100%;
		min-width: 0;
		min-height: 0;
		border: none !important;
		outline: none !important;
		border-radius: 0;
		background: ${t} !important;
		box-shadow: 0 6px 12px rgba(0,0,0,0.4);
		box-sizing: border-box;
		overflow: hidden;
		transform-origin: center center;
		transform: scale(1);
	`;let a=s.createDiv("tategaki-sot-content-wrapper");a.style.cssText=`
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: ${t};
		color: var(--text-normal);
		display: flex;
		flex-direction: column;
		overflow: hidden;
		border: none !important;
		outline: none !important;
	`;let l=a.createDiv("tategaki-sot-loading-overlay"),c=l.createDiv("tategaki-sot-loading-message");c.textContent="\u8AAD\u307F\u8FBC\u307F\u4E2D\u2026";let u=a.createDiv("tategaki-sot-derived-root");u.tabIndex=0;let d=u.createDiv("tategaki-sot-derived-content"),h=u.createDiv("tategaki-sot-selection-layer"),p=u.createDiv("tategaki-sot-caret"),f=u.createDiv("tategaki-sot-pending");return{toolbarLeft:i,content:r,pageContainerEl:o,borderWrapperEl:s,contentWrapperEl:a,loadingOverlayEl:l,derivedRootEl:u,derivedContentEl:d,selectionLayerEl:h,caretEl:p,pendingEl:f}}function YE(n,t){let e="(hover: none) and (pointer: coarse) and (max-width: 700px)",i=()=>{let o=n.containerEl.querySelector(".view-header"),s=o?Math.ceil(o.getBoundingClientRect().height):0;t.style.setProperty("--tategaki-view-header-height",`${s}px`);let a=window.matchMedia(e).matches;t.style.paddingTop=a?"calc(var(--tategaki-safe-area-top, 0px) + var(--tategaki-view-header-height, 0px))":"0px";let l=!1,c=t.ownerDocument.activeElement;c&&t.contains(c)&&(l=c.isContentEditable||c.tagName==="TEXTAREA"||c.tagName==="INPUT"),t.style.paddingBottom=a&&!l?"var(--tategaki-reading-bottom-offset, 0px)":"0px"};i(),window.setTimeout(i,0),n.registerDomEvent(window,"resize",i),n.registerDomEvent(t.ownerDocument,"focusin",i),n.registerDomEvent(t.ownerDocument,"focusout",i),n.registerEscapeGuard(),n.registerEscapeKeymap();let r=n.containerEl.querySelector(".view-header");if(r&&"ResizeObserver"in window){let o=new ResizeObserver(()=>{i()});o.observe(r),n.register(()=>o.disconnect())}}function XE(n){var t;n.derivedContentEl&&(n.registerDomEvent(n.derivedContentEl,"beforeinput",e=>n.handleCeBeforeInput(e)),n.registerDomEvent(n.derivedContentEl,"compositionstart",e=>n.handleCeCompositionStart(e)),n.registerDomEvent(n.derivedContentEl,"compositionupdate",e=>n.handleCeCompositionUpdate(e)),n.registerDomEvent(n.derivedContentEl,"compositionend",e=>n.handleCeCompositionEnd(e)),n.registerDomEvent(n.derivedContentEl,"keydown",e=>n.handleCeKeydown(e))),(t=n.derivedContentEl)!=null&&t.ownerDocument&&n.registerDomEvent(n.derivedContentEl.ownerDocument,"selectionchange",()=>n.handleCeSelectionChange())}function JE(n){let t=n.derivedRootEl;n.registerDomEvent(t,"pointerdown",e=>{var i;n.sourceModeEnabled&&n.plainEditOverlayEl&&e.target instanceof Node&&n.plainEditOverlayEl.contains(e.target)||(n.handleTouchScrollPointerDown(e),(i=n.pointerHandler)==null||i.handlePointerDown(e))}),n.registerDomEvent(t,"contextmenu",e=>{!n.commandContextMenu||!n.derivedRootEl||(n.derivedRootEl.focus({preventScroll:!0}),n.commandContextMenu.show(e))}),n.registerClipboardHandlers(),n.registerDomEvent(window,"pointermove",e=>{var i;n.handleTouchScrollPointerMove(e),!(n.touchScrollActive&&e.pointerType==="touch")&&((i=n.pointerHandler)==null||i.handlePointerMove(e))}),n.registerDomEvent(window,"pointerup",e=>{var r;let i=n.touchScrollActive&&e.pointerType==="touch";n.handleTouchScrollPointerUp(e),!i&&((r=n.pointerHandler)==null||r.handlePointerUp(e))}),n.registerDomEvent(window,"pointercancel",e=>{var r;let i=n.touchScrollActive&&e.pointerType==="touch";n.handleTouchScrollPointerUp(e),!i&&((r=n.pointerHandler)==null||r.handlePointerUp(e))}),n.registerDomEvent(t,"keydown",e=>{var i;if(e.key==="Escape"){e.preventDefault(),e.stopPropagation(),n.focusInputSurface(!0);return}if(n.ceImeMode){n.focusInputSurface(!0);return}(i=n.overlayTextarea)!=null&&i.isFocused()||n.focusInputSurface(!0)}),n.registerDomEvent(t,"scroll",()=>{n.handleRootScroll()}),n.registerDomEvent(t,"pointerdown",e=>{let i=e;i.pointerType==="mouse"&&i.button===0&&i.target===t&&(n.scrollDragActive=!0)}),n.registerDomEvent(window,"pointerup",e=>{e.pointerType==="mouse"&&(n.scrollDragActive=!1)}),n.setupWheelScroll(),n.registerEvent(n.app.workspace.on("active-leaf-change",e=>{if(e===n.leaf){n.resumeFromInactiveLeaf(),n.ceImeSuspended&&(n.ceImeSuspended=!1,n.setCeImeMode(!0)),window.setTimeout(()=>{n.focusInputSurface(!0)},0);return}let i=n.getValidPairedMarkdownLeaf();if(e&&i&&e===i){n.resumeFromInactiveLeaf(),n.ceImeMode&&n.setCeImeMode(!1,{suspend:!0});return}n.suspendForInactiveLeaf(),n.ceImeMode&&n.setCeImeMode(!1,{suspend:!0})}))}function ZE(n){n.pendingSpacerEl=null,n.pendingLineIndex=null,n.pendingLocalOffset=null,n.pendingSelectionFrom=null,n.pendingSelectionTo=null,n.pendingSelectionLineStart=null,n.pendingSelectionLineEnd=null}function QE(n,t,e){var i,r,o;if(n.pendingHold&&(n.pendingHold=!1,n.updatePendingText("",!0)),n.updateSourceModeLineRange(!0),n.derivedRootEl){let s=n.pendingFoldScrollLineIndex;if(n.pendingFoldScrollLineIndex=null,s!==null){n.pendingScrollRestoreTop=null,n.pendingScrollRestoreLeft=null;let a=n.getLineElement(s);a&&(n.ensureLineRendered(a),a.scrollIntoView({block:"center",inline:"center"}),setTimeout(()=>{a.scrollIntoView({block:"center",inline:"center"})},100))}else{let a=(i=n.pendingScrollRestoreTop)!=null?i:t,l=(r=n.pendingScrollRestoreLeft)!=null?r:e;n.pendingScrollRestoreTop=null,n.pendingScrollRestoreLeft=null,n.derivedRootEl.scrollTop=a,n.derivedRootEl.scrollLeft=l}}(o=n.outlinePanel)==null||o.refresh(),n.scheduleCaretUpdate(!0),n.loadingOverlayPending&&n.hideLoadingOverlay()}function ex(n,t=!1){var e;(e=n.renderPipeline)==null||e.scheduleRender(t)}function tx(n){var t;(t=n.renderPipeline)==null||t.renderNow()}function nx(n,t,e){let i=n.lineRanges.length;n.lineCache.purgeLineCaches(t,e,i)}function ix(n,t=!1){if(!t){window.requestAnimationFrame(()=>{Pl(n),_l(n)});return}Pl(n),_l(n)}function Pl(n){var t,e;if(n.sourceModeEnabled){(t=n.selectionLayerEl)==null||t.replaceChildren();return}(e=n.selectionOverlay)==null||e.updateSelectionOverlay()}function _l(n){var qe,Ze,Ct,U,O,M,D,V,G,de,ve,We,Io,Bh;if(!n.derivedRootEl||!n.derivedContentEl||!n.caretEl||!n.sotEditor)return;if(n.sourceModeEnabled){n.caretEl.style.display="none";return}let t=(qe=n.plugin.settings.wysiwyg.caretWidthPx)!=null?qe:3,e=n.getEffectiveCommonSettings(n.plugin.settings),i=n.resolveCaretColor(n.plugin.settings,e),r=(Ze=n.plugin.settings.wysiwyg.ceUseNativeCaret)!=null?Ze:!0,o=n.ceImeMode&&(r||n.ceImeComposing);if(n.derivedRootEl&&n.ceImeMode&&(n.derivedRootEl.dataset.ceImeNativeCaret=o?"1":"0"),n.ceImeMode&&((Ct=n.overlayTextarea)==null||Ct.setCaretVisible(!1),n.derivedContentEl.style.caretColor=o?i:"transparent",o)){n.caretEl.style.display="none",n.pendingCaretScroll&&(n.pendingCaretScroll=!1,Ol(n));return}let s=n.sotEditor.getSelection(),a=Math.min(s.anchor,s.head),l=Math.max(s.anchor,s.head),c=n.pendingText.length>0&&a!==l?a:s.head,u=n.findLineIndex(c);if(u===null){n.caretEl.style.display="none";return}let d=n.lineRanges[u];if(!d){n.caretEl.style.display="none";return}let h=n.getLineElement(u);if(!h){n.caretEl.style.display="none";return}n.ensureLineRendered(h);let p=window.getComputedStyle(n.derivedRootEl),f=p.writingMode,g=d.to-d.from,m=Math.max(0,Math.min(c-d.from,g));((M=(O=(U=n.overlayTextarea)==null?void 0:U.isImeVisible)==null?void 0:O.call(U))!=null?M:!1)?((D=n.restorePendingSelectionLines)==null||D.call(n),(V=n.restorePendingLine)==null||V.call(n)):n.updatePendingSpacer(u,m);let y=n.getCaretRectInLine(h,m,d,f);if(!y){n.caretEl.style.display="none";return}let v=n.derivedRootEl.getBoundingClientRect(),E=y.left-v.left+n.derivedRootEl.scrollLeft,x=y.top-v.top+n.derivedRootEl.scrollTop,k=n.getPendingSpacerStartRect(h,u,f);k&&(E=k.left-v.left+n.derivedRootEl.scrollLeft,x=k.top-v.top+n.derivedRootEl.scrollTop);let S=n.getCaretRectInLine(h,0,d,f),w=E,C=x;g===0&&k||S&&(w=S.left-v.left+n.derivedRootEl.scrollLeft,C=S.top-v.top+n.derivedRootEl.scrollTop),k&&n.pendingText.length>0&&n.pendingLineIndex===u&&n.pendingLocalOffset===0&&(w=k.left-v.left+n.derivedRootEl.scrollLeft,C=k.top-v.top+n.derivedRootEl.scrollTop);let F=f.startsWith("vertical"),N=parseFloat(p.fontSize)||18,H=Number.parseFloat(p.lineHeight)||Math.max(1,N*1.8),_=null;(G=n.overlayTextarea)!=null&&G.isFocused()&&(_=n.overlayTextarea.getSelectionStart());let P=n.getPendingCaretRect(f,_),L=E,R=x;P&&(L=P.left-v.left+n.derivedRootEl.scrollLeft,R=P.top-v.top+n.derivedRootEl.scrollTop);let T=P!=null?P:y,A=F?N*.3:0,B=!n.ceImeMode&&(((ve=(de=n.overlayTextarea)==null?void 0:de.isImeVisible())!=null?ve:!1)||n.overlayFocused&&n.pendingText.length>0);if((We=n.overlayTextarea)==null||We.setCaretVisible(B),n.caretEl.style.display=B?"none":"",n.caretEl.style.left=`${L}px`,F)n.caretEl.style.top=`${R}px`,n.caretEl.style.width=`${Math.max(8,T.width)}px`,n.caretEl.style.height=`${Math.max(1,t)}px`;else{let Pn=Math.max(8,N),_n=Math.max(0,T.height),ii=R;_n>0&&_n!==Pn&&(ii=R+(_n-Pn)/2),n.caretEl.style.top=`${ii}px`,n.caretEl.style.width=`${Math.max(1,t)}px`,n.caretEl.style.height=`${Pn}px`}let W=0;if(!F){let Pn=Math.max(0,T.height);if(Pn>0&&Number.isFinite(H)){W=(Pn-H)/2,W-=N*.2;let _n=N*.35;W=Math.max(-_n,Math.min(_n,W))}}let K=n.pendingText.length>0&&n.pendingLineIndex===u&&n.pendingLocalOffset===0,J=F?Math.max(0,x-C):Math.max(0,E-w);K&&(J=0);let Z=(Io=n.plugin.settings.wysiwyg.imeOffsetHorizontalEm)!=null?Io:.1,ee=(Bh=n.plugin.settings.wysiwyg.imeOffsetVerticalEm)!=null?Bh:.5,Me=F?0:N*Z,Be=F?N*ee:0,ye=g===0&&n.pendingText.length>0,pe=ye?E+Be:E,Fe=ye?x-Me:x,rt=ye?w+Be:w,Mt=ye?C-Me:C,Tt=ye?0:Be,dt=ye?0:Me,He=n.derivedRootEl.scrollTop,Je=n.derivedRootEl.scrollLeft,Kt=n.derivedRootEl.clientHeight,ne=n.derivedRootEl.clientWidth,re=Mt-He,Le=rt-Je,oe=Math.max(0,Math.min(re,Kt)),be=Math.max(0,Math.min(Le,ne));if(n.overlayTextarea){let Pn=Number.parseFloat(p.paddingBottom)||0,_n=Number.parseFloat(p.paddingRight)||0,ii=Math.max(N*1.8,32),Fh=Math.max(N*.5,0);if(n.overlayTextarea.setTextIndent(J),F){let $l=Kt-Pn-oe-W;n.overlayTextarea.setConstraints(!0,Math.max($l+Fh,ii),ii);let Px=Math.max(8,y.width);n.overlayTextarea.setAnchorPositionVertical(pe+Px+Tt,Mt+W)}else{let $l=ne-_n-be;n.overlayTextarea.setConstraints(!1,Math.max($l+Fh,ii),ii),n.overlayTextarea.setAnchorPosition(rt,Fe+W-dt)}}n.updatePendingPosition(E-A,x+W),n.pendingCaretScroll&&(n.pendingCaretScroll=!1,Ol(n))}function Ol(n){var i;if(!n.derivedRootEl)return;if(n.ceImeMode){if(!n.sotEditor)return;let o=n.sotEditor.getSelection().head,s=n.findLineIndex(o);if(s===null)return;let a=n.lineRanges[s],l=n.getLineElement(s);if(!a||!l)return;n.ensureLineRendered(l);let c=a.to-a.from,u=Math.max(0,Math.min(o-a.from,c)),d=window.getComputedStyle(n.derivedRootEl).writingMode,h=(i=n.getCaretRectInLine(l,u,a,d))!=null?i:l.getBoundingClientRect();Dl(n,h);return}if(!n.caretEl||n.caretEl.style.display==="none")return;let t=n.derivedRootEl.getBoundingClientRect(),e=n.caretEl.getBoundingClientRect();Dl(n,e,t)}function Dl(n,t,e){if(!n.derivedRootEl)return;let i=e!=null?e:n.derivedRootEl.getBoundingClientRect(),r=24,o=0,s=0;t.left<i.left+r?o=t.left-(i.left+r):t.right>i.right-r&&(o=t.right-(i.right-r)),t.top<i.top+r?s=t.top-(i.top+r):t.bottom>i.bottom-r&&(s=t.bottom-(i.bottom-r)),o!==0&&(n.derivedRootEl.scrollLeft+=o),s!==0&&(n.derivedRootEl.scrollTop+=s)}var Lo=require("obsidian");async function rx(n,t){await n.workspaceController.openFile(t)}function ox(n){n.workspaceController.ensureRecentFilePathsInitialized()}function sx(n,t,e=!0){n.workspaceController.pushRecentFilePath(t,e)}function ax(n,t){n.workspaceController.recordRecentFile(t)}function lx(n){return n.workspaceController.buildFileSwitchItems()}function cx(n){n.workspaceController.openFileSwitcher()}function ux(n,t=""){n.workspaceController.openNewNoteModal(t)}async function dx(n,t,e){await n.workspaceController.createNewNote(t,e)}async function hx(n){let t=n.currentFile;if(!t){new Lo.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}let e=await n.plugin.modeManager.toggleReadingView(t,{targetLeaf:n.leaf,returnViewMode:"sot"});new Lo.Notice(e?"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u958B\u304D\u307E\u3057\u305F\u3002":"\u66F8\u7C4D\u30E2\u30FC\u30C9\u30D3\u30E5\u30FC\u3092\u9589\u3058\u307E\u3057\u305F\u3002",2e3)}async function px(n,t){await n.workspaceController.switchToFile(t)}async function fx(n){var e;if(!n.currentFile)return new Lo.Notice("\u5BFE\u8C61\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500),null;let t=await n.ensureMarkdownViewForFile(n.currentFile);return!t||!n.pairedMarkdownLeaf?(new Lo.Notice("MarkdownView \u304C\u898B\u3064\u304B\u3089\u306A\u3044\u305F\u3081\u5B9F\u884C\u3067\u304D\u307E\u305B\u3093\u3002",2500),null):(n.app.workspace.setActiveLeaf(n.pairedMarkdownLeaf,{focus:!0}),(e=t.editor)==null||e.focus(),t)}async function mx(n,t){return await n.workspaceController.ensureMarkdownViewForFile(t)}function gx(n,t){return n.workspaceController.findMarkdownLeafForFile(t)}function bx(n){n.workspaceController.registerWorkspacePairGuards()}function yx(n){n.workspaceController.registerEscapeGuard()}function vx(n){n.workspaceController.registerEscapeKeymap()}function Ex(n){return n.workspaceController.getValidPairedMarkdownLeaf()}function xx(n){n.workspaceController.ensurePairedMarkdownView()}function kx(n,t,e){return n.workspaceController.verifyPairedMarkdownViewFile(t,e)}function wx(n,t,e){n.workspaceController.applyPairedMarkdownBadge(t,e)}function Sx(n){n.workspaceController.clearPairedMarkdownBadge()}function Mx(n){n.workspaceController.applySoTTabBadge()}function Tx(n){n.workspaceController.clearSoTTabBadge()}function Cx(n,t){return n.workspaceController.getLeafTabHeaderEl(t)}function Lx(n,t){return n.workspaceController.getTabHeaderTitleHost(t)}function Rx(n,t){return n.workspaceController.getViewHeaderTitleHost(t)}var bt="tategaki-sot-wysiwyg-view",Dh="__tategakiInitialFile";var Fl=class extends Ie.ItemView{constructor(e,i){super(e);this.isReady=!1;this.pendingState=null;this.currentFile=null;this.viewRootEl=null;this.commandToolbar=null;this.commandContextMenu=null;this.commandAdapter=null;this.pageContainerEl=null;this.borderWrapperEl=null;this.contentWrapperEl=null;this.derivedRootEl=null;this.derivedContentEl=null;this.selectionLayerEl=null;this.caretEl=null;this.pendingEl=null;this.pendingSpacerEl=null;this.loadingOverlayEl=null;this.overlayTextarea=null;this.outlinePanel=null;this.listOutlinerCaptureHandler=null;this.sotEditor=null;this.detachSoTListener=null;this.renderPipeline=null;this.wheelThrottleTimer=null;this.scrollDebounceTimer=null;this.scrollDebounceRaf=null;this.scrollDebouncePendingTop=0;this.scrollDebouncePendingLeft=0;this.scrollDebounceLastTop=0;this.scrollDebounceLastLeft=0;this.scrollDebounceLastEventAt=0;this.scrollDragActive=!1;this.suspendedForInactive=!1;this.suspendedScrollTop=0;this.suspendedScrollLeft=0;this.pendingScrollRestoreTop=null;this.pendingScrollRestoreLeft=null;this.pendingFoldScrollLineIndex=null;this.activeTouchPointers=new Map;this.touchScrollStartX=0;this.touchScrollStartY=0;this.touchScrollLastY=0;this.touchScrollActive=!1;this.lineModelRecomputeTimer=null;this.lineModelRecomputeIdle=null;this.lineModelRecomputeStart=null;this.lineModelRecomputeEnd=null;this.boundWheelHandler=null;this.overlayFocused=!1;this.plainEditOverlayEl=null;this.plainEditRange=null;this.plainEditComposing=!1;this.plainEditCommitting=!1;this.plainEditOutsidePointerHandler=null;this.plainEditOverlayBaseRect=null;this.ceImeMode=!1;this.ceImeSuspended=!1;this.ceImeFallbackActive=!1;this.ceImeMappingFailureCount=0;this.ceImeMappingFailureAt=0;this.ceImeApplying=!1;this.ceImeComposeId=0;this.ceImeActiveComposeId=null;this.ceImeAppliedComposeId=0;this.ceImeComposing=!1;this.ceImeSelectionSyncing=!1;this.ceImeLastCompositionText="";this.ceImeLastBeforeInputText="";this.ceImeCompositionSelection=null;this.ceImeIgnoreNextInput=!1;this.ceImeExternalSuppressUntil=0;this.ceEditableStart=null;this.ceEditableEnd=null;this.ceSafetyCheckRaf=null;this.ceSafetyCheckAt=0;this.isPointerSelecting=!1;this.pointerHandler=null;this.selectionOverlay=null;this.ceSelectionSync=null;this.autoScrollSelecting=!1;this.pendingCaretScroll=!1;this.keepSoTActiveOnOutline=!1;this.pointerSelectAnchor=null;this.pointerSelectPointerId=null;this.pendingSelectionFrom=null;this.pendingSelectionTo=null;this.pendingSelectionLineStart=null;this.pendingSelectionLineEnd=null;this.pendingText="";this.pendingHold=!1;this.showPendingOverlay=!1;this.immediateRender=!1;this.loadingOverlayPending=!1;this.lineRanges=[];this.pendingLineIndex=null;this.pendingLocalOffset=null;this.pairedMarkdownLeaf=null;this.pairedMarkdownView=null;this.pairedMarkdownBadgeLeaf=null;this.pairedMarkdownBadgeEl=null;this.sotTabBadgeEl=null;this.pairedMismatchNotified=!1;this.suppressPairCheck=!1;this.recentFilePaths=[];this.recentFilePathsInitialized=!1;this.sourceModeEnabled=!1;this.sourceModeLineStart=null;this.sourceModeLineEnd=null;this.writingMode="vertical-rl";this.lineBlockKinds=[];this.lineCodeFenceInfo=[];this.lineCodeLang=[];this.lineCodeBlockPart=[];this.lineMathBlockStart=[];this.lineMathBlockEnd=[];this.lineCalloutType=[];this.lineCalloutIsTitle=[];this.lineCalloutBlockStart=[];this.lineCalloutBlockEnd=[];this.lineTableIsHeader=[];this.lineTableBlockStart=[];this.lineTableBlockEnd=[];this.lineDeflistBlockStart=[];this.lineDeflistBlockEnd=[];this.lineHeadingSectionEnd=[];this.lineHeadingHiddenBy=[];this.collapsedHeadingLines=new Set;this.footnoteDefinitionOrder=new Map;this.footnoteDefinitionText=new Map;this.linkReferenceMap=new Map;this.lineCache=new Ml;this.embedRenderChildren=new Map;this.mathRenderChildren=new Map;this.calloutRenderChildren=new Map;this.tableRenderChildren=new Map;this.deflistRenderChildren=new Map;this.hideFrontmatter=!1;this.frontmatterDetected=!1;this.collapsePreviewTooltip=null;this.plugin=i,this.scope=new Ie.Scope(this.app.scope),this.lineRenderer=new Tl(this),this.plainEditController=new xl(this),this.workspaceController=new Sl(this)}isLineInSourceMode(e){return!1}getCollapsedContentPreview(e,i){if(!this.sotEditor)return null;let r=this.lineHeadingSectionEnd[e];if(r===null||r<=e)return null;let o=this.sotEditor.getDoc(),s=[],a=0;for(let c=e+1;c<=r&&a<i;c++){if(this.lineHeadingHiddenBy[c]!==e)continue;let u=this.lineRanges[c];if(!u)continue;let d=o.slice(u.from,u.to).trim();d.length>0&&(s.push(d),a++)}return s.length===0?null:s.map(c=>c.length>50?c.slice(0,50)+"...":c).join(`
`)}showCollapsePreviewTooltip(e,i){this.hideCollapsePreviewTooltip();let r=document.createElement("div");r.className="tategaki-collapse-preview-tooltip",r.textContent=i,document.body.appendChild(r),this.collapsePreviewTooltip=r;let o=e.getBoundingClientRect(),s=r.getBoundingClientRect(),a=o.left+o.width/2-s.width/2,l=o.bottom+8;a<8&&(a=8),a+s.width>window.innerWidth-8&&(a=window.innerWidth-s.width-8),l+s.height>window.innerHeight-8&&(l=o.top-s.height-8),r.style.left=`${a}px`,r.style.top=`${l}px`}hideCollapsePreviewTooltip(){this.collapsePreviewTooltip&&(this.collapsePreviewTooltip.remove(),this.collapsePreviewTooltip=null)}setWritingMode(e){var r;if(this.writingMode=e,!this.derivedRootEl)return;this.derivedRootEl.dataset.writingMode=e,this.derivedRootEl.style.setProperty("--tategaki-writing-mode",e),this.derivedRootEl.scrollTop=0,this.derivedRootEl.scrollLeft=0;let i=(r=this.derivedContentEl)==null?void 0:r.querySelector(".tategaki-frontmatter");i&&Ih(i,e),this.updateWritingModeToggleUi(),this.updateMobileTouchAction(),this.pendingCaretScroll=!0,this.scheduleCaretUpdate(!0)}setLoadingOverlayVisible(e){this.loadingOverlayEl&&(this.loadingOverlayEl.style.display=e?"flex":"none")}showLoadingOverlay(){this.loadingOverlayPending=!0,this.setLoadingOverlayVisible(!0)}hideLoadingOverlay(){this.loadingOverlayPending=!1,this.setLoadingOverlayVisible(!1)}async toggleWritingMode(){let i=this.getEffectiveCommonSettings(this.plugin.settings).writingMode==="vertical-rl"?"horizontal-tb":"vertical-rl";await this.plugin.updateSettings({common:{...this.plugin.settings.common,writingMode:i}})}updateWritingModeToggleUi(){var e;(e=this.commandToolbar)==null||e.update()}getEffectiveCommonSettings(e){return typeof this.plugin.getEffectiveCommonSettings=="function"?this.plugin.getEffectiveCommonSettings():e.common}applySettingsToView(e){var f,g,m,b,y,v,E,x;if(!this.derivedRootEl)return;let i=this.getEffectiveCommonSettings(e);this.hideFrontmatter=(f=e.preview.hideFrontmatter)!=null?f:!1,this.invalidateLineCaches(),this.applyPageLayout(e);let r=(g=this.contentWrapperEl)!=null?g:this.derivedRootEl;r.style.setProperty("--tategaki-writing-mode",i.writingMode),r.style.setProperty("--tategaki-font-family",i.fontFamily),r.style.setProperty("--tategaki-font-size",`${i.fontSize}px`),r.style.setProperty("--tategaki-line-height",`${i.lineHeight}`),r.style.setProperty("--tategaki-letter-spacing",`${i.letterSpacing}em`),r.style.setProperty("--tategaki-text-color",i.textColor),r.style.setProperty("--tategaki-background-color",i.backgroundColor),r.style.setProperty("--tategaki-accent-color",i.accentColor);let o=this.resolveCaretColor(e,i);r.style.setProperty("--tategaki-caret-color",o);let s=(m=i.rubyVerticalGap)!=null?m:me.common.rubyVerticalGap,a=(b=i.rubyHorizontalGap)!=null?b:me.common.rubyHorizontalGap;r.style.setProperty("--tategaki-ruby-gap-vertical",`${s}em`),r.style.setProperty("--tategaki-ruby-gap-horizontal",`${a}em`);let c=Math.max(.2,Math.min(1,(y=i.rubySize)!=null?y:.5)).toString();r.style.setProperty("--tategaki-ruby-size",c),r.style.setProperty("--ruby-size",c),r.classList.add("text-justify-enabled"),r.style.textAlign="justify",r.style.textAlignLast="auto",r.style.setProperty("text-justify","inter-ideograph");let u=i.headingFontFamily||i.fontFamily,d=i.headingTextColor||i.textColor;r.style.setProperty("--tategaki-heading-font-family",u),r.style.setProperty("--tategaki-heading-text-color",d),this.writingMode!==i.writingMode?this.setWritingMode(i.writingMode):(this.derivedRootEl.dataset.writingMode=i.writingMode,this.derivedRootEl.style.setProperty("--tategaki-writing-mode",i.writingMode));let h=(v=e.wysiwyg.sotPaddingTop)!=null?v:32,p=(E=e.wysiwyg.sotPaddingBottom)!=null?E:16;this.derivedRootEl.style.paddingTop=`${h}px`,this.derivedRootEl.style.paddingBottom=`${p}px`,(x=this.commandToolbar)==null||x.update(),this.scheduleCaretUpdate(!0)}resolveCaretColor(e,i){var o,s;let r=(o=e.wysiwyg.caretColorMode)!=null?o:"accent";if(r==="text")return i.textColor;if(r==="custom"){let a=(s=e.wysiwyg.caretCustomColor)==null?void 0:s.trim();if(a)return a}return i.accentColor}applyPageLayout(e){var a;let i=this.getEffectiveCommonSettings(e),r=Number((a=i.pageScale)!=null?a:1),o=r>1,s=o?1:Math.max(.7,Math.min(1,r));this.borderWrapperEl&&(this.borderWrapperEl.style.transformOrigin="center center",this.borderWrapperEl.style.transform=`scale(${o?1:s})`,this.borderWrapperEl.style.boxShadow=o?"none":"0 6px 12px rgba(0,0,0,0.4)",this.borderWrapperEl.style.setProperty("background",i.backgroundColor,"important"),this.borderWrapperEl.style.setProperty("border","none","important"),this.borderWrapperEl.style.setProperty("outline","none","important")),this.pageContainerEl&&(this.pageContainerEl.style.alignItems=o?"stretch":"center",this.pageContainerEl.style.justifyContent=o?"stretch":"center",this.pageContainerEl.style.padding=o?"0":"40px 32px 22px 32px",this.pageContainerEl.style.background="transparent"),this.viewRootEl&&(this.viewRootEl.style.background=o?i.backgroundColor:i.pageBackgroundColor),this.contentWrapperEl&&(this.contentWrapperEl.style.background=i.backgroundColor,this.contentWrapperEl.style.color=i.textColor,this.contentWrapperEl.style.letterSpacing=`${i.letterSpacing}em`)}computeLineRangesFromLines(e){return UE(e)}shouldUseLineCache(){return this.lineCache.shouldUseLineCache()}invalidateLineCaches(){this.lineCache.clear()}getCachedBlockLineDecoration(e,i,r,o){return this.lineCache.getCachedBlockLineDecoration(e,i,r,o,()=>this.computeBlockLineDecoration(i,r,o,e))}recomputeLineBlockKinds(e){this.invalidateLineCaches();let i=KE({lines:e,collapsedHeadingLines:this.collapsedHeadingLines,normalizeLinkLabel:r=>this.normalizeLinkLabel(r)});this.lineBlockKinds=i.lineBlockKinds,this.lineCodeFenceInfo=i.lineCodeFenceInfo,this.lineCodeLang=i.lineCodeLang,this.lineCodeBlockPart=i.lineCodeBlockPart,this.lineMathBlockStart=i.lineMathBlockStart,this.lineMathBlockEnd=i.lineMathBlockEnd,this.lineCalloutType=i.lineCalloutType,this.lineCalloutIsTitle=i.lineCalloutIsTitle,this.lineCalloutBlockStart=i.lineCalloutBlockStart,this.lineCalloutBlockEnd=i.lineCalloutBlockEnd,this.lineTableIsHeader=i.lineTableIsHeader,this.lineTableBlockStart=i.lineTableBlockStart,this.lineTableBlockEnd=i.lineTableBlockEnd,this.lineDeflistBlockStart=i.lineDeflistBlockStart,this.lineDeflistBlockEnd=i.lineDeflistBlockEnd,this.lineHeadingSectionEnd=i.lineHeadingSectionEnd,this.lineHeadingHiddenBy=i.lineHeadingHiddenBy,this.footnoteDefinitionOrder=i.footnoteDefinitionOrder,this.footnoteDefinitionText=i.footnoteDefinitionText,this.linkReferenceMap=i.linkReferenceMap,this.collapsedHeadingLines=i.collapsedHeadingLines}createLinePrefixElement(e){var s,a;let i=(s=e.dataset.mdKind)!=null?s:"";if(i==="heading"){let l=Number.parseInt((a=e.dataset.line)!=null?a:"",10);if(!Number.isFinite(l))return null;let c=this.lineHeadingSectionEnd[l];if(c===null||c<=l)return null;let u=document.createElement("span");u.className="tategaki-md-heading-toggle",u.dataset.headingToggle="1";let d=e.dataset.headingCollapsed==="1";u.setAttribute("role","button"),u.setAttribute("aria-expanded",d?"false":"true"),u.setAttribute("aria-label",d?"\u898B\u51FA\u3057\u3092\u5C55\u958B":"\u898B\u51FA\u3057\u3092\u6298\u308A\u305F\u305F\u3080");let h=this.writingMode,p;return h==="horizontal-tb"?p=d?"circle-chevron-right":"circle-chevron-down":p=d?"circle-chevron-down":"circle-chevron-left",(0,Ie.setIcon)(u,p),u}if(i!=="task")return null;let r=document.createElement("span");r.className="tategaki-md-task-box",r.dataset.taskToggle="1",r.setAttribute("role","checkbox");let o=e.dataset.taskChecked==="1";return r.setAttribute("aria-checked",o?"true":"false"),r.setAttribute("aria-label",o?"\u5B8C\u4E86":"\u672A\u5B8C\u4E86"),r}toggleTaskForLineElement(e){var m,b,y,v;if(!this.sotEditor)return;let i=Number.parseInt((m=e.dataset.from)!=null?m:"0",10),r=Number.parseInt((b=e.dataset.to)!=null?b:"0",10),o=this.sotEditor.getDoc(),s=Math.max(0,Math.min(i,o.length)),a=Math.max(s,Math.min(r,o.length)),l=o.slice(s,a),c=l.match(/^[ \t]*([-+*])[ \t]+\[([ xX])\]/);if(!c)return;let u=l.indexOf("[",(y=c.index)!=null?y:0);if(u<0||u+2>=l.length)return;let d=u+1,p=((v=l[d])!=null?v:" ").toLowerCase()==="x"?" ":"x",f=s+d,g=this.sotEditor.getSelection();this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(f,f+1,p),this.sotEditor.setSelection(g)}toggleHeadingFold(e){if(!this.sotEditor||e<0||e>=this.lineRanges.length)return;let i=this.lineHeadingSectionEnd[e];if(i===null||i<=e)return;this.collapsedHeadingLines.has(e)?this.collapsedHeadingLines.delete(e):this.collapsedHeadingLines.add(e);let o=this.sotEditor.getDoc().split(`
`);this.recomputeLineBlockKinds(o);let s=this.lineRanges[e];if(s)this.setSelectionNormalized(s.from,s.from);else{let a=this.sotEditor.getSelection();this.setSelectionNormalized(a.anchor,a.head)}this.pendingFoldScrollLineIndex=e,this.pendingCaretScroll=!0,this.scheduleRender(!0)}collectHiddenRangesForLine(e,i,r,o){if(o!==null&&this.isLineInSourceMode(o))return[];let s=[],a=this.getCachedBlockLineDecoration(o,e,i,r);s.push(...a.hidden);let l=[],c=[];this.collectLinkRangesForLine(e,i,r,s,l,c),this.collectInlineMathRangesForLine(e,i,r,s);let u=this.getEditorViewForSyntax();if(u)try{(0,Bl.syntaxTree)(u.state).iterate({from:e,to:i,enter:d=>{var p,f;let h=d.type.name;if(this.isMarkdownSyntaxMarkerNode(h)){s.push({from:d.from,to:d.to});return}this.isInlineStyleNode(h)&&this.pushHiddenMarkersForStyleNode((f=(p=this.sotEditor)==null?void 0:p.getDoc())!=null?f:"",h,d.from,d.to,s)}})}catch(d){}return this.mergeRanges(s.map(d=>({from:Math.max(e,Math.min(d.from,i)),to:Math.max(e,Math.min(d.to,i))})).filter(d=>d.to>d.from))}getEditorViewForSyntax(){var i,r,o;let e=(o=(r=(i=this.sotEditor)==null?void 0:i.getEditorView)==null?void 0:r.call(i))!=null?o:null;return e!=null?e:null}normalizeOffsetToVisible(e,i){if(!this.sotEditor)return e;let r=this.sotEditor.getDoc().length,o=Math.max(0,Math.min(e,r)),s=this.findLineIndex(o);if(s===null)return o;let a=this.lineMathBlockStart[s],l=this.lineMathBlockEnd[s];if(a!==null&&l!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[a];if(E)return E.from}let c=this.lineCalloutBlockStart[s],u=this.lineCalloutBlockEnd[s];if(c!==null&&u!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[c];if(E)return E.from}let d=this.lineTableBlockStart[s],h=this.lineTableBlockEnd[s];if(d!==null&&h!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[d];if(E)return E.from}let p=this.lineDeflistBlockStart[s],f=this.lineDeflistBlockEnd[s];if(p!==null&&f!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[p];if(E)return E.from}let g=this.lineHeadingHiddenBy[s];if(g!==null&&!this.isLineInSourceMode(s)){let E=this.lineRanges[g];if(E)return E.from}if(this.isLineInSourceMode(s))return o;let m=this.lineRanges[s];if(!m)return o;let b=this.buildSegmentsForLine(m.from,m.to);if(b.length===0)return m.from;let y=b[0],v=b[b.length-1];if(o<=y.from)return y.from;if(o>=v.to)return v.to;for(let E=0;E<b.length;E+=1){let x=b[E];if(o>=x.from&&o<=x.to)return Math.max(x.from,Math.min(o,x.to));let k=b[E+1];if(k&&o>x.to&&o<k.from)return i?k.from:x.to}return o}setSelectionNormalized(e,i){if(!this.sotEditor)return;let r=i>=e,o=this.normalizeOffsetToVisible(e,r),s=this.normalizeOffsetToVisible(i,r);this.sotEditor.setSelection({anchor:o,head:s})}isInlineStyleNode(e){switch(e){case"StrongEmphasis":return"tategaki-md-strong";case"Emphasis":return"tategaki-md-em";case"CodeText":case"InlineCode":return"tategaki-md-code";case"Strikethrough":return"tategaki-md-strike";case"Highlight":return"tategaki-md-highlight";case"Link":case"LinkText":case"URL":return"tategaki-md-link";default:return null}}isMarkdownSyntaxMarkerNode(e){return e==="EmphasisMark"||e==="CodeMark"||e==="StrikethroughMark"||e==="HighlightMark"||/(Emphasis|Code|Strikethrough|Highlight)Mark$/.test(e)}pushHiddenMarkerPairIfMatched(e,i,r,o,s,a){r-i<o.length+s.length||e.slice(i,i+o.length)===o&&e.slice(r-s.length,r)===s&&(a.push({from:i,to:i+o.length}),a.push({from:r-s.length,to:r}))}pushHiddenMarkersForStyleNode(e,i,r,o,s){switch(i){case"StrongEmphasis":{this.pushHiddenMarkerPairIfMatched(e,r,o,"***","***",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"___","___",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"**","**",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"__","__",s);break}case"Emphasis":{this.pushHiddenMarkerPairIfMatched(e,r,o,"*","*",s),this.pushHiddenMarkerPairIfMatched(e,r,o,"_","_",s);break}case"Strikethrough":{this.pushHiddenMarkerPairIfMatched(e,r,o,"~~","~~",s);break}case"Highlight":{this.pushHiddenMarkerPairIfMatched(e,r,o,"==","==",s);break}case"CodeText":case"InlineCode":{let a=0;for(;r+a<o&&e[r+a]==="`";)a+=1;if(a<=0)break;let l="`".repeat(a);this.pushHiddenMarkerPairIfMatched(e,r,o,l,l,s);break}default:break}}normalizeLinkLabel(e){return e.replace(/\\(.)/g,"$1").trim().replace(/\s+/g," ").toLowerCase()}mergeRanges(e){if(e.length<=1)return e;let i=e.slice().sort((o,s)=>o.from-s.from||o.to-s.to),r=[];for(let o of i){let s=r[r.length-1];if(!s||o.from>s.to){r.push({from:o.from,to:o.to});continue}s.to=Math.max(s.to,o.to)}return r}collectLinkRangesForLine(e,i,r,o,s,a){let l=m=>Math.max(0,Math.min(m,r.length)),c=(m,b)=>{let y=e+l(m),v=e+l(b);v<=y||o.push({from:y,to:v})},u=(m,b,y,v)=>{let E=e+l(m),x=e+l(b);x<=E||(s.push({from:E,to:x,className:y}),v&&a.push({from:E,to:x,href:v}))},d=m=>{let b=0;for(let y=m-1;y>=0&&r[y]==="\\";y-=1)b+=1;return b%2===1},h=m=>{var v;let b=m.trim();if(b.length===0)return"";if(b.startsWith("<")){let E=b.indexOf(">");if(E>1)return b.slice(1,E)}let y=/^[^\s]+/.exec(b);return(v=y==null?void 0:y[0])!=null?v:b},p=null,f=r.length;for(let m=0;m<f;m+=1){let b=r[m];if(b==="`"&&!d(m)){let y=1;for(;m+y<f&&r[m+y]==="`";)y+=1;p===null?p=y:p===y&&(p=null),m+=y-1;continue}if(p===null){if(b==="<"){let y=r.indexOf(">",m+1);if(y>m+1){let v=r.slice(m+1,y);if(!/\s/.test(v)){let E=/^[a-z][a-z0-9+.-]*:\/\//i.test(v),x=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);if(E||x){let k=x?`mailto:${v}`:v;c(m,m+1),c(y,y+1),u(m+1,y,"tategaki-md-link",k),m=y;continue}}}}if(b==="!"&&!d(m)&&m+1<f&&r[m+1]==="["){let y=1,v=-1;for(let N=m+2;N<f;N+=1){let H=r[N];if(H==="\\"&&N+1<f){N+=1;continue}if(H==="["&&!d(N)&&(y+=1),H==="]"&&!d(N)&&(y-=1,y===0)){v=N;break}}if(v===-1)continue;let E=v+1;for(;E<f&&/\s/.test(r[E]);)E+=1;if(E>=f||r[E]!=="(")continue;let x=E,k=1,S=-1;for(let N=x+1;N<f;N+=1){let H=r[N];if(H==="\\"&&N+1<f){N+=1;continue}if(H==="("&&!d(N)&&(k+=1),H===")"&&!d(N)&&(k-=1,k===0)){S=N;break}}if(S===-1)continue;let w=m+2,C=v,I=r.slice(x+1,S),F=h(I);if(c(m,m+2),c(v,S+1),C>w)u(w,C,"tategaki-md-image",F||void 0);else if(F){let N=x+1;u(N,S,"tategaki-md-image",F),c(v,x+1),c(S,S+1)}m=S;continue}if(b==="!"&&!d(m)&&m+2<f&&r.slice(m+1,m+3)==="[["){let y=m+1,v=r.indexOf("]]",y+2);if(v===-1)continue;let E=r.slice(y+2,v),x=E.indexOf("|"),k=x>=0?E.slice(0,x):E,S=x>=0?E.slice(x+1):null,w=k.trim(),C=S!==null&&S.length>0?S:k,I=S!==null?y+2+x+1:y+2,F=I+C.length;if(c(m,m+1),c(y,y+2),c(v,v+2),x>=0&&c(y+2,y+2+x+1),w.length>0){let N=/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(w);u(I,F,N?"tategaki-md-image":"tategaki-md-embed",w)}m=v+1;continue}if(b==="["&&!d(m)&&m+1<f&&r[m+1]==="["){let y=m,v=r.indexOf("]]",y+2);if(v===-1)continue;let E=r.slice(y+2,v),x=E.indexOf("|"),k=x>=0?E.slice(0,x):E,S=x>=0?E.slice(x+1):null,w=k.trim(),C=S!==null&&S.length>0?S:k,I=S!==null?y+2+x+1:y+2,F=I+C.length;c(y,y+2),c(v,v+2),x>=0&&c(y+2,y+2+x+1),w.length>0&&u(I,F,"tategaki-md-link",w),m=v+1;continue}if(b==="["&&!d(m)&&m+2<f&&r[m+1]==="^"){let y=r.indexOf("]",m+2);if(y===-1||r.slice(m+2,y).length===0)continue;c(m,m+2),c(y,y+1),u(m+2,y,"tategaki-md-footnote-ref"),m=y;continue}if(b==="["&&!d(m)){if(m>0&&r[m-1]==="!"&&!d(m-1))continue;let y=1,v=-1;for(let w=m+1;w<f;w+=1){let C=r[w];if(C==="\\"&&w+1<f){w+=1;continue}if(C==="["&&!d(w)&&(y+=1),C==="]"&&!d(w)&&(y-=1,y===0)){v=w;break}}if(v===-1)continue;let E=v+1;for(;E<f&&/\s/.test(r[E]);)E+=1;let x=m+1,k=v,S=!1;if(E<f&&r[E]==="("){let w=E,C=1,I=-1;for(let F=w+1;F<f;F+=1){let N=r[F];if(N==="\\"&&F+1<f){F+=1;continue}if(N==="("&&!d(F)&&(C+=1),N===")"&&!d(F)&&(C-=1,C===0)){I=F;break}}if(I!==-1){let F=r.slice(w+1,I),N=h(F);c(m,m+1),c(v,I+1),N.length>0&&u(x,k,"tategaki-md-link",N),m=I,S=!0}}else if(E<f&&r[E]==="["){let w=E,C=r.indexOf("]",w+1);if(C!==-1){let I=r.slice(w+1,C),F=I.length>0?I:r.slice(x,k),N=this.linkReferenceMap.get(this.normalizeLinkLabel(F));N&&(c(m,m+1),c(v,v+1),c(w,C+1),u(x,k,"tategaki-md-link",N),m=C,S=!0)}}else{let w=r.slice(x,k),C=this.linkReferenceMap.get(this.normalizeLinkLabel(w));C&&(c(m,m+1),c(v,v+1),u(x,k,"tategaki-md-link",C),m=v,S=!0)}if(S)continue}if(b==="^"&&!d(m)&&m+1<f&&r[m+1]==="["){let y=-1;for(let v=m+2;v<f;v+=1)if(r[v]==="]"&&!d(v)){y=v;break}if(y===-1)continue;if(y<=m+2){m=y;continue}c(m,m+2),c(y,y+1),u(m+2,y,"tategaki-md-footnote-inline"),m=y;continue}}}let g=[];for(let m of o){let b=Math.max(e,Math.min(m.from,i)),y=Math.max(e,Math.min(m.to,i));y>b&&g.push({from:b,to:y})}o.splice(0,o.length,...g)}collectClearableLinkSpansForLine(e,i){let r=[],o=h=>Math.max(0,Math.min(h,i.length)),s=h=>e+o(h),a=(h,p,f)=>{let g=s(h),m=s(p);if(m<=g)return;let b=f.map(y=>({from:s(y.from),to:s(y.to)})).filter(y=>y.to>y.from);b.length!==0&&r.push({from:g,to:m,markers:b})},l=h=>{let p=0;for(let f=h-1;f>=0&&i[f]==="\\";f-=1)p+=1;return p%2===1},c=h=>{var g;let p=h.trim();if(p.length===0)return"";if(p.startsWith("<")){let m=p.indexOf(">");if(m>1)return p.slice(1,m)}let f=/^[^\s]+/.exec(p);return(g=f==null?void 0:f[0])!=null?g:p},u=null,d=i.length;for(let h=0;h<d;h+=1){let p=i[h];if(p==="`"&&!l(h)){let f=1;for(;h+f<d&&i[h+f]==="`";)f+=1;u===null?u=f:u===f&&(u=null),h+=f-1;continue}if(u===null){if(p==="<"){let f=i.indexOf(">",h+1);if(f>h+1){let g=i.slice(h+1,f);if(!/\s/.test(g)){let m=/^[a-z][a-z0-9+.-]*:\/\//i.test(g),b=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g);if(m||b){a(h+1,f,[{from:h,to:h+1},{from:f,to:f+1}]),h=f;continue}}}}if(p==="!"&&!l(h)&&h+2<d&&i[h+1]==="["&&i[h+2]==="["){let f=h,g=i.indexOf("]]",f+3);if(g===-1)continue;let m=i.slice(f+3,g),b=m.indexOf("|"),y=b>=0?m.slice(0,b):m,v=b>=0?m.slice(b+1):null,E=v!==null&&v.length>0?v:y,x=b>=0?f+3+b+1:f+3,k=x+E.length,S=[{from:f,to:f+3},{from:g,to:g+2}];b>=0&&S.push({from:f+3,to:f+3+b+1}),a(x,k,S),h=g+1;continue}if(p==="["&&!l(h)&&h+1<d&&i[h+1]==="["){let f=h,g=i.indexOf("]]",f+2);if(g===-1)continue;let m=i.slice(f+2,g),b=m.indexOf("|"),y=b>=0?m.slice(0,b):m,v=b>=0?m.slice(b+1):null,E=v!==null&&v.length>0?v:y,x=b>=0?f+2+b+1:f+2,k=x+E.length,S=[{from:f,to:f+2},{from:g,to:g+2}];b>=0&&S.push({from:f+2,to:f+2+b+1}),a(x,k,S),h=g+1;continue}if(p==="["&&!l(h)&&h+2<d&&i[h+1]==="^"){let f=i.indexOf("]",h+2);if(f===-1||i.slice(h+2,f).length===0)continue;a(h+2,f,[{from:h,to:h+2},{from:f,to:f+1}]),h=f;continue}if(p==="["&&!l(h)){if(h>0&&i[h-1]==="!"&&!l(h-1))continue;let f=1,g=-1;for(let E=h+1;E<d;E+=1){let x=i[E];if(x==="\\"&&E+1<d){E+=1;continue}if(x==="["&&!l(E)&&(f+=1),x==="]"&&!l(E)&&(f-=1,f===0)){g=E;break}}if(g===-1)continue;let m=g+1;for(;m<d&&/\s/.test(i[m]);)m+=1;let b=h+1,y=g,v=!1;if(m<d&&i[m]==="("){let E=m,x=1,k=-1;for(let S=E+1;S<d;S+=1){let w=i[S];if(w==="\\"&&S+1<d){S+=1;continue}if(w==="("&&!l(S)&&(x+=1),w===")"&&!l(S)&&(x-=1,x===0)){k=S;break}}if(k!==-1){let S=i.slice(E+1,k);c(S).length>0&&(a(b,y,[{from:h,to:h+1},{from:g,to:k+1}]),h=k,v=!0)}}else if(m<d&&i[m]==="["){let E=m,x=i.indexOf("]",E+1);if(x!==-1){let k=i.slice(E+1,x),S=k.length>0?k:i.slice(b,y);this.linkReferenceMap.get(this.normalizeLinkLabel(S))&&(a(b,y,[{from:h,to:h+1},{from:g,to:g+1},{from:E,to:x+1}]),h=x,v=!0)}}else{let E=i.slice(b,y);this.linkReferenceMap.get(this.normalizeLinkLabel(E))&&(a(b,y,[{from:h,to:h+1},{from:g,to:g+1}]),h=g,v=!0)}if(v)continue}if(p==="!"&&!l(h)&&h+1<d&&i[h+1]==="["){let f=1,g=-1;for(let w=h+2;w<d;w+=1){let C=i[w];if(C==="\\"&&w+1<d){w+=1;continue}if(C==="["&&!l(w)&&(f+=1),C==="]"&&!l(w)&&(f-=1,f===0)){g=w;break}}if(g===-1)continue;let m=g+1;for(;m<d&&/\s/.test(i[m]);)m+=1;if(m>=d||i[m]!=="(")continue;let b=m,y=1,v=-1;for(let w=b+1;w<d;w+=1){let C=i[w];if(C==="\\"&&w+1<d){w+=1;continue}if(C==="("&&!l(w)&&(y+=1),C===")"&&!l(w)&&(y-=1,y===0)){v=w;break}}if(v===-1)continue;let E=h+2,x=g,k=i.slice(b+1,v);if(c(k).length===0)continue;a(E,x,[{from:h,to:h+2},{from:g,to:v+1}]),h=v;continue}if(p==="^"&&!l(h)&&h+1<d&&i[h+1]==="["){let f=-1;for(let g=h+2;g<d;g+=1)if(i[g]==="]"&&!l(g)){f=g;break}if(f===-1)continue;if(f<=h+2){h=f;continue}a(h+2,f,[{from:h,to:h+2},{from:f,to:f+1}]),h=f;continue}}}return r}parseInlineMathSpansForLine(e){let i=[],r=s=>{let a=0;for(let l=s-1;l>=0&&e[l]==="\\";l-=1)a+=1;return a%2===1},o=null;for(let s=0;s<e.length;s+=1){let a=e[s];if(a==="`"&&!r(s)){let u=1;for(;s+u<e.length&&e[s+u]==="`";)u+=1;o===null?o=u:o===u&&(o=null),s+=u-1;continue}if(o!==null||a!=="$"||r(s)||e[s+1]==="$")continue;let l=-1;for(let u=s+1;u<e.length;u+=1)if(e[u]==="$"&&!r(u)&&e[u+1]!=="$"){l=u;break}if(l===-1)continue;let c=e.slice(s+1,l);if(c.trim().length===0){s=l;continue}i.push({open:s,close:l,source:c}),s=l}return i}collectInlineMathMarkerRangesForLine(e,i){let r=this.parseInlineMathSpansForLine(i),o=a=>Math.max(0,Math.min(a,i.length)),s=[];for(let a of r){let l=o(a.open),c=o(a.close),u=e+Math.min(l+1,i.length),d=e+Math.min(c,i.length),h=[{from:e+l,to:e+l+1},{from:e+c,to:e+c+1}];s.push({from:u,to:d,markers:h})}return s}collectInlineMathRangesForLine(e,i,r,o){let s=u=>Math.max(0,Math.min(u,r.length)),a=this.parseInlineMathSpansForLine(r),l=[];for(let u of a){let d=s(u.open),h=s(u.close),p=e+d,f=e+s(h+1);f<=p||(o.push({from:p,to:f}),l.push({kind:"math-inline",from:p,to:f,source:u.source}))}let c=[];for(let u of o){let d=Math.max(e,Math.min(u.from,i)),h=Math.max(e,Math.min(u.to,i));h>d&&c.push({from:d,to:h})}return o.splice(0,o.length,...c),l}getInlineWidgetsForLineRange(e){if(!this.sotEditor)return[];let r=this.sotEditor.getDoc().slice(e.from,e.to);return this.collectInlineMathRangesForLine(e.from,e.to,r,[])}computeBlockLineDecoration(e,i,r,o){var p,f,g,m,b,y,v,E,x,k,S,w,C,I,F,N,H;let s=[],a=[],l={},c={};if(o!==null){if(this.lineHeadingHiddenBy[o]!==null&&!this.isLineInSourceMode(o))return s.push("tategaki-md-heading-hidden"),l.mdKind="heading-hidden",a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c};let _=(p=this.lineBlockKinds[o])!=null?p:"normal";if(_==="math"||_==="math-fence"){let P=this.lineMathBlockStart[o],L=this.lineMathBlockEnd[o];return s.push("tategaki-md-math"),P!==null&&L!==null&&o===P?(s.push("tategaki-md-math-widget"),l.mdKind="math-widget",l.mathRange=`${P}-${L}`):(s.push("tategaki-md-math-hidden"),l.mdKind="math-hidden",P!==null&&L!==null&&(l.mathRange=`${P}-${L}`)),a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c}}if(_==="callout-title"||_==="callout"){let P=this.lineCalloutBlockStart[o],L=this.lineCalloutBlockEnd[o];if(P!==null&&L!==null&&!this.isLineInSourceMode(o)){let R=(f=this.lineCalloutType[o])!=null?f:"note";return s.push("tategaki-md-callout"),l.calloutType=R,l.calloutRange=`${P}-${L}`,a.push({from:e,to:i}),o===P?(s.push("tategaki-md-callout-widget"),l.mdKind="callout-widget"):(s.push("tategaki-md-callout-hidden"),l.mdKind="callout-hidden"),{classes:s,hidden:a,dataset:l,styleVars:c}}}if(_==="table-row"||_==="table-sep"){let P=this.lineTableBlockStart[o],L=this.lineTableBlockEnd[o];if(P!==null&&L!==null&&!this.isLineInSourceMode(o))return s.push("tategaki-md-table"),l.tableRange=`${P}-${L}`,a.push({from:e,to:i}),o===P?(s.push("tategaki-md-table-widget"),l.mdKind="table-widget"):(s.push("tategaki-md-table-hidden"),l.mdKind="table-hidden"),{classes:s,hidden:a,dataset:l,styleVars:c}}if(_==="deflist"){let P=this.lineDeflistBlockStart[o],L=this.lineDeflistBlockEnd[o];if(P!==null&&L!==null&&!this.isLineInSourceMode(o))return s.push("tategaki-md-deflist"),l.deflistRange=`${P}-${L}`,a.push({from:e,to:i}),o===P?(s.push("tategaki-md-deflist-widget"),l.mdKind="deflist-widget"):(s.push("tategaki-md-deflist-hidden"),l.mdKind="deflist-hidden"),{classes:s,hidden:a,dataset:l,styleVars:c}}if(_==="code-fence"){s.push("tategaki-md-codeblock"),s.push("tategaki-md-codeblock-fence"),l.mdKind="code-fence";let P=this.lineCodeFenceInfo[o];P&&(l.codeInfo=P);let L=this.lineCodeBlockPart[o];return L&&s.push(`tategaki-md-codeblock-part-${L}`),a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c}}if(_==="code"){s.push("tategaki-md-codeblock"),s.push("hljs"),l.mdKind="code";let P=this.lineCodeBlockPart[o];return P&&s.push(`tategaki-md-codeblock-part-${P}`),{classes:s,hidden:a,dataset:l,styleVars:c}}if(_==="frontmatter-fence")return s.push("tategaki-md-frontmatter"),s.push("tategaki-md-frontmatter-fence"),l.mdKind="frontmatter-fence",a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c};if(_==="frontmatter")return s.push("tategaki-md-frontmatter"),l.mdKind="frontmatter",{classes:s,hidden:a,dataset:l,styleVars:c}}if(r.length===0)return{classes:s,hidden:a,dataset:l,styleVars:c};{let _=r.match(/^[ \t]*!\[([^\]]*)\]\(([^)]+)\)[ \t]*$/);if(_&&_[0]&&_[2]){let L=(g=_[1])!=null?g:"",R=((m=_[2])!=null?m:"").trim(),T=R.startsWith("<")&&R.endsWith(">")?R.slice(1,-1):R,A=L,B=null;if(L.includes("|")){let[W,K]=L.split("|",2);A=W!=null?W:"";let J=(b=K==null?void 0:K.trim())!=null?b:"";/^\d+$/.test(J)&&(B=J)}return s.push("tategaki-md-image-widget"),l.mdKind="image-widget",l.imageSrc=T,l.imageAlt=A,B&&(l.imageWidth=B),a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c}}let P=r.match(/^[ \t]*!\[\[([^\]]+)\]\][ \t]*$/);if(P&&P[0]&&P[1]){let L=P[1].trim(),R=L.indexOf("|"),T=R>=0?L.slice(0,R).trim():L,A=R>=0?L.slice(R+1).trim():"";if(/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(T))return s.push("tategaki-md-image-widget"),l.mdKind="image-widget",l.imageSrc=T,l.imageAlt="",/^\d+$/.test(A)&&(l.imageWidth=A),a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c}}}{let _=r.match(/^[ \t]*!\[\[([^\]]+)\]\][ \t]*$/);if(_&&_[0]&&_[1]){let P=_[1].trim(),L=P.indexOf("|"),R=L>=0?P.slice(0,L).trim():P;if(!/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(R))return s.push("tategaki-md-embed-widget"),l.mdKind="embed-widget",l.embedTarget=P,a.push({from:e,to:i}),{classes:s,hidden:a,dataset:l,styleVars:c}}}let u=_=>{let P=0;for(let L of _)L==="	"?P+=4:P+=1;return P},d=_=>{let P=u(_);return P<=0?0:Math.max(0,Math.floor(P/4))},h=_=>{l.listDepth=String(_),c["--tategaki-sot-list-depth"]=String(_)};{let _=r.match(/^(#{1,6})([ \t]+)(.*)$/);if(_){let P=(v=(y=_[1])==null?void 0:y.length)!=null?v:1,L=((x=(E=_[1])==null?void 0:E.length)!=null?x:0)+((S=(k=_[2])==null?void 0:k.length)!=null?S:0);L>0&&a.push({from:e,to:e+L});let R=r.match(/[ \t]+#+[ \t]*$/);if(R&&R.index!==void 0){let T=e+R.index,A=e+r.length;A>T&&a.push({from:T,to:A})}if(s.push("tategaki-md-heading"),s.push(`tategaki-md-heading-${Math.max(1,Math.min(P,6))}`),l.mdKind="heading",l.mdLevel=String(P),o!==null){let T=this.lineHeadingSectionEnd[o];T!==null&&T>o&&(l.headingFoldable="1"),this.collapsedHeadingLines.has(o)&&(l.headingCollapsed="1")}}}if(s.length===0){let _=r.match(/^[ \t]{0,3}((?:> ?)+)(.*)$/);if(_&&_[1]){let P=_[1],L=((w=P.match(/>/g))!=null?w:[]).length,R=r.indexOf(P),T=R+P.length;T>R&&a.push({from:e+R,to:e+T}),s.push("tategaki-md-blockquote"),s.push(`tategaki-md-blockquote-depth-${Math.max(1,L)}`),l.mdKind="blockquote",l.mdDepth=String(L),c["--tategaki-sot-blockquote-depth"]=String(Math.max(0,L-1))}}if(s.length===0){let _=r.match(/^[ \t]*\[\^([^\]]+)\]:[ \t]*/);if(_&&_[0]){let P=_[0].length,L=(C=_[1])!=null?C:"";P>0&&a.push({from:e,to:e+P}),s.push("tategaki-md-footnote-def"),l.mdKind="footnote-def",l.footnoteId=L;let R=this.footnoteDefinitionOrder.get(L);R!==void 0?l.footnoteNumber=String(R):delete l.footnoteNumber}}if(s.length===0){let _=r.match(/^([ \t]*)([-+*])[ \t]+\[([ xX])\][ \t]+/);if(_&&_[0]){let P=_[0].length;a.push({from:e,to:e+P}),s.push("tategaki-md-list"),s.push("tategaki-md-task"),l.mdKind="task";let L=((I=_[3])!=null?I:" ").toLowerCase()==="x";l.taskChecked=L?"1":"0",l.listMarker="",h(d((F=_[1])!=null?F:""))}else{let P=r.match(/^([ \t]*)([-+*])[ \t]+/);if(P&&P[0]&&P[2]){let L=P[0].length;a.push({from:e,to:e+L}),s.push("tategaki-md-list"),l.mdKind="list",l.listMarker="";let R=d((N=P[1])!=null?N:"");h(R),l.listBullet=String(R%2)}else{let L=r.match(/^([ \t]*)(\d{1,9})([.)])[ \t]+/);if(L&&L[0]&&L[1]&&L[2]&&L[3]){let R=L[0].length;a.push({from:e,to:e+R}),s.push("tategaki-md-list"),l.mdKind="olist",l.listMarker=`${L[2]}${L[3]}`,h(d((H=L[1])!=null?H:""))}}}}return s.length===0&&r.match(/^[ \t]*([-*_])(?:[ \t]*\1){2,}[ \t]*$/)&&(a.push({from:e,to:i}),s.push("tategaki-md-hr"),l.mdKind="hr"),{classes:s,hidden:a,dataset:l,styleVars:c}}applyHiddenRangesToSegments(e,i){if(e.length===0||i.length===0)return e;let r=this.mergeRanges(i),o=[],s=0;for(let a of e){let l=a.from;for(;s<r.length&&r[s].to<=l;)s+=1;let c=s;for(;c<r.length;){let u=r[c];if(u.from>=a.to)break;let d=Math.min(a.to,u.from);if(d>l){let h=l-a.from,p=d-a.from,f=a.text.slice(h,p);f.length>0&&o.push({from:l,to:d,text:f,classNames:a.classNames,href:a.href,ruby:a.ruby})}if(l=Math.max(l,u.to),l>=a.to)break;c+=1}if(l<a.to){let u=l-a.from,d=a.text.slice(u);d.length>0&&o.push({from:l,to:a.to,text:d,classNames:a.classNames,href:a.href,ruby:a.ruby})}}return o}rangeOverlapsAny(e,i,r){for(let o of r)if(!(i<=o.from)&&!(e>=o.to))return!0;return!1}collectRubyRangesForLine(e,i,r,o,s,a){var d,h,p;if(!(((d=this.plugin.settings.wysiwyg)==null?void 0:d.enableRuby)!==!1)||!r.includes("\u300A"))return;let c=s.filter(f=>f.className==="tategaki-md-code").map(f=>({from:f.from,to:f.to})),u=Gt();for(let f of r.matchAll(u)){let g=(h=f[0])!=null?h:"",m=(p=f.index)!=null?p:-1;if(m<0)continue;let b=g.indexOf("\u300A"),y=g.indexOf("\u300B",b+1);if(b<0||y<0)continue;let v=g.startsWith("|")||g.startsWith("\uFF5C"),E=v?1:0,x=b,k=g.slice(E,x),S=g.slice(b+1,y);if(!k||!S)continue;let w=e+m+E,C=e+m+x;w>=C||w<e||C>i||this.rangeOverlapsAny(w,C,c)||this.rangeOverlapsAny(w,C,o)||this.rangeOverlapsAny(w,C,a)||(v&&o.push({from:e+m,to:e+m+1}),o.push({from:e+m+b,to:e+m+y+1}),a.push({from:w,to:C,ruby:S}))}}applyRubyRangesToSegments(e,i){if(e.length===0||i.length===0)return e;let r=[];for(let s of i)r.push(s.from,s.to);return this.splitSegmentsAtOffsets(e,r).map(s=>{let a=i.find(c=>s.from>=c.from&&s.to<=c.to);if(!a)return s;let l=s.classNames.includes("tategaki-aozora-ruby")?s.classNames:[...s.classNames,"tategaki-aozora-ruby"];return{...s,classNames:l,ruby:a.ruby}})}applyLinkRangesToSegments(e,i){if(e.length===0||i.length===0)return e;let r=[];for(let s of i)r.push(s.from,s.to);return this.splitSegmentsAtOffsets(e,r).map(s=>{let a=i.find(d=>s.from>=d.from&&s.to<=d.to);if(!a)return s;let l=s.classNames.includes("tategaki-md-link"),c=s.classNames.includes("tategaki-md-image")||s.classNames.includes("tategaki-md-embed"),u=l||c?s.classNames:[...s.classNames,"tategaki-md-link"];return{...s,classNames:u,href:a.href}})}buildSegmentsForLine(e,i){var P,L,R;if(!this.sotEditor)return[];let r=this.sotEditor.getDoc(),o=Math.max(0,Math.min(e,r.length)),s=Math.max(o,Math.min(i,r.length));if(o===s)return[];let a=this.findLineIndex(o),l=r.slice(o,s),c=a!==null&&this.isLineInSourceMode(a),u=a!==null&&(P=this.lineBlockKinds[a])!=null?P:"normal",d=a!==null&&(L=this.lineCodeLang[a])!=null?L:null,h=((R=this.plugin.settings.wysiwyg)==null?void 0:R.enableRuby)!==!1,p=this.shouldUseLineCache()&&a!==null;if(p&&a!==null){let T=this.lineCache.getCachedSegments(a,o,s,l,u,d,c,h);if(T)return T}let f=T=>(p&&a!==null&&this.lineCache.storeSegments(a,o,s,l,u,d,c,h,T),T);if(c)return f([{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}]);let g=this.getCachedBlockLineDecoration(a,o,s,l);if(a!==null){if(u==="code"){let T=d,A=this.buildCodeLineSegments(o,s,l,T);return f(this.applyHiddenRangesToSegments(A,g.hidden))}if(u==="code-fence"||u==="frontmatter"||u==="frontmatter-fence"){let T=[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}];return f(this.applyHiddenRangesToSegments(T,g.hidden))}}let m=this.getEditorViewForSyntax();if(!m){let T=[],A=[];for(let J of g.hidden)T.push(J);bl(o,s,l,T,A,this.rangeOverlapsAny.bind(this));let B=this.buildInlineSegmentsFallback(o,s,l),W=B!=null?B:[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}],K=this.applyHiddenRangesToSegments(W,T);return f(Lh(K,A))}let b=[],y=[],v=[],E=[];for(let T of g.hidden)b.push(T);this.collectLinkRangesForLine(o,s,l,b,y,v),this.collectInlineMathRangesForLine(o,s,l,b);try{(0,Bl.syntaxTree)(m.state).iterate({from:o,to:s,enter:T=>{let A=T.type.name;if(this.isMarkdownSyntaxMarkerNode(A)){b.push({from:T.from,to:T.to});return}let B=this.isInlineStyleNode(A);if(B&&(y.push({from:T.from,to:T.to,className:B}),this.pushHiddenMarkersForStyleNode(r,A,T.from,T.to,b),A==="StrongEmphasis")){let W=r.slice(T.from,T.from+3),K=r.slice(T.to-3,T.to);(W==="***"&&K==="***"||W==="___"&&K==="___")&&y.push({from:T.from,to:T.to,className:"tategaki-md-em"})}}})}catch(T){bl(o,s,l,b,y,this.rangeOverlapsAny.bind(this)),this.collectRubyRangesForLine(o,s,l,b,y,E);let A=this.buildInlineSegmentsFallback(o,s,l),B=A!=null?A:[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}],W=this.applyHiddenRangesToSegments(B,b),K=Lh(W,y),J=this.applyLinkRangesToSegments(K,v);return f(this.applyRubyRangesToSegments(J,E))}bl(o,s,l,b,y,this.rangeOverlapsAny.bind(this)),this.collectRubyRangesForLine(o,s,l,b,y,E);let x=this.buildInlineSegmentsFallback(o,s,l);if(!y.some(T=>T.className!=="tategaki-md-link")&&x){let T=this.applyHiddenRangesToSegments(x,b),A=this.applyLinkRangesToSegments(T,v);return f(this.applyRubyRangesToSegments(A,E))}if(b.length===0&&y.length===0&&E.length===0){let T=[{from:o,to:s,text:l,classNames:["tategaki-sot-run"]}];return f(this.applyHiddenRangesToSegments(T,b))}let S=this.mergeRanges(b.map(T=>({from:Math.max(o,Math.min(T.from,s)),to:Math.max(o,Math.min(T.to,s))})).filter(T=>T.to>T.from)),w=new Set([o,s]);for(let T of S)w.add(T.from),w.add(T.to);for(let T of y){let A=Math.max(o,Math.min(T.from,s)),B=Math.max(o,Math.min(T.to,s));B<=A||(w.add(A),w.add(B))}for(let T of E){let A=Math.max(o,Math.min(T.from,s)),B=Math.max(o,Math.min(T.to,s));B<=A||(w.add(A),w.add(B))}let C=Array.from(w).sort((T,A)=>T-A),I=[],F=(T,A)=>{for(let B of S){if(T>=B.from&&A<=B.to)return!0;if(A<=B.from)break}return!1},N=(T,A)=>{let B=["tategaki-sot-run"];for(let W of y)T>=W.from&&A<=W.to&&(B.includes(W.className)||B.push(W.className));return B},H=(T,A)=>{for(let B of v)if(T>=B.from&&A<=B.to)return B.href},_=(T,A)=>{for(let B of E)if(T>=B.from&&A<=B.to)return B.ruby};for(let T=0;T<C.length-1;T+=1){let A=C[T],B=C[T+1];if(B<=A||F(A,B))continue;let W=r.slice(A,B);if(W.length===0)continue;let K=N(A,B),J=_(A,B);J&&!K.includes("tategaki-aozora-ruby")&&K.push("tategaki-aozora-ruby");let Z=H(A,B),ee=I[I.length-1];ee&&ee.to===A&&ee.classNames.join("|")===K.join("|")&&ee.href===Z&&ee.ruby===J?(ee.to=B,ee.text+=W):I.push({from:A,to:B,text:W,classNames:K,href:Z,ruby:J})}return f(I)}buildCodeLineSegments(e,i,r,o){var p;if(r.length===0)return[];let s=[{from:e,to:i,text:r,classNames:["tategaki-sot-run"]}],a=o!=null&&o.trim()?o.trim():null,l;try{a&&ae.registered(a)?l=ae.highlight(a,r):a?l=ae.highlightAuto(r):l=ae.highlightAuto(r)}catch(f){return s}let c=[],u=e,d=(f,g)=>{if(f.length===0)return;let m=u,b=Math.min(i,m+f.length);if(b<=m)return;let y=f.slice(0,b-m),v=["tategaki-sot-run",...g];c.push({from:m,to:b,text:y,classNames:v}),u=b},h=(f,g)=>{var b,y,v,E;if(!f)return;let m=f.type;if(m==="text"){d(String((b=f.value)!=null?b:""),g);return}if(m==="element"){let x=(y=f.properties)==null?void 0:y.className,k=Array.isArray(x)?x.map(w=>String(w)):typeof x=="string"?x.split(/\s+/).filter(w=>w.length>0):[],S=g.concat(k);for(let w of(v=f.children)!=null?v:[])h(w,S);return}for(let x of(E=f.children)!=null?E:[])h(x,g)};for(let f of(p=l==null?void 0:l.children)!=null?p:[])h(f,[]);return u!==e+r.length?s:c.length>0?c:s}buildInlineSegmentsFallback(e,i,r){var x;if(!/(\*\*\*|___|\*\*|__|~~|==|`|\*|_)/.test(r))return null;let s=[],a=!1,l=!1,c=!1,u=!1,d=null,h=()=>{let k=["tategaki-sot-run"];return d!==null?(k.push("tategaki-md-code"),k):(a&&k.push("tategaki-md-strong"),l&&k.push("tategaki-md-em"),c&&k.push("tategaki-md-strike"),u&&k.push("tategaki-md-highlight"),k)},p=null,f=[],g=k=>{if(p===null)return;if(k<=p){p=null;return}let S=r.slice(p,k);if(S.length===0){p=null;return}s.push({from:e+p,to:e+k,text:S,classNames:f}),p=null},m=k=>{p===null&&(p=k,f=h())},b=(k,S)=>{let w=0;for(;k+w<r.length&&r[k+w]===S;)w+=1;return w},y=(k,S)=>r.indexOf(k,S)!==-1,v=(k,S,w)=>{for(let C of[3,2,1]){if(w<C)continue;let I=S.repeat(C);if(y(I,k+C))return C}return null},E=0;for(;E<r.length;){let k=(x=r[E])!=null?x:"";if(d===null){if(k==="`"){let S=b(E,"`"),w="`".repeat(S);if(y(w,E+S)){g(E),d=S,E+=S;continue}}else if(k==="~"&&r.slice(E,E+2)==="~~"){if(c||y("~~",E+2)){g(E),c=!c,E+=2;continue}}else if(k==="="&&r.slice(E,E+2)==="=="){if(u||y("==",E+2)){g(E),u=!u,E+=2;continue}}else if(k==="*"||k==="_"){let S=b(E,k),w=null;if(a&&l?S>=3?w=3:S>=2?w=2:w=1:a?S>=2?w=2:y(k,E+1)&&(w=1):l?S>=2&&y(k.repeat(2),E+2)?w=2:w=1:w=v(E,k,S),w!==null&&w>0){g(E),w===3?(a=!a,l=!l):w===2?a=!a:l=!l,E+=w;continue}}}else if(k==="`"){let S=b(E,"`");if(S===d){g(E),d=null,E+=S;continue}}m(E),E+=1}return g(r.length),s.length===0?null:s.filter(k=>k.to>k.from)}getViewType(){return bt}getDisplayText(){var e,i;return(i=(e=this.currentFile)==null?void 0:e.basename)!=null?i:"Tategaki"}getCurrentFilePath(){var e,i;return(i=(e=this.currentFile)==null?void 0:e.path)!=null?i:null}getState(){var e,i;return{filePath:(i=(e=this.currentFile)==null?void 0:e.path)!=null?i:void 0,writingMode:this.writingMode}}async setState(e,i){var a;if(!this.isReady){this.pendingState=e;return}let r=this.getEffectiveCommonSettings(this.plugin.settings).writingMode;e!=null&&e.writingMode&&(e.writingMode===r?this.setWritingMode(e.writingMode):this.setWritingMode(r));let o=(a=e==null?void 0:e.filePath)!=null?a:null;if(!o)return;let s=this.app.vault.getAbstractFileByPath(o);s instanceof Ie.TFile&&await this.openFile(s)}async onOpen(){var l;let e=this.leaf[Dh];if(!e){window.setTimeout(()=>{try{this.leaf.detach()}catch(c){}},0);return}delete this.leaf[Dh];let i=this.containerEl.children[1];this.viewRootEl=i;let r=jE(i,this.plugin.settings.common.backgroundColor),o=r.toolbarLeft,s=r.content;this.pageContainerEl=r.pageContainerEl,this.borderWrapperEl=r.borderWrapperEl,this.contentWrapperEl=r.contentWrapperEl,this.loadingOverlayEl=r.loadingOverlayEl,this.derivedRootEl=r.derivedRootEl,this.derivedContentEl=r.derivedContentEl,this.selectionLayerEl=r.selectionLayerEl,this.caretEl=r.caretEl,this.pendingEl=r.pendingEl,this.updateMobileTouchAction(),YE(this,i),this.commandAdapter=this.createCommandAdapter(),this.commandToolbar=new Cl(o,this.commandAdapter),this.register(()=>{var c;(c=this.commandToolbar)==null||c.destroy(),this.commandToolbar=null,this.commandAdapter=null}),this.overlayTextarea=new fl(this.derivedRootEl,{replaceSelection:c=>this.replaceSelection(c),backspace:()=>this.backspace(),del:()=>this.del(),undo:()=>{var c;return(c=this.sotEditor)==null?void 0:c.undo()},redo:()=>{var c;return(c=this.sotEditor)==null?void 0:c.redo()},selectAll:()=>this.selectAllText(),navigate:c=>this.handleNavigate(c),listOutliner:c=>this.handleListOutlinerKeydown(c),onPendingText:c=>this.updatePendingText(c)},{onFocus:()=>{this.overlayFocused=!0},onBlur:()=>{this.overlayFocused=!1}}),XE(this),this.setupListOutlinerCaptureHandler(),this.applySettingsToView(this.plugin.settings),this.registerWorkspacePairGuards(),this.applySoTTabBadge(),this.outlinePanel=new ml(s,{getItems:()=>this.getOutlineItems(),onSelect:c=>{this.setSelectionNormalized(c.offset,c.offset);let u=this.getLineElement(c.line);u&&(this.ensureLineRendered(u),u.scrollIntoView({block:"center",inline:"center"}),setTimeout(()=>{u.scrollIntoView({block:"center",inline:"center"})},100)),this.scheduleCaretUpdate(!0),this.focusInputSurface(!0)},onClose:()=>{this.focusInputSurface(!0)}}),this.selectionOverlay=new Al({getDerivedRootEl:()=>this.derivedRootEl,getDerivedContentEl:()=>this.derivedContentEl,getSelectionLayerEl:()=>this.selectionLayerEl,getSotEditor:()=>this.sotEditor,isCeImeMode:()=>this.ceImeMode,ensureLineRendered:c=>this.ensureLineRendered(c),getPendingSelectionState:()=>({pendingText:this.pendingText,pendingSelectionFrom:this.pendingSelectionFrom}),getLineRanges:()=>this.lineRanges,findLineIndex:c=>this.findLineIndex(c),getLineElement:c=>this.getLineElement(c),getLineTextNodes:c=>this.getLineTextNodes(c),findTextNodeAtOffset:(c,u)=>this.findTextNodeAtOffset(c,u),isPointerSelecting:()=>this.isPointerSelecting,isAutoScrollSelecting:()=>this.autoScrollSelecting}),this.renderPipeline=new Nl({getDerivedRootEl:()=>this.derivedRootEl,getDerivedContentEl:()=>this.derivedContentEl,getSotEditor:()=>this.sotEditor,getPluginSettings:()=>this.plugin.settings,getHideFrontmatter:()=>this.hideFrontmatter,getWritingMode:()=>this.writingMode,parseFrontmatter:c=>ME(c),setFrontmatterDetected:c=>{this.frontmatterDetected=c},computeLineRangesFromLines:c=>this.computeLineRangesFromLines(c),setLineRanges:c=>{this.lineRanges=c},getLineRanges:()=>this.lineRanges,recomputeLineBlockKinds:c=>this.recomputeLineBlockKinds(c),renderFrontmatter:(c,u)=>TE(c,u),applyFrontmatterWritingMode:(c,u)=>Ih(c,u),renderLine:(c,u,d)=>this.renderLine(c,u,d),renderLineLight:(c,u,d)=>this.renderLineLight(c,u,d),resetPendingRenderState:()=>this.resetPendingRenderState(),finalizeRender:(c,u)=>this.finalizeRender(c,u)}),this.ceSelectionSync=new Il({isCeImeMode:()=>this.ceImeMode,isCeImeComposing:()=>this.ceImeComposing,isCeImeSelectionSyncing:()=>this.ceImeSelectionSyncing,setCeImeSelectionSyncing:c=>{this.ceImeSelectionSyncing=c},isLeafActive:()=>this.isLeafActive(),getDerivedContentEl:()=>this.derivedContentEl,getSotEditor:()=>this.sotEditor,getLineRanges:()=>this.lineRanges,findLineIndex:c=>this.findLineIndex(c),getLineElement:c=>this.getLineElement(c),ensureLineRendered:c=>this.ensureLineRendered(c),resolveOffsetFromCaretPosition:(c,u,d)=>this.resolveOffsetFromCaretPosition(c,u,d),ensureCeInputPlaceholderNode:c=>this.ensureCeInputPlaceholderNode(c),findTextNodeAtOffset:(c,u)=>this.findTextNodeAtOffset(c,u),setSelectionNormalized:(c,u)=>this.setSelectionNormalized(c,u),recordCeMappingFailure:(c,u)=>this.recordCeMappingFailure(c,u),isSelectionInsideDerivedContent:c=>this.isSelectionInsideDerivedContent(c),getLineElementForNode:c=>this.getLineElementForNode(c),isUnsafeCeSelectionNode:c=>this.isUnsafeCeSelectionNode(c),scheduleCeSafetyCheck:()=>this.scheduleCeSafetyCheck()}),this.pointerHandler=new Rl({getSotEditor:()=>this.sotEditor,getDerivedRootEl:()=>this.derivedRootEl,getDerivedContentEl:()=>this.derivedContentEl,isCeImeMode:()=>this.ceImeMode,ensureLineRendered:c=>this.ensureLineRendered(c),getLineVisualRects:c=>this.getLineVisualRects(c),getLocalOffsetFromPoint:(c,u,d,h)=>this.getLocalOffsetFromPoint(c,u,d,h),normalizeOffsetToVisible:(c,u)=>this.normalizeOffsetToVisible(c,u),setSelectionNormalized:(c,u)=>this.setSelectionNormalized(c,u),scheduleCaretUpdate:c=>this.scheduleCaretUpdate(c),updateSelectionOverlay:()=>{var c;(c=this.selectionOverlay)==null||c.updateSelectionOverlay()},setAutoScrollSelecting:c=>{var u;this.autoScrollSelecting!==c&&(this.autoScrollSelecting=c,(u=this.selectionOverlay)==null||u.updateSelectionOverlay())},focusInputSurface:c=>this.focusInputSurface(c),syncSelectionToCe:()=>this.syncSelectionToCe(),toggleHeadingFold:c=>this.toggleHeadingFold(c),toggleTaskForLineElement:c=>this.toggleTaskForLineElement(c),openHref:c=>this.openHref(c),getPointerState:()=>({isPointerSelecting:this.isPointerSelecting,pointerSelectAnchor:this.pointerSelectAnchor,pointerSelectPointerId:this.pointerSelectPointerId}),setPointerState:c=>{c.isPointerSelecting!==void 0&&(this.isPointerSelecting=c.isPointerSelecting),c.pointerSelectAnchor!==void 0&&(this.pointerSelectAnchor=c.pointerSelectAnchor),c.pointerSelectPointerId!==void 0&&(this.pointerSelectPointerId=c.pointerSelectPointerId)}}),this.commandAdapter&&(this.commandContextMenu=new Ll(this.commandAdapter)),JE(this),this.isReady=!0,await this.openFile(e);let a=Ie.Platform.isMobile||Ie.Platform.isMobileApp;if(this.setCeImeMode(a),this.focusInputSurface(!0),this.pendingState){let c=this.pendingState;this.pendingState=null;let u=this.getEffectiveCommonSettings(this.plugin.settings).writingMode;c!=null&&c.writingMode&&(c.writingMode===u?this.setWritingMode(c.writingMode):this.setWritingMode(u));let d=(l=c==null?void 0:c.filePath)!=null?l:null;if(d){let h=this.app.vault.getAbstractFileByPath(d);h instanceof Ie.TFile&&await this.openFile(h)}}}async updateSettings(e){var r;let i=this.hideFrontmatter;this.applySettingsToView(e),(r=this.commandToolbar)==null||r.update(),i!==this.hideFrontmatter?this.scheduleRender(!0):this.scheduleRender()}async onClose(){var e,i,r,o,s;if(this.clearPairedMarkdownBadge(),this.clearSoTTabBadge(),(e=this.renderPipeline)==null||e.dispose(),this.renderPipeline=null,this.resetTouchScrollState(),this.wheelThrottleTimer!==null&&(window.clearTimeout(this.wheelThrottleTimer),this.wheelThrottleTimer=null),this.scrollDebounceTimer!==null&&(window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.scrollDebounceRaf!==null&&(window.cancelAnimationFrame(this.scrollDebounceRaf),this.scrollDebounceRaf=null),this.lineModelRecomputeTimer!==null&&(window.clearTimeout(this.lineModelRecomputeTimer),this.lineModelRecomputeTimer=null),this.lineModelRecomputeIdle!==null){let a=window.cancelIdleCallback;a==null||a(this.lineModelRecomputeIdle),this.lineModelRecomputeIdle=null}this.commitPlainEdit(!0,!1),this.unregisterPlainEditOutsidePointerHandler(),this.destroyPlainEditOverlay(),this.plainEditRange&&(this.clearPlainEditTargets(),this.plainEditRange=null),this.unloadRenderChildren(),(i=this.detachSoTListener)==null||i.call(this),this.detachSoTListener=null,(r=this.overlayTextarea)==null||r.destroy(),this.overlayTextarea=null,this.lineRenderer.dispose(),this.outlinePanel=null,(o=this.sotEditor)==null||o.destroy(),this.sotEditor=null,(s=this.commandToolbar)==null||s.destroy(),this.commandToolbar=null,this.commandContextMenu=null,this.commandAdapter=null,this.pageContainerEl=null,this.borderWrapperEl=null,this.contentWrapperEl=null,this.derivedContentEl=null,this.selectionLayerEl=null,this.pendingEl=null,this.pendingSpacerEl=null,this.loadingOverlayEl=null,this.currentFile=null,this.pairedMarkdownLeaf=null,this.pairedMarkdownView=null,this.pairedMarkdownBadgeLeaf=null,this.pairedMarkdownBadgeEl=null,this.sotTabBadgeEl=null,this.pairedMismatchNotified=!1,this.suppressPairCheck=!1,this.recentFilePaths=[],this.recentFilePathsInitialized=!1,this.sourceModeEnabled=!1,this.sourceModeLineStart=null,this.sourceModeLineEnd=null,this.writingMode="vertical-rl",this.isReady=!1}async openFile(e){await rx(this,e)}registerWorkspacePairGuards(){bx(this)}updateToolbar(){this.updateWritingModeToggleUi()}registerEscapeGuard(){yx(this)}unloadRenderChildren(){for(let e of this.embedRenderChildren.values())try{e.unload()}catch(i){}this.embedRenderChildren.clear();for(let e of this.mathRenderChildren.values())try{e.unload()}catch(i){}this.mathRenderChildren.clear();for(let e of this.calloutRenderChildren.values())try{e.unload()}catch(i){}this.calloutRenderChildren.clear();for(let e of this.tableRenderChildren.values())try{e.unload()}catch(i){}this.tableRenderChildren.clear();for(let e of this.deflistRenderChildren.values())try{e.unload()}catch(i){}this.deflistRenderChildren.clear()}suspendForInactiveLeaf(){var e;if(!this.suspendedForInactive&&!(!this.derivedRootEl||!this.derivedContentEl)){if(this.suspendedForInactive=!0,this.suspendedScrollTop=this.derivedRootEl.scrollTop,this.suspendedScrollLeft=this.derivedRootEl.scrollLeft,(e=this.renderPipeline)==null||e.suspend(),this.wheelThrottleTimer!==null&&(window.clearTimeout(this.wheelThrottleTimer),this.wheelThrottleTimer=null),this.scrollDebounceTimer!==null&&(window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.scrollDebounceRaf!==null&&(window.cancelAnimationFrame(this.scrollDebounceRaf),this.scrollDebounceRaf=null),this.lineModelRecomputeTimer!==null&&(window.clearTimeout(this.lineModelRecomputeTimer),this.lineModelRecomputeTimer=null),this.lineModelRecomputeIdle!==null){let i=window.cancelIdleCallback;i==null||i(this.lineModelRecomputeIdle),this.lineModelRecomputeIdle=null}this.resetPendingRenderState()}}resumeFromInactiveLeaf(){this.suspendedForInactive&&(this.suspendedForInactive=!1,this.pendingScrollRestoreTop=this.suspendedScrollTop,this.pendingScrollRestoreLeft=this.suspendedScrollLeft,this.scheduleRender(!0))}isLeafActive(){return this.app.workspace.activeLeaf===this.leaf}registerEscapeKeymap(){vx(this)}getValidPairedMarkdownLeaf(){return Ex(this)}runCommand(e){let i=()=>{var o;(o=this.commandToolbar)==null||o.update(),this.scheduleCaretUpdate(!0),this.focusInputSurface(!0)},r;if(this.ceImeMode?this.runCeMutation(()=>{r=e()}):r=e(),r&&typeof r.then=="function")return r.finally(()=>i());i()}wrapCommand(e){return()=>this.runCommand(e)}createCommandAdapter(){let e=i=>this.wrapCommand(i);return{app:this.app,isReadOnly:()=>!this.sotEditor,hasSelection:()=>this.hasSelection(),getWritingMode:()=>this.writingMode,toggleWritingMode:e(()=>this.toggleWritingMode()),toggleBold:e(()=>this.toggleInlineStyle("bold")),isBoldActive:()=>this.isInlineStyleActive("tategaki-md-strong"),toggleItalic:e(()=>this.toggleInlineStyle("italic")),isItalicActive:()=>this.isInlineStyleActive("tategaki-md-em"),toggleStrikethrough:e(()=>this.toggleInlineStyle("strike")),isStrikethroughActive:()=>this.isInlineStyleActive("tategaki-md-strike"),toggleHighlight:e(()=>this.toggleInlineStyle("highlight")),isHighlightActive:()=>this.isInlineStyleActive("tategaki-md-highlight"),toggleInlineCode:e(()=>this.toggleInlineStyle("code")),isInlineCodeActive:()=>this.isInlineStyleActive("tategaki-md-code"),setHeading:i=>this.runCommand(()=>this.setHeading(i)),clearHeading:e(()=>this.clearHeading()),getHeadingLevel:()=>this.getHeadingLevel(),toggleBulletList:e(()=>this.toggleList("bullet")),isBulletListActive:()=>this.isBulletListActive(),toggleOrderedList:e(()=>this.toggleList("ordered")),isOrderedListActive:()=>this.isOrderedListActive(),toggleBlockquote:e(()=>this.toggleBlockquote()),isBlockquoteActive:()=>this.isBlockquoteActive(),toggleCodeBlock:e(()=>this.toggleCodeBlock()),isCodeBlockActive:()=>this.isCodeBlockActive(),insertLink:e(()=>this.insertLink()),insertRuby:e(()=>this.insertRuby()),insertHorizontalRule:e(()=>this.insertHorizontalRule()),openSettings:e(()=>this.openSettingsPanel()),openOutline:()=>this.openOutline(),clearFormatting:e(()=>this.clearFormatting()),toggleRuby:e(()=>this.toggleRubyVisibility()),isRubyEnabled:()=>{var i;return((i=this.plugin.settings.wysiwyg)==null?void 0:i.enableRuby)!==!1},openFileSwitcher:e(()=>this.openFileSwitcher()),toggleReadingMode:e(()=>this.toggleReadingMode()),isReadingMode:()=>!1,undo:e(()=>{var i;return(i=this.sotEditor)==null?void 0:i.undo()}),redo:e(()=>{var i;return(i=this.sotEditor)==null?void 0:i.redo()}),canUndo:()=>!!this.sotEditor,canRedo:()=>!!this.sotEditor,toggleSourceMode:e(()=>this.toggleSourceMode()),isSourceMode:()=>this.sourceModeEnabled,toggleCeImeMode:e(()=>this.toggleCeImeMode()),isCeImeMode:()=>this.ceImeMode,cut:e(()=>this.cutSelection()),copy:e(()=>this.copySelection()),paste:e(()=>this.pasteFromClipboard()),selectAll:e(()=>this.selectAllText())}}hasSelection(){var i,r;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let o=(i=this.plainEditOverlayEl.selectionStart)!=null?i:0,s=(r=this.plainEditOverlayEl.selectionEnd)!=null?r:o;return o!==s}if(!this.sotEditor)return!1;let e=this.sotEditor.getSelection();return e.anchor!==e.head}getSelectionText(){var o;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let s=In(this.plainEditOverlayEl);return(o=s==null?void 0:s.text)!=null?o:""}if(!this.sotEditor)return"";let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);return i===r?"":this.sotEditor.getDoc().slice(i,r)}selectAllText(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){this.plainEditOverlayEl.focus({preventScroll:!0}),this.plainEditOverlayEl.select();return}if(!this.sotEditor)return;let e=this.sotEditor.getDoc().length;this.setSelectionNormalized(0,e),this.scheduleCaretUpdate()}async copySelection(){let e=this.getSelectionText();if(!e)return;await this.writeTextToClipboard(e)||document.execCommand("copy")}async cutSelection(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){let r=this.getSelectionText();if(!r)return;await this.writeTextToClipboard(r)||document.execCommand("copy"),An(this.plainEditOverlayEl,"",{onResize:()=>this.adjustPlainEditOverlaySize()});return}let e=this.getSelectionText();if(!e)return;await this.writeTextToClipboard(e)||document.execCommand("copy"),this.replaceSelection("")}async pasteFromClipboard(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){let r=await this.readTextFromClipboard();if(!r){this.plainEditOverlayEl.focus({preventScroll:!0}),document.execCommand("paste");return}let o=r.replace(/\r\n/g,`
`).replace(/\r/g,`
`);An(this.plainEditOverlayEl,o,{onResize:()=>this.adjustPlainEditOverlaySize()});return}if(!this.sotEditor)return;let e=await this.readTextFromClipboard();if(!e){if(this.ceImeMode)return;document.execCommand("paste");return}let i=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(this.ceImeMode){let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);this.applyCeReplaceRange(o,s,i);return}this.updatePendingText("",!0),this.replaceSelection(i)}async writeTextToClipboard(e){var i;if(!e)return!1;if((i=navigator.clipboard)!=null&&i.writeText)try{return await navigator.clipboard.writeText(e),!0}catch(r){le("Tategaki SoT: clipboard write failed",r)}return this.fallbackCopyText(e)}async readTextFromClipboard(){var e;if((e=navigator.clipboard)!=null&&e.readText)try{return await navigator.clipboard.readText()}catch(i){le("Tategaki SoT: clipboard read failed",i)}return""}fallbackCopyText(e){let i=document.createElement("textarea");i.value=e,i.style.position="fixed",i.style.top="-9999px",i.style.left="-9999px",i.style.opacity="0",document.body.appendChild(i),i.focus(),i.select();let r=!1;try{r=document.execCommand("copy")}catch(o){r=!1}return i.remove(),r}toggleInlineStyle(e){if(this.sourceModeEnabled&&this.plainEditOverlayEl)switch(e){case"bold":kr(this.plainEditOverlayEl,"**","**",()=>this.adjustPlainEditOverlaySize());return;case"italic":kr(this.plainEditOverlayEl,"*","*",()=>this.adjustPlainEditOverlaySize());return;case"strike":kr(this.plainEditOverlayEl,"~~","~~",()=>this.adjustPlainEditOverlaySize());return;case"highlight":kr(this.plainEditOverlayEl,"==","==",()=>this.adjustPlainEditOverlaySize());return;case"code":kr(this.plainEditOverlayEl,"`","`",()=>this.adjustPlainEditOverlaySize());return}if(this.sotEditor)switch(e){case"bold":this.toggleInlineMarkup("**","**",[{open:"**",close:"**"},{open:"__",close:"__"}],"tategaki-md-strong");return;case"italic":this.toggleInlineMarkup("*","*",[{open:"*",close:"*"},{open:"_",close:"_"}],"tategaki-md-em",!1);return;case"strike":this.toggleInlineMarkup("~~","~~",[],"tategaki-md-strike");return;case"highlight":this.toggleInlineMarkup("==","==",[],"tategaki-md-highlight");return;case"code":this.toggleInlineMarkup("`","`",[],"tategaki-md-code");return}}clearFormatting(){if(this.sourceModeEnabled&&this.plainEditOverlayEl){CE(this.plainEditOverlayEl,()=>this.adjustPlainEditOverlaySize());return}if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(i===r)return;this.updatePendingText("",!0),this.immediateRender=!0;let o=this.getEditorViewForSyntax(),s=6,a=0,l=!1;for(;a<s;){let c=this.sotEditor.getDoc(),u=this.collectClearFormattingRemovals(i,r,c,o);if(u.length===0)break;l=!0;let d=this.mergeRanges(u).sort((f,g)=>g.from-f.from),h=i,p=r;for(let f of d){let g=f.to-f.from;g<=0||(this.sotEditor.replaceRange(f.from,f.to,""),f.to<=h?(h-=g,p-=g):f.to<=p&&(p-=g))}if(i=h,r=p,a+=1,i===r)break}l&&(this.setSelectionNormalized(i,r),this.focusInputSurface(!0))}collectClearFormattingRemovals(e,i,r,o){let s=this.findLineIndex(e),a=this.findLineIndex(i);if(s===null||a===null)return[];let l=[];for(let c=s;c<=a;c+=1){let u=this.lineRanges[c];if(!u)continue;let d=u.from,h=u.to;if(h<e||d>i)continue;let p=r.slice(d,h),f=this.getCachedBlockLineDecoration(c,d,h,p);for(let b of f.hidden)l.push(b);if(o)try{(0,Bl.syntaxTree)(o.state).iterate({from:d,to:h,enter:b=>{let y=b.type.name;if(!(b.to<=e||b.from>=i||b.to<=b.from)){if(this.isMarkdownSyntaxMarkerNode(y)){l.push({from:b.from,to:b.to});return}this.isInlineStyleNode(y)&&this.pushHiddenMarkersForStyleNode(r,y,b.from,b.to,l)}}})}catch(b){}let g=this.collectClearableLinkSpansForLine(d,p);for(let b of g)b.to<=e||b.from>=i||l.push(...b.markers);let m=this.collectInlineMathMarkerRangesForLine(d,p);for(let b of m)b.to<=e||b.from>=i||l.push(...b.markers)}return this.collectInlineStyleRemovalsForRange(e,i,"tategaki-md-strong",[{open:"**",close:"**"},{open:"__",close:"__"}],r,l),this.collectInlineStyleRemovalsForRange(e,i,"tategaki-md-em",[{open:"_",close:"_"},{open:"*",close:"*"}],r,l),this.collectInlineStyleRemovalsForRange(e,i,"tategaki-md-strike",[{open:"~~",close:"~~"}],r,l),this.collectInlineStyleRemovalsForRange(e,i,"tategaki-md-highlight",[{open:"==",close:"=="}],r,l),this.collectInlineStyleRemovalsForRange(e,i,"tategaki-md-code",[{open:"`",close:"`"}],r,l),l}toggleInlineMarkup(e,i,r=[],o,s=!0){var F;if(!this.sotEditor)return;let a=this.sotEditor.getSelection(),l=Math.min(a.anchor,a.head),c=Math.max(a.anchor,a.head),u=a.head>=a.anchor,d=r.length>0?r:[{open:e,close:i}];if(this.updatePendingText("",!0),this.immediateRender=!0,l===c)return;let h=o?this.isInlineStyleActive(o):!1,p=!h&&o?this.hasInlineClassBefore(l,o):!1,f=!h&&o?this.hasInlineClassAfter(c,o):!1,g=l,m=c;if(h&&o){let N=this.stripInlineStyleInSelection(g,m,o,d);if(g=N.from,m=N.to,N.removedOnly){this.setSelectionNormalized(g,m),this.focusInputSurface(!0);return}}let b=this.sotEditor.getDoc();for(let N of d){let H=N.open.length,_=N.close.length;if(!(g<H||m+_>b.length)&&b.slice(g-H,g)===N.open&&b.slice(m,m+_)===N.close){let P=b.slice(g,m);this.sotEditor.replaceRange(g-H,m+_,P);let L=g-H,R=m-H;u?this.setSelectionNormalized(L,R):this.setSelectionNormalized(R,L),this.focusInputSurface(!0);return}}let y=s?(F=this.resolveInlineMarkerPair(b,g,m,d))!=null?F:{open:e,close:i}:{open:e,close:i},v=y.open,E=y.close,x=v.length>0&&v.split("").every(N=>N===v[0])?v[0]:"",k=g,S=m;if(x){let N=this.getMarkerRunLimit(x),H=b,_=this.countMarkerRun(H,k-1,-1,x),P=this.countMarkerRun(H,S,1,x);if(p){let L=v.length;_>=L&&k-L>=0?(this.sotEditor.replaceRange(k-L,k,""),k-=L,S-=L,H=this.sotEditor.getDoc(),P=this.countMarkerRun(H,S,1,x),_=Math.max(0,_-L)):p=!1,p&&(v="")}if(!p&&_+v.length>N)return;if(f){let L=E.length;P>=L&&S+L<=H.length?(this.sotEditor.replaceRange(S,S+L,""),H=this.sotEditor.getDoc(),P=Math.max(0,P-L)):f=!1,f&&(E="")}if(!f&&P+E.length>N)return;b=H}let w=b.slice(k,S);this.sotEditor.replaceRange(k,S,`${v}${w}${E}`);let C=k+v.length,I=C+w.length;u?this.setSelectionNormalized(C,I):this.setSelectionNormalized(I,C),this.focusInputSurface(!0)}applyTextChangesWithSelection(e,i,r){if(!this.sotEditor)return{anchor:i,head:r};let o=e.slice().sort((l,c)=>c.from-l.from),s=i,a=r;for(let l of o){let c=l.insert.length-(l.to-l.from);this.sotEditor.replaceRange(l.from,l.to,l.insert);let u=d=>d>l.to?d+c:d>=l.from?l.from+l.insert.length:d;s=u(s),a=u(a)}return{anchor:s,head:a}}getOutlineItems(){var s,a,l;if(!this.sotEditor)return[];let i=this.sotEditor.getDoc().split(`
`),r=this.lineRanges.length===i.length?this.lineRanges:this.computeLineRangesFromLines(i),o=[];for(let c=0;c<i.length;c+=1){if(this.lineBlockKinds[c]!=="normal")continue;let u=gl((s=i[c])!=null?s:"");if(!u.hasHeading)continue;let d=u.content.length>0?u.content:"\uFF08\u7121\u984C\uFF09",h=(l=(a=r[c])==null?void 0:a.from)!=null?l:0;o.push({line:c,level:u.level,text:d,offset:h})}return o}getHeadingLevel(){if(!this.sotEditor)return 0;let e=this.sotEditor.getSelection(),i=this.findLineIndex(e.head);if(i===null||this.lineBlockKinds[i]!=="normal")return 0;let r=this.lineRanges[i];if(!r)return 0;let o=this.sotEditor.getDoc().slice(r.from,r.to);return gl(o).level}clearHeading(){this.setHeading(0)}getListKindAtSelection(){if(!this.sotEditor)return"none";let e=this.sotEditor.getSelection(),i=this.findLineIndex(e.head);if(i===null||this.isLineInSourceMode(i)||this.lineBlockKinds[i]!=="normal")return"none";let r=this.lineRanges[i];if(!r)return"none";let o=this.sotEditor.getDoc().slice(r.from,r.to);return gt(o).kind}isBlockquoteActive(){if(!this.sotEditor)return!1;let e=this.sotEditor.getSelection(),i=this.findLineIndex(e.head);if(i===null||this.isLineInSourceMode(i)||this.lineBlockKinds[i]!=="normal")return!1;let r=this.lineRanges[i];if(!r)return!1;let o=this.sotEditor.getDoc().slice(r.from,r.to);return Ch(o)}isCodeBlockActive(){var o;if(!this.sotEditor)return!1;let e=this.sotEditor.getSelection(),i=this.findLineIndex(e.head);if(i===null)return!1;let r=(o=this.lineBlockKinds[i])!=null?o:"normal";return r==="code"||r==="code-fence"}isBulletListActive(){let e=this.getListKindAtSelection();return e==="bullet"||e==="task"}isOrderedListActive(){return this.getListKindAtSelection()==="ordered"}setHeading(e){if(!this.sotEditor)return;let i=Math.max(0,Math.min(e,6)),r=this.sotEditor.getSelection(),o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head),a=this.findLineIndex(o),l=this.findLineIndex(s);if(a===null||l===null)return;let c=this.lineRanges[l];c&&s===c.from&&s>o&&(l=Math.max(a,l-1));let u=this.sotEditor.getDoc(),d=[];for(let g=a;g<=l;g+=1){if(this.lineBlockKinds[g]!=="normal")continue;let m=this.lineRanges[g];if(!m)continue;let b=u.slice(m.from,m.to),y=gl(b);d.push({index:g,range:m,lineText:b,info:y})}if(d.length===0)return;let h=i===0||d.every(g=>g.info.hasHeading&&g.info.level===i),p=[];for(let g of d){let{range:m,lineText:b,info:y}=g,v=b;if(h)if(y.hasHeading)v=`${y.prefix}${y.content}`;else continue;else{let E=y.content.replace(/^[ \t]+/,"");v=`${y.prefix}${"#".repeat(i)} ${E}`}v!==b&&p.push({from:m.from,to:m.to,insert:v})}if(p.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let f=this.applyTextChangesWithSelection(p,r.anchor,r.head);this.setSelectionNormalized(f.anchor,f.head),this.focusInputSurface(!0)}toggleList(e){if(!this.sotEditor)return;let i=this.sotEditor.getSelection(),r=Math.min(i.anchor,i.head),o=Math.max(i.anchor,i.head),s=this.findLineIndex(r),a=this.findLineIndex(o);if(s===null||a===null)return;let l=this.lineRanges[a];l&&o===l.from&&o>r&&(a=Math.max(s,a-1));let c=this.sotEditor.getDoc(),u=[];for(let g=s;g<=a;g+=1){if(this.lineBlockKinds[g]!=="normal"||this.isLineInSourceMode(g))continue;let m=this.lineRanges[g];if(!m)continue;let b=c.slice(m.from,m.to),y=gt(b);u.push({range:m,lineText:b,info:y})}if(u.length===0)return;let d=g=>e==="bullet"?g.kind==="bullet"||g.kind==="task":g.kind==="ordered",h=u.every(g=>d(g.info)),p=[];for(let g of u){let{range:m,lineText:b,info:y}=g,v=b;if(h){if(!d(y))continue;v=`${y.prefix}${y.indent}${y.content}`}else{let E=e==="bullet"?"- ":"1. ";v=`${y.prefix}${y.indent}${E}${y.content}`}v!==b&&p.push({from:m.from,to:m.to,insert:v})}if(p.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let f=this.applyTextChangesWithSelection(p,i.anchor,i.head);this.setSelectionNormalized(f.anchor,f.head),this.focusInputSurface(!0)}toggleBlockquote(){var p,f,g,m;if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(i),s=this.findLineIndex(r);if(o===null||s===null)return;let a=this.lineRanges[s];a&&r===a.from&&r>i&&(s=Math.max(o,s-1));let l=this.sotEditor.getDoc(),c=[];for(let b=o;b<=s;b+=1){if(this.lineBlockKinds[b]!=="normal"||this.isLineInSourceMode(b))continue;let y=this.lineRanges[b];if(!y)continue;let v=l.slice(y.from,y.to);c.push({range:y,lineText:v})}if(c.length===0)return;let u=c.every(b=>Ch(b.lineText)),d=[];for(let b of c){let{range:y,lineText:v}=b,E=v;if(u){let x=v.match(/^([ \t]{0,3})(> ?)(.*)$/);if(!x)continue;E=`${(p=x[1])!=null?p:""}${(f=x[3])!=null?f:""}`}else{let x=v.match(/^([ \t]{0,3})(.*)$/),k=(g=x==null?void 0:x[1])!=null?g:"",S=(m=x==null?void 0:x[2])!=null?m:"";E=`${k}> ${S}`}E!==v&&d.push({from:y.from,to:y.to,insert:E})}if(d.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let h=this.applyTextChangesWithSelection(d,e.anchor,e.head);this.setSelectionNormalized(h.anchor,h.head),this.focusInputSurface(!0)}getCodeBlockRangeForLine(e){var s,a,l;if(e<0||e>=this.lineBlockKinds.length)return null;let i=(s=this.lineBlockKinds[e])!=null?s:"normal";if(i!=="code"&&i!=="code-fence")return null;let r=e;for(;r>0;){let c=(a=this.lineBlockKinds[r-1])!=null?a:"normal";if(c!=="code"&&c!=="code-fence")break;r-=1}let o=e;for(;o+1<this.lineBlockKinds.length;){let c=(l=this.lineBlockKinds[o+1])!=null?l:"normal";if(c!=="code"&&c!=="code-fence")break;o+=1}return{start:r,end:o}}getLineRemovalRange(e,i){let r=this.lineRanges[e];if(!r)return null;let o=r.from,s=r.to;return s<i.length&&i[s]===`
`?s+=1:o>0&&i[o-1]===`
`&&(o-=1),s<=o?null:{from:o,to:s}}toggleCodeBlock(){var h,p,f;if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(i),s=this.findLineIndex(r);if(o===null||s===null)return;let a=this.lineRanges[s];a&&r===a.from&&r>i&&(s=Math.max(o,s-1));let l=this.sotEditor.getDoc(),c=!0;for(let g=o;g<=s;g+=1){let m=(h=this.lineBlockKinds[g])!=null?h:"normal";if(m!=="code"&&m!=="code-fence"){c=!1;break}}let u=[];if(c){let g=o;for(;g<=s;){let m=this.getCodeBlockRangeForLine(g);if(!m){g+=1;continue}if(m.end<o){g=m.end+1;continue}let b=(p=this.lineBlockKinds[m.start])!=null?p:"normal",y=(f=this.lineBlockKinds[m.end])!=null?f:"normal";if(b==="code-fence"){let v=this.getLineRemovalRange(m.start,l);v&&u.push({...v,insert:""})}if(m.end!==m.start&&y==="code-fence"){let v=this.getLineRemovalRange(m.end,l);v&&u.push({...v,insert:""})}g=m.end+1}}else{let g=this.lineRanges[o],m=this.lineRanges[s];if(!g||!m)return;u.push({from:g.from,to:g.from,insert:"```\n"}),u.push({from:m.to,to:m.to,insert:"\n```"})}if(u.length===0)return;this.updatePendingText("",!0),this.immediateRender=!0;let d=this.applyTextChangesWithSelection(u,e.anchor,e.head);this.setSelectionNormalized(d.anchor,d.head),this.focusInputSurface(!0)}insertLink(){var a;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let c=(a=In(this.plainEditOverlayEl).text)!=null?a:"";new jt(this.app,c,u=>{if(u.cancelled||!u.url)return;let d=u.text&&u.text.trim().length>0?u.text:c||u.url;d&&LE(this.plainEditOverlayEl,d,u.url,()=>this.adjustPlainEditOverlaySize())}).open();return}if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=e.head>=e.anchor,s=this.sotEditor.getDoc().slice(i,r);new jt(this.app,s,l=>{if(l.cancelled||!l.url)return;let c=l.text&&l.text.trim().length>0?l.text:s||l.url;if(!c)return;this.updatePendingText("",!0),this.immediateRender=!0;let u=`[${c}](${l.url})`;this.runCeMutation(()=>{var p;(p=this.sotEditor)==null||p.replaceRange(i,r,u)});let d=i+1,h=d+c.length;o?this.setSelectionNormalized(d,h):this.setSelectionNormalized(h,d),this.focusInputSurface(!0)}).open()}findRubyMatchForSelection(e,i,r,o,s){var l,c;let a=Gt();for(let u of s.matchAll(a)){let d=(l=u[0])!=null?l:"",h=(c=u.index)!=null?c:-1;if(!d||h<0)continue;let p=d.indexOf("\u300A"),f=d.lastIndexOf("\u300B");if(p<0||f<=p)continue;let m=d.startsWith("|")||d.startsWith("\uFF5C")?1:0,b=p,y=d.slice(m,b);if(!y)continue;let v=e+h+m,E=e+h+b;if(v>=E||v<e||E>i||!(o>v&&r<E))continue;let k=e+h,S=e+h+d.length;return{rangeFrom:k,rangeTo:S,baseText:y}}return null}buildAozoraRubyText(e,i,r){return r?Array.from(e).map(o=>`\uFF5C${o}\u300A\u30FB\u300B`).join(""):`\uFF5C${e}\u300A${i}\u300B`}insertRuby(){var f;if(this.sourceModeEnabled&&this.plainEditOverlayEl){let m=(f=In(this.plainEditOverlayEl).text)!=null?f:"";if(!m||m.trim()==="")return;if(m.includes(`
`)){new Ie.Notice("\u30EB\u30D3\u306F1\u884C\u5185\u306E\u9078\u629E\u306E\u307F\u5BFE\u5FDC\u3057\u3066\u3044\u307E\u3059\u3002",2e3);return}new Yt(this.app,m,b=>{var y;b.cancelled||RE(this.plainEditOverlayEl,m,(y=b.ruby)!=null?y:"",b.isDot,(v,E,x)=>this.buildAozoraRubyText(v,E,x),()=>this.adjustPlainEditOverlaySize())}).open();return}if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(i===r)return;let o=this.sotEditor.getDoc(),s=o.slice(i,r);if(!s||s.trim()==="")return;if(s.includes(`
`)){new Ie.Notice("\u30EB\u30D3\u306F1\u884C\u5185\u306E\u9078\u629E\u306E\u307F\u5BFE\u5FDC\u3057\u3066\u3044\u307E\u3059\u3002",2e3);return}let a=i,l=r,c=!1,u="",d=this.findLineIndex(i),h=this.findLineIndex(r);if(d!==null&&h===d){let g=this.lineRanges[d];if(g){let m=o.slice(g.from,g.to),b=this.findRubyMatchForSelection(g.from,g.to,i,r,m);b&&(c=!0,a=b.rangeFrom,l=b.rangeTo,u=b.baseText)}}let p=c?u:s;new Yt(this.app,p,g=>{if(g.cancelled)return;if(!g.ruby||g.ruby.trim()===""){if(!c)return;this.updatePendingText("",!0),this.immediateRender=!0;let y=c?u:s;this.runCeMutation(()=>{var E;(E=this.sotEditor)==null||E.replaceRange(a,l,y)});let v=a+y.length;this.setSelectionNormalized(v,v),this.focusInputSurface(!0);return}let m=this.buildAozoraRubyText(p,g.ruby,g.isDot);this.updatePendingText("",!0),this.immediateRender=!0,this.runCeMutation(()=>{var y;(y=this.sotEditor)==null||y.replaceRange(a,l,m)});let b=a+m.length;this.setSelectionNormalized(b,b),this.focusInputSurface(!0)}).open()}insertHorizontalRule(){if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=e.head>=e.anchor,s=i===r?`
---
`:"---";this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(i,r,s);let a=i+s.length;o?this.setSelectionNormalized(a,a):this.setSelectionNormalized(a,a),this.focusInputSurface(!0)}async toggleRubyVisibility(){var r;let i=!(((r=this.plugin.settings.wysiwyg)==null?void 0:r.enableRuby)!==!1);try{await this.plugin.updateSettings({wysiwyg:{...this.plugin.settings.wysiwyg,enableRuby:i}}),new Ie.Notice(i?"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30F3\u306B\u3057\u307E\u3057\u305F\u3002":"\u30EB\u30D3\u8868\u793A\u3092\u30AA\u30D5\u306B\u3057\u307E\u3057\u305F\u3002",1800)}catch(o){console.error("[Tategaki SoT] Failed to toggle ruby",o),new Ie.Notice("\u30EB\u30D3\u8868\u793A\u306E\u5207\u308A\u66FF\u3048\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",2500)}}ensureRecentFilePathsInitialized(){ox(this)}pushRecentFilePath(e,i=!0){sx(this,e,i)}recordRecentFile(e){ax(this,e)}buildFileSwitchItems(){return lx(this)}openFileSwitcher(){cx(this)}openNewNoteModal(e=""){ux(this,e)}async createNewNote(e,i){await dx(this,e,i)}async toggleReadingMode(){await hx(this)}async switchToFile(e){await px(this,e)}openSettingsPanel(){new Dn(this.app,this.plugin,async i=>{await this.plugin.updateSettings(i)},{mode:"sot",isCeImeMode:this.ceImeMode}).open()}async activateMarkdownLeafForCommand(){return await fx(this)}async openOutline(){if(!this.outlinePanel){new Ie.Notice("\u30A2\u30A6\u30C8\u30E9\u30A4\u30F3\u3092\u958B\u3051\u307E\u305B\u3093\u3067\u3057\u305F\u3002",2e3);return}this.outlinePanel.toggle()}isInlineStyleActive(e){if(!this.sotEditor)return!1;let i=this.sotEditor.getSelection(),r=Math.min(i.anchor,i.head),o=Math.max(i.anchor,i.head),s=this.sotEditor.getDoc().length,a=Math.max(0,Math.min(r,s)),l=Math.max(0,Math.min(o,s));if(a===l){let d=this.findLineIndex(a);if(d===null)return!1;let h=this.lineRanges[d];if(!h)return!1;let p=this.buildSegmentsForLine(h.from,h.to);for(let f of p)if(a>=f.from&&a<=f.to&&f.classNames.includes(e))return!0;return!1}let c=this.findLineIndex(a),u=this.findLineIndex(l);if(c===null||u===null)return!1;for(let d=c;d<=u;d+=1){let h=this.lineRanges[d];if(!h)continue;let p=Math.max(h.from,a),f=Math.min(h.to,l),g=this.buildSegmentsForLine(h.from,h.to);for(let m of g)if(m.classNames.includes(e)&&!(m.to<=p||m.from>=f))return!0}return!1}stripInlineStyleInSelection(e,i,r,o){if(!this.sotEditor)return{from:e,to:i,removedOnly:!1};let s=this.sotEditor.getDoc(),a=this.findLineIndex(e),l=this.findLineIndex(i);if(a===null||l===null)return{from:e,to:i,removedOnly:!1};let c=o.some(v=>{let E=v.open.length,x=v.close.length;return e<E||i+x>s.length?!1:s.slice(e-E,e)===v.open&&s.slice(i,i+x)===v.close}),u=[],d=!1,h=!1,p=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY;for(let v=a;v<=l;v+=1){let E=this.lineRanges[v];if(!E)continue;let x=this.buildSegmentsForLine(E.from,E.to),k=null;for(let S of x){let w=Math.max(S.from,e),C=Math.min(S.to,i);C<=w||(S.classNames.includes(r)?(d=!0,p=Math.min(p,w),f=Math.max(f,C),k&&S.from<=k.to?k.to=Math.max(k.to,S.to):(k&&k.to>e&&k.from<i&&this.collectInlineStyleRemoval(s,k,o,u,r),k={from:S.from,to:S.to})):h=!0)}k&&k.to>e&&k.from<i&&this.collectInlineStyleRemoval(s,k,o,u,r)}if(u.length===0)return{from:e,to:i,removedOnly:!1};let g=this.mergeRanges(u).sort((v,E)=>E.from-v.from),m=e,b=i;for(let v of g){let E=v.to-v.from;this.sotEditor.replaceRange(v.from,v.to,""),v.to<=m?(m-=E,b-=E):v.to<=b&&(b-=E)}return{from:m,to:b,removedOnly:c||d&&!h&&p===e&&f===i}}collectInlineStyleRemovalsForRange(e,i,r,o,s,a){let l=this.findLineIndex(e),c=this.findLineIndex(i);if(!(l===null||c===null))for(let u=l;u<=c;u+=1){let d=this.lineRanges[u];if(!d)continue;let h=this.buildSegmentsForLine(d.from,d.to),p=null;for(let f of h){let g=Math.max(f.from,e);Math.min(f.to,i)<=g||f.classNames.includes(r)&&(p&&f.from<=p.to?p.to=Math.max(p.to,f.to):(p&&p.to>e&&p.from<i&&this.collectInlineStyleRemoval(s,p,o,a,r),p={from:f.from,to:f.to}))}p&&p.to>e&&p.from<i&&this.collectInlineStyleRemoval(s,p,o,a,r)}}collectInlineStyleRemoval(e,i,r,o,s){for(let a of r){let l=a.open.length,c=a.close.length;if(!(i.from<l||i.to+c>e.length)&&e.slice(i.from-l,i.from)===a.open&&e.slice(i.to,i.to+c)===a.close){o.push({from:i.from-l,to:i.from}),o.push({from:i.to,to:i.to+c});return}}if(s==="tategaki-md-code"){let a=this.countMarkerRun(e,i.from-1,-1,"`"),l=this.countMarkerRun(e,i.to,1,"`"),c=Math.min(a,l);c>0&&(o.push({from:i.from-c,to:i.from}),o.push({from:i.to,to:i.to+c}))}}resolveInlineMarkerPair(e,i,r,o){for(let s of o){let a=s.open.length;if(i>=a&&e.slice(i-a,i)===s.open)return s}for(let s of o){let a=s.close.length;if(r+a<=e.length&&e.slice(r,r+a)===s.close)return s}return null}hasInlineClassBefore(e,i){var o;let r=this.findSegmentBefore(e);return(o=r==null?void 0:r.classNames.includes(i))!=null?o:!1}hasInlineClassAfter(e,i){var o;let r=this.findSegmentAfter(e);return(o=r==null?void 0:r.classNames.includes(i))!=null?o:!1}findSegmentBefore(e){var s;if(!this.sotEditor||this.lineRanges.length===0)return null;let i=this.sotEditor.getDoc().length,r=Math.max(0,Math.min(e,i)),o=this.findLineIndex(r);o===null&&(o=this.lineRanges.length-1);for(let a=o;a>=0;a-=1){let l=this.lineRanges[a];if(!l)continue;let c=this.buildSegmentsForLine(l.from,l.to);if(c.length!==0)if(a===o)for(let u=c.length-1;u>=0;u-=1){let d=c[u];if(d.to<=r)return d}else return(s=c[c.length-1])!=null?s:null}return null}findSegmentAfter(e){var s;if(!this.sotEditor||this.lineRanges.length===0)return null;let i=this.sotEditor.getDoc().length,r=Math.max(0,Math.min(e,i)),o=this.findLineIndex(r);o===null&&(o=0);for(let a=o;a<this.lineRanges.length;a+=1){let l=this.lineRanges[a];if(!l)continue;let c=this.buildSegmentsForLine(l.from,l.to);if(c.length!==0)if(a===o){for(let u of c)if(u.to>r)return u}else return(s=c[0])!=null?s:null}return null}getMarkerRunLimit(e){switch(e){case"*":case"_":return 3;case"=":return 2;case"`":return 1;case"~":return 2;default:return e.length}}countMarkerRun(e,i,r,o){if(!o)return 0;let s=0,a=i;for(;a>=0&&a<e.length&&e[a]===o;)s+=1,a+=r;return s}toggleSourceMode(){if(this.sourceModeEnabled){this.disablePlainEditMode();return}this.enablePlainEditMode()}updateSourceToggleUi(){var e;(e=this.commandToolbar)==null||e.update()}enablePlainEditMode(){var e,i;this.sourceModeEnabled||(this.sourceModeEnabled=!0,this.sourceModeLineStart=null,this.sourceModeLineEnd=null,this.ceImeMode&&this.setCeImeMode(!1),(e=this.overlayTextarea)==null||e.setActive(!1),this.updatePendingText("",!0),(i=this.selectionLayerEl)==null||i.replaceChildren(),this.caretEl&&(this.caretEl.style.display="none"),this.ensurePlainEditOverlay(),this.registerPlainEditOutsidePointerHandler(),this.startPlainEditFromSelection(),this.updateSourceToggleUi())}disablePlainEditMode(){var e;this.sourceModeEnabled&&(this.sourceModeEnabled=!1,this.commitPlainEdit(!0,!0),this.unregisterPlainEditOutsidePointerHandler(),this.plainEditOverlayEl&&(this.plainEditOverlayEl.style.display="none"),(e=this.overlayTextarea)==null||e.setActive(!0),this.caretEl&&(this.caretEl.style.display=""),this.updateSourceToggleUi(),this.scheduleCaretUpdate(!0))}ensurePlainEditOverlay(){this.plainEditController.ensureOverlay()}destroyPlainEditOverlay(){this.plainEditController.destroyOverlay()}adjustPlainEditOverlaySize(){this.plainEditController.adjustOverlaySize()}handlePlainEditArrowKey(e){return this.plainEditController.handleArrowKey(e)}handlePlainEditEnter(){return this.plainEditController.handleEnter()}handlePlainEditBackspace(){return this.plainEditController.handleBackspace()}handlePlainEditDelete(){return this.plainEditController.handleDelete()}applyPlainEditRangeReplacement(e,i,r,o){this.plainEditController.applyRangeReplacement(e,i,r,o)}clearPlainEditTargets(){this.plainEditController.clearTargets()}applyPlainEditTargetClass(e,i){this.plainEditController.applyTargetClass(e,i)}applyPlainEditTargets(e){this.plainEditController.applyTargets(e)}getPlainEditRangeFromSelection(){return this.plainEditController.getRangeFromSelection()}getPlainEditBlockLineRange(e){return this.plainEditController.getBlockLineRange(e)}updatePlainEditOverlayPosition(e){this.plainEditController.updateOverlayPosition(e)}startPlainEditFromSelection(){this.plainEditController.startFromSelection()}commitPlainEdit(e,i){this.plainEditController.commit(e,i)}registerPlainEditOutsidePointerHandler(){this.plainEditController.registerOutsidePointerHandler()}unregisterPlainEditOutsidePointerHandler(){this.plainEditController.unregisterOutsidePointerHandler()}toggleCeImeMode(){this.setCeImeMode(!this.ceImeMode)}setCeImeMode(e,i={}){var o,s,a,l;if(this.ceImeMode===e)return;if(e&&this.sourceModeEnabled&&this.disablePlainEditMode(),i.suspend?e||(this.ceImeSuspended=!0):this.ceImeSuspended=!1,this.ceImeMode=e,e){if(this.lineModelRecomputeTimer!==null&&(window.clearTimeout(this.lineModelRecomputeTimer),this.lineModelRecomputeTimer=null),this.lineModelRecomputeIdle!==null){let c=window.cancelIdleCallback;c==null||c(this.lineModelRecomputeIdle),this.lineModelRecomputeIdle=null}}else this.lineModelRecomputeStart!==null&&this.lineModelRecomputeEnd!==null&&this.scheduleLineModelRecompute(this.lineModelRecomputeStart,this.lineModelRecomputeEnd);this.derivedRootEl&&(e?this.derivedRootEl.setAttribute("data-ce-ime","1"):this.derivedRootEl.removeAttribute("data-ce-ime")),e&&(this.ceImeFallbackActive=!1,this.ceImeMappingFailureCount=0,this.ceImeMappingFailureAt=0),this.ceImeComposing=!1,this.ceImeSelectionSyncing=!1,this.ceImeLastCompositionText="",this.ceImeLastBeforeInputText="",this.ceImeCompositionSelection=null,this.ceImeIgnoreNextInput=!1,this.ceImeActiveComposeId=null,this.ceImeAppliedComposeId=0,this.isPointerSelecting=!1,this.pointerSelectAnchor=null,this.pointerSelectPointerId=null,this.derivedContentEl&&(this.derivedContentEl.contentEditable=e?"true":"false",this.derivedContentEl.spellcheck=!1,this.derivedContentEl.setAttribute("autocapitalize","off"),this.derivedContentEl.setAttribute("autocomplete","off"),this.derivedContentEl.setAttribute("autocorrect","off"),e||this.derivedContentEl.style.removeProperty("caret-color"),e&&(this.derivedContentEl.tabIndex=0),e?(this.applyCeEditableDefaults(),this.updateCeEditableRangeFromSelection()):this.applyCeEditableDefaults());let r=!i.suspend&&this.isLeafActive();e?((o=this.overlayTextarea)==null||o.setActive(!1),this.overlayFocused=!1,this.updatePendingText("",!0),(s=this.selectionLayerEl)==null||s.replaceChildren(),this.caretEl&&(this.caretEl.style.display="none"),this.syncSelectionToCe(),this.derivedContentEl&&this.derivedContentEl.querySelectorAll(".tategaki-sot-line").forEach(c=>this.applyCeNonEditableMarkers(c)),r&&this.focusInputSurface(!0)):((a=this.overlayTextarea)==null||a.setActive(!0),r&&this.focusInputSurface(!0)),(l=this.commandToolbar)==null||l.update(),this.scheduleCaretUpdate(!0)}focusInputSurface(e=!0){var i;if(this.sourceModeEnabled&&this.plainEditOverlayEl){try{this.plainEditOverlayEl.focus({preventScroll:e})}catch(r){this.plainEditOverlayEl.focus()}return}if(this.ceImeMode){if(!this.derivedContentEl||!this.isLeafActive())return;try{this.derivedContentEl.focus({preventScroll:e})}catch(r){this.derivedContentEl.focus()}return}(i=this.overlayTextarea)==null||i.focus(e)}runCeMutation(e){if(!this.ceImeMode){e();return}this.ceImeApplying=!0,this.markCeExternalSuppress();try{e()}finally{this.ceImeApplying=!1}}markCeExternalSuppress(e=250){let i=Date.now()+e;i>this.ceImeExternalSuppressUntil&&(this.ceImeExternalSuppressUntil=i)}recordCeMappingFailure(e,i=!1){if(!this.ceImeMode||this.ceImeFallbackActive)return;let r=Date.now();if(r-this.ceImeMappingFailureAt>1200&&(this.ceImeMappingFailureCount=0),this.ceImeMappingFailureAt=r,this.ceImeMappingFailureCount+=1,i||this.ceImeMappingFailureCount>=3){this.ceImeFallbackActive=!0,this.setCeImeMode(!1);let o=e;e==="selection"?o="\u9078\u629E\u306E\u5FA9\u5143\u306B\u5931\u6557":e==="external"?o="\u5916\u90E8\u66F4\u65B0\u3092\u691C\u77E5":e==="verification"&&(o="\u30AD\u30E3\u30EC\u30C3\u30C8\u6574\u5408\u6027\u30C1\u30A7\u30C3\u30AF"),new Ie.Notice(`CE\u88DC\u52A9\u30E2\u30FC\u30C9\u3092\u4E00\u6642\u505C\u6B62\u3057\u307E\u3057\u305F (${o})`,2500)}}isSelectionInsideDerivedContent(e){if(!e||!this.derivedContentEl)return!1;let i=e.anchorNode,r=e.focusNode;if(!i||!r)return!1;let o=i instanceof Element?i:i.parentElement,s=r instanceof Element?r:r.parentElement;return!o||!s?!1:this.derivedContentEl.contains(o)&&this.derivedContentEl.contains(s)}getLineElementForNode(e){var r;if(!e||!this.derivedContentEl)return null;let i=e instanceof Element?e:(r=e.parentElement)!=null?r:null;return!i||!this.derivedContentEl.contains(i)?null:i.closest(".tategaki-sot-line")}syncSelectionFromCe(){var e,i;return(i=(e=this.ceSelectionSync)==null?void 0:e.syncSelectionFromCe())!=null?i:null}syncSelectionToCe(){var e;(e=this.ceSelectionSync)==null||e.syncSelectionToCe()}applyCeEditableDefaults(){if(!this.derivedContentEl)return;let e=Array.from(this.derivedContentEl.children);for(let i of e)i.classList.contains("tategaki-sot-line")&&i.setAttribute("contenteditable","false");this.ceEditableStart=null,this.ceEditableEnd=null}setCeEditableRange(e,i){if(!this.ceImeMode||!this.derivedContentEl)return;let r=Math.max(0,Math.min(e,i)),o=Math.max(e,i);if(this.ceEditableStart===r&&this.ceEditableEnd===o){let s=this.getLineElement(r);s&&this.ensureLineRendered(s);let a=o!==r?this.getLineElement(o):null;a&&this.ensureLineRendered(a);return}if(this.ceEditableStart!==null&&this.ceEditableEnd!==null){let s=Math.max(0,Math.min(this.ceEditableStart,this.ceEditableEnd)),a=Math.max(this.ceEditableStart,this.ceEditableEnd);for(let l=s;l<=a;l+=1){let c=this.getLineElement(l);c&&c.setAttribute("contenteditable","false")}}for(let s=r;s<=o;s+=1){let a=this.getLineElement(s);a&&(this.ensureLineRendered(a),a.setAttribute("contenteditable","true"),this.applyCeNonEditableMarkers(a))}this.ceEditableStart=r,this.ceEditableEnd=o}updateCeEditableRangeFromSelection(){if(!this.ceImeMode||!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head),o=this.findLineIndex(i),s=this.findLineIndex(r);if(!(o===null||s===null)){if(o===s){let a=this.getParagraphLineRangeForOffsets(i,r);if(a){this.setCeEditableRange(a.start,a.end);return}}this.setCeEditableRange(o,s)}}getParagraphLineRangeForOffsets(e,i){let r=this.findLineIndex(e),o=this.findLineIndex(i);if(r===null||o===null)return null;let s=Math.min(r,o),a=Math.max(r,o);for(;s>0;){let l=this.lineRanges[s-1];if(!l||l.to-l.from===0)break;s-=1}for(;a<this.lineRanges.length-1;){let l=this.lineRanges[a+1];if(!l||l.to-l.from===0)break;a+=1}return{start:s,end:a}}scheduleCeParagraphRerender(e,i,r=null){if(!this.ceImeMode)return;let o=this.getParagraphLineRangeForOffsets(e,i);o&&window.requestAnimationFrame(()=>{this.ceImeMode&&(this.rerenderLineRange(o.start,o.end),r!==null&&this.setSelectionNormalized(r,r),this.syncSelectionToCe())})}applyCeReplaceRange(e,i,r){if(!this.sotEditor)return;let o=Math.min(e,i),s=Math.max(e,i);this.updatePendingText("",!0),this.immediateRender=!0,this.runCeMutation(()=>{var a;(a=this.sotEditor)==null||a.replaceRange(o,s,r)}),this.scheduleCeParagraphRerender(o,s,o+r.length)}applyCeNonEditableMarkers(e){if(!this.ceImeMode)return;let i=e.querySelectorAll(".tategaki-sot-eol, .tategaki-sot-pending-spacer");for(let o of Array.from(i)){let s=o;s.setAttribute("contenteditable","false"),s.setAttribute("aria-hidden","true"),s.tabIndex=-1}let r=e.querySelectorAll(".tategaki-md-inline-widget");for(let o of Array.from(r))o.setAttribute("contenteditable","false")}applyCeEditableState(e,i){if(!this.ceImeMode){e.setAttribute("contenteditable","false");return}if(i===null||this.ceEditableStart===null||this.ceEditableEnd===null){e.setAttribute("contenteditable","false");return}let r=Math.min(this.ceEditableStart,this.ceEditableEnd),o=Math.max(this.ceEditableStart,this.ceEditableEnd),s=i>=r&&i<=o;e.setAttribute("contenteditable",s?"true":"false")}handleCeBeforeInput(e){var i;if(!(!this.ceImeMode||!this.sotEditor)&&this.derivedContentEl&&!(e.target&&!this.derivedContentEl.contains(e.target))){if(this.ceImeIgnoreNextInput&&e.inputType==="insertText"){e.preventDefault(),e.stopPropagation(),this.ceImeIgnoreNextInput=!1;return}if(this.ceImeComposing||e.isComposing){e.inputType==="insertCompositionText"&&typeof e.data=="string"&&(this.ceImeLastBeforeInputText=e.data);return}if(e.inputType==="insertCompositionText"||e.inputType==="deleteCompositionText"){e.preventDefault(),e.stopPropagation();return}switch(e.inputType){case"insertText":case"insertReplacementText":{e.preventDefault(),e.stopPropagation();let r=(i=e.data)!=null?i:"";if(r.length===0)return;let o=this.syncSelectionFromCe();if(!o)return;let s=Math.min(o.anchor,o.head),a=Math.max(o.anchor,o.head);this.applyCeReplaceRange(s,a,r);return}case"insertLineBreak":case"insertParagraph":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);this.runCeMutation(()=>this.replaceSelection(`
`)),this.scheduleCeParagraphRerender(o,s,o+1);return}case"deleteContentBackward":case"deleteWordBackward":case"deleteSoftLineBackward":case"deleteHardLineBackward":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);if(o!==s){this.applyCeReplaceRange(o,s,"");return}if(o<=0)return;this.applyCeReplaceRange(o-1,o,"");return}case"deleteContentForward":case"deleteWordForward":case"deleteSoftLineForward":case"deleteHardLineForward":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);if(o!==s){this.applyCeReplaceRange(o,s,"");return}let a=this.sotEditor.getDoc().length;if(o>=a)return;this.applyCeReplaceRange(o,o+1,"");return}case"deleteByCut":{e.preventDefault(),e.stopPropagation();let r=this.syncSelectionFromCe();if(!r)return;let o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);this.applyCeReplaceRange(o,s,"");return}case"insertFromPaste":case"insertFromDrop":{e.preventDefault(),e.stopPropagation();return}case"historyUndo":{e.preventDefault(),e.stopPropagation(),this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.undo()});return}case"historyRedo":{e.preventDefault(),e.stopPropagation(),this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.redo()});return}default:return}}}handleCeCompositionStart(e){var r;if(!this.ceImeMode)return;this.ceImeComposing=!0,this.ceImeComposeId+=1,this.ceImeActiveComposeId=this.ceImeComposeId,this.ceImeLastCompositionText=(r=e.data)!=null?r:"",this.ceImeLastBeforeInputText="";let i=this.syncSelectionFromCe();if(i){let o=Math.min(i.anchor,i.head),s=Math.max(i.anchor,i.head);this.ceImeCompositionSelection={from:o,to:s}}else this.ceImeCompositionSelection=null;this.scheduleCaretUpdate(!0)}handleCeCompositionUpdate(e){var i;this.ceImeMode&&(this.ceImeLastCompositionText=(i=e.data)!=null?i:"")}handleCeCompositionEnd(e){if(!this.ceImeMode)return;if(this.ceImeComposing=!1,this.ceImeActiveComposeId!==null&&this.ceImeAppliedComposeId===this.ceImeActiveComposeId){this.ceImeActiveComposeId=null;return}let i=e.data!==null&&e.data!==void 0?e.data:this.ceImeLastBeforeInputText.length>0?this.ceImeLastBeforeInputText:this.ceImeLastCompositionText.length>0?this.ceImeLastCompositionText:"";this.ceImeLastCompositionText="",this.ceImeLastBeforeInputText="",this.ceImeIgnoreNextInput=!0,window.setTimeout(()=>{this.ceImeIgnoreNextInput=!1},0);let r=this.ceImeCompositionSelection;if(!r){let o=this.syncSelectionFromCe();o&&(r={from:Math.min(o.anchor,o.head),to:Math.max(o.anchor,o.head)})}this.ceImeCompositionSelection=null,r&&(this.ceImeActiveComposeId!==null&&(this.ceImeAppliedComposeId=this.ceImeActiveComposeId,this.ceImeActiveComposeId=null),this.applyCeReplaceRange(r.from,r.to,i),this.scheduleCaretUpdate(!0))}setupListOutlinerCaptureHandler(){var r,o;if(this.listOutlinerCaptureHandler)return;let e=(r=this.containerEl.ownerDocument)!=null?r:document,i=(o=e.defaultView)!=null?o:window;this.listOutlinerCaptureHandler=s=>{var p;if(!this.workspaceController.isLeafActive()||this.sourceModeEnabled)return;let a=s.target,l=e.activeElement;if(this.workspaceController.isInModalLayer(l)||this.workspaceController.isInModalLayer(a)||a&&!this.containerEl.contains(a))return;let c=s.metaKey||s.ctrlKey,u=s.key==="Tab"&&!s.altKey&&!c,d=c&&!s.shiftKey&&!s.altKey&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.key);if(!u&&!d||s.isComposing||this.ceImeComposing||(p=this.overlayTextarea)!=null&&p.isImeVisible())return;(this.handleListOutlinerKeydown(s)||u)&&(s.preventDefault(),typeof s.stopImmediatePropagation=="function"&&s.stopImmediatePropagation(),s.stopPropagation(),this.ceImeMode&&this.syncSelectionToCe())},i.addEventListener("keydown",this.listOutlinerCaptureHandler,{capture:!0}),this.register(()=>{this.teardownListOutlinerCaptureHandler()})}teardownListOutlinerCaptureHandler(){var r,o;if(!this.listOutlinerCaptureHandler)return;((o=((r=this.containerEl.ownerDocument)!=null?r:document).defaultView)!=null?o:window).removeEventListener("keydown",this.listOutlinerCaptureHandler,{capture:!0}),this.listOutlinerCaptureHandler=null}handleCeKeydown(e){if(!this.ceImeMode)return;if(!e.isComposing&&!this.ceImeComposing&&this.handleListOutlinerKeydown(e)){e.preventDefault(),e.stopPropagation(),this.ceImeMode&&this.syncSelectionToCe();return}if(!(e.metaKey||e.ctrlKey)){if(e.altKey||e.isComposing||this.ceImeComposing)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"){e.preventDefault(),e.stopPropagation(),this.handleNavigate(e),this.ceImeMode&&this.syncSelectionToCe();return}return}if(e.key==="z"||e.key==="Z"){e.preventDefault(),e.stopPropagation(),e.shiftKey?this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.redo()}):this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.undo()});return}(e.key==="y"||e.key==="Y")&&(e.preventDefault(),e.stopPropagation(),this.runCeMutation(()=>{var r;return(r=this.sotEditor)==null?void 0:r.redo()}))}handleCeSelectionChange(){var e;(e=this.ceSelectionSync)==null||e.handleCeSelectionChange(),this.updateCeEditableRangeFromSelection()}attachSoTEditor(e){var i,r;(i=this.detachSoTListener)==null||i.call(this),this.detachSoTListener=null,(r=this.sotEditor)==null||r.destroy(),this.sotEditor=e,this.detachSoTListener=this.sotEditor.onUpdate(o=>{var s,a,l,c;if(o.docChanged){let u=Date.now(),d=this.ceImeMode&&u<=this.ceImeExternalSuppressUntil;if(this.ceImeMode&&!this.ceImeComposing&&!this.ceImeApplying&&!d&&this.recordCeMappingFailure("external",!0),d&&(this.ceImeExternalSuppressUntil=0),this.applyChanges((s=o.changes)!=null?s:[])?this.immediateRender=!1:this.immediateRender?(this.immediateRender=!1,(a=this.renderPipeline)==null||a.cancelScheduledRender(),this.renderNow()):this.scheduleRender(),(l=this.commandToolbar)==null||l.update(),o.selectionChanged){this.updateSourceModeLineRange();let p=this.getValidPairedMarkdownLeaf(),f=this.app.workspace.activeLeaf;p&&f===p?this.pendingCaretScroll=!0:this.pendingCaretScroll=this.pendingCaretScroll||!this.ceImeMode&&!this.overlayFocused,this.ceImeMode&&!this.ceImeSelectionSyncing&&this.syncSelectionToCe(),this.ceImeMode&&this.updateCeEditableRangeFromSelection(),this.scheduleCaretUpdate()}}else if(o.selectionChanged){this.updateSourceModeLineRange();let u=this.getValidPairedMarkdownLeaf(),d=this.app.workspace.activeLeaf;u&&d===u?this.pendingCaretScroll=!0:this.pendingCaretScroll=this.pendingCaretScroll||!this.ceImeMode&&!this.overlayFocused,this.ceImeMode&&!this.ceImeSelectionSyncing&&this.syncSelectionToCe(),this.ceImeMode&&this.updateCeEditableRangeFromSelection(),this.scheduleCaretUpdate(),(c=this.commandToolbar)==null||c.update()}}),this.updateSourceToggleUi(),this.updateSourceModeLineRange(!0)}updateSourceModeLineRange(e=!1){this.sourceModeEnabled&&(!this.sotEditor||!this.derivedContentEl||this.startPlainEditFromSelection())}rerenderLineRange(e,i){if(!this.sotEditor||!this.derivedContentEl||e===null||i===null||this.pendingText.length>0)return;let r=Math.max(0,Math.min(e,i)),o=Math.max(0,Math.max(e,i));this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null;for(let s=r;s<=o;s+=1){let a=this.lineRanges[s],l=this.getLineElement(s);!a||!l||(l.replaceChildren(),this.renderLine(l,a,s))}this.scheduleCaretUpdate(!0)}computeSourceModeLineRange(){var d;if(!this.sourceModeEnabled||!this.sotEditor||this.lineRanges.length===0)return null;let e=this.sotEditor.getDoc().length,i=this.sotEditor.getSelection(),r=Math.max(0,Math.min(Math.min(i.anchor,i.head),e)),o=Math.max(0,Math.min(Math.max(i.anchor,i.head),e)),s=this.findLineIndex(r),a=this.findLineIndex(o);if(s===null||a===null)return null;let l=this.findLineIndex(i.head);if(l!==null){let h=this.lineMathBlockStart[l],p=this.lineMathBlockEnd[l];if(h!==null&&p!==null)return{start:h,end:p};let f=this.lineCalloutBlockStart[l],g=this.lineCalloutBlockEnd[l];if(f!==null&&g!==null)return{start:f,end:g};let m=this.lineTableBlockStart[l],b=this.lineTableBlockEnd[l];if(m!==null&&b!==null)return{start:m,end:b};let y=this.lineDeflistBlockStart[l],v=this.lineDeflistBlockEnd[l];if(y!==null&&v!==null)return{start:y,end:v};let E=(d=this.lineBlockKinds[l])!=null?d:"normal";if(E==="code"||E==="code-fence"){let x=this.getCodeBlockLineRange(l);if(x)return x}}if(s===a)return{start:s,end:a};let c=s;for(;c>0;){let h=this.lineRanges[c-1];if(!h||h.to-h.from===0)break;c-=1}let u=a;for(;u<this.lineRanges.length-1;){let h=this.lineRanges[u+1];if(!h||h.to-h.from===0)break;u+=1}return{start:c,end:u}}getCodeBlockLineRange(e){var s,a,l;if(e<0||e>=this.lineRanges.length)return null;let i=(s=this.lineBlockKinds[e])!=null?s:"normal";if(i!=="code"&&i!=="code-fence")return null;let r=e;for(;r>0;){let c=(a=this.lineBlockKinds[r-1])!=null?a:"normal";if(c!=="code"&&c!=="code-fence")break;r-=1}let o=e;for(;o+1<this.lineRanges.length;){let c=(l=this.lineBlockKinds[o+1])!=null?l:"normal";if(c!=="code"&&c!=="code-fence")break;o+=1}return{start:r,end:o}}async ensureMarkdownViewForFile(e){return await mx(this,e)}findMarkdownLeafForFile(e){return gx(this,e)}ensurePairedMarkdownView(){xx(this)}verifyPairedMarkdownViewFile(e,i){return kx(this,e,i)}applyPairedMarkdownBadge(e,i){wx(this,e,i)}clearPairedMarkdownBadge(){Sx(this)}applySoTTabBadge(){Mx(this)}clearSoTTabBadge(){Tx(this)}getLeafTabHeaderEl(e){return Cx(this,e)}getTabHeaderTitleHost(e){return Lx(this,e)}getViewHeaderTitleHost(e){return Rx(this,e)}closeSelf(){window.setTimeout(()=>{try{this.leaf.detach()}catch(e){}},0)}registerClipboardHandlers(){if(!this.derivedRootEl)return;let e=o=>{this.handleCopyCut(o,!1)},i=o=>{this.handleCopyCut(o,!0)},r=o=>{this.handlePaste(o)};this.derivedRootEl.addEventListener("copy",e,!0),this.derivedRootEl.addEventListener("cut",i,!0),this.derivedRootEl.addEventListener("paste",r,!0),this.register(()=>{var o,s,a;(o=this.derivedRootEl)==null||o.removeEventListener("copy",e,!0),(s=this.derivedRootEl)==null||s.removeEventListener("cut",i,!0),(a=this.derivedRootEl)==null||a.removeEventListener("paste",r,!0)})}setupWheelScroll(){if(!this.derivedRootEl)return;this.boundWheelHandler&&(this.derivedRootEl.removeEventListener("wheel",this.boundWheelHandler),this.boundWheelHandler=null);let e=i=>this.handleWheel(i);this.boundWheelHandler=e,this.derivedRootEl.addEventListener("wheel",e,{passive:!1}),this.register(()=>{var i;(i=this.derivedRootEl)==null||i.removeEventListener("wheel",e),this.boundWheelHandler===e&&(this.boundWheelHandler=null)})}updateMobileTouchAction(){if(!this.derivedRootEl)return;let e=Ie.Platform.isMobile||Ie.Platform.isMobileApp,i=this.writingMode.startsWith("vertical");e&&i?this.derivedRootEl.style.touchAction="none":this.derivedRootEl.style.removeProperty("touch-action")}shouldHandleTouchScroll(e){var r;if(!this.derivedRootEl||!(Ie.Platform.isMobile||Ie.Platform.isMobileApp)||!this.writingMode.startsWith("vertical")||e.pointerType!=="touch"||this.sourceModeEnabled)return!1;let i=e.target;return!((r=i==null?void 0:i.closest("textarea, input, .tategaki-plain-overlay"))!=null&&r)}resetTouchScrollState(){this.activeTouchPointers.clear(),this.touchScrollActive=!1,this.touchScrollStartX=0,this.touchScrollStartY=0,this.touchScrollLastY=0}handleTouchScrollPointerDown(e){this.shouldHandleTouchScroll(e)&&(this.activeTouchPointers.set(e.pointerId,{x:e.clientX,y:e.clientY,startX:e.clientX,startY:e.clientY}),this.activeTouchPointers.size>=2&&(this.touchScrollStartX=e.clientX,this.touchScrollStartY=e.clientY,this.touchScrollLastY=e.clientY,this.touchScrollActive=!1))}handleTouchScrollPointerMove(e){if(!this.derivedRootEl||!this.shouldHandleTouchScroll(e))return;let i=this.activeTouchPointers.get(e.pointerId);if(!i)return;let r=e.clientX-i.startX,o=e.clientY-i.startY,s=e.clientY-i.y;if(i.x=e.clientX,i.y=e.clientY,this.activeTouchPointers.set(e.pointerId,i),!(this.activeTouchPointers.size<2)){if(!this.touchScrollActive){if(Math.abs(o)<6||Math.abs(o)<Math.abs(r))return;this.touchScrollActive=!0,this.isPointerSelecting=!1,this.pointerSelectAnchor=null,this.pointerSelectPointerId=null}this.touchScrollActive&&s!==0&&(this.touchScrollLastY=e.clientY,this.derivedRootEl.scrollLeft-=s,e.preventDefault(),e.stopPropagation())}}handleTouchScrollPointerUp(e){this.shouldHandleTouchScroll(e)&&this.activeTouchPointers.has(e.pointerId)&&(this.activeTouchPointers.delete(e.pointerId),this.activeTouchPointers.size<2&&(this.touchScrollActive=!1),this.activeTouchPointers.size===0&&this.resetTouchScrollState())}handleWheel(e){if(!this.derivedRootEl)return;let{deltaX:i,deltaY:r,shiftKey:o}=e,a=window.getComputedStyle(this.derivedRootEl).writingMode.startsWith("vertical"),l=this.derivedRootEl;if(!a){if(!o)return;e.preventDefault(),this.throttledWheelScroll(()=>{l.scrollLeft-=r});return}o||(e.preventDefault(),this.throttledWheelScroll(()=>{let c=-r*.8+i;l.scrollLeft+=c}))}throttledWheelScroll(e){this.wheelThrottleTimer===null&&(e(),this.wheelThrottleTimer=window.setTimeout(()=>{this.wheelThrottleTimer=null},16))}handleRootScroll(){var p;if(!this.derivedRootEl||this.suspendedForInactive)return;let e=this.derivedRootEl,i=e.scrollTop,r=e.scrollLeft;this.scrollDebouncePendingTop=i,this.scrollDebouncePendingLeft=r;let s=window.getComputedStyle(e).writingMode!=="horizontal-tb",a=s?e.clientWidth:e.clientHeight,l=Math.abs(s?r-this.scrollDebounceLastLeft:i-this.scrollDebounceLastTop);this.scrollDebounceLastTop=i,this.scrollDebounceLastLeft=r;let c=performance.now(),u=120,d=Math.max(120,a*.5),h=this.scrollDragActive||l>d;if(this.scrollDebounceLastEventAt=c,(p=this.renderPipeline)==null||p.notifyScrollActivity(this.scrollDragActive),!h){this.scrollDebounceTimer!==null&&(window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.scheduleScrollDebouncedUpdate();return}this.scrollDebounceRaf!==null&&(window.cancelAnimationFrame(this.scrollDebounceRaf),this.scrollDebounceRaf=null),this.scrollDebounceTimer!==null&&window.clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=window.setTimeout(()=>{this.scrollDebounceTimer=null,this.scheduleScrollDebouncedUpdate()},u)}scheduleScrollDebouncedUpdate(){this.scrollDebounceRaf===null&&(this.scrollDebounceRaf=window.requestAnimationFrame(()=>{var e;this.scrollDebounceRaf=null,this.scheduleCaretUpdate(),this.purgeLineCachesAroundScroll(),(e=this.renderPipeline)==null||e.onScrollSettled()}))}purgeLineCachesAroundScroll(){if(!this.shouldUseLineCache()||!this.derivedRootEl)return;let e=this.lineRanges.length;if(e<=0)return;let i=this.derivedRootEl,r=window.getComputedStyle(i),o=Number.parseFloat(r.fontSize)||16,s=Number.parseFloat(r.lineHeight)||o*1.8,a=r.writingMode!=="horizontal-tb",l=Math.max(s,o),c=a?i.clientWidth:i.clientHeight,u=a?this.scrollDebouncePendingLeft:this.scrollDebouncePendingTop;a&&u<0&&(u=-u);let d=Math.floor(Math.max(0,u)/l),h=Math.ceil(c/l),p=Math.max(120,h*2),f=Math.max(0,d-p),g=Math.min(e-1,d+h+p);this.purgeLineCaches(f,g)}purgeLineCaches(e,i){nx(this,e,i)}resetPendingRenderState(){ZE(this)}finalizeRender(e,i){QE(this,e,i)}scheduleRender(e=!1){ex(this,e)}renderNow(){tx(this)}applyChanges(e){var f,g;if(!this.derivedContentEl||!this.sotEditor||this.lineRanges.length===0||e.length===0)return!1;if(this.canApplyChangesFast(e)&&this.applyChangesFast(e))return!0;let r=this.sotEditor.getDoc().split(`
`),o=this.computeLineRangesFromLines(r);this.recomputeLineBlockKinds(r);let s=Number.POSITIVE_INFINITY,a=-1,l=Number.POSITIVE_INFINITY,c=-1;for(let m of e){let b=this.findLineIndexInRanges(this.lineRanges,m.from),y=this.findLineIndexInRanges(this.lineRanges,m.to),v=this.findLineIndexInRanges(o,m.fromB),E=this.findLineIndexInRanges(o,m.toB);if(b===null||y===null||v===null||E===null)return!1;s=Math.min(s,b),a=Math.max(a,y),l=Math.min(l,v),c=Math.max(c,E)}if(!Number.isFinite(s)||!Number.isFinite(l))return!1;let u=document.createDocumentFragment();for(let m=l;m<=c;m++){let b=o[m];if(!b)continue;let y=document.createElement("div");y.className="tategaki-sot-line",y.dataset.from=String(b.from),y.dataset.to=String(b.to),y.dataset.line=String(m),this.renderLine(y,b,m),u.appendChild(y)}let d=a>=s?a-s+1:0,h=this.getLineElementOffset(),p=(f=this.derivedContentEl.children[a+h+1])!=null?f:null;for(let m=0;m<d;m++){let b=this.derivedContentEl.children[s+h];b&&b.remove()}return p?this.derivedContentEl.insertBefore(u,p):this.derivedContentEl.appendChild(u),this.lineRanges=o,this.syncLineDatasets(Math.min(s,l)),this.updateSourceModeLineRange(!0),this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null,this.pendingHold&&(this.pendingHold=!1,this.updatePendingText("",!0)),(g=this.outlinePanel)==null||g.refresh(),this.scheduleCaretUpdate(!0),this.loadingOverlayPending&&this.hideLoadingOverlay(),!0}canApplyChangesFast(e){if(!this.sotEditor||this.lineRanges.length===0)return!1;for(let i of e){if(i.insert.includes(`
`))return!1;let r=this.findLineIndexInRanges(this.lineRanges,i.from),o=this.findLineIndexInRanges(this.lineRanges,i.to);if(r===null||o===null||r!==o)return!1}return!0}applyChangesFast(e){var l;if(!this.derivedContentEl||!this.sotEditor||this.lineRanges.length===0)return!1;let i=this.lineRanges.slice(),r=this.lineRanges.map(c=>({from:c.from,to:c.to})),o=e.slice().sort((c,u)=>c.from-u.from||c.to-u.to),s=Number.POSITIVE_INFINITY,a=-1;for(let c of o){let u=this.findLineIndexInRanges(i,c.from),d=this.findLineIndexInRanges(i,c.to);if(u===null||d===null||u!==d)return!1;s=Math.min(s,u),a=Math.max(a,u);let h=c.insert.length-(c.to-c.from);if(h===0)continue;let p=r[u];if(!p)return!1;p.to+=h;for(let f=u+1;f<r.length;f+=1){let g=r[f];g&&(g.from+=h,g.to+=h)}}if(!Number.isFinite(s))return!1;this.lineRanges=r;for(let c=s;c<=a;c+=1){let u=this.lineRanges[c],d=this.getLineElement(c);!u||!d||(d.replaceChildren(),this.renderLine(d,u,c))}return this.syncLineDatasets(s),this.updateSourceModeLineRange(!0),this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null,this.pendingHold&&(this.pendingHold=!1,this.updatePendingText("",!0)),(l=this.outlinePanel)==null||l.refresh(),this.scheduleCaretUpdate(!0),this.loadingOverlayPending&&this.hideLoadingOverlay(),this.scheduleLineModelRecompute(s,a),!0}scheduleLineModelRecompute(e,i){var l;if(!this.sotEditor)return;let r=Math.max(0,Math.min(e,i)),o=Math.max(e,i);if(this.lineModelRecomputeStart===null?(this.lineModelRecomputeStart=r,this.lineModelRecomputeEnd=o):(this.lineModelRecomputeStart=Math.min(this.lineModelRecomputeStart,r),this.lineModelRecomputeEnd=Math.max((l=this.lineModelRecomputeEnd)!=null?l:o,o)),this.ceImeMode||this.lineModelRecomputeTimer!==null||this.lineModelRecomputeIdle!==null)return;let s=()=>{var p;if(this.lineModelRecomputeTimer=null,this.lineModelRecomputeIdle=null,!this.sotEditor)return;let u=this.sotEditor.getDoc().split(`
`);this.lineRanges.length!==u.length&&(this.lineRanges=this.computeLineRangesFromLines(u)),this.recomputeLineBlockKinds(u),(p=this.outlinePanel)==null||p.refresh();let d=this.lineModelRecomputeStart,h=this.lineModelRecomputeEnd;this.lineModelRecomputeStart=null,this.lineModelRecomputeEnd=null,!(d===null||h===null)&&(this.pendingText.length>0||this.rerenderLineRange(d,h))},a=window.requestIdleCallback;if(a){this.lineModelRecomputeIdle=a(s,{timeout:800});return}this.lineModelRecomputeTimer=window.setTimeout(s,180)}syncLineDatasets(e){if(!this.derivedContentEl)return;let i=Math.max(0,e),r=Math.min(this.lineRanges.length,this.derivedContentEl.children.length),o=this.getLineElementOffset();for(let s=i;s<r;s+=1){let a=this.derivedContentEl.children[s+o],l=this.lineRanges[s];!a||!l||(a.dataset.from=String(l.from),a.dataset.to=String(l.to),a.dataset.line=String(s))}}scheduleCaretUpdate(e=!1){ix(this,e)}updateCaretPosition(){_l(this)}scrollCaretIntoView(){Ol(this)}scrollRectIntoView(e,i){Dl(this,e,i)}openHref(e){var s,a;let i=e.trim();if(!i)return;if(/^[a-z][a-z0-9+.-]*:\/\//i.test(i)||/^mailto:/i.test(i)||/^tel:/i.test(i)){window.open(i);return}let o=(a=(s=this.currentFile)==null?void 0:s.path)!=null?a:"";this.app.workspace.openLinkText(i,o,!1)}replaceSelection(e){if(!this.sotEditor)return;let i=this.sotEditor.getSelection(),r=Math.min(i.anchor,i.head),o=Math.max(i.anchor,i.head);if(e===`
`&&r===o){let a=this.findLineIndex(r);if(a!==null){let l=this.lineRanges[a];if(l){let c=this.buildSegmentsForLine(l.from,l.to),u=c.length>0?c[c.length-1].to:l.from;u<l.to&&r>=u&&(r=l.to,o=l.to)}}}this.pendingText.length>0&&(this.pendingHold=!0),this.immediateRender=!0,this.sotEditor.replaceRange(r,o,e),e.includes(`
`)&&(this.pendingCaretScroll=!0)}backspace(){if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(i!==r){this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(i,r,"");return}i<=0||(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(i-1,i,""))}del(){if(!this.sotEditor)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(i!==r){this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(i,r,"");return}let o=this.sotEditor.getDoc().length;i>=o||(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(i,i+1,""))}handleListOutlinerKeydown(e){return this.sotEditor?kE({getDoc:()=>{var i,r;return(r=(i=this.sotEditor)==null?void 0:i.getDoc())!=null?r:null},getSelection:()=>{var i,r;return(r=(i=this.sotEditor)==null?void 0:i.getSelection())!=null?r:null},getLineRanges:()=>this.lineRanges,getLineBlockKinds:()=>this.lineBlockKinds,replaceRange:(i,r,o)=>{var s;(s=this.sotEditor)==null||s.replaceRange(i,r,o)},updatePendingText:(i,r)=>this.updatePendingText(i,r),setSelectionNormalized:(i,r)=>this.setSelectionNormalized(i,r),setSelectionRaw:(i,r)=>{var o;(o=this.sotEditor)==null||o.setSelection({anchor:i,head:r})},focusInputSurface:(i=!0)=>this.focusInputSurface(i),getWritingMode:()=>this.writingMode,markImmediateRender:()=>{this.immediateRender=!0}},e):!1}handleNavigate(e){var h;if(!this.sotEditor||!this.derivedRootEl)return;let i=this.sotEditor.getDoc(),r=this.sotEditor.getSelection(),o=r.head;this.updatePendingText("",!0);let s=window.getComputedStyle(this.derivedRootEl).writingMode,a=this.getVisualMoveInfo(e.key,s),l=(h=a==null?void 0:a.offset)!=null?h:null;l===null&&(l=this.getNextOffset(i,o,e.key,s)),a!=null&&a.atBoundary&&(l=this.adjustCrossParagraphOffset(o,l));let c=l>=o,u=this.normalizeOffsetToVisible(l,c);u===o&&l!==o?l=this.findNextVisibleOffset(o,c):l=u;let d=e.shiftKey?r.anchor:l;this.setSelectionNormalized(d,l),this.pendingCaretScroll=!0,this.scheduleCaretUpdate(!0)}findNextVisibleOffset(e,i){if(!this.sotEditor)return e;let r=this.sotEditor.getDoc().length,o=Math.max(0,Math.min(e,r)),s=this.findLineIndex(o);if(s===null)return o;let a=i?1:-1;for(let l=s;l>=0&&l<this.lineRanges.length;l+=a){let c=this.lineRanges[l];if(!c)break;let u=this.buildSegmentsForLine(c.from,c.to);if(u.length===0){if(l!==s)return i?c.from:c.to;continue}if(l===s)if(i)for(let d of u){if(o<d.from)return d.from;if(o>=d.from&&o<d.to)return Math.min(d.to,o+1)}else for(let d=u.length-1;d>=0;d-=1){let h=u[d];if(o>h.to)return h.to;if(o>h.from&&o<=h.to)return Math.max(h.from,o-1)}else return i?u[0].from:u[u.length-1].to}return o}updatePendingText(e,i=!1){var o;if(this.ceImeMode){this.pendingText="",this.pendingHold=!1,this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null,this.pendingEl&&(this.pendingEl.style.display="none");return}if(!i&&e.length===0&&this.pendingHold||(this.pendingText=e,e.length===0&&!this.pendingHold?this.restorePendingSelectionLines():e.length>0&&this.capturePendingSelection(),!this.pendingEl))return;let r=e.length>0?e:"";this.pendingEl.textContent=r,this.showPendingOverlay?(o=this.overlayTextarea)!=null&&o.isImeVisible()?this.pendingEl.style.display="none":this.pendingEl.style.display=r.length>0?"":"none":this.pendingEl.style.display="none",this.scheduleCaretUpdate()}updatePendingPosition(e,i){this.pendingEl&&(this.pendingEl.style.left=`${e}px`,this.pendingEl.style.top=`${i}px`)}handleCopyCut(e,i){if(!this.sotEditor)return;this.ceImeMode&&this.syncSelectionFromCe();let r=this.sotEditor.getSelection(),o=Math.min(r.anchor,r.head),s=Math.max(r.anchor,r.head);if(o===s)return;let a=this.sotEditor.getDoc().slice(o,s);e.clipboardData&&(e.clipboardData.setData("text/plain",a),e.clipboardData.setData("text/markdown",a)),e.preventDefault(),e.stopPropagation(),i&&(this.updatePendingText("",!0),this.immediateRender=!0,this.sotEditor.replaceRange(o,s,""))}handlePaste(e){var l,c,u,d;if(!this.sotEditor)return;if(this.ceImeMode){e.preventDefault(),e.stopPropagation();let h=this.syncSelectionFromCe();if(!h)return;let p=Math.min(h.anchor,h.head),f=Math.max(h.anchor,h.head),g=(c=(l=e.clipboardData)==null?void 0:l.getData("text/plain"))!=null?c:"";if(g.length>0){let m=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`);this.applyCeReplaceRange(p,f,m);return}this.readTextFromClipboard().then(m=>{if(!m)return;let b=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`);this.applyCeReplaceRange(p,f,b)});return}let i=(d=(u=e.clipboardData)==null?void 0:u.getData("text/plain"))!=null?d:"";if(i.length===0)return;e.preventDefault(),e.stopPropagation();let r=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`);this.updatePendingText("",!0);let o=this.sotEditor.getSelection(),s=Math.min(o.anchor,o.head),a=Math.max(o.anchor,o.head);this.immediateRender=!0,this.sotEditor.replaceRange(s,a,r)}updateSelectionOverlay(){Pl(this)}getPendingCaretRect(e,i){if(!this.pendingSpacerEl||this.pendingText.length===0)return null;let r=this.pendingSpacerEl.firstChild;if(!r||r.nodeType!==Node.TEXT_NODE)return null;let o=r,s=o.length,a=i==null?s:Math.max(0,Math.min(i,s)),l=document.createRange();return l.setStart(o,a),l.setEnd(o,a),this.pickCaretRectFromRange(l,e)}getPendingSpacerStartRect(e,i,r){if(!this.pendingSpacerEl||this.pendingLineIndex===null||this.pendingLineIndex!==i||!e.contains(this.pendingSpacerEl))return null;let o=this.pendingSpacerEl.firstChild;if(o&&o.nodeType===Node.TEXT_NODE){let s=document.createRange();return s.setStart(o,0),s.setEnd(o,0),this.pickCaretRectFromRange(s,r)}return this.pendingSpacerEl.getBoundingClientRect()}updatePendingSpacer(e,i){if(!this.derivedContentEl)return;if(this.pendingText.length===0){this.restorePendingSelectionLines(),this.restorePendingLine();return}if(this.applyPendingSelectionReplace())return;let r=this.lineRanges[e],o=this.getLineElement(e);if(!r||!o){this.restorePendingSelectionLines(),this.restorePendingLine();return}let s=this.normalizeOffsetToVisible(r.from+i,!0),a=Math.max(0,Math.min(s-r.from,r.to-r.from));if(this.pendingLineIndex===e&&this.pendingLocalOffset===a&&this.pendingSpacerEl){this.pendingSpacerEl.textContent=this.pendingText;return}this.restorePendingLine();let l=this.buildSegmentsForLine(r.from,r.to),c=this.getInlineWidgetsForLineRange(r);this.renderLineFromSegments(o,r,l,{insertOffset:s,pendingText:this.pendingText},c),this.pendingLineIndex=e,this.pendingLocalOffset=a}restorePendingLine(){if(this.pendingLineIndex===null||!this.derivedContentEl){this.pendingSpacerEl=null,this.pendingLocalOffset=null,this.pendingLineIndex=null;return}let e=this.lineRanges[this.pendingLineIndex],i=this.getLineElement(this.pendingLineIndex);if(!e||!i){this.pendingSpacerEl=null,this.pendingLocalOffset=null,this.pendingLineIndex=null;return}i.replaceChildren(),this.renderLine(i,e),this.pendingSpacerEl=null,this.pendingLocalOffset=null,this.pendingLineIndex=null}capturePendingSelection(){if(!this.sotEditor||this.pendingSelectionFrom!==null)return;let e=this.sotEditor.getSelection(),i=Math.min(e.anchor,e.head),r=Math.max(e.anchor,e.head);if(i===r)return;let o=this.normalizeOffsetToVisible(i,!0),s=this.normalizeOffsetToVisible(r,!1),a=this.findLineIndex(o),l=this.findLineIndex(s);a===null||l===null||(this.pendingSelectionFrom=o,this.pendingSelectionTo=s,this.pendingSelectionLineStart=a,this.pendingSelectionLineEnd=l)}applyPendingSelectionReplace(){if(this.pendingSelectionFrom===null||this.pendingSelectionTo===null||this.pendingSelectionLineStart===null||this.pendingSelectionLineEnd===null||!this.derivedContentEl)return!1;let e=this.pendingSelectionLineStart,i=this.pendingSelectionLineEnd,r=this.pendingSelectionFrom,o=this.pendingSelectionTo;if(e>i)return!1;let s=this.lineRanges[e],a=s?s.to-s.from:0,l=s?Math.max(0,Math.min(r-s.from,a)):0;if(this.pendingLineIndex===e&&this.pendingLocalOffset===l&&this.pendingSpacerEl)return this.pendingSpacerEl.textContent=this.pendingText,!0;this.restorePendingLine();for(let c=e;c<=i;c+=1){let u=this.lineRanges[c],d=this.getLineElement(c);if(!u||!d)continue;let h=c===e?r:u.from,p=c===i?o:u.to,f=this.buildSegmentsForLine(u.from,u.to),g=this.getInlineWidgetsForLineRange(u),m=this.removeRangeFromSegments(f,h,p),b=this.removeRangeFromInlineWidgets(g,h,p);c===e?(this.renderLineFromSegments(d,u,m,{insertOffset:r,pendingText:this.pendingText},b),this.pendingLineIndex=e,this.pendingLocalOffset=l):this.renderLineFromSegments(d,u,m,void 0,b)}return!0}restorePendingSelectionLines(){if(this.pendingSelectionLineStart===null||this.pendingSelectionLineEnd===null){this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null;return}let e=this.pendingSelectionLineStart,i=this.pendingSelectionLineEnd;for(let r=e;r<=i;r+=1){let o=this.lineRanges[r],s=this.getLineElement(r);!o||!s||(s.replaceChildren(),this.renderLine(s,o))}this.pendingSelectionFrom=null,this.pendingSelectionTo=null,this.pendingSelectionLineStart=null,this.pendingSelectionLineEnd=null,this.pendingSpacerEl=null,this.pendingLineIndex=null,this.pendingLocalOffset=null}renderLine(e,i,r){this.lineRenderer.renderLine(e,i,r)}ensureLineRendered(e){this.lineRenderer.ensureLineRendered(e)}renderLineLight(e,i,r){this.lineRenderer.renderLineLight(e,i,r)}removeRangeFromSegments(e,i,r){return this.lineRenderer.removeRangeFromSegments(e,i,r)}removeRangeFromInlineWidgets(e,i,r){return this.lineRenderer.removeRangeFromInlineWidgets(e,i,r)}splitSegmentsAtOffset(e,i){return this.lineRenderer.splitSegmentsAtOffset(e,i)}renderInlineSegmentsWithWidgets(e,i,r,o,s){this.lineRenderer.renderInlineSegmentsWithWidgets(e,i,r,o,s)}renderLineFromSegments(e,i,r,o,s){this.lineRenderer.renderLineFromSegments(e,i,r,o,s)}renderTableRowLine(e,i,r,o,s){this.lineRenderer.renderTableRowLine(e,i,r,o,s)}splitSegmentsAtOffsets(e,i){return this.lineRenderer.splitSegmentsAtOffsets(e,i)}getTablePipeOffsets(e){let i=[],r=s=>{let a=0;for(let l=s-1;l>=0&&e[l]==="\\";l-=1)a+=1;return a%2===1},o=null;for(let s=0;s<e.length;s+=1){let a=e[s];if(a==="`"&&!r(s)){let l=1;for(;s+l<e.length&&e[s+l]==="`";)l+=1;o===null?o=l:o===l&&(o=null),s+=l-1;continue}o===null&&a==="|"&&(r(s)||i.push(s))}return i}getLineElement(e){var o;let i=this.getLineElementOffset(),r=(o=this.derivedContentEl)==null?void 0:o.children[e+i];return r!=null?r:null}getLineElementOffset(){if(!this.derivedContentEl)return 0;let e=this.derivedContentEl.firstElementChild;return e!=null&&e.classList.contains("tategaki-frontmatter")?1:0}getLineText(e){var i,r;return(r=(i=this.sotEditor)==null?void 0:i.getDoc().slice(e.from,e.to))!=null?r:""}findLineIndex(e){return this.findLineIndexInRanges(this.lineRanges,e)}findLineIndexInRanges(e,i){if(e.length===0)return null;let r=0,o=e.length-1;for(;r<=o;){let s=Math.floor((r+o)/2),a=e[s];if(!a)return null;if(i<a.from)o=s-1;else if(i>a.to)r=s+1;else return s}return null}getCaretRectInLine(e,i,r,o=""){var d,h,p,f;let s=(d=e.dataset.mdKind)!=null?d:"";if(s==="image-widget"||s==="embed-widget"||s==="math-widget"||s==="math-hidden"||s==="callout-widget"||s==="callout-hidden"||s==="table-widget"||s==="table-hidden"||s==="deflist-widget"||s==="deflist-hidden"){let g=e.querySelector(".tategaki-sot-eol");return(h=g==null?void 0:g.getBoundingClientRect())!=null?h:e.getBoundingClientRect()}let a=r.to-r.from;if(a===0){let g=this.ceImeMode?this.ensureCeInputPlaceholderNode(e):null,m=e.querySelector(".tategaki-sot-eol"),b=g!=null?g:m!=null&&m.firstChild&&m.firstChild.nodeType===Node.TEXT_NODE?m.firstChild:null;if(b){let v=document.createRange();v.setStart(b,0),v.setEnd(b,0);let E=this.pickCaretRectFromRange(v,o);if(E)return E}let y=e.getBoundingClientRect();return DOMRect.fromRect({x:y.left,y:y.top,width:0,height:y.height})}if(i>=a){let g=this.getLineTextNodes(e),m=g[g.length-1];if(m){let y=document.createRange();y.setStart(m,m.length),y.setEnd(m,m.length);let v=this.pickCaretRectFromRange(y,o);if(v)return v}let b=e.querySelector(".tategaki-sot-eol");return(p=b==null?void 0:b.getBoundingClientRect())!=null?p:e.getBoundingClientRect()}let l=g=>{var v;if(g<0||g>=a)return null;let m=this.findTextNodeAtOffset(e,g),b=this.findTextNodeAtOffset(e,g+1);if(!m||!b)return null;let y=document.createRange();return y.setStart(m.node,m.offset),y.setEnd(b.node,b.offset),(v=this.pickCaretRectFromRange(y,o))!=null?v:y.getBoundingClientRect()};if(i>0&&i<a){let g=l(i-1),m=l(i);if(g&&m){let b=o.startsWith("vertical"),y=Math.abs(b?g.left-m.left:g.top-m.top),v=b?Math.max(1,g.width*.5):Math.max(1,g.height*.5);if(y>v)return m}}let c=this.findTextNodeAtOffset(e,i);if(!c)return e.getBoundingClientRect();let u=document.createRange();return u.setStart(c.node,c.offset),u.setEnd(c.node,c.offset),(f=this.pickCaretRectFromRange(u,o))!=null?f:e.getBoundingClientRect()}pickCaretRectFromRange(e,i){var a;let r=e.getClientRects();if(r.length===0)return e.getBoundingClientRect();if(r.length===1)return(a=r[0])!=null?a:null;if(i.startsWith("vertical")){let l=i!=="vertical-lr",c=r[0];for(let u of Array.from(r))l?u.left>c.left&&(c=u):u.left<c.left&&(c=u);return c}let s=r[0];for(let l of Array.from(r))l.top<s.top&&(s=l);return s}findTextNodeAtOffset(e,i){var h,p;let r=Number.parseInt((h=e.dataset.from)!=null?h:"0",10),o=Number.parseInt((p=e.dataset.to)!=null?p:"0",10),s=Math.max(0,o-r),a=Math.max(0,Math.min(i,s)),l=Array.from(e.querySelectorAll(".tategaki-sot-run"));if(l.length===0){let f=this.getLineTextNodes(e),g=a;for(let b of f){if(g<=b.length)return{node:b,offset:g};g-=b.length}let m=f[f.length-1];return m?{node:m,offset:m.length}:null}let c=l.map(f=>{var y,v;let g=Number.parseInt((y=f.dataset.from)!=null?y:"",10),m=Number.parseInt((v=f.dataset.to)!=null?v:"",10),b=f.firstChild&&f.firstChild.nodeType===Node.TEXT_NODE?f.firstChild:null;return{el:f,from:g,to:m,textNode:b}}).filter(f=>Number.isFinite(f.from)&&Number.isFinite(f.to)&&f.to>=f.from&&!!f.textNode).sort((f,g)=>f.from-g.from||f.to-g.to),u=c[0],d=c[c.length-1];if(!u||!d)return null;if(a<=u.from)return{node:u.textNode,offset:0};if(a>=d.to){let f=d.to-d.from;return{node:d.textNode,offset:Math.max(0,f)}}for(let f=0;f<c.length;f+=1){let g=c[f];if(a>=g.from&&a<=g.to){let b=Math.max(0,a-g.from);return{node:g.textNode,offset:b}}let m=c[f+1];if(m&&a>g.to&&a<m.from)return{node:m.textNode,offset:0}}return{node:d.textNode,offset:Math.max(0,d.to-d.from)}}getLineTextNodes(e){let i=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),o=r.nextNode();for(;o;)!this.isPendingTextNode(o)&&!this.isEolTextNode(o)&&!this.isCeInputPlaceholderTextNode(o)&&!this.isInlineWidgetTextNode(o)&&i.push(o),o=r.nextNode();return i}isPendingTextNode(e){let i=e.parentElement;return!!(i!=null&&i.classList.contains("tategaki-sot-pending-spacer"))}isEolTextNode(e){let i=e.parentElement;return!!(i!=null&&i.classList.contains("tategaki-sot-eol"))}isCeInputPlaceholderTextNode(e){let i=e.parentElement;return!!(i!=null&&i.classList.contains("tategaki-sot-ce-input-placeholder"))}ensureCeInputPlaceholderNode(e){if(!this.ceImeMode)return null;let i=e.querySelector(".tategaki-sot-ce-input-placeholder");if(!i){i=document.createElement("span"),i.className="tategaki-sot-ce-input-placeholder",i.textContent="\u200B";let o=e.querySelector(".tategaki-sot-eol");o?e.insertBefore(i,o):e.appendChild(i)}let r=i.firstChild;return(r==null?void 0:r.nodeType)===Node.TEXT_NODE?r:null}isInlineWidgetTextNode(e){let i=e.parentElement;return!!(i!=null&&i.closest(".tategaki-md-inline-widget"))}isUnsafeCeSelectionNode(e){var r;if(!e)return!1;if(this.isPendingTextNode(e)||this.isEolTextNode(e))return!0;let i=e instanceof Element?e:(r=e.parentElement)!=null?r:null;return i?!!(i.classList.contains("tategaki-sot-line")||i.closest(".tategaki-sot-eol")||i.closest(".tategaki-sot-pending-spacer")):!1}scheduleCeSafetyCheck(){Ie.Platform.isMobile||Ie.Platform.isMobileApp||!this.ceImeMode||this.ceImeComposing||this.ceImeSelectionSyncing||this.ceImeFallbackActive||Date.now()-this.ceSafetyCheckAt<80||this.ceSafetyCheckRaf===null&&(this.ceSafetyCheckRaf=window.requestAnimationFrame(()=>{this.ceSafetyCheckRaf=null,this.ceSafetyCheckAt=Date.now(),this.verifyCeSelectionContext()}))}verifyCeSelectionContext(){var v,E;if(!this.ceImeMode||this.ceImeComposing||this.ceImeSelectionSyncing||!this.sotEditor||!this.derivedContentEl)return;let e=this.derivedContentEl.ownerDocument.getSelection();if(!e||!e.isCollapsed||!this.isSelectionInsideDerivedContent(e))return;let i=e.anchorNode;if(!i)return;let r=this.getLineElementForNode(i);if(!r||this.shouldSkipCeSafetyCheckLine(r))return;let o=Number.parseInt((v=r.dataset.from)!=null?v:"0",10),s=Number.parseInt((E=r.dataset.to)!=null?E:"0",10),a=Math.max(0,s-o);if(a===0)return;if(i.nodeType!==Node.TEXT_NODE){this.isUnsafeCeSelectionNode(i)&&this.recordCeMappingFailure("verification",!0);return}if(this.isPendingTextNode(i)||this.isEolTextNode(i)||this.isCeInputPlaceholderTextNode(i)){this.recordCeMappingFailure("verification",!0);return}let l=this.resolveOffsetFromCaretPosition(r,{node:i,offset:e.anchorOffset},a);if(l===null){this.recordCeMappingFailure("verification",!0);return}let c=o+l,u=this.buildSegmentsForLine(o,s);if(u.length===0)return;let d=u.reduce((x,k)=>x+k.text.length,0);if(d===0||d>2e3)return;let h=this.getVisibleOffsetFromSegments(u,c),p=this.getVisibleOffsetFromDomPosition(r,i,e.anchorOffset);if(p===null){this.recordCeMappingFailure("verification",!0);return}if(Math.abs(p-h)>1){this.recordCeMappingFailure("verification",!0);return}let f=16,g=Math.max(0,h-f),m=Math.min(d,h+f),b=this.getSegmentsTextRange(u,g,m),y=this.getDomTextRange(r,g,m);b!==y&&this.recordCeMappingFailure("verification",!0)}shouldSkipCeSafetyCheckLine(e){var r;let i=(r=e.dataset.mdKind)!=null?r:"";return i.endsWith("-widget")||i.endsWith("-hidden")||i==="table-row"||i==="table-sep"?!0:e.querySelector(".tategaki-md-inline-widget")!==null}getVisibleOffsetFromSegments(e,i){let r=0;for(let o of e){if(i<=o.from)return r;if(i<o.to)return r+Math.max(0,i-o.from);r+=o.to-o.from}return r}getVisibleOffsetFromDomPosition(e,i,r){let o=this.getLineTextNodes(e),s=0;for(let a of o){if(a===i)return s+Math.max(0,Math.min(r,a.length));s+=a.length}return null}getSegmentsTextRange(e,i,r){if(r<=i)return"";let o=0,s=[];for(let a of e){let l=a.text.length,c=o,u=o+l;if(u<=i){o=u;continue}if(c>=r)break;let d=Math.max(0,i-c),h=Math.min(l,r-c);h>d&&s.push(a.text.slice(d,h)),o=u}return s.join("")}getDomTextRange(e,i,r){if(r<=i)return"";let o=this.getLineTextNodes(e),s=0,a=[];for(let l of o){let c=l.length,u=s,d=s+c;if(d<=i){s=d;continue}if(u>=r)break;let h=Math.max(0,i-u),p=Math.min(c,r-u);p>h&&a.push(l.data.slice(h,p)),s=d}return a.join("")}resolveOffsetFromCaretPosition(e,i,r){var a;if(!i)return null;let{node:o,offset:s}=i;if(!e.contains(o))return null;if(o instanceof Element&&o.classList.contains("tategaki-sot-line"))return this.resolveOffsetFromLineElementSelection(e,s,r);if(this.isPendingTextNode(o))return(a=this.pendingLocalOffset)!=null?a:0;if(this.isEolTextNode(o))return r;if(this.isCeInputPlaceholderTextNode(o))return 0;if(o.nodeType===Node.TEXT_NODE)return this.calculateOffsetWithinLine(e,o,s);if(o instanceof Element){if(o.classList.contains("tategaki-sot-run")){let c=o.firstChild;if((c==null?void 0:c.nodeType)===Node.TEXT_NODE){let u=c,d=s>0?u.length:0;return this.calculateOffsetWithinLine(e,u,d)}}if(o.classList.contains("tategaki-sot-eol"))return r;if(o.classList.contains("tategaki-sot-ce-input-placeholder"))return 0;let l=o.firstChild;if((l==null?void 0:l.nodeType)===Node.TEXT_NODE){let c=l,u=s>0?c.length:0;return this.calculateOffsetWithinLine(e,c,u)}}return null}resolveOffsetFromLineElementSelection(e,i,r){var c,u;let o=e.childNodes.length;if(o===0||i<=0)return 0;if(i>=o)return r;let s=(d,h)=>{var p,f,g;if(this.isPendingTextNode(d))return(p=this.pendingLocalOffset)!=null?p:0;if(this.isEolTextNode(d))return r;if(this.isCeInputPlaceholderTextNode(d))return 0;if(d.nodeType===Node.TEXT_NODE){let m=d,b=h?m.length:0;return this.calculateOffsetWithinLine(e,m,b)}if(d instanceof Element){if(d.classList.contains("tategaki-sot-eol"))return r;if(d.classList.contains("tategaki-sot-ce-input-placeholder"))return 0;if(d.classList.contains("tategaki-sot-run")||d.classList.contains("tategaki-md-inline-widget")){let b=d,y=Number.parseInt((f=b.dataset.from)!=null?f:"",10),v=Number.parseInt((g=b.dataset.to)!=null?g:"",10);if(Number.isFinite(y)&&Number.isFinite(v))return h?v:y}let m=d.firstChild;if((m==null?void 0:m.nodeType)===Node.TEXT_NODE){let b=m,y=h?b.length:0;return this.calculateOffsetWithinLine(e,b,y)}}return null},a=(c=e.childNodes[i-1])!=null?c:null,l=(u=e.childNodes[i])!=null?u:null;if(a){let d=s(a,!0);if(d!==null)return d}if(l){let d=s(l,!1);if(d!==null)return d}return r}getEdgeOffsetFromPoint(e,i,r,o,s){var c;if(s<=0)return 0;let a=wr(o,e.getBoundingClientRect()),l=window.getComputedStyle((c=this.derivedRootEl)!=null?c:e).writingMode;return l.startsWith("vertical")?l!=="vertical-lr"?i<a.left?s:0:i>a.right?s:0:i<=a.left||r<=a.top?0:i>=a.right||r>=a.bottom?s:0}getLocalOffsetFromPoint(e,i,r,o){if(o<=0)return 0;let s=e.ownerDocument;if(!s)return null;let a=this.resolveOffsetFromCaretPosition(e,Nh(s,i,r),o);if(a!==null)return Math.max(0,Math.min(a,o));let l=this.getLineVisualRects(e),c=l.length>0?l[this.findClosestRectIndex(l,i,r)]:e.getBoundingClientRect(),u=AE(c,i,r),d=this.resolveOffsetFromCaretPosition(e,Nh(s,u.x,u.y),o);return d!==null?Math.max(0,Math.min(d,o)):this.getEdgeOffsetFromPoint(e,i,r,l,o)}calculateOffsetWithinLine(e,i,r){var d,h,p,f,g;let o=Number.parseInt((d=e.dataset.from)!=null?d:"0",10),s=Number.parseInt((h=e.dataset.to)!=null?h:"0",10),a=Math.max(0,s-o),l=(p=i.parentElement)==null?void 0:p.closest(".tategaki-sot-run");if(l){let m=Number.parseInt((f=l.dataset.from)!=null?f:"",10),b=Number.parseInt((g=l.dataset.to)!=null?g:"",10);if(Number.isFinite(m)&&Number.isFinite(b)){let y=Math.max(0,b-m),v=Math.max(0,Math.min(r,y)),E=m+v;return Math.max(0,Math.min(E,a))}}let c=this.getLineTextNodes(e),u=0;for(let m of c){if(m===i)return u+Math.min(r,m.length);u+=m.length}return Math.max(0,Math.min(u,a))}getVisualMoveInfo(e,i){var T,A,B,W;if(!this.derivedRootEl||!this.sotEditor)return null;let r=i.startsWith("vertical"),o=!r;if(r&&!(e==="ArrowLeft"||e==="ArrowRight")||o&&!(e==="ArrowUp"||e==="ArrowDown"))return null;let c=this.sotEditor.getSelection().head,u=this.findLineIndex(c);if(u===null)return null;let d=this.lineRanges[u],h=this.getLineElement(u);if(!d||!h)return null;let p=d.to-d.from;if(p<=0)return{offset:null,atBoundary:!1};let f=Math.max(0,Math.min(c-d.from,p)),g=this.getCaretRectInLine(h,f,d,i);if(!g)return null;let m=this.getLineVisualRects(h);if(m.length<=1)return{offset:null,atBoundary:!1};let b=m.slice().sort((K,J)=>r?K.left-J.left||K.top-J.top:K.top-J.top||K.left-J.left),y=g.left+(g.width||0)/2,v=g.top+(g.height||0)/2,k=this.findClosestRectIndex(b,y,v)+(r&&e==="ArrowLeft"?-1:r&&e==="ArrowRight"?1:o&&e==="ArrowUp"?-1:1);if(k<0||k>=b.length){let K=r?i==="vertical-lr"?e==="ArrowRight"?1:-1:e==="ArrowLeft"?1:-1:e==="ArrowDown"?1:-1,J=r?g.left:g.top,Z=r?e==="ArrowRight"?1:-1:e==="ArrowDown"?1:-1,ee=this.findNextVisualLineOffsetInLine(h,d,c,i,K>0,J,Z);if(ee!==null)return{offset:ee,atBoundary:!1};let Me=this.sotEditor.getDoc(),Be=this.getNextOffset(Me,c,e,i),ye=this.findLineIndex(Be);if(ye===null||ye===u)return{offset:c,atBoundary:!1};let pe=this.getLineElement(ye),Fe=this.lineRanges[ye];if(!pe||!Fe)return{offset:c,atBoundary:!1};let rt=Math.max(0,Fe.to-Fe.from);if(rt<=0)return{offset:Fe.from,atBoundary:!1};let Mt=y,Tt=v,dt=this.getLocalOffsetFromPoint(pe,Mt,Tt,rt);if(dt===null)return{offset:Fe.from,atBoundary:!1};let He=Math.max(0,Math.min(dt,rt));return{offset:Fe.from+He,atBoundary:!1}}let S=b[k],w=y,C=v;if(r){if(w=S.left+S.width/2,S.height>2){let K=S.top+1,J=S.bottom-1;C=Math.max(K,Math.min(v,J))}}else if(C=S.top+S.height/2,S.width>2){let K=S.left+1,J=S.right-1;w=Math.max(K,Math.min(y,J))}let I=this.getLocalOffsetFromPoint(h,w,C,p);if(I===null)return{offset:null,atBoundary:!0};let F=Math.max(0,Math.min(I,p)),N=d.from+F,H=this.getCaretRectInLine(h,F,d,i),_=1,P=((T=H==null?void 0:H.left)!=null?T:0)+((A=H==null?void 0:H.width)!=null?A:0)/2,L=((B=H==null?void 0:H.top)!=null?B:0)+((W=H==null?void 0:H.height)!=null?W:0)/2;if(!(!!H&&P>=S.left-_&&P<=S.right+_&&L>=S.top-_&&L<=S.bottom+_)||N===c){let K=r?i==="vertical-lr"?e==="ArrowRight"?1:-1:e==="ArrowLeft"?1:-1:e==="ArrowDown"?1:-1,J=r?g.left:g.top,Z=r?e==="ArrowRight"?1:-1:e==="ArrowDown"?1:-1,ee=this.findNextVisualLineOffsetInLine(h,d,c,i,K>0,J,Z);return ee!==null&&ee!==c?(N=ee,{offset:N,atBoundary:!1}):{offset:null,atBoundary:!0}}return{offset:N,atBoundary:!1}}findNextVisibleOffsetInLine(e,i,r){let o=Math.max(e.from,Math.min(i,e.to)),s=this.buildSegmentsForLine(e.from,e.to);if(s.length===0)return null;if(r){for(let a of s){if(o<a.from)return a.from;if(o>=a.from&&o<a.to)return Math.min(a.to,o+1)}return null}for(let a=s.length-1;a>=0;a-=1){let l=s[a];if(o>l.to)return l.to;if(o>l.from&&o<=l.to)return Math.max(l.from,o-1)}return null}findNextVisualLineOffsetInLine(e,i,r,o,s,a,l){let u=r;for(let d=0;d<2e3;d+=1){let h=this.findNextVisibleOffsetInLine(i,u,s);if(h===null||h===u)return null;let p=Math.max(0,Math.min(h-i.from,i.to-i.from)),f=this.getCaretRectInLine(e,p,i,o);if(!f)return null;let g=o.startsWith("vertical")?f.left:f.top;if(l>0?g>a+.5:g<a-.5)return h;u=h}return null}adjustCrossParagraphOffset(e,i){let r=this.findLineIndex(e),o=this.findLineIndex(i);if(r===null||o===null||o>=r)return i;let s=this.lineRanges[o];return s?s.to:i}getLineVisualRects(e){var l;let i=this.getLineTextNodes(e);if(i.length===0){let c=e.querySelector(".tategaki-sot-eol");return[(l=c==null?void 0:c.getBoundingClientRect())!=null?l:e.getBoundingClientRect()]}let r=document.createRange();r.setStart(i[0],0);let o=i[i.length-1];r.setEnd(o,o.length);let s=Array.from(r.getClientRects());if(s.length===0)return[e.getBoundingClientRect()];let a=[];for(let c of s){if(c.width<=0&&c.height<=0)continue;a.some(d=>Math.abs(d.left-c.left)<.5&&Math.abs(d.right-c.right)<.5&&Math.abs(d.top-c.top)<.5&&Math.abs(d.bottom-c.bottom)<.5)||a.push(c)}return this.mergeVisualLineRects(a)}mergeVisualLineRects(e){var s;if(e.length<=1)return e;let i=this.writingMode.startsWith("vertical"),r=Math.max(8,((s=this.getEffectiveFontSize())!=null?s:18)*.5),o=[];for(let a of e){let l=!1;for(let c of o){let u=c[0];if(!u)continue;if(i?Math.abs(a.left-u.left)<r||Math.abs(a.right-u.right)<r:Math.abs(a.top-u.top)<r||Math.abs(a.bottom-u.bottom)<r){c.push(a),l=!0;break}}l||o.push([a])}return o.map(a=>{let l=a[0];if(a.length===1&&l)return l;let c=1/0,u=1/0,d=-1/0,h=-1/0;for(let p of a)c=Math.min(c,p.left),u=Math.min(u,p.top),d=Math.max(d,p.right),h=Math.max(h,p.bottom);return new DOMRect(c,u,d-c,h-u)})}getEffectiveFontSize(){if(!this.derivedRootEl)return null;let e=window.getComputedStyle(this.derivedRootEl);return parseFloat(e.fontSize)||null}findClosestRectIndex(e,i,r){let o=0,s=Number.POSITIVE_INFINITY;for(let a=0;a<e.length;a+=1){let l=e[a];if(!l)continue;let c=i<l.left?l.left-i:i>l.right?i-l.right:0,u=r<l.top?l.top-r:r>l.bottom?r-l.bottom:0,d=c*c+u*u;d<s&&(s=d,o=a)}return o}getNextOffset(e,i,r,o){let s=Math.max(0,Math.min(i,e.length)),a=this.getLineInfo(e,s),l=o.startsWith("vertical"),c=o!=="vertical-lr";return l?r==="ArrowUp"?a.column<=0?a.lineStart>0?a.lineStart-1:s:Math.max(a.lineStart,s-1):r==="ArrowDown"?s>=a.lineEnd?a.lineEnd<e.length?a.lineEnd+1:s:Math.min(a.lineEnd,s+1):r==="ArrowLeft"?c?s>=a.lineEnd?this.getNextLineStart(e,a):this.moveToNextLine(e,a):s<=a.lineStart?this.getPrevLineEnd(e,a):this.moveToPrevLine(e,a):r==="ArrowRight"?c?s<=a.lineStart?this.getPrevLineEnd(e,a):this.moveToPrevLine(e,a):s>=a.lineEnd?this.getNextLineStart(e,a):this.moveToNextLine(e,a):s:r==="ArrowLeft"?Math.max(0,s-1):r==="ArrowRight"?Math.min(e.length,s+1):r==="ArrowUp"?this.moveToPrevLine(e,a):r==="ArrowDown"?this.moveToNextLine(e,a):s}getLineInfo(e,i){let r=e.lastIndexOf(`
`,Math.max(0,i-1))+1,o=e.indexOf(`
`,i),s=o===-1?e.length:o,a=Math.max(0,Math.min(i-r,s-r));return{lineStart:r,lineEnd:s,column:a}}moveToPrevLine(e,i){if(i.lineStart===0)return i.lineStart+i.column;let r=i.lineStart-1,o=e.lastIndexOf(`
`,Math.max(0,r-1))+1,s=r-o;return o+Math.min(i.column,s)}moveToNextLine(e,i){if(i.lineEnd>=e.length)return i.lineEnd;let r=i.lineEnd+1,o=e.indexOf(`
`,r),a=(o===-1?e.length:o)-r;return r+Math.min(i.column,a)}getNextLineStart(e,i){return i.lineEnd>=e.length?i.lineEnd:i.lineEnd+1}getPrevLineEnd(e,i){return i.lineStart<=0?0:Math.min(e.length,i.lineStart-1)}};var Ax=require("obsidian"),Hl=class extends Ax.Modal{constructor(e,i={}){var s,a;super(e);this.resolveResult=null;this.cancelled=!1;this.showCompat=!1;let r=(s=i.placement)!=null?s:i.openInNewWindow?"window":i.openOnRightSide===!1?"tab":"right";this.result={mode:null,openInNewWindow:r==="window",openOnRightSide:r==="right",placement:r},this.showCompat=(a=i.showCompat)!=null?a:!1;let o=i.defaultMode==="preview"?"edit":i.defaultMode;if(o==="compat"&&!this.showCompat){this.result.mode="edit";return}(o==="edit"||o==="compat")&&(this.result.mode=o)}openAndWait(){return new Promise(e=>{this.resolveResult=e,this.open()})}onOpen(){this.titleEl.setText("Tategaki\u30A8\u30C7\u30A3\u30BF\u3092\u958B\u304F"),this.contentEl.createEl("p",{text:"\u8868\u793A\u30E2\u30FC\u30C9\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"});let e=this.contentEl.createDiv();e.style.cssText=`
			display: flex;
			flex-direction: column;
			gap: 12px;
			margin: 12px 0;
		`,this.createModeButton(e,"edit","\u57F7\u7B46\u30FB\u53C2\u7167\u30E2\u30FC\u30C9","SoT\u30D3\u30E5\u30FC\u3067\u7DE8\u96C6\u30FB\u53C2\u7167\u3092\u884C\u3044\u307E\u3059\u3002"),this.createModeButton(e,"reading","\u66F8\u7C4D\u30E2\u30FC\u30C9","\u7E26\u66F8\u304D\u8AAD\u66F8\u30E2\u30FC\u30C9\u3067\u3001\u30DA\u30FC\u30B8\u3081\u304F\u308A\u30B9\u30BF\u30A4\u30EB\u3067\u95B2\u89A7\u3057\u307E\u3059\u3002"),this.showCompat&&this.createModeButton(e,"compat","\u4E92\u63DB\u30E2\u30FC\u30C9\uFF08\u65E7TipTap\uFF09","\u65E7TipTap\u30D9\u30FC\u30B9\u306E\u4E92\u63DB\u30D3\u30E5\u30FC\u3067\u7DE8\u96C6\u3057\u307E\u3059\u3002");let i=this.contentEl.createDiv();i.style.cssText=`
			display: flex;
			align-items: center;
			gap: 12px;
			margin-top: 8px;
			flex-wrap: wrap;
		`;let r=f=>{this.result.placement=f,this.result.openOnRightSide=f==="right",this.result.openInNewWindow=f==="window"},o=this.result.placement,s=i.createEl("label");s.style.cssText="display: inline-flex; gap: 6px; align-items: center;";let a=s.createEl("input",{type:"radio"});a.name="tategaki-open-placement",a.checked=o==="right",a.addEventListener("change",()=>{a.checked&&r("right")}),s.appendText("\u53F3\u5074\u306B\u958B\u304F");let l=i.createEl("label");l.style.cssText="display: inline-flex; gap: 6px; align-items: center;";let c=l.createEl("input",{type:"radio"});c.name="tategaki-open-placement",c.checked=o==="tab",c.addEventListener("change",()=>{c.checked&&r("tab")}),l.appendText("\u96A3\u306E\u30BF\u30D6\u306B\u958B\u304F");let u=i.createEl("label");u.style.cssText="display: inline-flex; gap: 6px; align-items: center;";let d=u.createEl("input",{type:"radio"});d.name="tategaki-open-placement",d.checked=o==="window",d.addEventListener("change",()=>{d.checked&&r("window")}),u.appendText("\u65B0\u898F\u30A6\u30A3\u30F3\u30C9\u30A6\u3067\u958B\u304F");let h=this.contentEl.createDiv();h.style.cssText=`
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
		`,h.createEl("button",{text:"\u30AD\u30E3\u30F3\u30BB\u30EB"}).addEventListener("click",()=>{this.cancelled=!0,this.close()});let p=h.createEl("button",{text:"\u958B\u304F",cls:"mod-cta"});p.disabled=this.result.mode==null,p.addEventListener("click",()=>{this.result.mode!=null&&this.close()}),this.contentEl.addEventListener("change",()=>{p.disabled=this.result.mode==null})}onClose(){this.contentEl.empty();let e=this.resolveResult;this.resolveResult=null,this.cancelled?e==null||e({mode:null,openInNewWindow:!1,openOnRightSide:!1,placement:"right"}):e==null||e({...this.result})}createModeButton(e,i,r,o){let s=e.createDiv();s.style.cssText=`
			border: 1px solid var(--background-modifier-border);
			border-radius: 8px;
			padding: 10px 12px;
			background: var(--background-primary);
		`;let a=s.createDiv();a.style.cssText=`
			display: flex;
			align-items: center;
			gap: 10px;
		`;let l=a.createEl("input",{type:"radio"});l.name="tategaki-view-mode",l.checked=this.result.mode===i,l.addEventListener("change",()=>{this.result.mode=i});let c=a.createEl("div");c.style.cssText="font-weight: 700;",c.setText(r);let u=s.createEl("div");u.style.cssText="margin-top: 6px; color: var(--text-muted);",u.setText(o),s.addEventListener("click",()=>{this.result.mode=i,l.checked=!0,l.dispatchEvent(new Event("change"))})}};var Ix=require("obsidian"),Ro=class extends Ix.Modal{constructor(t){super(t)}onOpen(){this.titleEl.setText("Tategaki\u30D3\u30E5\u30FC\u304C\u65E2\u306B\u958B\u304B\u308C\u3066\u3044\u307E\u3059"),this.contentEl.createEl("p",{text:"\u65E2\u306BTategaki\u30D3\u30E5\u30FC\uFF08\u57F7\u7B46\u30E2\u30FC\u30C9\u3001\u53C2\u7167\u30E2\u30FC\u30C9\u3001\u307E\u305F\u306F\u66F8\u7C4D\u30E2\u30FC\u30C9\uFF09\u304C\u958B\u304B\u308C\u3066\u3044\u307E\u3059\u3002\u65B0\u3057\u3044\u30D3\u30E5\u30FC\u3092\u958B\u304F\u306B\u306F\u3001\u65E2\u5B58\u306E\u30D3\u30E5\u30FC\u3092\u9589\u3058\u3066\u304F\u3060\u3055\u3044\u3002"});let t=this.contentEl.createDiv();t.style.cssText=`
			display: flex;
			justify-content: flex-end;
			margin-top: 16px;
		`,t.createEl("button",{text:"OK",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var ni=class ni{constructor(t,e,i){this.openInNewWindow=!1;this.openOnRightSide=!0;this.managedLeaves=new Set;this.workspaceGuards=[];this.primaryLeaf=null;this.enforceTimer=null;this.nextViewMode=null;this.app=t,this.settings=e,this.plugin=i}async registerViews(){var e,i,r,o,s,a,l,c,u;try{let d=[...this.app.workspace.getLeavesOfType(Xe),...this.app.workspace.getLeavesOfType(It)];if(d.length>0){for(let h of d){let p=h.view;try{(r=(i=(e=p==null?void 0:p.syncManager)==null?void 0:e.getState)==null?void 0:i.call(e))!=null&&r.dirty?await((s=(o=p.syncManager).flush)==null?void 0:s.call(o)):typeof(p==null?void 0:p.handleAppQuit)=="function"&&await p.handleAppQuit("save")}catch(f){le("Tategaki: failed to flush view before detach",f)}}d.forEach(h=>h.detach()),await new Promise(h=>setTimeout(h,100))}}catch(d){le("Tategaki: Error checking existing views",d)}let t=this.app.viewRegistry;(a=t==null?void 0:t.viewByType)!=null&&a[Xe]||this.plugin.registerView(Xe,d=>new Co(d,this.plugin,Xe)),(l=t==null?void 0:t.viewByType)!=null&&l[It]||this.plugin.registerView(It,d=>new Co(d,this.plugin,It)),(c=t==null?void 0:t.viewByType)!=null&&c[Nt]||this.plugin.registerView(Nt,d=>new pl(d,this.plugin)),(u=t==null?void 0:t.viewByType)!=null&&u[bt]||this.plugin.registerView(bt,d=>new Fl(d,this.plugin)),this.setupWorkspaceGuards(),this.applySingleViewConstraints()}async openView(t){var o,s,a,l;let e=this.getAllEditorLeaves(),i=this.getAllReadingLeaves();if(e.length>0||i.length>0){new Ro(this.app).open();return}let r=(o=this.settings.lastViewOpenPlacement)!=null?o:"right";if(this.settings.showModeDialog){let u=await new Hl(this.app,{defaultMode:(s=this.settings.lastViewMode)!=null?s:"edit",placement:r,showCompat:(a=this.settings.enableLegacyTiptap)!=null?a:!0}).openAndWait();if(!u.mode)return;this.openInNewWindow=u.openInNewWindow,this.openOnRightSide=u.openOnRightSide,this.nextViewMode=u.mode,u.mode!=="reading"?await this.plugin.updateSettings({lastViewMode:u.mode,lastViewOpenPlacement:u.placement}):await this.plugin.updateSettings({lastViewOpenPlacement:u.placement})}else{this.openInNewWindow=r==="window",this.openOnRightSide=r==="right";let c=this.settings.lastViewMode==="preview"?"edit":(l=this.settings.lastViewMode)!=null?l:"edit";this.nextViewMode=c==="compat"&&!this.settings.enableLegacyTiptap?"edit":c}try{if(this.nextViewMode==="reading"){let c=this.app.workspace.getActiveFile();c&&await this.toggleReadingView(c,{openInNewWindow:this.openInNewWindow,openOnRightSide:this.openOnRightSide})}else if(this.nextViewMode==="compat"){if(!this.settings.enableLegacyTiptap){new Vl.Notice("\u4E92\u63DB\u30E2\u30FC\u30C9\u304C\u7121\u52B9\u3067\u3059\u3002\u8A2D\u5B9A\u3067\u6709\u52B9\u5316\u3057\u3066\u304F\u3060\u3055\u3044\u3002",2500);return}await this.openTipTapView()}else{let c=this.resolveRetainedFile();if(!c)return;await this.openSoTWysiwygView(c,{openInNewWindow:this.openInNewWindow,openOnRightSide:this.openOnRightSide})}}finally{this.nextViewMode=null}}async onSettingsChanged(t){var o,s,a,l,c;this.settings=t;let e=this.getAllEditorLeaves();for(let u of e){let d=u.view;await((o=d.updateSettings)==null?void 0:o.call(d,t))}let i=this.getAllReadingLeaves();for(let u of i){let d=u.view;await((s=d.updateSettings)==null?void 0:s.call(d,t))}let r=(c=(l=(a=this.app.workspace.activeLeaf)==null?void 0:a.view)==null?void 0:l.getViewType)==null?void 0:c.call(l);r!==Xe&&r!==It&&r!==bt&&e.length>0&&this.openTipTapView()}cleanup(){for(let t of this.managedLeaves)try{t.__tategakiManaged&&(t.detach(),delete t.__tategakiManaged)}catch(e){le("Tategaki: failed to detach managed leaf",e)}this.managedLeaves.clear(),this.primaryLeaf=null,this.openInNewWindow=!1,this.clearEnforcementTimer(),this.disposeWorkspaceGuards(),this.unregisterViews()}unregisterViews(){try{this.getAllEditorLeaves().forEach(i=>i.detach()),this.getAllReadingLeaves().forEach(i=>i.detach())}catch(t){le("Tategaki: failed to close views",t)}}async toggleReadingView(t,e){var s,a,l,c,u;if(!t)return!1;if(this.getAllEditorLeaves().length>0&&!(e!=null&&e.targetLeaf))return new Ro(this.app).open(),!1;let r=(s=e==null?void 0:e.targetLeaf)!=null?s:null;if(r){if(((l=(a=r.view)==null?void 0:a.getViewType)==null?void 0:l.call(a))===Nt){let h=(c=e==null?void 0:e.returnViewMode)!=null?c:"sot";return h==="sot"?await this.openSoTWysiwygViewInLeaf(t,r):await this.openTipTapViewInLeaf(t,r,h),!1}return await this.openReadingViewInLeaf(t,r,(u=e==null?void 0:e.returnViewMode)!=null?u:"sot"),!0}let o=this.findReadingLeafForFile(t.path);if(o){try{o.detach()}catch(d){le("Tategaki: failed to close reading view",d)}return!1}return await this.openReadingView(t,e),!0}isReadingViewOpenForFile(t){return t?!!this.findReadingLeafForFile(t):!1}async openReadingViewInLeaf(t,e,i="sot"){await e.setViewState({type:Nt,state:{filePath:t.path,returnViewMode:i},active:!0}),this.app.workspace.setActiveLeaf(e)}async openTipTapViewInLeaf(t,e,i="edit"){this.prepareLeafInitialFile(e,t),this.prepareLeafInitialViewMode(e,i),await e.setViewState({type:Xe,active:!0}),this.app.workspace.setActiveLeaf(e),this.trackManagedLeaf(e)}async openSoTWysiwygViewInLeaf(t,e){this.prepareLeafInitialFile(e,t),await e.setViewState({type:bt,active:!0}),this.app.workspace.setActiveLeaf(e),this.trackManagedLeaf(e),this.applySingleViewConstraints()}async openSoTWysiwygView(t,e){var i,r;this.openInNewWindow=(i=e==null?void 0:e.openInNewWindow)!=null?i:!1,this.openOnRightSide=(r=e==null?void 0:e.openOnRightSide)!=null?r:!0,this.openInNewWindow?await this.openInPopout(bt,t,"edit"):await this.openInPane(bt,t,"edit"),this.openInNewWindow=!1,this.openOnRightSide=!0,this.applySingleViewConstraints()}async openReadingView(t,e){var s,a,l;let i=(s=e==null?void 0:e.openInNewWindow)!=null?s:!1,r=(a=e==null?void 0:e.openOnRightSide)!=null?a:!0,o;if(i)o=this.app.workspace.getLeaf("window");else if(r){let c=this.app.workspace.getLeaf(!1);o=this.app.workspace.createLeafBySplit(c,"vertical",!1)}else o=this.app.workspace.getLeaf("tab");await this.openReadingViewInLeaf(t,o,(l=e==null?void 0:e.returnViewMode)!=null?l:"sot")}async openTipTapView(){let t=this.resolveRetainedFile(),e="edit",i=this.openInNewWindow||this.isPopoutLeaf(this.primaryLeaf),r=null;if(this.isLeafAvailable(this.primaryLeaf)){let o=this.isPopoutLeaf(this.primaryLeaf);i===o&&(r=this.primaryLeaf)}r?(this.prepareLeafInitialFile(r,t),this.prepareLeafInitialViewMode(r,e),await r.setViewState({type:Xe,active:!0}),this.app.workspace.setActiveLeaf(r),this.trackManagedLeaf(r)):r=i?await this.openInPopout(Xe,t,e):await this.openInPane(Xe,t,e),this.openInNewWindow=!1,this.openOnRightSide=!0,this.applySingleViewConstraints()}async openInPane(t,e=null,i="edit"){var o;let r;if(this.openOnRightSide){let s=this.app.workspace.getLeaf(!1);r=this.app.workspace.createLeafBySplit(s,"vertical",!1)}else r=(o=this.getReusableLeaf())!=null?o:this.app.workspace.getLeaf("tab");return this.prepareLeafInitialFile(r,e),this.prepareLeafInitialViewMode(r,i),await r.setViewState({type:t,active:!0}),this.app.workspace.setActiveLeaf(r),r.__tategakiPopout=!1,this.trackManagedLeaf(r),r}async openInPopout(t,e=null,i="edit"){var r;try{let o=(r=this.getReusableLeaf(!0))!=null?r:this.app.workspace.getLeaf("window");return this.prepareLeafInitialFile(o,e),this.prepareLeafInitialViewMode(o,i),await o.setViewState({type:t,active:!0}),this.app.workspace.setActiveLeaf(o),o.__tategakiPopout=!0,this.trackManagedLeaf(o),o}catch(o){return le("Tategaki: popout failed, falling back to pane",o),await this.openInPane(t,e,i)}}trackManagedLeaf(t){t.__tategakiManaged||(t.__tategakiManaged=!0),this.managedLeaves.add(t),this.primaryLeaf=t}resolveRetainedFile(){var e;let t=this.getCurrentManagedFilePath();if(t){let i=this.app.vault.getAbstractFileByPath(t);if(i instanceof Vl.TFile)return i}return(e=this.app.workspace.getActiveFile())!=null?e:null}getCurrentManagedFilePath(){let t=this.app.workspace.activeLeaf,e=this.extractFilePathFromLeaf(t);if(e)return e;if(this.primaryLeaf&&this.primaryLeaf!==t){let i=this.extractFilePathFromLeaf(this.primaryLeaf);if(i)return i}return null}extractFilePathFromLeaf(t){if(!t)return null;let e=t.view;if(e&&typeof e.getCurrentFilePath=="function")try{let i=e.getCurrentFilePath();return typeof i=="string"?i:null}catch(i){le("Tategaki: failed to read current file path from view",i)}return null}findReadingLeafForFile(t){var i,r;let e=this.getAllReadingLeaves();for(let o of e){let s=o.view;if(((r=(i=s.getCurrentFilePath)==null?void 0:i.call(s))!=null?r:null)===t)return o}return null}prepareLeafInitialFile(t,e){t&&(e?t[ni.INITIAL_FILE_PROP]=e:delete t[ni.INITIAL_FILE_PROP])}prepareLeafInitialViewMode(t,e){t&&(e==="edit"?t[ni.INITIAL_VIEW_MODE_PROP]=e:delete t[ni.INITIAL_VIEW_MODE_PROP])}getAllEditorLeaves(){return[...this.app.workspace.getLeavesOfType(Xe),...this.app.workspace.getLeavesOfType(It),...this.app.workspace.getLeavesOfType(bt)]}getAllReadingLeaves(){return this.app.workspace.getLeavesOfType(Nt)}setupWorkspaceGuards(){this.disposeWorkspaceGuards();let t=()=>this.scheduleEnforceSingleView();this.workspaceGuards.push(this.app.workspace.on("layout-change",t)),this.workspaceGuards.push(this.app.workspace.on("leaf-open",t)),this.workspaceGuards.push(this.app.workspace.on("leaf-detach",t))}disposeWorkspaceGuards(){for(;this.workspaceGuards.length>0;){let t=this.workspaceGuards.pop();t&&this.app.workspace.offref(t)}}scheduleEnforceSingleView(){this.enforceTimer===null&&(this.enforceTimer=setTimeout(()=>{this.enforceTimer=null,this.applySingleViewConstraints()},16))}clearEnforcementTimer(){this.enforceTimer!==null&&(clearTimeout(this.enforceTimer),this.enforceTimer=null)}applySingleViewConstraints(){let t=this.getAllEditorLeaves().filter(r=>this.isLeafAvailable(r));if(t.length===0){this.primaryLeaf=null;return}let e=this.app.workspace.activeLeaf,i=null;if(e&&t.includes(e)?i=e:this.isLeafAvailable(this.primaryLeaf)&&this.primaryLeaf?i=this.primaryLeaf:i=t[0],!!i){this.trackManagedLeaf(i);for(let r of t)if(r!==i){this.managedLeaves.delete(r),delete r.__tategakiManaged,delete r.__tategakiPopout;try{r.detach()}catch(o){le("Tategaki: failed to close extra leaf",o)}}this.app.workspace.activeLeaf!==i&&this.app.workspace.setActiveLeaf(i)}}getReusableLeaf(t=!1){if(this.isLeafAvailable(this.primaryLeaf)){let i=this.isPopoutLeaf(this.primaryLeaf);if(!t&&!i||t&&i)return this.primaryLeaf}let e=this.getAllEditorLeaves();for(let i of e){if(!this.isLeafAvailable(i))continue;let r=this.isPopoutLeaf(i);if(!(t&&!r)&&!(!t&&r))return i}return null}isLeafAvailable(t){if(!t)return!1;let e=t==null?void 0:t.containerEl;return!!(e!=null&&e.isConnected)}isPopoutLeaf(t){return!!(t&&t.__tategakiPopout)}};ni.INITIAL_FILE_PROP="__tategakiInitialFile",ni.INITIAL_VIEW_MODE_PROP="__tategakiInitialViewMode";var zl=ni;var Ao=class extends Ut.Plugin{async onload(){var t,e,i,r,o;try{let s=this.app.workspace.getLeavesOfType("tategaki-preview-view"),a=this.app.workspace.getLeavesOfType("tategaki-wysiwyg-view"),l=[...this.app.workspace.getLeavesOfType(Xe),...this.app.workspace.getLeavesOfType(It)],c=this.app.workspace.getLeavesOfType(Nt),u=this.app.workspace.getLeavesOfType(bt);if(s.length>0||a.length>0||l.length>0||c.length>0||u.length>0){let d=[...s,...a,...l,...c,...u];for(let p of d){let f=p.view;try{typeof(f==null?void 0:f.handleAppQuit)=="function"?await f.handleAppQuit("save"):(i=(e=(t=f==null?void 0:f.syncManager)==null?void 0:t.getState)==null?void 0:e.call(t))!=null&&i.dirty&&await((o=(r=f.syncManager).flush)==null?void 0:o.call(r))}catch(g){le("Tategaki: failed to flush view before cleanup",g)}}s.forEach(p=>p.detach()),a.forEach(p=>p.detach()),l.forEach(p=>p.detach()),c.forEach(p=>p.detach()),u.forEach(p=>p.detach());let h=this.app.viewRegistry;h!=null&&h.viewByType&&(delete h.viewByType["tategaki-preview-view"],delete h.viewByType["tategaki-wysiwyg-view"],delete h.viewByType[Xe],delete h.viewByType[It],delete h.viewByType[Nt],delete h.viewByType[bt]),await new Promise(p=>setTimeout(p,200))}}catch(s){le("Tategaki: Error during pre-load cleanup",s)}await this.loadSettings(),this.modeManager=new zl(this.app,this.settings,this),this.addSettingTab(new Do(this.app,this)),await this.modeManager.registerViews(),this.addCommands(),this.registerQuitHandler(),this.addRibbonIcon("tally-4","\u7E26\u66F8\u304D\u30D3\u30E5\u30FC\u3092\u958B\u304F",()=>{this.modeManager.openView()})}async onunload(){this.modeManager&&this.modeManager.cleanup();try{let t=this.app.workspace.getLeavesOfType("tategaki-preview-view"),e=this.app.workspace.getLeavesOfType("tategaki-wysiwyg-view"),i=[...this.app.workspace.getLeavesOfType(Xe),...this.app.workspace.getLeavesOfType(It)],r=this.app.workspace.getLeavesOfType(Nt),o=this.app.workspace.getLeavesOfType(bt);t.forEach(a=>a.detach()),e.forEach(a=>a.detach()),i.forEach(a=>a.detach()),r.forEach(a=>a.detach()),o.forEach(a=>a.detach());let s=this.app.viewRegistry;s!=null&&s.viewByType&&(delete s.viewByType["tategaki-preview-view"],delete s.viewByType["tategaki-wysiwyg-view"],delete s.viewByType[Xe],delete s.viewByType[It],delete s.viewByType[Nt],delete s.viewByType[bt])}catch(t){le("Tategaki: Error during unload cleanup",t)}}addCommands(){this.addCommand({id:"open-tategaki-view",name:"\u7E26\u66F8\u304D\u30D3\u30E5\u30FC\u3092\u958B\u304F",callback:async()=>{await this.modeManager.openView({openOnRightSide:!0})}}),this.addCommand({id:"open-tategaki-sot-wysiwyg-view",name:"\u7E26\u66F8\u304DSoT\u7DE8\u96C6\u30D3\u30E5\u30FC\u3092\u958B\u304F\uFF08\u5B9F\u9A13\uFF09",callback:async()=>{let t=this.app.workspace.getActiveFile();if(!t){new Ut.Notice("\u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",2500);return}await this.modeManager.openSoTWysiwygView(t,{openOnRightSide:!0})}})}async moveSyncBackupsToTrash(){if(confirm(`\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3059\u304B\uFF1F

\u79FB\u52D5\u3059\u308B\u3068\u3001\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304B\u3089\u306E\u5FA9\u5143\u306F\u3067\u304D\u306A\u304F\u306A\u308A\u307E\u3059\u3002`))try{let e=await ff(this.app);if(e==="none"){new Ut.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",2500);return}e==="system"?new Ut.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u30B4\u30DF\u7BB1\u3078\u79FB\u52D5\u3057\u307E\u3057\u305F\u3002",3e3):new Ut.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092 .trash \u306B\u79FB\u52D5\u3057\u307E\u3057\u305F\u3002",3500)}catch(e){console.error("Tategaki: failed to move sync backups to trash",e),new Ut.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306E\u79FB\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",3500)}}async openSyncBackupFolder(){let t=this.app.vault.adapter,e=typeof t.getBasePath=="function"?t.getBasePath():null;if(!e){new Ut.Notice("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u304F\u306B\u306F\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u7248\u304C\u5FC5\u8981\u3067\u3059\u3002",3e3);return}let i=Nx.join(e,pf),r=(()=>{var a;try{return(a=window.require)==null?void 0:a.call(window,"fs")}catch(l){return null}})();if(r!=null&&r.existsSync&&!r.existsSync(i)){new Ut.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",3e3);return}let o=(()=>{var a,l;try{return(l=(a=window.require)==null?void 0:a.call(window,"electron"))==null?void 0:l.shell}catch(c){return null}})();if(o!=null&&o.openPath){let a=await o.openPath(i);if(!a)return;if(/(enoent|no such file|not found)/i.test(a)){new Ut.Notice("\u540C\u671F\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",3e3);return}}if(o!=null&&o.showItemInFolder){o.showItemInFolder(i);return}let s=this.app;if(typeof s.openWithDefaultApp=="function")try{await s.openWithDefaultApp(i);return}catch(a){}new Ut.Notice("\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u30D5\u30A9\u30EB\u30C0\u3092\u958B\u3051\u307E\u305B\u3093\u3067\u3057\u305F\u3002",3e3)}registerQuitHandler(){this.registerEvent(this.app.workspace.on("quit",t=>{var r;let e=(r=this.settings.wysiwyg.appCloseAction)!=null?r:"save",i=this.collectSyncLeaves();if(e==="save"&&this.hasDirtyLeaves(i)){t.add(async()=>{await this.handleAppQuit(e,{awaitSaves:!0,leaves:i})});return}this.handleAppQuit(e,{awaitSaves:!1,leaves:i})}))}collectSyncLeaves(){return[...this.app.workspace.getLeavesOfType(Xe),...this.app.workspace.getLeavesOfType(It)]}hasDirtyLeaves(t){var e,i;for(let r of t){let o=r.view,s=(i=(e=o==null?void 0:o.syncManager)==null?void 0:e.getState)==null?void 0:i.call(e);if(s!=null&&s.dirty)return!0}return!1}async handleAppQuit(t,e={}){var o,s,a;let i=e.awaitSaves!==!1,r=(o=e.leaves)!=null?o:this.collectSyncLeaves();for(let l of r){let c=l.view;if(typeof(c==null?void 0:c.handleAppQuit)=="function"){let u=c.handleAppQuit(t);i&&await u;continue}if(t==="save"&&c!=null&&c.syncManager){let u=(a=(s=c.syncManager).getState)==null?void 0:a.call(s);if(u!=null&&u.dirty){let d=c.syncManager.flush();i&&await d}}}for(let l of r)l.detach()}async loadSettings(){var e;let t=(e=await this.loadData())!=null?e:{};this.settings=jh(t),dc(!!this.settings.common.debugLogging)}async saveSettings(){await this.saveData(this.settings)}async updateSettings(t){let e={...t},i=e.common!==void 0,r=this.settings.preview,o=this.settings.common,s=e.preview,a=s&&Object.prototype.hasOwnProperty.call(s,"pageModeEnabled");i&&r.pageModeEnabled&&!a&&(e.preview={...r,...s,pageModeEnabled:!1}),this.settings=Object.assign(this.settings,e),e.preview&&(this.settings.preview=Object.assign({},r,e.preview)),e.common&&(this.settings.common=Object.assign({},o,e.common)),await this.saveSettings(),dc(!!this.settings.common.debugLogging),await this.modeManager.onSettingsChanged(this.settings)}async saveTheme(t){let e=this.settings.themes.findIndex(i=>i.id===t.id);e>=0?this.settings.themes[e]=t:this.settings.themes.push(t),await this.saveSettings()}rgbToHex(t){let e=t.match(/\d+/g);if(!e||e.length<3)return t;let i=parseInt(e[0]),r=parseInt(e[1]),o=parseInt(e[2]),s=a=>{let l=a.toString(16);return l.length===1?"0"+l:l};return`#${s(i)}${s(r)}${s(o)}`}getCssVariableColor(t){if(!t.startsWith("var("))return t;let e=t.slice(4,-1).trim(),i=document.createElement("div");i.style.color=`var(${e})`,document.body.appendChild(i);let r=getComputedStyle(i).color;return document.body.removeChild(i),r&&r.startsWith("rgb")?this.rgbToHex(r)||t:r||t}getCssVariableFont(t){if(!t.startsWith("var("))return t;let e=t.slice(4,-1).trim(),i=document.createElement("div");i.style.fontFamily=`var(${e})`,document.body.appendChild(i);let r=getComputedStyle(i).fontFamily;return document.body.removeChild(i),r||t}getHeadingStyleFromObsidian(){let t=document.querySelector(".markdown-source-view")||document.querySelector(".markdown-preview-view")||document.body,e=document.createElement("h1");e.textContent="Test",e.style.cssText="position: absolute; visibility: hidden; pointer-events: none;",t.appendChild(e);let i=getComputedStyle(e),r=i.color,o=i.fontFamily;t.removeChild(e);let s="";return r&&r.startsWith("rgb")?s=this.rgbToHex(r)||"":r&&(s=r),{color:s,fontFamily:o||""}}async loadTheme(t){var i,r,o,s,a;if(t==="obsidian-base"){this.settings.activeTheme="obsidian-base",this.settings.temporaryOverrides={};let l=this.getCssVariableFont("var(--font-text)")||"inherit",c=this.getCssVariableColor("var(--text-normal)")||"#2e2e2e",u=this.getCssVariableColor("var(--background-primary)")||"#ffffff",d=this.getCssVariableColor("var(--background-secondary)")||"#f5f5f5",h=this.getCssVariableColor("var(--text-accent)")||"#1e90ff",p=this.getHeadingStyleFromObsidian(),f=p.color===c?"":p.color,g=p.fontFamily===l?"":p.fontFamily;await this.updateSettings({activeTheme:"obsidian-base",common:{...this.settings.common,fontFamily:l,fontSize:16,lineHeight:1.6,textColor:c,backgroundColor:u,pageBackgroundColor:d,accentColor:h,headingFontFamily:g,headingTextColor:f},temporaryOverrides:{}});return}let e=this.settings.themes.find(l=>l.id===t);if(!e){console.error(`\u30C6\u30FC\u30DE\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${t}`);return}await this.updateSettings({activeTheme:t,common:{...this.settings.common,fontFamily:e.settings.fontFamily,fontSize:e.settings.fontSize,lineHeight:e.settings.lineHeight,letterSpacing:(i=e.settings.letterSpacing)!=null?i:this.settings.common.letterSpacing,rubySize:(r=e.settings.rubySize)!=null?r:this.settings.common.rubySize,headingFontFamily:(o=e.settings.headingFontFamily)!=null?o:"",textColor:e.settings.colors.text,backgroundColor:e.settings.colors.background,pageBackgroundColor:e.settings.colors.pageBackground,accentColor:e.settings.colors.accent,headingTextColor:(a=(s=e.settings.colors)==null?void 0:s.headingText)!=null?a:"",headingSpacing:e.settings.spacing.headingSpacing},temporaryOverrides:{}})}getThemes(){return this.settings.themes}getActiveThemeId(){return this.settings.activeTheme}async deleteTheme(t){if(t==="obsidian-base"){console.error("Obsidian\u30D9\u30FC\u30B9\u30C6\u30FC\u30DE\u306F\u524A\u9664\u3067\u304D\u307E\u305B\u3093");return}this.settings.themes=this.settings.themes.filter(e=>e.id!==t),this.settings.activeTheme===t?await this.loadTheme("obsidian-base"):await this.saveSettings()}async createThemeFromCurrentSettings(t,e="\u30E6\u30FC\u30B6\u30FC\u4F5C\u6210\u30C6\u30FC\u30DE"){let i=`theme-${Date.now()}`,r=this.getEffectiveCommonSettings(),o={id:i,name:t,description:e,mode:"custom",settings:{fontFamily:r.fontFamily,fontSize:r.fontSize,lineHeight:r.lineHeight,letterSpacing:r.letterSpacing,rubySize:r.rubySize,headingFontFamily:r.headingFontFamily,colors:{text:r.textColor,background:r.backgroundColor,pageBackground:r.pageBackgroundColor,accent:r.accentColor,headingText:r.headingTextColor},spacing:{paragraphSpacing:1.5,headingSpacing:r.headingSpacing}}};return await this.saveTheme(o),await this.loadTheme(i),o}getEffectiveCommonSettings(){let t=this.settings.common,e=this.settings.temporaryOverrides;return{...t,...e.fontFamily!==void 0&&{fontFamily:e.fontFamily},...e.fontSize!==void 0&&{fontSize:e.fontSize},...e.lineHeight!==void 0&&{lineHeight:e.lineHeight},...e.letterSpacing!==void 0&&{letterSpacing:e.letterSpacing},...e.textColor!==void 0&&{textColor:e.textColor},...e.backgroundColor!==void 0&&{backgroundColor:e.backgroundColor},...e.pageBackgroundColor!==void 0&&{pageBackgroundColor:e.pageBackgroundColor},...e.accentColor!==void 0&&{accentColor:e.accentColor},...e.rubySize!==void 0&&{rubySize:e.rubySize},...e.headingSpacing!==void 0&&{headingSpacing:e.headingSpacing},...e.rubyVerticalGap!==void 0&&{rubyVerticalGap:e.rubyVerticalGap},...e.rubyHorizontalGap!==void 0&&{rubyHorizontalGap:e.rubyHorizontalGap},...e.headingFontFamily!==void 0&&{headingFontFamily:e.headingFontFamily},...e.headingTextColor!==void 0&&{headingTextColor:e.headingTextColor}}}async updateTemporaryOverride(t,e){this.settings.temporaryOverrides[t]=e,await this.saveSettings(),await this.modeManager.onSettingsChanged(this.settings)}async clearTemporaryOverrides(){this.settings.temporaryOverrides={},await this.saveSettings(),await this.modeManager.onSettingsChanged(this.settings)}};var MN=Ao;
